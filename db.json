{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"themes/light/source/github.png","path":"github.png","modified":1,"renderable":1},{"_id":"themes/light/source/segmentfault.jpeg","path":"segmentfault.jpeg","modified":1,"renderable":1},{"_id":"themes/light/source/totop.png","path":"totop.png","modified":1,"renderable":1},{"_id":"themes/light/source/kiwenlau.ico","path":"kiwenlau.ico","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":1,"renderable":1},{"_id":"themes/light/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/light/source/js/jquery.imagesloaded.min.js","path":"js/jquery.imagesloaded.min.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/gallery.js","path":"js/gallery.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/totop.js","path":"js/totop.js","modified":1,"renderable":1},{"_id":"themes/light/source/img/fundebug.png","path":"img/fundebug.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.eot","path":"css/font/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.woff","path":"css/font/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.ttf","path":"css/font/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.svg","path":"css/font/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/light/source/kiwenlau.jpg","path":"kiwenlau.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"70d952c3e3c4d5724752f822af52f66de6dd095a","modified":1484626789000},{"_id":"source/robots.txt","hash":"b7d8a5701d5fb60fda9e17342c5fed7aec6b3ab2","modified":1478482378000},{"_id":"themes/light/_config.yml","hash":"b34fe9359aab25007550b2bc82c1c43a4f85c6a8","modified":1481121612000},{"_id":"themes/light/.DS_Store","hash":"d7a158e560408a825df0c91641f6e0e7c9315cbd","modified":1480641289000},{"_id":"themes/light/layout/archive.ejs","hash":"a18842e3d719fe3ca9b977a6995f8facc75c8673","modified":1478482378000},{"_id":"source/_posts/.DS_Store","hash":"85c3746746dbd5d183a168565622511ae93c9582","modified":1485010505000},{"_id":"themes/light/layout/category.ejs","hash":"9b740fc33f6f028df60f0bc4312bf3ebd03aa8ea","modified":1478482378000},{"_id":"themes/light/layout/page.ejs","hash":"70cbc9854655773cc6ba84eecaaf330fed430465","modified":1478482378000},{"_id":"themes/light/layout/index.ejs","hash":"e569d8fe0741a24efb89e44781f9e616da17e036","modified":1478482378000},{"_id":"themes/light/layout/layout.ejs","hash":"72da76881ebf00e71d7cc196f377e37a17ec7a6f","modified":1478482378000},{"_id":"themes/light/layout/tag.ejs","hash":"45150a2365768b6b67880193c9264ad2bb4814db","modified":1478482378000},{"_id":"themes/light/layout/post.ejs","hash":"70cbc9854655773cc6ba84eecaaf330fed430465","modified":1478482378000},{"_id":"themes/light/languages/de.yml","hash":"e076c7f2eb29ebcfb04d94861bf3063c4b08078c","modified":1478482378000},{"_id":"themes/light/languages/es.yml","hash":"de273af604b27812cfd4195e7b7f28ceff2734b3","modified":1478482378000},{"_id":"themes/light/languages/default.yml","hash":"fd7397be7789b43c1c163ab4faf106318811c2a8","modified":1478482378000},{"_id":"themes/light/languages/ru.yml","hash":"35aadf8fdd28aaff8a1c8f50e80201dcf8ce0604","modified":1478482378000},{"_id":"themes/light/languages/zh-CN.yml","hash":"16979cea6653f9ed345b6ed2c09823d75a622ded","modified":1478482378000},{"_id":"themes/light/languages/zh-TW.yml","hash":"bcfd502bf073d4c451c13d05d2571f814d1766c9","modified":1478482378000},{"_id":"themes/light/source/.DS_Store","hash":"f217616287e3654b901421510dfc52742fc2d062","modified":1480641325000},{"_id":"themes/light/source/github.png","hash":"8e4af8e0da1da6fb685e86c19afb5322d559a8ca","modified":1478482378000},{"_id":"themes/light/source/segmentfault.jpeg","hash":"023e7eef6165635b2fee0fc013a8c45b0358a547","modified":1478482378000},{"_id":"source/_posts/2015/.DS_Store","hash":"634421600953aab1b9fddd6b04f52192f9141369","modified":1478736879000},{"_id":"themes/light/source/totop.png","hash":"74f4b1e0f3b47a1a27cee4a8cb712eb33994ca41","modified":1478482378000},{"_id":"source/_posts/2017/.DS_Store","hash":"cfd18b5c34944cfa429c4bb8ded1857fab0cf6bf","modified":1486946384000},{"_id":"source/_posts/2016/.DS_Store","hash":"e65222cb8d500a6636bff2b7162e3bb149db4031","modified":1481106047000},{"_id":"themes/light/layout/_partial/after_footer.ejs","hash":"dcd159b8766379baa9c120acd40b28a061bbe9d6","modified":1478919433000},{"_id":"themes/light/layout/_partial/archive.ejs","hash":"7e4f7c2909b1b90241424ea2ff8e7b4761d8360f","modified":1478482378000},{"_id":"themes/light/layout/_partial/copyright.ejs","hash":"837f3e58f9e7a3d9092286f6e06929e45376542d","modified":1478482378000},{"_id":"themes/light/layout/_partial/article.ejs","hash":"1c78b15b13a95c877cd19b7682173fa14916a3a0","modified":1478482378000},{"_id":"themes/light/layout/_partial/header.ejs","hash":"d9a99aca97d8b41ed907fbf5b25df05da3ffa4f6","modified":1478482378000},{"_id":"themes/light/layout/_partial/footer.ejs","hash":"61224149335ae515b0c23e27070c11b05d78749d","modified":1478482378000},{"_id":"themes/light/layout/_partial/duoshuo.ejs","hash":"55335191ea821ba78b14203a7dc61a2d652b6509","modified":1478482378000},{"_id":"themes/light/layout/_partial/sidebar.ejs","hash":"caf351797a18d03d8ee945ceb9f83785c50c09f9","modified":1478482378000},{"_id":"themes/light/layout/_partial/pagination.ejs","hash":"1206b630a07444e8744365f14ddb26095c925ae1","modified":1478482378000},{"_id":"themes/light/layout/_partial/totop.ejs","hash":"30a6520a82568c9862bd2112aead19a3926e3764","modified":1478482378000},{"_id":"themes/light/layout/_partial/head.ejs","hash":"2ffce109c12262b1260037dc290ba2926f57fee7","modified":1482458277000},{"_id":"themes/light/layout/_widget/category.ejs","hash":"8a2b90dc29661371f060f710668929c3588e15e4","modified":1478482378000},{"_id":"themes/light/layout/_widget/link.ejs","hash":"d6854930ec54fcfa8acbb2e9210203688357126c","modified":1478482378000},{"_id":"themes/light/layout/_widget/photo.ejs","hash":"f520f3193e86f1dbe41b1677fc500219f6b7814f","modified":1480653501000},{"_id":"themes/light/layout/_widget/recent_posts.ejs","hash":"8f2f3963bd568c681d7585bb8099fb1b3e1d4c81","modified":1478482378000},{"_id":"themes/light/layout/_widget/tag.ejs","hash":"1914db78bea49c333067d79fe7ad9567d2b08d00","modified":1478482378000},{"_id":"themes/light/layout/_widget/tagcloud.ejs","hash":"9053f62cdbadbd109d6569f4a0381b7a05ba5dfc","modified":1478482378000},{"_id":"themes/light/layout/_widget/search.ejs","hash":"e517c8e6941d8d3bb4a2042fce258cc966488c53","modified":1478482378000},{"_id":"themes/light/source/kiwenlau.ico","hash":"987d9c1658c3779037d96f49d8779b9bab18440b","modified":1478482378000},{"_id":"themes/light/layout/_widget/toc.ejs","hash":"b95422f579ed3747124cae680c8d4283e28ed267","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1478482378000},{"_id":"themes/light/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1478482378000},{"_id":"themes/light/source/css/style.styl","hash":"c03b2520e4a85b981e29516cadc0a365e6500e3d","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1478482378000},{"_id":"themes/light/source/fancybox/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1478482378000},{"_id":"themes/light/source/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1478482378000},{"_id":"themes/light/source/img/.DS_Store","hash":"02354a5c5b051647a6815911a2012fcbb4e8be46","modified":1480649852000},{"_id":"themes/light/source/js/gallery.js","hash":"f8b17fc2dbd4fb939bb872d1232b404049355cfa","modified":1480653496000},{"_id":"source/_posts/2015/09/.DS_Store","hash":"016edfce8354a2669c8f04da0fac2a840674c7b6","modified":1478736879000},{"_id":"themes/light/source/js/totop.js","hash":"732004eb3e78e649d8f8e3d771aac652a3dbde73","modified":1481250907000},{"_id":"themes/light/source/img/fundebug.png","hash":"5470ee921cb4160af726031d01324e57eae2ea84","modified":1477112796000},{"_id":"source/_posts/2016/11/.DS_Store","hash":"7c7f699e15d572775589195a31a13d35b1476646","modified":1478740032000},{"_id":"source/_posts/2016/12/.DS_Store","hash":"e1b842ca406c09ba26e477bd2541de01a8c27172","modified":1481095746000},{"_id":"source/_posts/2016/11/fundebug-is-online.md","hash":"d0289e7d75c8db814e13e176ca1d56ff95868f8b","modified":1481121350000},{"_id":"themes/light/source/fancybox/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/category.ejs","hash":"be740939c5c2d4ffdbed9557b4e63a590058b476","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/gallery.ejs","hash":"fafc2501d7e65983b0f5c2b58151ca12e57c0574","modified":1478482378000},{"_id":"source/_posts/2017/01/.DS_Store","hash":"761c0c8bd55484048b7e55a8ab294d9b7f4fec1e","modified":1485043119000},{"_id":"source/_posts/2017/02/.DS_Store","hash":"52bfa4bc9b5494be061937bb0edd3aa3684d1ec4","modified":1486946294000},{"_id":"themes/light/layout/_partial/post/tag.ejs","hash":"095418df66a27a28cbab16d7cb0d16001b0e23f1","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/share.ejs","hash":"24c04b319f1b19e887c42db961b90a7e0ab26fdc","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/title.ejs","hash":"d7fbc575d35ae68f9045a382c651450e4131f335","modified":1478482378000},{"_id":"themes/light/source/css/_base/utils.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1478482378000},{"_id":"themes/light/source/css/_base/layout.styl","hash":"1b58c21aa48a8f9f7f811af681ac182dd058e23d","modified":1478482378000},{"_id":"themes/light/source/css/_base/variable.styl","hash":"c4e07cb7f4ec980553cd19d9d2cd8a1a44d4cd82","modified":1478482378000},{"_id":"themes/light/source/css/_partial/archive.styl","hash":"072e9b8c5ee9acf95ac7cce9c34706d41e412229","modified":1478482378000},{"_id":"themes/light/source/css/_partial/comment.styl","hash":"a74254a6e713a522134cca4c644fde681c502823","modified":1478482378000},{"_id":"themes/light/source/css/_partial/article.styl","hash":"fda6b477b2137090fcc6d2bbe170dbf46b9699e7","modified":1478482378000},{"_id":"themes/light/source/css/_partial/footer.styl","hash":"1757872dbdbd09295a625f13e356aa798a8bb308","modified":1478482378000},{"_id":"themes/light/source/css/_partial/header.styl","hash":"0f932c9514d13fea70fe109242e17ee633a2b28a","modified":1478482378000},{"_id":"themes/light/source/css/_partial/index.styl","hash":"7a8c0ec6ab99a9f8e00c9687aca29d31752424a2","modified":1478482378000},{"_id":"themes/light/source/css/_partial/sidebar.styl","hash":"e21feea627a06c711f90d9830356c85e150f162e","modified":1478482378000},{"_id":"themes/light/source/css/_partial/syntax.styl","hash":"418b304ca39948bfbf720f3465962a1846f9a0e6","modified":1478482378000},{"_id":"themes/light/source/css/font/fontawesome-webfont.eot","hash":"d775f599ff3f23be082e6a9604b4898718923a37","modified":1478482378000},{"_id":"themes/light/source/css/font/fontawesome-webfont.woff","hash":"0612cddf2f835cceffccc88fd194f97367d0b024","modified":1478482378000},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker.md","hash":"659fb635866560790aae7efa58b177355b4bb5f4","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker.md","hash":"a46ac2531bceff80cc62ff78de417dac746fac84","modified":1478482378000},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu.md","hash":"af07ccf8c42a27f516f4d239c7c4c26d12dc3cf3","modified":1478482378000},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker.md","hash":"73c87cbd4d2cea2c2903c8620c041e1a2295bc2f","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container.md","hash":"5819960205910a689ccf40443f198edc1ea79a52","modified":1478482378000},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster.md","hash":"895758b7c475183c6d8bc293db38f96fc01a2de6","modified":1478482378000},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker.md","hash":"fadb6cd129c08bcfd9bf0196d5a970894767cbbd","modified":1478482378000},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update.md","hash":"332aa8fd51e9a2850ea5ae1a78ff9db8bb73f5f9","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform.md","hash":"acc74e6800d9d634c2f5cfe483fe10c2c8a34fef","modified":1478482378000},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine.md","hash":"cdbdc494436a96dd6faaf0cf335ac4e1e63ae5a3","modified":1478482378000},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english.md","hash":"14b37b76e1c94a152c9a97ed07e94179649f4fb3","modified":1478482378000},{"_id":"source/_posts/2016/09/04/what-is-service-discovery.md","hash":"9852717fd5cbf5655e9b42bdcdeba9f6dba96497","modified":1478482378000},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index.md","hash":"c40996da497a45209707ad29637a6723eb548c1b","modified":1478482378000},{"_id":"source/_posts/2016/12/07/.DS_Store","hash":"93d3aa68b72fc6047e1902222b4a0c9aa7f5e686","modified":1481105991000},{"_id":"source/_posts/2016/09/18/underscore-example.md","hash":"5c0315f5d905d835660440ec9f9462db401dc9d1","modified":1478482378000},{"_id":"source/_posts/2017/01/16/.DS_Store","hash":"e0f9f0ad65c2122d10a3a10ad99e817136e9f6ed","modified":1484626730000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug.md","hash":"21e90c4b32c2bfd9baba0e5fbe0f6d5999487079","modified":1481121342000},{"_id":"source/_posts/2017/01/23/.DS_Store","hash":"46bd85c6a4efef7303a0b76df0800f5108cf6752","modified":1485043119000},{"_id":"source/_posts/2017/02/11/.DS_Store","hash":"91c0322740c4a94b8372cb9c7deb5c748bc5196a","modified":1486945068000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs.md","hash":"5d6c6e67a1e7b41031b646e91b1ac175271ed78f","modified":1484988277000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers.md","hash":"0760a3d856fa7b244e4295f651fe14e9cbbd4d02","modified":1484627033000},{"_id":"source/_posts/2017/02/11/weixin-miniprogram-need-fundebug.md","hash":"5794b581490229d6eff2e893733f01d1d21b2ab9","modified":1486874910000},{"_id":"themes/light/source/css/font/fontawesome-webfont.ttf","hash":"a9468f6a1fe965fbcaf5a1bd6c11705e2fc5f84c","modified":1478482378000},{"_id":"themes/light/source/css/font/fontawesome-webfont.svg","hash":"d162419c91b8bab3a4fd327c933a0fcf3799c251","modified":1478482378000},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.graffle","hash":"363be32d8d54a021835f2125e7d93ab5f07ee3e1","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.graffle","hash":"7dcd48d344e3dc1c7bbcce0871aa44cc4f1f10a8","modified":1478482378000},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png","hash":"018c8ad81bcf1ad54778e761bf6c630403eb5e80","modified":1478482378000},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.graffle","hash":"851a2ee0c92e642e4dffedaac3fcaef10d216806","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.graffle","hash":"851a2ee0c92e642e4dffedaac3fcaef10d216806","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.graffle","hash":"927aa0c3be32943949d17fa5455c2602a56c87fa","modified":1478482378000},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.graffle","hash":"9a2bac1e19c9299faf7e698b2feabde9717bad76","modified":1478482378000},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.graffle","hash":"b3e35ad7747c984f5069ad3589677e599395e34d","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/marathon.png","hash":"a3846ef25a058da2f9d67e5690bd501a3d1f94ff","modified":1478482378000},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.graffle","hash":"33e193fb0f5600d82ebc8da745b09b2ae8d88e15","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/nginx.png","hash":"e98b0adf233b13140e2a03a4feb8dc0f8f459af5","modified":1478482378000},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.graffle","hash":"87e9b82b8aebd6a0239bc1582dec43e8356bf0d1","modified":1478482378000},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.graffle","hash":"7b5bd9e08cc3b4fc85dc7a04f106be0de6edd34b","modified":1478482378000},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.graffle","hash":"281797ad8328ad5a147bfaeb4aa33c127d839e8f","modified":1478482378000},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.graffle","hash":"d1c17c50056f8e3757d9a3fe686223cf62322d13","modified":1478482378000},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.graffle","hash":"73758ad67c6d2d8e04112b931a5babc5bb09af24","modified":1478482378000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-count.png","hash":"59a70b42bafe6159b1f56b07dffab29ecc84e9b8","modified":1481102064000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/.DS_Store","hash":"9da38aa687209f3db4a07f2cb09419318b9c9283","modified":1484571068000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/.DS_Store","hash":"5f5b4ffa9b1d34d2f5a34b95d7b7e254691928ad","modified":1484988463000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/.DS_Store","hash":"9fafb72ffc9806b4d8da2d2ec2ebfe1a92acd433","modified":1481102050000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/empty.png","hash":"d65573fd992349739115b21172ac24bb94857393","modified":1485009372000},{"_id":"source/_posts/2016/11/fundebug-is-online/with_fundebug.jpg","hash":"21c5b66c47b82be0faaac29d39a09922587e1ef8","modified":1478722462000},{"_id":"source/_posts/2016/11/fundebug-is-online/without_fundebug.jpg","hash":"0e677ff142f135356f97dc2975192c74aa153245","modified":1478722462000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Marathon.png","hash":"58abd8a1ba30eedef47649093a37291e29f21e00","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png","hash":"f5b2995f300b1302e437ef8d4736341a3d5e7661","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/hello.png","hash":"732ba80324b66a3ff47fafbde89f4c61dfb04a08","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png","hash":"ae7bd83a3077c4f1a1f85211321932ab2e8df3cd","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos.png","hash":"79e6dfb76d3585a5af23df5a2b185631ede2f179","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/zookeeper.png","hash":"24357ecf44a1046d4f9191bc7d27ffa4f5957b8c","modified":1478482378000},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png","hash":"a5ac1810938b8750268386ac39bbacfbf196c546","modified":1478482378000},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png","hash":"a5ac1810938b8750268386ac39bbacfbf196c546","modified":1478482378000},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.png","hash":"463575f691b762eb0dc52cdbf220b784024d4abf","modified":1478482378000},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.png","hash":"8295624fb096ba56f23e89e821a6453f54d55d25","modified":1478482378000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/email.png","hash":"44c53c1fcaca35c97dddd008586d05b31c2b90c0","modified":1481101965000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser-share.png","hash":"d771a27d5a87b85c6a943909cbd37b01d42c7588","modified":1484576485000},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png","hash":"c3762c5e96023233997aef60d1c1e678d1998ba2","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png","hash":"c3762c5e96023233997aef60d1c1e678d1998ba2","modified":1478482378000},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png","hash":"a4470187ff958413325ce3241dfea734d05ad4ef","modified":1478482378000},{"_id":"themes/light/source/kiwenlau.jpg","hash":"e163949f9617ee5a0b92ef131f6e2bb57a2c0e36","modified":1478482378000},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png","hash":"d980b3c3af38a43af0168fd7defe0ded28be9652","modified":1478482378000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-detail.png","hash":"aa35e26788a38cd49e492ba18c593f222323d7ae","modified":1481102064000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Mesos.png","hash":"5fbab0dbc5d46b0caa4fab577a0de8c174c0eab6","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.graffle","hash":"4383e6048a4699bb494d20ce8d1490d10c550b35","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png","hash":"aa5290c71ba1721e39ed42fbef45465df0636699","modified":1478482378000},{"_id":"source/_posts/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg","hash":"6232670f38f5ceffa2da0c246c0f5ac770c7d981","modified":1486774942000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg","hash":"6232670f38f5ceffa2da0c246c0f5ac770c7d981","modified":1484987539000},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png","hash":"d877b65ca99e60fd05e04df49c83decda3e59e50","modified":1478482378000},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.graffle","hash":"02a2b9ae30a9ee599151160d6a9eaf7f10661ebb","modified":1478482378000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser.jpg","hash":"408c2c7589aebb85837af85218230b32b5d63300","modified":1484576485000},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png","hash":"a54ce970b4aef1d48bb0eadd2b2b8290d8987557","modified":1478482378000},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png","hash":"0e96c1b51dcd1102d2c000f2510fedeb356d2b02","modified":1478482378000}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"Fundebug上线了！","date":"2016-11-10T16:00:00.000Z","_content":"\n当我们解决了一个又一个Bug，然后进行了一轮又一轮代码审查，之后又跑了一遍又一遍测试，代码终于上线了！\n\n<!-- more -->\n\n然而，我们能够保证上线的代码一定没有Bug吗？似乎没有人可以这样肯定。\n\n用户使用应用的画风很可能是这样的:\n\n- 为啥『注册』按键点击了半天没有反应？！\n- 为啥『激活邮件』一直木有收到？！\n- 为啥狂按F5时页面并没有更新？！\n- 为啥APP莫名其妙地闪退了？！\n- ......\n\n这时，用户的内心是崩溃的，『这是什么破软件？果断弃了』。我们可怜的程序员如果知道挨骂了，也表示很无语，明明单元测试都通过了啊，覆盖率妥妥的100%有木有。。。\n\n其实呢，线上代码出Bug也是很正常的事：\n\n- 一些意想不到的边界条件（内存溢出，死循环，Null, Undefined）;\n- 代码的运行环境（各种浏览器，各种手机）千变万化;\n- 代码运行依赖的系统比如数据库(MySQL, MongoDB, Redis)偶尔抽风;\n- 峰值情况下网络超时，CPU和内存超负荷;\n- ......\n\n还有，网页应用是运行在用户的浏览器上，APP是运行在用户的手机上，所以应用出错的时候程序员是不知道的，这样的话，就无法及时解决Bug，用户体验是很不好的。\n\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/without_fundebug.jpg\" />\n</a>\n</div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n\n那么，您是否需要稳定，安全，智能的错误实时监控与纠错辅助服务？如果需要，[Fundebug](https://fundebug.com/)已经正式上线了，赶紧[免费注册](https://fundebug.com/team/create)吧!\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\" />\n</a>\n</div>\n\nFundebug, Debug with Fun! 我们致力于提供最专业的Bug实时监测服务，让Debug变得更加高效而有趣。目前我们提供JavaScript实时监测服务，您只需要添加一行代码:\n\n```\n<script src=\"https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js\" apikey=\"YOUR-API-KEY-HERE\"></script>\n```\n\n使用Fundebug，您就可以:\n\n- 邮件提醒，更及时地发现错误!\n- 智能面板，更方便地管理错误!\n- 任务分配，更高效地团队协助!\n- 错误搜索，更准确地定位错误！\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/with_fundebug.jpg\" />\n</a>\n</div>\n\n还等什么呢，赶紧为您的团队注册Fundebug帐号吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n\n\n","source":"_posts/2016/11/fundebug-is-online.md","raw":"---\ntitle: Fundebug上线了！\n\ndate: 2016-11-11 00:00:00\n\ntags: [Fundebug]\n\n---\n\n当我们解决了一个又一个Bug，然后进行了一轮又一轮代码审查，之后又跑了一遍又一遍测试，代码终于上线了！\n\n<!-- more -->\n\n然而，我们能够保证上线的代码一定没有Bug吗？似乎没有人可以这样肯定。\n\n用户使用应用的画风很可能是这样的:\n\n- 为啥『注册』按键点击了半天没有反应？！\n- 为啥『激活邮件』一直木有收到？！\n- 为啥狂按F5时页面并没有更新？！\n- 为啥APP莫名其妙地闪退了？！\n- ......\n\n这时，用户的内心是崩溃的，『这是什么破软件？果断弃了』。我们可怜的程序员如果知道挨骂了，也表示很无语，明明单元测试都通过了啊，覆盖率妥妥的100%有木有。。。\n\n其实呢，线上代码出Bug也是很正常的事：\n\n- 一些意想不到的边界条件（内存溢出，死循环，Null, Undefined）;\n- 代码的运行环境（各种浏览器，各种手机）千变万化;\n- 代码运行依赖的系统比如数据库(MySQL, MongoDB, Redis)偶尔抽风;\n- 峰值情况下网络超时，CPU和内存超负荷;\n- ......\n\n还有，网页应用是运行在用户的浏览器上，APP是运行在用户的手机上，所以应用出错的时候程序员是不知道的，这样的话，就无法及时解决Bug，用户体验是很不好的。\n\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/without_fundebug.jpg\" />\n</a>\n</div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n\n那么，您是否需要稳定，安全，智能的错误实时监控与纠错辅助服务？如果需要，[Fundebug](https://fundebug.com/)已经正式上线了，赶紧[免费注册](https://fundebug.com/team/create)吧!\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\" />\n</a>\n</div>\n\nFundebug, Debug with Fun! 我们致力于提供最专业的Bug实时监测服务，让Debug变得更加高效而有趣。目前我们提供JavaScript实时监测服务，您只需要添加一行代码:\n\n```\n<script src=\"https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js\" apikey=\"YOUR-API-KEY-HERE\"></script>\n```\n\n使用Fundebug，您就可以:\n\n- 邮件提醒，更及时地发现错误!\n- 智能面板，更方便地管理错误!\n- 任务分配，更高效地团队协助!\n- 错误搜索，更准确地定位错误！\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/with_fundebug.jpg\" />\n</a>\n</div>\n\n还等什么呢，赶紧为您的团队注册Fundebug帐号吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n\n\n","slug":"2016/11/fundebug-is-online","published":1,"updated":"2016-12-07T14:35:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzu00000ivfyb1ffi556","content":"<p>&#x5F53;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E86;&#x4E00;&#x4E2A;&#x53C8;&#x4E00;&#x4E2A;Bug&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x8F6E;&#x53C8;&#x4E00;&#x8F6E;&#x4EE3;&#x7801;&#x5BA1;&#x67E5;&#xFF0C;&#x4E4B;&#x540E;&#x53C8;&#x8DD1;&#x4E86;&#x4E00;&#x904D;&#x53C8;&#x4E00;&#x904D;&#x6D4B;&#x8BD5;&#xFF0C;&#x4EE3;&#x7801;&#x7EC8;&#x4E8E;&#x4E0A;&#x7EBF;&#x4E86;&#xFF01;</p>\n<a id=\"more\"></a>\n<p>&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x4E0A;&#x7EBF;&#x7684;&#x4EE3;&#x7801;&#x4E00;&#x5B9A;&#x6CA1;&#x6709;Bug&#x5417;&#xFF1F;&#x4F3C;&#x4E4E;&#x6CA1;&#x6709;&#x4EBA;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x80AF;&#x5B9A;&#x3002;</p>\n<p>&#x7528;&#x6237;&#x4F7F;&#x7528;&#x5E94;&#x7528;&#x7684;&#x753B;&#x98CE;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<ul>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6CE8;&#x518C;&#x300F;&#x6309;&#x952E;&#x70B9;&#x51FB;&#x4E86;&#x534A;&#x5929;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6FC0;&#x6D3B;&#x90AE;&#x4EF6;&#x300F;&#x4E00;&#x76F4;&#x6728;&#x6709;&#x6536;&#x5230;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x72C2;&#x6309;F5&#x65F6;&#x9875;&#x9762;&#x5E76;&#x6CA1;&#x6709;&#x66F4;&#x65B0;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;APP&#x83AB;&#x540D;&#x5176;&#x5999;&#x5730;&#x95EA;&#x9000;&#x4E86;&#xFF1F;&#xFF01;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x5185;&#x5FC3;&#x662F;&#x5D29;&#x6E83;&#x7684;&#xFF0C;&#x300E;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x7834;&#x8F6F;&#x4EF6;&#xFF1F;&#x679C;&#x65AD;&#x5F03;&#x4E86;&#x300F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x601C;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5982;&#x679C;&#x77E5;&#x9053;&#x6328;&#x9A82;&#x4E86;&#xFF0C;&#x4E5F;&#x8868;&#x793A;&#x5F88;&#x65E0;&#x8BED;&#xFF0C;&#x660E;&#x660E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x90FD;&#x901A;&#x8FC7;&#x4E86;&#x554A;&#xFF0C;&#x8986;&#x76D6;&#x7387;&#x59A5;&#x59A5;&#x7684;100%&#x6709;&#x6728;&#x6709;&#x3002;&#x3002;&#x3002;</p>\n<p>&#x5176;&#x5B9E;&#x5462;&#xFF0C;&#x7EBF;&#x4E0A;&#x4EE3;&#x7801;&#x51FA;Bug&#x4E5F;&#x662F;&#x5F88;&#x6B63;&#x5E38;&#x7684;&#x4E8B;&#xFF1A;</p>\n<ul>\n<li>&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x8FB9;&#x754C;&#x6761;&#x4EF6;&#xFF08;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;Null, Undefined&#xFF09;;</li>\n<li>&#x4EE3;&#x7801;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF08;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5404;&#x79CD;&#x624B;&#x673A;&#xFF09;&#x5343;&#x53D8;&#x4E07;&#x5316;;</li>\n<li>&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x7684;&#x7CFB;&#x7EDF;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;(MySQL, MongoDB, Redis)&#x5076;&#x5C14;&#x62BD;&#x98CE;;</li>\n<li>&#x5CF0;&#x503C;&#x60C5;&#x51B5;&#x4E0B;&#x7F51;&#x7EDC;&#x8D85;&#x65F6;&#xFF0C;CPU&#x548C;&#x5185;&#x5B58;&#x8D85;&#x8D1F;&#x8377;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD8;&#x6709;&#xFF0C;&#x7F51;&#x9875;&#x5E94;&#x7528;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#xFF0C;APP&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x7528;&#x51FA;&#x9519;&#x7684;&#x65F6;&#x5019;&#x7A0B;&#x5E8F;&#x5458;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x53CA;&#x65F6;&#x89E3;&#x51B3;Bug&#xFF0C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x5F88;&#x4E0D;&#x597D;&#x7684;&#x3002;</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/without_fundebug.jpg\"><br></a><br></div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n<p>&#x90A3;&#x4E48;&#xFF0C;&#x60A8;&#x662F;&#x5426;&#x9700;&#x8981;&#x7A33;&#x5B9A;&#xFF0C;&#x5B89;&#x5168;&#xFF0C;&#x667A;&#x80FD;&#x7684;&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x4E0E;&#x7EA0;&#x9519;&#x8F85;&#x52A9;&#x670D;&#x52A1;&#xFF1F;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5DF2;&#x7ECF;&#x6B63;&#x5F0F;&#x4E0A;&#x7EBF;&#x4E86;&#xFF0C;&#x8D76;&#x7D27;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5427;!</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\"><br><img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\"><br></a><br></div>\n\n<p>Fundebug, Debug with Fun! &#x6211;&#x4EEC;&#x81F4;&#x529B;&#x4E8E;&#x63D0;&#x4F9B;&#x6700;&#x4E13;&#x4E1A;&#x7684;Bug&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x8BA9;Debug&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x9AD8;&#x6548;&#x800C;&#x6709;&#x8DA3;&#x3002;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;JavaScript&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js&quot;</span> <span class=\"attr\">apikey</span>=<span class=\"string\">&quot;YOUR-API-KEY-HERE&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Fundebug&#xFF0C;&#x60A8;&#x5C31;&#x53EF;&#x4EE5;:</p>\n<ul>\n<li>&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#xFF0C;&#x66F4;&#x53CA;&#x65F6;&#x5730;&#x53D1;&#x73B0;&#x9519;&#x8BEF;!</li>\n<li>&#x667A;&#x80FD;&#x9762;&#x677F;&#xFF0C;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x7BA1;&#x7406;&#x9519;&#x8BEF;!</li>\n<li>&#x4EFB;&#x52A1;&#x5206;&#x914D;&#xFF0C;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x56E2;&#x961F;&#x534F;&#x52A9;!</li>\n<li>&#x9519;&#x8BEF;&#x641C;&#x7D22;&#xFF0C;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#xFF01;</li>\n</ul>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/with_fundebug.jpg\"><br></a><br></div>\n\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF0C;&#x8D76;&#x7D27;&#x4E3A;&#x60A8;&#x7684;&#x56E2;&#x961F;&#x6CE8;&#x518C;Fundebug&#x5E10;&#x53F7;&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n\n\n\n","excerpt":"<p>&#x5F53;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E86;&#x4E00;&#x4E2A;&#x53C8;&#x4E00;&#x4E2A;Bug&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x8F6E;&#x53C8;&#x4E00;&#x8F6E;&#x4EE3;&#x7801;&#x5BA1;&#x67E5;&#xFF0C;&#x4E4B;&#x540E;&#x53C8;&#x8DD1;&#x4E86;&#x4E00;&#x904D;&#x53C8;&#x4E00;&#x904D;&#x6D4B;&#x8BD5;&#xFF0C;&#x4EE3;&#x7801;&#x7EC8;&#x4E8E;&#x4E0A;&#x7EBF;&#x4E86;&#xFF01;</p>","more":"<p>&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x4E0A;&#x7EBF;&#x7684;&#x4EE3;&#x7801;&#x4E00;&#x5B9A;&#x6CA1;&#x6709;Bug&#x5417;&#xFF1F;&#x4F3C;&#x4E4E;&#x6CA1;&#x6709;&#x4EBA;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x80AF;&#x5B9A;&#x3002;</p>\n<p>&#x7528;&#x6237;&#x4F7F;&#x7528;&#x5E94;&#x7528;&#x7684;&#x753B;&#x98CE;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<ul>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6CE8;&#x518C;&#x300F;&#x6309;&#x952E;&#x70B9;&#x51FB;&#x4E86;&#x534A;&#x5929;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6FC0;&#x6D3B;&#x90AE;&#x4EF6;&#x300F;&#x4E00;&#x76F4;&#x6728;&#x6709;&#x6536;&#x5230;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x72C2;&#x6309;F5&#x65F6;&#x9875;&#x9762;&#x5E76;&#x6CA1;&#x6709;&#x66F4;&#x65B0;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;APP&#x83AB;&#x540D;&#x5176;&#x5999;&#x5730;&#x95EA;&#x9000;&#x4E86;&#xFF1F;&#xFF01;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x5185;&#x5FC3;&#x662F;&#x5D29;&#x6E83;&#x7684;&#xFF0C;&#x300E;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x7834;&#x8F6F;&#x4EF6;&#xFF1F;&#x679C;&#x65AD;&#x5F03;&#x4E86;&#x300F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x601C;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5982;&#x679C;&#x77E5;&#x9053;&#x6328;&#x9A82;&#x4E86;&#xFF0C;&#x4E5F;&#x8868;&#x793A;&#x5F88;&#x65E0;&#x8BED;&#xFF0C;&#x660E;&#x660E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x90FD;&#x901A;&#x8FC7;&#x4E86;&#x554A;&#xFF0C;&#x8986;&#x76D6;&#x7387;&#x59A5;&#x59A5;&#x7684;100%&#x6709;&#x6728;&#x6709;&#x3002;&#x3002;&#x3002;</p>\n<p>&#x5176;&#x5B9E;&#x5462;&#xFF0C;&#x7EBF;&#x4E0A;&#x4EE3;&#x7801;&#x51FA;Bug&#x4E5F;&#x662F;&#x5F88;&#x6B63;&#x5E38;&#x7684;&#x4E8B;&#xFF1A;</p>\n<ul>\n<li>&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x8FB9;&#x754C;&#x6761;&#x4EF6;&#xFF08;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;Null, Undefined&#xFF09;;</li>\n<li>&#x4EE3;&#x7801;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF08;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5404;&#x79CD;&#x624B;&#x673A;&#xFF09;&#x5343;&#x53D8;&#x4E07;&#x5316;;</li>\n<li>&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x7684;&#x7CFB;&#x7EDF;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;(MySQL, MongoDB, Redis)&#x5076;&#x5C14;&#x62BD;&#x98CE;;</li>\n<li>&#x5CF0;&#x503C;&#x60C5;&#x51B5;&#x4E0B;&#x7F51;&#x7EDC;&#x8D85;&#x65F6;&#xFF0C;CPU&#x548C;&#x5185;&#x5B58;&#x8D85;&#x8D1F;&#x8377;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD8;&#x6709;&#xFF0C;&#x7F51;&#x9875;&#x5E94;&#x7528;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#xFF0C;APP&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x7528;&#x51FA;&#x9519;&#x7684;&#x65F6;&#x5019;&#x7A0B;&#x5E8F;&#x5458;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x53CA;&#x65F6;&#x89E3;&#x51B3;Bug&#xFF0C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x5F88;&#x4E0D;&#x597D;&#x7684;&#x3002;</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/without_fundebug.jpg\"><br></a><br></div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n<p>&#x90A3;&#x4E48;&#xFF0C;&#x60A8;&#x662F;&#x5426;&#x9700;&#x8981;&#x7A33;&#x5B9A;&#xFF0C;&#x5B89;&#x5168;&#xFF0C;&#x667A;&#x80FD;&#x7684;&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x4E0E;&#x7EA0;&#x9519;&#x8F85;&#x52A9;&#x670D;&#x52A1;&#xFF1F;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;<a href=\"https://fundebug.com/\">Fundebug</a>&#x5DF2;&#x7ECF;&#x6B63;&#x5F0F;&#x4E0A;&#x7EBF;&#x4E86;&#xFF0C;&#x8D76;&#x7D27;<a href=\"https://fundebug.com/team/create\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5427;!</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\"><br><img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\"><br></a><br></div>\n\n<p>Fundebug, Debug with Fun! &#x6211;&#x4EEC;&#x81F4;&#x529B;&#x4E8E;&#x63D0;&#x4F9B;&#x6700;&#x4E13;&#x4E1A;&#x7684;Bug&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x8BA9;Debug&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x9AD8;&#x6548;&#x800C;&#x6709;&#x8DA3;&#x3002;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;JavaScript&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js&quot;</span> <span class=\"attr\">apikey</span>=<span class=\"string\">&quot;YOUR-API-KEY-HERE&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Fundebug&#xFF0C;&#x60A8;&#x5C31;&#x53EF;&#x4EE5;:</p>\n<ul>\n<li>&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#xFF0C;&#x66F4;&#x53CA;&#x65F6;&#x5730;&#x53D1;&#x73B0;&#x9519;&#x8BEF;!</li>\n<li>&#x667A;&#x80FD;&#x9762;&#x677F;&#xFF0C;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x7BA1;&#x7406;&#x9519;&#x8BEF;!</li>\n<li>&#x4EFB;&#x52A1;&#x5206;&#x914D;&#xFF0C;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x56E2;&#x961F;&#x534F;&#x52A9;!</li>\n<li>&#x9519;&#x8BEF;&#x641C;&#x7D22;&#xFF0C;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#xFF01;</li>\n</ul>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/with_fundebug.jpg\"><br></a><br></div>\n\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF0C;&#x8D76;&#x7D27;&#x4E3A;&#x60A8;&#x7684;&#x56E2;&#x961F;&#x6CE8;&#x518C;Fundebug&#x5E10;&#x53F7;&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"基于Docker搭建多节点Hadoop集群","date":"2015-06-08T04:44:40.000Z","_content":"\n**摘要:** 本文已更新，请查看: [基于Docker搭建Hadoop集群之升级版](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)!!!\n\n**GitHub地址:**\n- [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-06-08](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n\n本文介绍了基于Docker在单机上搭建多节点Hadopp集群方法，Hadoop的Master和Slave分别运行在不同容器中。\n\n可以直接进入第三部分，快速在本机搭建一个3个节点的Hadoop集群\n\n## 一. 项目简介\n\n直接用机器搭建Hadoop集群是一个相当痛苦的过程，尤其对初学者来说。他们还没开始跑wordcount，可能就被这个问题折腾的体无完肤了。\n\n我的目标是将Hadoop集群运行在Docker容器中，使Hadoop开发者能够快速便捷地在本机搭建多节点的Hadoop集群。其实这个想法已经有了不少实现，但是都不是很理想，他们或者镜像太大，或者使用太慢，或者使用了第三方工具使得使用起来过于复杂...下表为一些已知的Hadoop on Docker项目以及其存在的问题。\n\n|项目                              |镜像大小   |问题                  |\n|:--------------------------------|:--------|:---------------------|\n|sequenceiq/hadoop-docker:latest  |1.491GB  | 镜像太大，只支持单个节点 |\n|sequenceiq/hadoop-docker:2.7.0   |1.76 GB  | 同上                  |\n|sequenceiq/hadoop-docker:2.6.0   |1.624GB  | 同上                  |\n|sequenceiq/ambari:latest         |1.782GB   | 镜像太大，使用太慢     |\n|sequenceiq/ambari:2.0.0          |4.804GB   | 同上                 |\n|sequenceiq/ambari:latest:1.70    |4.761GB   | 同上                 |\n|alvinhenrick/hadoop-mutinode     |4.331GB   | 镜像太大，构建太慢，增加节点麻烦，有bug|\n\n我的项目参考了alvinhenrick/hadoop-mutinode项目，不过我做了大量的优化和重构。alvinhenrick/hadoop-mutinode项目的Github主页以及作者所写的博客地址：[GitHub](https://github.com/alvinhenrick/hadoop-mutinode)，[博客](http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/)\n\n下面两个表是alvinhenrick/hadoop-mutinode项目与我的kiwenlau/hadoop-cluster-docker项目的参数对比\n\n|镜像名称\t                    |构建时间\t      | 镜像层数  | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n|alvinhenrick/serf          | 258.213s    | 21\t     | 239.4MB |\n|alvinhenrick/hadoop-base\t| 2236.055s   | 58\t     | 4.328GB |\n|alvinhenrick/hadoop-dn\t    | 51.959s     | 74\t     | 4.331GB |\n|alvinhenrick/hadoop-nn-dn  | 49.548s     |  84      | 4.331GB |\n\n|镜像名称\t                                 |构建时间\t       | 镜像层数   | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n| kiwenlau/serf-dnsmasq          | 509.46s        |  8\t        | 206.6 MB |\n|kiwenlau/hadoop-base\t         | 400.29s\t        |  7\t        | 775.4 MB |\n|kiwenlau/hadoop-master         | 5.41s            |  9\t        | 775.4 MB |\n|kiwenlau/hadoop-slave\t         | 2.41s\t        |  8 \t        | 775.4 MB |\n\n可知，我主要优化了这样几点\n- 更小的镜像大小\n- 更快的构造时间\n- 更少的镜像层数\n\n#### **更快更方便地改变Hadoop集群节点数目**\n\n另外，alvinhenrick/hadoop-mutinode项目增加节点时需要手动修改Hadoop配置文件然后重新构建hadoop-nn-dn镜像,然后修改容器启动脚本，才能实现增加节点的功能。而我通过shell脚本实现自动话，不到1分钟可以重新构建hadoop-master镜像，然后立即运行！！！本项目默认启动3个节点的Hadoop集群，支持任意节点数的hadoop集群。\n\n另外，启动hadoop, 运行wordcount以及重新构建镜像都采用了shell脚本实现自动化。这样使得整个项目的使用以及开发都变得非常方便快捷:)\n\n#### **开发测试环境**\n\n- 操作系统：ubuntu 14.04 和 ubuntu 12.04\n- 内核版本: 3.13.0-32-generic\n- Docker版本：1.5.0 和1.6.2\n\n#### **硬盘不够，内存不够，尤其是内核版本过低会导致运行失败:(**\n\n## 二. 镜像简介\n\n#### **本项目一共开发了4个镜像**\n\n- serf-dnsmasq\n- hadoop-base\n- hadoop-master\n- hadoop-slave\n\n#### **serf-dnsmasq镜像**\n\n- 基于ubuntu:15.04 (选它是因为它最小，不是因为它最新...)\n- 安装serf: serf是一个分布式的机器节点管理工具。它可以动态地发现所有hadoop集群节点。\n- 安装dnsmasq: dnsmasq作为轻量级的dns服务器。它可以为hadoop集群提供域名解析服务。\n\n容器启动时，master节点的IP会传给所有slave节点。serf会在container启动后立即启动。slave节点上的serf agent会马上发现master节点（master IP它们都知道嘛），master节点就马上发现了所有slave节点。然后它们之间通过互相交换信息，所有节点就能知道其他所有节点的存在了！(Everyone will know Everyone). serf发现新的节点时，就会重新配置dnsmasq,然后重启dnsmasq. 所以dnsmasq就能够解析集群的所有节点的域名啦。这个过程随着节点的增加会耗时更久，因此，若配置的Hadoop节点比较多，则在启动容器后需要测试serf是否发现了所有节点，dns是否能够解析所有节点域名。稍等片刻才能启动Hadoop。这个解决方案是由SequenceIQ公司提出的，该公司专注于将Hadoop运行在Docker中。请参考这个PPT：[Docker-based Hadoop Provisioning](http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning)\n\n#### **hadoop-base镜像**\n\n- 基于serf-dnsmasq镜像\n- 安装JDK(openjdk)\n- 安装openssh-server, 配置无密码ssh\n- 安装vim：介样就可以愉快地在容器中敲代码了:)\n- 安装Hadoop 2.3.0: 安装编译过的hadoop （2.5.2， 2.6.0， 2.7.0 都比2.3.0大，所以我懒得升级了）\n\n编译Hadoop的步骤请参考我的博客：[[Hadoop 2.30 在Ubuntu 14.04 中编译](http://www.cnblogs.com/kiwenlau/p/4227204.html)](http://www.cnblogs.com/kiwenlau/p/4227204.html)\n\n如果需要重新开发我的hadoop-base, 需要下载编译过的hadoop-2.3.0安装包，放到hadoop-cluster-docker/hadoop-base/files目录内。我编译的64位hadoop-2.3.0下载地址：[hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n\n另外，我还编译了64位的hadoop 2.5.2, 2.6.0, 2.7.0, 其下载地址如下：\n\n- [hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n- [hadoop-2.5.2](http://pan.baidu.com/s/1jGw24aa)\n- [hadoop-2.6.0](http://pan.baidu.com/s/1eQgvF2M)\n- [hadoop-2.7.0]( http://pan.baidu.com/s/1c0HD0Nu)\n\n#### **hadoop-master镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的master节点\n- 格式化namenode\n\n这一步需要配置slaves文件，而slaves文件需要列出所有节点的域名或者IP。因此，Hadoop节点数目不同时，slaves文件自然也不一样。因此，更改Hadoop集群节点数目时，需要修改slaves文件然后重新构建hadoop-master镜像。我编写了一个resize-cluster.sh脚本自动化这一过程。仅需给定节点数目作为脚本参数就可以轻松实现Hadoop集群节点数目的更改。由于hadoop-master镜像仅仅做一些配置工作，也无需下载任何文件，整个过程非常快，1分钟就足够了。\n\n#### **hadoop-slave镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的slave节点\n\n#### **镜像大小分析**\n\n下表为sudo docker images的运行结果\n\n|REPOSITORY       |   TAG    |  IMAGE ID       | CREATED     |   VIRTUAL SIZE |\n| ------------- | ------- | ---------- | ---------- | ------- |\n|index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0|    d63869855c03 |   17 hours ago  |  777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master|    0.1.0   | 7c9d32ede450  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   | 5571bd5de58e    |17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/serf-dnsmasq  |  0.1.0    |09ed89c24ee8   | 17 hours ago  |  206.7 MB |\n|ubuntu     |                               15.04   | bd94ae587483  |  3 weeks ago    |131.3 MB |\n\n\n易知以下几个结论：\n- serf-dnsmasq镜像在ubuntu:15.04镜像的基础上增加了75.4MB\n- hadoop-base镜像在serf-dnsmasq镜像的基础上增加了570.7MB\n- hadoop-master和hadoop-slave镜像在hadoop-base镜像的基础上大小几乎没有增加\n\n下表为docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0命令的部分运行结果\n\n|IMAGE      |    CREATED        |    CREATED BY         |                             SIZE\n |  -----  | ---------------  | ---------------  |  -----------  | \n|2039b9b81146 |   44 hours ago   |       /bin/sh -c #(nop) ADD   multi:a93c971a49514e787  |  158.5 MB | \n | cdb620312f30    |  44 hours ago   |       /bin/sh -c apt-get install -y openjdk-7-jdk    |  324.6 MB  | \n | da7d10c790c1   |   44 hours ago      |    /bin/sh -c apt-get install -y openssh-server   |   87.58 MB  | \n |  c65cb568defc    |  44 hours ago     |     /bin/sh -c curl -Lso serf.zip https://dl.bint  |  14.46 MB  | \n | 3e22b3d72e33     | 44 hours ago       |   /bin/sh -c apt-get update && apt-get install     |  60.89 MB   | \n |  b68f8c8d2140    |  3 weeks ago     |     /bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3  |   131.3 MB  | \n\n可知\n- 基础镜像ubuntu:15.04为131.3MB\n- 安装openjdk需要324.6MB\n- 安装hadoop需要158.5MB\n- ubuntu,openjdk与hadoop均为镜像所必须，三者一共占了:614.4MB\n\n#### **因此，我所开发的hadoop镜像以及接近最小，优化空间已经很小了**\n\n下图显示了项目的Docker镜像结构：\n\n<img src=\"150608-hadoop-cluster-docker/image-architecture.png\" width = \"500\"/>\n\n## 三. 3节点Hadoop集群搭建步骤\n\n#### 1. **拉取镜像**\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0\n```\n\n- 3~5分钟OK~\n\n*查看下载的镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n|REPOSITORY    |    TAG  |    IMAGE ID      |  CREATED  |      VIRTUAL SIZE |\n |  ----------  |  -----------  |  ---------  |   --------  |  \n| index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0    |d63869855c03  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master   |   0.1.0 |     7c9d32ede450   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base |       0.1.0     | 5571bd5de58e   |   17 hours ago  |    777.4 MB | \n |  index.alauda.cn/kiwenlau/serf-dnsmasq   |   0.1.0   |   09ed89c24ee8     | 17 hours ago     |  206.7 MB | \n\n- hadoop-base镜像是基于serf-dnsmasq镜像的，hadoop-slave镜像和hadoop-master镜像都是基于hadoop-base镜像\n- 所以其实4个镜像一共也就777.4MB:)\n\n#### **2. 修改镜像tag**\n\n```sh\nsudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0\nsudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0\nsudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0\nsudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0\n```\n\n*查看修改tag后镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n| REPOSITORY   |   TAG   |    IMAGE ID    |    CREATED    |      VIRTUAL SIZE  | \n |  ----------  |  -----  |  ---------  |  ----------  |  -----------  | \n| index.alauda.cn/kiwenlau/hadoop-slave  |    0.1.0   |   d63869855c03    |  17 hours ago   |   777.4 MB\n | kiwenlau/hadoop-slave    |                  0.1.0   |   d63869855c03   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-master  |  0.1.0 |     7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-master  |                  0.1.0   |   7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-base   |                   0.1.0  |    5571bd5de58e  |    17 hours ago   |   777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   |   5571bd5de58e   |   17 hours ago |     777.4 MB | \n | kiwenlau/serf-dnsmasq          |            0.1.0    |  09ed89c24ee8  |    17 hours ago    |  206.7 MB | \n | index.alauda.cn/kiwenlau/serf-dnsmasq  |    0.1.0   |   09ed89c24ee8     | 17 hours ago   |   206.7 MB | \n\n- 之所以要修改镜像，是因为我默认是将镜像上传到Dockerhub, 因此Dokerfile以及shell脚本中得镜像名称都是没有alauada前缀的，sorry for this....不过改tag还是很快滴\n- 若直接下载我在DockerHub中的镜像，自然就不需要修改tag...不过Alauda镜像下载速度很快的哈~\n\n#### **3.下载源代码**\n\n```sh\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n- 为了防止Github被XX, 我把代码导入到了开源中国的git仓库\n\n```sh\ngit clone http://git.oschina.net/kiwenlau/hadoop-cluster-docker\n```\n\n#### **4. 运行容器**\n\n```sh\ncd hadoop-cluster-docker\n./start-container.sh\n\n```\n\n*运行结果*\n\n```bash\nstart master container...\nstart slave1 container...\nstart slave2 container...\nroot@master:~#\n```\n\n- 一共开启了3个容器，1个master, 2个slave\n- 开启容器后就进入了master容器root用户的家目录（/root）\n\n*查看master的root用户家目录的文件*\n\n```sh\nls\n```\n\n*运行结果*\n\n```plain\nhdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh\n```\n\n- start-hadoop.sh是开启hadoop的shell脚本\n- run-wordcount.sh是运行wordcount的shell脚本，可以测试镜像是否正常工作\n\n#### **5.测试容器是否正常启动(此时已进入master容器)**\n\n*查看hadoop集群成员*\n\n```sh\nserf members\n```\n\n*运行结果*\n\n```bash\nmaster.kiwenlau.com  172.17.0.65:7946  alive\nslave1.kiwenlau.com  172.17.0.66:7946  alive\nslave2.kiwenlau.com  172.17.0.67:7946  alive\n```\n\n- 若结果缺少节点，可以稍等片刻，再执行“serf members”命令。因为serf agent需要时间发现所有节点。\n\n*测试ssh*\n\n```sh\nssh slave2.kiwenlau.com\n```\n\n*运行结果*\n\n```bash\nWarning: Permanently added 'slave2.kiwenlau.com,172.17.0.67' (ECDSA) to the list of known hosts.\nWelcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)\n* Documentation:  https://help.ubuntu.com/\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\nroot@slave2:~#\n```\n\n*退出slave2*\n\n```sh\nexit\n```\n\n*运行结果*\n\n```bash\nlogout\nConnection to slave2.kiwenlau.com closed.\n```\n\n- 若ssh失败，请稍等片刻再测试，因为dnsmasq的dns服务器启动需要时间。\n- 测试成功后，就可以开启Hadoop集群了！其实你也可以不进行测试，开启容器后耐心等待一分钟即可！\n\n#### **6. 开启hadoop**\n\n```sh\n./start-hadoop.sh\n```\n\n- 上一步ssh到slave2之后，请记得回到master啊!!！\n- 运行结果太多，忽略....\n- hadoop的启动速度取决于机器性能....\n\n#### **7. 运行wordcount**\n\n```sh\n./run-wordcount.sh\n```\n\n*运行结果*\n```bash\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\n- wordcount的执行速度取决于机器性能....\n\n## 四. N节点Hadoop集群搭建步骤\n\n#### **1. 准备工作**\n\n- 参考第二部分1~3：下载镜像，修改tag，下载源代码\n- 注意，你可以不下载serf-dnsmasq, 但是请最好下载hadoop-base，因为hadoop-master是基于hadoop-base构建的\n\n#### **2. 重新构建hadoop-master镜像**\n\n```sh\n./resize-cluster.sh 5\n```\n\n- 不要担心，1分钟就能搞定\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n\n#### **3. 启动容器**\n\n```sh\n./start-container.sh 5\n```\n\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n- 这个参数呢，最好还是得和上一步的参数一致:)\n- 这个参数如果比上一步的参数大，你多启动的节点，Hadoop不认识它们..\n- 这个参数如果比上一步的参数小，Hadoop觉得少启动的节点挂掉了..\n\n#### **4. 测试工作**\n\n- 参考第三部分5~7：测试容器，开启Hadoop，运行wordcount\n- 请注意，若节点增加，请务必先测试容器，然后再开启Hadoop, 因为serf可能还没有发现所有节点，而dnsmasq的DNS服务器表示还没有配置好服务\n- 测试等待时间取决于机器性能....\n\n","source":"_posts/2015/06/08/150608-hadoop-cluster-docker.md","raw":"title: 基于Docker搭建多节点Hadoop集群\n\ndate: 2015-06-08 12:44:40\n\ntags: [Hadoop, Docker]\n\n---\n\n**摘要:** 本文已更新，请查看: [基于Docker搭建Hadoop集群之升级版](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)!!!\n\n**GitHub地址:**\n- [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-06-08](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n\n本文介绍了基于Docker在单机上搭建多节点Hadopp集群方法，Hadoop的Master和Slave分别运行在不同容器中。\n\n可以直接进入第三部分，快速在本机搭建一个3个节点的Hadoop集群\n\n## 一. 项目简介\n\n直接用机器搭建Hadoop集群是一个相当痛苦的过程，尤其对初学者来说。他们还没开始跑wordcount，可能就被这个问题折腾的体无完肤了。\n\n我的目标是将Hadoop集群运行在Docker容器中，使Hadoop开发者能够快速便捷地在本机搭建多节点的Hadoop集群。其实这个想法已经有了不少实现，但是都不是很理想，他们或者镜像太大，或者使用太慢，或者使用了第三方工具使得使用起来过于复杂...下表为一些已知的Hadoop on Docker项目以及其存在的问题。\n\n|项目                              |镜像大小   |问题                  |\n|:--------------------------------|:--------|:---------------------|\n|sequenceiq/hadoop-docker:latest  |1.491GB  | 镜像太大，只支持单个节点 |\n|sequenceiq/hadoop-docker:2.7.0   |1.76 GB  | 同上                  |\n|sequenceiq/hadoop-docker:2.6.0   |1.624GB  | 同上                  |\n|sequenceiq/ambari:latest         |1.782GB   | 镜像太大，使用太慢     |\n|sequenceiq/ambari:2.0.0          |4.804GB   | 同上                 |\n|sequenceiq/ambari:latest:1.70    |4.761GB   | 同上                 |\n|alvinhenrick/hadoop-mutinode     |4.331GB   | 镜像太大，构建太慢，增加节点麻烦，有bug|\n\n我的项目参考了alvinhenrick/hadoop-mutinode项目，不过我做了大量的优化和重构。alvinhenrick/hadoop-mutinode项目的Github主页以及作者所写的博客地址：[GitHub](https://github.com/alvinhenrick/hadoop-mutinode)，[博客](http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/)\n\n下面两个表是alvinhenrick/hadoop-mutinode项目与我的kiwenlau/hadoop-cluster-docker项目的参数对比\n\n|镜像名称\t                    |构建时间\t      | 镜像层数  | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n|alvinhenrick/serf          | 258.213s    | 21\t     | 239.4MB |\n|alvinhenrick/hadoop-base\t| 2236.055s   | 58\t     | 4.328GB |\n|alvinhenrick/hadoop-dn\t    | 51.959s     | 74\t     | 4.331GB |\n|alvinhenrick/hadoop-nn-dn  | 49.548s     |  84      | 4.331GB |\n\n|镜像名称\t                                 |构建时间\t       | 镜像层数   | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n| kiwenlau/serf-dnsmasq          | 509.46s        |  8\t        | 206.6 MB |\n|kiwenlau/hadoop-base\t         | 400.29s\t        |  7\t        | 775.4 MB |\n|kiwenlau/hadoop-master         | 5.41s            |  9\t        | 775.4 MB |\n|kiwenlau/hadoop-slave\t         | 2.41s\t        |  8 \t        | 775.4 MB |\n\n可知，我主要优化了这样几点\n- 更小的镜像大小\n- 更快的构造时间\n- 更少的镜像层数\n\n#### **更快更方便地改变Hadoop集群节点数目**\n\n另外，alvinhenrick/hadoop-mutinode项目增加节点时需要手动修改Hadoop配置文件然后重新构建hadoop-nn-dn镜像,然后修改容器启动脚本，才能实现增加节点的功能。而我通过shell脚本实现自动话，不到1分钟可以重新构建hadoop-master镜像，然后立即运行！！！本项目默认启动3个节点的Hadoop集群，支持任意节点数的hadoop集群。\n\n另外，启动hadoop, 运行wordcount以及重新构建镜像都采用了shell脚本实现自动化。这样使得整个项目的使用以及开发都变得非常方便快捷:)\n\n#### **开发测试环境**\n\n- 操作系统：ubuntu 14.04 和 ubuntu 12.04\n- 内核版本: 3.13.0-32-generic\n- Docker版本：1.5.0 和1.6.2\n\n#### **硬盘不够，内存不够，尤其是内核版本过低会导致运行失败:(**\n\n## 二. 镜像简介\n\n#### **本项目一共开发了4个镜像**\n\n- serf-dnsmasq\n- hadoop-base\n- hadoop-master\n- hadoop-slave\n\n#### **serf-dnsmasq镜像**\n\n- 基于ubuntu:15.04 (选它是因为它最小，不是因为它最新...)\n- 安装serf: serf是一个分布式的机器节点管理工具。它可以动态地发现所有hadoop集群节点。\n- 安装dnsmasq: dnsmasq作为轻量级的dns服务器。它可以为hadoop集群提供域名解析服务。\n\n容器启动时，master节点的IP会传给所有slave节点。serf会在container启动后立即启动。slave节点上的serf agent会马上发现master节点（master IP它们都知道嘛），master节点就马上发现了所有slave节点。然后它们之间通过互相交换信息，所有节点就能知道其他所有节点的存在了！(Everyone will know Everyone). serf发现新的节点时，就会重新配置dnsmasq,然后重启dnsmasq. 所以dnsmasq就能够解析集群的所有节点的域名啦。这个过程随着节点的增加会耗时更久，因此，若配置的Hadoop节点比较多，则在启动容器后需要测试serf是否发现了所有节点，dns是否能够解析所有节点域名。稍等片刻才能启动Hadoop。这个解决方案是由SequenceIQ公司提出的，该公司专注于将Hadoop运行在Docker中。请参考这个PPT：[Docker-based Hadoop Provisioning](http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning)\n\n#### **hadoop-base镜像**\n\n- 基于serf-dnsmasq镜像\n- 安装JDK(openjdk)\n- 安装openssh-server, 配置无密码ssh\n- 安装vim：介样就可以愉快地在容器中敲代码了:)\n- 安装Hadoop 2.3.0: 安装编译过的hadoop （2.5.2， 2.6.0， 2.7.0 都比2.3.0大，所以我懒得升级了）\n\n编译Hadoop的步骤请参考我的博客：[[Hadoop 2.30 在Ubuntu 14.04 中编译](http://www.cnblogs.com/kiwenlau/p/4227204.html)](http://www.cnblogs.com/kiwenlau/p/4227204.html)\n\n如果需要重新开发我的hadoop-base, 需要下载编译过的hadoop-2.3.0安装包，放到hadoop-cluster-docker/hadoop-base/files目录内。我编译的64位hadoop-2.3.0下载地址：[hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n\n另外，我还编译了64位的hadoop 2.5.2, 2.6.0, 2.7.0, 其下载地址如下：\n\n- [hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n- [hadoop-2.5.2](http://pan.baidu.com/s/1jGw24aa)\n- [hadoop-2.6.0](http://pan.baidu.com/s/1eQgvF2M)\n- [hadoop-2.7.0]( http://pan.baidu.com/s/1c0HD0Nu)\n\n#### **hadoop-master镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的master节点\n- 格式化namenode\n\n这一步需要配置slaves文件，而slaves文件需要列出所有节点的域名或者IP。因此，Hadoop节点数目不同时，slaves文件自然也不一样。因此，更改Hadoop集群节点数目时，需要修改slaves文件然后重新构建hadoop-master镜像。我编写了一个resize-cluster.sh脚本自动化这一过程。仅需给定节点数目作为脚本参数就可以轻松实现Hadoop集群节点数目的更改。由于hadoop-master镜像仅仅做一些配置工作，也无需下载任何文件，整个过程非常快，1分钟就足够了。\n\n#### **hadoop-slave镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的slave节点\n\n#### **镜像大小分析**\n\n下表为sudo docker images的运行结果\n\n|REPOSITORY       |   TAG    |  IMAGE ID       | CREATED     |   VIRTUAL SIZE |\n| ------------- | ------- | ---------- | ---------- | ------- |\n|index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0|    d63869855c03 |   17 hours ago  |  777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master|    0.1.0   | 7c9d32ede450  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   | 5571bd5de58e    |17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/serf-dnsmasq  |  0.1.0    |09ed89c24ee8   | 17 hours ago  |  206.7 MB |\n|ubuntu     |                               15.04   | bd94ae587483  |  3 weeks ago    |131.3 MB |\n\n\n易知以下几个结论：\n- serf-dnsmasq镜像在ubuntu:15.04镜像的基础上增加了75.4MB\n- hadoop-base镜像在serf-dnsmasq镜像的基础上增加了570.7MB\n- hadoop-master和hadoop-slave镜像在hadoop-base镜像的基础上大小几乎没有增加\n\n下表为docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0命令的部分运行结果\n\n|IMAGE      |    CREATED        |    CREATED BY         |                             SIZE\n |  -----  | ---------------  | ---------------  |  -----------  | \n|2039b9b81146 |   44 hours ago   |       /bin/sh -c #(nop) ADD   multi:a93c971a49514e787  |  158.5 MB | \n | cdb620312f30    |  44 hours ago   |       /bin/sh -c apt-get install -y openjdk-7-jdk    |  324.6 MB  | \n | da7d10c790c1   |   44 hours ago      |    /bin/sh -c apt-get install -y openssh-server   |   87.58 MB  | \n |  c65cb568defc    |  44 hours ago     |     /bin/sh -c curl -Lso serf.zip https://dl.bint  |  14.46 MB  | \n | 3e22b3d72e33     | 44 hours ago       |   /bin/sh -c apt-get update && apt-get install     |  60.89 MB   | \n |  b68f8c8d2140    |  3 weeks ago     |     /bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3  |   131.3 MB  | \n\n可知\n- 基础镜像ubuntu:15.04为131.3MB\n- 安装openjdk需要324.6MB\n- 安装hadoop需要158.5MB\n- ubuntu,openjdk与hadoop均为镜像所必须，三者一共占了:614.4MB\n\n#### **因此，我所开发的hadoop镜像以及接近最小，优化空间已经很小了**\n\n下图显示了项目的Docker镜像结构：\n\n<img src=\"150608-hadoop-cluster-docker/image-architecture.png\" width = \"500\"/>\n\n## 三. 3节点Hadoop集群搭建步骤\n\n#### 1. **拉取镜像**\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0\n```\n\n- 3~5分钟OK~\n\n*查看下载的镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n|REPOSITORY    |    TAG  |    IMAGE ID      |  CREATED  |      VIRTUAL SIZE |\n |  ----------  |  -----------  |  ---------  |   --------  |  \n| index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0    |d63869855c03  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master   |   0.1.0 |     7c9d32ede450   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base |       0.1.0     | 5571bd5de58e   |   17 hours ago  |    777.4 MB | \n |  index.alauda.cn/kiwenlau/serf-dnsmasq   |   0.1.0   |   09ed89c24ee8     | 17 hours ago     |  206.7 MB | \n\n- hadoop-base镜像是基于serf-dnsmasq镜像的，hadoop-slave镜像和hadoop-master镜像都是基于hadoop-base镜像\n- 所以其实4个镜像一共也就777.4MB:)\n\n#### **2. 修改镜像tag**\n\n```sh\nsudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0\nsudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0\nsudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0\nsudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0\n```\n\n*查看修改tag后镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n| REPOSITORY   |   TAG   |    IMAGE ID    |    CREATED    |      VIRTUAL SIZE  | \n |  ----------  |  -----  |  ---------  |  ----------  |  -----------  | \n| index.alauda.cn/kiwenlau/hadoop-slave  |    0.1.0   |   d63869855c03    |  17 hours ago   |   777.4 MB\n | kiwenlau/hadoop-slave    |                  0.1.0   |   d63869855c03   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-master  |  0.1.0 |     7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-master  |                  0.1.0   |   7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-base   |                   0.1.0  |    5571bd5de58e  |    17 hours ago   |   777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   |   5571bd5de58e   |   17 hours ago |     777.4 MB | \n | kiwenlau/serf-dnsmasq          |            0.1.0    |  09ed89c24ee8  |    17 hours ago    |  206.7 MB | \n | index.alauda.cn/kiwenlau/serf-dnsmasq  |    0.1.0   |   09ed89c24ee8     | 17 hours ago   |   206.7 MB | \n\n- 之所以要修改镜像，是因为我默认是将镜像上传到Dockerhub, 因此Dokerfile以及shell脚本中得镜像名称都是没有alauada前缀的，sorry for this....不过改tag还是很快滴\n- 若直接下载我在DockerHub中的镜像，自然就不需要修改tag...不过Alauda镜像下载速度很快的哈~\n\n#### **3.下载源代码**\n\n```sh\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n- 为了防止Github被XX, 我把代码导入到了开源中国的git仓库\n\n```sh\ngit clone http://git.oschina.net/kiwenlau/hadoop-cluster-docker\n```\n\n#### **4. 运行容器**\n\n```sh\ncd hadoop-cluster-docker\n./start-container.sh\n\n```\n\n*运行结果*\n\n```bash\nstart master container...\nstart slave1 container...\nstart slave2 container...\nroot@master:~#\n```\n\n- 一共开启了3个容器，1个master, 2个slave\n- 开启容器后就进入了master容器root用户的家目录（/root）\n\n*查看master的root用户家目录的文件*\n\n```sh\nls\n```\n\n*运行结果*\n\n```plain\nhdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh\n```\n\n- start-hadoop.sh是开启hadoop的shell脚本\n- run-wordcount.sh是运行wordcount的shell脚本，可以测试镜像是否正常工作\n\n#### **5.测试容器是否正常启动(此时已进入master容器)**\n\n*查看hadoop集群成员*\n\n```sh\nserf members\n```\n\n*运行结果*\n\n```bash\nmaster.kiwenlau.com  172.17.0.65:7946  alive\nslave1.kiwenlau.com  172.17.0.66:7946  alive\nslave2.kiwenlau.com  172.17.0.67:7946  alive\n```\n\n- 若结果缺少节点，可以稍等片刻，再执行“serf members”命令。因为serf agent需要时间发现所有节点。\n\n*测试ssh*\n\n```sh\nssh slave2.kiwenlau.com\n```\n\n*运行结果*\n\n```bash\nWarning: Permanently added 'slave2.kiwenlau.com,172.17.0.67' (ECDSA) to the list of known hosts.\nWelcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)\n* Documentation:  https://help.ubuntu.com/\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\nroot@slave2:~#\n```\n\n*退出slave2*\n\n```sh\nexit\n```\n\n*运行结果*\n\n```bash\nlogout\nConnection to slave2.kiwenlau.com closed.\n```\n\n- 若ssh失败，请稍等片刻再测试，因为dnsmasq的dns服务器启动需要时间。\n- 测试成功后，就可以开启Hadoop集群了！其实你也可以不进行测试，开启容器后耐心等待一分钟即可！\n\n#### **6. 开启hadoop**\n\n```sh\n./start-hadoop.sh\n```\n\n- 上一步ssh到slave2之后，请记得回到master啊!!！\n- 运行结果太多，忽略....\n- hadoop的启动速度取决于机器性能....\n\n#### **7. 运行wordcount**\n\n```sh\n./run-wordcount.sh\n```\n\n*运行结果*\n```bash\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\n- wordcount的执行速度取决于机器性能....\n\n## 四. N节点Hadoop集群搭建步骤\n\n#### **1. 准备工作**\n\n- 参考第二部分1~3：下载镜像，修改tag，下载源代码\n- 注意，你可以不下载serf-dnsmasq, 但是请最好下载hadoop-base，因为hadoop-master是基于hadoop-base构建的\n\n#### **2. 重新构建hadoop-master镜像**\n\n```sh\n./resize-cluster.sh 5\n```\n\n- 不要担心，1分钟就能搞定\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n\n#### **3. 启动容器**\n\n```sh\n./start-container.sh 5\n```\n\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n- 这个参数呢，最好还是得和上一步的参数一致:)\n- 这个参数如果比上一步的参数大，你多启动的节点，Hadoop不认识它们..\n- 这个参数如果比上一步的参数小，Hadoop觉得少启动的节点挂掉了..\n\n#### **4. 测试工作**\n\n- 参考第三部分5~7：测试容器，开启Hadoop，运行wordcount\n- 请注意，若节点增加，请务必先测试容器，然后再开启Hadoop, 因为serf可能还没有发现所有节点，而dnsmasq的DNS服务器表示还没有配置好服务\n- 测试等待时间取决于机器性能....\n\n","slug":"2015/06/08/150608-hadoop-cluster-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzuw0003ivfywr408ev1","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x5DF2;&#x66F4;&#x65B0;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x4E4B;&#x5347;&#x7EA7;&#x7248;</a>!!!</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">2015-06-08</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x5728;&#x5355;&#x673A;&#x4E0A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadopp&#x96C6;&#x7FA4;&#x65B9;&#x6CD5;&#xFF0C;Hadoop&#x7684;Master&#x548C;Slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#xFF0C;&#x5FEB;&#x901F;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;</p>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;</h2><p>&#x76F4;&#x63A5;&#x7528;&#x673A;&#x5668;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5F53;&#x75DB;&#x82E6;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C24;&#x5176;&#x5BF9;&#x521D;&#x5B66;&#x8005;&#x6765;&#x8BF4;&#x3002;&#x4ED6;&#x4EEC;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;&#x8DD1;wordcount&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x88AB;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6298;&#x817E;&#x7684;&#x4F53;&#x65E0;&#x5B8C;&#x80A4;&#x4E86;&#x3002;</p>\n<p>&#x6211;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5C06;Hadoop&#x96C6;&#x7FA4;&#x8FD0;&#x884C;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x4F7F;Hadoop&#x5F00;&#x53D1;&#x8005;&#x80FD;&#x591F;&#x5FEB;&#x901F;&#x4FBF;&#x6377;&#x5730;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E0D;&#x5C11;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x7406;&#x60F3;&#xFF0C;&#x4ED6;&#x4EEC;&#x6216;&#x8005;&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x592A;&#x6162;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E86;&#x7B2C;&#x4E09;&#x65B9;&#x5DE5;&#x5177;&#x4F7F;&#x5F97;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#x2026;&#x4E0B;&#x8868;&#x4E3A;&#x4E00;&#x4E9B;&#x5DF2;&#x77E5;&#x7684;Hadoop on Docker&#x9879;&#x76EE;&#x4EE5;&#x53CA;&#x5176;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x9879;&#x76EE;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n<th style=\"text-align:left\">&#x95EE;&#x9898;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:latest</td>\n<td style=\"text-align:left\">1.491GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x53EA;&#x652F;&#x6301;&#x5355;&#x4E2A;&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.7.0</td>\n<td style=\"text-align:left\">1.76 GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.6.0</td>\n<td style=\"text-align:left\">1.624GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest</td>\n<td style=\"text-align:left\">1.782GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x4F7F;&#x7528;&#x592A;&#x6162;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:2.0.0</td>\n<td style=\"text-align:left\">4.804GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest:1.70</td>\n<td style=\"text-align:left\">4.761GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-mutinode</td>\n<td style=\"text-align:left\">4.331GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6784;&#x5EFA;&#x592A;&#x6162;&#xFF0C;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x6709;bug</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6211;&#x7684;&#x9879;&#x76EE;&#x53C2;&#x8003;&#x4E86;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x505A;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x548C;&#x91CD;&#x6784;&#x3002;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x7684;Github&#x4E3B;&#x9875;&#x4EE5;&#x53CA;&#x4F5C;&#x8005;&#x6240;&#x5199;&#x7684;&#x535A;&#x5BA2;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/alvinhenrick/hadoop-mutinode\" target=\"_blank\" rel=\"external\">GitHub</a>&#xFF0C;<a href=\"http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/\" target=\"_blank\" rel=\"external\">&#x535A;&#x5BA2;</a></p>\n<p>&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x8868;&#x662F;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x4E0E;&#x6211;&#x7684;kiwenlau/hadoop-cluster-docker&#x9879;&#x76EE;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x6BD4;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/serf</td>\n<td style=\"text-align:left\">258.213s</td>\n<td style=\"text-align:left\">21</td>\n<td style=\"text-align:left\">239.4MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-base</td>\n<td style=\"text-align:left\">2236.055s</td>\n<td style=\"text-align:left\">58</td>\n<td style=\"text-align:left\">4.328GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-dn</td>\n<td style=\"text-align:left\">51.959s</td>\n<td style=\"text-align:left\">74</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-nn-dn</td>\n<td style=\"text-align:left\">49.548s</td>\n<td style=\"text-align:left\">84</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">kiwenlau/serf-dnsmasq</td>\n<td style=\"text-align:left\">509.46s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">206.6 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-base</td>\n<td style=\"text-align:left\">400.29s</td>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-master</td>\n<td style=\"text-align:left\">5.41s</td>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-slave</td>\n<td style=\"text-align:left\">2.41s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E3B;&#x8981;&#x4F18;&#x5316;&#x4E86;&#x8FD9;&#x6837;&#x51E0;&#x70B9;</p>\n<ul>\n<li>&#x66F4;&#x5C0F;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;</li>\n<li>&#x66F4;&#x5FEB;&#x7684;&#x6784;&#x9020;&#x65F6;&#x95F4;</li>\n<li>&#x66F4;&#x5C11;&#x7684;&#x955C;&#x50CF;&#x5C42;&#x6570;</li>\n</ul>\n<h4 id=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"><a href=\"#&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\" class=\"headerlink\" title=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"></a><strong>&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;</strong></h4><p>&#x53E6;&#x5916;&#xFF0C;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x65F6;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4FEE;&#x6539;Hadoop&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-nn-dn&#x955C;&#x50CF;,&#x7136;&#x540E;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x811A;&#x672C;&#xFF0C;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x7684;&#x529F;&#x80FD;&#x3002;&#x800C;&#x6211;&#x901A;&#x8FC7;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x8BDD;&#xFF0C;&#x4E0D;&#x5230;1&#x5206;&#x949F;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#xFF01;&#xFF01;&#xFF01;&#x672C;&#x9879;&#x76EE;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x652F;&#x6301;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6570;&#x7684;hadoop&#x96C6;&#x7FA4;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x542F;&#x52A8;hadoop, &#x8FD0;&#x884C;wordcount&#x4EE5;&#x53CA;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x90FD;&#x91C7;&#x7528;&#x4E86;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x8FD9;&#x6837;&#x4F7F;&#x5F97;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x4F7F;&#x7528;&#x4EE5;&#x53CA;&#x5F00;&#x53D1;&#x90FD;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;:)</p>\n<h4 id=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"><a href=\"#&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"></a><strong>&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;</strong></h4><ul>\n<li>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF1A;ubuntu 14.04 &#x548C; ubuntu 12.04</li>\n<li>&#x5185;&#x6838;&#x7248;&#x672C;: 3.13.0-32-generic</li>\n<li>Docker&#x7248;&#x672C;&#xFF1A;1.5.0 &#x548C;1.6.2</li>\n</ul>\n<h4 id=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\"><a href=\"#&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\" class=\"headerlink\" title=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(\"></a><strong>&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(</strong></h4><h2 id=\"&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><h4 id=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"><a href=\"#&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"></a><strong>&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;</strong></h4><ul>\n<li>serf-dnsmasq</li>\n<li>hadoop-base</li>\n<li>hadoop-master</li>\n<li>hadoop-slave</li>\n</ul>\n<h4 id=\"serf-dnsmasq&#x955C;&#x50CF;\"><a href=\"#serf-dnsmasq&#x955C;&#x50CF;\" class=\"headerlink\" title=\"serf-dnsmasq&#x955C;&#x50CF;\"></a><strong>serf-dnsmasq&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;ubuntu:15.04 (&#x9009;&#x5B83;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x5C0F;&#xFF0C;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x65B0;&#x2026;)</li>\n<li>&#x5B89;&#x88C5;serf: serf&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x5730;&#x53D1;&#x73B0;&#x6240;&#x6709;hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x3002;</li>\n<li>&#x5B89;&#x88C5;dnsmasq: dnsmasq&#x4F5C;&#x4E3A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x4E3A;hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;&#x57DF;&#x540D;&#x89E3;&#x6790;&#x670D;&#x52A1;&#x3002;</li>\n</ul>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;master&#x8282;&#x70B9;&#x7684;IP&#x4F1A;&#x4F20;&#x7ED9;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;serf&#x4F1A;&#x5728;container&#x542F;&#x52A8;&#x540E;&#x7ACB;&#x5373;&#x542F;&#x52A8;&#x3002;slave&#x8282;&#x70B9;&#x4E0A;&#x7684;serf agent&#x4F1A;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;master&#x8282;&#x70B9;&#xFF08;master IP&#x5B83;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x561B;&#xFF09;&#xFF0C;master&#x8282;&#x70B9;&#x5C31;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;&#x7136;&#x540E;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x4E92;&#x76F8;&#x4EA4;&#x6362;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x6709;&#x8282;&#x70B9;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x5B58;&#x5728;&#x4E86;&#xFF01;(Everyone will know Everyone). serf&#x53D1;&#x73B0;&#x65B0;&#x7684;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x914D;&#x7F6E;dnsmasq,&#x7136;&#x540E;&#x91CD;&#x542F;dnsmasq. &#x6240;&#x4EE5;dnsmasq&#x5C31;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x96C6;&#x7FA4;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x5566;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x968F;&#x7740;&#x8282;&#x70B9;&#x7684;&#x589E;&#x52A0;&#x4F1A;&#x8017;&#x65F6;&#x66F4;&#x4E45;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x82E5;&#x914D;&#x7F6E;&#x7684;Hadoop&#x8282;&#x70B9;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5219;&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#x9700;&#x8981;&#x6D4B;&#x8BD5;serf&#x662F;&#x5426;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;dns&#x662F;&#x5426;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x6240;&#x6709;&#x8282;&#x70B9;&#x57DF;&#x540D;&#x3002;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x624D;&#x80FD;&#x542F;&#x52A8;Hadoop&#x3002;&#x8FD9;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x7531;SequenceIQ&#x516C;&#x53F8;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x8BE5;&#x516C;&#x53F8;&#x4E13;&#x6CE8;&#x4E8E;&#x5C06;Hadoop&#x8FD0;&#x884C;&#x5728;Docker&#x4E2D;&#x3002;&#x8BF7;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;PPT&#xFF1A;<a href=\"http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning\" target=\"_blank\" rel=\"external\">Docker-based Hadoop Provisioning</a></p>\n<h4 id=\"hadoop-base&#x955C;&#x50CF;\"><a href=\"#hadoop-base&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-base&#x955C;&#x50CF;\"></a><strong>hadoop-base&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;</li>\n<li>&#x5B89;&#x88C5;JDK(openjdk)</li>\n<li>&#x5B89;&#x88C5;openssh-server, &#x914D;&#x7F6E;&#x65E0;&#x5BC6;&#x7801;ssh</li>\n<li>&#x5B89;&#x88C5;vim&#xFF1A;&#x4ECB;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x6109;&#x5FEB;&#x5730;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x6572;&#x4EE3;&#x7801;&#x4E86;:)</li>\n<li>&#x5B89;&#x88C5;Hadoop 2.3.0: &#x5B89;&#x88C5;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop &#xFF08;2.5.2&#xFF0C; 2.6.0&#xFF0C; 2.7.0 &#x90FD;&#x6BD4;2.3.0&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x61D2;&#x5F97;&#x5347;&#x7EA7;&#x4E86;&#xFF09;</li>\n</ul>\n<p>&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x8BF7;&#x53C2;&#x8003;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF1A;<a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\" target=\"_blank\" rel=\"external\"><a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\" target=\"_blank\" rel=\"external\">Hadoop 2.30 &#x5728;Ubuntu 14.04 &#x4E2D;&#x7F16;&#x8BD1;</a></a></p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5F00;&#x53D1;&#x6211;&#x7684;hadoop-base, &#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop-2.3.0&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x653E;&#x5230;hadoop-cluster-docker/hadoop-base/files&#x76EE;&#x5F55;&#x5185;&#x3002;&#x6211;&#x7F16;&#x8BD1;&#x7684;64&#x4F4D;hadoop-2.3.0&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"http://pan.baidu.com/s/1sjFRaFz\" target=\"_blank\" rel=\"external\">hadoop-2.3.0</a></p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x6211;&#x8FD8;&#x7F16;&#x8BD1;&#x4E86;64&#x4F4D;&#x7684;hadoop 2.5.2, 2.6.0, 2.7.0, &#x5176;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x5982;&#x4E0B;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://pan.baidu.com/s/1sjFRaFz\" target=\"_blank\" rel=\"external\">hadoop-2.3.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1jGw24aa\" target=\"_blank\" rel=\"external\">hadoop-2.5.2</a></li>\n<li><a href=\"http://pan.baidu.com/s/1eQgvF2M\" target=\"_blank\" rel=\"external\">hadoop-2.6.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1c0HD0Nu\" target=\"_blank\" rel=\"external\">hadoop-2.7.0</a></li>\n</ul>\n<h4 id=\"hadoop-master&#x955C;&#x50CF;\"><a href=\"#hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-master&#x955C;&#x50CF;\"></a><strong>hadoop-master&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;master&#x8282;&#x70B9;</li>\n<li>&#x683C;&#x5F0F;&#x5316;namenode</li>\n</ul>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x9700;&#x8981;&#x914D;&#x7F6E;slaves&#x6587;&#x4EF6;&#xFF0C;&#x800C;slaves&#x6587;&#x4EF6;&#x9700;&#x8981;&#x5217;&#x51FA;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x6216;&#x8005;IP&#x3002;&#x56E0;&#x6B64;&#xFF0C;Hadoop&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4E0D;&#x540C;&#x65F6;&#xFF0C;slaves&#x6587;&#x4EF6;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x66F4;&#x6539;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;slaves&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#x3002;&#x6211;&#x7F16;&#x5199;&#x4E86;&#x4E00;&#x4E2A;resize-cluster.sh&#x811A;&#x672C;&#x81EA;&#x52A8;&#x5316;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x3002;&#x4EC5;&#x9700;&#x7ED9;&#x5B9A;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x53C2;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x7684;&#x66F4;&#x6539;&#x3002;&#x7531;&#x4E8E;hadoop-master&#x955C;&#x50CF;&#x4EC5;&#x4EC5;&#x505A;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x65E0;&#x9700;&#x4E0B;&#x8F7D;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>\n<h4 id=\"hadoop-slave&#x955C;&#x50CF;\"><a href=\"#hadoop-slave&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-slave&#x955C;&#x50CF;\"></a><strong>hadoop-slave&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;slave&#x8282;&#x70B9;</li>\n</ul>\n<h4 id=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"><a href=\"#&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"></a><strong>&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;</strong></h4><p>&#x4E0B;&#x8868;&#x4E3A;sudo docker images&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>ubuntu</td>\n<td>15.04</td>\n<td>bd94ae587483</td>\n<td>3 weeks ago</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6613;&#x77E5;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF1A;</p>\n<ul>\n<li>serf-dnsmasq&#x955C;&#x50CF;&#x5728;ubuntu:15.04&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;75.4MB</li>\n<li>hadoop-base&#x955C;&#x50CF;&#x5728;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;570.7MB</li>\n<li>hadoop-master&#x548C;hadoop-slave&#x955C;&#x50CF;&#x5728;hadoop-base&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5927;&#x5C0F;&#x51E0;&#x4E4E;&#x6CA1;&#x6709;&#x589E;&#x52A0;</li>\n</ul>\n<p>&#x4E0B;&#x8868;&#x4E3A;docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0&#x547D;&#x4EE4;&#x7684;&#x90E8;&#x5206;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>IMAGE</th>\n<th>CREATED</th>\n<th>CREATED BY</th>\n<th>SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2039b9b81146</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c #(nop) ADD   multi:a93c971a49514e787</td>\n<td>158.5 MB</td>\n</tr>\n<tr>\n<td>cdb620312f30</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openjdk-7-jdk</td>\n<td>324.6 MB</td>\n</tr>\n<tr>\n<td>da7d10c790c1</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openssh-server</td>\n<td>87.58 MB</td>\n</tr>\n<tr>\n<td>c65cb568defc</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c curl -Lso serf.zip <a href=\"https://dl.bint\" target=\"_blank\" rel=\"external\">https://dl.bint</a></td>\n<td>14.46 MB</td>\n</tr>\n<tr>\n<td>3e22b3d72e33</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get update &amp;&amp; apt-get install</td>\n<td>60.89 MB</td>\n</tr>\n<tr>\n<td>b68f8c8d2140</td>\n<td>3 weeks ago</td>\n<td>/bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;</p>\n<ul>\n<li>&#x57FA;&#x7840;&#x955C;&#x50CF;ubuntu:15.04&#x4E3A;131.3MB</li>\n<li>&#x5B89;&#x88C5;openjdk&#x9700;&#x8981;324.6MB</li>\n<li>&#x5B89;&#x88C5;hadoop&#x9700;&#x8981;158.5MB</li>\n<li>ubuntu,openjdk&#x4E0E;hadoop&#x5747;&#x4E3A;&#x955C;&#x50CF;&#x6240;&#x5FC5;&#x987B;&#xFF0C;&#x4E09;&#x8005;&#x4E00;&#x5171;&#x5360;&#x4E86;:614.4MB</li>\n</ul>\n<h4 id=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"><a href=\"#&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\" class=\"headerlink\" title=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"></a><strong>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;</strong></h4><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x9879;&#x76EE;&#x7684;Docker&#x955C;&#x50CF;&#x7ED3;&#x6784;&#xFF1A;</p>\n<p><img src=\"/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png\" width=\"500\"></p>\n<h2 id=\"&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\"><a href=\"#1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x62C9;&#x53D6;&#x955C;&#x50CF;\"></a>1. <strong>&#x62C9;&#x53D6;&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<ul>\n<li>3~5&#x5206;&#x949F;OK~</li>\n</ul>\n<p><em>&#x67E5;&#x770B;&#x4E0B;&#x8F7D;&#x7684;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>hadoop-base&#x955C;&#x50CF;&#x662F;&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#xFF0C;hadoop-slave&#x955C;&#x50CF;&#x548C;hadoop-master&#x955C;&#x50CF;&#x90FD;&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x6240;&#x4EE5;&#x5176;&#x5B9E;4&#x4E2A;&#x955C;&#x50CF;&#x4E00;&#x5171;&#x4E5F;&#x5C31;777.4MB:)</li>\n</ul>\n<h4 id=\"2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"><a href=\"#2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\" class=\"headerlink\" title=\"2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"></a><strong>2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<p><em>&#x67E5;&#x770B;&#x4FEE;&#x6539;tag&#x540E;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x4FEE;&#x6539;&#x955C;&#x50CF;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x9ED8;&#x8BA4;&#x662F;&#x5C06;&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;Dockerhub, &#x56E0;&#x6B64;Dokerfile&#x4EE5;&#x53CA;shell&#x811A;&#x672C;&#x4E2D;&#x5F97;&#x955C;&#x50CF;&#x540D;&#x79F0;&#x90FD;&#x662F;&#x6CA1;&#x6709;alauada&#x524D;&#x7F00;&#x7684;&#xFF0C;sorry for this&#x2026;.&#x4E0D;&#x8FC7;&#x6539;tag&#x8FD8;&#x662F;&#x5F88;&#x5FEB;&#x6EF4;</li>\n<li>&#x82E5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x5728;DockerHub&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;tag&#x2026;&#x4E0D;&#x8FC7;Alauda&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#x7684;&#x54C8;~</li>\n</ul>\n<h4 id=\"3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"><a href=\"#3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\" class=\"headerlink\" title=\"3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"></a><strong>3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E3A;&#x4E86;&#x9632;&#x6B62;Github&#x88AB;XX, &#x6211;&#x628A;&#x4EE3;&#x7801;&#x5BFC;&#x5165;&#x5230;&#x4E86;&#x5F00;&#x6E90;&#x4E2D;&#x56FD;&#x7684;git&#x4ED3;&#x5E93;</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> http://git.oschina.net/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> hadoop-cluster-docker</div><div class=\"line\">./start-container.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">start master container...</div><div class=\"line\">start slave1 container...</div><div class=\"line\">start slave2 container...</div><div class=\"line\">root@master:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E00;&#x5171;&#x5F00;&#x542F;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;master&#x5BB9;&#x5668;root&#x7528;&#x6237;&#x7684;&#x5BB6;&#x76EE;&#x5F55;&#xFF08;/root&#xFF09;</li>\n</ul>\n<p><em>&#x67E5;&#x770B;master&#x7684;root&#x7528;&#x6237;&#x5BB6;&#x76EE;&#x5F55;&#x7684;&#x6587;&#x4EF6;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ls</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">hdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>start-hadoop.sh&#x662F;&#x5F00;&#x542F;hadoop&#x7684;shell&#x811A;&#x672C;</li>\n<li>run-wordcount.sh&#x662F;&#x8FD0;&#x884C;wordcount&#x7684;shell&#x811A;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x955C;&#x50CF;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;</li>\n</ul>\n<h4 id=\"5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\"><a href=\"#5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)\"></a><strong>5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)</strong></h4><p><em>&#x67E5;&#x770B;hadoop&#x96C6;&#x7FA4;&#x6210;&#x5458;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">serf members</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">master.kiwenlau.com  172.17.0.65:7946  alive</div><div class=\"line\">slave1.kiwenlau.com  172.17.0.66:7946  alive</div><div class=\"line\">slave2.kiwenlau.com  172.17.0.67:7946  alive</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;&#x7ED3;&#x679C;&#x7F3A;&#x5C11;&#x8282;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x201C;serf members&#x201D;&#x547D;&#x4EE4;&#x3002;&#x56E0;&#x4E3A;serf agent&#x9700;&#x8981;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#x3002;</li>\n</ul>\n<p><em>&#x6D4B;&#x8BD5;ssh</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ssh slave2.kiwenlau.com</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Warning: Permanently added <span class=\"string\">&apos;slave2.kiwenlau.com,172.17.0.67&apos;</span> (ECDSA) to the list of known hosts.</div><div class=\"line\">Welcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)</div><div class=\"line\">* Documentation:  https://help.ubuntu.com/</div><div class=\"line\">The programs included with the Ubuntu system are free software;</div><div class=\"line\">the exact distribution terms <span class=\"keyword\">for</span> each program are described <span class=\"keyword\">in</span> the</div><div class=\"line\">individual files <span class=\"keyword\">in</span> /usr/share/doc/*/copyright.</div><div class=\"line\">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</div><div class=\"line\">applicable law.</div><div class=\"line\">root@slave2:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<p><em>&#x9000;&#x51FA;slave2</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">exit</span></div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">logout</span></div><div class=\"line\">Connection to slave2.kiwenlau.com closed.</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;ssh&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x518D;&#x6D4B;&#x8BD5;&#xFF0C;&#x56E0;&#x4E3A;dnsmasq&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x3002;</li>\n<li>&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x542F;Hadoop&#x96C6;&#x7FA4;&#x4E86;&#xFF01;&#x5176;&#x5B9E;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x8010;&#x5FC3;&#x7B49;&#x5F85;&#x4E00;&#x5206;&#x949F;&#x5373;&#x53EF;&#xFF01;</li>\n</ul>\n<h4 id=\"6-&#x5F00;&#x542F;hadoop\"><a href=\"#6-&#x5F00;&#x542F;hadoop\" class=\"headerlink\" title=\"6. &#x5F00;&#x542F;hadoop\"></a><strong>6. &#x5F00;&#x542F;hadoop</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-hadoop.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0A;&#x4E00;&#x6B65;ssh&#x5230;slave2&#x4E4B;&#x540E;&#xFF0C;&#x8BF7;&#x8BB0;&#x5F97;&#x56DE;&#x5230;master&#x554A;!!&#xFF01;</li>\n<li>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x592A;&#x591A;&#xFF0C;&#x5FFD;&#x7565;&#x2026;.</li>\n<li>hadoop&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h4 id=\"7-&#x8FD0;&#x884C;wordcount\"><a href=\"#7-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"7. &#x8FD0;&#x884C;wordcount\"></a><strong>7. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./run-wordcount.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">input file1.txt:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\">input file2.txt:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t1</div><div class=\"line\">Hadoop\t1</div><div class=\"line\">Hello\t2</div></pre></td></tr></table></figure></p>\n<ul>\n<li>wordcount&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h2 id=\"&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"><a href=\"#1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"></a><strong>1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x4FEE;&#x6539;tag&#xFF0C;&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</li>\n<li>&#x6CE8;&#x610F;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x4E0B;&#x8F7D;serf-dnsmasq, &#x4F46;&#x662F;&#x8BF7;&#x6700;&#x597D;&#x4E0B;&#x8F7D;hadoop-base&#xFF0C;&#x56E0;&#x4E3A;hadoop-master&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x6784;&#x5EFA;&#x7684;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-cluster.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0D;&#x8981;&#x62C5;&#x5FC3;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x80FD;&#x641E;&#x5B9A;</li>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5462;&#xFF0C;&#x6700;&#x597D;&#x8FD8;&#x662F;&#x5F97;&#x548C;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x4E00;&#x81F4;:)</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5927;&#xFF0C;&#x4F60;&#x591A;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#xFF0C;Hadoop&#x4E0D;&#x8BA4;&#x8BC6;&#x5B83;&#x4EEC;..</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5C0F;&#xFF0C;Hadoop&#x89C9;&#x5F97;&#x5C11;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;..</li>\n</ul>\n<h4 id=\"4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"><a href=\"#4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"></a><strong>4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E09;&#x90E8;&#x5206;5~7&#xFF1A;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x5F00;&#x542F;Hadoop&#xFF0C;&#x8FD0;&#x884C;wordcount</li>\n<li>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x82E5;&#x8282;&#x70B9;&#x589E;&#x52A0;&#xFF0C;&#x8BF7;&#x52A1;&#x5FC5;&#x5148;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5F00;&#x542F;Hadoop, &#x56E0;&#x4E3A;serf&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;&#x800C;dnsmasq&#x7684;DNS&#x670D;&#x52A1;&#x5668;&#x8868;&#x793A;&#x8FD8;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x597D;&#x670D;&#x52A1;</li>\n<li>&#x6D4B;&#x8BD5;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x5DF2;&#x66F4;&#x65B0;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x4E4B;&#x5347;&#x7EA7;&#x7248;</a>!!!</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau\">kiwenlau/hadoop-cluster-docker</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">2015-06-08</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x5728;&#x5355;&#x673A;&#x4E0A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadopp&#x96C6;&#x7FA4;&#x65B9;&#x6CD5;&#xFF0C;Hadoop&#x7684;Master&#x548C;Slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#xFF0C;&#x5FEB;&#x901F;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;</p>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;</h2><p>&#x76F4;&#x63A5;&#x7528;&#x673A;&#x5668;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5F53;&#x75DB;&#x82E6;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C24;&#x5176;&#x5BF9;&#x521D;&#x5B66;&#x8005;&#x6765;&#x8BF4;&#x3002;&#x4ED6;&#x4EEC;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;&#x8DD1;wordcount&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x88AB;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6298;&#x817E;&#x7684;&#x4F53;&#x65E0;&#x5B8C;&#x80A4;&#x4E86;&#x3002;</p>\n<p>&#x6211;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5C06;Hadoop&#x96C6;&#x7FA4;&#x8FD0;&#x884C;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x4F7F;Hadoop&#x5F00;&#x53D1;&#x8005;&#x80FD;&#x591F;&#x5FEB;&#x901F;&#x4FBF;&#x6377;&#x5730;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E0D;&#x5C11;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x7406;&#x60F3;&#xFF0C;&#x4ED6;&#x4EEC;&#x6216;&#x8005;&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x592A;&#x6162;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E86;&#x7B2C;&#x4E09;&#x65B9;&#x5DE5;&#x5177;&#x4F7F;&#x5F97;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#x2026;&#x4E0B;&#x8868;&#x4E3A;&#x4E00;&#x4E9B;&#x5DF2;&#x77E5;&#x7684;Hadoop on Docker&#x9879;&#x76EE;&#x4EE5;&#x53CA;&#x5176;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x9879;&#x76EE;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n<th style=\"text-align:left\">&#x95EE;&#x9898;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:latest</td>\n<td style=\"text-align:left\">1.491GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x53EA;&#x652F;&#x6301;&#x5355;&#x4E2A;&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.7.0</td>\n<td style=\"text-align:left\">1.76 GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.6.0</td>\n<td style=\"text-align:left\">1.624GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest</td>\n<td style=\"text-align:left\">1.782GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x4F7F;&#x7528;&#x592A;&#x6162;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:2.0.0</td>\n<td style=\"text-align:left\">4.804GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest:1.70</td>\n<td style=\"text-align:left\">4.761GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-mutinode</td>\n<td style=\"text-align:left\">4.331GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6784;&#x5EFA;&#x592A;&#x6162;&#xFF0C;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x6709;bug</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6211;&#x7684;&#x9879;&#x76EE;&#x53C2;&#x8003;&#x4E86;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x505A;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x548C;&#x91CD;&#x6784;&#x3002;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x7684;Github&#x4E3B;&#x9875;&#x4EE5;&#x53CA;&#x4F5C;&#x8005;&#x6240;&#x5199;&#x7684;&#x535A;&#x5BA2;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/alvinhenrick/hadoop-mutinode\">GitHub</a>&#xFF0C;<a href=\"http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/\">&#x535A;&#x5BA2;</a></p>\n<p>&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x8868;&#x662F;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x4E0E;&#x6211;&#x7684;kiwenlau/hadoop-cluster-docker&#x9879;&#x76EE;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x6BD4;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/serf</td>\n<td style=\"text-align:left\">258.213s</td>\n<td style=\"text-align:left\">21</td>\n<td style=\"text-align:left\">239.4MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-base</td>\n<td style=\"text-align:left\">2236.055s</td>\n<td style=\"text-align:left\">58</td>\n<td style=\"text-align:left\">4.328GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-dn</td>\n<td style=\"text-align:left\">51.959s</td>\n<td style=\"text-align:left\">74</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-nn-dn</td>\n<td style=\"text-align:left\">49.548s</td>\n<td style=\"text-align:left\">84</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">kiwenlau/serf-dnsmasq</td>\n<td style=\"text-align:left\">509.46s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">206.6 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-base</td>\n<td style=\"text-align:left\">400.29s</td>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-master</td>\n<td style=\"text-align:left\">5.41s</td>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-slave</td>\n<td style=\"text-align:left\">2.41s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E3B;&#x8981;&#x4F18;&#x5316;&#x4E86;&#x8FD9;&#x6837;&#x51E0;&#x70B9;</p>\n<ul>\n<li>&#x66F4;&#x5C0F;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;</li>\n<li>&#x66F4;&#x5FEB;&#x7684;&#x6784;&#x9020;&#x65F6;&#x95F4;</li>\n<li>&#x66F4;&#x5C11;&#x7684;&#x955C;&#x50CF;&#x5C42;&#x6570;</li>\n</ul>\n<h4 id=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"><a href=\"#&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\" class=\"headerlink\" title=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"></a><strong>&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;</strong></h4><p>&#x53E6;&#x5916;&#xFF0C;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x65F6;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4FEE;&#x6539;Hadoop&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-nn-dn&#x955C;&#x50CF;,&#x7136;&#x540E;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x811A;&#x672C;&#xFF0C;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x7684;&#x529F;&#x80FD;&#x3002;&#x800C;&#x6211;&#x901A;&#x8FC7;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x8BDD;&#xFF0C;&#x4E0D;&#x5230;1&#x5206;&#x949F;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#xFF01;&#xFF01;&#xFF01;&#x672C;&#x9879;&#x76EE;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x652F;&#x6301;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6570;&#x7684;hadoop&#x96C6;&#x7FA4;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x542F;&#x52A8;hadoop, &#x8FD0;&#x884C;wordcount&#x4EE5;&#x53CA;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x90FD;&#x91C7;&#x7528;&#x4E86;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x8FD9;&#x6837;&#x4F7F;&#x5F97;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x4F7F;&#x7528;&#x4EE5;&#x53CA;&#x5F00;&#x53D1;&#x90FD;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;:)</p>\n<h4 id=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"><a href=\"#&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"></a><strong>&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;</strong></h4><ul>\n<li>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF1A;ubuntu 14.04 &#x548C; ubuntu 12.04</li>\n<li>&#x5185;&#x6838;&#x7248;&#x672C;: 3.13.0-32-generic</li>\n<li>Docker&#x7248;&#x672C;&#xFF1A;1.5.0 &#x548C;1.6.2</li>\n</ul>\n<h4 id=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\"><a href=\"#&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\" class=\"headerlink\" title=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(\"></a><strong>&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(</strong></h4><h2 id=\"&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><h4 id=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"><a href=\"#&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"></a><strong>&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;</strong></h4><ul>\n<li>serf-dnsmasq</li>\n<li>hadoop-base</li>\n<li>hadoop-master</li>\n<li>hadoop-slave</li>\n</ul>\n<h4 id=\"serf-dnsmasq&#x955C;&#x50CF;\"><a href=\"#serf-dnsmasq&#x955C;&#x50CF;\" class=\"headerlink\" title=\"serf-dnsmasq&#x955C;&#x50CF;\"></a><strong>serf-dnsmasq&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;ubuntu:15.04 (&#x9009;&#x5B83;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x5C0F;&#xFF0C;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x65B0;&#x2026;)</li>\n<li>&#x5B89;&#x88C5;serf: serf&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x5730;&#x53D1;&#x73B0;&#x6240;&#x6709;hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x3002;</li>\n<li>&#x5B89;&#x88C5;dnsmasq: dnsmasq&#x4F5C;&#x4E3A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x4E3A;hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;&#x57DF;&#x540D;&#x89E3;&#x6790;&#x670D;&#x52A1;&#x3002;</li>\n</ul>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;master&#x8282;&#x70B9;&#x7684;IP&#x4F1A;&#x4F20;&#x7ED9;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;serf&#x4F1A;&#x5728;container&#x542F;&#x52A8;&#x540E;&#x7ACB;&#x5373;&#x542F;&#x52A8;&#x3002;slave&#x8282;&#x70B9;&#x4E0A;&#x7684;serf agent&#x4F1A;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;master&#x8282;&#x70B9;&#xFF08;master IP&#x5B83;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x561B;&#xFF09;&#xFF0C;master&#x8282;&#x70B9;&#x5C31;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;&#x7136;&#x540E;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x4E92;&#x76F8;&#x4EA4;&#x6362;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x6709;&#x8282;&#x70B9;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x5B58;&#x5728;&#x4E86;&#xFF01;(Everyone will know Everyone). serf&#x53D1;&#x73B0;&#x65B0;&#x7684;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x914D;&#x7F6E;dnsmasq,&#x7136;&#x540E;&#x91CD;&#x542F;dnsmasq. &#x6240;&#x4EE5;dnsmasq&#x5C31;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x96C6;&#x7FA4;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x5566;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x968F;&#x7740;&#x8282;&#x70B9;&#x7684;&#x589E;&#x52A0;&#x4F1A;&#x8017;&#x65F6;&#x66F4;&#x4E45;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x82E5;&#x914D;&#x7F6E;&#x7684;Hadoop&#x8282;&#x70B9;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5219;&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#x9700;&#x8981;&#x6D4B;&#x8BD5;serf&#x662F;&#x5426;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;dns&#x662F;&#x5426;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x6240;&#x6709;&#x8282;&#x70B9;&#x57DF;&#x540D;&#x3002;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x624D;&#x80FD;&#x542F;&#x52A8;Hadoop&#x3002;&#x8FD9;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x7531;SequenceIQ&#x516C;&#x53F8;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x8BE5;&#x516C;&#x53F8;&#x4E13;&#x6CE8;&#x4E8E;&#x5C06;Hadoop&#x8FD0;&#x884C;&#x5728;Docker&#x4E2D;&#x3002;&#x8BF7;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;PPT&#xFF1A;<a href=\"http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning\">Docker-based Hadoop Provisioning</a></p>\n<h4 id=\"hadoop-base&#x955C;&#x50CF;\"><a href=\"#hadoop-base&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-base&#x955C;&#x50CF;\"></a><strong>hadoop-base&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;</li>\n<li>&#x5B89;&#x88C5;JDK(openjdk)</li>\n<li>&#x5B89;&#x88C5;openssh-server, &#x914D;&#x7F6E;&#x65E0;&#x5BC6;&#x7801;ssh</li>\n<li>&#x5B89;&#x88C5;vim&#xFF1A;&#x4ECB;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x6109;&#x5FEB;&#x5730;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x6572;&#x4EE3;&#x7801;&#x4E86;:)</li>\n<li>&#x5B89;&#x88C5;Hadoop 2.3.0: &#x5B89;&#x88C5;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop &#xFF08;2.5.2&#xFF0C; 2.6.0&#xFF0C; 2.7.0 &#x90FD;&#x6BD4;2.3.0&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x61D2;&#x5F97;&#x5347;&#x7EA7;&#x4E86;&#xFF09;</li>\n</ul>\n<p>&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x8BF7;&#x53C2;&#x8003;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF1A;<a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\"><a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\">Hadoop 2.30 &#x5728;Ubuntu 14.04 &#x4E2D;&#x7F16;&#x8BD1;</a></a></p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5F00;&#x53D1;&#x6211;&#x7684;hadoop-base, &#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop-2.3.0&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x653E;&#x5230;hadoop-cluster-docker/hadoop-base/files&#x76EE;&#x5F55;&#x5185;&#x3002;&#x6211;&#x7F16;&#x8BD1;&#x7684;64&#x4F4D;hadoop-2.3.0&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"http://pan.baidu.com/s/1sjFRaFz\">hadoop-2.3.0</a></p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x6211;&#x8FD8;&#x7F16;&#x8BD1;&#x4E86;64&#x4F4D;&#x7684;hadoop 2.5.2, 2.6.0, 2.7.0, &#x5176;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x5982;&#x4E0B;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://pan.baidu.com/s/1sjFRaFz\">hadoop-2.3.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1jGw24aa\">hadoop-2.5.2</a></li>\n<li><a href=\"http://pan.baidu.com/s/1eQgvF2M\">hadoop-2.6.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1c0HD0Nu\">hadoop-2.7.0</a></li>\n</ul>\n<h4 id=\"hadoop-master&#x955C;&#x50CF;\"><a href=\"#hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-master&#x955C;&#x50CF;\"></a><strong>hadoop-master&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;master&#x8282;&#x70B9;</li>\n<li>&#x683C;&#x5F0F;&#x5316;namenode</li>\n</ul>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x9700;&#x8981;&#x914D;&#x7F6E;slaves&#x6587;&#x4EF6;&#xFF0C;&#x800C;slaves&#x6587;&#x4EF6;&#x9700;&#x8981;&#x5217;&#x51FA;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x6216;&#x8005;IP&#x3002;&#x56E0;&#x6B64;&#xFF0C;Hadoop&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4E0D;&#x540C;&#x65F6;&#xFF0C;slaves&#x6587;&#x4EF6;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x66F4;&#x6539;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;slaves&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#x3002;&#x6211;&#x7F16;&#x5199;&#x4E86;&#x4E00;&#x4E2A;resize-cluster.sh&#x811A;&#x672C;&#x81EA;&#x52A8;&#x5316;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x3002;&#x4EC5;&#x9700;&#x7ED9;&#x5B9A;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x53C2;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x7684;&#x66F4;&#x6539;&#x3002;&#x7531;&#x4E8E;hadoop-master&#x955C;&#x50CF;&#x4EC5;&#x4EC5;&#x505A;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x65E0;&#x9700;&#x4E0B;&#x8F7D;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>\n<h4 id=\"hadoop-slave&#x955C;&#x50CF;\"><a href=\"#hadoop-slave&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-slave&#x955C;&#x50CF;\"></a><strong>hadoop-slave&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;slave&#x8282;&#x70B9;</li>\n</ul>\n<h4 id=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"><a href=\"#&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"></a><strong>&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;</strong></h4><p>&#x4E0B;&#x8868;&#x4E3A;sudo docker images&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>ubuntu</td>\n<td>15.04</td>\n<td>bd94ae587483</td>\n<td>3 weeks ago</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6613;&#x77E5;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF1A;</p>\n<ul>\n<li>serf-dnsmasq&#x955C;&#x50CF;&#x5728;ubuntu:15.04&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;75.4MB</li>\n<li>hadoop-base&#x955C;&#x50CF;&#x5728;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;570.7MB</li>\n<li>hadoop-master&#x548C;hadoop-slave&#x955C;&#x50CF;&#x5728;hadoop-base&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5927;&#x5C0F;&#x51E0;&#x4E4E;&#x6CA1;&#x6709;&#x589E;&#x52A0;</li>\n</ul>\n<p>&#x4E0B;&#x8868;&#x4E3A;docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0&#x547D;&#x4EE4;&#x7684;&#x90E8;&#x5206;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>IMAGE</th>\n<th>CREATED</th>\n<th>CREATED BY</th>\n<th>SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2039b9b81146</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c #(nop) ADD   multi:a93c971a49514e787</td>\n<td>158.5 MB</td>\n</tr>\n<tr>\n<td>cdb620312f30</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openjdk-7-jdk</td>\n<td>324.6 MB</td>\n</tr>\n<tr>\n<td>da7d10c790c1</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openssh-server</td>\n<td>87.58 MB</td>\n</tr>\n<tr>\n<td>c65cb568defc</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c curl -Lso serf.zip <a href=\"https://dl.bint\">https://dl.bint</a></td>\n<td>14.46 MB</td>\n</tr>\n<tr>\n<td>3e22b3d72e33</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get update &amp;&amp; apt-get install</td>\n<td>60.89 MB</td>\n</tr>\n<tr>\n<td>b68f8c8d2140</td>\n<td>3 weeks ago</td>\n<td>/bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;</p>\n<ul>\n<li>&#x57FA;&#x7840;&#x955C;&#x50CF;ubuntu:15.04&#x4E3A;131.3MB</li>\n<li>&#x5B89;&#x88C5;openjdk&#x9700;&#x8981;324.6MB</li>\n<li>&#x5B89;&#x88C5;hadoop&#x9700;&#x8981;158.5MB</li>\n<li>ubuntu,openjdk&#x4E0E;hadoop&#x5747;&#x4E3A;&#x955C;&#x50CF;&#x6240;&#x5FC5;&#x987B;&#xFF0C;&#x4E09;&#x8005;&#x4E00;&#x5171;&#x5360;&#x4E86;:614.4MB</li>\n</ul>\n<h4 id=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"><a href=\"#&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\" class=\"headerlink\" title=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"></a><strong>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;</strong></h4><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x9879;&#x76EE;&#x7684;Docker&#x955C;&#x50CF;&#x7ED3;&#x6784;&#xFF1A;</p>\n<p><img src=\"/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png\" width=\"500\"></p>\n<h2 id=\"&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\"><a href=\"#1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x62C9;&#x53D6;&#x955C;&#x50CF;\"></a>1. <strong>&#x62C9;&#x53D6;&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<ul>\n<li>3~5&#x5206;&#x949F;OK~</li>\n</ul>\n<p><em>&#x67E5;&#x770B;&#x4E0B;&#x8F7D;&#x7684;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>hadoop-base&#x955C;&#x50CF;&#x662F;&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#xFF0C;hadoop-slave&#x955C;&#x50CF;&#x548C;hadoop-master&#x955C;&#x50CF;&#x90FD;&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x6240;&#x4EE5;&#x5176;&#x5B9E;4&#x4E2A;&#x955C;&#x50CF;&#x4E00;&#x5171;&#x4E5F;&#x5C31;777.4MB:)</li>\n</ul>\n<h4 id=\"2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"><a href=\"#2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\" class=\"headerlink\" title=\"2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"></a><strong>2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<p><em>&#x67E5;&#x770B;&#x4FEE;&#x6539;tag&#x540E;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x4FEE;&#x6539;&#x955C;&#x50CF;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x9ED8;&#x8BA4;&#x662F;&#x5C06;&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;Dockerhub, &#x56E0;&#x6B64;Dokerfile&#x4EE5;&#x53CA;shell&#x811A;&#x672C;&#x4E2D;&#x5F97;&#x955C;&#x50CF;&#x540D;&#x79F0;&#x90FD;&#x662F;&#x6CA1;&#x6709;alauada&#x524D;&#x7F00;&#x7684;&#xFF0C;sorry for this&#x2026;.&#x4E0D;&#x8FC7;&#x6539;tag&#x8FD8;&#x662F;&#x5F88;&#x5FEB;&#x6EF4;</li>\n<li>&#x82E5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x5728;DockerHub&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;tag&#x2026;&#x4E0D;&#x8FC7;Alauda&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#x7684;&#x54C8;~</li>\n</ul>\n<h4 id=\"3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"><a href=\"#3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\" class=\"headerlink\" title=\"3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"></a><strong>3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E3A;&#x4E86;&#x9632;&#x6B62;Github&#x88AB;XX, &#x6211;&#x628A;&#x4EE3;&#x7801;&#x5BFC;&#x5165;&#x5230;&#x4E86;&#x5F00;&#x6E90;&#x4E2D;&#x56FD;&#x7684;git&#x4ED3;&#x5E93;</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> http://git.oschina.net/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> hadoop-cluster-docker</div><div class=\"line\">./start-container.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">start master container...</div><div class=\"line\">start slave1 container...</div><div class=\"line\">start slave2 container...</div><div class=\"line\">root@master:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E00;&#x5171;&#x5F00;&#x542F;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;master&#x5BB9;&#x5668;root&#x7528;&#x6237;&#x7684;&#x5BB6;&#x76EE;&#x5F55;&#xFF08;/root&#xFF09;</li>\n</ul>\n<p><em>&#x67E5;&#x770B;master&#x7684;root&#x7528;&#x6237;&#x5BB6;&#x76EE;&#x5F55;&#x7684;&#x6587;&#x4EF6;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ls</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">hdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>start-hadoop.sh&#x662F;&#x5F00;&#x542F;hadoop&#x7684;shell&#x811A;&#x672C;</li>\n<li>run-wordcount.sh&#x662F;&#x8FD0;&#x884C;wordcount&#x7684;shell&#x811A;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x955C;&#x50CF;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;</li>\n</ul>\n<h4 id=\"5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\"><a href=\"#5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)\"></a><strong>5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)</strong></h4><p><em>&#x67E5;&#x770B;hadoop&#x96C6;&#x7FA4;&#x6210;&#x5458;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">serf members</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">master.kiwenlau.com  172.17.0.65:7946  alive</div><div class=\"line\">slave1.kiwenlau.com  172.17.0.66:7946  alive</div><div class=\"line\">slave2.kiwenlau.com  172.17.0.67:7946  alive</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;&#x7ED3;&#x679C;&#x7F3A;&#x5C11;&#x8282;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x201C;serf members&#x201D;&#x547D;&#x4EE4;&#x3002;&#x56E0;&#x4E3A;serf agent&#x9700;&#x8981;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#x3002;</li>\n</ul>\n<p><em>&#x6D4B;&#x8BD5;ssh</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ssh slave2.kiwenlau.com</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Warning: Permanently added <span class=\"string\">&apos;slave2.kiwenlau.com,172.17.0.67&apos;</span> (ECDSA) to the list of known hosts.</div><div class=\"line\">Welcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)</div><div class=\"line\">* Documentation:  https://help.ubuntu.com/</div><div class=\"line\">The programs included with the Ubuntu system are free software;</div><div class=\"line\">the exact distribution terms <span class=\"keyword\">for</span> each program are described <span class=\"keyword\">in</span> the</div><div class=\"line\">individual files <span class=\"keyword\">in</span> /usr/share/doc/*/copyright.</div><div class=\"line\">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</div><div class=\"line\">applicable law.</div><div class=\"line\">root@slave2:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<p><em>&#x9000;&#x51FA;slave2</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">exit</span></div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">logout</span></div><div class=\"line\">Connection to slave2.kiwenlau.com closed.</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;ssh&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x518D;&#x6D4B;&#x8BD5;&#xFF0C;&#x56E0;&#x4E3A;dnsmasq&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x3002;</li>\n<li>&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x542F;Hadoop&#x96C6;&#x7FA4;&#x4E86;&#xFF01;&#x5176;&#x5B9E;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x8010;&#x5FC3;&#x7B49;&#x5F85;&#x4E00;&#x5206;&#x949F;&#x5373;&#x53EF;&#xFF01;</li>\n</ul>\n<h4 id=\"6-&#x5F00;&#x542F;hadoop\"><a href=\"#6-&#x5F00;&#x542F;hadoop\" class=\"headerlink\" title=\"6. &#x5F00;&#x542F;hadoop\"></a><strong>6. &#x5F00;&#x542F;hadoop</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-hadoop.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0A;&#x4E00;&#x6B65;ssh&#x5230;slave2&#x4E4B;&#x540E;&#xFF0C;&#x8BF7;&#x8BB0;&#x5F97;&#x56DE;&#x5230;master&#x554A;!!&#xFF01;</li>\n<li>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x592A;&#x591A;&#xFF0C;&#x5FFD;&#x7565;&#x2026;.</li>\n<li>hadoop&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h4 id=\"7-&#x8FD0;&#x884C;wordcount\"><a href=\"#7-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"7. &#x8FD0;&#x884C;wordcount\"></a><strong>7. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./run-wordcount.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">input file1.txt:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\">input file2.txt:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t1</div><div class=\"line\">Hadoop\t1</div><div class=\"line\">Hello\t2</div></pre></td></tr></table></figure></p>\n<ul>\n<li>wordcount&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h2 id=\"&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"><a href=\"#1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"></a><strong>1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x4FEE;&#x6539;tag&#xFF0C;&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</li>\n<li>&#x6CE8;&#x610F;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x4E0B;&#x8F7D;serf-dnsmasq, &#x4F46;&#x662F;&#x8BF7;&#x6700;&#x597D;&#x4E0B;&#x8F7D;hadoop-base&#xFF0C;&#x56E0;&#x4E3A;hadoop-master&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x6784;&#x5EFA;&#x7684;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-cluster.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0D;&#x8981;&#x62C5;&#x5FC3;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x80FD;&#x641E;&#x5B9A;</li>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5462;&#xFF0C;&#x6700;&#x597D;&#x8FD8;&#x662F;&#x5F97;&#x548C;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x4E00;&#x81F4;:)</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5927;&#xFF0C;&#x4F60;&#x591A;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#xFF0C;Hadoop&#x4E0D;&#x8BA4;&#x8BC6;&#x5B83;&#x4EEC;..</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5C0F;&#xFF0C;Hadoop&#x89C9;&#x5F97;&#x5C11;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;..</li>\n</ul>\n<h4 id=\"4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"><a href=\"#4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"></a><strong>4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E09;&#x90E8;&#x5206;5~7&#xFF1A;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x5F00;&#x542F;Hadoop&#xFF0C;&#x8FD0;&#x884C;wordcount</li>\n<li>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x82E5;&#x8282;&#x70B9;&#x589E;&#x52A0;&#xFF0C;&#x8BF7;&#x52A1;&#x5FC5;&#x5148;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5F00;&#x542F;Hadoop, &#x56E0;&#x4E3A;serf&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;&#x800C;dnsmasq&#x7684;DNS&#x670D;&#x52A1;&#x5668;&#x8868;&#x793A;&#x8FD8;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x597D;&#x670D;&#x52A1;</li>\n<li>&#x6D4B;&#x8BD5;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>"},{"title":"基于Docker搭建单机版Mesos/Marathon","date":"2015-09-18T04:00:00.000Z","_content":"\n**摘要:** 本文介绍了基于Docker搭建单机版Mesos/Marathon的方法，Mesos/Marathon的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-mesos-docker](https://github.com/kiwenlau/single-mesos-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-09-18](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)\n\n## 一. 简介\n\n[Mesos](http://mesos.apache.org)是集群资源管理系统，[Marathon](http://mesosphere.github.io/marathon)是运行在Mesos之上的集群计算架构。将Mesos和Marathon打包到[Docker](https://www.docker.com/)镜像中，开发者便可以在本机上快速搭建Mesos/Marathon集群，进行学习和测试。\n\n**kiwenlau/single-mesos**镜像非常简单。Docker容器运行在Ubuntu主机之上，Mesos和Marathon运行在该容器之中。具体来讲，Docker容器中运行了一个Mesos Master和一个Mesos Slave，以及Marathon和[ZooKeeper](https://zookeeper.apache.org/)。集群架构如下图：\n\n<img src=\"150918-single-mesos-docker/single-mesos-marathon.png\" width = \"500\"/>\n\n\n## 二. 搭建Mesos/Marathon集群\n\n#### **1. 下载Docker镜像:**\n\n```sh\nsudo docker pull kiwenlau/single-mesos:3.0\n```\n\n#### **2. 运行Docker容器:**\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0\n```\n\ndocker run命令运行成功后即进入容器内部，以下为输出：\n\n```bash\nStart ZooKeeper...\nStart Mesos master...\nStart Mesos slave...\nStart Marathon...\n```\n\n\n## 三. 测试Mesos/Marathon集群\n\n#### **1. 通过curl命令调用Marathon的REST API, 创建一个hello程序：**\n\n```sh\ncurl -v -H \"Content-Type: application/json\" -X POST --data \"@hello.json\" http://127.0.0.1:8080/v2/apps\n```\n\n下面为hello.json。由cmd可知，该程序每隔1秒往output.txt文件中写入hello。\n\n```bash\n{\n  \"id\": \"hello\",\n  \"cmd\": \"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\n  \"cpus\": 0.1,\n  \"mem\": 10.0,\n  \"instances\": 1\n}\n```\n\ncurl执行结果:\n\n```bash\n* Hostname was NOT found in DNS cache\n*   Trying 127.0.0.1...\n* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)\n> POST /v2/apps HTTP/1.1\n> User-Agent: curl/7.35.0\n> Host: 127.0.0.1:8080\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 139\n> \n* upload completely sent off: 139 out of 139 bytes\n< HTTP/1.1 201 Created\n< X-Marathon-Leader: http://ec054cabb9af:8080\n< Cache-Control: no-cache, no-store, must-revalidate\n< Pragma: no-cache\n< Expires: 0\n< Location: http://127.0.0.1:8080/v2/apps/hello\n< Content-Type: application/json; qs=2\n< Transfer-Encoding: chunked\n* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted\n< Server: Jetty(8.y.z-SNAPSHOT)\n< \n* Connection #0 to host 127.0.0.1 left intact\n{\"id\":\"/hello\",\"cmd\":\"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\"args\":null,\"user\":null,\"env\":{},\"instances\":1,\"cpus\":0.1,\"mem\":10.0,\"disk\":0.0,\"executor\":\"\",\"constraints\":[],\"uris\":[],\"storeUrls\":[],\"ports\":[0],\"requirePorts\":false,\"backoffFactor\":1.15,\"container\":null,\"healthChecks\":[],\"dependencies\":[],\"upgradeStrategy\":{\"minimumHealthCapacity\":1.0,\"maximumOverCapacity\":1.0},\"labels\":{},\"acceptedResourceRoles\":null,\"version\":\"2015-09-16T11:22:27.967Z\",\"deployments\":[{\"id\":\"2cd2fdd4-e5f9-4088-895f-7976349b7a19\"}],\"tasks\":[],\"tasksStaged\":0,\"tasksRunning\":0,\"tasksHealthy\":0,\"tasksUnhealthy\":0,\"backoffSeconds\":1,\"maxLaunchDelaySeconds\":3600}\n```\n\n#### **2. 查看hello程序的运行结果：**\n\n```sh\ntail -f output.txt\n```\n当你看到终端不断输出\"hello\"时说明运行成功。\n\n#### **3. 使用浏览器查看Mesos和Marathon的网页管理界面**\n\n**注意**将IP替换运行Docker容器的主机IP地址\n\nMesos网页管理界面地址：[http://192.168.59.10:5050](http://192.168.59.10:5050)\n\nMesos网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Mesos.png\" width = \"500\"/>\n\nMarathon网页管理界面地址：[http://192.168.59.10:8080](http://192.168.59.10:8080)\n\nMarathon网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Marathon.png\" width = \"500\"/>\n\n#### **4. 通过Marathon网页管理界面创建测试程序**\n\n在Marathon的网页管理界面上点击\"New APP\"，在弹框中配置测试程序。ID为\"hello\", Command为\"echo hello >> /root/output.txt\", 然后点击\"Create\"即可。如下图：\n\n<img src=\"150918-single-mesos-docker/hello.png\" width = \"300\"/>\n\n\n## 四. 存在的问题\n\n其实，参考[Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)，可以很快地在ubuntu主机上直接搭建一个单节点的Mesos/Marathon集群。但是，当我安装该教程的步骤将Mesos/Marathon集群打包到Docker镜像中时，遇到了一个比较奇怪的问题。\n\n在Docker容器中使用**\"sudo service mesos-master start\"**和**\"sudo service mesos-slave start\"**命令启动Mesos Master和Mesos Slave时，出现**\"mesos-master: unrecognized service\"**和**\"mesos-slave: unrecognized service\"**错误。但是，我在ubuntu主机上安装Mesos/Marathon集群后，使用同样的命令启动Mesos并没有问题。后来，我是通过直接执行mesos-master和mesos-slave命令启动Mesos，命令如下：\n\n```sh\n/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/log/mesos  \n```\n\n```sh\n/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/log/mesos\n```\n\n由这个问题可知，虽然在Docker容器几乎可以运行任意程序，似乎和Ubuntu主机没有区别。但是事实上，**Docker容器与ubuntu主机并非完全一致**，而且这些细节的不同点比较坑。这一点很值得探讨，可以让大家在使用Docker时少走些弯路。对于提到的问题，虽然是解决了，然而我仍然不清楚其中的原因:(\n\n\n## 五. Docker镜像备份\n\n我将Docker镜像上传到了灵雀云（Alaudo）的Docker仓库，可以通过以下命令下载和运行：\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n## 六. 参考\n\n1. [Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)\n2. [Setting up a Cluster on Mesos and Marathon](https://open.mesosphere.com/getting-started/datacenter/install/#master-setup)\n3. [An Introduction to Mesosphere](https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere)\n4. [How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04](https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04)\n5. [Deploy a Mesos Cluster with 7 Commands Using Docker](https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586)\n6. [sekka1/mesosphere-docker](https://github.com/sekka1/mesosphere-docker)\n7. [Marathon: Application Basics](http://mesosphere.github.io/marathon/docs/application-basics.html)\n8. [Marathon: REST API](http://mesosphere.github.io/marathon/docs/rest-api.html)\n\n","source":"_posts/2015/09/18/150918-single-mesos-docker.md","raw":"title: 基于Docker搭建单机版Mesos/Marathon\n\ndate: 2015-09-18 12:00:00\n\ntags: [Docker,Mesos,Marathon]\n\n---\n\n**摘要:** 本文介绍了基于Docker搭建单机版Mesos/Marathon的方法，Mesos/Marathon的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-mesos-docker](https://github.com/kiwenlau/single-mesos-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-09-18](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)\n\n## 一. 简介\n\n[Mesos](http://mesos.apache.org)是集群资源管理系统，[Marathon](http://mesosphere.github.io/marathon)是运行在Mesos之上的集群计算架构。将Mesos和Marathon打包到[Docker](https://www.docker.com/)镜像中，开发者便可以在本机上快速搭建Mesos/Marathon集群，进行学习和测试。\n\n**kiwenlau/single-mesos**镜像非常简单。Docker容器运行在Ubuntu主机之上，Mesos和Marathon运行在该容器之中。具体来讲，Docker容器中运行了一个Mesos Master和一个Mesos Slave，以及Marathon和[ZooKeeper](https://zookeeper.apache.org/)。集群架构如下图：\n\n<img src=\"150918-single-mesos-docker/single-mesos-marathon.png\" width = \"500\"/>\n\n\n## 二. 搭建Mesos/Marathon集群\n\n#### **1. 下载Docker镜像:**\n\n```sh\nsudo docker pull kiwenlau/single-mesos:3.0\n```\n\n#### **2. 运行Docker容器:**\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0\n```\n\ndocker run命令运行成功后即进入容器内部，以下为输出：\n\n```bash\nStart ZooKeeper...\nStart Mesos master...\nStart Mesos slave...\nStart Marathon...\n```\n\n\n## 三. 测试Mesos/Marathon集群\n\n#### **1. 通过curl命令调用Marathon的REST API, 创建一个hello程序：**\n\n```sh\ncurl -v -H \"Content-Type: application/json\" -X POST --data \"@hello.json\" http://127.0.0.1:8080/v2/apps\n```\n\n下面为hello.json。由cmd可知，该程序每隔1秒往output.txt文件中写入hello。\n\n```bash\n{\n  \"id\": \"hello\",\n  \"cmd\": \"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\n  \"cpus\": 0.1,\n  \"mem\": 10.0,\n  \"instances\": 1\n}\n```\n\ncurl执行结果:\n\n```bash\n* Hostname was NOT found in DNS cache\n*   Trying 127.0.0.1...\n* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)\n> POST /v2/apps HTTP/1.1\n> User-Agent: curl/7.35.0\n> Host: 127.0.0.1:8080\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 139\n> \n* upload completely sent off: 139 out of 139 bytes\n< HTTP/1.1 201 Created\n< X-Marathon-Leader: http://ec054cabb9af:8080\n< Cache-Control: no-cache, no-store, must-revalidate\n< Pragma: no-cache\n< Expires: 0\n< Location: http://127.0.0.1:8080/v2/apps/hello\n< Content-Type: application/json; qs=2\n< Transfer-Encoding: chunked\n* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted\n< Server: Jetty(8.y.z-SNAPSHOT)\n< \n* Connection #0 to host 127.0.0.1 left intact\n{\"id\":\"/hello\",\"cmd\":\"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\"args\":null,\"user\":null,\"env\":{},\"instances\":1,\"cpus\":0.1,\"mem\":10.0,\"disk\":0.0,\"executor\":\"\",\"constraints\":[],\"uris\":[],\"storeUrls\":[],\"ports\":[0],\"requirePorts\":false,\"backoffFactor\":1.15,\"container\":null,\"healthChecks\":[],\"dependencies\":[],\"upgradeStrategy\":{\"minimumHealthCapacity\":1.0,\"maximumOverCapacity\":1.0},\"labels\":{},\"acceptedResourceRoles\":null,\"version\":\"2015-09-16T11:22:27.967Z\",\"deployments\":[{\"id\":\"2cd2fdd4-e5f9-4088-895f-7976349b7a19\"}],\"tasks\":[],\"tasksStaged\":0,\"tasksRunning\":0,\"tasksHealthy\":0,\"tasksUnhealthy\":0,\"backoffSeconds\":1,\"maxLaunchDelaySeconds\":3600}\n```\n\n#### **2. 查看hello程序的运行结果：**\n\n```sh\ntail -f output.txt\n```\n当你看到终端不断输出\"hello\"时说明运行成功。\n\n#### **3. 使用浏览器查看Mesos和Marathon的网页管理界面**\n\n**注意**将IP替换运行Docker容器的主机IP地址\n\nMesos网页管理界面地址：[http://192.168.59.10:5050](http://192.168.59.10:5050)\n\nMesos网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Mesos.png\" width = \"500\"/>\n\nMarathon网页管理界面地址：[http://192.168.59.10:8080](http://192.168.59.10:8080)\n\nMarathon网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Marathon.png\" width = \"500\"/>\n\n#### **4. 通过Marathon网页管理界面创建测试程序**\n\n在Marathon的网页管理界面上点击\"New APP\"，在弹框中配置测试程序。ID为\"hello\", Command为\"echo hello >> /root/output.txt\", 然后点击\"Create\"即可。如下图：\n\n<img src=\"150918-single-mesos-docker/hello.png\" width = \"300\"/>\n\n\n## 四. 存在的问题\n\n其实，参考[Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)，可以很快地在ubuntu主机上直接搭建一个单节点的Mesos/Marathon集群。但是，当我安装该教程的步骤将Mesos/Marathon集群打包到Docker镜像中时，遇到了一个比较奇怪的问题。\n\n在Docker容器中使用**\"sudo service mesos-master start\"**和**\"sudo service mesos-slave start\"**命令启动Mesos Master和Mesos Slave时，出现**\"mesos-master: unrecognized service\"**和**\"mesos-slave: unrecognized service\"**错误。但是，我在ubuntu主机上安装Mesos/Marathon集群后，使用同样的命令启动Mesos并没有问题。后来，我是通过直接执行mesos-master和mesos-slave命令启动Mesos，命令如下：\n\n```sh\n/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/log/mesos  \n```\n\n```sh\n/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/log/mesos\n```\n\n由这个问题可知，虽然在Docker容器几乎可以运行任意程序，似乎和Ubuntu主机没有区别。但是事实上，**Docker容器与ubuntu主机并非完全一致**，而且这些细节的不同点比较坑。这一点很值得探讨，可以让大家在使用Docker时少走些弯路。对于提到的问题，虽然是解决了，然而我仍然不清楚其中的原因:(\n\n\n## 五. Docker镜像备份\n\n我将Docker镜像上传到了灵雀云（Alaudo）的Docker仓库，可以通过以下命令下载和运行：\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n## 六. 参考\n\n1. [Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)\n2. [Setting up a Cluster on Mesos and Marathon](https://open.mesosphere.com/getting-started/datacenter/install/#master-setup)\n3. [An Introduction to Mesosphere](https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere)\n4. [How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04](https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04)\n5. [Deploy a Mesos Cluster with 7 Commands Using Docker](https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586)\n6. [sekka1/mesosphere-docker](https://github.com/sekka1/mesosphere-docker)\n7. [Marathon: Application Basics](http://mesosphere.github.io/marathon/docs/application-basics.html)\n8. [Marathon: REST API](http://mesosphere.github.io/marathon/docs/rest-api.html)\n\n","slug":"2015/09/18/150918-single-mesos-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzux0004ivfynoszshqa","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Mesos/Marathon&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-mesos-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-mesos-docker</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">2015-09-18</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p><a href=\"http://mesos.apache.org\" target=\"_blank\" rel=\"external\">Mesos</a>&#x662F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#xFF0C;<a href=\"http://mesosphere.github.io/marathon\" target=\"_blank\" rel=\"external\">Marathon</a>&#x662F;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x96C6;&#x7FA4;&#x8BA1;&#x7B97;&#x67B6;&#x6784;&#x3002;&#x5C06;Mesos&#x548C;Marathon&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4FBF;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x5FEB;&#x901F;&#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;&#xFF0C;&#x8FDB;&#x884C;&#x5B66;&#x4E60;&#x548C;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p><strong>kiwenlau/single-mesos</strong>&#x955C;&#x50CF;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E4B;&#x4E0A;&#xFF0C;Mesos&#x548C;Marathon&#x8FD0;&#x884C;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BB2;&#xFF0C;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;Mesos Master&#x548C;&#x4E00;&#x4E2A;Mesos Slave&#xFF0C;&#x4EE5;&#x53CA;Marathon&#x548C;<a href=\"https://zookeeper.apache.org/\" target=\"_blank\" rel=\"external\">ZooKeeper</a>&#x3002;&#x96C6;&#x7FA4;&#x67B6;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png\" width=\"500\"></p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:\"></a><strong>2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<p>docker run&#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#x5373;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#xFF0C;&#x4EE5;&#x4E0B;&#x4E3A;&#x8F93;&#x51FA;&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Start ZooKeeper...</div><div class=\"line\">Start Mesos master...</div><div class=\"line\">Start Mesos slave...</div><div class=\"line\">Start Marathon...</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"><a href=\"#1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\" class=\"headerlink\" title=\"1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"></a><strong>1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -v -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -X POST --data <span class=\"string\">&quot;@hello.json&quot;</span> http://127.0.0.1:8080/v2/apps</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x4E3A;hello.json&#x3002;&#x7531;cmd&#x53EF;&#x77E5;&#xFF0C;&#x8BE5;&#x7A0B;&#x5E8F;&#x6BCF;&#x9694;1&#x79D2;&#x5F80;output.txt&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;hello&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">  <span class=\"string\">&quot;id&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cmd&quot;</span>: <span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cpus&quot;</span>: 0.1,</div><div class=\"line\">  <span class=\"string\">&quot;mem&quot;</span>: 10.0,</div><div class=\"line\">  <span class=\"string\">&quot;instances&quot;</span>: 1</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>curl&#x6267;&#x884C;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">* Hostname was NOT found <span class=\"keyword\">in</span> DNS cache</div><div class=\"line\">*   Trying 127.0.0.1...</div><div class=\"line\">* Connected to 127.0.0.1 (127.0.0.1) port 8080 (<span class=\"comment\">#0)</span></div><div class=\"line\">&gt; POST /v2/apps HTTP/1.1</div><div class=\"line\">&gt; User-Agent: curl/7.35.0</div><div class=\"line\">&gt; Host: 127.0.0.1:8080</div><div class=\"line\">&gt; Accept: */*</div><div class=\"line\">&gt; Content-Type: application/json</div><div class=\"line\">&gt; Content-Length: 139</div><div class=\"line\">&gt; </div><div class=\"line\">* upload completely sent off: 139 out of 139 bytes</div><div class=\"line\">&lt; HTTP/1.1 201 Created</div><div class=\"line\">&lt; X-Marathon-Leader: http://ec054cabb9af:8080</div><div class=\"line\">&lt; Cache-Control: no-cache, no-store, must-revalidate</div><div class=\"line\">&lt; Pragma: no-cache</div><div class=\"line\">&lt; Expires: 0</div><div class=\"line\">&lt; Location: http://127.0.0.1:8080/v2/apps/hello</div><div class=\"line\">&lt; Content-Type: application/json; qs=2</div><div class=\"line\">&lt; Transfer-Encoding: chunked</div><div class=\"line\">* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted</div><div class=\"line\">&lt; Server: Jetty(8.y.z-SNAPSHOT)</div><div class=\"line\">&lt; </div><div class=\"line\">* Connection <span class=\"comment\">#0 to host 127.0.0.1 left intact</span></div><div class=\"line\">{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;/hello&quot;</span>,<span class=\"string\">&quot;cmd&quot;</span>:<span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,<span class=\"string\">&quot;args&quot;</span>:null,<span class=\"string\">&quot;user&quot;</span>:null,<span class=\"string\">&quot;env&quot;</span>:{},<span class=\"string\">&quot;instances&quot;</span>:1,<span class=\"string\">&quot;cpus&quot;</span>:0.1,<span class=\"string\">&quot;mem&quot;</span>:10.0,<span class=\"string\">&quot;disk&quot;</span>:0.0,<span class=\"string\">&quot;executor&quot;</span>:<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;constraints&quot;</span>:[],<span class=\"string\">&quot;uris&quot;</span>:[],<span class=\"string\">&quot;storeUrls&quot;</span>:[],<span class=\"string\">&quot;ports&quot;</span>:[0],<span class=\"string\">&quot;requirePorts&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;backoffFactor&quot;</span>:1.15,<span class=\"string\">&quot;container&quot;</span>:null,<span class=\"string\">&quot;healthChecks&quot;</span>:[],<span class=\"string\">&quot;dependencies&quot;</span>:[],<span class=\"string\">&quot;upgradeStrategy&quot;</span>:{<span class=\"string\">&quot;minimumHealthCapacity&quot;</span>:1.0,<span class=\"string\">&quot;maximumOverCapacity&quot;</span>:1.0},<span class=\"string\">&quot;labels&quot;</span>:{},<span class=\"string\">&quot;acceptedResourceRoles&quot;</span>:null,<span class=\"string\">&quot;version&quot;</span>:<span class=\"string\">&quot;2015-09-16T11:22:27.967Z&quot;</span>,<span class=\"string\">&quot;deployments&quot;</span>:[{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;2cd2fdd4-e5f9-4088-895f-7976349b7a19&quot;</span>}],<span class=\"string\">&quot;tasks&quot;</span>:[],<span class=\"string\">&quot;tasksStaged&quot;</span>:0,<span class=\"string\">&quot;tasksRunning&quot;</span>:0,<span class=\"string\">&quot;tasksHealthy&quot;</span>:0,<span class=\"string\">&quot;tasksUnhealthy&quot;</span>:0,<span class=\"string\">&quot;backoffSeconds&quot;</span>:1,<span class=\"string\">&quot;maxLaunchDelaySeconds&quot;</span>:3600}</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"><a href=\"#2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\" class=\"headerlink\" title=\"2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"></a><strong>2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">tail <span class=\"_\">-f</span> output.txt</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x4F60;&#x770B;&#x5230;&#x7EC8;&#x7AEF;&#x4E0D;&#x65AD;&#x8F93;&#x51FA;&#x201D;hello&#x201D;&#x65F6;&#x8BF4;&#x660E;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x3002;</p>\n<h4 id=\"3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"><a href=\"#3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\" class=\"headerlink\" title=\"3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"></a><strong>3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;</strong></h4><p><strong>&#x6CE8;&#x610F;</strong>&#x5C06;IP&#x66FF;&#x6362;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#x5730;&#x5740;</p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:5050\" target=\"_blank\" rel=\"external\">http://192.168.59.10:5050</a></p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Mesos.png\" width=\"500\"></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:8080\" target=\"_blank\" rel=\"external\">http://192.168.59.10:8080</a></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Marathon.png\" width=\"500\"></p>\n<h4 id=\"4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"><a href=\"#4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\" class=\"headerlink\" title=\"4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"></a><strong>4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;</strong></h4><p>&#x5728;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x4E0A;&#x70B9;&#x51FB;&#x201D;New APP&#x201D;&#xFF0C;&#x5728;&#x5F39;&#x6846;&#x4E2D;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x3002;ID&#x4E3A;&#x201D;hello&#x201D;, Command&#x4E3A;&#x201D;echo hello &gt;&gt; /root/output.txt&#x201D;, &#x7136;&#x540E;&#x70B9;&#x51FB;&#x201D;Create&#x201D;&#x5373;&#x53EF;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/hello.png\" width=\"300\"></p>\n<h2 id=\"&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"><a href=\"#&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"></a>&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</h2><p>&#x5176;&#x5B9E;&#xFF0C;&#x53C2;&#x8003;<a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\" target=\"_blank\" rel=\"external\">Setting up a Single Node Mesosphere Cluster</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5730;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x76F4;&#x63A5;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x5B89;&#x88C5;&#x8BE5;&#x6559;&#x7A0B;&#x7684;&#x6B65;&#x9AA4;&#x5C06;Mesos/Marathon&#x96C6;&#x7FA4;&#x6253;&#x5305;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#x65F6;&#xFF0C;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528;<strong>&#x201C;sudo service mesos-master start&#x201D;</strong>&#x548C;<strong>&#x201C;sudo service mesos-slave start&#x201D;</strong>&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos Master&#x548C;Mesos Slave&#x65F6;&#xFF0C;&#x51FA;&#x73B0;<strong>&#x201C;mesos-master: unrecognized service&#x201D;</strong>&#x548C;<strong>&#x201C;mesos-slave: unrecognized service&#x201D;</strong>&#x9519;&#x8BEF;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;Mesos/Marathon&#x96C6;&#x7FA4;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#x5E76;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x540E;&#x6765;&#xFF0C;&#x6211;&#x662F;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x6267;&#x884C;mesos-master&#x548C;mesos-slave&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<p>&#x7531;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x53EF;&#x77E5;&#xFF0C;&#x867D;&#x7136;&#x5728;Docker&#x5BB9;&#x5668;&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4EFB;&#x610F;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F3C;&#x4E4E;&#x548C;Ubuntu&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x533A;&#x522B;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;<strong>Docker&#x5BB9;&#x5668;&#x4E0E;ubuntu&#x4E3B;&#x673A;&#x5E76;&#x975E;&#x5B8C;&#x5168;&#x4E00;&#x81F4;</strong>&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x7EC6;&#x8282;&#x7684;&#x4E0D;&#x540C;&#x70B9;&#x6BD4;&#x8F83;&#x5751;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x5F88;&#x503C;&#x5F97;&#x63A2;&#x8BA8;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5927;&#x5BB6;&#x5728;&#x4F7F;&#x7528;Docker&#x65F6;&#x5C11;&#x8D70;&#x4E9B;&#x5F2F;&#x8DEF;&#x3002;&#x5BF9;&#x4E8E;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x867D;&#x7136;&#x662F;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x6211;&#x4ECD;&#x7136;&#x4E0D;&#x6E05;&#x695A;&#x5176;&#x4E2D;&#x7684;&#x539F;&#x56E0;:(</p>\n<h2 id=\"&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"><a href=\"#&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\" class=\"headerlink\" title=\"&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"></a>&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;</h2><p>&#x6211;&#x5C06;Docker&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;&#x4E86;&#x7075;&#x96C0;&#x4E91;&#xFF08;Alaudo&#xFF09;&#x7684;Docker&#x4ED3;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E0B;&#x8F7D;&#x548C;&#x8FD0;&#x884C;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h2 id=\"&#x516D;-&#x53C2;&#x8003;\"><a href=\"#&#x516D;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x516D;. &#x53C2;&#x8003;\"></a>&#x516D;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\" target=\"_blank\" rel=\"external\">Setting up a Single Node Mesosphere Cluster</a></li>\n<li><a href=\"https://open.mesosphere.com/getting-started/datacenter/install/#master-setup\" target=\"_blank\" rel=\"external\">Setting up a Cluster on Mesos and Marathon</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere\" target=\"_blank\" rel=\"external\">An Introduction to Mesosphere</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04\" target=\"_blank\" rel=\"external\">How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04</a></li>\n<li><a href=\"https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586\" target=\"_blank\" rel=\"external\">Deploy a Mesos Cluster with 7 Commands Using Docker</a></li>\n<li><a href=\"https://github.com/sekka1/mesosphere-docker\" target=\"_blank\" rel=\"external\">sekka1/mesosphere-docker</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/application-basics.html\" target=\"_blank\" rel=\"external\">Marathon: Application Basics</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/rest-api.html\" target=\"_blank\" rel=\"external\">Marathon: REST API</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Mesos/Marathon&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-mesos-docker\">kiwenlau/single-mesos-docker</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">2015-09-18</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p><a href=\"http://mesos.apache.org\">Mesos</a>&#x662F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#xFF0C;<a href=\"http://mesosphere.github.io/marathon\">Marathon</a>&#x662F;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x96C6;&#x7FA4;&#x8BA1;&#x7B97;&#x67B6;&#x6784;&#x3002;&#x5C06;Mesos&#x548C;Marathon&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4FBF;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x5FEB;&#x901F;&#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;&#xFF0C;&#x8FDB;&#x884C;&#x5B66;&#x4E60;&#x548C;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p><strong>kiwenlau/single-mesos</strong>&#x955C;&#x50CF;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E4B;&#x4E0A;&#xFF0C;Mesos&#x548C;Marathon&#x8FD0;&#x884C;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BB2;&#xFF0C;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;Mesos Master&#x548C;&#x4E00;&#x4E2A;Mesos Slave&#xFF0C;&#x4EE5;&#x53CA;Marathon&#x548C;<a href=\"https://zookeeper.apache.org/\">ZooKeeper</a>&#x3002;&#x96C6;&#x7FA4;&#x67B6;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png\" width=\"500\"></p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:\"></a><strong>2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<p>docker run&#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#x5373;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#xFF0C;&#x4EE5;&#x4E0B;&#x4E3A;&#x8F93;&#x51FA;&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Start ZooKeeper...</div><div class=\"line\">Start Mesos master...</div><div class=\"line\">Start Mesos slave...</div><div class=\"line\">Start Marathon...</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"><a href=\"#1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\" class=\"headerlink\" title=\"1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"></a><strong>1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -v -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -X POST --data <span class=\"string\">&quot;@hello.json&quot;</span> http://127.0.0.1:8080/v2/apps</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x4E3A;hello.json&#x3002;&#x7531;cmd&#x53EF;&#x77E5;&#xFF0C;&#x8BE5;&#x7A0B;&#x5E8F;&#x6BCF;&#x9694;1&#x79D2;&#x5F80;output.txt&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;hello&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">  <span class=\"string\">&quot;id&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cmd&quot;</span>: <span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cpus&quot;</span>: 0.1,</div><div class=\"line\">  <span class=\"string\">&quot;mem&quot;</span>: 10.0,</div><div class=\"line\">  <span class=\"string\">&quot;instances&quot;</span>: 1</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>curl&#x6267;&#x884C;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">* Hostname was NOT found <span class=\"keyword\">in</span> DNS cache</div><div class=\"line\">*   Trying 127.0.0.1...</div><div class=\"line\">* Connected to 127.0.0.1 (127.0.0.1) port 8080 (<span class=\"comment\">#0)</span></div><div class=\"line\">&gt; POST /v2/apps HTTP/1.1</div><div class=\"line\">&gt; User-Agent: curl/7.35.0</div><div class=\"line\">&gt; Host: 127.0.0.1:8080</div><div class=\"line\">&gt; Accept: */*</div><div class=\"line\">&gt; Content-Type: application/json</div><div class=\"line\">&gt; Content-Length: 139</div><div class=\"line\">&gt; </div><div class=\"line\">* upload completely sent off: 139 out of 139 bytes</div><div class=\"line\">&lt; HTTP/1.1 201 Created</div><div class=\"line\">&lt; X-Marathon-Leader: http://ec054cabb9af:8080</div><div class=\"line\">&lt; Cache-Control: no-cache, no-store, must-revalidate</div><div class=\"line\">&lt; Pragma: no-cache</div><div class=\"line\">&lt; Expires: 0</div><div class=\"line\">&lt; Location: http://127.0.0.1:8080/v2/apps/hello</div><div class=\"line\">&lt; Content-Type: application/json; qs=2</div><div class=\"line\">&lt; Transfer-Encoding: chunked</div><div class=\"line\">* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted</div><div class=\"line\">&lt; Server: Jetty(8.y.z-SNAPSHOT)</div><div class=\"line\">&lt; </div><div class=\"line\">* Connection <span class=\"comment\">#0 to host 127.0.0.1 left intact</span></div><div class=\"line\">{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;/hello&quot;</span>,<span class=\"string\">&quot;cmd&quot;</span>:<span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,<span class=\"string\">&quot;args&quot;</span>:null,<span class=\"string\">&quot;user&quot;</span>:null,<span class=\"string\">&quot;env&quot;</span>:{},<span class=\"string\">&quot;instances&quot;</span>:1,<span class=\"string\">&quot;cpus&quot;</span>:0.1,<span class=\"string\">&quot;mem&quot;</span>:10.0,<span class=\"string\">&quot;disk&quot;</span>:0.0,<span class=\"string\">&quot;executor&quot;</span>:<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;constraints&quot;</span>:[],<span class=\"string\">&quot;uris&quot;</span>:[],<span class=\"string\">&quot;storeUrls&quot;</span>:[],<span class=\"string\">&quot;ports&quot;</span>:[0],<span class=\"string\">&quot;requirePorts&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;backoffFactor&quot;</span>:1.15,<span class=\"string\">&quot;container&quot;</span>:null,<span class=\"string\">&quot;healthChecks&quot;</span>:[],<span class=\"string\">&quot;dependencies&quot;</span>:[],<span class=\"string\">&quot;upgradeStrategy&quot;</span>:{<span class=\"string\">&quot;minimumHealthCapacity&quot;</span>:1.0,<span class=\"string\">&quot;maximumOverCapacity&quot;</span>:1.0},<span class=\"string\">&quot;labels&quot;</span>:{},<span class=\"string\">&quot;acceptedResourceRoles&quot;</span>:null,<span class=\"string\">&quot;version&quot;</span>:<span class=\"string\">&quot;2015-09-16T11:22:27.967Z&quot;</span>,<span class=\"string\">&quot;deployments&quot;</span>:[{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;2cd2fdd4-e5f9-4088-895f-7976349b7a19&quot;</span>}],<span class=\"string\">&quot;tasks&quot;</span>:[],<span class=\"string\">&quot;tasksStaged&quot;</span>:0,<span class=\"string\">&quot;tasksRunning&quot;</span>:0,<span class=\"string\">&quot;tasksHealthy&quot;</span>:0,<span class=\"string\">&quot;tasksUnhealthy&quot;</span>:0,<span class=\"string\">&quot;backoffSeconds&quot;</span>:1,<span class=\"string\">&quot;maxLaunchDelaySeconds&quot;</span>:3600}</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"><a href=\"#2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\" class=\"headerlink\" title=\"2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"></a><strong>2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">tail <span class=\"_\">-f</span> output.txt</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x4F60;&#x770B;&#x5230;&#x7EC8;&#x7AEF;&#x4E0D;&#x65AD;&#x8F93;&#x51FA;&#x201D;hello&#x201D;&#x65F6;&#x8BF4;&#x660E;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x3002;</p>\n<h4 id=\"3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"><a href=\"#3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\" class=\"headerlink\" title=\"3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"></a><strong>3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;</strong></h4><p><strong>&#x6CE8;&#x610F;</strong>&#x5C06;IP&#x66FF;&#x6362;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#x5730;&#x5740;</p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:5050\">http://192.168.59.10:5050</a></p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Mesos.png\" width=\"500\"></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:8080\">http://192.168.59.10:8080</a></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Marathon.png\" width=\"500\"></p>\n<h4 id=\"4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"><a href=\"#4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\" class=\"headerlink\" title=\"4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"></a><strong>4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;</strong></h4><p>&#x5728;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x4E0A;&#x70B9;&#x51FB;&#x201D;New APP&#x201D;&#xFF0C;&#x5728;&#x5F39;&#x6846;&#x4E2D;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x3002;ID&#x4E3A;&#x201D;hello&#x201D;, Command&#x4E3A;&#x201D;echo hello &gt;&gt; /root/output.txt&#x201D;, &#x7136;&#x540E;&#x70B9;&#x51FB;&#x201D;Create&#x201D;&#x5373;&#x53EF;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/hello.png\" width=\"300\"></p>\n<h2 id=\"&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"><a href=\"#&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"></a>&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</h2><p>&#x5176;&#x5B9E;&#xFF0C;&#x53C2;&#x8003;<a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\">Setting up a Single Node Mesosphere Cluster</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5730;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x76F4;&#x63A5;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x5B89;&#x88C5;&#x8BE5;&#x6559;&#x7A0B;&#x7684;&#x6B65;&#x9AA4;&#x5C06;Mesos/Marathon&#x96C6;&#x7FA4;&#x6253;&#x5305;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#x65F6;&#xFF0C;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528;<strong>&#x201C;sudo service mesos-master start&#x201D;</strong>&#x548C;<strong>&#x201C;sudo service mesos-slave start&#x201D;</strong>&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos Master&#x548C;Mesos Slave&#x65F6;&#xFF0C;&#x51FA;&#x73B0;<strong>&#x201C;mesos-master: unrecognized service&#x201D;</strong>&#x548C;<strong>&#x201C;mesos-slave: unrecognized service&#x201D;</strong>&#x9519;&#x8BEF;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;Mesos/Marathon&#x96C6;&#x7FA4;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#x5E76;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x540E;&#x6765;&#xFF0C;&#x6211;&#x662F;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x6267;&#x884C;mesos-master&#x548C;mesos-slave&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<p>&#x7531;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x53EF;&#x77E5;&#xFF0C;&#x867D;&#x7136;&#x5728;Docker&#x5BB9;&#x5668;&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4EFB;&#x610F;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F3C;&#x4E4E;&#x548C;Ubuntu&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x533A;&#x522B;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;<strong>Docker&#x5BB9;&#x5668;&#x4E0E;ubuntu&#x4E3B;&#x673A;&#x5E76;&#x975E;&#x5B8C;&#x5168;&#x4E00;&#x81F4;</strong>&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x7EC6;&#x8282;&#x7684;&#x4E0D;&#x540C;&#x70B9;&#x6BD4;&#x8F83;&#x5751;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x5F88;&#x503C;&#x5F97;&#x63A2;&#x8BA8;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5927;&#x5BB6;&#x5728;&#x4F7F;&#x7528;Docker&#x65F6;&#x5C11;&#x8D70;&#x4E9B;&#x5F2F;&#x8DEF;&#x3002;&#x5BF9;&#x4E8E;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x867D;&#x7136;&#x662F;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x6211;&#x4ECD;&#x7136;&#x4E0D;&#x6E05;&#x695A;&#x5176;&#x4E2D;&#x7684;&#x539F;&#x56E0;:(</p>\n<h2 id=\"&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"><a href=\"#&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\" class=\"headerlink\" title=\"&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"></a>&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;</h2><p>&#x6211;&#x5C06;Docker&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;&#x4E86;&#x7075;&#x96C0;&#x4E91;&#xFF08;Alaudo&#xFF09;&#x7684;Docker&#x4ED3;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E0B;&#x8F7D;&#x548C;&#x8FD0;&#x884C;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h2 id=\"&#x516D;-&#x53C2;&#x8003;\"><a href=\"#&#x516D;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x516D;. &#x53C2;&#x8003;\"></a>&#x516D;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\">Setting up a Single Node Mesosphere Cluster</a></li>\n<li><a href=\"https://open.mesosphere.com/getting-started/datacenter/install/#master-setup\">Setting up a Cluster on Mesos and Marathon</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere\">An Introduction to Mesosphere</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04\">How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04</a></li>\n<li><a href=\"https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586\">Deploy a Mesos Cluster with 7 Commands Using Docker</a></li>\n<li><a href=\"https://github.com/sekka1/mesosphere-docker\">sekka1/mesosphere-docker</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/application-basics.html\">Marathon: Application Basics</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/rest-api.html\">Marathon: REST API</a></li>\n</ol>"},{"title":"64位Ubuntu中编译Hadoop的步骤","date":"2016-05-29T01:00:00.000Z","_content":"\n**摘要:** 本文介绍了在64位Ubuntu 14.04中编译Hadoop的步骤。\n\nHadoop二进制包下载地址：[百度网盘](https://pan.baidu.com/s/1hrGLqlA) [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-05-29](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)\n\n<img src=\"160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width = \"300\"/>\n\nHadoop官网提供的二进制包是在32位系统上编译的，在64系统上运行会出错：\n\n```\nWARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n```\n\n这时需要自行编译Hadoop源码。以下为编译步骤:\n\n#### **1. 安装依赖软件**\n\n```\nsudo apt-get update\nsudo apt-get install -y openjdk-7-jdk libprotobuf-dev protobuf-compiler maven cmake build-essential pkg-config libssl-dev zlib1g-dev llvm-gcc automake autoconf make\n```\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nwget http://archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz\ntar -xzvf hadoop-2.3.0-src.tar.gz\n```\n\n#### **3. 编译Hadoop**\n\n```\ncd hadoop-2.3.0-src\nmvn package -Pdist,native -DskipTests –Dtar\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] ------------------------------------------------------------------------\n\n[INFO] BUILD SUCCESS\n\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Total time: 14:59.240s\n\n[INFO] Finished at: Thu Jan 15 18:51:59 JST 2015\n\n[INFO] Final Memory: 168M/435M\n\n[INFO] ------------------------------------------------------------------------\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.3.0-src/hadoop-dist/target/hadoop-2.3.0.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，也可以直接下载我编译好的Hadoop:\n\n- [百度网盘](https://pan.baidu.com/s/1hrGLqlA)\n- [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\nLinux终端用户可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.3.0/hadoop-2.3.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.4.0/hadoop-2.4.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.5.0/hadoop-2.5.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.6.0/hadoop-2.6.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.0/hadoop-2.7.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.2/hadoop-2.7.2.tar.gz\n```\n\n另外, 使用自行编译的Hadoop二进制包安装Hadoop时需要删除.bashrc文件与hadoop-env.sh文件中下面两行（默认不会有这两行，但是尝试解决报错时可能改写了）\n\n```\nexport HADOOP_COMMON_LIB_NATIVE_DIR=\"~/hadoop/lib/\"\nexport HADOOP_OPTS=\"$HADOOP_OPTS -Djava.library.path=~/hadoop/lib/\"\n```\n\n","source":"_posts/2016/05/29/160529-compile-hadoop-ubuntu.md","raw":"title: 64位Ubuntu中编译Hadoop的步骤\n\ndate: 2016-05-29 09:00\n\ntags: [Hadoop]\n\n---\n\n**摘要:** 本文介绍了在64位Ubuntu 14.04中编译Hadoop的步骤。\n\nHadoop二进制包下载地址：[百度网盘](https://pan.baidu.com/s/1hrGLqlA) [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-05-29](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)\n\n<img src=\"160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width = \"300\"/>\n\nHadoop官网提供的二进制包是在32位系统上编译的，在64系统上运行会出错：\n\n```\nWARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n```\n\n这时需要自行编译Hadoop源码。以下为编译步骤:\n\n#### **1. 安装依赖软件**\n\n```\nsudo apt-get update\nsudo apt-get install -y openjdk-7-jdk libprotobuf-dev protobuf-compiler maven cmake build-essential pkg-config libssl-dev zlib1g-dev llvm-gcc automake autoconf make\n```\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nwget http://archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz\ntar -xzvf hadoop-2.3.0-src.tar.gz\n```\n\n#### **3. 编译Hadoop**\n\n```\ncd hadoop-2.3.0-src\nmvn package -Pdist,native -DskipTests –Dtar\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] ------------------------------------------------------------------------\n\n[INFO] BUILD SUCCESS\n\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Total time: 14:59.240s\n\n[INFO] Finished at: Thu Jan 15 18:51:59 JST 2015\n\n[INFO] Final Memory: 168M/435M\n\n[INFO] ------------------------------------------------------------------------\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.3.0-src/hadoop-dist/target/hadoop-2.3.0.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，也可以直接下载我编译好的Hadoop:\n\n- [百度网盘](https://pan.baidu.com/s/1hrGLqlA)\n- [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\nLinux终端用户可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.3.0/hadoop-2.3.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.4.0/hadoop-2.4.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.5.0/hadoop-2.5.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.6.0/hadoop-2.6.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.0/hadoop-2.7.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.2/hadoop-2.7.2.tar.gz\n```\n\n另外, 使用自行编译的Hadoop二进制包安装Hadoop时需要删除.bashrc文件与hadoop-env.sh文件中下面两行（默认不会有这两行，但是尝试解决报错时可能改写了）\n\n```\nexport HADOOP_COMMON_LIB_NATIVE_DIR=\"~/hadoop/lib/\"\nexport HADOOP_OPTS=\"$HADOOP_OPTS -Djava.library.path=~/hadoop/lib/\"\n```\n\n","slug":"2016/05/29/160529-compile-hadoop-ubuntu","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzuz0006ivfynxqfy758","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x5728;64&#x4F4D;Ubuntu 14.04&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x3002;</p>\n<p>Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"https://pan.baidu.com/s/1hrGLqlA\" target=\"_blank\" rel=\"external\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a> <a href=\"https://github.com/kiwenlau/compile-hadoop/releases\" target=\"_blank\" rel=\"external\">GitHub</a></p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">2016-05-29</a></li>\n</ul>\n<p><img src=\"/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width=\"300\"></p>\n<p>Hadoop&#x5B98;&#x7F51;&#x63D0;&#x4F9B;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x662F;&#x5728;32&#x4F4D;&#x7CFB;&#x7EDF;&#x4E0A;&#x7F16;&#x8BD1;&#x7684;&#xFF0C;&#x5728;64&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;&#x4F1A;&#x51FA;&#x9519;&#xFF1A;</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\">WARN util.NativeCodeLoader: Unable to <span class=\"keyword\">load</span> <span class=\"keyword\">native</span>-hadoop <span class=\"keyword\">library</span> <span class=\"keyword\">for</span> your platform... <span class=\"keyword\">using</span> builtin-<span class=\"keyword\">java</span> classes <span class=\"keyword\">where</span> applicable</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x81EA;&#x884C;&#x7F16;&#x8BD1;Hadoop&#x6E90;&#x7801;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;:</p>\n<h4 id=\"1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"><a href=\"#1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"></a><strong>1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;</strong></h4><figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> install -y openjdk<span class=\"number\">-7</span>-jdk libprotobuf-<span class=\"built_in\">dev</span> protobuf-compiler maven cmake build-essential pkg-config libssl-<span class=\"built_in\">dev</span> zlib1g-<span class=\"built_in\">dev</span> llvm-gcc automake autoconf make</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\" target=\"_blank\" rel=\"external\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget http:<span class=\"comment\">//archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz</span></div><div class=\"line\">tar -xzvf hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">cd hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src</div><div class=\"line\">mvn <span class=\"keyword\">package</span> <span class=\"title\">-Pd</span>ist,native -DskipTests &#x2013;Dtar</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">14</span><span class=\"selector-pseudo\">:59.240s</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Thu</span> <span class=\"selector-tag\">Jan</span> <span class=\"selector-tag\">15</span> <span class=\"selector-tag\">18</span><span class=\"selector-pseudo\">:51</span><span class=\"selector-pseudo\">:59</span> <span class=\"selector-tag\">JST</span> <span class=\"selector-tag\">2015</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">168M</span>/<span class=\"selector-tag\">435M</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x7F16;&#x8BD1;&#x597D;&#x7684;Hadoop:</p>\n<ul>\n<li><a href=\"https://pan.baidu.com/s/1hrGLqlA\" target=\"_blank\" rel=\"external\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a></li>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop/releases\" target=\"_blank\" rel=\"external\">GitHub</a></li>\n</ul>\n<p>Linux&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.3.0/</span>hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.4.0/</span>hadoop-<span class=\"number\">2.4</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.5.0/</span>hadoop-<span class=\"number\">2.5</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.6.0/</span>hadoop-<span class=\"number\">2.6</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.0/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.2/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x53E6;&#x5916;, &#x4F7F;&#x7528;&#x81EA;&#x884C;&#x7F16;&#x8BD1;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x5B89;&#x88C5;Hadoop&#x65F6;&#x9700;&#x8981;&#x5220;&#x9664;.bashrc&#x6587;&#x4EF6;&#x4E0E;hadoop-env.sh&#x6587;&#x4EF6;&#x4E2D;&#x4E0B;&#x9762;&#x4E24;&#x884C;&#xFF08;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x6709;&#x8FD9;&#x4E24;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5C1D;&#x8BD5;&#x89E3;&#x51B3;&#x62A5;&#x9519;&#x65F6;&#x53EF;&#x80FD;&#x6539;&#x5199;&#x4E86;&#xFF09;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class=\"string\">&quot;~/hadoop/lib/&quot;</span></div><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_OPTS=<span class=\"string\">&quot;<span class=\"variable\">$HADOOP_OPTS</span> -Djava.library.path=~/hadoop/lib/&quot;</span></div></pre></td></tr></table></figure>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x5728;64&#x4F4D;Ubuntu 14.04&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x3002;</p>\n<p>Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"https://pan.baidu.com/s/1hrGLqlA\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a> <a href=\"https://github.com/kiwenlau/compile-hadoop/releases\">GitHub</a></p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">2016-05-29</a></li>\n</ul>\n<p><img src=\"/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width=\"300\"></p>\n<p>Hadoop&#x5B98;&#x7F51;&#x63D0;&#x4F9B;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x662F;&#x5728;32&#x4F4D;&#x7CFB;&#x7EDF;&#x4E0A;&#x7F16;&#x8BD1;&#x7684;&#xFF0C;&#x5728;64&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;&#x4F1A;&#x51FA;&#x9519;&#xFF1A;</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\">WARN util.NativeCodeLoader: Unable to <span class=\"keyword\">load</span> <span class=\"keyword\">native</span>-hadoop <span class=\"keyword\">library</span> <span class=\"keyword\">for</span> your platform... <span class=\"keyword\">using</span> builtin-<span class=\"keyword\">java</span> classes <span class=\"keyword\">where</span> applicable</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x81EA;&#x884C;&#x7F16;&#x8BD1;Hadoop&#x6E90;&#x7801;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;:</p>\n<h4 id=\"1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"><a href=\"#1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"></a><strong>1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;</strong></h4><figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> install -y openjdk<span class=\"number\">-7</span>-jdk libprotobuf-<span class=\"built_in\">dev</span> protobuf-compiler maven cmake build-essential pkg-config libssl-<span class=\"built_in\">dev</span> zlib1g-<span class=\"built_in\">dev</span> llvm-gcc automake autoconf make</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget http:<span class=\"comment\">//archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz</span></div><div class=\"line\">tar -xzvf hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">cd hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src</div><div class=\"line\">mvn <span class=\"keyword\">package</span> <span class=\"title\">-Pd</span>ist,native -DskipTests &#x2013;Dtar</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">14</span><span class=\"selector-pseudo\">:59.240s</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Thu</span> <span class=\"selector-tag\">Jan</span> <span class=\"selector-tag\">15</span> <span class=\"selector-tag\">18</span><span class=\"selector-pseudo\">:51</span><span class=\"selector-pseudo\">:59</span> <span class=\"selector-tag\">JST</span> <span class=\"selector-tag\">2015</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">168M</span>/<span class=\"selector-tag\">435M</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x7F16;&#x8BD1;&#x597D;&#x7684;Hadoop:</p>\n<ul>\n<li><a href=\"https://pan.baidu.com/s/1hrGLqlA\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a></li>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop/releases\">GitHub</a></li>\n</ul>\n<p>Linux&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.3.0/</span>hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.4.0/</span>hadoop-<span class=\"number\">2.4</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.5.0/</span>hadoop-<span class=\"number\">2.5</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.6.0/</span>hadoop-<span class=\"number\">2.6</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.0/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.2/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x53E6;&#x5916;, &#x4F7F;&#x7528;&#x81EA;&#x884C;&#x7F16;&#x8BD1;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x5B89;&#x88C5;Hadoop&#x65F6;&#x9700;&#x8981;&#x5220;&#x9664;.bashrc&#x6587;&#x4EF6;&#x4E0E;hadoop-env.sh&#x6587;&#x4EF6;&#x4E2D;&#x4E0B;&#x9762;&#x4E24;&#x884C;&#xFF08;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x6709;&#x8FD9;&#x4E24;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5C1D;&#x8BD5;&#x89E3;&#x51B3;&#x62A5;&#x9519;&#x65F6;&#x53EF;&#x80FD;&#x6539;&#x5199;&#x4E86;&#xFF09;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class=\"string\">&quot;~/hadoop/lib/&quot;</span></div><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_OPTS=<span class=\"string\">&quot;<span class=\"variable\">$HADOOP_OPTS</span> -Djava.library.path=~/hadoop/lib/&quot;</span></div></pre></td></tr></table></figure>"},{"title":"基于Docker搭建单机版Kuberntes","date":"2015-11-28T01:00:00.000Z","_content":"\n**摘要:** 本文介绍了基于Docker搭建单机版Kuberntes的方法，Kubernetes的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-11-28](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n\n## 一. Kubernetes简介\n\n2006年，Google工程师Rohit Seth发起了Cgroups内核项目。Cgroups是容器实现CPU，内存等资源隔离的基础，由此可见Google其实很早就开始涉足容器技术。而事实上，Google内部使用容器技术已经长达十年，目前谷歌所有业务包括搜索，Gmail，MapReduce等均运行在容器之中。Google内部使用的集群管理系统--Borg，堪称其容器技术的瑞士军刀。\n\n2014年，Google发起了开源容器集群管理系统--Kubernetes，其设计之初就吸取了Borg的经验和教训，并原生支持了Docker。因此，Kubernetees与较早的集群管理系统Mesos和YARN相比，对容器技术尤其是Docker的支持更加原生，同时提供了更强大的机制实现资源调度，负载均衡，高可用等底层功能，使开发者可以专注于开发应用。\n\n与其他集群系统一致，Kubernetes也采用了Master/Slave结构。下表显示了Kubernetes的各个组件及其功能。\n\n| 角色     | 组件               | 功能                                           |\n| ------- |:-----------------: | :--------------------------------------------:|\n| Master  | apiserver          | 提供RESTful接口                                |\n| Master  | scheduler          | 负责调度，将pod分配到Slave节点                   |\n| Master  | controller-manager | 负责Master的其他功能                           |\n| Master  | etde               | 储存配置信息，节点信息，pod信息等                 |\n| Slave   | kubelet            | 负责管理Pod、容器和容器镜像                       |\n| Slave   | proxy              | 将访问Service的请求转发给对应的Pod，做一些负载均衡  |\n| 客户端   | kubectl            | 命令行工具，向apiserver发起创建Pod等请求          |\n\n\n## 二. kiwenlau/kubernetes镜像简介\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。事实上，Kuberenetes未来的开发目标正是将Kubernetes的各个组件运行到容器之中，这样可以方便Kubernetes的部署和升级。现在我将Kubernetes的各个组件全部运行在容器中必然存在很多问题且很多问题是未知的，因此这个项目仅做学习测试而不宜部署到生产环境中。Kubernetes各个组件容器之间的通信通过docker link实现，其中apiserver与ectd的4001端口进行通信，scheduler，controller-manager，kubelet，proxy以及kubectl与apiserver的8080端口进行通信。\n\n<img src=\"151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n集群的大致运行流程是这样的: 用户通过kubectl命令向apiserver发起创建Pod的请求; scheduler将创建Pod的任务分配给kubelet；kubelet中包含了一个docker命令行工具，该工具会向Docker deamon发起创建容器的请求; Docker deamon负责下载镜像然后创建容器。\n\n我将Docker deamon运行在Ubuntu主机上，因此Docker daemon所创建的应用容器与Kubernetes各个组件的容器均运行在Ubuntu主机上。docker socket采用volume的形式挂载到kubelet容器内，因此kubelet中的docker命令行工具可以直接与主机上的Docker daemon进行通信。\n\n我是直接将kubernetes发布的各个组件的二进制可执行文件安装在/usr/local/bin目录下，因此，修改Dockerfile中的Kubernetes下载链接的版本号，就可以快速构建其他版本的Kubernetes镜像。另外，仅需修改网络配置，就可以很方便地在多个节点上部署Kubernetes。\n\nkiwenlau/kubernetes:1.0.7镜像版本信息:\n\n- ubuntu: 14.04\n- Kubernetes: 1.0.7\n- ectd: 2.2.1\n\nUbuntu主机版本信息:\n\n- ubuntu: 14.04.3 LTS\n- kernel: 3.16.0-30-generic\n- docker: 1.9.1\n\n\n\n## 三. 运行步骤\n\n#### **1. 安装Docker**\n\nubuntu 14.04上安装Docker: \n\n```\ncurl -fLsS https://get.docker.com/ | sh\n```\n\n其他系统请参考: [https://docs.docker.com/](https://docs.docker.com/)\n\n#### **2. 下载Docker镜像**\n\n我将kiwenlau/kubernetes:1.07以及其他用到的Docker镜像都放在[灵雀云](http://www.alauda.cn/)\n\n```\nsudo docker pull index.alauda.cn/kiwenlau/kubernetes:1.0.7\nsudo docker pull index.alauda.cn/kiwenlau/etcd:v2.2.1\nsudo docker pull index.alauda.cn/kiwenlau/nginx:1.9.7\nsudo docker pull index.alauda.cn/kiwenlau/pause:0.8.0\n```\n\n#### **3. 启动Kubernetes**\n\n```sh\ngit clone https://github.com/kiwenlau/single-kubernetes-docker\ncd single-kubernetes-docker/\nsudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh\nsudo ./start-kubernetes-alauda.sh\n```\n\n运行结束后进入kubectl容器。容器主机名为kubeclt。可以通过\"exit\"命令退出容器返回到主机，然后可以通过\"sudo docker exec -it kubectl bash\"命令再次进入kubectl容器。\n\n\n#### **4. 测试Kubernetes**\n\n运行测试脚本，该脚本会启动一个nginx pod。\n\n```\nchmod +x test-kubernetes-alauda.sh\n./test-kubernetes-alauda.sh \n```\n\n输出\n\n```\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n```\n\n\n## 四. 参考\n\n1. [meteorhacks/hyperkube](https://github.com/meteorhacks/hyperkube)\n2. [meteorhacks/kube-init](https://github.com/meteorhacks/kube-init)\n3. [Kubernetes: The Future of Cloud Hosting](https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud)\n4. [Kubernetes 架构浅析](http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io)\n5. [An Introduction to Kubernetes](https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes)\n\n","source":"_posts/2015/11/28/151128-single-kubernetes-docker.md","raw":"title: 基于Docker搭建单机版Kuberntes\n\ndate: 2015-11-28 09:00:00\n\ntags: [Docker, Kubernetes]\n\n---\n\n**摘要:** 本文介绍了基于Docker搭建单机版Kuberntes的方法，Kubernetes的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-11-28](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n\n## 一. Kubernetes简介\n\n2006年，Google工程师Rohit Seth发起了Cgroups内核项目。Cgroups是容器实现CPU，内存等资源隔离的基础，由此可见Google其实很早就开始涉足容器技术。而事实上，Google内部使用容器技术已经长达十年，目前谷歌所有业务包括搜索，Gmail，MapReduce等均运行在容器之中。Google内部使用的集群管理系统--Borg，堪称其容器技术的瑞士军刀。\n\n2014年，Google发起了开源容器集群管理系统--Kubernetes，其设计之初就吸取了Borg的经验和教训，并原生支持了Docker。因此，Kubernetees与较早的集群管理系统Mesos和YARN相比，对容器技术尤其是Docker的支持更加原生，同时提供了更强大的机制实现资源调度，负载均衡，高可用等底层功能，使开发者可以专注于开发应用。\n\n与其他集群系统一致，Kubernetes也采用了Master/Slave结构。下表显示了Kubernetes的各个组件及其功能。\n\n| 角色     | 组件               | 功能                                           |\n| ------- |:-----------------: | :--------------------------------------------:|\n| Master  | apiserver          | 提供RESTful接口                                |\n| Master  | scheduler          | 负责调度，将pod分配到Slave节点                   |\n| Master  | controller-manager | 负责Master的其他功能                           |\n| Master  | etde               | 储存配置信息，节点信息，pod信息等                 |\n| Slave   | kubelet            | 负责管理Pod、容器和容器镜像                       |\n| Slave   | proxy              | 将访问Service的请求转发给对应的Pod，做一些负载均衡  |\n| 客户端   | kubectl            | 命令行工具，向apiserver发起创建Pod等请求          |\n\n\n## 二. kiwenlau/kubernetes镜像简介\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。事实上，Kuberenetes未来的开发目标正是将Kubernetes的各个组件运行到容器之中，这样可以方便Kubernetes的部署和升级。现在我将Kubernetes的各个组件全部运行在容器中必然存在很多问题且很多问题是未知的，因此这个项目仅做学习测试而不宜部署到生产环境中。Kubernetes各个组件容器之间的通信通过docker link实现，其中apiserver与ectd的4001端口进行通信，scheduler，controller-manager，kubelet，proxy以及kubectl与apiserver的8080端口进行通信。\n\n<img src=\"151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n集群的大致运行流程是这样的: 用户通过kubectl命令向apiserver发起创建Pod的请求; scheduler将创建Pod的任务分配给kubelet；kubelet中包含了一个docker命令行工具，该工具会向Docker deamon发起创建容器的请求; Docker deamon负责下载镜像然后创建容器。\n\n我将Docker deamon运行在Ubuntu主机上，因此Docker daemon所创建的应用容器与Kubernetes各个组件的容器均运行在Ubuntu主机上。docker socket采用volume的形式挂载到kubelet容器内，因此kubelet中的docker命令行工具可以直接与主机上的Docker daemon进行通信。\n\n我是直接将kubernetes发布的各个组件的二进制可执行文件安装在/usr/local/bin目录下，因此，修改Dockerfile中的Kubernetes下载链接的版本号，就可以快速构建其他版本的Kubernetes镜像。另外，仅需修改网络配置，就可以很方便地在多个节点上部署Kubernetes。\n\nkiwenlau/kubernetes:1.0.7镜像版本信息:\n\n- ubuntu: 14.04\n- Kubernetes: 1.0.7\n- ectd: 2.2.1\n\nUbuntu主机版本信息:\n\n- ubuntu: 14.04.3 LTS\n- kernel: 3.16.0-30-generic\n- docker: 1.9.1\n\n\n\n## 三. 运行步骤\n\n#### **1. 安装Docker**\n\nubuntu 14.04上安装Docker: \n\n```\ncurl -fLsS https://get.docker.com/ | sh\n```\n\n其他系统请参考: [https://docs.docker.com/](https://docs.docker.com/)\n\n#### **2. 下载Docker镜像**\n\n我将kiwenlau/kubernetes:1.07以及其他用到的Docker镜像都放在[灵雀云](http://www.alauda.cn/)\n\n```\nsudo docker pull index.alauda.cn/kiwenlau/kubernetes:1.0.7\nsudo docker pull index.alauda.cn/kiwenlau/etcd:v2.2.1\nsudo docker pull index.alauda.cn/kiwenlau/nginx:1.9.7\nsudo docker pull index.alauda.cn/kiwenlau/pause:0.8.0\n```\n\n#### **3. 启动Kubernetes**\n\n```sh\ngit clone https://github.com/kiwenlau/single-kubernetes-docker\ncd single-kubernetes-docker/\nsudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh\nsudo ./start-kubernetes-alauda.sh\n```\n\n运行结束后进入kubectl容器。容器主机名为kubeclt。可以通过\"exit\"命令退出容器返回到主机，然后可以通过\"sudo docker exec -it kubectl bash\"命令再次进入kubectl容器。\n\n\n#### **4. 测试Kubernetes**\n\n运行测试脚本，该脚本会启动一个nginx pod。\n\n```\nchmod +x test-kubernetes-alauda.sh\n./test-kubernetes-alauda.sh \n```\n\n输出\n\n```\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n```\n\n\n## 四. 参考\n\n1. [meteorhacks/hyperkube](https://github.com/meteorhacks/hyperkube)\n2. [meteorhacks/kube-init](https://github.com/meteorhacks/kube-init)\n3. [Kubernetes: The Future of Cloud Hosting](https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud)\n4. [Kubernetes 架构浅析](http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io)\n5. [An Introduction to Kubernetes](https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes)\n\n","slug":"2015/11/28/151128-single-kubernetes-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzv20007ivfytrtpbml2","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">2015-11-28</a></li>\n</ul>\n<h2 id=\"&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Kubernetes&#x7B80;&#x4ECB;\"></a>&#x4E00;. Kubernetes&#x7B80;&#x4ECB;</h2><p>2006&#x5E74;&#xFF0C;Google&#x5DE5;&#x7A0B;&#x5E08;Rohit Seth&#x53D1;&#x8D77;&#x4E86;Cgroups&#x5185;&#x6838;&#x9879;&#x76EE;&#x3002;Cgroups&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;CPU&#xFF0C;&#x5185;&#x5B58;&#x7B49;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x89C1;Google&#x5176;&#x5B9E;&#x5F88;&#x65E9;&#x5C31;&#x5F00;&#x59CB;&#x6D89;&#x8DB3;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5DF2;&#x7ECF;&#x957F;&#x8FBE;&#x5341;&#x5E74;&#xFF0C;&#x76EE;&#x524D;&#x8C37;&#x6B4C;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x5305;&#x62EC;&#x641C;&#x7D22;&#xFF0C;Gmail&#xFF0C;MapReduce&#x7B49;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Borg&#xFF0C;&#x582A;&#x79F0;&#x5176;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x745E;&#x58EB;&#x519B;&#x5200;&#x3002;</p>\n<p>2014&#x5E74;&#xFF0C;Google&#x53D1;&#x8D77;&#x4E86;&#x5F00;&#x6E90;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Kubernetes&#xFF0C;&#x5176;&#x8BBE;&#x8BA1;&#x4E4B;&#x521D;&#x5C31;&#x5438;&#x53D6;&#x4E86;Borg&#x7684;&#x7ECF;&#x9A8C;&#x548C;&#x6559;&#x8BAD;&#xFF0C;&#x5E76;&#x539F;&#x751F;&#x652F;&#x6301;&#x4E86;Docker&#x3002;&#x56E0;&#x6B64;&#xFF0C;Kubernetees&#x4E0E;&#x8F83;&#x65E9;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;Mesos&#x548C;YARN&#x76F8;&#x6BD4;&#xFF0C;&#x5BF9;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5C24;&#x5176;&#x662F;Docker&#x7684;&#x652F;&#x6301;&#x66F4;&#x52A0;&#x539F;&#x751F;&#xFF0C;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x9AD8;&#x53EF;&#x7528;&#x7B49;&#x5E95;&#x5C42;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4E13;&#x6CE8;&#x4E8E;&#x5F00;&#x53D1;&#x5E94;&#x7528;&#x3002;</p>\n<p>&#x4E0E;&#x5176;&#x4ED6;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x4E00;&#x81F4;&#xFF0C;Kubernetes&#x4E5F;&#x91C7;&#x7528;&#x4E86;Master/Slave&#x7ED3;&#x6784;&#x3002;&#x4E0B;&#x8868;&#x663E;&#x793A;&#x4E86;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x53CA;&#x5176;&#x529F;&#x80FD;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th>&#x89D2;&#x8272;</th>\n<th style=\"text-align:center\">&#x7EC4;&#x4EF6;</th>\n<th style=\"text-align:center\">&#x529F;&#x80FD;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">apiserver</td>\n<td style=\"text-align:center\">&#x63D0;&#x4F9B;RESTful&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">scheduler</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#xFF0C;&#x5C06;pod&#x5206;&#x914D;&#x5230;Slave&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">controller-manager</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;Master&#x7684;&#x5176;&#x4ED6;&#x529F;&#x80FD;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">etde</td>\n<td style=\"text-align:center\">&#x50A8;&#x5B58;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#xFF0C;pod&#x4FE1;&#x606F;&#x7B49;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">kubelet</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x7BA1;&#x7406;Pod&#x3001;&#x5BB9;&#x5668;&#x548C;&#x5BB9;&#x5668;&#x955C;&#x50CF;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">proxy</td>\n<td style=\"text-align:center\">&#x5C06;&#x8BBF;&#x95EE;Service&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;Pod&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</td>\n</tr>\n<tr>\n<td>&#x5BA2;&#x6237;&#x7AEF;</td>\n<td style=\"text-align:center\">kubectl</td>\n<td style=\"text-align:center\">&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7B49;&#x8BF7;&#x6C42;</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Kuberenetes&#x672A;&#x6765;&#x7684;&#x5F00;&#x53D1;&#x76EE;&#x6807;&#x6B63;&#x662F;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x8FD0;&#x884C;&#x5230;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;Kubernetes&#x7684;&#x90E8;&#x7F72;&#x548C;&#x5347;&#x7EA7;&#x3002;&#x73B0;&#x5728;&#x6211;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5168;&#x90E8;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x5FC5;&#x7136;&#x5B58;&#x5728;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x4E14;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x662F;&#x672A;&#x77E5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x4EC5;&#x505A;&#x5B66;&#x4E60;&#x6D4B;&#x8BD5;&#x800C;&#x4E0D;&#x5B9C;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x3002;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901A;&#x8FC7;docker link&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4E2D;apiserver&#x4E0E;ectd&#x7684;4001&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;scheduler&#xFF0C;controller-manager&#xFF0C;kubelet&#xFF0C;proxy&#x4EE5;&#x53CA;kubectl&#x4E0E;apiserver&#x7684;8080&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><img src=\"/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<p>&#x96C6;&#x7FA4;&#x7684;&#x5927;&#x81F4;&#x8FD0;&#x884C;&#x6D41;&#x7A0B;&#x662F;&#x8FD9;&#x6837;&#x7684;: &#x7528;&#x6237;&#x901A;&#x8FC7;kubectl&#x547D;&#x4EE4;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7684;&#x8BF7;&#x6C42;; scheduler&#x5C06;&#x521B;&#x5EFA;Pod&#x7684;&#x4EFB;&#x52A1;&#x5206;&#x914D;&#x7ED9;kubelet&#xFF1B;kubelet&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x8BE5;&#x5DE5;&#x5177;&#x4F1A;&#x5411;Docker deamon&#x53D1;&#x8D77;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#x8BF7;&#x6C42;; Docker deamon&#x8D1F;&#x8D23;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x6211;&#x5C06;Docker deamon&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Docker daemon&#x6240;&#x521B;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x4E0E;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x5BB9;&#x5668;&#x5747;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x3002;docker socket&#x91C7;&#x7528;volume&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x5230;kubelet&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x56E0;&#x6B64;kubelet&#x4E2D;&#x7684;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0E;&#x4E3B;&#x673A;&#x4E0A;&#x7684;Docker daemon&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x6211;&#x662F;&#x76F4;&#x63A5;&#x5C06;kubernetes&#x53D1;&#x5E03;&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5B89;&#x88C5;&#x5728;/usr/local/bin&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4FEE;&#x6539;Dockerfile&#x4E2D;&#x7684;Kubernetes&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x6784;&#x5EFA;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Kubernetes&#x955C;&#x50CF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5728;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72;Kubernetes&#x3002;</p>\n<p>kiwenlau/kubernetes:1.0.7&#x955C;&#x50CF;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04</li>\n<li>Kubernetes: 1.0.7</li>\n<li>ectd: 2.2.1</li>\n</ul>\n<p>Ubuntu&#x4E3B;&#x673A;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04.3 LTS</li>\n<li>kernel: 3.16.0-30-generic</li>\n<li>docker: 1.9.1</li>\n</ul>\n<h2 id=\"&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"></a>&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x5B89;&#x88C5;Docker\"><a href=\"#1-&#x5B89;&#x88C5;Docker\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;Docker\"></a><strong>1. &#x5B89;&#x88C5;Docker</strong></h4><p>ubuntu 14.04&#x4E0A;&#x5B89;&#x88C5;Docker: </p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -fLsS http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | <span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x8BF7;&#x53C2;&#x8003;: <a href=\"https://docs.docker.com/\" target=\"_blank\" rel=\"external\">https://docs.docker.com/</a></p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>&#x6211;&#x5C06;kiwenlau/kubernetes:1.07&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7528;&#x5230;&#x7684;Docker&#x955C;&#x50CF;&#x90FD;&#x653E;&#x5728;<a href=\"http://www.alauda.cn/\" target=\"_blank\" rel=\"external\">&#x7075;&#x96C0;&#x4E91;</a></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/kubernetes:<span class=\"number\">1.0</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/etcd:v2.<span class=\"number\">2.1</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/nginx:<span class=\"number\">1.9</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/pause:<span class=\"number\">0.8</span>.<span class=\"number\">0</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x542F;&#x52A8;Kubernetes\"><a href=\"#3-&#x542F;&#x52A8;Kubernetes\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Kubernetes\"></a><strong>3. &#x542F;&#x52A8;Kubernetes</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/single-kubernetes-docker</div><div class=\"line\"><span class=\"built_in\">cd</span> single-kubernetes-docker/</div><div class=\"line\">sudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh</div><div class=\"line\">sudo ./start-kubernetes-alauda.sh</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;&#x5BB9;&#x5668;&#x4E3B;&#x673A;&#x540D;&#x4E3A;kubeclt&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;exit&#x201D;&#x547D;&#x4EE4;&#x9000;&#x51FA;&#x5BB9;&#x5668;&#x8FD4;&#x56DE;&#x5230;&#x4E3B;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;sudo docker exec -it kubectl bash&#x201D;&#x547D;&#x4EE4;&#x518D;&#x6B21;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;</p>\n<h4 id=\"4-&#x6D4B;&#x8BD5;Kubernetes\"><a href=\"#4-&#x6D4B;&#x8BD5;Kubernetes\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;Kubernetes\"></a><strong>4. &#x6D4B;&#x8BD5;Kubernetes</strong></h4><p>&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#xFF0C;&#x8BE5;&#x811A;&#x672C;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;nginx pod&#x3002;</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">chmod +x <span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div><div class=\"line\">./<span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"css\"></span></div><div class=\"line\">&#xA0; &#xA0; <span class=\"selector-tag\">body</span> {</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">width</span>: <span class=\"number\">35em</span>;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</div><div class=\"line\">&#xA0; &#xA0; }</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</div><div class=\"line\">working. Further configuration is required.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>For online documentation and support please refer to</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></div><div class=\"line\">Commercial support is available at</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>Thank you for using nginx.<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x53C2;&#x8003;\"><a href=\"#&#x56DB;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x56DB;. &#x53C2;&#x8003;\"></a>&#x56DB;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://github.com/meteorhacks/hyperkube\" target=\"_blank\" rel=\"external\">meteorhacks/hyperkube</a></li>\n<li><a href=\"https://github.com/meteorhacks/kube-init\" target=\"_blank\" rel=\"external\">meteorhacks/kube-init</a></li>\n<li><a href=\"https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud\" target=\"_blank\" rel=\"external\">Kubernetes: The Future of Cloud Hosting</a></li>\n<li><a href=\"http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io\" target=\"_blank\" rel=\"external\">Kubernetes &#x67B6;&#x6784;&#x6D45;&#x6790;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes\" target=\"_blank\" rel=\"external\">An Introduction to Kubernetes</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">2015-11-28</a></li>\n</ul>\n<h2 id=\"&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Kubernetes&#x7B80;&#x4ECB;\"></a>&#x4E00;. Kubernetes&#x7B80;&#x4ECB;</h2><p>2006&#x5E74;&#xFF0C;Google&#x5DE5;&#x7A0B;&#x5E08;Rohit Seth&#x53D1;&#x8D77;&#x4E86;Cgroups&#x5185;&#x6838;&#x9879;&#x76EE;&#x3002;Cgroups&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;CPU&#xFF0C;&#x5185;&#x5B58;&#x7B49;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x89C1;Google&#x5176;&#x5B9E;&#x5F88;&#x65E9;&#x5C31;&#x5F00;&#x59CB;&#x6D89;&#x8DB3;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5DF2;&#x7ECF;&#x957F;&#x8FBE;&#x5341;&#x5E74;&#xFF0C;&#x76EE;&#x524D;&#x8C37;&#x6B4C;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x5305;&#x62EC;&#x641C;&#x7D22;&#xFF0C;Gmail&#xFF0C;MapReduce&#x7B49;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Borg&#xFF0C;&#x582A;&#x79F0;&#x5176;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x745E;&#x58EB;&#x519B;&#x5200;&#x3002;</p>\n<p>2014&#x5E74;&#xFF0C;Google&#x53D1;&#x8D77;&#x4E86;&#x5F00;&#x6E90;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Kubernetes&#xFF0C;&#x5176;&#x8BBE;&#x8BA1;&#x4E4B;&#x521D;&#x5C31;&#x5438;&#x53D6;&#x4E86;Borg&#x7684;&#x7ECF;&#x9A8C;&#x548C;&#x6559;&#x8BAD;&#xFF0C;&#x5E76;&#x539F;&#x751F;&#x652F;&#x6301;&#x4E86;Docker&#x3002;&#x56E0;&#x6B64;&#xFF0C;Kubernetees&#x4E0E;&#x8F83;&#x65E9;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;Mesos&#x548C;YARN&#x76F8;&#x6BD4;&#xFF0C;&#x5BF9;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5C24;&#x5176;&#x662F;Docker&#x7684;&#x652F;&#x6301;&#x66F4;&#x52A0;&#x539F;&#x751F;&#xFF0C;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x9AD8;&#x53EF;&#x7528;&#x7B49;&#x5E95;&#x5C42;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4E13;&#x6CE8;&#x4E8E;&#x5F00;&#x53D1;&#x5E94;&#x7528;&#x3002;</p>\n<p>&#x4E0E;&#x5176;&#x4ED6;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x4E00;&#x81F4;&#xFF0C;Kubernetes&#x4E5F;&#x91C7;&#x7528;&#x4E86;Master/Slave&#x7ED3;&#x6784;&#x3002;&#x4E0B;&#x8868;&#x663E;&#x793A;&#x4E86;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x53CA;&#x5176;&#x529F;&#x80FD;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th>&#x89D2;&#x8272;</th>\n<th style=\"text-align:center\">&#x7EC4;&#x4EF6;</th>\n<th style=\"text-align:center\">&#x529F;&#x80FD;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">apiserver</td>\n<td style=\"text-align:center\">&#x63D0;&#x4F9B;RESTful&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">scheduler</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#xFF0C;&#x5C06;pod&#x5206;&#x914D;&#x5230;Slave&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">controller-manager</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;Master&#x7684;&#x5176;&#x4ED6;&#x529F;&#x80FD;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">etde</td>\n<td style=\"text-align:center\">&#x50A8;&#x5B58;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#xFF0C;pod&#x4FE1;&#x606F;&#x7B49;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">kubelet</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x7BA1;&#x7406;Pod&#x3001;&#x5BB9;&#x5668;&#x548C;&#x5BB9;&#x5668;&#x955C;&#x50CF;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">proxy</td>\n<td style=\"text-align:center\">&#x5C06;&#x8BBF;&#x95EE;Service&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;Pod&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</td>\n</tr>\n<tr>\n<td>&#x5BA2;&#x6237;&#x7AEF;</td>\n<td style=\"text-align:center\">kubectl</td>\n<td style=\"text-align:center\">&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7B49;&#x8BF7;&#x6C42;</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Kuberenetes&#x672A;&#x6765;&#x7684;&#x5F00;&#x53D1;&#x76EE;&#x6807;&#x6B63;&#x662F;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x8FD0;&#x884C;&#x5230;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;Kubernetes&#x7684;&#x90E8;&#x7F72;&#x548C;&#x5347;&#x7EA7;&#x3002;&#x73B0;&#x5728;&#x6211;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5168;&#x90E8;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x5FC5;&#x7136;&#x5B58;&#x5728;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x4E14;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x662F;&#x672A;&#x77E5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x4EC5;&#x505A;&#x5B66;&#x4E60;&#x6D4B;&#x8BD5;&#x800C;&#x4E0D;&#x5B9C;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x3002;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901A;&#x8FC7;docker link&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4E2D;apiserver&#x4E0E;ectd&#x7684;4001&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;scheduler&#xFF0C;controller-manager&#xFF0C;kubelet&#xFF0C;proxy&#x4EE5;&#x53CA;kubectl&#x4E0E;apiserver&#x7684;8080&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><img src=\"/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<p>&#x96C6;&#x7FA4;&#x7684;&#x5927;&#x81F4;&#x8FD0;&#x884C;&#x6D41;&#x7A0B;&#x662F;&#x8FD9;&#x6837;&#x7684;: &#x7528;&#x6237;&#x901A;&#x8FC7;kubectl&#x547D;&#x4EE4;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7684;&#x8BF7;&#x6C42;; scheduler&#x5C06;&#x521B;&#x5EFA;Pod&#x7684;&#x4EFB;&#x52A1;&#x5206;&#x914D;&#x7ED9;kubelet&#xFF1B;kubelet&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x8BE5;&#x5DE5;&#x5177;&#x4F1A;&#x5411;Docker deamon&#x53D1;&#x8D77;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#x8BF7;&#x6C42;; Docker deamon&#x8D1F;&#x8D23;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x6211;&#x5C06;Docker deamon&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Docker daemon&#x6240;&#x521B;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x4E0E;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x5BB9;&#x5668;&#x5747;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x3002;docker socket&#x91C7;&#x7528;volume&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x5230;kubelet&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x56E0;&#x6B64;kubelet&#x4E2D;&#x7684;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0E;&#x4E3B;&#x673A;&#x4E0A;&#x7684;Docker daemon&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x6211;&#x662F;&#x76F4;&#x63A5;&#x5C06;kubernetes&#x53D1;&#x5E03;&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5B89;&#x88C5;&#x5728;/usr/local/bin&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4FEE;&#x6539;Dockerfile&#x4E2D;&#x7684;Kubernetes&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x6784;&#x5EFA;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Kubernetes&#x955C;&#x50CF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5728;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72;Kubernetes&#x3002;</p>\n<p>kiwenlau/kubernetes:1.0.7&#x955C;&#x50CF;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04</li>\n<li>Kubernetes: 1.0.7</li>\n<li>ectd: 2.2.1</li>\n</ul>\n<p>Ubuntu&#x4E3B;&#x673A;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04.3 LTS</li>\n<li>kernel: 3.16.0-30-generic</li>\n<li>docker: 1.9.1</li>\n</ul>\n<h2 id=\"&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"></a>&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x5B89;&#x88C5;Docker\"><a href=\"#1-&#x5B89;&#x88C5;Docker\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;Docker\"></a><strong>1. &#x5B89;&#x88C5;Docker</strong></h4><p>ubuntu 14.04&#x4E0A;&#x5B89;&#x88C5;Docker: </p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -fLsS http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | <span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x8BF7;&#x53C2;&#x8003;: <a href=\"https://docs.docker.com/\">https://docs.docker.com/</a></p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>&#x6211;&#x5C06;kiwenlau/kubernetes:1.07&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7528;&#x5230;&#x7684;Docker&#x955C;&#x50CF;&#x90FD;&#x653E;&#x5728;<a href=\"http://www.alauda.cn/\">&#x7075;&#x96C0;&#x4E91;</a></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/kubernetes:<span class=\"number\">1.0</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/etcd:v2.<span class=\"number\">2.1</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/nginx:<span class=\"number\">1.9</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/pause:<span class=\"number\">0.8</span>.<span class=\"number\">0</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x542F;&#x52A8;Kubernetes\"><a href=\"#3-&#x542F;&#x52A8;Kubernetes\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Kubernetes\"></a><strong>3. &#x542F;&#x52A8;Kubernetes</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/single-kubernetes-docker</div><div class=\"line\"><span class=\"built_in\">cd</span> single-kubernetes-docker/</div><div class=\"line\">sudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh</div><div class=\"line\">sudo ./start-kubernetes-alauda.sh</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;&#x5BB9;&#x5668;&#x4E3B;&#x673A;&#x540D;&#x4E3A;kubeclt&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;exit&#x201D;&#x547D;&#x4EE4;&#x9000;&#x51FA;&#x5BB9;&#x5668;&#x8FD4;&#x56DE;&#x5230;&#x4E3B;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;sudo docker exec -it kubectl bash&#x201D;&#x547D;&#x4EE4;&#x518D;&#x6B21;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;</p>\n<h4 id=\"4-&#x6D4B;&#x8BD5;Kubernetes\"><a href=\"#4-&#x6D4B;&#x8BD5;Kubernetes\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;Kubernetes\"></a><strong>4. &#x6D4B;&#x8BD5;Kubernetes</strong></h4><p>&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#xFF0C;&#x8BE5;&#x811A;&#x672C;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;nginx pod&#x3002;</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">chmod +x <span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div><div class=\"line\">./<span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"css\"></span></div><div class=\"line\">&#xA0; &#xA0; <span class=\"selector-tag\">body</span> {</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">width</span>: <span class=\"number\">35em</span>;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</div><div class=\"line\">&#xA0; &#xA0; }</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</div><div class=\"line\">working. Further configuration is required.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>For online documentation and support please refer to</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></div><div class=\"line\">Commercial support is available at</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>Thank you for using nginx.<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x53C2;&#x8003;\"><a href=\"#&#x56DB;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x56DB;. &#x53C2;&#x8003;\"></a>&#x56DB;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://github.com/meteorhacks/hyperkube\">meteorhacks/hyperkube</a></li>\n<li><a href=\"https://github.com/meteorhacks/kube-init\">meteorhacks/kube-init</a></li>\n<li><a href=\"https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud\">Kubernetes: The Future of Cloud Hosting</a></li>\n<li><a href=\"http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io\">Kubernetes &#x67B6;&#x6784;&#x6D45;&#x6790;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes\">An Introduction to Kubernetes</a></li>\n</ol>"},{"title":"如何运行多进程Docker容器？","date":"2016-01-09T13:00:00.000Z","_content":"\n**摘要:** 本文介绍了两种在Docker容器中运行多个进程的方法: **shell脚本**和**supervisor**。\n\n**GitHub地址:**\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-01-09](http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/)\n\n## 一. 简介\n\n一般来说，Docker容器比较适合运行单个进程。例如，项目\"**使用多个Docker容器运行Kubernetes**\"，Kubernetes的各个组件分别运行在各个容器之中，每个容器只运行单个进程。\n\n然而，很多时候我们需要在Docker容器中运行多个进程。例如，项目\"**使用单个Docker容器运行Kubernetes**\"，kubernetes的各个组件均运行在同一个容器中，该容器中运行了多个进程。那么，**如何运行多进程Docker容器？**\n\n一种方法是使用**Shell脚本**，另一种方法是使用进程管理工具[Supervisor](http://supervisord.org/)。[kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)和[kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)分别采用了这两种方法，用于启动多个进程来运行Kubernetes的各个组件，从而实现\"**使用单个Docker容器运行Kubernetes**\"。下面我将分别介绍两种不同方法。\n\n## 二. 使用Shell脚本运行多进程Docker容器\n\n这个方法大家应该会比较熟悉，使用Shell脚本依次启动Kubernetes的各个组件即可。以下为**start-kubernetes.sh**\n\n```\n#!/bin/bash\n\n# start docker daemon\ndocker daemon > /var/log/docker.log 2>&1 &\n\n# start etcd\netcd --data-dir=/var/etcd/data > /var/log/etcd.log 2>&1 &\n\n# wait for ectd to setup\nsleep 5\n\n# start apiserver\nkube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001 > /var/log/kube-apiserver.log 2>&1 &\n\n# wait for apiserver to setup\nsleep 5\n\n# start controller manager, sheduler, kubelet and proxy\nkube-controller-manager --master=http://0.0.0.0:8080 > /var/log/kube-controller-manager.log 2>&1 &\nkube-scheduler --master=http://0.0.0.0:8080 > /var/log/kube-scheduler.log 2>&1 &\nkubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"  > /var/log/kubelet.log 2>&1 &\nkube-proxy --master=http://0.0.0.0:8080 > /var/log/kube-proxy.log 2>&1 &\n\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n然后在Dockerfile中，将**start-kubernetes.sh**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"start-kubernetes.sh\"]\n```\n\n**需要注意**的一点在于，**start-kubernetes.sh**脚本将作为Docker容器的1号进程运行，必须始终保持运行。因为**Docker容器仅在1号进程运行时保持运行**，换言之，Docker容器将在1号进程退出后**Exited**。由于Kubernetes的各个组件都以后台进程方式执行，我在脚本末尾添加了死循环，以保持**start-kubernetes.sh**脚本始终处于运行状态。\n\n```\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n## 三. 使用supervisor运行多进程Docker容器\n\n[Supervisor](http://supervisord.org/)是进程管理工具。这时，需要编写supervisor的配置文件**kubernetes.conf**:\n\n```\n[supervisord]\nnodaemon=true\n\n[program:etcd]\ncommand=etcd --data-dir=/var/etcd/data\nautorestart=true\nstdout_logfile=/var/log/etcd.stdout.log\nstderr_logfile=/var/log/etcd.stderr.log\n\n[program:kube-apiserver]\ncommand=kube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001\nautorestart=true\nstdout_logfile=/var/log/kube-apiserver.stdout.log\nstderr_logfile=/var/log/kube-apiserver.stderr.log\n\n[program:kube-controller-manager]\ncommand=kube-controller-manager --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/controller-manager.stdout.log\nstderr_logfile=/var/log/controller-manager.stderr.log\n\n[program:kube-scheduler]\ncommand=kube-scheduler --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-scheduler.stdout.log\nstderr_logfile=/var/log/kube-scheduler.stderr.log\n\n[program:kubelet]\ncommand=kubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"\nautorestart=true\nstdout_logfile=/var/log/kubelet.stdout.log\nstderr_logfile=/var/log/kubelet.stderr.log\n\n[program:kube-proxy]\ncommand=kube-proxy --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-proxy.stdout.log\nstderr_logfile=/var/log/kube-proxy.stderr.log\n\n[program:docker]\ncommand=docker daemon\nautorestart=true\nstdout_logfile=/var/log/docker.stdout.log\nstderr_logfile=/var/log/docker.stderr.log\n```\n\n可知，将Kubernetes的各个组件的启动命令设为command即可。autorestart参数设为true，意味着supervisor将负责重启意外退出的组件。stdout_logfile和stderr_logfile参数则可以用于设置命令的标准输出文件和标准错误输出文件。\n\n然后在Dockerfile中，将**supervisord**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/conf.d/kubernetes.conf\"]\n```\n\n此时, supervisord是Docker容器中的1号进程，也需要始终保持运行状态。nodaemon设为true时，表示supervisor保持前台运行而非在后台运行。若supervisor在后台运行，则Docker容器也会在执行supervisord命令后立即Exited.\n\n```\n[supervisord]\nnodaemon=true\n```\n\n\n\n## 四. 总结\n\n使用Shell脚本运行多进程Docker容器，优势是大家比较熟悉。由于需要保持Docker容器的1号进程始终运行，这一点比较容易出错。若要实现进程意外退出后自动重启的话，使用shell脚本比较麻烦。\n\n使用supervisor运行多进程Docker容器，非常方便。另外，保持1号进程保持运行，以及进程意外退出后自动重启，实现起来都很简单。\n\n\n#### **使用多个Docker容器运行Kubernetes**\n\n**GitHub地址**\n\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n#### **使用单个Docker容器运行Kubernetes**\n\n**GitHub地址:**\n\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n该项目中，我将kubernetes的所有组件：etcd, controller manager, apiserver, scheduler, kubelet, proxy以及docker daemon均运行在同一个Docker容器之中。\n\n容器启动时，各个组件由shell脚本或者supervisor启动。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width = \"500\"/>\n\n## 参考\n1. [Using Supervisor with Docker](https://docs.docker.com/engine/articles/using_supervisord/)\n2. [How To Install and Manage Supervisor on Ubuntu and Debian VPS](https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps)\n3. [基于Docker搭建单机版Kuberntes](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n4. [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n","source":"_posts/2016/01/09/160109-multiple-processes--docker-container.md","raw":"title: 如何运行多进程Docker容器？\n\ndate: 2016-01-09 21:00:00\n\ntags: [Docker, Kubernetes]\n\n---\n\n**摘要:** 本文介绍了两种在Docker容器中运行多个进程的方法: **shell脚本**和**supervisor**。\n\n**GitHub地址:**\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-01-09](http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/)\n\n## 一. 简介\n\n一般来说，Docker容器比较适合运行单个进程。例如，项目\"**使用多个Docker容器运行Kubernetes**\"，Kubernetes的各个组件分别运行在各个容器之中，每个容器只运行单个进程。\n\n然而，很多时候我们需要在Docker容器中运行多个进程。例如，项目\"**使用单个Docker容器运行Kubernetes**\"，kubernetes的各个组件均运行在同一个容器中，该容器中运行了多个进程。那么，**如何运行多进程Docker容器？**\n\n一种方法是使用**Shell脚本**，另一种方法是使用进程管理工具[Supervisor](http://supervisord.org/)。[kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)和[kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)分别采用了这两种方法，用于启动多个进程来运行Kubernetes的各个组件，从而实现\"**使用单个Docker容器运行Kubernetes**\"。下面我将分别介绍两种不同方法。\n\n## 二. 使用Shell脚本运行多进程Docker容器\n\n这个方法大家应该会比较熟悉，使用Shell脚本依次启动Kubernetes的各个组件即可。以下为**start-kubernetes.sh**\n\n```\n#!/bin/bash\n\n# start docker daemon\ndocker daemon > /var/log/docker.log 2>&1 &\n\n# start etcd\netcd --data-dir=/var/etcd/data > /var/log/etcd.log 2>&1 &\n\n# wait for ectd to setup\nsleep 5\n\n# start apiserver\nkube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001 > /var/log/kube-apiserver.log 2>&1 &\n\n# wait for apiserver to setup\nsleep 5\n\n# start controller manager, sheduler, kubelet and proxy\nkube-controller-manager --master=http://0.0.0.0:8080 > /var/log/kube-controller-manager.log 2>&1 &\nkube-scheduler --master=http://0.0.0.0:8080 > /var/log/kube-scheduler.log 2>&1 &\nkubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"  > /var/log/kubelet.log 2>&1 &\nkube-proxy --master=http://0.0.0.0:8080 > /var/log/kube-proxy.log 2>&1 &\n\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n然后在Dockerfile中，将**start-kubernetes.sh**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"start-kubernetes.sh\"]\n```\n\n**需要注意**的一点在于，**start-kubernetes.sh**脚本将作为Docker容器的1号进程运行，必须始终保持运行。因为**Docker容器仅在1号进程运行时保持运行**，换言之，Docker容器将在1号进程退出后**Exited**。由于Kubernetes的各个组件都以后台进程方式执行，我在脚本末尾添加了死循环，以保持**start-kubernetes.sh**脚本始终处于运行状态。\n\n```\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n## 三. 使用supervisor运行多进程Docker容器\n\n[Supervisor](http://supervisord.org/)是进程管理工具。这时，需要编写supervisor的配置文件**kubernetes.conf**:\n\n```\n[supervisord]\nnodaemon=true\n\n[program:etcd]\ncommand=etcd --data-dir=/var/etcd/data\nautorestart=true\nstdout_logfile=/var/log/etcd.stdout.log\nstderr_logfile=/var/log/etcd.stderr.log\n\n[program:kube-apiserver]\ncommand=kube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001\nautorestart=true\nstdout_logfile=/var/log/kube-apiserver.stdout.log\nstderr_logfile=/var/log/kube-apiserver.stderr.log\n\n[program:kube-controller-manager]\ncommand=kube-controller-manager --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/controller-manager.stdout.log\nstderr_logfile=/var/log/controller-manager.stderr.log\n\n[program:kube-scheduler]\ncommand=kube-scheduler --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-scheduler.stdout.log\nstderr_logfile=/var/log/kube-scheduler.stderr.log\n\n[program:kubelet]\ncommand=kubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"\nautorestart=true\nstdout_logfile=/var/log/kubelet.stdout.log\nstderr_logfile=/var/log/kubelet.stderr.log\n\n[program:kube-proxy]\ncommand=kube-proxy --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-proxy.stdout.log\nstderr_logfile=/var/log/kube-proxy.stderr.log\n\n[program:docker]\ncommand=docker daemon\nautorestart=true\nstdout_logfile=/var/log/docker.stdout.log\nstderr_logfile=/var/log/docker.stderr.log\n```\n\n可知，将Kubernetes的各个组件的启动命令设为command即可。autorestart参数设为true，意味着supervisor将负责重启意外退出的组件。stdout_logfile和stderr_logfile参数则可以用于设置命令的标准输出文件和标准错误输出文件。\n\n然后在Dockerfile中，将**supervisord**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/conf.d/kubernetes.conf\"]\n```\n\n此时, supervisord是Docker容器中的1号进程，也需要始终保持运行状态。nodaemon设为true时，表示supervisor保持前台运行而非在后台运行。若supervisor在后台运行，则Docker容器也会在执行supervisord命令后立即Exited.\n\n```\n[supervisord]\nnodaemon=true\n```\n\n\n\n## 四. 总结\n\n使用Shell脚本运行多进程Docker容器，优势是大家比较熟悉。由于需要保持Docker容器的1号进程始终运行，这一点比较容易出错。若要实现进程意外退出后自动重启的话，使用shell脚本比较麻烦。\n\n使用supervisor运行多进程Docker容器，非常方便。另外，保持1号进程保持运行，以及进程意外退出后自动重启，实现起来都很简单。\n\n\n#### **使用多个Docker容器运行Kubernetes**\n\n**GitHub地址**\n\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n#### **使用单个Docker容器运行Kubernetes**\n\n**GitHub地址:**\n\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n该项目中，我将kubernetes的所有组件：etcd, controller manager, apiserver, scheduler, kubelet, proxy以及docker daemon均运行在同一个Docker容器之中。\n\n容器启动时，各个组件由shell脚本或者supervisor启动。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width = \"500\"/>\n\n## 参考\n1. [Using Supervisor with Docker](https://docs.docker.com/engine/articles/using_supervisord/)\n2. [How To Install and Manage Supervisor on Ubuntu and Debian VPS](https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps)\n3. [基于Docker搭建单机版Kuberntes](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n4. [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n","slug":"2016/01/09/160109-multiple-processes--docker-container","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzv50008ivfy4q96zppf","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x79CD;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;: <strong>shell&#x811A;&#x672C;</strong>&#x548C;<strong>supervisor</strong>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/\">2016-01-09</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;Docker&#x5BB9;&#x5668;&#x6BD4;&#x8F83;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x53EA;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#xFF0C;<strong>&#x5982;&#x4F55;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF1F;</strong></p>\n<p>&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;<strong>Shell&#x811A;&#x672C;</strong>&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;<a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"external\">Supervisor</a>&#x3002;<a href=\"https://github.com/kiwenlau/kubernetes-shell\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-shell</a>&#x548C;<a href=\"https://github.com/kiwenlau/kubernetes-supervisor\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-supervisor</a>&#x5206;&#x522B;&#x91C7;&#x7528;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x6765;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x5C06;&#x5206;&#x522B;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x4F1A;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#xFF0C;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x4F9D;&#x6B21;&#x542F;&#x52A8;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5373;&#x53EF;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;<strong>start-kubernetes.sh</strong></p>\n<figure class=\"highlight maxima\"><table><tr><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\"># start docker daemon</div><div class=\"line\">docker daemon &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/docker.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># start etcd</div><div class=\"line\">etcd --data-dir=/<span class=\"built_in\">var</span>/etcd/data &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/etcd.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> ectd to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start apiserver</div><div class=\"line\">kube-apiserver --service-cluster-ip-<span class=\"built_in\">range</span>=<span class=\"number\">10.0</span>.0.1/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.0.0 --etcd_servers=http://<span class=\"number\">127.0</span>.0.1:<span class=\"number\">4001</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-apiserver.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> apiserver to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start controller manager, sheduler, kubelet <span class=\"keyword\">and</span> proxy</div><div class=\"line\">kube-controller-manager --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-controller-manager.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-scheduler --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-scheduler.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kubelet --api_servers=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.0.0 --cluster_dns=<span class=\"number\">10.0</span>.0.10 --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-<span class=\"built_in\">image</span>=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span>  &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kubelet.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-proxy --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-proxy.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> [[ <span class=\"literal\">true</span> ]]; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>start-kubernetes.sh</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;start-kubernetes.sh&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p><strong>&#x9700;&#x8981;&#x6CE8;&#x610F;</strong>&#x7684;&#x4E00;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x5C06;&#x4F5C;&#x4E3A;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x3002;&#x56E0;&#x4E3A;<strong>Docker&#x5BB9;&#x5668;&#x4EC5;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x65F6;&#x4FDD;&#x6301;&#x8FD0;&#x884C;</strong>&#xFF0C;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;Docker&#x5BB9;&#x5668;&#x5C06;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x540E;<strong>Exited</strong>&#x3002;&#x7531;&#x4E8E;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x90FD;&#x4EE5;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x6211;&#x5728;&#x811A;&#x672C;&#x672B;&#x5C3E;&#x6DFB;&#x52A0;&#x4E86;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x59CB;&#x7EC8;&#x5904;&#x4E8E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"code\"><pre><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> <span class=\"string\">[[ true ]]</span>; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p><a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"external\">Supervisor</a>&#x662F;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x7F16;&#x5199;supervisor&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<strong>kubernetes.conf</strong>:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:etcd]</div><div class=\"line\"><span class=\"attr\">command</span>=etcd --data-dir=/var/etcd/data</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/etcd.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/etcd.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-apiserver]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-apiserver --service-cluster-ip-range=<span class=\"number\">10.0</span>.<span class=\"number\">0.1</span>/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --etcd_servers=http://<span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">4001</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-apiserver.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-apiserver.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-controller-manager]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-controller-manager --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/controller-manager.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/controller-manager.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-scheduler]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-scheduler --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-scheduler.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-scheduler.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kubelet]</div><div class=\"line\"><span class=\"attr\">command</span>=kubelet --api_servers=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --cluster_dns=<span class=\"number\">10.0</span>.<span class=\"number\">0.10</span> --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-image=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kubelet.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kubelet.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-proxy]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-proxy --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-proxy.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-proxy.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:docker]</div><div class=\"line\"><span class=\"attr\">command</span>=docker daemon</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/docker.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/docker.stderr.log</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x8BBE;&#x4E3A;command&#x5373;&#x53EF;&#x3002;autorestart&#x53C2;&#x6570;&#x8BBE;&#x4E3A;true&#xFF0C;&#x610F;&#x5473;&#x7740;supervisor&#x5C06;&#x8D1F;&#x8D23;&#x91CD;&#x542F;&#x610F;&#x5916;&#x9000;&#x51FA;&#x7684;&#x7EC4;&#x4EF6;&#x3002;stdout_logfile&#x548C;stderr_logfile&#x53C2;&#x6570;&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x547D;&#x4EE4;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x548C;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>supervisord</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;supervisord&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;/etc/supervisor/conf.d/kubernetes.conf&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;, supervisord&#x662F;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;nodaemon&#x8BBE;&#x4E3A;true&#x65F6;&#xFF0C;&#x8868;&#x793A;supervisor&#x4FDD;&#x6301;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#x800C;&#x975E;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x3002;&#x82E5;supervisor&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;&#x5219;Docker&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x5728;&#x6267;&#x884C;supervisord&#x547D;&#x4EE4;&#x540E;&#x7ACB;&#x5373;Exited.</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x603B;&#x7ED3;\"><a href=\"#&#x56DB;-&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x56DB;. &#x603B;&#x7ED3;\"></a>&#x56DB;. &#x603B;&#x7ED3;</h2><p>&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x4F18;&#x52BF;&#x662F;&#x5927;&#x5BB6;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;&#x7531;&#x4E8E;&#x9700;&#x8981;&#x4FDD;&#x6301;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x59CB;&#x7EC8;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;&#x82E5;&#x8981;&#x5B9E;&#x73B0;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x3002;</p>\n<p>&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4FDD;&#x6301;1&#x53F7;&#x8FDB;&#x7A0B;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x53CA;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#xFF0C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;</p>\n<h4 id=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>\n<p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<h4 id=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>\n<p>&#x8BE5;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#xFF1A;etcd, controller manager, apiserver, scheduler, kubelet, proxy&#x4EE5;&#x53CA;docker daemon&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;</p>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7531;shell&#x811A;&#x672C;&#x6216;&#x8005;supervisor&#x542F;&#x52A8;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width=\"500\"></p>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://docs.docker.com/engine/articles/using_supervisord/\" target=\"_blank\" rel=\"external\">Using Supervisor with Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps\" target=\"_blank\" rel=\"external\">How To Install and Manage Supervisor on Ubuntu and Debian VPS</a></li>\n<li><a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes</a></li>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-kubernetes-docker</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x79CD;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;: <strong>shell&#x811A;&#x672C;</strong>&#x548C;<strong>supervisor</strong>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/\">2016-01-09</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;Docker&#x5BB9;&#x5668;&#x6BD4;&#x8F83;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x53EA;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#xFF0C;<strong>&#x5982;&#x4F55;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF1F;</strong></p>\n<p>&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;<strong>Shell&#x811A;&#x672C;</strong>&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;<a href=\"http://supervisord.org/\">Supervisor</a>&#x3002;<a href=\"https://github.com/kiwenlau/kubernetes-shell\">kiwenlau/kubernetes-shell</a>&#x548C;<a href=\"https://github.com/kiwenlau/kubernetes-supervisor\">kiwenlau/kubernetes-supervisor</a>&#x5206;&#x522B;&#x91C7;&#x7528;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x6765;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x5C06;&#x5206;&#x522B;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x4F1A;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#xFF0C;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x4F9D;&#x6B21;&#x542F;&#x52A8;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5373;&#x53EF;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;<strong>start-kubernetes.sh</strong></p>\n<figure class=\"highlight maxima\"><table><tr><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\"># start docker daemon</div><div class=\"line\">docker daemon &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/docker.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># start etcd</div><div class=\"line\">etcd --data-dir=/<span class=\"built_in\">var</span>/etcd/data &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/etcd.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> ectd to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start apiserver</div><div class=\"line\">kube-apiserver --service-cluster-ip-<span class=\"built_in\">range</span>=<span class=\"number\">10.0</span>.0.1/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.0.0 --etcd_servers=http://<span class=\"number\">127.0</span>.0.1:<span class=\"number\">4001</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-apiserver.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> apiserver to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start controller manager, sheduler, kubelet <span class=\"keyword\">and</span> proxy</div><div class=\"line\">kube-controller-manager --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-controller-manager.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-scheduler --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-scheduler.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kubelet --api_servers=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.0.0 --cluster_dns=<span class=\"number\">10.0</span>.0.10 --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-<span class=\"built_in\">image</span>=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span>  &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kubelet.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-proxy --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-proxy.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> [[ <span class=\"literal\">true</span> ]]; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>start-kubernetes.sh</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;start-kubernetes.sh&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p><strong>&#x9700;&#x8981;&#x6CE8;&#x610F;</strong>&#x7684;&#x4E00;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x5C06;&#x4F5C;&#x4E3A;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x3002;&#x56E0;&#x4E3A;<strong>Docker&#x5BB9;&#x5668;&#x4EC5;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x65F6;&#x4FDD;&#x6301;&#x8FD0;&#x884C;</strong>&#xFF0C;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;Docker&#x5BB9;&#x5668;&#x5C06;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x540E;<strong>Exited</strong>&#x3002;&#x7531;&#x4E8E;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x90FD;&#x4EE5;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x6211;&#x5728;&#x811A;&#x672C;&#x672B;&#x5C3E;&#x6DFB;&#x52A0;&#x4E86;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x59CB;&#x7EC8;&#x5904;&#x4E8E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"code\"><pre><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> <span class=\"string\">[[ true ]]</span>; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p><a href=\"http://supervisord.org/\">Supervisor</a>&#x662F;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x7F16;&#x5199;supervisor&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<strong>kubernetes.conf</strong>:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:etcd]</div><div class=\"line\"><span class=\"attr\">command</span>=etcd --data-dir=/var/etcd/data</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/etcd.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/etcd.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-apiserver]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-apiserver --service-cluster-ip-range=<span class=\"number\">10.0</span>.<span class=\"number\">0.1</span>/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --etcd_servers=http://<span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">4001</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-apiserver.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-apiserver.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-controller-manager]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-controller-manager --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/controller-manager.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/controller-manager.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-scheduler]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-scheduler --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-scheduler.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-scheduler.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kubelet]</div><div class=\"line\"><span class=\"attr\">command</span>=kubelet --api_servers=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --cluster_dns=<span class=\"number\">10.0</span>.<span class=\"number\">0.10</span> --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-image=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kubelet.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kubelet.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-proxy]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-proxy --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-proxy.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-proxy.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:docker]</div><div class=\"line\"><span class=\"attr\">command</span>=docker daemon</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/docker.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/docker.stderr.log</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x8BBE;&#x4E3A;command&#x5373;&#x53EF;&#x3002;autorestart&#x53C2;&#x6570;&#x8BBE;&#x4E3A;true&#xFF0C;&#x610F;&#x5473;&#x7740;supervisor&#x5C06;&#x8D1F;&#x8D23;&#x91CD;&#x542F;&#x610F;&#x5916;&#x9000;&#x51FA;&#x7684;&#x7EC4;&#x4EF6;&#x3002;stdout_logfile&#x548C;stderr_logfile&#x53C2;&#x6570;&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x547D;&#x4EE4;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x548C;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>supervisord</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;supervisord&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;/etc/supervisor/conf.d/kubernetes.conf&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;, supervisord&#x662F;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;nodaemon&#x8BBE;&#x4E3A;true&#x65F6;&#xFF0C;&#x8868;&#x793A;supervisor&#x4FDD;&#x6301;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#x800C;&#x975E;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x3002;&#x82E5;supervisor&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;&#x5219;Docker&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x5728;&#x6267;&#x884C;supervisord&#x547D;&#x4EE4;&#x540E;&#x7ACB;&#x5373;Exited.</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x603B;&#x7ED3;\"><a href=\"#&#x56DB;-&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x56DB;. &#x603B;&#x7ED3;\"></a>&#x56DB;. &#x603B;&#x7ED3;</h2><p>&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x4F18;&#x52BF;&#x662F;&#x5927;&#x5BB6;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;&#x7531;&#x4E8E;&#x9700;&#x8981;&#x4FDD;&#x6301;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x59CB;&#x7EC8;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;&#x82E5;&#x8981;&#x5B9E;&#x73B0;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x3002;</p>\n<p>&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4FDD;&#x6301;1&#x53F7;&#x8FDB;&#x7A0B;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x53CA;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#xFF0C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;</p>\n<h4 id=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>\n<p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<h4 id=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>\n<p>&#x8BE5;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#xFF1A;etcd, controller manager, apiserver, scheduler, kubelet, proxy&#x4EE5;&#x53CA;docker daemon&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;</p>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7531;shell&#x811A;&#x672C;&#x6216;&#x8005;supervisor&#x542F;&#x52A8;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width=\"500\"></p>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://docs.docker.com/engine/articles/using_supervisord/\">Using Supervisor with Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps\">How To Install and Manage Supervisor on Ubuntu and Debian VPS</a></li>\n<li><a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes</a></li>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\">kiwenlau/single-kubernetes-docker</a></li>\n</ol>"},{"title":"使用Vagrant创建多节点虚拟机集群","date":"2016-07-03T02:00:00.000Z","_content":"\n**摘要:** 在前一篇博客中，我介绍了[使用Vagrant快速创建虚拟机](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)，但是所创建的只是单个虚拟机。这篇博客将介绍[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以作为[Hadoop](http://hadoop.apache.org/)，[Spark](http://spark.apache.org/)以及[Storm](http://storm.apache.org/)等分布式系统的运行环境。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-03](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)\n\n<img src=\"vagrant-vm-cluster/vagrant-vm-cluster.png\" width = \"500\"/>\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n## 一. 集群创建\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 下载Box**\n\n```\nvagrant box add ubuntu/trusty64\n```\n\n**Box**相当于虚拟机所依赖的镜像文件。\n\n#### **4. 编辑Vagrantfile**\n\n```\nmkdir vagrant-cluster\ncd vagrant-cluster\nvim Vagrantfile\n```\n\nVagrantfile如下，可以通过注释理解每个自定义配置的含义：\n\n```\nVagrant.configure(\"2\") do |config|\n\n\t(1..3).each do |i|\n\n\t\tconfig.vm.define \"node#{i}\" do |node|\n\n\t\t# 设置虚拟机的Box\n\t\tnode.vm.box = \"ubuntu/trusty64\"\n\n\t\t# 设置虚拟机的主机名\n\t\tnode.vm.hostname=\"node#{i}\"\n\n\t\t# 设置虚拟机的IP\n\t\tnode.vm.network \"private_network\", ip: \"192.168.59.#{i}\"\n\n\t\t# 设置主机与虚拟机的共享目录\n\t\tnode.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n\t\t# VirtaulBox相关配置\n\t\tnode.vm.provider \"virtualbox\" do |v|\n\n\t\t\t# 设置虚拟机的名称\n\t\t\tv.name = \"node#{i}\"\n\n\t\t\t# 设置虚拟机的内存大小  \n\t\t\tv.memory = 2048\n\n\t\t\t# 设置虚拟机的CPU个数\n\t\t\tv.cpus = 1\n\t\tend\n  \n\t\t# 使用shell脚本进行软件安装和配置\n\t\tnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t\t\t# 安装docker 1.11.0\n\t\t\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\t\t\tusermod -aG docker vagrant\n\t\t\t\n\t\tSHELL\n\n\t\tend\n\tend\nend\n```\n\n与创建单个虚拟机相比，创建多个虚拟机时多了一层循环，而变量i可以用于设置节点的名称与IP，使用**#{i}**取值：\n\n```\n(1..3).each do |i|\n\nend\n```\n\n可知，一共创建了3个虚拟机。\n\n#### **5. 在桌面上创建share目录**\n\n桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **6. 创建虚拟机**\n\n```\nvagrant up\n```\n\n创建3个虚拟机大概需要15分钟，当然这和机器性能还有网速相关。安装Docker可能会比较慢，不需要的话删除下面几行就可以了：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\n\nSHELL\n```\n\n下面是Vagrant虚拟机的配置，可以根据需要进行更改:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n- 内存：2GB\n- CPU: 1\n\n\n## 二. 集群管理\n\n#### **1. 常用命令**\n\n下面是一些常用的Vagrant管理命令，操作特定虚拟机时仅需指定虚拟机的名称。\n\n- **vagrant ssh:** SSH登陆虚拟机\n- **vagrant halt:** 关闭虚拟机\n- **vagrant destroy:** 删除虚拟机\n- **vagrant ssh-config** 查看虚拟机SSH配置\n\n**启动单个虚拟机：**\n\n```\nvagrant up node1\n```\n\n**启动多个虚拟机：**\n\n```\nvagrant up node1 node3\n```\n\n**启动所有虚拟机：**\n\n```\nvagrant up\n```\n\n#### **2. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.59.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH免密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@192.168.59.2 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n#### **3. 重新安装软件**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\nSHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provision\n```\n\n#### **4. 共享目录挂载出错**\n\nVirtualBox设置共享目录时需要在虚拟机中安装VirtualBox Guest Additions，这个Vagrant会自动安装。但是，VirtualBox Guest Additions是内核模块，当虚拟机的内核升级之后，VirtualBox Guest Additions会失效，导致共享目录挂载失败，出错信息如下:\n\n```\nFailed to mount folders in Linux guest. This is usually because\nthe \"vboxsf\" file system is not available. Please verify that\nthe guest additions are properly installed in the guest and\ncan work properly. The command attempted was:\n\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant\n\nThe error output from the last command was:\n\nstdin: is not a tty\n/sbin/mount.vboxsf: mounting failed with the error: No such device\n```\n\n安装Vagrant插件[vagrant-vbguest](https://github.com/dotless-de/vagrant-vbguest)可以解决这个问题，因为该插件会在虚拟机内核升级之后重新安装VirtualBox Guest Additions。\n\n```\nvagrant plugin install vagrant-vbguest\n```","source":"_posts/2016/07/03/vagrant-vm-cluster.md","raw":"title: 使用Vagrant创建多节点虚拟机集群\n\ndate: 2016-07-03 10:00\n\ntags: [Vagrant]\n\n---\n\n**摘要:** 在前一篇博客中，我介绍了[使用Vagrant快速创建虚拟机](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)，但是所创建的只是单个虚拟机。这篇博客将介绍[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以作为[Hadoop](http://hadoop.apache.org/)，[Spark](http://spark.apache.org/)以及[Storm](http://storm.apache.org/)等分布式系统的运行环境。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-03](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)\n\n<img src=\"vagrant-vm-cluster/vagrant-vm-cluster.png\" width = \"500\"/>\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n## 一. 集群创建\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 下载Box**\n\n```\nvagrant box add ubuntu/trusty64\n```\n\n**Box**相当于虚拟机所依赖的镜像文件。\n\n#### **4. 编辑Vagrantfile**\n\n```\nmkdir vagrant-cluster\ncd vagrant-cluster\nvim Vagrantfile\n```\n\nVagrantfile如下，可以通过注释理解每个自定义配置的含义：\n\n```\nVagrant.configure(\"2\") do |config|\n\n\t(1..3).each do |i|\n\n\t\tconfig.vm.define \"node#{i}\" do |node|\n\n\t\t# 设置虚拟机的Box\n\t\tnode.vm.box = \"ubuntu/trusty64\"\n\n\t\t# 设置虚拟机的主机名\n\t\tnode.vm.hostname=\"node#{i}\"\n\n\t\t# 设置虚拟机的IP\n\t\tnode.vm.network \"private_network\", ip: \"192.168.59.#{i}\"\n\n\t\t# 设置主机与虚拟机的共享目录\n\t\tnode.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n\t\t# VirtaulBox相关配置\n\t\tnode.vm.provider \"virtualbox\" do |v|\n\n\t\t\t# 设置虚拟机的名称\n\t\t\tv.name = \"node#{i}\"\n\n\t\t\t# 设置虚拟机的内存大小  \n\t\t\tv.memory = 2048\n\n\t\t\t# 设置虚拟机的CPU个数\n\t\t\tv.cpus = 1\n\t\tend\n  \n\t\t# 使用shell脚本进行软件安装和配置\n\t\tnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t\t\t# 安装docker 1.11.0\n\t\t\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\t\t\tusermod -aG docker vagrant\n\t\t\t\n\t\tSHELL\n\n\t\tend\n\tend\nend\n```\n\n与创建单个虚拟机相比，创建多个虚拟机时多了一层循环，而变量i可以用于设置节点的名称与IP，使用**#{i}**取值：\n\n```\n(1..3).each do |i|\n\nend\n```\n\n可知，一共创建了3个虚拟机。\n\n#### **5. 在桌面上创建share目录**\n\n桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **6. 创建虚拟机**\n\n```\nvagrant up\n```\n\n创建3个虚拟机大概需要15分钟，当然这和机器性能还有网速相关。安装Docker可能会比较慢，不需要的话删除下面几行就可以了：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\n\nSHELL\n```\n\n下面是Vagrant虚拟机的配置，可以根据需要进行更改:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n- 内存：2GB\n- CPU: 1\n\n\n## 二. 集群管理\n\n#### **1. 常用命令**\n\n下面是一些常用的Vagrant管理命令，操作特定虚拟机时仅需指定虚拟机的名称。\n\n- **vagrant ssh:** SSH登陆虚拟机\n- **vagrant halt:** 关闭虚拟机\n- **vagrant destroy:** 删除虚拟机\n- **vagrant ssh-config** 查看虚拟机SSH配置\n\n**启动单个虚拟机：**\n\n```\nvagrant up node1\n```\n\n**启动多个虚拟机：**\n\n```\nvagrant up node1 node3\n```\n\n**启动所有虚拟机：**\n\n```\nvagrant up\n```\n\n#### **2. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.59.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH免密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@192.168.59.2 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n#### **3. 重新安装软件**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\nSHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provision\n```\n\n#### **4. 共享目录挂载出错**\n\nVirtualBox设置共享目录时需要在虚拟机中安装VirtualBox Guest Additions，这个Vagrant会自动安装。但是，VirtualBox Guest Additions是内核模块，当虚拟机的内核升级之后，VirtualBox Guest Additions会失效，导致共享目录挂载失败，出错信息如下:\n\n```\nFailed to mount folders in Linux guest. This is usually because\nthe \"vboxsf\" file system is not available. Please verify that\nthe guest additions are properly installed in the guest and\ncan work properly. The command attempted was:\n\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant\n\nThe error output from the last command was:\n\nstdin: is not a tty\n/sbin/mount.vboxsf: mounting failed with the error: No such device\n```\n\n安装Vagrant插件[vagrant-vbguest](https://github.com/dotless-de/vagrant-vbguest)可以解决这个问题，因为该插件会在虚拟机内核升级之后重新安装VirtualBox Guest Additions。\n\n```\nvagrant plugin install vagrant-vbguest\n```","slug":"2016/07/03/vagrant-vm-cluster","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzv9000aivfyev9sicmz","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">&#x4F7F;&#x7528;Vagrant&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</a>&#xFF0C;&#x4F46;&#x662F;&#x6240;&#x521B;&#x5EFA;&#x7684;&#x53EA;&#x662F;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a>&#xFF0C;<a href=\"http://spark.apache.org/\" target=\"_blank\" rel=\"external\">Spark</a>&#x4EE5;&#x53CA;<a href=\"http://storm.apache.org/\" target=\"_blank\" rel=\"external\">Storm</a>&#x7B49;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">2016-07-03</a></li>\n</ul>\n<p><img src=\"/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png\" width=\"500\"></p>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"><a href=\"#&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\" class=\"headerlink\" title=\"&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"></a>&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\" target=\"_blank\" rel=\"external\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\" target=\"_blank\" rel=\"external\">Vagrant</a></strong></h4><h4 id=\"3-&#x4E0B;&#x8F7D;Box\"><a href=\"#3-&#x4E0B;&#x8F7D;Box\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Box\"></a><strong>3. &#x4E0B;&#x8F7D;Box</strong></h4><figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">vagrant</span> <span class=\"keyword\">box </span><span class=\"keyword\">add </span>ubuntu/trusty64</div></pre></td></tr></table></figure>\n<p><strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;</p>\n<h4 id=\"4-&#x7F16;&#x8F91;Vagrantfile\"><a href=\"#4-&#x7F16;&#x8F91;Vagrantfile\" class=\"headerlink\" title=\"4. &#x7F16;&#x8F91;Vagrantfile\"></a><strong>4. &#x7F16;&#x8F91;Vagrantfile</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">mkdir</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\">vim Vagrantfile</div></pre></td></tr></table></figure>\n<p>Vagrantfile&#x5982;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#xFF1A;</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"string\">&quot;2&quot;</span>) do |config|</div><div class=\"line\"></div><div class=\"line\">\t(<span class=\"number\">1</span>..<span class=\"number\">3</span>).each do |i|</div><div class=\"line\"></div><div class=\"line\">\t\tconfig.vm.define <span class=\"string\">&quot;node#{i}&quot;</span> do |<span class=\"keyword\">node</span><span class=\"title\">|</span></div><div class=\"line\"></div><div class=\"line\">\t\t# &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.<span class=\"attr\">hostname=</span><span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.59.#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provider <span class=\"string\">&quot;virtualbox&quot;</span> do |v|</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">\t\t\tv.name = <span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;  </span></div><div class=\"line\">\t\t\tv.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">\t\t\tv.cpus = <span class=\"number\">1</span></div><div class=\"line\">\t\tend</div><div class=\"line\">  </div><div class=\"line\">\t\t<span class=\"comment\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: <span class=\"tag\">&lt;&lt;-SHELL</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t# &#x5B89;&#x88C5;docker 1.11.0</div><div class=\"line\">\t\t\twget -qO- https://get.docker.com/ | sed &apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos; | sh</div><div class=\"line\">\t\t\tusermod -aG docker vagrant</div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\tSHELL</div><div class=\"line\"></div><div class=\"line\">\t\tend</div><div class=\"line\">\tend</div><div class=\"line\">end</div></pre></td></tr></table></figure>\n<p>&#x4E0E;&#x521B;&#x5EFA;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x76F8;&#x6BD4;&#xFF0C;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x5FAA;&#x73AF;&#xFF0C;&#x800C;&#x53D8;&#x91CF;i&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x540D;&#x79F0;&#x4E0E;IP&#xFF0C;&#x4F7F;&#x7528;<strong>#{i}</strong>&#x53D6;&#x503C;&#xFF1A;</p>\n<figure class=\"highlight coq\"><table><tr><td class=\"code\"><pre><div class=\"line\">(<span class=\"number\">1.</span><span class=\"number\">.3</span>).each <span class=\"built_in\">do</span> |<span class=\"type\">i</span>|</div><div class=\"line\"></div><div class=\"line\"><span class=\"type\">end</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4E00;&#x5171;&#x521B;&#x5EFA;&#x4E86;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;</p>\n<h4 id=\"5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x5927;&#x6982;&#x9700;&#x8981;15&#x5206;&#x949F;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x548C;&#x673A;&#x5668;&#x6027;&#x80FD;&#x8FD8;&#x6709;&#x7F51;&#x901F;&#x76F8;&#x5173;&#x3002;&#x5B89;&#x88C5;Docker&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x6162;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x5220;&#x9664;&#x4E0B;&#x9762;&#x51E0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x662F;Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x66F4;&#x6539;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;2GB</li>\n<li>CPU: 1</li>\n</ul>\n<h2 id=\"&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"><a href=\"#&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"></a>&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;</h2><h4 id=\"1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\"><a href=\"#1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\" class=\"headerlink\" title=\"1. &#x5E38;&#x7528;&#x547D;&#x4EE4;\"></a><strong>1. &#x5E38;&#x7528;&#x547D;&#x4EE4;</strong></h4><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;Vagrant&#x7BA1;&#x7406;&#x547D;&#x4EE4;&#xFF0C;&#x64CD;&#x4F5C;&#x7279;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x4EC5;&#x9700;&#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<ul>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant halt:</strong> &#x5173;&#x95ED;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant destroy:</strong> &#x5220;&#x9664;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh-config</strong> &#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;SSH&#x914D;&#x7F6E;</li>\n</ul>\n<p><strong>&#x542F;&#x52A8;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1 node3</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x6240;&#x6709;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">59</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">192.168.59.2</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant halt</div><div class=\"line\">vagrant up <span class=\"comment\">--provision</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"><a href=\"#4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\" class=\"headerlink\" title=\"4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"></a><strong>4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;</strong></h4><p>VirtualBox&#x8BBE;&#x7F6E;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x65F6;&#x9700;&#x8981;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x5B89;&#x88C5;VirtualBox Guest Additions&#xFF0C;&#x8FD9;&#x4E2A;Vagrant&#x4F1A;&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x3002;&#x4F46;&#x662F;&#xFF0C;VirtualBox Guest Additions&#x662F;&#x5185;&#x6838;&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#xFF0C;VirtualBox Guest Additions&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x5BFC;&#x81F4;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">Failed <span class=\"built_in\">to</span> mount <span class=\"built_in\">folders</span> <span class=\"keyword\">in</span> Linux guest. This is usually because</div><div class=\"line\"><span class=\"keyword\">the</span> <span class=\"string\">&quot;vboxsf&quot;</span> <span class=\"built_in\">file</span> <span class=\"keyword\">system</span> is <span class=\"keyword\">not</span> available. Please verify that</div><div class=\"line\"><span class=\"keyword\">the</span> guest additions are properly installed <span class=\"keyword\">in</span> <span class=\"keyword\">the</span> guest <span class=\"keyword\">and</span></div><div class=\"line\">can work properly. The <span class=\"keyword\">command</span> <span class=\"title\">attempted</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant</div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant</div><div class=\"line\"></div><div class=\"line\">The error output <span class=\"built_in\">from</span> <span class=\"keyword\">the</span> <span class=\"keyword\">last</span> <span class=\"keyword\">command</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">stdin</span>: is <span class=\"keyword\">not</span> <span class=\"keyword\">a</span> tty</div><div class=\"line\">/sbin/mount.vboxsf: mounting failed <span class=\"keyword\">with</span> <span class=\"keyword\">the</span> error: No such device</div></pre></td></tr></table></figure>\n<p>&#x5B89;&#x88C5;Vagrant&#x63D2;&#x4EF6;<a href=\"https://github.com/dotless-de/vagrant-vbguest\" target=\"_blank\" rel=\"external\">vagrant-vbguest</a>&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x63D2;&#x4EF6;&#x4F1A;&#x5728;&#x865A;&#x62DF;&#x673A;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x5B89;&#x88C5;VirtualBox Guest Additions&#x3002;</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant plugin <span class=\"keyword\">install</span> vagrant-vbguest</div></pre></td></tr></table></figure>","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">&#x4F7F;&#x7528;Vagrant&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</a>&#xFF0C;&#x4F46;&#x662F;&#x6240;&#x521B;&#x5EFA;&#x7684;&#x53EA;&#x662F;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<a href=\"http://hadoop.apache.org/\">Hadoop</a>&#xFF0C;<a href=\"http://spark.apache.org/\">Spark</a>&#x4EE5;&#x53CA;<a href=\"http://storm.apache.org/\">Storm</a>&#x7B49;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">2016-07-03</a></li>\n</ul>\n<p><img src=\"/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png\" width=\"500\"></p>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"><a href=\"#&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\" class=\"headerlink\" title=\"&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"></a>&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\">Vagrant</a></strong></h4><h4 id=\"3-&#x4E0B;&#x8F7D;Box\"><a href=\"#3-&#x4E0B;&#x8F7D;Box\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Box\"></a><strong>3. &#x4E0B;&#x8F7D;Box</strong></h4><figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">vagrant</span> <span class=\"keyword\">box </span><span class=\"keyword\">add </span>ubuntu/trusty64</div></pre></td></tr></table></figure>\n<p><strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;</p>\n<h4 id=\"4-&#x7F16;&#x8F91;Vagrantfile\"><a href=\"#4-&#x7F16;&#x8F91;Vagrantfile\" class=\"headerlink\" title=\"4. &#x7F16;&#x8F91;Vagrantfile\"></a><strong>4. &#x7F16;&#x8F91;Vagrantfile</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">mkdir</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\">vim Vagrantfile</div></pre></td></tr></table></figure>\n<p>Vagrantfile&#x5982;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#xFF1A;</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"string\">&quot;2&quot;</span>) do |config|</div><div class=\"line\"></div><div class=\"line\">\t(<span class=\"number\">1</span>..<span class=\"number\">3</span>).each do |i|</div><div class=\"line\"></div><div class=\"line\">\t\tconfig.vm.define <span class=\"string\">&quot;node#{i}&quot;</span> do |<span class=\"keyword\">node</span><span class=\"title\">|</span></div><div class=\"line\"></div><div class=\"line\">\t\t# &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.<span class=\"attr\">hostname=</span><span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.59.#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provider <span class=\"string\">&quot;virtualbox&quot;</span> do |v|</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">\t\t\tv.name = <span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;  </span></div><div class=\"line\">\t\t\tv.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">\t\t\tv.cpus = <span class=\"number\">1</span></div><div class=\"line\">\t\tend</div><div class=\"line\">  </div><div class=\"line\">\t\t<span class=\"comment\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: <span class=\"tag\">&lt;&lt;-SHELL</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t# &#x5B89;&#x88C5;docker 1.11.0</div><div class=\"line\">\t\t\twget -qO- https://get.docker.com/ | sed &apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos; | sh</div><div class=\"line\">\t\t\tusermod -aG docker vagrant</div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\tSHELL</div><div class=\"line\"></div><div class=\"line\">\t\tend</div><div class=\"line\">\tend</div><div class=\"line\">end</div></pre></td></tr></table></figure>\n<p>&#x4E0E;&#x521B;&#x5EFA;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x76F8;&#x6BD4;&#xFF0C;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x5FAA;&#x73AF;&#xFF0C;&#x800C;&#x53D8;&#x91CF;i&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x540D;&#x79F0;&#x4E0E;IP&#xFF0C;&#x4F7F;&#x7528;<strong>#{i}</strong>&#x53D6;&#x503C;&#xFF1A;</p>\n<figure class=\"highlight coq\"><table><tr><td class=\"code\"><pre><div class=\"line\">(<span class=\"number\">1.</span><span class=\"number\">.3</span>).each <span class=\"built_in\">do</span> |<span class=\"type\">i</span>|</div><div class=\"line\"></div><div class=\"line\"><span class=\"type\">end</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4E00;&#x5171;&#x521B;&#x5EFA;&#x4E86;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;</p>\n<h4 id=\"5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x5927;&#x6982;&#x9700;&#x8981;15&#x5206;&#x949F;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x548C;&#x673A;&#x5668;&#x6027;&#x80FD;&#x8FD8;&#x6709;&#x7F51;&#x901F;&#x76F8;&#x5173;&#x3002;&#x5B89;&#x88C5;Docker&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x6162;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x5220;&#x9664;&#x4E0B;&#x9762;&#x51E0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x662F;Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x66F4;&#x6539;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;2GB</li>\n<li>CPU: 1</li>\n</ul>\n<h2 id=\"&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"><a href=\"#&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"></a>&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;</h2><h4 id=\"1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\"><a href=\"#1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\" class=\"headerlink\" title=\"1. &#x5E38;&#x7528;&#x547D;&#x4EE4;\"></a><strong>1. &#x5E38;&#x7528;&#x547D;&#x4EE4;</strong></h4><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;Vagrant&#x7BA1;&#x7406;&#x547D;&#x4EE4;&#xFF0C;&#x64CD;&#x4F5C;&#x7279;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x4EC5;&#x9700;&#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<ul>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant halt:</strong> &#x5173;&#x95ED;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant destroy:</strong> &#x5220;&#x9664;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh-config</strong> &#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;SSH&#x914D;&#x7F6E;</li>\n</ul>\n<p><strong>&#x542F;&#x52A8;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1 node3</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x6240;&#x6709;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">59</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">192.168.59.2</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant halt</div><div class=\"line\">vagrant up <span class=\"comment\">--provision</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"><a href=\"#4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\" class=\"headerlink\" title=\"4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"></a><strong>4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;</strong></h4><p>VirtualBox&#x8BBE;&#x7F6E;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x65F6;&#x9700;&#x8981;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x5B89;&#x88C5;VirtualBox Guest Additions&#xFF0C;&#x8FD9;&#x4E2A;Vagrant&#x4F1A;&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x3002;&#x4F46;&#x662F;&#xFF0C;VirtualBox Guest Additions&#x662F;&#x5185;&#x6838;&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#xFF0C;VirtualBox Guest Additions&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x5BFC;&#x81F4;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">Failed <span class=\"built_in\">to</span> mount <span class=\"built_in\">folders</span> <span class=\"keyword\">in</span> Linux guest. This is usually because</div><div class=\"line\"><span class=\"keyword\">the</span> <span class=\"string\">&quot;vboxsf&quot;</span> <span class=\"built_in\">file</span> <span class=\"keyword\">system</span> is <span class=\"keyword\">not</span> available. Please verify that</div><div class=\"line\"><span class=\"keyword\">the</span> guest additions are properly installed <span class=\"keyword\">in</span> <span class=\"keyword\">the</span> guest <span class=\"keyword\">and</span></div><div class=\"line\">can work properly. The <span class=\"keyword\">command</span> <span class=\"title\">attempted</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant</div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant</div><div class=\"line\"></div><div class=\"line\">The error output <span class=\"built_in\">from</span> <span class=\"keyword\">the</span> <span class=\"keyword\">last</span> <span class=\"keyword\">command</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">stdin</span>: is <span class=\"keyword\">not</span> <span class=\"keyword\">a</span> tty</div><div class=\"line\">/sbin/mount.vboxsf: mounting failed <span class=\"keyword\">with</span> <span class=\"keyword\">the</span> error: No such device</div></pre></td></tr></table></figure>\n<p>&#x5B89;&#x88C5;Vagrant&#x63D2;&#x4EF6;<a href=\"https://github.com/dotless-de/vagrant-vbguest\">vagrant-vbguest</a>&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x63D2;&#x4EF6;&#x4F1A;&#x5728;&#x865A;&#x62DF;&#x673A;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x5B89;&#x88C5;VirtualBox Guest Additions&#x3002;</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant plugin <span class=\"keyword\">install</span> vagrant-vbguest</div></pre></td></tr></table></figure>"},{"title":"基于Docker编译Hadoop","date":"2016-06-05T02:00:00.000Z","_content":"\n**摘要:** 将编译Hadoop所需要的依赖软件安装到Docker镜像中，然后在Docker容器中编译Hadoop，可以提高编译效率，同时避免污染主机。编译其他软件时，也可以参考这篇博客的方法。\n\n**GitHub地址:**\n- [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-05](http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/)\n\n<img src=\"160605-compile-hadoop-docker/hadoop-docker.png\" width = \"300\"/>\n\n在前一篇博客中，我介绍了[64位Ubuntu中编译Hadoop的步骤](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)。这篇博客将介绍基于Docker编译Hadoop的方法。\n\n## 一. 编译步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/compile-hadoop\n```\n\n或者自行构建Docker镜像\n\n```\nsudo docker build -t kiwenlau/compile-hadoop .\n```\n\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nexport VERSION=2.7.2\nwget http://archive.apache.org/dist/hadoop/core/hadoop-$VERSION/hadoop-$VERSION-src.tar.gz\ntar -xzvf hadoop-$VERSION-src.tar.gz\n```\n\n#### **3. 运行Docker容器，在容器中编译Hadoop**\n\n```\nsudo docker run -v $(pwd)/hadoop-$VERSION-src:/hadoop-$VERSION-src kiwenlau/compile-hadoop /root/compile.sh $VERSION\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 23:46.056s\n[INFO] Finished at: Tue May 31 16:40:53 UTC 2016\n[INFO] Final Memory: 210M/915M\n[INFO] ------------------------------------------------------------------------\n\n\ncomile hadoop 2.7.2 success!\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.7.2-src/hadoop-dist/target/hadoop-2.7.2.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，仅需改变VERSION的值。\n\n可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/$VERSION/hadoop-VERSION.tar.gz\n```\n\n## 二. 方法总结\n\n编译其他软件时，也可以参考本文介绍的方法，具体细节可以参考源码[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n#### **1. 构建编译所需的Docker镜像**\n\n编译软件往往需要安装很多依赖，而编译不同的软件有时需要不同版本的依赖，如果直接在主机上安装这些依赖会污染主机，而且也不易重复。\n\n#### **2. 下载软件源码**\n\n源码不放在Docker镜像里面，可以方便编译不同版本的软件，也可以提高构建Docker镜像的效率。\n\n#### **3. 运行Docker容器编译软件**\n\n软件源码以数据卷(volume)的形式挂载的容器内，编译所得的可执行文件也将位于数据卷内。\n\n","source":"_posts/2016/06/05/160605-compile-hadoop-docker.md","raw":"title: 基于Docker编译Hadoop\n\ndate: 2016-06-05 10:00\n\ntags: [Docker, Hadoop]\n\n---\n\n**摘要:** 将编译Hadoop所需要的依赖软件安装到Docker镜像中，然后在Docker容器中编译Hadoop，可以提高编译效率，同时避免污染主机。编译其他软件时，也可以参考这篇博客的方法。\n\n**GitHub地址:**\n- [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-05](http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/)\n\n<img src=\"160605-compile-hadoop-docker/hadoop-docker.png\" width = \"300\"/>\n\n在前一篇博客中，我介绍了[64位Ubuntu中编译Hadoop的步骤](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)。这篇博客将介绍基于Docker编译Hadoop的方法。\n\n## 一. 编译步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/compile-hadoop\n```\n\n或者自行构建Docker镜像\n\n```\nsudo docker build -t kiwenlau/compile-hadoop .\n```\n\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nexport VERSION=2.7.2\nwget http://archive.apache.org/dist/hadoop/core/hadoop-$VERSION/hadoop-$VERSION-src.tar.gz\ntar -xzvf hadoop-$VERSION-src.tar.gz\n```\n\n#### **3. 运行Docker容器，在容器中编译Hadoop**\n\n```\nsudo docker run -v $(pwd)/hadoop-$VERSION-src:/hadoop-$VERSION-src kiwenlau/compile-hadoop /root/compile.sh $VERSION\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 23:46.056s\n[INFO] Finished at: Tue May 31 16:40:53 UTC 2016\n[INFO] Final Memory: 210M/915M\n[INFO] ------------------------------------------------------------------------\n\n\ncomile hadoop 2.7.2 success!\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.7.2-src/hadoop-dist/target/hadoop-2.7.2.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，仅需改变VERSION的值。\n\n可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/$VERSION/hadoop-VERSION.tar.gz\n```\n\n## 二. 方法总结\n\n编译其他软件时，也可以参考本文介绍的方法，具体细节可以参考源码[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n#### **1. 构建编译所需的Docker镜像**\n\n编译软件往往需要安装很多依赖，而编译不同的软件有时需要不同版本的依赖，如果直接在主机上安装这些依赖会污染主机，而且也不易重复。\n\n#### **2. 下载软件源码**\n\n源码不放在Docker镜像里面，可以方便编译不同版本的软件，也可以提高构建Docker镜像的效率。\n\n#### **3. 运行Docker容器编译软件**\n\n软件源码以数据卷(volume)的形式挂载的容器内，编译所得的可执行文件也将位于数据卷内。\n\n","slug":"2016/06/05/160605-compile-hadoop-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzw2000vivfy1504vebk","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x7F16;&#x8BD1;Hadoop&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x7F16;&#x8BD1;&#x6548;&#x7387;&#xFF0C;&#x540C;&#x65F6;&#x907F;&#x514D;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#x3002;&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/\">2016-06-05</a></li>\n</ul>\n<p><img src=\"/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png\" width=\"300\"></p>\n<p>&#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">64&#x4F4D;Ubuntu&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;</a>&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x57FA;&#x4E8E;Docker&#x7F16;&#x8BD1;Hadoop&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"></a>&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"keyword\">compile</span>-hadoop</div></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x81EA;&#x884C;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">sudo</span> docker <span class=\"keyword\">build </span>-t kiwenlau/compile-hadoop .</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\" target=\"_blank\" rel=\"external\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight elixir\"><table><tr><td class=\"code\"><pre><div class=\"line\">export VERSION=<span class=\"number\">2.7</span>.<span class=\"number\">2</span></div><div class=\"line\">wget <span class=\"symbol\">http:</span>/<span class=\"regexp\">/archive.apache.org/dist</span><span class=\"regexp\">/hadoop/core</span><span class=\"regexp\">/hadoop-$VERSION/hadoop</span>-<span class=\"variable\">$VERSION</span>-src.tar.gz</div><div class=\"line\">tar -xzvf hadoop-<span class=\"variable\">$VERSION</span>-src.tar.gz</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> -v $(<span class=\"built_in\">pwd</span>)/hadoop-<span class=\"variable\">$VERSION</span>-src:/hadoop-<span class=\"variable\">$VERSION</span>-src kiwenlau/compile-hadoop /root/compile.sh <span class=\"variable\">$VERSION</span></span></div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">23</span><span class=\"selector-pseudo\">:46.056s</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Tue</span> <span class=\"selector-tag\">May</span> <span class=\"selector-tag\">31</span> <span class=\"selector-tag\">16</span><span class=\"selector-pseudo\">:40</span><span class=\"selector-pseudo\">:53</span> <span class=\"selector-tag\">UTC</span> <span class=\"selector-tag\">2016</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">210M</span>/<span class=\"selector-tag\">915M</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">comile</span> <span class=\"selector-tag\">hadoop</span> <span class=\"selector-tag\">2</span><span class=\"selector-class\">.7</span><span class=\"selector-class\">.2</span> <span class=\"selector-tag\">success</span>!</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4EC5;&#x9700;&#x6539;&#x53D8;VERSION&#x7684;&#x503C;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/$VERSION/</span>hadoop-VERSION.tar.gz</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"><a href=\"#&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"></a>&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;</h2><p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6E90;&#x7801;<a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a></p>\n<h4 id=\"1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;</strong></h4><p>&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x5F88;&#x591A;&#x4F9D;&#x8D56;&#xFF0C;&#x800C;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7684;&#x8F6F;&#x4EF6;&#x6709;&#x65F6;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x8FD9;&#x4E9B;&#x4F9D;&#x8D56;&#x4F1A;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x6613;&#x91CD;&#x590D;&#x3002;</p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;</strong></h4><p>&#x6E90;&#x7801;&#x4E0D;&#x653E;&#x5728;Docker&#x955C;&#x50CF;&#x91CC;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;</strong></h4><p>&#x8F6F;&#x4EF6;&#x6E90;&#x7801;&#x4EE5;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x7684;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x6240;&#x5F97;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E5F;&#x5C06;&#x4F4D;&#x4E8E;&#x6570;&#x636E;&#x5377;&#x5185;&#x3002;</p>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x7F16;&#x8BD1;Hadoop&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x7F16;&#x8BD1;&#x6548;&#x7387;&#xFF0C;&#x540C;&#x65F6;&#x907F;&#x514D;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#x3002;&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/\">2016-06-05</a></li>\n</ul>\n<p><img src=\"/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png\" width=\"300\"></p>\n<p>&#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">64&#x4F4D;Ubuntu&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;</a>&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x57FA;&#x4E8E;Docker&#x7F16;&#x8BD1;Hadoop&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"></a>&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"keyword\">compile</span>-hadoop</div></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x81EA;&#x884C;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">sudo</span> docker <span class=\"keyword\">build </span>-t kiwenlau/compile-hadoop .</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight elixir\"><table><tr><td class=\"code\"><pre><div class=\"line\">export VERSION=<span class=\"number\">2.7</span>.<span class=\"number\">2</span></div><div class=\"line\">wget <span class=\"symbol\">http:</span>/<span class=\"regexp\">/archive.apache.org/dist</span><span class=\"regexp\">/hadoop/core</span><span class=\"regexp\">/hadoop-$VERSION/hadoop</span>-<span class=\"variable\">$VERSION</span>-src.tar.gz</div><div class=\"line\">tar -xzvf hadoop-<span class=\"variable\">$VERSION</span>-src.tar.gz</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> -v $(<span class=\"built_in\">pwd</span>)/hadoop-<span class=\"variable\">$VERSION</span>-src:/hadoop-<span class=\"variable\">$VERSION</span>-src kiwenlau/compile-hadoop /root/compile.sh <span class=\"variable\">$VERSION</span></span></div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">23</span><span class=\"selector-pseudo\">:46.056s</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Tue</span> <span class=\"selector-tag\">May</span> <span class=\"selector-tag\">31</span> <span class=\"selector-tag\">16</span><span class=\"selector-pseudo\">:40</span><span class=\"selector-pseudo\">:53</span> <span class=\"selector-tag\">UTC</span> <span class=\"selector-tag\">2016</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">210M</span>/<span class=\"selector-tag\">915M</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">comile</span> <span class=\"selector-tag\">hadoop</span> <span class=\"selector-tag\">2</span><span class=\"selector-class\">.7</span><span class=\"selector-class\">.2</span> <span class=\"selector-tag\">success</span>!</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4EC5;&#x9700;&#x6539;&#x53D8;VERSION&#x7684;&#x503C;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/$VERSION/</span>hadoop-VERSION.tar.gz</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"><a href=\"#&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"></a>&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;</h2><p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6E90;&#x7801;<a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a></p>\n<h4 id=\"1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;</strong></h4><p>&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x5F88;&#x591A;&#x4F9D;&#x8D56;&#xFF0C;&#x800C;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7684;&#x8F6F;&#x4EF6;&#x6709;&#x65F6;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x8FD9;&#x4E9B;&#x4F9D;&#x8D56;&#x4F1A;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x6613;&#x91CD;&#x590D;&#x3002;</p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;</strong></h4><p>&#x6E90;&#x7801;&#x4E0D;&#x653E;&#x5728;Docker&#x955C;&#x50CF;&#x91CC;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;</strong></h4><p>&#x8F6F;&#x4EF6;&#x6E90;&#x7801;&#x4EE5;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x7684;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x6240;&#x5F97;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E5F;&#x5C06;&#x4F4D;&#x4E8E;&#x6570;&#x636E;&#x5377;&#x5185;&#x3002;</p>"},{"title":"基于Docker搭建Hadoop集群之升级版","date":"2016-06-12T02:00:00.000Z","_content":"\n**摘要:** [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker)是去年参加[Docker巨好玩](http://www.alauda.cn/2015/04/28/docker-great/)比赛开发的，得了[二等奖](http://www.alauda.cn/2015/06/11/presentation/)并赢了一块苹果手表，目前这个项目已经在GitHub上获得了236个Star，DockerHub的镜像下载次数2000+。总之，项目还算很受欢迎吧，这篇博客将介绍项目的升级版。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-12](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)\n\n## 一. 项目介绍\n\n将[Hadoop](http://hadoop.apache.org/)打包到[Docker](https://www.docker.com/)镜像中，就可以快速地在单个机器上搭建Hadoop集群，这样可以方便新手测试和学习。\n\n如下图所示，Hadoop的master和slave分别运行在不同的Docker容器中，其中hadoop-master容器中运行NameNode和ResourceManager，hadoop-slave容器中运行DataNode和NodeManager。NameNode和DataNode是Hadoop分布式文件系统HDFS的组件，负责储存输入以及输出数据，而ResourceManager和NodeManager是Hadoop集群资源管理系统YARN的组件，负责CPU和内存资源的调度。\n\n<img src=\"160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width = \"500\"/>\n\n之前的版本使用serf/dnsmasq为Hadoop集群提供DNS服务，由于Docker网络功能更新，现在并不需要了。更新的版本中，使用以下命令为Hadoop集群创建单独的网络:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n然后在运行Hadoop容器时，使用\"--net=hadoop\"选项，这时所有容器将运行在hadoop网络中，它们可以通过容器名称进行通信。\n\n**项目更新要点：**\n\n- 去除serf/dnsmasq\n- 合并Master和Slave镜像\n- 使用[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)项目编译的Hadoo进行安装\n- 优化Hadoop配置\n\n## 二. 3节点Hadoop集群搭建步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. 下载GitHub仓库**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. 创建Hadoop网络**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. 运行Docker容器**\n\n```\ncd hadoop-cluster-docker\n./start-container.sh\n```\n\n**运行结果**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n\n- 启动了3个容器，1个master, 2个slave\n- 运行后就进入了hadoop-master容器的/root目录\n\n#### **5. 启动hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. 运行wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**运行结果**\n\n```\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\nHadoop网页管理地址:\n\n- NameNode: [http://192.168.59.1:50070/](http://192.168.59.1:50070/)\n- ResourceManager: [http://192.168.59.1:8088/](http://192.168.59.1:8088/)\n\n192.168.59.1为运行容器的主机的IP。\n\n## 三. N节点Hadoop集群搭建步骤\n\n#### **1. 准备**\n\n- 参考第二部分1~3：下载Docker镜像，下载GitHub仓库，以及创建Hadoop网络\n\n#### **2. 重新构建Docker镜像**\n\n```\n./resize-cluster.sh 5\n```\n- 可以指定任意N(N>1)\n\n#### **3. 启动Docker容器**\n\n```\n./start-container.sh 5\n```\n- 与第2步中的N保持一致。\n\n#### **4. 运行Hadoop**\n\n- 参考第二部分5~6：启动Hadoop，并运行wordcount。\n\n## 参考\n\n1. [基于Docker搭建多节点Hadoop集群](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","source":"_posts/2016/06/12/160612-hadoop-cluster-docker-update.md","raw":"title: 基于Docker搭建Hadoop集群之升级版\n\ndate: 2016-06-12 10:00\n\ntags: [Docker, Hadoop]\n\n---\n\n**摘要:** [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker)是去年参加[Docker巨好玩](http://www.alauda.cn/2015/04/28/docker-great/)比赛开发的，得了[二等奖](http://www.alauda.cn/2015/06/11/presentation/)并赢了一块苹果手表，目前这个项目已经在GitHub上获得了236个Star，DockerHub的镜像下载次数2000+。总之，项目还算很受欢迎吧，这篇博客将介绍项目的升级版。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-12](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)\n\n## 一. 项目介绍\n\n将[Hadoop](http://hadoop.apache.org/)打包到[Docker](https://www.docker.com/)镜像中，就可以快速地在单个机器上搭建Hadoop集群，这样可以方便新手测试和学习。\n\n如下图所示，Hadoop的master和slave分别运行在不同的Docker容器中，其中hadoop-master容器中运行NameNode和ResourceManager，hadoop-slave容器中运行DataNode和NodeManager。NameNode和DataNode是Hadoop分布式文件系统HDFS的组件，负责储存输入以及输出数据，而ResourceManager和NodeManager是Hadoop集群资源管理系统YARN的组件，负责CPU和内存资源的调度。\n\n<img src=\"160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width = \"500\"/>\n\n之前的版本使用serf/dnsmasq为Hadoop集群提供DNS服务，由于Docker网络功能更新，现在并不需要了。更新的版本中，使用以下命令为Hadoop集群创建单独的网络:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n然后在运行Hadoop容器时，使用\"--net=hadoop\"选项，这时所有容器将运行在hadoop网络中，它们可以通过容器名称进行通信。\n\n**项目更新要点：**\n\n- 去除serf/dnsmasq\n- 合并Master和Slave镜像\n- 使用[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)项目编译的Hadoo进行安装\n- 优化Hadoop配置\n\n## 二. 3节点Hadoop集群搭建步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. 下载GitHub仓库**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. 创建Hadoop网络**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. 运行Docker容器**\n\n```\ncd hadoop-cluster-docker\n./start-container.sh\n```\n\n**运行结果**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n\n- 启动了3个容器，1个master, 2个slave\n- 运行后就进入了hadoop-master容器的/root目录\n\n#### **5. 启动hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. 运行wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**运行结果**\n\n```\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\nHadoop网页管理地址:\n\n- NameNode: [http://192.168.59.1:50070/](http://192.168.59.1:50070/)\n- ResourceManager: [http://192.168.59.1:8088/](http://192.168.59.1:8088/)\n\n192.168.59.1为运行容器的主机的IP。\n\n## 三. N节点Hadoop集群搭建步骤\n\n#### **1. 准备**\n\n- 参考第二部分1~3：下载Docker镜像，下载GitHub仓库，以及创建Hadoop网络\n\n#### **2. 重新构建Docker镜像**\n\n```\n./resize-cluster.sh 5\n```\n- 可以指定任意N(N>1)\n\n#### **3. 启动Docker容器**\n\n```\n./start-container.sh 5\n```\n- 与第2步中的N保持一致。\n\n#### **4. 运行Hadoop**\n\n- 参考第二部分5~6：启动Hadoop，并运行wordcount。\n\n## 参考\n\n1. [基于Docker搭建多节点Hadoop集群](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","slug":"2016/06/12/160612-hadoop-cluster-docker-update","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzw3000wivfywsyhmxer","content":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a>&#x662F;&#x53BB;&#x5E74;&#x53C2;&#x52A0;<a href=\"http://www.alauda.cn/2015/04/28/docker-great/\" target=\"_blank\" rel=\"external\">Docker&#x5DE8;&#x597D;&#x73A9;</a>&#x6BD4;&#x8D5B;&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x5F97;&#x4E86;<a href=\"http://www.alauda.cn/2015/06/11/presentation/\" target=\"_blank\" rel=\"external\">&#x4E8C;&#x7B49;&#x5956;</a>&#x5E76;&#x8D62;&#x4E86;&#x4E00;&#x5757;&#x82F9;&#x679C;&#x624B;&#x8868;&#xFF0C;&#x76EE;&#x524D;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x5DF2;&#x7ECF;&#x5728;GitHub&#x4E0A;&#x83B7;&#x5F97;&#x4E86;236&#x4E2A;Star&#xFF0C;DockerHub&#x7684;&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x6B21;&#x6570;2000+&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x9879;&#x76EE;&#x8FD8;&#x7B97;&#x5F88;&#x53D7;&#x6B22;&#x8FCE;&#x5427;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x9879;&#x76EE;&#x7684;&#x5347;&#x7EA7;&#x7248;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">2016-06-12</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;</h2><p>&#x5C06;<a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a>&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x65B0;&#x624B;&#x6D4B;&#x8BD5;&#x548C;&#x5B66;&#x4E60;&#x3002;</p>\n<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;Hadoop&#x7684;master&#x548C;slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x7684;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5176;&#x4E2D;hadoop-master&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;NameNode&#x548C;ResourceManager&#xFF0C;hadoop-slave&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;DataNode&#x548C;NodeManager&#x3002;NameNode&#x548C;DataNode&#x662F;Hadoop&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;HDFS&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;&#x50A8;&#x5B58;&#x8F93;&#x5165;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x800C;ResourceManager&#x548C;NodeManager&#x662F;Hadoop&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;YARN&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;CPU&#x548C;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;&#x3002;</p>\n<p><img src=\"/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x4F7F;&#x7528;serf/dnsmasq&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;DNS&#x670D;&#x52A1;&#xFF0C;&#x7531;&#x4E8E;Docker&#x7F51;&#x7EDC;&#x529F;&#x80FD;&#x66F4;&#x65B0;&#xFF0C;&#x73B0;&#x5728;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;&#x66F4;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x521B;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x7F51;&#x7EDC;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;Hadoop&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x201D;&#x2013;net=hadoop&#x201D;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x65F6;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x5C06;&#x8FD0;&#x884C;&#x5728;hadoop&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x540D;&#x79F0;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><strong>&#x9879;&#x76EE;&#x66F4;&#x65B0;&#x8981;&#x70B9;&#xFF1A;</strong></p>\n<ul>\n<li>&#x53BB;&#x9664;serf/dnsmasq</li>\n<li>&#x5408;&#x5E76;Master&#x548C;Slave&#x955C;&#x50CF;</li>\n<li>&#x4F7F;&#x7528;<a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a>&#x9879;&#x76EE;&#x7F16;&#x8BD1;&#x7684;Hadoo&#x8FDB;&#x884C;&#x5B89;&#x88C5;</li>\n<li>&#x4F18;&#x5316;Hadoop&#x914D;&#x7F6E;</li>\n</ul>\n<h2 id=\"&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"><a href=\"#3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"></a><strong>3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x542F;&#x52A8;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x8FD0;&#x884C;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;hadoop-master&#x5BB9;&#x5668;&#x7684;/root&#x76EE;&#x5F55;</li>\n</ul>\n<h4 id=\"5-&#x542F;&#x52A8;hadoop\"><a href=\"#5-&#x542F;&#x52A8;hadoop\" class=\"headerlink\" title=\"5. &#x542F;&#x52A8;hadoop\"></a><strong>5. &#x542F;&#x52A8;hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;wordcount\"><a href=\"#6-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;wordcount\"></a><strong>6. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t<span class=\"number\">1</span></div><div class=\"line\">Hadoop\t<span class=\"number\">1</span></div><div class=\"line\">Hello\t<span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<p>Hadoop&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x5730;&#x5740;:</p>\n<ul>\n<li>NameNode: <a href=\"http://192.168.59.1:50070/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:50070/</a></li>\n<li>ResourceManager: <a href=\"http://192.168.59.1:8088/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:8088/</a></li>\n</ul>\n<p>192.168.59.1&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#x3002;</p>\n<h2 id=\"&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;\"><a href=\"#1-&#x51C6;&#x5907;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;\"></a><strong>1. &#x51C6;&#x5907;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;&#xFF0C;&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;&#xFF0C;&#x4EE5;&#x53CA;&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4EFB;&#x610F;N(N&gt;1)</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container<span class=\"selector-class\">.sh</span> <span class=\"number\">5</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0E;&#x7B2C;2&#x6B65;&#x4E2D;&#x7684;N&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<h4 id=\"4-&#x8FD0;&#x884C;Hadoop\"><a href=\"#4-&#x8FD0;&#x884C;Hadoop\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Hadoop\"></a><strong>4. &#x8FD0;&#x884C;Hadoop</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;5~6&#xFF1A;&#x542F;&#x52A8;Hadoop&#xFF0C;&#x5E76;&#x8FD0;&#x884C;wordcount&#x3002;</li>\n</ul>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\" target=\"_blank\" rel=\"external\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">kiwenlau/hadoop-cluster-docker</a>&#x662F;&#x53BB;&#x5E74;&#x53C2;&#x52A0;<a href=\"http://www.alauda.cn/2015/04/28/docker-great/\">Docker&#x5DE8;&#x597D;&#x73A9;</a>&#x6BD4;&#x8D5B;&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x5F97;&#x4E86;<a href=\"http://www.alauda.cn/2015/06/11/presentation/\">&#x4E8C;&#x7B49;&#x5956;</a>&#x5E76;&#x8D62;&#x4E86;&#x4E00;&#x5757;&#x82F9;&#x679C;&#x624B;&#x8868;&#xFF0C;&#x76EE;&#x524D;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x5DF2;&#x7ECF;&#x5728;GitHub&#x4E0A;&#x83B7;&#x5F97;&#x4E86;236&#x4E2A;Star&#xFF0C;DockerHub&#x7684;&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x6B21;&#x6570;2000+&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x9879;&#x76EE;&#x8FD8;&#x7B97;&#x5F88;&#x53D7;&#x6B22;&#x8FCE;&#x5427;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x9879;&#x76EE;&#x7684;&#x5347;&#x7EA7;&#x7248;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">2016-06-12</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;</h2><p>&#x5C06;<a href=\"http://hadoop.apache.org/\">Hadoop</a>&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x65B0;&#x624B;&#x6D4B;&#x8BD5;&#x548C;&#x5B66;&#x4E60;&#x3002;</p>\n<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;Hadoop&#x7684;master&#x548C;slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x7684;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5176;&#x4E2D;hadoop-master&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;NameNode&#x548C;ResourceManager&#xFF0C;hadoop-slave&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;DataNode&#x548C;NodeManager&#x3002;NameNode&#x548C;DataNode&#x662F;Hadoop&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;HDFS&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;&#x50A8;&#x5B58;&#x8F93;&#x5165;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x800C;ResourceManager&#x548C;NodeManager&#x662F;Hadoop&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;YARN&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;CPU&#x548C;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;&#x3002;</p>\n<p><img src=\"/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x4F7F;&#x7528;serf/dnsmasq&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;DNS&#x670D;&#x52A1;&#xFF0C;&#x7531;&#x4E8E;Docker&#x7F51;&#x7EDC;&#x529F;&#x80FD;&#x66F4;&#x65B0;&#xFF0C;&#x73B0;&#x5728;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;&#x66F4;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x521B;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x7F51;&#x7EDC;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;Hadoop&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x201D;&#x2013;net=hadoop&#x201D;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x65F6;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x5C06;&#x8FD0;&#x884C;&#x5728;hadoop&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x540D;&#x79F0;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><strong>&#x9879;&#x76EE;&#x66F4;&#x65B0;&#x8981;&#x70B9;&#xFF1A;</strong></p>\n<ul>\n<li>&#x53BB;&#x9664;serf/dnsmasq</li>\n<li>&#x5408;&#x5E76;Master&#x548C;Slave&#x955C;&#x50CF;</li>\n<li>&#x4F7F;&#x7528;<a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a>&#x9879;&#x76EE;&#x7F16;&#x8BD1;&#x7684;Hadoo&#x8FDB;&#x884C;&#x5B89;&#x88C5;</li>\n<li>&#x4F18;&#x5316;Hadoop&#x914D;&#x7F6E;</li>\n</ul>\n<h2 id=\"&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"><a href=\"#3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"></a><strong>3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x542F;&#x52A8;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x8FD0;&#x884C;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;hadoop-master&#x5BB9;&#x5668;&#x7684;/root&#x76EE;&#x5F55;</li>\n</ul>\n<h4 id=\"5-&#x542F;&#x52A8;hadoop\"><a href=\"#5-&#x542F;&#x52A8;hadoop\" class=\"headerlink\" title=\"5. &#x542F;&#x52A8;hadoop\"></a><strong>5. &#x542F;&#x52A8;hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;wordcount\"><a href=\"#6-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;wordcount\"></a><strong>6. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t<span class=\"number\">1</span></div><div class=\"line\">Hadoop\t<span class=\"number\">1</span></div><div class=\"line\">Hello\t<span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<p>Hadoop&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x5730;&#x5740;:</p>\n<ul>\n<li>NameNode: <a href=\"http://192.168.59.1:50070/\">http://192.168.59.1:50070/</a></li>\n<li>ResourceManager: <a href=\"http://192.168.59.1:8088/\">http://192.168.59.1:8088/</a></li>\n</ul>\n<p>192.168.59.1&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#x3002;</p>\n<h2 id=\"&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;\"><a href=\"#1-&#x51C6;&#x5907;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;\"></a><strong>1. &#x51C6;&#x5907;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;&#xFF0C;&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;&#xFF0C;&#x4EE5;&#x53CA;&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4EFB;&#x610F;N(N&gt;1)</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container<span class=\"selector-class\">.sh</span> <span class=\"number\">5</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0E;&#x7B2C;2&#x6B65;&#x4E2D;&#x7684;N&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<h4 id=\"4-&#x8FD0;&#x884C;Hadoop\"><a href=\"#4-&#x8FD0;&#x884C;Hadoop\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Hadoop\"></a><strong>4. &#x8FD0;&#x884C;Hadoop</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;5~6&#xFF1A;&#x542F;&#x52A8;Hadoop&#xFF0C;&#x5E76;&#x8FD0;&#x884C;wordcount&#x3002;</li>\n</ul>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>"},{"title":"基于Docker搭建多节点Mesos/Marathon","date":"2016-07-10T02:00:00.000Z","_content":"\n**摘要:** 在之前的一篇博客中，我介绍了[基于Docker搭建单机版Mesos/Marathon](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)，但是仅仅使用了单个节点。而在这篇博客中，我将介绍[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)，开发者可以使用3个节点快速地搭建一个真正的分布式容器集群系统。**服务发现**和**负载均衡**是容器集群必不可少的功能，我选择了[Marathon LB](https://github.com/mesosphere/marathon-lb)来实现。\n\n**GitHub地址:** [kiwenlau/mesos-marathon-platform](https://github.com/kiwenlau/mesos-marathon-platform)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-10](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)\n\n<img src=\"mesos-marathon-platform/mesos-marathon-platform.png\" width = \"500\"/>\n\n## 一. Mesos/Marathon简介\n\n#### **1. Mesos**\n\n[Mesos](http://mesos.apache.org/)是**分布式集群资源管理系统**，负责调度集群内的CPU，内存以及磁盘等资源。Hadoop MapReduce, Spark以及Storm等**分布式计算框架**很流行，但是为每一个计算框架搭建单独的集群非常地浪费资源，也无法实现数据共享，而Mesos的设计初衷就是让不同的**分布式计算框架**能够共享一个集群。\n\nMesos资源调度算法分为两个层次: Mesos监控集群的空余资源，并将空余资源按照一定规则分配给各个计算框架；而各个计算框架会根据需要选择接受或者拒绝所分配的资源。这时，Mesos与各个计算框架都参与了资源的调度: Mesos负责分配资源; 而计算框架接受或者拒绝资源。因此，Mesos的责任非常清晰而且简单：分配集群资源。Mesos的双层调度算法提高了可扩展性，并且可以更方便地支持不同的计算框架。\n\n目前主流的集群资源管理系统还有Hadoop YARN，Kubernetes以及Swarm。Hadoop YARN目前仅适合运行分布式计算框架例如Spark；Kubernetes与Swarm仅适合运行容器应用；而Mesos对分布式计算框架以及容器应用的支持都很成熟。并且，Kubernetes与Swarm可以作为计算框架运行在Mesos之上。Kubernetes的功能强大，但是有些过度设计导致复杂度很高，而Swarm的设计简单很多但是功能相对缺乏，大家可以根据需要选择。个人认为，**使用Mesos的话，最好选择Marathon作为容器编排系统**，架构非常简单，且功能丰富。\n\n#### **2. Marathon**\n\n[Marathon](https://mesosphere.github.io/marathon/)是容器编排系统，是运行于Mesos之上的众多计算框架之一。用户可以通过Marathon提交，监控并调度容器应用，然后Mesos负责运行容器。另外，[Aurora](http://aurora.apache.org/)与Marathon功能一致，同为容器编排系统。相比而言，Marathon的架构比Aurora更简单，没有从节点，且对[Docker](https://www.docker.com/)的支持更为完善。Marathon由Mesosphere公司负责开发，社区很活跃，文档也很完善。\n\nMarathon具有**容错功能**：当容器由于节点崩溃等原因意外停止运行时，Marathon会自动将容器调度到其他节点。这一点类似进程管理工具例如[Supervisor](http://supervisord.org/)：当进程意外退出时，Supervisor会重启进程。然而，自动容错功能并不适合有状态服务，即带有数据卷(volume)的容器，例如MongoDB与MySQL。因为数据很难跨节点移动，目前的技术还不够成熟。因此，**Marathon目前仅适合运行无状态的服务，而数据库等有状态服务应该单独部署**。这样做也可以提高数据的安全性。\n\n#### **3. Marathon LB**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**与**负载均衡**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n当使用Marathon部署容器时，容器运行的节点(IP)与使用的端口(PORT)是Mesos/Marathon平台负责调度的，无法事先确定。这样的话，每次访问服务时，需要手动去查询容器运行的IP与PORT。并且，容器出错时会发生重新调度，IP与PORT会变化。因此，访问服务会非常不方便。通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP，这样每次部署服务时，IP与PORT是固定的，就方便很多了。Marathon LB会监听Marathon的调度事件，获取容器运行的IP与PORT，然后更新代理服务器Haproxy的配置文件。因此，当部署新的容器或者容器发生变化时，仍然可以通过固定的IP与PORT访问该容器。这就是所谓的**服务发现**。\n\n同一个服务往往对应着多个容器副本，Marathon LB作为代理服务器，同时实现了**负载均衡**的功能。服务请求能够使用Round Robin方式发送给各个容器。\n                           \n## 二. 搭建步骤\n\n#### **1. 创建虚拟机**\n\n按照[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以快速地在单个机器上创建Mesos/Marathon平台运行所需要的3个虚拟机节点。\n\n其中，node1为主机点(Master)，运行zookeeper, mesos_master, marathon以及marathon-lb容器; node2与node3为从节点(Slave)，运行mesos_slave容器；使用marathon部署nginx时，nginx容器运行在从节点上。如下表所示:\n\n| 节点    | IP           | 运行的容器                                      |\n|:------- |:-------------| :----------------------------------------------|\n| node1  | 192.168.59.1 | zookeeper, mesos_master, marathon, marathon-lb |\n| node2  | 192.168.59.2 | mesos_slave1, nginx                                   |\n| node3  | 192.168.59.3 | mesos_slave2, nginx                                   |\n\n#### **2. 开启Docker daemon的监听端口**\n\n因为**start-containers.sh**使用了远程启动容器的方式，因此需要开启Docker daemon的TCP监听端口。提醒一下，**开启Docker daemon端口是不安全的**，生产环境中不能打开，或者做好防火墙配置。不希望开启Docker daemon的监听端口的话，可以使用start-containers.sh中的命令直接运行容器，只是稍微麻烦一点。\n\nMaster, Slave1和Slave2:\n\n```\nsudo vim /etc/default/docker\n```\n\n修改**DOCKER_OPTS**\n\n```\nDOCKER_OPTS=\"-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n```\n\n重启Docker\n\n```\nsudo restart docker\n```\n\n#### **3. 下载Docker镜像** \n\nMaster:\n\n```\nsudo docker pull kiwenlau/zookeeper:3.4.8 \nsudo docker pull kiwenlau/mesos:0.26.0 \nsudo docker pull kiwenlau/marathon:1.1.1  \nsudo docker pull kiwenlau/marathonlb:1.3.0\n```\n\nSlave1 和 Slave2:\n\n```\nsudo docker pull kiwenlau/mesos:0.26.0\n```\n\n#### **4. 下载GitHub仓库** \n\nMaster:\n\n```\ngit clone https://github.com/kiwenlau/mesos-marathon-platform\n```\n\n\n#### **5. 运行容器** \n\nMaster:\n\n```\ncd mesos-marathon-platform\nsudo ./start-containers.sh\n```\n\n网页管理:\n\n- Mesos: [http://192.168.59.1:5050/](http://192.168.59.1:5050/)\n- Marathon: [http://192.168.59.1:8080/](http://192.168.59.1:8080/)  \n\n\n如果需要增加Slave节点，或者配置不同的节点IP，仅需修改start-contaniers.sh脚本中以下内容：\n\n```\nMASTER_IP=192.168.59.1\nSLAVE_IP=(192.168.59.2 192.168.59.3)\n```\n\n#### **6. 运行Nginx:** \n\n下载nginx镜像(Slave1和Slave2):\n\n```\nsudo docker pull nginx:1.10\n```\n\n运行Nginx(Master):\n\n```\nsudo ./run-nginx.sh \n```\n\nNginx的的定义如下(nginx.json):\n\n```\n{\n    \"id\": \"nginx\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 2,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，servicePort表示nginx绑定的端口为**10000**，而marathon-lb容器运行的节点IP为**192.168.59.1**。因此nginx的访问地址为：\n\n- [http://192.168.59.1:10000/](http://192.168.59.1:10000/)\n\n而实际上，两个nginx容器运行在Slave节点上，且端口是随机分配的。\n\n\n## 三. 参考\n\n1. [Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center](http://mesos.berkeley.edu/mesos_tech_report.pdf)\n","source":"_posts/2016/07/10/mesos-marathon-platform.md","raw":"title: 基于Docker搭建多节点Mesos/Marathon\n\ndate: 2016-07-10 10:00\n\ntags: [Docker, Mesos, Marathon]\n\n---\n\n**摘要:** 在之前的一篇博客中，我介绍了[基于Docker搭建单机版Mesos/Marathon](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)，但是仅仅使用了单个节点。而在这篇博客中，我将介绍[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)，开发者可以使用3个节点快速地搭建一个真正的分布式容器集群系统。**服务发现**和**负载均衡**是容器集群必不可少的功能，我选择了[Marathon LB](https://github.com/mesosphere/marathon-lb)来实现。\n\n**GitHub地址:** [kiwenlau/mesos-marathon-platform](https://github.com/kiwenlau/mesos-marathon-platform)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-10](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)\n\n<img src=\"mesos-marathon-platform/mesos-marathon-platform.png\" width = \"500\"/>\n\n## 一. Mesos/Marathon简介\n\n#### **1. Mesos**\n\n[Mesos](http://mesos.apache.org/)是**分布式集群资源管理系统**，负责调度集群内的CPU，内存以及磁盘等资源。Hadoop MapReduce, Spark以及Storm等**分布式计算框架**很流行，但是为每一个计算框架搭建单独的集群非常地浪费资源，也无法实现数据共享，而Mesos的设计初衷就是让不同的**分布式计算框架**能够共享一个集群。\n\nMesos资源调度算法分为两个层次: Mesos监控集群的空余资源，并将空余资源按照一定规则分配给各个计算框架；而各个计算框架会根据需要选择接受或者拒绝所分配的资源。这时，Mesos与各个计算框架都参与了资源的调度: Mesos负责分配资源; 而计算框架接受或者拒绝资源。因此，Mesos的责任非常清晰而且简单：分配集群资源。Mesos的双层调度算法提高了可扩展性，并且可以更方便地支持不同的计算框架。\n\n目前主流的集群资源管理系统还有Hadoop YARN，Kubernetes以及Swarm。Hadoop YARN目前仅适合运行分布式计算框架例如Spark；Kubernetes与Swarm仅适合运行容器应用；而Mesos对分布式计算框架以及容器应用的支持都很成熟。并且，Kubernetes与Swarm可以作为计算框架运行在Mesos之上。Kubernetes的功能强大，但是有些过度设计导致复杂度很高，而Swarm的设计简单很多但是功能相对缺乏，大家可以根据需要选择。个人认为，**使用Mesos的话，最好选择Marathon作为容器编排系统**，架构非常简单，且功能丰富。\n\n#### **2. Marathon**\n\n[Marathon](https://mesosphere.github.io/marathon/)是容器编排系统，是运行于Mesos之上的众多计算框架之一。用户可以通过Marathon提交，监控并调度容器应用，然后Mesos负责运行容器。另外，[Aurora](http://aurora.apache.org/)与Marathon功能一致，同为容器编排系统。相比而言，Marathon的架构比Aurora更简单，没有从节点，且对[Docker](https://www.docker.com/)的支持更为完善。Marathon由Mesosphere公司负责开发，社区很活跃，文档也很完善。\n\nMarathon具有**容错功能**：当容器由于节点崩溃等原因意外停止运行时，Marathon会自动将容器调度到其他节点。这一点类似进程管理工具例如[Supervisor](http://supervisord.org/)：当进程意外退出时，Supervisor会重启进程。然而，自动容错功能并不适合有状态服务，即带有数据卷(volume)的容器，例如MongoDB与MySQL。因为数据很难跨节点移动，目前的技术还不够成熟。因此，**Marathon目前仅适合运行无状态的服务，而数据库等有状态服务应该单独部署**。这样做也可以提高数据的安全性。\n\n#### **3. Marathon LB**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**与**负载均衡**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n当使用Marathon部署容器时，容器运行的节点(IP)与使用的端口(PORT)是Mesos/Marathon平台负责调度的，无法事先确定。这样的话，每次访问服务时，需要手动去查询容器运行的IP与PORT。并且，容器出错时会发生重新调度，IP与PORT会变化。因此，访问服务会非常不方便。通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP，这样每次部署服务时，IP与PORT是固定的，就方便很多了。Marathon LB会监听Marathon的调度事件，获取容器运行的IP与PORT，然后更新代理服务器Haproxy的配置文件。因此，当部署新的容器或者容器发生变化时，仍然可以通过固定的IP与PORT访问该容器。这就是所谓的**服务发现**。\n\n同一个服务往往对应着多个容器副本，Marathon LB作为代理服务器，同时实现了**负载均衡**的功能。服务请求能够使用Round Robin方式发送给各个容器。\n                           \n## 二. 搭建步骤\n\n#### **1. 创建虚拟机**\n\n按照[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以快速地在单个机器上创建Mesos/Marathon平台运行所需要的3个虚拟机节点。\n\n其中，node1为主机点(Master)，运行zookeeper, mesos_master, marathon以及marathon-lb容器; node2与node3为从节点(Slave)，运行mesos_slave容器；使用marathon部署nginx时，nginx容器运行在从节点上。如下表所示:\n\n| 节点    | IP           | 运行的容器                                      |\n|:------- |:-------------| :----------------------------------------------|\n| node1  | 192.168.59.1 | zookeeper, mesos_master, marathon, marathon-lb |\n| node2  | 192.168.59.2 | mesos_slave1, nginx                                   |\n| node3  | 192.168.59.3 | mesos_slave2, nginx                                   |\n\n#### **2. 开启Docker daemon的监听端口**\n\n因为**start-containers.sh**使用了远程启动容器的方式，因此需要开启Docker daemon的TCP监听端口。提醒一下，**开启Docker daemon端口是不安全的**，生产环境中不能打开，或者做好防火墙配置。不希望开启Docker daemon的监听端口的话，可以使用start-containers.sh中的命令直接运行容器，只是稍微麻烦一点。\n\nMaster, Slave1和Slave2:\n\n```\nsudo vim /etc/default/docker\n```\n\n修改**DOCKER_OPTS**\n\n```\nDOCKER_OPTS=\"-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n```\n\n重启Docker\n\n```\nsudo restart docker\n```\n\n#### **3. 下载Docker镜像** \n\nMaster:\n\n```\nsudo docker pull kiwenlau/zookeeper:3.4.8 \nsudo docker pull kiwenlau/mesos:0.26.0 \nsudo docker pull kiwenlau/marathon:1.1.1  \nsudo docker pull kiwenlau/marathonlb:1.3.0\n```\n\nSlave1 和 Slave2:\n\n```\nsudo docker pull kiwenlau/mesos:0.26.0\n```\n\n#### **4. 下载GitHub仓库** \n\nMaster:\n\n```\ngit clone https://github.com/kiwenlau/mesos-marathon-platform\n```\n\n\n#### **5. 运行容器** \n\nMaster:\n\n```\ncd mesos-marathon-platform\nsudo ./start-containers.sh\n```\n\n网页管理:\n\n- Mesos: [http://192.168.59.1:5050/](http://192.168.59.1:5050/)\n- Marathon: [http://192.168.59.1:8080/](http://192.168.59.1:8080/)  \n\n\n如果需要增加Slave节点，或者配置不同的节点IP，仅需修改start-contaniers.sh脚本中以下内容：\n\n```\nMASTER_IP=192.168.59.1\nSLAVE_IP=(192.168.59.2 192.168.59.3)\n```\n\n#### **6. 运行Nginx:** \n\n下载nginx镜像(Slave1和Slave2):\n\n```\nsudo docker pull nginx:1.10\n```\n\n运行Nginx(Master):\n\n```\nsudo ./run-nginx.sh \n```\n\nNginx的的定义如下(nginx.json):\n\n```\n{\n    \"id\": \"nginx\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 2,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，servicePort表示nginx绑定的端口为**10000**，而marathon-lb容器运行的节点IP为**192.168.59.1**。因此nginx的访问地址为：\n\n- [http://192.168.59.1:10000/](http://192.168.59.1:10000/)\n\n而实际上，两个nginx容器运行在Slave节点上，且端口是随机分配的。\n\n\n## 三. 参考\n\n1. [Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center](http://mesos.berkeley.edu/mesos_tech_report.pdf)\n","slug":"2016/07/10/mesos-marathon-platform","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzw4000yivfyeco9uwvb","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x4E4B;&#x524D;&#x7684;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon</a>&#xFF0C;&#x4F46;&#x662F;&#x4EC5;&#x4EC5;&#x4F7F;&#x7528;&#x4E86;&#x5355;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x800C;&#x5728;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;3&#x4E2A;&#x8282;&#x70B9;&#x5FEB;&#x901F;&#x5730;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x3002;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x548C;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x4E86;<a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong> <a href=\"https://github.com/kiwenlau/mesos-marathon-platform\" target=\"_blank\" rel=\"external\">kiwenlau/mesos-marathon-platform</a></p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">2016-07-10</a></li>\n</ul>\n<p><img src=\"/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;\"></a>&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;</h2><h4 id=\"1-Mesos\"><a href=\"#1-Mesos\" class=\"headerlink\" title=\"1. Mesos\"></a><strong>1. Mesos</strong></h4><p><a href=\"http://mesos.apache.org/\" target=\"_blank\" rel=\"external\">Mesos</a>&#x662F;<strong>&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x96C6;&#x7FA4;&#x5185;&#x7684;CPU&#xFF0C;&#x5185;&#x5B58;&#x4EE5;&#x53CA;&#x78C1;&#x76D8;&#x7B49;&#x8D44;&#x6E90;&#x3002;Hadoop MapReduce, Spark&#x4EE5;&#x53CA;Storm&#x7B49;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x5F88;&#x6D41;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x642D;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x96C6;&#x7FA4;&#x975E;&#x5E38;&#x5730;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5171;&#x4EAB;&#xFF0C;&#x800C;Mesos&#x7684;&#x8BBE;&#x8BA1;&#x521D;&#x8877;&#x5C31;&#x662F;&#x8BA9;&#x4E0D;&#x540C;&#x7684;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x80FD;&#x591F;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x3002;</p>\n<p>Mesos&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x5C42;&#x6B21;: Mesos&#x76D1;&#x63A7;&#x96C6;&#x7FA4;&#x7684;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x5C06;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x89C4;&#x5219;&#x5206;&#x914D;&#x7ED9;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#xFF1B;&#x800C;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F1A;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x6240;&#x5206;&#x914D;&#x7684;&#x8D44;&#x6E90;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;Mesos&#x4E0E;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x90FD;&#x53C2;&#x4E0E;&#x4E86;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;: Mesos&#x8D1F;&#x8D23;&#x5206;&#x914D;&#x8D44;&#x6E90;; &#x800C;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Mesos&#x7684;&#x8D23;&#x4EFB;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x800C;&#x4E14;&#x7B80;&#x5355;&#xFF1A;&#x5206;&#x914D;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x3002;Mesos&#x7684;&#x53CC;&#x5C42;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x63D0;&#x9AD8;&#x4E86;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x4E3B;&#x6D41;&#x7684;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x8FD8;&#x6709;Hadoop YARN&#xFF0C;Kubernetes&#x4EE5;&#x53CA;Swarm&#x3002;Hadoop YARN&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F8B;&#x5982;Spark&#xFF1B;Kubernetes&#x4E0E;Swarm&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF1B;&#x800C;Mesos&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4EE5;&#x53CA;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x7684;&#x652F;&#x6301;&#x90FD;&#x5F88;&#x6210;&#x719F;&#x3002;&#x5E76;&#x4E14;&#xFF0C;Kubernetes&#x4E0E;Swarm&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x3002;Kubernetes&#x7684;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;&#x5BFC;&#x81F4;&#x590D;&#x6742;&#x5EA6;&#x5F88;&#x9AD8;&#xFF0C;&#x800C;Swarm&#x7684;&#x8BBE;&#x8BA1;&#x7B80;&#x5355;&#x5F88;&#x591A;&#x4F46;&#x662F;&#x529F;&#x80FD;&#x76F8;&#x5BF9;&#x7F3A;&#x4E4F;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x3002;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#xFF0C;<strong>&#x4F7F;&#x7528;Mesos&#x7684;&#x8BDD;&#xFF0C;&#x6700;&#x597D;&#x9009;&#x62E9;Marathon&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x67B6;&#x6784;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4E14;&#x529F;&#x80FD;&#x4E30;&#x5BCC;&#x3002;</p>\n<h4 id=\"2-Marathon\"><a href=\"#2-Marathon\" class=\"headerlink\" title=\"2. Marathon\"></a><strong>2. Marathon</strong></h4><p><a href=\"https://mesosphere.github.io/marathon/\" target=\"_blank\" rel=\"external\">Marathon</a>&#x662F;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#xFF0C;&#x662F;&#x8FD0;&#x884C;&#x4E8E;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x4F17;&#x591A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4E4B;&#x4E00;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Marathon&#x63D0;&#x4EA4;&#xFF0C;&#x76D1;&#x63A7;&#x5E76;&#x8C03;&#x5EA6;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF0C;&#x7136;&#x540E;Mesos&#x8D1F;&#x8D23;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x53E6;&#x5916;&#xFF0C;<a href=\"http://aurora.apache.org/\" target=\"_blank\" rel=\"external\">Aurora</a>&#x4E0E;Marathon&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x540C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#x3002;&#x76F8;&#x6BD4;&#x800C;&#x8A00;&#xFF0C;Marathon&#x7684;&#x67B6;&#x6784;&#x6BD4;Aurora&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x4ECE;&#x8282;&#x70B9;&#xFF0C;&#x4E14;&#x5BF9;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x7684;&#x652F;&#x6301;&#x66F4;&#x4E3A;&#x5B8C;&#x5584;&#x3002;Marathon&#x7531;Mesosphere&#x516C;&#x53F8;&#x8D1F;&#x8D23;&#x5F00;&#x53D1;&#xFF0C;&#x793E;&#x533A;&#x5F88;&#x6D3B;&#x8DC3;&#xFF0C;&#x6587;&#x6863;&#x4E5F;&#x5F88;&#x5B8C;&#x5584;&#x3002;</p>\n<p>Marathon&#x5177;&#x6709;<strong>&#x5BB9;&#x9519;&#x529F;&#x80FD;</strong>&#xFF1A;&#x5F53;&#x5BB9;&#x5668;&#x7531;&#x4E8E;&#x8282;&#x70B9;&#x5D29;&#x6E83;&#x7B49;&#x539F;&#x56E0;&#x610F;&#x5916;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;Marathon&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x5BB9;&#x5668;&#x8C03;&#x5EA6;&#x5230;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x7C7B;&#x4F3C;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x4F8B;&#x5982;<a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"external\">Supervisor</a>&#xFF1A;&#x5F53;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x65F6;&#xFF0C;Supervisor&#x4F1A;&#x91CD;&#x542F;&#x8FDB;&#x7A0B;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x81EA;&#x52A8;&#x5BB9;&#x9519;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#xFF0C;&#x5373;&#x5E26;&#x6709;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F8B;&#x5982;MongoDB&#x4E0E;MySQL&#x3002;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5F88;&#x96BE;&#x8DE8;&#x8282;&#x70B9;&#x79FB;&#x52A8;&#xFF0C;&#x76EE;&#x524D;&#x7684;&#x6280;&#x672F;&#x8FD8;&#x4E0D;&#x591F;&#x6210;&#x719F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>Marathon&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x6570;&#x636E;&#x5E93;&#x7B49;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#x5E94;&#x8BE5;&#x5355;&#x72EC;&#x90E8;&#x7F72;</strong>&#x3002;&#x8FD9;&#x6837;&#x505A;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p>\n<h4 id=\"3-Marathon-LB\"><a href=\"#3-Marathon-LB\" class=\"headerlink\" title=\"3. Marathon LB\"></a><strong>3. Marathon LB</strong></h4><p><a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x4E0E;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\" target=\"_blank\" rel=\"external\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x5F53;&#x4F7F;&#x7528;Marathon&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;(IP)&#x4E0E;&#x4F7F;&#x7528;&#x7684;&#x7AEF;&#x53E3;(PORT)&#x662F;Mesos/Marathon&#x5E73;&#x53F0;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x7684;&#xFF0C;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6BCF;&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5BB9;&#x5668;&#x51FA;&#x9519;&#x65F6;&#x4F1A;&#x53D1;&#x751F;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#xFF0C;IP&#x4E0E;PORT&#x4F1A;&#x53D8;&#x5316;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4F1A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x90E8;&#x7F72;&#x670D;&#x52A1;&#x65F6;&#xFF0C;IP&#x4E0E;PORT&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5C31;&#x65B9;&#x4FBF;&#x5F88;&#x591A;&#x4E86;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x90E8;&#x7F72;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#x6216;&#x8005;&#x5BB9;&#x5668;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;PORT&#x8BBF;&#x95EE;&#x8BE5;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x3002;</p>\n<p>&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5F80;&#x5F80;&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x526F;&#x672C;&#xFF0C;Marathon LB&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7684;&#x529F;&#x80FD;&#x3002;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x80FD;&#x591F;&#x4F7F;&#x7528;Round Robin&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><p>&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x521B;&#x5EFA;Mesos/Marathon&#x5E73;&#x53F0;&#x8FD0;&#x884C;&#x6240;&#x9700;&#x8981;&#x7684;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x8282;&#x70B9;&#x3002;</p>\n<p>&#x5176;&#x4E2D;&#xFF0C;node1&#x4E3A;&#x4E3B;&#x673A;&#x70B9;(Master)&#xFF0C;&#x8FD0;&#x884C;zookeeper, mesos_master, marathon&#x4EE5;&#x53CA;marathon-lb&#x5BB9;&#x5668;; node2&#x4E0E;node3&#x4E3A;&#x4ECE;&#x8282;&#x70B9;(Slave)&#xFF0C;&#x8FD0;&#x884C;mesos_slave&#x5BB9;&#x5668;&#xFF1B;&#x4F7F;&#x7528;marathon&#x90E8;&#x7F72;nginx&#x65F6;&#xFF0C;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;&#x4ECE;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x5982;&#x4E0B;&#x8868;&#x6240;&#x793A;:</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x8282;&#x70B9;</th>\n<th style=\"text-align:left\">IP</th>\n<th style=\"text-align:left\">&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">node1</td>\n<td style=\"text-align:left\">192.168.59.1</td>\n<td style=\"text-align:left\">zookeeper, mesos_master, marathon, marathon-lb</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node2</td>\n<td style=\"text-align:left\">192.168.59.2</td>\n<td style=\"text-align:left\">mesos_slave1, nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node3</td>\n<td style=\"text-align:left\">192.168.59.3</td>\n<td style=\"text-align:left\">mesos_slave2, nginx</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"><a href=\"#2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\" class=\"headerlink\" title=\"2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"></a><strong>2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;</strong></h4><p>&#x56E0;&#x4E3A;<strong>start-containers.sh</strong>&#x4F7F;&#x7528;&#x4E86;&#x8FDC;&#x7A0B;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5F00;&#x542F;Docker daemon&#x7684;TCP&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x3002;&#x63D0;&#x9192;&#x4E00;&#x4E0B;&#xFF0C;<strong>&#x5F00;&#x542F;Docker daemon&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;</strong>&#xFF0C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4E0D;&#x80FD;&#x6253;&#x5F00;&#xFF0C;&#x6216;&#x8005;&#x505A;&#x597D;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x3002;&#x4E0D;&#x5E0C;&#x671B;&#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;start-containers.sh&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x7A0D;&#x5FAE;&#x9EBB;&#x70E6;&#x4E00;&#x70B9;&#x3002;</p>\n<p>Master, Slave1&#x548C;Slave2:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo vim <span class=\"regexp\">/etc/</span><span class=\"keyword\">default</span><span class=\"regexp\">/docker</span></div></pre></td></tr></table></figure>\n<p>&#x4FEE;&#x6539;<strong>DOCKER_OPTS</strong></p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">DOCKER_OPTS</span>=<span class=\"string\">&quot;-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock&quot;</span></div></pre></td></tr></table></figure>\n<p>&#x91CD;&#x542F;Docker</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">sudo restart docker</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>Master:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">zookeeper:</span><span class=\"number\">3.4</span><span class=\"number\">.8</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathon:</span><span class=\"number\">1.1</span><span class=\"number\">.1</span>  </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathonlb:</span><span class=\"number\">1.3</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<p>Slave1 &#x548C; Slave2:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><p>Master:</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/mesos-marathon-platform</div></pre></td></tr></table></figure>\n<h4 id=\"5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><p>Master:</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> mesos-marathon-platform</div><div class=\"line\">sudo ./<span class=\"built_in\">start</span>-containers.sh</div></pre></td></tr></table></figure>\n<p>&#x7F51;&#x9875;&#x7BA1;&#x7406;:</p>\n<ul>\n<li>Mesos: <a href=\"http://192.168.59.1:5050/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:5050/</a></li>\n<li>Marathon: <a href=\"http://192.168.59.1:8080/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:8080/</a>  </li>\n</ul>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x589E;&#x52A0;Slave&#x8282;&#x70B9;&#xFF0C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;start-contaniers.sh&#x811A;&#x672C;&#x4E2D;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">MASTER_IP=<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.1</span></div><div class=\"line\">SLAVE_IP=(<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.2</span> <span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.3</span>)</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;Nginx\"><a href=\"#6-&#x8FD0;&#x884C;Nginx\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;Nginx:\"></a><strong>6. &#x8FD0;&#x884C;Nginx:</strong></h4><p>&#x4E0B;&#x8F7D;nginx&#x955C;&#x50CF;(Slave1&#x548C;Slave2):</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;Nginx(Master):</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./<span class=\"keyword\">run</span><span class=\"bash\">-nginx.sh</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x7684;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;(nginx.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;servicePort&#x8868;&#x793A;nginx&#x7ED1;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>10000</strong>&#xFF0C;&#x800C;marathon-lb&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;IP&#x4E3A;<strong>192.168.59.1</strong>&#x3002;&#x56E0;&#x6B64;nginx&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#x4E3A;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://192.168.59.1:10000/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:10000/</a></li>\n</ul>\n<p>&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E24;&#x4E2A;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x4E14;&#x7AEF;&#x53E3;&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://mesos.berkeley.edu/mesos_tech_report.pdf\" target=\"_blank\" rel=\"external\">Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x4E4B;&#x524D;&#x7684;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon</a>&#xFF0C;&#x4F46;&#x662F;&#x4EC5;&#x4EC5;&#x4F7F;&#x7528;&#x4E86;&#x5355;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x800C;&#x5728;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;3&#x4E2A;&#x8282;&#x70B9;&#x5FEB;&#x901F;&#x5730;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x3002;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x548C;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x4E86;<a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong> <a href=\"https://github.com/kiwenlau/mesos-marathon-platform\">kiwenlau/mesos-marathon-platform</a></p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">2016-07-10</a></li>\n</ul>\n<p><img src=\"/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;\"></a>&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;</h2><h4 id=\"1-Mesos\"><a href=\"#1-Mesos\" class=\"headerlink\" title=\"1. Mesos\"></a><strong>1. Mesos</strong></h4><p><a href=\"http://mesos.apache.org/\">Mesos</a>&#x662F;<strong>&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x96C6;&#x7FA4;&#x5185;&#x7684;CPU&#xFF0C;&#x5185;&#x5B58;&#x4EE5;&#x53CA;&#x78C1;&#x76D8;&#x7B49;&#x8D44;&#x6E90;&#x3002;Hadoop MapReduce, Spark&#x4EE5;&#x53CA;Storm&#x7B49;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x5F88;&#x6D41;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x642D;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x96C6;&#x7FA4;&#x975E;&#x5E38;&#x5730;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5171;&#x4EAB;&#xFF0C;&#x800C;Mesos&#x7684;&#x8BBE;&#x8BA1;&#x521D;&#x8877;&#x5C31;&#x662F;&#x8BA9;&#x4E0D;&#x540C;&#x7684;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x80FD;&#x591F;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x3002;</p>\n<p>Mesos&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x5C42;&#x6B21;: Mesos&#x76D1;&#x63A7;&#x96C6;&#x7FA4;&#x7684;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x5C06;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x89C4;&#x5219;&#x5206;&#x914D;&#x7ED9;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#xFF1B;&#x800C;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F1A;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x6240;&#x5206;&#x914D;&#x7684;&#x8D44;&#x6E90;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;Mesos&#x4E0E;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x90FD;&#x53C2;&#x4E0E;&#x4E86;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;: Mesos&#x8D1F;&#x8D23;&#x5206;&#x914D;&#x8D44;&#x6E90;; &#x800C;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Mesos&#x7684;&#x8D23;&#x4EFB;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x800C;&#x4E14;&#x7B80;&#x5355;&#xFF1A;&#x5206;&#x914D;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x3002;Mesos&#x7684;&#x53CC;&#x5C42;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x63D0;&#x9AD8;&#x4E86;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x4E3B;&#x6D41;&#x7684;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x8FD8;&#x6709;Hadoop YARN&#xFF0C;Kubernetes&#x4EE5;&#x53CA;Swarm&#x3002;Hadoop YARN&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F8B;&#x5982;Spark&#xFF1B;Kubernetes&#x4E0E;Swarm&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF1B;&#x800C;Mesos&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4EE5;&#x53CA;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x7684;&#x652F;&#x6301;&#x90FD;&#x5F88;&#x6210;&#x719F;&#x3002;&#x5E76;&#x4E14;&#xFF0C;Kubernetes&#x4E0E;Swarm&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x3002;Kubernetes&#x7684;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;&#x5BFC;&#x81F4;&#x590D;&#x6742;&#x5EA6;&#x5F88;&#x9AD8;&#xFF0C;&#x800C;Swarm&#x7684;&#x8BBE;&#x8BA1;&#x7B80;&#x5355;&#x5F88;&#x591A;&#x4F46;&#x662F;&#x529F;&#x80FD;&#x76F8;&#x5BF9;&#x7F3A;&#x4E4F;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x3002;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#xFF0C;<strong>&#x4F7F;&#x7528;Mesos&#x7684;&#x8BDD;&#xFF0C;&#x6700;&#x597D;&#x9009;&#x62E9;Marathon&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x67B6;&#x6784;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4E14;&#x529F;&#x80FD;&#x4E30;&#x5BCC;&#x3002;</p>\n<h4 id=\"2-Marathon\"><a href=\"#2-Marathon\" class=\"headerlink\" title=\"2. Marathon\"></a><strong>2. Marathon</strong></h4><p><a href=\"https://mesosphere.github.io/marathon/\">Marathon</a>&#x662F;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#xFF0C;&#x662F;&#x8FD0;&#x884C;&#x4E8E;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x4F17;&#x591A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4E4B;&#x4E00;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Marathon&#x63D0;&#x4EA4;&#xFF0C;&#x76D1;&#x63A7;&#x5E76;&#x8C03;&#x5EA6;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF0C;&#x7136;&#x540E;Mesos&#x8D1F;&#x8D23;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x53E6;&#x5916;&#xFF0C;<a href=\"http://aurora.apache.org/\">Aurora</a>&#x4E0E;Marathon&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x540C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#x3002;&#x76F8;&#x6BD4;&#x800C;&#x8A00;&#xFF0C;Marathon&#x7684;&#x67B6;&#x6784;&#x6BD4;Aurora&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x4ECE;&#x8282;&#x70B9;&#xFF0C;&#x4E14;&#x5BF9;<a href=\"https://www.docker.com/\">Docker</a>&#x7684;&#x652F;&#x6301;&#x66F4;&#x4E3A;&#x5B8C;&#x5584;&#x3002;Marathon&#x7531;Mesosphere&#x516C;&#x53F8;&#x8D1F;&#x8D23;&#x5F00;&#x53D1;&#xFF0C;&#x793E;&#x533A;&#x5F88;&#x6D3B;&#x8DC3;&#xFF0C;&#x6587;&#x6863;&#x4E5F;&#x5F88;&#x5B8C;&#x5584;&#x3002;</p>\n<p>Marathon&#x5177;&#x6709;<strong>&#x5BB9;&#x9519;&#x529F;&#x80FD;</strong>&#xFF1A;&#x5F53;&#x5BB9;&#x5668;&#x7531;&#x4E8E;&#x8282;&#x70B9;&#x5D29;&#x6E83;&#x7B49;&#x539F;&#x56E0;&#x610F;&#x5916;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;Marathon&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x5BB9;&#x5668;&#x8C03;&#x5EA6;&#x5230;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x7C7B;&#x4F3C;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x4F8B;&#x5982;<a href=\"http://supervisord.org/\">Supervisor</a>&#xFF1A;&#x5F53;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x65F6;&#xFF0C;Supervisor&#x4F1A;&#x91CD;&#x542F;&#x8FDB;&#x7A0B;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x81EA;&#x52A8;&#x5BB9;&#x9519;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#xFF0C;&#x5373;&#x5E26;&#x6709;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F8B;&#x5982;MongoDB&#x4E0E;MySQL&#x3002;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5F88;&#x96BE;&#x8DE8;&#x8282;&#x70B9;&#x79FB;&#x52A8;&#xFF0C;&#x76EE;&#x524D;&#x7684;&#x6280;&#x672F;&#x8FD8;&#x4E0D;&#x591F;&#x6210;&#x719F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>Marathon&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x6570;&#x636E;&#x5E93;&#x7B49;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#x5E94;&#x8BE5;&#x5355;&#x72EC;&#x90E8;&#x7F72;</strong>&#x3002;&#x8FD9;&#x6837;&#x505A;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p>\n<h4 id=\"3-Marathon-LB\"><a href=\"#3-Marathon-LB\" class=\"headerlink\" title=\"3. Marathon LB\"></a><strong>3. Marathon LB</strong></h4><p><a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x4E0E;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x5F53;&#x4F7F;&#x7528;Marathon&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;(IP)&#x4E0E;&#x4F7F;&#x7528;&#x7684;&#x7AEF;&#x53E3;(PORT)&#x662F;Mesos/Marathon&#x5E73;&#x53F0;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x7684;&#xFF0C;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6BCF;&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5BB9;&#x5668;&#x51FA;&#x9519;&#x65F6;&#x4F1A;&#x53D1;&#x751F;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#xFF0C;IP&#x4E0E;PORT&#x4F1A;&#x53D8;&#x5316;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4F1A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x90E8;&#x7F72;&#x670D;&#x52A1;&#x65F6;&#xFF0C;IP&#x4E0E;PORT&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5C31;&#x65B9;&#x4FBF;&#x5F88;&#x591A;&#x4E86;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x90E8;&#x7F72;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#x6216;&#x8005;&#x5BB9;&#x5668;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;PORT&#x8BBF;&#x95EE;&#x8BE5;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x3002;</p>\n<p>&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5F80;&#x5F80;&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x526F;&#x672C;&#xFF0C;Marathon LB&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7684;&#x529F;&#x80FD;&#x3002;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x80FD;&#x591F;&#x4F7F;&#x7528;Round Robin&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><p>&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x521B;&#x5EFA;Mesos/Marathon&#x5E73;&#x53F0;&#x8FD0;&#x884C;&#x6240;&#x9700;&#x8981;&#x7684;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x8282;&#x70B9;&#x3002;</p>\n<p>&#x5176;&#x4E2D;&#xFF0C;node1&#x4E3A;&#x4E3B;&#x673A;&#x70B9;(Master)&#xFF0C;&#x8FD0;&#x884C;zookeeper, mesos_master, marathon&#x4EE5;&#x53CA;marathon-lb&#x5BB9;&#x5668;; node2&#x4E0E;node3&#x4E3A;&#x4ECE;&#x8282;&#x70B9;(Slave)&#xFF0C;&#x8FD0;&#x884C;mesos_slave&#x5BB9;&#x5668;&#xFF1B;&#x4F7F;&#x7528;marathon&#x90E8;&#x7F72;nginx&#x65F6;&#xFF0C;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;&#x4ECE;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x5982;&#x4E0B;&#x8868;&#x6240;&#x793A;:</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x8282;&#x70B9;</th>\n<th style=\"text-align:left\">IP</th>\n<th style=\"text-align:left\">&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">node1</td>\n<td style=\"text-align:left\">192.168.59.1</td>\n<td style=\"text-align:left\">zookeeper, mesos_master, marathon, marathon-lb</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node2</td>\n<td style=\"text-align:left\">192.168.59.2</td>\n<td style=\"text-align:left\">mesos_slave1, nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node3</td>\n<td style=\"text-align:left\">192.168.59.3</td>\n<td style=\"text-align:left\">mesos_slave2, nginx</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"><a href=\"#2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\" class=\"headerlink\" title=\"2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"></a><strong>2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;</strong></h4><p>&#x56E0;&#x4E3A;<strong>start-containers.sh</strong>&#x4F7F;&#x7528;&#x4E86;&#x8FDC;&#x7A0B;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5F00;&#x542F;Docker daemon&#x7684;TCP&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x3002;&#x63D0;&#x9192;&#x4E00;&#x4E0B;&#xFF0C;<strong>&#x5F00;&#x542F;Docker daemon&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;</strong>&#xFF0C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4E0D;&#x80FD;&#x6253;&#x5F00;&#xFF0C;&#x6216;&#x8005;&#x505A;&#x597D;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x3002;&#x4E0D;&#x5E0C;&#x671B;&#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;start-containers.sh&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x7A0D;&#x5FAE;&#x9EBB;&#x70E6;&#x4E00;&#x70B9;&#x3002;</p>\n<p>Master, Slave1&#x548C;Slave2:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo vim <span class=\"regexp\">/etc/</span><span class=\"keyword\">default</span><span class=\"regexp\">/docker</span></div></pre></td></tr></table></figure>\n<p>&#x4FEE;&#x6539;<strong>DOCKER_OPTS</strong></p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">DOCKER_OPTS</span>=<span class=\"string\">&quot;-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock&quot;</span></div></pre></td></tr></table></figure>\n<p>&#x91CD;&#x542F;Docker</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">sudo restart docker</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>Master:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">zookeeper:</span><span class=\"number\">3.4</span><span class=\"number\">.8</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathon:</span><span class=\"number\">1.1</span><span class=\"number\">.1</span>  </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathonlb:</span><span class=\"number\">1.3</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<p>Slave1 &#x548C; Slave2:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><p>Master:</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/mesos-marathon-platform</div></pre></td></tr></table></figure>\n<h4 id=\"5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><p>Master:</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> mesos-marathon-platform</div><div class=\"line\">sudo ./<span class=\"built_in\">start</span>-containers.sh</div></pre></td></tr></table></figure>\n<p>&#x7F51;&#x9875;&#x7BA1;&#x7406;:</p>\n<ul>\n<li>Mesos: <a href=\"http://192.168.59.1:5050/\">http://192.168.59.1:5050/</a></li>\n<li>Marathon: <a href=\"http://192.168.59.1:8080/\">http://192.168.59.1:8080/</a>  </li>\n</ul>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x589E;&#x52A0;Slave&#x8282;&#x70B9;&#xFF0C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;start-contaniers.sh&#x811A;&#x672C;&#x4E2D;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">MASTER_IP=<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.1</span></div><div class=\"line\">SLAVE_IP=(<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.2</span> <span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.3</span>)</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;Nginx\"><a href=\"#6-&#x8FD0;&#x884C;Nginx\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;Nginx:\"></a><strong>6. &#x8FD0;&#x884C;Nginx:</strong></h4><p>&#x4E0B;&#x8F7D;nginx&#x955C;&#x50CF;(Slave1&#x548C;Slave2):</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;Nginx(Master):</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./<span class=\"keyword\">run</span><span class=\"bash\">-nginx.sh</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x7684;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;(nginx.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;servicePort&#x8868;&#x793A;nginx&#x7ED1;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>10000</strong>&#xFF0C;&#x800C;marathon-lb&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;IP&#x4E3A;<strong>192.168.59.1</strong>&#x3002;&#x56E0;&#x6B64;nginx&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#x4E3A;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://192.168.59.1:10000/\">http://192.168.59.1:10000/</a></li>\n</ul>\n<p>&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E24;&#x4E2A;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x4E14;&#x7AEF;&#x53E3;&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://mesos.berkeley.edu/mesos_tech_report.pdf\">Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center</a></li>\n</ol>"},{"title":"使用Vagrant快速创建虚拟机","date":"2016-06-19T02:00:00.000Z","_content":"\n**摘要:** 手动创建虚拟机非常不方便，重装起来也很麻烦，打包成镜像的话则不易修改，很难进行版本控制，也无法移植到云端。[Vagrant](https://www.vagrantup.com/)可以将创建虚拟机的过程代码化，有效地解决了以上所提的痛点。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-19](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n<img src=\"160619-vagrant-virtual-machine/vagrant-vm.png\" width = \"300\"/>\n\n## 一. 快速入门\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 创建虚拟机**\n\n```\nmkdir vagrant-ubuntu\ncd vagrant-ubuntu\nvagrant box add ubuntu/trusty64\nvagrant init ubuntu/trusty64\nvagrant up --provider virtualbox\nvagrant ssh\n```\n\n- **vagrant box add:** 下载创建虚拟机所依赖的**box**\n- **vagrant init:** 生成创建虚拟机的所依赖的**Vagrantfile**\n- **vagrant up:** 创建虚拟机\n- **vagrant ssh:** SSH登陆虚拟机\n\n不妨查看一下Vagrant自动生成的**Vagrantfile**, 我删除了所有注释：\n\n```\nVagrant.configure(2) do |config|\n   config.vm.box = \"ubuntu/trusty64\"\nend\n```\n**Vagrantfile**的内容非常简单，仅定义虚拟机所依赖的**Box**为**ubuntu/trusty64**。**Box**相当于虚拟机所依赖的镜像文件。因此，这里创建的虚拟机是ubuntu trusty(14.04)。如果你需要创建其他Linux发行版例如Debian或者CentOS，可以在[这里](https://atlas.hashicorp.com/boxes/search)搜索对应的**Box**.\n\nVagrant虚拟机的默认配置:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 主机上的vagrant-ubuntu目录与虚拟机内的/vagrant目录内容实时同步\n- 内存：512MB\n- CPU: 1\n\n默认配置并不一定满足开发需求，下一小节将介绍如何进行自定义配置。\n\n\n## 二. 自定义配置\n\n#### **1. 修改Vagrantfile**\n\n```\nvim Vagrantfile\n```\n\n可以通过注释理解每个自定义配置的含义。\n\n```\nVagrant.configure(2) do |config|\n\n  # 设置虚拟机的Box\n  config.vm.box = \"ubuntu/trusty64\"\n  \n  # 设置虚拟机的主机名\n  config.vm.hostname=\"ubuntu\"\n  \n  # 设置虚拟机的IP\n  config.vm.network \"private_network\", ip: \"192.168.0.2\"\n  \n  # 设置主机与虚拟机的共享目录\n  config.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n  # VirtaulBox相关配置\n  config.vm.provider \"virtualbox\" do |v|\n\n      # 设置虚拟机的名称\n      v.name = \"ubuntu\"\n\n      # 设置虚拟机的内存大小\n      v.memory = 2048\n\n      # 设置虚拟机的CPU个数\n      v.cpus = 1\n  end\n  \n  # 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n\nend\n```\n\n#### **2. 在桌面上创建share目录**\n\n主机上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **3. 创建虚拟机**\n\n```\nvagrant destroy\nvagrant up --provider virtualbox\n```\n\n#### **4. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.0.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH无密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@127.0.0.1 -p 2222 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n其中，2222是主机SSH登陆虚拟机的转发端口，可以通过以下命令查看:\n\n```\nvagrant ssh-config | grep Port\n  Port 2222\n```\n\n此时SSH登陆虚拟机则不再需要输入密码。\n\n#### **5. 关于Provision**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provider virtualbox --provision\n```\n\n其实，Vagrant支持创建[Docker Provision](https://www.vagrantup.com/docs/provisioning/docker.html)，可以用于创建Docker主机，功能很多，但是用起来不如使用Shell脚本灵活。\n\n## 三. Vagrant与Docker比较\n\n[Vagrant](https://www.vagrantup.com/)与[Docker](https://www.docker.com/)都可以用于快速创建开发环境，但是，Vagrant是用于创建虚拟机的，而Docker是用于创建容器的，所以两者的功能并不相同。实际工作中，我两个都用，Vagrant仅用于创建虚拟机作为容器运行环境，而Docker用于开发和运行实际应用。这样实现了开发环境两层隔离，MacBook不需要安装多余的软件，Vagrant所创建的虚拟机也仅需要安装Docker等少数软件，这样更加方便和安全。\n\nVagrant是基于Vagrantfile创建虚拟机，而Docker是基于Dockerfile创建容器镜像。两者都是将应用的运行环境代码化，所以非常灵活，易于重复，也可以作版本控制。但是，Vagrantfile的语法其实非常简陋，远没有Dockerfile灵活。因此，Vagrant仅适合于创建开发环境，或者作为容器运行的环境，并不适合打包应用。\n\nVagrant的功能与[Docker Machine](https://docs.docker.com/machine/)功能一致，都是用于创建虚拟机。但是，Docker Machine是专用于创建Docker主机的，而Vagrant可以用于创建不同的开发环境。理论上Docker用户使用Docker Machine会更方便，但是我并没有选择Docker Machine，因为感觉并没有实际需求。Docker Machine所创建的本地虚拟机默认基于Docker专用的Linux发行版[boot2docker](https://github.com/boot2docker/boot2docker)，云端虚拟机默认基于ubuntu，对其他Linux发行版的支持还处于实验阶段。而Vagrant稳定支持更多Linux发行版，所以可以满足更多需求。Vagrant可以通过Vagrantfile进行自定义配置，而Docker Machine并没有对应功能，因此Vagrant用于创建虚拟机更加灵活。\n\n","source":"_posts/2016/06/19/160619-vagrant-virtual-machine.md","raw":"title: 使用Vagrant快速创建虚拟机\n\ndate: 2016-06-19 10:00\n\ntags: [Vagrant]\n\n---\n\n**摘要:** 手动创建虚拟机非常不方便，重装起来也很麻烦，打包成镜像的话则不易修改，很难进行版本控制，也无法移植到云端。[Vagrant](https://www.vagrantup.com/)可以将创建虚拟机的过程代码化，有效地解决了以上所提的痛点。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-19](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n<img src=\"160619-vagrant-virtual-machine/vagrant-vm.png\" width = \"300\"/>\n\n## 一. 快速入门\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 创建虚拟机**\n\n```\nmkdir vagrant-ubuntu\ncd vagrant-ubuntu\nvagrant box add ubuntu/trusty64\nvagrant init ubuntu/trusty64\nvagrant up --provider virtualbox\nvagrant ssh\n```\n\n- **vagrant box add:** 下载创建虚拟机所依赖的**box**\n- **vagrant init:** 生成创建虚拟机的所依赖的**Vagrantfile**\n- **vagrant up:** 创建虚拟机\n- **vagrant ssh:** SSH登陆虚拟机\n\n不妨查看一下Vagrant自动生成的**Vagrantfile**, 我删除了所有注释：\n\n```\nVagrant.configure(2) do |config|\n   config.vm.box = \"ubuntu/trusty64\"\nend\n```\n**Vagrantfile**的内容非常简单，仅定义虚拟机所依赖的**Box**为**ubuntu/trusty64**。**Box**相当于虚拟机所依赖的镜像文件。因此，这里创建的虚拟机是ubuntu trusty(14.04)。如果你需要创建其他Linux发行版例如Debian或者CentOS，可以在[这里](https://atlas.hashicorp.com/boxes/search)搜索对应的**Box**.\n\nVagrant虚拟机的默认配置:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 主机上的vagrant-ubuntu目录与虚拟机内的/vagrant目录内容实时同步\n- 内存：512MB\n- CPU: 1\n\n默认配置并不一定满足开发需求，下一小节将介绍如何进行自定义配置。\n\n\n## 二. 自定义配置\n\n#### **1. 修改Vagrantfile**\n\n```\nvim Vagrantfile\n```\n\n可以通过注释理解每个自定义配置的含义。\n\n```\nVagrant.configure(2) do |config|\n\n  # 设置虚拟机的Box\n  config.vm.box = \"ubuntu/trusty64\"\n  \n  # 设置虚拟机的主机名\n  config.vm.hostname=\"ubuntu\"\n  \n  # 设置虚拟机的IP\n  config.vm.network \"private_network\", ip: \"192.168.0.2\"\n  \n  # 设置主机与虚拟机的共享目录\n  config.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n  # VirtaulBox相关配置\n  config.vm.provider \"virtualbox\" do |v|\n\n      # 设置虚拟机的名称\n      v.name = \"ubuntu\"\n\n      # 设置虚拟机的内存大小\n      v.memory = 2048\n\n      # 设置虚拟机的CPU个数\n      v.cpus = 1\n  end\n  \n  # 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n\nend\n```\n\n#### **2. 在桌面上创建share目录**\n\n主机上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **3. 创建虚拟机**\n\n```\nvagrant destroy\nvagrant up --provider virtualbox\n```\n\n#### **4. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.0.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH无密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@127.0.0.1 -p 2222 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n其中，2222是主机SSH登陆虚拟机的转发端口，可以通过以下命令查看:\n\n```\nvagrant ssh-config | grep Port\n  Port 2222\n```\n\n此时SSH登陆虚拟机则不再需要输入密码。\n\n#### **5. 关于Provision**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provider virtualbox --provision\n```\n\n其实，Vagrant支持创建[Docker Provision](https://www.vagrantup.com/docs/provisioning/docker.html)，可以用于创建Docker主机，功能很多，但是用起来不如使用Shell脚本灵活。\n\n## 三. Vagrant与Docker比较\n\n[Vagrant](https://www.vagrantup.com/)与[Docker](https://www.docker.com/)都可以用于快速创建开发环境，但是，Vagrant是用于创建虚拟机的，而Docker是用于创建容器的，所以两者的功能并不相同。实际工作中，我两个都用，Vagrant仅用于创建虚拟机作为容器运行环境，而Docker用于开发和运行实际应用。这样实现了开发环境两层隔离，MacBook不需要安装多余的软件，Vagrant所创建的虚拟机也仅需要安装Docker等少数软件，这样更加方便和安全。\n\nVagrant是基于Vagrantfile创建虚拟机，而Docker是基于Dockerfile创建容器镜像。两者都是将应用的运行环境代码化，所以非常灵活，易于重复，也可以作版本控制。但是，Vagrantfile的语法其实非常简陋，远没有Dockerfile灵活。因此，Vagrant仅适合于创建开发环境，或者作为容器运行的环境，并不适合打包应用。\n\nVagrant的功能与[Docker Machine](https://docs.docker.com/machine/)功能一致，都是用于创建虚拟机。但是，Docker Machine是专用于创建Docker主机的，而Vagrant可以用于创建不同的开发环境。理论上Docker用户使用Docker Machine会更方便，但是我并没有选择Docker Machine，因为感觉并没有实际需求。Docker Machine所创建的本地虚拟机默认基于Docker专用的Linux发行版[boot2docker](https://github.com/boot2docker/boot2docker)，云端虚拟机默认基于ubuntu，对其他Linux发行版的支持还处于实验阶段。而Vagrant稳定支持更多Linux发行版，所以可以满足更多需求。Vagrant可以通过Vagrantfile进行自定义配置，而Docker Machine并没有对应功能，因此Vagrant用于创建虚拟机更加灵活。\n\n","slug":"2016/06/19/160619-vagrant-virtual-machine","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzw50010ivfy8ckcjuq0","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x624B;&#x52A8;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x91CD;&#x88C5;&#x8D77;&#x6765;&#x4E5F;&#x5F88;&#x9EBB;&#x70E6;&#xFF0C;&#x6253;&#x5305;&#x6210;&#x955C;&#x50CF;&#x7684;&#x8BDD;&#x5219;&#x4E0D;&#x6613;&#x4FEE;&#x6539;&#xFF0C;&#x5F88;&#x96BE;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x79FB;&#x690D;&#x5230;&#x4E91;&#x7AEF;&#x3002;<a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"external\">Vagrant</a>&#x53EF;&#x4EE5;&#x5C06;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6709;&#x6548;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x4EE5;&#x4E0A;&#x6240;&#x63D0;&#x7684;&#x75DB;&#x70B9;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">2016-06-19</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<p><img src=\"/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png\" width=\"300\"></p>\n<h2 id=\"&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\"><a href=\"#&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\" class=\"headerlink\" title=\"&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;\"></a>&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\" target=\"_blank\" rel=\"external\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\" target=\"_blank\" rel=\"external\">Vagrant</a></strong></h4><h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> vagrant-ubuntu</div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-ubuntu</div><div class=\"line\">vagrant box <span class=\"built_in\">add</span> ubuntu/trusty64</div><div class=\"line\">vagrant init ubuntu/trusty64</div><div class=\"line\">vagrant <span class=\"keyword\">up</span> --provider virtualbox</div><div class=\"line\">vagrant ssh</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>vagrant box add:</strong> &#x4E0B;&#x8F7D;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>box</strong></li>\n<li><strong>vagrant init:</strong> &#x751F;&#x6210;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Vagrantfile</strong></li>\n<li><strong>vagrant up:</strong> &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n</ul>\n<p>&#x4E0D;&#x59A8;&#x67E5;&#x770B;&#x4E00;&#x4E0B;Vagrant&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;<strong>Vagrantfile</strong>, &#x6211;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#xFF1A;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"built_in\">do</span> |<span class=\"built_in\">config</span>|</div><div class=\"line\">   <span class=\"built_in\">config</span>.vm.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"><span class=\"built_in\">end</span></div></pre></td></tr></table></figure>\n<p><strong>Vagrantfile</strong>&#x7684;&#x5185;&#x5BB9;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4EC5;&#x5B9A;&#x4E49;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Box</strong>&#x4E3A;<strong>ubuntu/trusty64</strong>&#x3002;<strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x662F;ubuntu trusty(14.04)&#x3002;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x4F8B;&#x5982;Debian&#x6216;&#x8005;CentOS&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://atlas.hashicorp.com/boxes/search\" target=\"_blank\" rel=\"external\">&#x8FD9;&#x91CC;</a>&#x641C;&#x7D22;&#x5BF9;&#x5E94;&#x7684;<strong>Box</strong>.</p>\n<p>Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x4E3B;&#x673A;&#x4E0A;&#x7684;vagrant-ubuntu&#x76EE;&#x5F55;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/vagrant&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;512MB</li>\n<li>CPU: 1</li>\n</ul>\n<p>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x6EE1;&#x8DB3;&#x5F00;&#x53D1;&#x9700;&#x6C42;&#xFF0C;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"><a href=\"#&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"></a>&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;</h2><h4 id=\"1-&#x4FEE;&#x6539;Vagrantfile\"><a href=\"#1-&#x4FEE;&#x6539;Vagrantfile\" class=\"headerlink\" title=\"1. &#x4FEE;&#x6539;Vagrantfile\"></a><strong>1. &#x4FEE;&#x6539;Vagrantfile</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vim Vagrantfile</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#x3002;</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"keyword\">do</span> |config|</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</span></div><div class=\"line\">  config.vm.<span class=\"built_in\">box</span> = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">  config.vm.hostname=<span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">  config.vm.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.0.2&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">  config.vm.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provider <span class=\"string\">&quot;virtualbox&quot;</span> <span class=\"keyword\">do</span> |v|</div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">      v.name = <span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span></div><div class=\"line\">      v.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">      v.cpus = <span class=\"number\">1</span></div><div class=\"line\">  <span class=\"keyword\">end</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-<span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\">     <span class=\"meta\"># &#x5B89;&#x88C5;Docker 1.11.0</span></div><div class=\"line\">     apt-get update</div><div class=\"line\">     apt-get install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-get update;</div><div class=\"line\">     apt-get install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">end</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x4E3B;&#x673A;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant destroy</div><div class=\"line\">vagrant up <span class=\"comment\">--provider virtualbox</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">0</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x65E0;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">127.0.0.1</span> -p <span class=\"number\">2222</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;2222&#x662F;&#x4E3B;&#x673A;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8F6C;&#x53D1;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight vhdl\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant ssh-config | grep <span class=\"keyword\">Port</span></div><div class=\"line\">  <span class=\"keyword\">Port</span> <span class=\"number\">2222</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#x3002;</p>\n<h4 id=\"5-&#x5173;&#x4E8E;Provision\"><a href=\"#5-&#x5173;&#x4E8E;Provision\" class=\"headerlink\" title=\"5. &#x5173;&#x4E8E;Provision\"></a><strong>5. &#x5173;&#x4E8E;Provision</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">     # &#x5B89;&#x88C5;Docker <span class=\"number\">1.11</span><span class=\"number\">.0</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span>;</div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">halt</span></div><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">up</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provider</span> <span class=\"comment\">virtualbox</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provision</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#xFF0C;Vagrant&#x652F;&#x6301;&#x521B;&#x5EFA;<a href=\"https://www.vagrantup.com/docs/provisioning/docker.html\" target=\"_blank\" rel=\"external\">Docker Provision</a>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#xFF0C;&#x529F;&#x80FD;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x7528;&#x8D77;&#x6765;&#x4E0D;&#x5982;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x7075;&#x6D3B;&#x3002;</p>\n<h2 id=\"&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"><a href=\"#&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\" class=\"headerlink\" title=\"&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"></a>&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;</h2><p><a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"external\">Vagrant</a>&#x4E0E;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;Vagrant&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#xFF0C;&#x800C;Docker&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E24;&#x8005;&#x7684;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#x3002;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x4E24;&#x4E2A;&#x90FD;&#x7528;&#xFF0C;Vagrant&#x4EC5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x800C;Docker&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x548C;&#x8FD0;&#x884C;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x3002;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x4E86;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E24;&#x5C42;&#x9694;&#x79BB;&#xFF0C;MacBook&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x591A;&#x4F59;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;Vagrant&#x6240;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x4E5F;&#x4EC5;&#x9700;&#x8981;&#x5B89;&#x88C5;Docker&#x7B49;&#x5C11;&#x6570;&#x8F6F;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x548C;&#x5B89;&#x5168;&#x3002;</p>\n<p>Vagrant&#x662F;&#x57FA;&#x4E8E;Vagrantfile&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C;Docker&#x662F;&#x57FA;&#x4E8E;Dockerfile&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x3002;&#x4E24;&#x8005;&#x90FD;&#x662F;&#x5C06;&#x5E94;&#x7528;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#xFF0C;&#x6613;&#x4E8E;&#x91CD;&#x590D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x7248;&#x672C;&#x63A7;&#x5236;&#x3002;&#x4F46;&#x662F;&#xFF0C;Vagrantfile&#x7684;&#x8BED;&#x6CD5;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x964B;&#xFF0C;&#x8FDC;&#x6CA1;&#x6709;Dockerfile&#x7075;&#x6D3B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Vagrant&#x4EC5;&#x9002;&#x5408;&#x4E8E;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x6216;&#x8005;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6253;&#x5305;&#x5E94;&#x7528;&#x3002;</p>\n<p>Vagrant&#x7684;&#x529F;&#x80FD;&#x4E0E;<a href=\"https://docs.docker.com/machine/\" target=\"_blank\" rel=\"external\">Docker Machine</a>&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x90FD;&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x3002;&#x4F46;&#x662F;&#xFF0C;Docker Machine&#x662F;&#x4E13;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#x7684;&#xFF0C;&#x800C;Vagrant&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;&#x7406;&#x8BBA;&#x4E0A;Docker&#x7528;&#x6237;&#x4F7F;&#x7528;Docker Machine&#x4F1A;&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x9009;&#x62E9;Docker Machine&#xFF0C;&#x56E0;&#x4E3A;&#x611F;&#x89C9;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x3002;Docker Machine&#x6240;&#x521B;&#x5EFA;&#x7684;&#x672C;&#x5730;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;Docker&#x4E13;&#x7528;&#x7684;Linux&#x53D1;&#x884C;&#x7248;<a href=\"https://github.com/boot2docker/boot2docker\" target=\"_blank\" rel=\"external\">boot2docker</a>&#xFF0C;&#x4E91;&#x7AEF;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;ubuntu&#xFF0C;&#x5BF9;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x7684;&#x652F;&#x6301;&#x8FD8;&#x5904;&#x4E8E;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#x3002;&#x800C;Vagrant&#x7A33;&#x5B9A;&#x652F;&#x6301;&#x66F4;&#x591A;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x66F4;&#x591A;&#x9700;&#x6C42;&#x3002;Vagrant&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Vagrantfile&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#xFF0C;&#x800C;Docker Machine&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;Vagrant&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</p>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x624B;&#x52A8;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x91CD;&#x88C5;&#x8D77;&#x6765;&#x4E5F;&#x5F88;&#x9EBB;&#x70E6;&#xFF0C;&#x6253;&#x5305;&#x6210;&#x955C;&#x50CF;&#x7684;&#x8BDD;&#x5219;&#x4E0D;&#x6613;&#x4FEE;&#x6539;&#xFF0C;&#x5F88;&#x96BE;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x79FB;&#x690D;&#x5230;&#x4E91;&#x7AEF;&#x3002;<a href=\"https://www.vagrantup.com/\">Vagrant</a>&#x53EF;&#x4EE5;&#x5C06;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6709;&#x6548;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x4EE5;&#x4E0A;&#x6240;&#x63D0;&#x7684;&#x75DB;&#x70B9;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">2016-06-19</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<p><img src=\"/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png\" width=\"300\"></p>\n<h2 id=\"&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\"><a href=\"#&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\" class=\"headerlink\" title=\"&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;\"></a>&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\">Vagrant</a></strong></h4><h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> vagrant-ubuntu</div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-ubuntu</div><div class=\"line\">vagrant box <span class=\"built_in\">add</span> ubuntu/trusty64</div><div class=\"line\">vagrant init ubuntu/trusty64</div><div class=\"line\">vagrant <span class=\"keyword\">up</span> --provider virtualbox</div><div class=\"line\">vagrant ssh</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>vagrant box add:</strong> &#x4E0B;&#x8F7D;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>box</strong></li>\n<li><strong>vagrant init:</strong> &#x751F;&#x6210;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Vagrantfile</strong></li>\n<li><strong>vagrant up:</strong> &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n</ul>\n<p>&#x4E0D;&#x59A8;&#x67E5;&#x770B;&#x4E00;&#x4E0B;Vagrant&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;<strong>Vagrantfile</strong>, &#x6211;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#xFF1A;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"built_in\">do</span> |<span class=\"built_in\">config</span>|</div><div class=\"line\">   <span class=\"built_in\">config</span>.vm.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"><span class=\"built_in\">end</span></div></pre></td></tr></table></figure>\n<p><strong>Vagrantfile</strong>&#x7684;&#x5185;&#x5BB9;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4EC5;&#x5B9A;&#x4E49;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Box</strong>&#x4E3A;<strong>ubuntu/trusty64</strong>&#x3002;<strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x662F;ubuntu trusty(14.04)&#x3002;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x4F8B;&#x5982;Debian&#x6216;&#x8005;CentOS&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://atlas.hashicorp.com/boxes/search\">&#x8FD9;&#x91CC;</a>&#x641C;&#x7D22;&#x5BF9;&#x5E94;&#x7684;<strong>Box</strong>.</p>\n<p>Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x4E3B;&#x673A;&#x4E0A;&#x7684;vagrant-ubuntu&#x76EE;&#x5F55;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/vagrant&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;512MB</li>\n<li>CPU: 1</li>\n</ul>\n<p>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x6EE1;&#x8DB3;&#x5F00;&#x53D1;&#x9700;&#x6C42;&#xFF0C;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"><a href=\"#&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"></a>&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;</h2><h4 id=\"1-&#x4FEE;&#x6539;Vagrantfile\"><a href=\"#1-&#x4FEE;&#x6539;Vagrantfile\" class=\"headerlink\" title=\"1. &#x4FEE;&#x6539;Vagrantfile\"></a><strong>1. &#x4FEE;&#x6539;Vagrantfile</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vim Vagrantfile</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#x3002;</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"keyword\">do</span> |config|</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</span></div><div class=\"line\">  config.vm.<span class=\"built_in\">box</span> = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">  config.vm.hostname=<span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">  config.vm.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.0.2&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">  config.vm.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provider <span class=\"string\">&quot;virtualbox&quot;</span> <span class=\"keyword\">do</span> |v|</div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">      v.name = <span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span></div><div class=\"line\">      v.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">      v.cpus = <span class=\"number\">1</span></div><div class=\"line\">  <span class=\"keyword\">end</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-<span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\">     <span class=\"meta\"># &#x5B89;&#x88C5;Docker 1.11.0</span></div><div class=\"line\">     apt-get update</div><div class=\"line\">     apt-get install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-get update;</div><div class=\"line\">     apt-get install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">end</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x4E3B;&#x673A;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant destroy</div><div class=\"line\">vagrant up <span class=\"comment\">--provider virtualbox</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">0</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x65E0;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">127.0.0.1</span> -p <span class=\"number\">2222</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;2222&#x662F;&#x4E3B;&#x673A;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8F6C;&#x53D1;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight vhdl\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant ssh-config | grep <span class=\"keyword\">Port</span></div><div class=\"line\">  <span class=\"keyword\">Port</span> <span class=\"number\">2222</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#x3002;</p>\n<h4 id=\"5-&#x5173;&#x4E8E;Provision\"><a href=\"#5-&#x5173;&#x4E8E;Provision\" class=\"headerlink\" title=\"5. &#x5173;&#x4E8E;Provision\"></a><strong>5. &#x5173;&#x4E8E;Provision</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">     # &#x5B89;&#x88C5;Docker <span class=\"number\">1.11</span><span class=\"number\">.0</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span>;</div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">halt</span></div><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">up</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provider</span> <span class=\"comment\">virtualbox</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provision</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#xFF0C;Vagrant&#x652F;&#x6301;&#x521B;&#x5EFA;<a href=\"https://www.vagrantup.com/docs/provisioning/docker.html\">Docker Provision</a>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#xFF0C;&#x529F;&#x80FD;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x7528;&#x8D77;&#x6765;&#x4E0D;&#x5982;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x7075;&#x6D3B;&#x3002;</p>\n<h2 id=\"&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"><a href=\"#&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\" class=\"headerlink\" title=\"&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"></a>&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;</h2><p><a href=\"https://www.vagrantup.com/\">Vagrant</a>&#x4E0E;<a href=\"https://www.docker.com/\">Docker</a>&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;Vagrant&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#xFF0C;&#x800C;Docker&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E24;&#x8005;&#x7684;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#x3002;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x4E24;&#x4E2A;&#x90FD;&#x7528;&#xFF0C;Vagrant&#x4EC5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x800C;Docker&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x548C;&#x8FD0;&#x884C;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x3002;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x4E86;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E24;&#x5C42;&#x9694;&#x79BB;&#xFF0C;MacBook&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x591A;&#x4F59;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;Vagrant&#x6240;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x4E5F;&#x4EC5;&#x9700;&#x8981;&#x5B89;&#x88C5;Docker&#x7B49;&#x5C11;&#x6570;&#x8F6F;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x548C;&#x5B89;&#x5168;&#x3002;</p>\n<p>Vagrant&#x662F;&#x57FA;&#x4E8E;Vagrantfile&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C;Docker&#x662F;&#x57FA;&#x4E8E;Dockerfile&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x3002;&#x4E24;&#x8005;&#x90FD;&#x662F;&#x5C06;&#x5E94;&#x7528;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#xFF0C;&#x6613;&#x4E8E;&#x91CD;&#x590D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x7248;&#x672C;&#x63A7;&#x5236;&#x3002;&#x4F46;&#x662F;&#xFF0C;Vagrantfile&#x7684;&#x8BED;&#x6CD5;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x964B;&#xFF0C;&#x8FDC;&#x6CA1;&#x6709;Dockerfile&#x7075;&#x6D3B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Vagrant&#x4EC5;&#x9002;&#x5408;&#x4E8E;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x6216;&#x8005;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6253;&#x5305;&#x5E94;&#x7528;&#x3002;</p>\n<p>Vagrant&#x7684;&#x529F;&#x80FD;&#x4E0E;<a href=\"https://docs.docker.com/machine/\">Docker Machine</a>&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x90FD;&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x3002;&#x4F46;&#x662F;&#xFF0C;Docker Machine&#x662F;&#x4E13;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#x7684;&#xFF0C;&#x800C;Vagrant&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;&#x7406;&#x8BBA;&#x4E0A;Docker&#x7528;&#x6237;&#x4F7F;&#x7528;Docker Machine&#x4F1A;&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x9009;&#x62E9;Docker Machine&#xFF0C;&#x56E0;&#x4E3A;&#x611F;&#x89C9;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x3002;Docker Machine&#x6240;&#x521B;&#x5EFA;&#x7684;&#x672C;&#x5730;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;Docker&#x4E13;&#x7528;&#x7684;Linux&#x53D1;&#x884C;&#x7248;<a href=\"https://github.com/boot2docker/boot2docker\">boot2docker</a>&#xFF0C;&#x4E91;&#x7AEF;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;ubuntu&#xFF0C;&#x5BF9;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x7684;&#x652F;&#x6301;&#x8FD8;&#x5904;&#x4E8E;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#x3002;&#x800C;Vagrant&#x7A33;&#x5B9A;&#x652F;&#x6301;&#x66F4;&#x591A;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x66F4;&#x591A;&#x9700;&#x6C42;&#x3002;Vagrant&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Vagrantfile&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#xFF0C;&#x800C;Docker Machine&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;Vagrant&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</p>"},{"title":"Run Hadoop Cluster in Docker Update","date":"2016-06-26T02:00:00.000Z","_content":"\n**Abstract:** Last year, I developed [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project, which aims to help user quickly build [Hadoop](http://hadoop.apache.org/) cluster on local host using [Docker](https://www.docker.com/). The project is quite popular with 250+ stars on [GitHub](https://github.com/kiwenlau/hadoop-cluster-docker) and 2500+ pulls on [Docker Hub](https://hub.docker.com/r/kiwenlau/hadoop-master/). In this blog, I'd like to introduce the update version.\n\n<!-- more -->\n\n- Author: [KiwenLau](http://kiwenlau.com/)\n- Date: [2016-06-26](http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/)\n\n## Introduction\n\nBy packaging [Hadoop](http://hadoop.apache.org/) into [Docker](https://www.docker.com/) image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:\n\n- How to configure Hadoop cluster correctly?\n- How to run word count application?\n- How to manage HDFS?\n- How to run test program on local host?\n\nFollowing figure shows the architecture of [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(**HDFS**), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(**YARN**). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. \n\n<img src=\"hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width = \"500\"/>\n\nIn the old version, I use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don't need to use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) any more. We can create a independent network for Hadoop cluster using following command:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\nBy using \"--net=hadoop\" option when we start Hadoop containers, these containers will attach to the \"hadoop\" network and they are able to communicate with container name.\n\n**Key points of update：**\n\n- eliminate [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) \n- merge master and slave image\n- install Hadoop using [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n- simplify Hadoop configuration\n\n## 3 Nodes Hadoop Cluster\n\n#### **1. pull docker image**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. clone github repository**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. create hadoop network**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh\n```\n\n**output:**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n- start 3 containers with 1 master and 2 slaves\n- you will get into the /root directory of hadoop-master container\n\n#### **5. start hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. run wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**output**\n\n```\ninput file1.txt:\nHello Hadoop\n\ninput file2.txt:\nHello Docker\n\nwordcount output:\nDocker    1\nHadoop    1\nHello    2\n```\n\n## Arbitrary size Hadoop cluster\n\n#### **1. pull docker images and clone github repository**\n\ndo 1~3 like previous section\n\n#### **2. rebuild docker image**\n\n```\nsudo ./resize-cluster.sh 5\n```\n- specify parameter > 1: 2, 3..\n- this script just rebuild hadoop image with different **slaves** file, which pecifies the name of all slave nodes\n\n\n#### **3. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh 5\n```\n- use the same parameter as the step 2\n\n#### **4. run hadoop cluster** \n\ndo 5~6 like previous section\n\n## References\n\n1. [Quickly build arbitrary size Hadoop Cluster based on Docker](http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","source":"_posts/2016/06/26/hadoop-cluster-docker-update-english.md","raw":"title: Run Hadoop Cluster in Docker Update\n\ndate: 2016-06-26 10:00\n\ntags: [Docker, Hadoop]\n\n---\n\n**Abstract:** Last year, I developed [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project, which aims to help user quickly build [Hadoop](http://hadoop.apache.org/) cluster on local host using [Docker](https://www.docker.com/). The project is quite popular with 250+ stars on [GitHub](https://github.com/kiwenlau/hadoop-cluster-docker) and 2500+ pulls on [Docker Hub](https://hub.docker.com/r/kiwenlau/hadoop-master/). In this blog, I'd like to introduce the update version.\n\n<!-- more -->\n\n- Author: [KiwenLau](http://kiwenlau.com/)\n- Date: [2016-06-26](http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/)\n\n## Introduction\n\nBy packaging [Hadoop](http://hadoop.apache.org/) into [Docker](https://www.docker.com/) image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:\n\n- How to configure Hadoop cluster correctly?\n- How to run word count application?\n- How to manage HDFS?\n- How to run test program on local host?\n\nFollowing figure shows the architecture of [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(**HDFS**), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(**YARN**). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. \n\n<img src=\"hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width = \"500\"/>\n\nIn the old version, I use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don't need to use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) any more. We can create a independent network for Hadoop cluster using following command:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\nBy using \"--net=hadoop\" option when we start Hadoop containers, these containers will attach to the \"hadoop\" network and they are able to communicate with container name.\n\n**Key points of update：**\n\n- eliminate [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) \n- merge master and slave image\n- install Hadoop using [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n- simplify Hadoop configuration\n\n## 3 Nodes Hadoop Cluster\n\n#### **1. pull docker image**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. clone github repository**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. create hadoop network**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh\n```\n\n**output:**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n- start 3 containers with 1 master and 2 slaves\n- you will get into the /root directory of hadoop-master container\n\n#### **5. start hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. run wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**output**\n\n```\ninput file1.txt:\nHello Hadoop\n\ninput file2.txt:\nHello Docker\n\nwordcount output:\nDocker    1\nHadoop    1\nHello    2\n```\n\n## Arbitrary size Hadoop cluster\n\n#### **1. pull docker images and clone github repository**\n\ndo 1~3 like previous section\n\n#### **2. rebuild docker image**\n\n```\nsudo ./resize-cluster.sh 5\n```\n- specify parameter > 1: 2, 3..\n- this script just rebuild hadoop image with different **slaves** file, which pecifies the name of all slave nodes\n\n\n#### **3. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh 5\n```\n- use the same parameter as the step 2\n\n#### **4. run hadoop cluster** \n\ndo 5~6 like previous section\n\n## References\n\n1. [Quickly build arbitrary size Hadoop Cluster based on Docker](http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","slug":"2016/06/26/hadoop-cluster-docker-update-english","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzw80012ivfypy0moxg7","content":"<p><strong>Abstract:</strong> Last year, I developed <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a> project, which aims to help user quickly build <a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a> cluster on local host using <a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>. The project is quite popular with 250+ stars on <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">GitHub</a> and 2500+ pulls on <a href=\"https://hub.docker.com/r/kiwenlau/hadoop-master/\" target=\"_blank\" rel=\"external\">Docker Hub</a>. In this blog, I&#x2019;d like to introduce the update version.</p>\n<a id=\"more\"></a>\n<ul>\n<li>Author: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>Date: <a href=\"http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/\">2016-06-26</a></li>\n</ul>\n<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>By packaging <a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a> into <a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a> image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:</p>\n<ul>\n<li>How to configure Hadoop cluster correctly?</li>\n<li>How to run word count application?</li>\n<li>How to manage HDFS?</li>\n<li>How to run test program on local host?</li>\n</ul>\n<p>Following figure shows the architecture of <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a> project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(<strong>HDFS</strong>), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(<strong>YARN</strong>). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. </p>\n<p><img src=\"/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>In the old version, I use <a href=\"https://www.serfdom.io/\" target=\"_blank\" rel=\"external\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\" target=\"_blank\" rel=\"external\">dnsmasq</a> to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don&#x2019;t need to use <a href=\"https://www.serfdom.io/\" target=\"_blank\" rel=\"external\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\" target=\"_blank\" rel=\"external\">dnsmasq</a> any more. We can create a independent network for Hadoop cluster using following command:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>By using &#x201C;&#x2013;net=hadoop&#x201D; option when we start Hadoop containers, these containers will attach to the &#x201C;hadoop&#x201D; network and they are able to communicate with container name.</p>\n<p><strong>Key points of update&#xFF1A;</strong></p>\n<ul>\n<li>eliminate <a href=\"https://www.serfdom.io/\" target=\"_blank\" rel=\"external\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\" target=\"_blank\" rel=\"external\">dnsmasq</a> </li>\n<li>merge master and slave image</li>\n<li>install Hadoop using <a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a></li>\n<li>simplify Hadoop configuration</li>\n</ul>\n<h2 id=\"3-Nodes-Hadoop-Cluster\"><a href=\"#3-Nodes-Hadoop-Cluster\" class=\"headerlink\" title=\"3 Nodes Hadoop Cluster\"></a>3 Nodes Hadoop Cluster</h2><h4 id=\"1-pull-docker-image\"><a href=\"#1-pull-docker-image\" class=\"headerlink\" title=\"1. pull docker image\"></a><strong>1. pull docker image</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-clone-github-repository\"><a href=\"#2-clone-github-repository\" class=\"headerlink\" title=\"2. clone github repository\"></a><strong>2. clone github repository</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-create-hadoop-network\"><a href=\"#3-create-hadoop-network\" class=\"headerlink\" title=\"3. create hadoop network\"></a><strong>3. create hadoop network</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-start-container\"><a href=\"#4-start-container\" class=\"headerlink\" title=\"4. start container\"></a><strong>4. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>output:</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>start 3 containers with 1 master and 2 slaves</li>\n<li>you will get into the /root directory of hadoop-master container</li>\n</ul>\n<h4 id=\"5-start-hadoop\"><a href=\"#5-start-hadoop\" class=\"headerlink\" title=\"5. start hadoop\"></a><strong>5. start hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-run-wordcount\"><a href=\"#6-run-wordcount\" class=\"headerlink\" title=\"6. run wordcount\"></a><strong>6. run wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>output</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\"></div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker    <span class=\"number\">1</span></div><div class=\"line\">Hadoop    <span class=\"number\">1</span></div><div class=\"line\">Hello    <span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<h2 id=\"Arbitrary-size-Hadoop-cluster\"><a href=\"#Arbitrary-size-Hadoop-cluster\" class=\"headerlink\" title=\"Arbitrary size Hadoop cluster\"></a>Arbitrary size Hadoop cluster</h2><h4 id=\"1-pull-docker-images-and-clone-github-repository\"><a href=\"#1-pull-docker-images-and-clone-github-repository\" class=\"headerlink\" title=\"1. pull docker images and clone github repository\"></a><strong>1. pull docker images and clone github repository</strong></h4><p>do 1~3 like previous section</p>\n<h4 id=\"2-rebuild-docker-image\"><a href=\"#2-rebuild-docker-image\" class=\"headerlink\" title=\"2. rebuild docker image\"></a><strong>2. rebuild docker image</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>specify parameter &gt; 1: 2, 3..</li>\n<li>this script just rebuild hadoop image with different <strong>slaves</strong> file, which pecifies the name of all slave nodes</li>\n</ul>\n<h4 id=\"3-start-container\"><a href=\"#3-start-container\" class=\"headerlink\" title=\"3. start container\"></a><strong>3. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>use the same parameter as the step 2</li>\n</ul>\n<h4 id=\"4-run-hadoop-cluster\"><a href=\"#4-run-hadoop-cluster\" class=\"headerlink\" title=\"4. run hadoop cluster\"></a><strong>4. run hadoop cluster</strong></h4><p>do 5~6 like previous section</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ol>\n<li><a href=\"http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html\" target=\"_blank\" rel=\"external\">Quickly build arbitrary size Hadoop Cluster based on Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\" target=\"_blank\" rel=\"external\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>\n","excerpt":"<p><strong>Abstract:</strong> Last year, I developed <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">kiwenlau/hadoop-cluster-docker</a> project, which aims to help user quickly build <a href=\"http://hadoop.apache.org/\">Hadoop</a> cluster on local host using <a href=\"https://www.docker.com/\">Docker</a>. The project is quite popular with 250+ stars on <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">GitHub</a> and 2500+ pulls on <a href=\"https://hub.docker.com/r/kiwenlau/hadoop-master/\">Docker Hub</a>. In this blog, I&#x2019;d like to introduce the update version.</p>","more":"<ul>\n<li>Author: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>Date: <a href=\"http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/\">2016-06-26</a></li>\n</ul>\n<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>By packaging <a href=\"http://hadoop.apache.org/\">Hadoop</a> into <a href=\"https://www.docker.com/\">Docker</a> image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:</p>\n<ul>\n<li>How to configure Hadoop cluster correctly?</li>\n<li>How to run word count application?</li>\n<li>How to manage HDFS?</li>\n<li>How to run test program on local host?</li>\n</ul>\n<p>Following figure shows the architecture of <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">kiwenlau/hadoop-cluster-docker</a> project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(<strong>HDFS</strong>), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(<strong>YARN</strong>). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. </p>\n<p><img src=\"/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>In the old version, I use <a href=\"https://www.serfdom.io/\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">dnsmasq</a> to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don&#x2019;t need to use <a href=\"https://www.serfdom.io/\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">dnsmasq</a> any more. We can create a independent network for Hadoop cluster using following command:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>By using &#x201C;&#x2013;net=hadoop&#x201D; option when we start Hadoop containers, these containers will attach to the &#x201C;hadoop&#x201D; network and they are able to communicate with container name.</p>\n<p><strong>Key points of update&#xFF1A;</strong></p>\n<ul>\n<li>eliminate <a href=\"https://www.serfdom.io/\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">dnsmasq</a> </li>\n<li>merge master and slave image</li>\n<li>install Hadoop using <a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a></li>\n<li>simplify Hadoop configuration</li>\n</ul>\n<h2 id=\"3-Nodes-Hadoop-Cluster\"><a href=\"#3-Nodes-Hadoop-Cluster\" class=\"headerlink\" title=\"3 Nodes Hadoop Cluster\"></a>3 Nodes Hadoop Cluster</h2><h4 id=\"1-pull-docker-image\"><a href=\"#1-pull-docker-image\" class=\"headerlink\" title=\"1. pull docker image\"></a><strong>1. pull docker image</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-clone-github-repository\"><a href=\"#2-clone-github-repository\" class=\"headerlink\" title=\"2. clone github repository\"></a><strong>2. clone github repository</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-create-hadoop-network\"><a href=\"#3-create-hadoop-network\" class=\"headerlink\" title=\"3. create hadoop network\"></a><strong>3. create hadoop network</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-start-container\"><a href=\"#4-start-container\" class=\"headerlink\" title=\"4. start container\"></a><strong>4. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>output:</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>start 3 containers with 1 master and 2 slaves</li>\n<li>you will get into the /root directory of hadoop-master container</li>\n</ul>\n<h4 id=\"5-start-hadoop\"><a href=\"#5-start-hadoop\" class=\"headerlink\" title=\"5. start hadoop\"></a><strong>5. start hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-run-wordcount\"><a href=\"#6-run-wordcount\" class=\"headerlink\" title=\"6. run wordcount\"></a><strong>6. run wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>output</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\"></div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker    <span class=\"number\">1</span></div><div class=\"line\">Hadoop    <span class=\"number\">1</span></div><div class=\"line\">Hello    <span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<h2 id=\"Arbitrary-size-Hadoop-cluster\"><a href=\"#Arbitrary-size-Hadoop-cluster\" class=\"headerlink\" title=\"Arbitrary size Hadoop cluster\"></a>Arbitrary size Hadoop cluster</h2><h4 id=\"1-pull-docker-images-and-clone-github-repository\"><a href=\"#1-pull-docker-images-and-clone-github-repository\" class=\"headerlink\" title=\"1. pull docker images and clone github repository\"></a><strong>1. pull docker images and clone github repository</strong></h4><p>do 1~3 like previous section</p>\n<h4 id=\"2-rebuild-docker-image\"><a href=\"#2-rebuild-docker-image\" class=\"headerlink\" title=\"2. rebuild docker image\"></a><strong>2. rebuild docker image</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>specify parameter &gt; 1: 2, 3..</li>\n<li>this script just rebuild hadoop image with different <strong>slaves</strong> file, which pecifies the name of all slave nodes</li>\n</ul>\n<h4 id=\"3-start-container\"><a href=\"#3-start-container\" class=\"headerlink\" title=\"3. start container\"></a><strong>3. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>use the same parameter as the step 2</li>\n</ul>\n<h4 id=\"4-run-hadoop-cluster\"><a href=\"#4-run-hadoop-cluster\" class=\"headerlink\" title=\"4. run hadoop cluster\"></a><strong>4. run hadoop cluster</strong></h4><p>do 5~6 like previous section</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ol>\n<li><a href=\"http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html\">Quickly build arbitrary size Hadoop Cluster based on Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>"},{"title":"什么是服务发现？","date":"2016-09-04T02:00:00.000Z","_content":"\n**摘要:** 将容器应用部署到集群时，其服务地址，即**IP**和**端口**, 是由集群系统动态分配的。那么，当我们需要访问这个服务时，如何确定它的地址呢？这时，就需要**服务发现(Service Discovery)**了。本文将以Nginx的部署为例，介绍服务发现的原理与实践。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-04](http://kiwenlau.com/2016/09/04/what-is-service-discovery/)\n\n<img src=\"what-is-service-discovery/service-discovery.png\" width = \"500\"/>\n\n## 一. 单机部署Nginx\n\n[Nginx](https://nginx.org)作为网页服务器，功能与Apache一致。使用[Docker](https://www.docker.com/), 可以快速部署Nginx。\n\n#### **1. 下载Nginx镜像**\n\n```\nsudo docker pull nginx:1.10\n```\n\n#### **2. 运行Nginx容器**\n\n```\nsudo docker run -d \\\n                -p 8080:80 \\\n                nginx:1.10\n```\n\n其中，**-d**选项表示Nginx容器在后台运行，**-p**选项表示主机的**8080**端口映射为容器的**80**端口。\n\n#### **3. 访问Nginx服务**\n\n使用浏览器服务Nginx\n\n[http://192.168.59.1:8080](http://192.168.59.1:8080)\n\n或者使用curl命令访问Nginx, 其返回结果为html文件。\n\n```\ncurl 192.168.59.1:8080\n```\n\nNginx的服务地址是192.168.59.1:8080，其中，**192.168.59.1**是运行Nginx容器的主机的IP，而**8080**是Nginx提供服务的端口。\n\n可知，将容器应用部署到单个主机上时，服务的IP即为运行容器的主机IP，而服务的端口可以通过**-p**选项手动指定，这时服务地址相当于是静态分配的，因此不存在服务发现的问题。然而，当我们将容器应用部署到多个节点的集群时呢？\n\n## 二. Mesos/Marathon集群中部署Nginx\n\n首先，可以按照[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)介绍的方法，快速搭建3个节点的Mesos/Marathon集群。部署Nginx时，可以不使用服务发现，也可以使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现。通过对比两种方式，可以更好地理解服务发现。\n\n**1. 不使用服务发现**\n\nNginx定义(nginx1.json):\n\n```\n{\n    \"id\": \"nginx1\",\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，**instances**为1，表示仅部署单个Nginx容器; **hostPort**为0，表示Nginx容器绑定的主机端口由Marathon随机分配。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx1.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx容器可能运行node2(192.168.59.2)上，也可能运行在node3(192.168.59.3)上，因此Nginx服务的IP是无法事先确定的。而Nginx容器绑定的主机端口由Marathon随机分配，也不确定。\n\n当然，服务端口可以通过**hostPort**指定，但是这样做并不合适，因为有可能会发生端口冲突。当集群中运行了非常多不同的服务时，**静态分配端口是不现实的，也限制了集群的灵活性与扩展性**。\n\n在Slave节点上使用**docker ps**命令可以获取Nginx服务的IP与端口。\n\nnode2(192.168.59.2)\n\n```\nsudo docker ps | grep nginx\nb863d407b880        nginx:1.10              \"nginx -g 'daemon off\"   15 minutes ago      Up 15 minutes       443/tcp, 0.0.0.0:31575->80/tcp   mesos-d34d0b5b-c3b1-4020-9bb2-bb8582252bf3-S0.d2de6d05-9751-4fbe-af10-d7e35e9e6c7b\n```\n\nnode3(192.168.59.3)\n\n```\nsudo docker ps | grep nginx\n```\n\n可知Nginx服务的IP与端口分别为**192.168.59.2**和**31575**，即Nginx的服务地址为：[http://192.168.59.2:31575](http://192.168.59.2:31575)\n\n每次重新部署Nginx时，其IP和端口会发生变化，这就意味着每次都要手动去查询服务地址，这很不方便，且无法将部署任务自动化。在容器集群中，通常需要运行非常多不同的应用，这就意味着**服务发现**是容器集群系统的必备功能。\n\n\n**2. 使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。因此，当重新部署Nginx时，我们仍然可以通过固定的IP与端口访问该服务。\n\nNginx定义(nginx2.json):\n\n```\n{\n    \"id\": \"nginx2\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，nginx2.json只有**HAPROXY_GROUP**与**servicePort**两处修改。**HAPROXY_GROUP**为external，表示Nginx将使用分组为external的**Marathon LB**做服务发现。**servicePort**为10000，表示Nginx将使用**Marathon LB**节点的10000端口提供服务。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx2.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx服务的IP为运行Marathon LB的节点IP，即**192.168.59.1**，而Nginx服务的端口为**servicePort**指定的端口，即10000。因此，Nginx的服务地址为：[http://192.168.59.1:10000](http://192.168.59.1:10000)。而Nginx容器的实际地址为[http://192.168.59.2:31270](http://192.168.59.2:31270)，Marathon LB使用Haproxy作为代理服务器转发的服务请求。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。下面即为Marathon LB自动生成的Haproxy配置文件: \n\n```\nfrontend nginx2_10000\n  bind *:10000\n  mode http\n  use_backend nginx2_10000\n\nbackend nginx2_10000\n  balance roundrobin\n  mode http\n  option forwardfor\n  http-request set-header X-Forwarded-Port %[dst_port]\n  http-request add-header X-Forwarded-Proto https if { ssl_fc }\n  option  httpchk GET /\n  timeout check 20s\n  server 192_168_59_2_31270 192.168.59.2:31270 check inter 60s fall 4\n```\n\n可知Haproxy中，niginx服务的前端(frontend)地址为: *:10000，而后端(backend)地址为: 192.168.59.2:31270。Haproxy负责将服务请求转发到Nginx容器。\n\n当我们重新部署Nginx时，Nginx容器的IP和端口会发生变化，Marathon LB会更新Haproxy的配置文件，因此我们仍然可以通过[http://192.168.59.1:10000](http://192.168.59.1:10000)访问服务。\n\n因此，Marathon LB的任务就是发现服务的地址(IP和端口)，然后用户就不用每次手动查询了。[bamboo](https://github.com/QubitProducts/bamboo)与[nixy](https://github.com/martensson/nixy)实现了同样的功能。\n\n## 三. 参考\n\n1. [Understanding Modern Service Discovery with Docker](http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/)\n2. [基于Docker技术构建PaaS云平台](http://www.eurekao.com/build-paas-platform-base-on-docker/)\n3. [Youzan 服务发现概述](http://tech.youzan.com/haunt-youzan-service-discovery/)\n\n\n","source":"_posts/2016/09/04/what-is-service-discovery.md","raw":"title: 什么是服务发现？\n\ndate: 2016-09-04 10:00\n\ntags: [服务发现]\n\n---\n\n**摘要:** 将容器应用部署到集群时，其服务地址，即**IP**和**端口**, 是由集群系统动态分配的。那么，当我们需要访问这个服务时，如何确定它的地址呢？这时，就需要**服务发现(Service Discovery)**了。本文将以Nginx的部署为例，介绍服务发现的原理与实践。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-04](http://kiwenlau.com/2016/09/04/what-is-service-discovery/)\n\n<img src=\"what-is-service-discovery/service-discovery.png\" width = \"500\"/>\n\n## 一. 单机部署Nginx\n\n[Nginx](https://nginx.org)作为网页服务器，功能与Apache一致。使用[Docker](https://www.docker.com/), 可以快速部署Nginx。\n\n#### **1. 下载Nginx镜像**\n\n```\nsudo docker pull nginx:1.10\n```\n\n#### **2. 运行Nginx容器**\n\n```\nsudo docker run -d \\\n                -p 8080:80 \\\n                nginx:1.10\n```\n\n其中，**-d**选项表示Nginx容器在后台运行，**-p**选项表示主机的**8080**端口映射为容器的**80**端口。\n\n#### **3. 访问Nginx服务**\n\n使用浏览器服务Nginx\n\n[http://192.168.59.1:8080](http://192.168.59.1:8080)\n\n或者使用curl命令访问Nginx, 其返回结果为html文件。\n\n```\ncurl 192.168.59.1:8080\n```\n\nNginx的服务地址是192.168.59.1:8080，其中，**192.168.59.1**是运行Nginx容器的主机的IP，而**8080**是Nginx提供服务的端口。\n\n可知，将容器应用部署到单个主机上时，服务的IP即为运行容器的主机IP，而服务的端口可以通过**-p**选项手动指定，这时服务地址相当于是静态分配的，因此不存在服务发现的问题。然而，当我们将容器应用部署到多个节点的集群时呢？\n\n## 二. Mesos/Marathon集群中部署Nginx\n\n首先，可以按照[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)介绍的方法，快速搭建3个节点的Mesos/Marathon集群。部署Nginx时，可以不使用服务发现，也可以使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现。通过对比两种方式，可以更好地理解服务发现。\n\n**1. 不使用服务发现**\n\nNginx定义(nginx1.json):\n\n```\n{\n    \"id\": \"nginx1\",\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，**instances**为1，表示仅部署单个Nginx容器; **hostPort**为0，表示Nginx容器绑定的主机端口由Marathon随机分配。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx1.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx容器可能运行node2(192.168.59.2)上，也可能运行在node3(192.168.59.3)上，因此Nginx服务的IP是无法事先确定的。而Nginx容器绑定的主机端口由Marathon随机分配，也不确定。\n\n当然，服务端口可以通过**hostPort**指定，但是这样做并不合适，因为有可能会发生端口冲突。当集群中运行了非常多不同的服务时，**静态分配端口是不现实的，也限制了集群的灵活性与扩展性**。\n\n在Slave节点上使用**docker ps**命令可以获取Nginx服务的IP与端口。\n\nnode2(192.168.59.2)\n\n```\nsudo docker ps | grep nginx\nb863d407b880        nginx:1.10              \"nginx -g 'daemon off\"   15 minutes ago      Up 15 minutes       443/tcp, 0.0.0.0:31575->80/tcp   mesos-d34d0b5b-c3b1-4020-9bb2-bb8582252bf3-S0.d2de6d05-9751-4fbe-af10-d7e35e9e6c7b\n```\n\nnode3(192.168.59.3)\n\n```\nsudo docker ps | grep nginx\n```\n\n可知Nginx服务的IP与端口分别为**192.168.59.2**和**31575**，即Nginx的服务地址为：[http://192.168.59.2:31575](http://192.168.59.2:31575)\n\n每次重新部署Nginx时，其IP和端口会发生变化，这就意味着每次都要手动去查询服务地址，这很不方便，且无法将部署任务自动化。在容器集群中，通常需要运行非常多不同的应用，这就意味着**服务发现**是容器集群系统的必备功能。\n\n\n**2. 使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。因此，当重新部署Nginx时，我们仍然可以通过固定的IP与端口访问该服务。\n\nNginx定义(nginx2.json):\n\n```\n{\n    \"id\": \"nginx2\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，nginx2.json只有**HAPROXY_GROUP**与**servicePort**两处修改。**HAPROXY_GROUP**为external，表示Nginx将使用分组为external的**Marathon LB**做服务发现。**servicePort**为10000，表示Nginx将使用**Marathon LB**节点的10000端口提供服务。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx2.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx服务的IP为运行Marathon LB的节点IP，即**192.168.59.1**，而Nginx服务的端口为**servicePort**指定的端口，即10000。因此，Nginx的服务地址为：[http://192.168.59.1:10000](http://192.168.59.1:10000)。而Nginx容器的实际地址为[http://192.168.59.2:31270](http://192.168.59.2:31270)，Marathon LB使用Haproxy作为代理服务器转发的服务请求。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。下面即为Marathon LB自动生成的Haproxy配置文件: \n\n```\nfrontend nginx2_10000\n  bind *:10000\n  mode http\n  use_backend nginx2_10000\n\nbackend nginx2_10000\n  balance roundrobin\n  mode http\n  option forwardfor\n  http-request set-header X-Forwarded-Port %[dst_port]\n  http-request add-header X-Forwarded-Proto https if { ssl_fc }\n  option  httpchk GET /\n  timeout check 20s\n  server 192_168_59_2_31270 192.168.59.2:31270 check inter 60s fall 4\n```\n\n可知Haproxy中，niginx服务的前端(frontend)地址为: *:10000，而后端(backend)地址为: 192.168.59.2:31270。Haproxy负责将服务请求转发到Nginx容器。\n\n当我们重新部署Nginx时，Nginx容器的IP和端口会发生变化，Marathon LB会更新Haproxy的配置文件，因此我们仍然可以通过[http://192.168.59.1:10000](http://192.168.59.1:10000)访问服务。\n\n因此，Marathon LB的任务就是发现服务的地址(IP和端口)，然后用户就不用每次手动查询了。[bamboo](https://github.com/QubitProducts/bamboo)与[nixy](https://github.com/martensson/nixy)实现了同样的功能。\n\n## 三. 参考\n\n1. [Understanding Modern Service Discovery with Docker](http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/)\n2. [基于Docker技术构建PaaS云平台](http://www.eurekao.com/build-paas-platform-base-on-docker/)\n3. [Youzan 服务发现概述](http://tech.youzan.com/haunt-youzan-service-discovery/)\n\n\n","slug":"2016/09/04/what-is-service-discovery","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzwb0014ivfyfdme7uoy","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x96C6;&#x7FA4;&#x65F6;&#xFF0C;&#x5176;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x5373;<strong>IP</strong>&#x548C;<strong>&#x7AEF;&#x53E3;</strong>, &#x662F;&#x7531;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x5B83;&#x7684;&#x5730;&#x5740;&#x5462;&#xFF1F;&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;(Service Discovery)</strong>&#x4E86;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4EE5;Nginx&#x7684;&#x90E8;&#x7F72;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x539F;&#x7406;&#x4E0E;&#x5B9E;&#x8DF5;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/04/what-is-service-discovery/\">2016-09-04</a></li>\n</ul>\n<p><img src=\"/2016/09/04/what-is-service-discovery/service-discovery.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"></a>&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx</h2><p><a href=\"https://nginx.org\" target=\"_blank\" rel=\"external\">Nginx</a>&#x4F5C;&#x4E3A;&#x7F51;&#x9875;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x529F;&#x80FD;&#x4E0E;Apache&#x4E00;&#x81F4;&#x3002;&#x4F7F;&#x7528;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>, &#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x90E8;&#x7F72;Nginx&#x3002;</p>\n<h4 id=\"1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;</strong></h4><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"></a><strong>2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> <span class=\"_\">-d</span> \\</span></div><div class=\"line\">                -p 8080:80 \\</div><div class=\"line\">                nginx:1.10</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>-d</strong>&#x9009;&#x9879;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;<strong>-p</strong>&#x9009;&#x9879;&#x8868;&#x793A;&#x4E3B;&#x673A;&#x7684;<strong>8080</strong>&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x4E3A;&#x5BB9;&#x5668;&#x7684;<strong>80</strong>&#x7AEF;&#x53E3;&#x3002;</p>\n<h4 id=\"3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"><a href=\"#3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\" class=\"headerlink\" title=\"3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"></a><strong>3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;</strong></h4><p>&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x670D;&#x52A1;Nginx</p>\n<p><a href=\"http://192.168.59.1:8080\" target=\"_blank\" rel=\"external\">http://192.168.59.1:8080</a></p>\n<p>&#x6216;&#x8005;&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;Nginx, &#x5176;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4E3A;html&#x6587;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">curl</span> 192<span class=\"selector-class\">.168</span><span class=\"selector-class\">.59</span><span class=\"selector-class\">.1</span><span class=\"selector-pseudo\">:8080</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x662F;192.168.59.1:8080&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;<strong>192.168.59.1</strong>&#x662F;&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#xFF0C;&#x800C;<strong>8080</strong>&#x662F;Nginx&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x5355;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x7684;IP&#x5373;&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>-p</strong>&#x9009;&#x9879;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#xFF0C;&#x8FD9;&#x65F6;&#x670D;&#x52A1;&#x5730;&#x5740;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x9759;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x96C6;&#x7FA4;&#x65F6;&#x5462;&#xFF1F;</p>\n<h2 id=\"&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"></a>&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx</h2><p>&#x9996;&#x5148;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5FEB;&#x901F;&#x642D;&#x5EFA;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>\n<p><strong>1. &#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx1.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx1&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>instances</strong>&#x4E3A;1&#xFF0C;&#x8868;&#x793A;&#x4EC5;&#x90E8;&#x7F72;&#x5355;&#x4E2A;Nginx&#x5BB9;&#x5668;; <strong>hostPort</strong>&#x4E3A;0&#xFF0C;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx1.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x53EF;&#x80FD;&#x8FD0;&#x884C;node2(192.168.59.2)&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8FD0;&#x884C;&#x5728;node3(192.168.59.3)&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Nginx&#x670D;&#x52A1;&#x7684;IP&#x662F;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x7684;&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#xFF0C;&#x4E5F;&#x4E0D;&#x786E;&#x5B9A;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>hostPort</strong>&#x6307;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x5E76;&#x4E0D;&#x5408;&#x9002;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x7AEF;&#x53E3;&#x51B2;&#x7A81;&#x3002;&#x5F53;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x65F6;&#xFF0C;<strong>&#x9759;&#x6001;&#x5206;&#x914D;&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x4E5F;&#x9650;&#x5236;&#x4E86;&#x96C6;&#x7FA4;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x4E0E;&#x6269;&#x5C55;&#x6027;</strong>&#x3002;</p>\n<p>&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528;<strong>docker ps</strong>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>node2(192.168.59.2)</p>\n<figure class=\"highlight dns\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker ps | grep nginx</div><div class=\"line\">b863d<span class=\"number\">407b880</span>        nginx:<span class=\"number\">1</span>.<span class=\"number\">10</span>              &quot;nginx -g &apos;daemon off&quot;   <span class=\"number\">15</span> minutes ago      Up <span class=\"number\">15</span> minutes       <span class=\"number\">443</span>/tcp, <span class=\"number\">0.0.0.0</span>:<span class=\"number\">31575</span>-&gt;<span class=\"number\">80</span>/tcp   mesos-d34d0b5b-c<span class=\"number\">3b1-4020</span>-<span class=\"number\">9</span>bb2-bb8582252bf3-S0.d2de<span class=\"number\">6d05-9751</span>-<span class=\"number\">4</span>fbe-af10-d7e35e9e6c7b</div></pre></td></tr></table></figure>\n<p>node3(192.168.59.3)</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">ps</span> | <span class=\"keyword\">grep</span> nginx</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x5206;&#x522B;&#x4E3A;<strong>192.168.59.2</strong>&#x548C;<strong>31575</strong>&#xFF0C;&#x5373;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.2:31575\" target=\"_blank\" rel=\"external\">http://192.168.59.2:31575</a></p>\n<p>&#x6BCF;&#x6B21;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x5176;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x5F88;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x4E14;&#x65E0;&#x6CD5;&#x5C06;&#x90E8;&#x7F72;&#x4EFB;&#x52A1;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x5728;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x7684;&#x5FC5;&#x5907;&#x529F;&#x80FD;&#x3002;</p>\n<p><strong>2. &#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p><a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\" target=\"_blank\" rel=\"external\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;</p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx2.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx2&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;nginx2.json&#x53EA;&#x6709;<strong>HAPROXY_GROUP</strong>&#x4E0E;<strong>servicePort</strong>&#x4E24;&#x5904;&#x4FEE;&#x6539;&#x3002;<strong>HAPROXY_GROUP</strong>&#x4E3A;external&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;&#x5206;&#x7EC4;&#x4E3A;external&#x7684;<strong>Marathon LB</strong>&#x505A;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;<strong>servicePort</strong>&#x4E3A;10000&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;<strong>Marathon LB</strong>&#x8282;&#x70B9;&#x7684;10000&#x7AEF;&#x53E3;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx2.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E3A;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x5373;<strong>192.168.59.1</strong>&#xFF0C;&#x800C;Nginx&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>servicePort</strong>&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5373;10000&#x3002;&#x56E0;&#x6B64;&#xFF0C;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.1:10000\" target=\"_blank\" rel=\"external\">http://192.168.59.1:10000</a>&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7684;&#x5B9E;&#x9645;&#x5730;&#x5740;&#x4E3A;<a href=\"http://192.168.59.2:31270\" target=\"_blank\" rel=\"external\">http://192.168.59.2:31270</a>&#xFF0C;Marathon LB&#x4F7F;&#x7528;Haproxy&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8F6C;&#x53D1;&#x7684;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x5373;&#x4E3A;Marathon LB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;Haproxy&#x914D;&#x7F6E;&#x6587;&#x4EF6;: </p>\n<figure class=\"highlight smali\"><table><tr><td class=\"code\"><pre><div class=\"line\">frontend nginx2_10000</div><div class=\"line\">  bind *:10000</div><div class=\"line\">  mode http</div><div class=\"line\">  use_backend nginx2_10000</div><div class=\"line\"></div><div class=\"line\">backend nginx2_10000</div><div class=\"line\">  balance roundrobin</div><div class=\"line\">  mode http</div><div class=\"line\">  option forwardfor</div><div class=\"line\">  http-request set-header X-Forwarded-Port %[dst_port]</div><div class=\"line\">  http-request<span class=\"built_in\"> add-header </span>X-Forwarded-Proto https<span class=\"built_in\"> if </span>{ ssl_fc }</div><div class=\"line\">  option  httpchk GET /</div><div class=\"line\">  timeout<span class=\"built_in\"> check </span>20s</div><div class=\"line\">  server 192_168_59_2_31270 192.168.59.2:31270<span class=\"built_in\"> check </span>inter 60s fall 4</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Haproxy&#x4E2D;&#xFF0C;niginx&#x670D;&#x52A1;&#x7684;&#x524D;&#x7AEF;(frontend)&#x5730;&#x5740;&#x4E3A;: *:10000&#xFF0C;&#x800C;&#x540E;&#x7AEF;(backend)&#x5730;&#x5740;&#x4E3A;: 192.168.59.2:31270&#x3002;Haproxy&#x8D1F;&#x8D23;&#x5C06;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;Nginx&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x7684;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;Marathon LB&#x4F1A;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://192.168.59.1:10000\" target=\"_blank\" rel=\"external\">http://192.168.59.1:10000</a>&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;Marathon LB&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;(IP&#x548C;&#x7AEF;&#x53E3;)&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6237;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x624B;&#x52A8;&#x67E5;&#x8BE2;&#x4E86;&#x3002;<a href=\"https://github.com/QubitProducts/bamboo\" target=\"_blank\" rel=\"external\">bamboo</a>&#x4E0E;<a href=\"https://github.com/martensson/nixy\" target=\"_blank\" rel=\"external\">nixy</a>&#x5B9E;&#x73B0;&#x4E86;&#x540C;&#x6837;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/\" target=\"_blank\" rel=\"external\">Understanding Modern Service Discovery with Docker</a></li>\n<li><a href=\"http://www.eurekao.com/build-paas-platform-base-on-docker/\" target=\"_blank\" rel=\"external\">&#x57FA;&#x4E8E;Docker&#x6280;&#x672F;&#x6784;&#x5EFA;PaaS&#x4E91;&#x5E73;&#x53F0;</a></li>\n<li><a href=\"http://tech.youzan.com/haunt-youzan-service-discovery/\" target=\"_blank\" rel=\"external\">Youzan &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6982;&#x8FF0;</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x96C6;&#x7FA4;&#x65F6;&#xFF0C;&#x5176;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x5373;<strong>IP</strong>&#x548C;<strong>&#x7AEF;&#x53E3;</strong>, &#x662F;&#x7531;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x5B83;&#x7684;&#x5730;&#x5740;&#x5462;&#xFF1F;&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;(Service Discovery)</strong>&#x4E86;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4EE5;Nginx&#x7684;&#x90E8;&#x7F72;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x539F;&#x7406;&#x4E0E;&#x5B9E;&#x8DF5;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/04/what-is-service-discovery/\">2016-09-04</a></li>\n</ul>\n<p><img src=\"/2016/09/04/what-is-service-discovery/service-discovery.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"></a>&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx</h2><p><a href=\"https://nginx.org\">Nginx</a>&#x4F5C;&#x4E3A;&#x7F51;&#x9875;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x529F;&#x80FD;&#x4E0E;Apache&#x4E00;&#x81F4;&#x3002;&#x4F7F;&#x7528;<a href=\"https://www.docker.com/\">Docker</a>, &#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x90E8;&#x7F72;Nginx&#x3002;</p>\n<h4 id=\"1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;</strong></h4><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"></a><strong>2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> <span class=\"_\">-d</span> \\</span></div><div class=\"line\">                -p 8080:80 \\</div><div class=\"line\">                nginx:1.10</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>-d</strong>&#x9009;&#x9879;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;<strong>-p</strong>&#x9009;&#x9879;&#x8868;&#x793A;&#x4E3B;&#x673A;&#x7684;<strong>8080</strong>&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x4E3A;&#x5BB9;&#x5668;&#x7684;<strong>80</strong>&#x7AEF;&#x53E3;&#x3002;</p>\n<h4 id=\"3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"><a href=\"#3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\" class=\"headerlink\" title=\"3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"></a><strong>3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;</strong></h4><p>&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x670D;&#x52A1;Nginx</p>\n<p><a href=\"http://192.168.59.1:8080\">http://192.168.59.1:8080</a></p>\n<p>&#x6216;&#x8005;&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;Nginx, &#x5176;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4E3A;html&#x6587;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">curl</span> 192<span class=\"selector-class\">.168</span><span class=\"selector-class\">.59</span><span class=\"selector-class\">.1</span><span class=\"selector-pseudo\">:8080</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x662F;192.168.59.1:8080&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;<strong>192.168.59.1</strong>&#x662F;&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#xFF0C;&#x800C;<strong>8080</strong>&#x662F;Nginx&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x5355;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x7684;IP&#x5373;&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>-p</strong>&#x9009;&#x9879;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#xFF0C;&#x8FD9;&#x65F6;&#x670D;&#x52A1;&#x5730;&#x5740;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x9759;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x96C6;&#x7FA4;&#x65F6;&#x5462;&#xFF1F;</p>\n<h2 id=\"&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"></a>&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx</h2><p>&#x9996;&#x5148;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5FEB;&#x901F;&#x642D;&#x5EFA;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>\n<p><strong>1. &#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx1.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx1&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>instances</strong>&#x4E3A;1&#xFF0C;&#x8868;&#x793A;&#x4EC5;&#x90E8;&#x7F72;&#x5355;&#x4E2A;Nginx&#x5BB9;&#x5668;; <strong>hostPort</strong>&#x4E3A;0&#xFF0C;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx1.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x53EF;&#x80FD;&#x8FD0;&#x884C;node2(192.168.59.2)&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8FD0;&#x884C;&#x5728;node3(192.168.59.3)&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Nginx&#x670D;&#x52A1;&#x7684;IP&#x662F;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x7684;&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#xFF0C;&#x4E5F;&#x4E0D;&#x786E;&#x5B9A;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>hostPort</strong>&#x6307;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x5E76;&#x4E0D;&#x5408;&#x9002;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x7AEF;&#x53E3;&#x51B2;&#x7A81;&#x3002;&#x5F53;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x65F6;&#xFF0C;<strong>&#x9759;&#x6001;&#x5206;&#x914D;&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x4E5F;&#x9650;&#x5236;&#x4E86;&#x96C6;&#x7FA4;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x4E0E;&#x6269;&#x5C55;&#x6027;</strong>&#x3002;</p>\n<p>&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528;<strong>docker ps</strong>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>node2(192.168.59.2)</p>\n<figure class=\"highlight dns\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker ps | grep nginx</div><div class=\"line\">b863d<span class=\"number\">407b880</span>        nginx:<span class=\"number\">1</span>.<span class=\"number\">10</span>              &quot;nginx -g &apos;daemon off&quot;   <span class=\"number\">15</span> minutes ago      Up <span class=\"number\">15</span> minutes       <span class=\"number\">443</span>/tcp, <span class=\"number\">0.0.0.0</span>:<span class=\"number\">31575</span>-&gt;<span class=\"number\">80</span>/tcp   mesos-d34d0b5b-c<span class=\"number\">3b1-4020</span>-<span class=\"number\">9</span>bb2-bb8582252bf3-S0.d2de<span class=\"number\">6d05-9751</span>-<span class=\"number\">4</span>fbe-af10-d7e35e9e6c7b</div></pre></td></tr></table></figure>\n<p>node3(192.168.59.3)</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">ps</span> | <span class=\"keyword\">grep</span> nginx</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x5206;&#x522B;&#x4E3A;<strong>192.168.59.2</strong>&#x548C;<strong>31575</strong>&#xFF0C;&#x5373;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.2:31575\">http://192.168.59.2:31575</a></p>\n<p>&#x6BCF;&#x6B21;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x5176;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x5F88;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x4E14;&#x65E0;&#x6CD5;&#x5C06;&#x90E8;&#x7F72;&#x4EFB;&#x52A1;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x5728;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x7684;&#x5FC5;&#x5907;&#x529F;&#x80FD;&#x3002;</p>\n<p><strong>2. &#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p><a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;</p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx2.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx2&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;nginx2.json&#x53EA;&#x6709;<strong>HAPROXY_GROUP</strong>&#x4E0E;<strong>servicePort</strong>&#x4E24;&#x5904;&#x4FEE;&#x6539;&#x3002;<strong>HAPROXY_GROUP</strong>&#x4E3A;external&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;&#x5206;&#x7EC4;&#x4E3A;external&#x7684;<strong>Marathon LB</strong>&#x505A;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;<strong>servicePort</strong>&#x4E3A;10000&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;<strong>Marathon LB</strong>&#x8282;&#x70B9;&#x7684;10000&#x7AEF;&#x53E3;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx2.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E3A;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x5373;<strong>192.168.59.1</strong>&#xFF0C;&#x800C;Nginx&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>servicePort</strong>&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5373;10000&#x3002;&#x56E0;&#x6B64;&#xFF0C;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.1:10000\">http://192.168.59.1:10000</a>&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7684;&#x5B9E;&#x9645;&#x5730;&#x5740;&#x4E3A;<a href=\"http://192.168.59.2:31270\">http://192.168.59.2:31270</a>&#xFF0C;Marathon LB&#x4F7F;&#x7528;Haproxy&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8F6C;&#x53D1;&#x7684;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x5373;&#x4E3A;Marathon LB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;Haproxy&#x914D;&#x7F6E;&#x6587;&#x4EF6;: </p>\n<figure class=\"highlight smali\"><table><tr><td class=\"code\"><pre><div class=\"line\">frontend nginx2_10000</div><div class=\"line\">  bind *:10000</div><div class=\"line\">  mode http</div><div class=\"line\">  use_backend nginx2_10000</div><div class=\"line\"></div><div class=\"line\">backend nginx2_10000</div><div class=\"line\">  balance roundrobin</div><div class=\"line\">  mode http</div><div class=\"line\">  option forwardfor</div><div class=\"line\">  http-request set-header X-Forwarded-Port %[dst_port]</div><div class=\"line\">  http-request<span class=\"built_in\"> add-header </span>X-Forwarded-Proto https<span class=\"built_in\"> if </span>{ ssl_fc }</div><div class=\"line\">  option  httpchk GET /</div><div class=\"line\">  timeout<span class=\"built_in\"> check </span>20s</div><div class=\"line\">  server 192_168_59_2_31270 192.168.59.2:31270<span class=\"built_in\"> check </span>inter 60s fall 4</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Haproxy&#x4E2D;&#xFF0C;niginx&#x670D;&#x52A1;&#x7684;&#x524D;&#x7AEF;(frontend)&#x5730;&#x5740;&#x4E3A;: *:10000&#xFF0C;&#x800C;&#x540E;&#x7AEF;(backend)&#x5730;&#x5740;&#x4E3A;: 192.168.59.2:31270&#x3002;Haproxy&#x8D1F;&#x8D23;&#x5C06;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;Nginx&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x7684;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;Marathon LB&#x4F1A;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://192.168.59.1:10000\">http://192.168.59.1:10000</a>&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;Marathon LB&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;(IP&#x548C;&#x7AEF;&#x53E3;)&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6237;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x624B;&#x52A8;&#x67E5;&#x8BE2;&#x4E86;&#x3002;<a href=\"https://github.com/QubitProducts/bamboo\">bamboo</a>&#x4E0E;<a href=\"https://github.com/martensson/nixy\">nixy</a>&#x5B9E;&#x73B0;&#x4E86;&#x540C;&#x6837;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/\">Understanding Modern Service Discovery with Docker</a></li>\n<li><a href=\"http://www.eurekao.com/build-paas-platform-base-on-docker/\">&#x57FA;&#x4E8E;Docker&#x6280;&#x672F;&#x6784;&#x5EFA;PaaS&#x4E91;&#x5E73;&#x53F0;</a></li>\n<li><a href=\"http://tech.youzan.com/haunt-youzan-service-discovery/\">Youzan &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6982;&#x8FF0;</a></li>\n</ol>"},{"title":"MongoDB优化之倒排索引","date":"2016-09-11T02:00:00.000Z","_content":"\n**摘要:** 为MongoDB中的数据构建倒排索引(Inverted Index)，然后缓存到内存中，可以大幅提升搜索性能。本文将通过为电影数据构建演员索引，介绍两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)和[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n**GitHub地址:**\n\n- [kiwenlau/mongodb-inverted-index](https://github.com/kiwenlau/mongodb-inverted-index)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-11](http://kiwenlau.com/2016/09/11/mongodb-inverted-index/)\n\n<img src=\"mongodb-inverted-index/mongodb-inverted-index.png\" width = \"500\"/>\n\n## 一. 倒排索引\n\n倒排索引(Inverted Index)，也称为反向索引，[维基百科](https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95)的定义是这样的:\n\n> 是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。\n\n这个定义比较学术，也就是比较反人类，忽略...\n\n倒排索引是搜索引擎中的核心数据结构。搜索引擎的爬虫获取的网页数据可以视为键值对，其中，Key是网页地址(url)，而Value是网页内容。网页的内容是由很多关键词(word)组成的，可以视为关键词数组。因此，爬虫获取的网页数据可以这样表示:\n\n```\n<url1, [word2, word3]>\n<url2, [word2]>\n<url3, [word1, word2]>\n```\n\n但是，用户是通过关键词进行搜索的，直接使用原始数据进行查询的话则需要遍历所有键值对中的关键词数组，效率是非常低的。\n\n因此，用于搜索的数据结构应该以关键词(word)为Key，以网页地址(url)为Value:\n\n```\n<word1, [url3]>\n<word2, [ur1, url2, url3]>\n<word3, [url1]>\n```\n\n这样的话，查询关键词word2，立即能够获取结果: [ur1, url2, url3]。\n\n简单地说，**倒排索引就是把Key与Value对调之后的索引**，构建倒排索引的目的是提升搜索性能。\n\n## 二. 测试数据\n\n[MongoDB](https://www.mongodb.com/)是文档型数据库，其数据有三个层级: 数据库(database)，集合(collection)和文档(document)，分别对应关系型数据库中的三个层级的: 数据库(database), 表(table)，行(row)。MongDB中每个的文档是一个JSON文件，例如，本文使用的movie集合中的一个文档如下所示:\n\n```\n{\n\t\"_id\" : ObjectId(\"57d02d60b128567fc130287d\"),\n\t\"movie\" : \"Pride & Prejudice\",\n\t\"starList\" : [\n\t\t\"Keira Knightley\",\n\t\t\"Matthew Macfadyen\"\n\t],\n\t\"__v\" : 0\n}\n```\n\n该文档一共有4个属性:\n\n- _id: 文档ID，由MongoDB自动生成。\n- __v: 文档版本，由MongoDB的NodeJS接口Mongoose自动生成。\n- movie: 电影名称。\n- starList: 演员列表。 \n\n可知，这个文档表示电影[《傲慢与偏见》](https://movie.douban.com/subject/1418200/)，由女神[凯拉·奈特莉](https://movie.douban.com/celebrity/1054448/)主演。\n\n忽略`_id`与`__v`，movie集合的数据如下:\n\n```\n{\n    \"movie\": \"Pride & Prejudice\",\n    \"starList\": [\"Keira Knightley\", \"Matthew Macfadyen\"]\n},\n{\n    \"movie\": \"Begin Again\",\n    \"starList\": [\"Keira Knightley\", \"Mark Ruffalo\"]\n},\n{\n    \"movie\": \"The Imitation Game\",\n    \"starList\": [\"Keira Knightley\", \"Benedict Cumberbatch\"]\n}\n```\n\n其中，Key为电影名称(movie)，而Value为演员列表(starList)。\n\n这时查询Keira Knightley所主演的电影的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js)如下:\n\n```\nMovie.find(\n{\n    starList: \"Keira Knightley\"\n},\n{\n    _id: 0,\n    movie: 1\n}, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"search movie success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n- 注：本文所有代码使用了MongoDB的NodeJS接口[Mongoose](http://mongoosejs.com/)，它与MongoDB Shell的接口基本一致。\n\n代码并不复杂，但是数据量大时查询性能会很差，因为这个查询需要:\n\n- 遍历整个movie集合的所有文档\n- 遍历每个文档的startList数组\n\n构建倒排索引可以有效地提升搜索性能。本文将介绍MongoDB中两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)与[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n\n## 三 MapReduce\n\n[MapReduce](http://research.google.com/archive/mapreduce.html)是由谷歌提出的编程模型，适用于多种大数据处理场景，在搜索引擎中，MapReduce可以用于构建网页数据的倒排索引，也可以用于编写网页排序算法PageRank(由谷歌创始人佩奇和布林提出)。\n\nMapReduce的输入数据与输出数据均为键值对。MapReduce分为两个函数: Map与Reduce。\n\n- Map函数将输入键值`<k1, v1>`对进行变换，输出中间键值对`<k2, v2>`。\n- MapReduce框架会自动对中间键值对`<k2, v2>`进行分组，Key相同的键值对会被合并为一个键值对`<k2, list(v2)>`。\n- Reduce函数对`<k2, list(v2)>`的Value进行合并，生成结果键值对`<k2, v3>`。\n\n使用MapReduce构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js)如下:\n\n```\nvar option = {};\n\noption.map = function()\n{\n    var movie = this.movie;\n    this.starList.forEach(function(star)\n    {\n        emit(star,\n        {\n            movieList: [movie]\n        });\n    });\n};\n\noption.reduce = function(key, values)\n{\n    var movieList = [];\n    values.forEach(function(value)\n    {\n        movieList.push(value.movieList[0]);\n    });\n    return {\n        movieList: movieList\n    };\n};\n\nMovie.mapReduce(option, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- Map函数的输入数据是Movie集合中的各个文档，在代码中用this表示。文档的movie与starList属性构成键值对`<movie, starList>`。Map函数遍历starList，为每个start生成键值对`<star, movieList>`。这时Key与Value进行了对调，且starList被拆分了，movieList仅包含单个movie。\n- MongoDB的MapReduce执行框架对成键值对`<star, movieList>`进行分组，star相同的键值对会被合并为一个键值对`<star, list(movieList)>`。这一步是自动进行的，因此在代码中并没有体现。\n- Reduce函数的输入数据是键值对`<star, list(movieList)>`，在代码中，star即为key，而list(movieList)即为values，两者为Reduce函数的参数。Reduce函数合并list(movieList)，从而得到键值对`<star, movieList>`，最终，movieList中将包含该star的所有movie。\n\n在代码中，Map函数与Reduce返回的键值对中的Value是一个对象`{ movieList: movieList }`，而不是数组`movieList`，因此代码和结果都显得比较奇怪。MongoDB的MapReduce框架不支持Reduce函数返回数组，因此只能将movieList放在对象里面返回。\n\n输出结果:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"value\": {\n            \"movieList\": [\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\",\n                \"Begin Again\",\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"value\": {\n            \"movieList\": [\n                \"Begin Again\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\"\n            ]\n        }\n    }\n]\n```\n\n## 四. Aggregation Pipeline\n\n[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)，中文称作聚合管道，用于汇总MongoDB中多个文档中的数据，也可以用于构建倒排索引。\n\nAggregation Pipeline进行各种[聚合操作](https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/)，并且可以将多个聚合操作组合使用，类似于Linux中的管道操作，前一个操作的输出是下一个操作的输入。\n\n使用Aggregation Pipeline构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js)如下:\n\n```\nMovie.aggregate([\n{\n    \"$unwind\": \"$starList\"\n},\n{\n    \"$group\":\n    {\n        \"_id\": \"$starList\",\n        \"movieList\":\n        {\n            \"$push\": \"$movie\"\n        }\n    }\n},\n{\n    \"$project\":\n    {\n        \"_id\": 0,\n        \"star\": \"$_id\",\n        \"movieList\": 1\n    }\n}], function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- $unwind: 将starList拆分，输出结果(忽略`_id`与`__v`)为:\n\n```\n[\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Matthew Macfadyen\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Mark Ruffalo\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Benedict Cumberbatch\"\n    }\n]\n```\n\n- $group: 根据文档的starList属性进行分组，然后将分组文档的movie属性合并为movieList，输出结果为:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"movieList\": [\n            \"The Imitation Game\"\n        ]\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"movieList\": [\n            \"Pride & Prejudice\"\n        ]\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"movieList\": [\n            \"Begin Again\"\n        ]\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"movieList\": [\n            \"Pride & Prejudice\",\n            \"Begin Again\",\n            \"The Imitation Game\"\n        ]\n    }\n]\n```\n","source":"_posts/2016/09/11/mongodb-inverted-index.md","raw":"title: MongoDB优化之倒排索引\n\ndate: 2016-09-11 10:00\n\ntags: [MongoDB]\n\n---\n\n**摘要:** 为MongoDB中的数据构建倒排索引(Inverted Index)，然后缓存到内存中，可以大幅提升搜索性能。本文将通过为电影数据构建演员索引，介绍两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)和[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n**GitHub地址:**\n\n- [kiwenlau/mongodb-inverted-index](https://github.com/kiwenlau/mongodb-inverted-index)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-11](http://kiwenlau.com/2016/09/11/mongodb-inverted-index/)\n\n<img src=\"mongodb-inverted-index/mongodb-inverted-index.png\" width = \"500\"/>\n\n## 一. 倒排索引\n\n倒排索引(Inverted Index)，也称为反向索引，[维基百科](https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95)的定义是这样的:\n\n> 是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。\n\n这个定义比较学术，也就是比较反人类，忽略...\n\n倒排索引是搜索引擎中的核心数据结构。搜索引擎的爬虫获取的网页数据可以视为键值对，其中，Key是网页地址(url)，而Value是网页内容。网页的内容是由很多关键词(word)组成的，可以视为关键词数组。因此，爬虫获取的网页数据可以这样表示:\n\n```\n<url1, [word2, word3]>\n<url2, [word2]>\n<url3, [word1, word2]>\n```\n\n但是，用户是通过关键词进行搜索的，直接使用原始数据进行查询的话则需要遍历所有键值对中的关键词数组，效率是非常低的。\n\n因此，用于搜索的数据结构应该以关键词(word)为Key，以网页地址(url)为Value:\n\n```\n<word1, [url3]>\n<word2, [ur1, url2, url3]>\n<word3, [url1]>\n```\n\n这样的话，查询关键词word2，立即能够获取结果: [ur1, url2, url3]。\n\n简单地说，**倒排索引就是把Key与Value对调之后的索引**，构建倒排索引的目的是提升搜索性能。\n\n## 二. 测试数据\n\n[MongoDB](https://www.mongodb.com/)是文档型数据库，其数据有三个层级: 数据库(database)，集合(collection)和文档(document)，分别对应关系型数据库中的三个层级的: 数据库(database), 表(table)，行(row)。MongDB中每个的文档是一个JSON文件，例如，本文使用的movie集合中的一个文档如下所示:\n\n```\n{\n\t\"_id\" : ObjectId(\"57d02d60b128567fc130287d\"),\n\t\"movie\" : \"Pride & Prejudice\",\n\t\"starList\" : [\n\t\t\"Keira Knightley\",\n\t\t\"Matthew Macfadyen\"\n\t],\n\t\"__v\" : 0\n}\n```\n\n该文档一共有4个属性:\n\n- _id: 文档ID，由MongoDB自动生成。\n- __v: 文档版本，由MongoDB的NodeJS接口Mongoose自动生成。\n- movie: 电影名称。\n- starList: 演员列表。 \n\n可知，这个文档表示电影[《傲慢与偏见》](https://movie.douban.com/subject/1418200/)，由女神[凯拉·奈特莉](https://movie.douban.com/celebrity/1054448/)主演。\n\n忽略`_id`与`__v`，movie集合的数据如下:\n\n```\n{\n    \"movie\": \"Pride & Prejudice\",\n    \"starList\": [\"Keira Knightley\", \"Matthew Macfadyen\"]\n},\n{\n    \"movie\": \"Begin Again\",\n    \"starList\": [\"Keira Knightley\", \"Mark Ruffalo\"]\n},\n{\n    \"movie\": \"The Imitation Game\",\n    \"starList\": [\"Keira Knightley\", \"Benedict Cumberbatch\"]\n}\n```\n\n其中，Key为电影名称(movie)，而Value为演员列表(starList)。\n\n这时查询Keira Knightley所主演的电影的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js)如下:\n\n```\nMovie.find(\n{\n    starList: \"Keira Knightley\"\n},\n{\n    _id: 0,\n    movie: 1\n}, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"search movie success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n- 注：本文所有代码使用了MongoDB的NodeJS接口[Mongoose](http://mongoosejs.com/)，它与MongoDB Shell的接口基本一致。\n\n代码并不复杂，但是数据量大时查询性能会很差，因为这个查询需要:\n\n- 遍历整个movie集合的所有文档\n- 遍历每个文档的startList数组\n\n构建倒排索引可以有效地提升搜索性能。本文将介绍MongoDB中两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)与[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n\n## 三 MapReduce\n\n[MapReduce](http://research.google.com/archive/mapreduce.html)是由谷歌提出的编程模型，适用于多种大数据处理场景，在搜索引擎中，MapReduce可以用于构建网页数据的倒排索引，也可以用于编写网页排序算法PageRank(由谷歌创始人佩奇和布林提出)。\n\nMapReduce的输入数据与输出数据均为键值对。MapReduce分为两个函数: Map与Reduce。\n\n- Map函数将输入键值`<k1, v1>`对进行变换，输出中间键值对`<k2, v2>`。\n- MapReduce框架会自动对中间键值对`<k2, v2>`进行分组，Key相同的键值对会被合并为一个键值对`<k2, list(v2)>`。\n- Reduce函数对`<k2, list(v2)>`的Value进行合并，生成结果键值对`<k2, v3>`。\n\n使用MapReduce构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js)如下:\n\n```\nvar option = {};\n\noption.map = function()\n{\n    var movie = this.movie;\n    this.starList.forEach(function(star)\n    {\n        emit(star,\n        {\n            movieList: [movie]\n        });\n    });\n};\n\noption.reduce = function(key, values)\n{\n    var movieList = [];\n    values.forEach(function(value)\n    {\n        movieList.push(value.movieList[0]);\n    });\n    return {\n        movieList: movieList\n    };\n};\n\nMovie.mapReduce(option, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- Map函数的输入数据是Movie集合中的各个文档，在代码中用this表示。文档的movie与starList属性构成键值对`<movie, starList>`。Map函数遍历starList，为每个start生成键值对`<star, movieList>`。这时Key与Value进行了对调，且starList被拆分了，movieList仅包含单个movie。\n- MongoDB的MapReduce执行框架对成键值对`<star, movieList>`进行分组，star相同的键值对会被合并为一个键值对`<star, list(movieList)>`。这一步是自动进行的，因此在代码中并没有体现。\n- Reduce函数的输入数据是键值对`<star, list(movieList)>`，在代码中，star即为key，而list(movieList)即为values，两者为Reduce函数的参数。Reduce函数合并list(movieList)，从而得到键值对`<star, movieList>`，最终，movieList中将包含该star的所有movie。\n\n在代码中，Map函数与Reduce返回的键值对中的Value是一个对象`{ movieList: movieList }`，而不是数组`movieList`，因此代码和结果都显得比较奇怪。MongoDB的MapReduce框架不支持Reduce函数返回数组，因此只能将movieList放在对象里面返回。\n\n输出结果:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"value\": {\n            \"movieList\": [\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\",\n                \"Begin Again\",\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"value\": {\n            \"movieList\": [\n                \"Begin Again\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\"\n            ]\n        }\n    }\n]\n```\n\n## 四. Aggregation Pipeline\n\n[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)，中文称作聚合管道，用于汇总MongoDB中多个文档中的数据，也可以用于构建倒排索引。\n\nAggregation Pipeline进行各种[聚合操作](https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/)，并且可以将多个聚合操作组合使用，类似于Linux中的管道操作，前一个操作的输出是下一个操作的输入。\n\n使用Aggregation Pipeline构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js)如下:\n\n```\nMovie.aggregate([\n{\n    \"$unwind\": \"$starList\"\n},\n{\n    \"$group\":\n    {\n        \"_id\": \"$starList\",\n        \"movieList\":\n        {\n            \"$push\": \"$movie\"\n        }\n    }\n},\n{\n    \"$project\":\n    {\n        \"_id\": 0,\n        \"star\": \"$_id\",\n        \"movieList\": 1\n    }\n}], function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- $unwind: 将starList拆分，输出结果(忽略`_id`与`__v`)为:\n\n```\n[\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Matthew Macfadyen\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Mark Ruffalo\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Benedict Cumberbatch\"\n    }\n]\n```\n\n- $group: 根据文档的starList属性进行分组，然后将分组文档的movie属性合并为movieList，输出结果为:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"movieList\": [\n            \"The Imitation Game\"\n        ]\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"movieList\": [\n            \"Pride & Prejudice\"\n        ]\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"movieList\": [\n            \"Begin Again\"\n        ]\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"movieList\": [\n            \"Pride & Prejudice\",\n            \"Begin Again\",\n            \"The Imitation Game\"\n        ]\n    }\n]\n```\n","slug":"2016/09/11/mongodb-inverted-index","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzwc0016ivfyqdmkvq59","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x4E3A;MongoDB&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x7136;&#x540E;&#x7F13;&#x5B58;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E3A;&#x7535;&#x5F71;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x6F14;&#x5458;&#x7D22;&#x5F15;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\" target=\"_blank\" rel=\"external\">MapReduce</a>&#x548C;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">Aggregation Pipeline</a>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/mongodb-inverted-index\" target=\"_blank\" rel=\"external\">kiwenlau/mongodb-inverted-index</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/11/mongodb-inverted-index/\">2016-09-11</a></li>\n</ul>\n<p><img src=\"/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\"><a href=\"#&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\" class=\"headerlink\" title=\"&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;\"></a>&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;</h2><p>&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;&#x53CD;&#x5411;&#x7D22;&#x5F15;&#xFF0C;<a href=\"https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95\" target=\"_blank\" rel=\"external\">&#x7EF4;&#x57FA;&#x767E;&#x79D1;</a>&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<blockquote>\n<p>&#x662F;&#x4E00;&#x79CD;&#x7D22;&#x5F15;&#x65B9;&#x6CD5;&#xFF0C;&#x88AB;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x5728;&#x5168;&#x6587;&#x641C;&#x7D22;&#x4E0B;&#x67D0;&#x4E2A;&#x5355;&#x8BCD;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x6216;&#x8005;&#x4E00;&#x7EC4;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x7684;&#x6620;&#x5C04;&#x3002;</p>\n</blockquote>\n<p>&#x8FD9;&#x4E2A;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x5B66;&#x672F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BD4;&#x8F83;&#x53CD;&#x4EBA;&#x7C7B;&#xFF0C;&#x5FFD;&#x7565;&#x2026;</p>\n<p>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x662F;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x7684;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;Key&#x662F;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#xFF0C;&#x800C;Value&#x662F;&#x7F51;&#x9875;&#x5185;&#x5BB9;&#x3002;&#x7F51;&#x9875;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x7531;&#x5F88;&#x591A;&#x5173;&#x952E;&#x8BCD;(word)&#x7EC4;&#x6210;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8868;&#x793A;:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;url1, <span class=\"string\">[word2, word3]</span>&gt;</div><div class=\"line\">&lt;url2, <span class=\"string\">[word2]</span>&gt;</div><div class=\"line\">&lt;url3, <span class=\"string\">[word1, word2]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x901A;&#x8FC7;&#x5173;&#x952E;&#x8BCD;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x539F;&#x59CB;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x8BDD;&#x5219;&#x9700;&#x8981;&#x904D;&#x5386;&#x6240;&#x6709;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#xFF0C;&#x6548;&#x7387;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x7528;&#x4E8E;&#x641C;&#x7D22;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5E94;&#x8BE5;&#x4EE5;&#x5173;&#x952E;&#x8BCD;(word)&#x4E3A;Key&#xFF0C;&#x4EE5;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#x4E3A;Value:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;word1, <span class=\"string\">[url3]</span>&gt;</div><div class=\"line\">&lt;word2, <span class=\"string\">[ur1, url2, url3]</span>&gt;</div><div class=\"line\">&lt;word3, <span class=\"string\">[url1]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x67E5;&#x8BE2;&#x5173;&#x952E;&#x8BCD;word2&#xFF0C;&#x7ACB;&#x5373;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x7ED3;&#x679C;: [ur1, url2, url3]&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;<strong>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x5C31;&#x662F;&#x628A;Key&#x4E0E;Value&#x5BF9;&#x8C03;&#x4E4B;&#x540E;&#x7684;&#x7D22;&#x5F15;</strong>&#xFF0C;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x76EE;&#x7684;&#x662F;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\"><a href=\"#&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;\"></a>&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;</h2><p><a href=\"https://www.mongodb.com/\" target=\"_blank\" rel=\"external\">MongoDB</a>&#x662F;&#x6587;&#x6863;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x6709;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;: &#x6570;&#x636E;&#x5E93;(database)&#xFF0C;&#x96C6;&#x5408;(collection)&#x548C;&#x6587;&#x6863;(document)&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;&#x7684;: &#x6570;&#x636E;&#x5E93;(database), &#x8868;(table)&#xFF0C;&#x884C;(row)&#x3002;MongDB&#x4E2D;&#x6BCF;&#x4E2A;&#x7684;&#x6587;&#x6863;&#x662F;&#x4E00;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x672C;&#x6587;&#x4F7F;&#x7528;&#x7684;movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x5982;&#x4E0B;&#x6240;&#x793A;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">\t<span class=\"attr\">&quot;_id&quot;</span> : ObjectId(<span class=\"string\">&quot;57d02d60b128567fc130287d&quot;</span>),</div><div class=\"line\">\t<span class=\"attr\">&quot;movie&quot;</span> : <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">\t<span class=\"attr\">&quot;starList&quot;</span> : [</div><div class=\"line\">\t\t<span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">\t\t<span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">\t],</div><div class=\"line\">\t<span class=\"attr\">&quot;__v&quot;</span> : <span class=\"number\">0</span></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x6587;&#x6863;&#x4E00;&#x5171;&#x6709;4&#x4E2A;&#x5C5E;&#x6027;:</p>\n<ul>\n<li>_id: &#x6587;&#x6863;ID&#xFF0C;&#x7531;MongoDB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>__v: &#x6587;&#x6863;&#x7248;&#x672C;&#xFF0C;&#x7531;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;Mongoose&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>movie: &#x7535;&#x5F71;&#x540D;&#x79F0;&#x3002;</li>\n<li>starList: &#x6F14;&#x5458;&#x5217;&#x8868;&#x3002; </li>\n</ul>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x8868;&#x793A;&#x7535;&#x5F71;<a href=\"https://movie.douban.com/subject/1418200/\" target=\"_blank\" rel=\"external\">&#x300A;&#x50B2;&#x6162;&#x4E0E;&#x504F;&#x89C1;&#x300B;</a>&#xFF0C;&#x7531;&#x5973;&#x795E;<a href=\"https://movie.douban.com/celebrity/1054448/\" target=\"_blank\" rel=\"external\">&#x51EF;&#x62C9;&#xB7;&#x5948;&#x7279;&#x8389;</a>&#x4E3B;&#x6F14;&#x3002;</p>\n<p>&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>&#xFF0C;movie&#x96C6;&#x5408;&#x7684;&#x6570;&#x636E;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Mark Ruffalo&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>]</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;Key&#x4E3A;&#x7535;&#x5F71;&#x540D;&#x79F0;(movie)&#xFF0C;&#x800C;Value&#x4E3A;&#x6F14;&#x5458;&#x5217;&#x8868;(starList)&#x3002;</p>\n<p>&#x8FD9;&#x65F6;&#x67E5;&#x8BE2;Keira Knightley&#x6240;&#x4E3B;&#x6F14;&#x7684;&#x7535;&#x5F71;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js\" target=\"_blank\" rel=\"external\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.find(</div><div class=\"line\">{</div><div class=\"line\">    starList: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    _id: <span class=\"number\">0</span>,</div><div class=\"line\">    movie: <span class=\"number\">1</span></div><div class=\"line\">}, <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;search movie success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x6CE8;&#xFF1A;&#x672C;&#x6587;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x4E86;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;<a href=\"http://mongoosejs.com/\" target=\"_blank\" rel=\"external\">Mongoose</a>&#xFF0C;&#x5B83;&#x4E0E;MongoDB Shell&#x7684;&#x63A5;&#x53E3;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<p>&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x91CF;&#x5927;&#x65F6;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x4F1A;&#x5F88;&#x5DEE;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x9700;&#x8981;:</p>\n<ul>\n<li>&#x904D;&#x5386;&#x6574;&#x4E2A;movie&#x96C6;&#x5408;&#x7684;&#x6240;&#x6709;&#x6587;&#x6863;</li>\n<li>&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x7684;startList&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4ECB;&#x7ECD;MongoDB&#x4E2D;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\" target=\"_blank\" rel=\"external\">MapReduce</a>&#x4E0E;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">Aggregation Pipeline</a>&#x3002;</p>\n<h2 id=\"&#x4E09;-MapReduce\"><a href=\"#&#x4E09;-MapReduce\" class=\"headerlink\" title=\"&#x4E09; MapReduce\"></a>&#x4E09; MapReduce</h2><p><a href=\"http://research.google.com/archive/mapreduce.html\" target=\"_blank\" rel=\"external\">MapReduce</a>&#x662F;&#x7531;&#x8C37;&#x6B4C;&#x63D0;&#x51FA;&#x7684;&#x7F16;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x79CD;&#x5927;&#x6570;&#x636E;&#x5904;&#x7406;&#x573A;&#x666F;&#xFF0C;&#x5728;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#xFF0C;MapReduce&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x7F51;&#x9875;&#x6570;&#x636E;&#x7684;&#x5012;&#x6392;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x7F51;&#x9875;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;PageRank(&#x7531;&#x8C37;&#x6B4C;&#x521B;&#x59CB;&#x4EBA;&#x4F69;&#x5947;&#x548C;&#x5E03;&#x6797;&#x63D0;&#x51FA;)&#x3002;</p>\n<p>MapReduce&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x4E0E;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x5747;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x3002;MapReduce&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x51FD;&#x6570;: Map&#x4E0E;Reduce&#x3002;</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x5C06;&#x8F93;&#x5165;&#x952E;&#x503C;<code>&lt;k1, v1&gt;</code>&#x5BF9;&#x8FDB;&#x884C;&#x53D8;&#x6362;&#xFF0C;&#x8F93;&#x51FA;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x3002;</li>\n<li>MapReduce&#x6846;&#x67B6;&#x4F1A;&#x81EA;&#x52A8;&#x5BF9;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;Key&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x7684;Value&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x751F;&#x6210;&#x7ED3;&#x679C;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v3&gt;</code>&#x3002;</li>\n</ul>\n<p>&#x4F7F;&#x7528;MapReduce&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js\" target=\"_blank\" rel=\"external\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> option = {};</div><div class=\"line\"></div><div class=\"line\">option.map = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movie = <span class=\"keyword\">this</span>.movie;</div><div class=\"line\">    <span class=\"keyword\">this</span>.starList.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">star</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        emit(star,</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"attr\">movieList</span>: [movie]</div><div class=\"line\">        });</div><div class=\"line\">    });</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">option.reduce = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, values</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movieList = [];</div><div class=\"line\">    values.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        movieList.push(value.movieList[<span class=\"number\">0</span>]);</div><div class=\"line\">    });</div><div class=\"line\">    <span class=\"keyword\">return</span> {</div><div class=\"line\">        <span class=\"attr\">movieList</span>: movieList</div><div class=\"line\">    };</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">Movie.mapReduce(option, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">        process.exit(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.stringify(results, <span class=\"literal\">null</span>, <span class=\"number\">4</span>));</div><div class=\"line\">    process.exit(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;Movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x6587;&#x6863;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7528;this&#x8868;&#x793A;&#x3002;&#x6587;&#x6863;&#x7684;movie&#x4E0E;starList&#x5C5E;&#x6027;&#x6784;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;movie, starList&gt;</code>&#x3002;Map&#x51FD;&#x6570;&#x904D;&#x5386;starList&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;start&#x751F;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x3002;&#x8FD9;&#x65F6;Key&#x4E0E;Value&#x8FDB;&#x884C;&#x4E86;&#x5BF9;&#x8C03;&#xFF0C;&#x4E14;starList&#x88AB;&#x62C6;&#x5206;&#x4E86;&#xFF0C;movieList&#x4EC5;&#x5305;&#x542B;&#x5355;&#x4E2A;movie&#x3002;</li>\n<li>MongoDB&#x7684;MapReduce&#x6267;&#x884C;&#x6846;&#x67B6;&#x5BF9;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;star&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#x3002;&#x8FD9;&#x4E00;&#x6B65;&#x662F;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x4F53;&#x73B0;&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;star&#x5373;&#x4E3A;key&#xFF0C;&#x800C;list(movieList)&#x5373;&#x4E3A;values&#xFF0C;&#x4E24;&#x8005;&#x4E3A;Reduce&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x3002;Reduce&#x51FD;&#x6570;&#x5408;&#x5E76;list(movieList)&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#xFF0C;&#x6700;&#x7EC8;&#xFF0C;movieList&#x4E2D;&#x5C06;&#x5305;&#x542B;&#x8BE5;star&#x7684;&#x6240;&#x6709;movie&#x3002;</li>\n</ul>\n<p>&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;Map&#x51FD;&#x6570;&#x4E0E;Reduce&#x8FD4;&#x56DE;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;Value&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;<code>{ movieList: movieList }</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;<code>movieList</code>&#xFF0C;&#x56E0;&#x6B64;&#x4EE3;&#x7801;&#x548C;&#x7ED3;&#x679C;&#x90FD;&#x663E;&#x5F97;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x3002;MongoDB&#x7684;MapReduce&#x6846;&#x67B6;&#x4E0D;&#x652F;&#x6301;Reduce&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x5C06;movieList&#x653E;&#x5728;&#x5BF9;&#x8C61;&#x91CC;&#x9762;&#x8FD4;&#x56DE;&#x3002;</p>\n<p>&#x8F93;&#x51FA;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-Aggregation-Pipeline\"><a href=\"#&#x56DB;-Aggregation-Pipeline\" class=\"headerlink\" title=\"&#x56DB;. Aggregation Pipeline\"></a>&#x56DB;. Aggregation Pipeline</h2><p><a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">Aggregation Pipeline</a>&#xFF0C;&#x4E2D;&#x6587;&#x79F0;&#x4F5C;&#x805A;&#x5408;&#x7BA1;&#x9053;&#xFF0C;&#x7528;&#x4E8E;&#x6C47;&#x603B;MongoDB&#x4E2D;&#x591A;&#x4E2A;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x3002;</p>\n<p>Aggregation Pipeline&#x8FDB;&#x884C;&#x5404;&#x79CD;<a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">&#x805A;&#x5408;&#x64CD;&#x4F5C;</a>&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A;&#x805A;&#x5408;&#x64CD;&#x4F5C;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#x64CD;&#x4F5C;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x5165;&#x3002;</p>\n<p>&#x4F7F;&#x7528;Aggregation Pipeline&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js\" target=\"_blank\" rel=\"external\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.aggregate([</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$unwind&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$group&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>:</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"string\">&quot;$push&quot;</span>: <span class=\"string\">&quot;$movie&quot;</span></div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$project&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"number\">0</span>,</div><div class=\"line\">        <span class=\"string\">&quot;star&quot;</span>: <span class=\"string\">&quot;$_id&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>: <span class=\"number\">1</span></div><div class=\"line\">    }</div><div class=\"line\">}], <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>$unwind: &#x5C06;starList&#x62C6;&#x5206;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;(&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>)&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span></div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<ul>\n<li>$group: &#x6839;&#x636E;&#x6587;&#x6863;&#x7684;starList&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5206;&#x7EC4;&#x6587;&#x6863;&#x7684;movie&#x5C5E;&#x6027;&#x5408;&#x5E76;&#x4E3A;movieList&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x4E3A;MongoDB&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x7136;&#x540E;&#x7F13;&#x5B58;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E3A;&#x7535;&#x5F71;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x6F14;&#x5458;&#x7D22;&#x5F15;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\">MapReduce</a>&#x548C;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\">Aggregation Pipeline</a>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/mongodb-inverted-index\">kiwenlau/mongodb-inverted-index</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/11/mongodb-inverted-index/\">2016-09-11</a></li>\n</ul>\n<p><img src=\"/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\"><a href=\"#&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\" class=\"headerlink\" title=\"&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;\"></a>&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;</h2><p>&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;&#x53CD;&#x5411;&#x7D22;&#x5F15;&#xFF0C;<a href=\"https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95\">&#x7EF4;&#x57FA;&#x767E;&#x79D1;</a>&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<blockquote>\n<p>&#x662F;&#x4E00;&#x79CD;&#x7D22;&#x5F15;&#x65B9;&#x6CD5;&#xFF0C;&#x88AB;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x5728;&#x5168;&#x6587;&#x641C;&#x7D22;&#x4E0B;&#x67D0;&#x4E2A;&#x5355;&#x8BCD;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x6216;&#x8005;&#x4E00;&#x7EC4;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x7684;&#x6620;&#x5C04;&#x3002;</p>\n</blockquote>\n<p>&#x8FD9;&#x4E2A;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x5B66;&#x672F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BD4;&#x8F83;&#x53CD;&#x4EBA;&#x7C7B;&#xFF0C;&#x5FFD;&#x7565;&#x2026;</p>\n<p>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x662F;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x7684;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;Key&#x662F;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#xFF0C;&#x800C;Value&#x662F;&#x7F51;&#x9875;&#x5185;&#x5BB9;&#x3002;&#x7F51;&#x9875;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x7531;&#x5F88;&#x591A;&#x5173;&#x952E;&#x8BCD;(word)&#x7EC4;&#x6210;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8868;&#x793A;:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;url1, <span class=\"string\">[word2, word3]</span>&gt;</div><div class=\"line\">&lt;url2, <span class=\"string\">[word2]</span>&gt;</div><div class=\"line\">&lt;url3, <span class=\"string\">[word1, word2]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x901A;&#x8FC7;&#x5173;&#x952E;&#x8BCD;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x539F;&#x59CB;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x8BDD;&#x5219;&#x9700;&#x8981;&#x904D;&#x5386;&#x6240;&#x6709;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#xFF0C;&#x6548;&#x7387;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x7528;&#x4E8E;&#x641C;&#x7D22;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5E94;&#x8BE5;&#x4EE5;&#x5173;&#x952E;&#x8BCD;(word)&#x4E3A;Key&#xFF0C;&#x4EE5;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#x4E3A;Value:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;word1, <span class=\"string\">[url3]</span>&gt;</div><div class=\"line\">&lt;word2, <span class=\"string\">[ur1, url2, url3]</span>&gt;</div><div class=\"line\">&lt;word3, <span class=\"string\">[url1]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x67E5;&#x8BE2;&#x5173;&#x952E;&#x8BCD;word2&#xFF0C;&#x7ACB;&#x5373;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x7ED3;&#x679C;: [ur1, url2, url3]&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;<strong>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x5C31;&#x662F;&#x628A;Key&#x4E0E;Value&#x5BF9;&#x8C03;&#x4E4B;&#x540E;&#x7684;&#x7D22;&#x5F15;</strong>&#xFF0C;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x76EE;&#x7684;&#x662F;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\"><a href=\"#&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;\"></a>&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;</h2><p><a href=\"https://www.mongodb.com/\">MongoDB</a>&#x662F;&#x6587;&#x6863;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x6709;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;: &#x6570;&#x636E;&#x5E93;(database)&#xFF0C;&#x96C6;&#x5408;(collection)&#x548C;&#x6587;&#x6863;(document)&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;&#x7684;: &#x6570;&#x636E;&#x5E93;(database), &#x8868;(table)&#xFF0C;&#x884C;(row)&#x3002;MongDB&#x4E2D;&#x6BCF;&#x4E2A;&#x7684;&#x6587;&#x6863;&#x662F;&#x4E00;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x672C;&#x6587;&#x4F7F;&#x7528;&#x7684;movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x5982;&#x4E0B;&#x6240;&#x793A;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">\t<span class=\"attr\">&quot;_id&quot;</span> : ObjectId(<span class=\"string\">&quot;57d02d60b128567fc130287d&quot;</span>),</div><div class=\"line\">\t<span class=\"attr\">&quot;movie&quot;</span> : <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">\t<span class=\"attr\">&quot;starList&quot;</span> : [</div><div class=\"line\">\t\t<span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">\t\t<span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">\t],</div><div class=\"line\">\t<span class=\"attr\">&quot;__v&quot;</span> : <span class=\"number\">0</span></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x6587;&#x6863;&#x4E00;&#x5171;&#x6709;4&#x4E2A;&#x5C5E;&#x6027;:</p>\n<ul>\n<li>_id: &#x6587;&#x6863;ID&#xFF0C;&#x7531;MongoDB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>__v: &#x6587;&#x6863;&#x7248;&#x672C;&#xFF0C;&#x7531;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;Mongoose&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>movie: &#x7535;&#x5F71;&#x540D;&#x79F0;&#x3002;</li>\n<li>starList: &#x6F14;&#x5458;&#x5217;&#x8868;&#x3002; </li>\n</ul>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x8868;&#x793A;&#x7535;&#x5F71;<a href=\"https://movie.douban.com/subject/1418200/\">&#x300A;&#x50B2;&#x6162;&#x4E0E;&#x504F;&#x89C1;&#x300B;</a>&#xFF0C;&#x7531;&#x5973;&#x795E;<a href=\"https://movie.douban.com/celebrity/1054448/\">&#x51EF;&#x62C9;&#xB7;&#x5948;&#x7279;&#x8389;</a>&#x4E3B;&#x6F14;&#x3002;</p>\n<p>&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>&#xFF0C;movie&#x96C6;&#x5408;&#x7684;&#x6570;&#x636E;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Mark Ruffalo&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>]</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;Key&#x4E3A;&#x7535;&#x5F71;&#x540D;&#x79F0;(movie)&#xFF0C;&#x800C;Value&#x4E3A;&#x6F14;&#x5458;&#x5217;&#x8868;(starList)&#x3002;</p>\n<p>&#x8FD9;&#x65F6;&#x67E5;&#x8BE2;Keira Knightley&#x6240;&#x4E3B;&#x6F14;&#x7684;&#x7535;&#x5F71;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.find(</div><div class=\"line\">{</div><div class=\"line\">    starList: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    _id: <span class=\"number\">0</span>,</div><div class=\"line\">    movie: <span class=\"number\">1</span></div><div class=\"line\">}, <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;search movie success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x6CE8;&#xFF1A;&#x672C;&#x6587;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x4E86;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;<a href=\"http://mongoosejs.com/\">Mongoose</a>&#xFF0C;&#x5B83;&#x4E0E;MongoDB Shell&#x7684;&#x63A5;&#x53E3;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<p>&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x91CF;&#x5927;&#x65F6;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x4F1A;&#x5F88;&#x5DEE;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x9700;&#x8981;:</p>\n<ul>\n<li>&#x904D;&#x5386;&#x6574;&#x4E2A;movie&#x96C6;&#x5408;&#x7684;&#x6240;&#x6709;&#x6587;&#x6863;</li>\n<li>&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x7684;startList&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4ECB;&#x7ECD;MongoDB&#x4E2D;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\">MapReduce</a>&#x4E0E;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\">Aggregation Pipeline</a>&#x3002;</p>\n<h2 id=\"&#x4E09;-MapReduce\"><a href=\"#&#x4E09;-MapReduce\" class=\"headerlink\" title=\"&#x4E09; MapReduce\"></a>&#x4E09; MapReduce</h2><p><a href=\"http://research.google.com/archive/mapreduce.html\">MapReduce</a>&#x662F;&#x7531;&#x8C37;&#x6B4C;&#x63D0;&#x51FA;&#x7684;&#x7F16;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x79CD;&#x5927;&#x6570;&#x636E;&#x5904;&#x7406;&#x573A;&#x666F;&#xFF0C;&#x5728;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#xFF0C;MapReduce&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x7F51;&#x9875;&#x6570;&#x636E;&#x7684;&#x5012;&#x6392;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x7F51;&#x9875;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;PageRank(&#x7531;&#x8C37;&#x6B4C;&#x521B;&#x59CB;&#x4EBA;&#x4F69;&#x5947;&#x548C;&#x5E03;&#x6797;&#x63D0;&#x51FA;)&#x3002;</p>\n<p>MapReduce&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x4E0E;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x5747;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x3002;MapReduce&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x51FD;&#x6570;: Map&#x4E0E;Reduce&#x3002;</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x5C06;&#x8F93;&#x5165;&#x952E;&#x503C;<code>&lt;k1, v1&gt;</code>&#x5BF9;&#x8FDB;&#x884C;&#x53D8;&#x6362;&#xFF0C;&#x8F93;&#x51FA;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x3002;</li>\n<li>MapReduce&#x6846;&#x67B6;&#x4F1A;&#x81EA;&#x52A8;&#x5BF9;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;Key&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x7684;Value&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x751F;&#x6210;&#x7ED3;&#x679C;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v3&gt;</code>&#x3002;</li>\n</ul>\n<p>&#x4F7F;&#x7528;MapReduce&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> option = {};</div><div class=\"line\"></div><div class=\"line\">option.map = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movie = <span class=\"keyword\">this</span>.movie;</div><div class=\"line\">    <span class=\"keyword\">this</span>.starList.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">star</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        emit(star,</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"attr\">movieList</span>: [movie]</div><div class=\"line\">        });</div><div class=\"line\">    });</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">option.reduce = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, values</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movieList = [];</div><div class=\"line\">    values.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        movieList.push(value.movieList[<span class=\"number\">0</span>]);</div><div class=\"line\">    });</div><div class=\"line\">    <span class=\"keyword\">return</span> {</div><div class=\"line\">        <span class=\"attr\">movieList</span>: movieList</div><div class=\"line\">    };</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">Movie.mapReduce(option, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">        process.exit(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.stringify(results, <span class=\"literal\">null</span>, <span class=\"number\">4</span>));</div><div class=\"line\">    process.exit(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;Movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x6587;&#x6863;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7528;this&#x8868;&#x793A;&#x3002;&#x6587;&#x6863;&#x7684;movie&#x4E0E;starList&#x5C5E;&#x6027;&#x6784;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;movie, starList&gt;</code>&#x3002;Map&#x51FD;&#x6570;&#x904D;&#x5386;starList&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;start&#x751F;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x3002;&#x8FD9;&#x65F6;Key&#x4E0E;Value&#x8FDB;&#x884C;&#x4E86;&#x5BF9;&#x8C03;&#xFF0C;&#x4E14;starList&#x88AB;&#x62C6;&#x5206;&#x4E86;&#xFF0C;movieList&#x4EC5;&#x5305;&#x542B;&#x5355;&#x4E2A;movie&#x3002;</li>\n<li>MongoDB&#x7684;MapReduce&#x6267;&#x884C;&#x6846;&#x67B6;&#x5BF9;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;star&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#x3002;&#x8FD9;&#x4E00;&#x6B65;&#x662F;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x4F53;&#x73B0;&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;star&#x5373;&#x4E3A;key&#xFF0C;&#x800C;list(movieList)&#x5373;&#x4E3A;values&#xFF0C;&#x4E24;&#x8005;&#x4E3A;Reduce&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x3002;Reduce&#x51FD;&#x6570;&#x5408;&#x5E76;list(movieList)&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#xFF0C;&#x6700;&#x7EC8;&#xFF0C;movieList&#x4E2D;&#x5C06;&#x5305;&#x542B;&#x8BE5;star&#x7684;&#x6240;&#x6709;movie&#x3002;</li>\n</ul>\n<p>&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;Map&#x51FD;&#x6570;&#x4E0E;Reduce&#x8FD4;&#x56DE;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;Value&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;<code>{ movieList: movieList }</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;<code>movieList</code>&#xFF0C;&#x56E0;&#x6B64;&#x4EE3;&#x7801;&#x548C;&#x7ED3;&#x679C;&#x90FD;&#x663E;&#x5F97;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x3002;MongoDB&#x7684;MapReduce&#x6846;&#x67B6;&#x4E0D;&#x652F;&#x6301;Reduce&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x5C06;movieList&#x653E;&#x5728;&#x5BF9;&#x8C61;&#x91CC;&#x9762;&#x8FD4;&#x56DE;&#x3002;</p>\n<p>&#x8F93;&#x51FA;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-Aggregation-Pipeline\"><a href=\"#&#x56DB;-Aggregation-Pipeline\" class=\"headerlink\" title=\"&#x56DB;. Aggregation Pipeline\"></a>&#x56DB;. Aggregation Pipeline</h2><p><a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\">Aggregation Pipeline</a>&#xFF0C;&#x4E2D;&#x6587;&#x79F0;&#x4F5C;&#x805A;&#x5408;&#x7BA1;&#x9053;&#xFF0C;&#x7528;&#x4E8E;&#x6C47;&#x603B;MongoDB&#x4E2D;&#x591A;&#x4E2A;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x3002;</p>\n<p>Aggregation Pipeline&#x8FDB;&#x884C;&#x5404;&#x79CD;<a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/\">&#x805A;&#x5408;&#x64CD;&#x4F5C;</a>&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A;&#x805A;&#x5408;&#x64CD;&#x4F5C;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#x64CD;&#x4F5C;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x5165;&#x3002;</p>\n<p>&#x4F7F;&#x7528;Aggregation Pipeline&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.aggregate([</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$unwind&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$group&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>:</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"string\">&quot;$push&quot;</span>: <span class=\"string\">&quot;$movie&quot;</span></div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$project&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"number\">0</span>,</div><div class=\"line\">        <span class=\"string\">&quot;star&quot;</span>: <span class=\"string\">&quot;$_id&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>: <span class=\"number\">1</span></div><div class=\"line\">    }</div><div class=\"line\">}], <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>$unwind: &#x5C06;starList&#x62C6;&#x5206;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;(&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>)&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span></div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<ul>\n<li>$group: &#x6839;&#x636E;&#x6587;&#x6863;&#x7684;starList&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5206;&#x7EC4;&#x6587;&#x6863;&#x7684;movie&#x5C5E;&#x6027;&#x5408;&#x5E76;&#x4E3A;movieList&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>"},{"title":"Underscore实例教程","date":"2016-09-18T02:00:00.000Z","_content":"\n**摘要:** [Underscore](http://underscorejs.org/)是一个轻量级的JavaScript库，提供了许多非常实用的函数。熟练使用Underscore可以更快地写出更简洁的代码。本文将通过一个简单的编程实例，介绍几个常用的Underscore函数。\n\n**GitHub地址:**\n\n- [kiwenlau/underscore-example](https://github.com/kiwenlau/underscore-example)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-18](http://kiwenlau.com/2016/09/18/underscore-example/)\n\n<img src=\"underscore-example/underscore-example.png\" width = \"500\"/>\n\n## 一. 编程实例\n\n输入数据是一个数组: \n\n```\n[\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n```\n\n其中，数组中存在重复的元素。例如，\"c\"重复了3次。\n\n现在需要**根据元素在数组中的重复个数进行排序**。通过**观察**可知，\"a\"为1个，\"b\"为2个，\"c\"为3个，\"d\"为4个。\n\n因此，输出结果是:\n\n```\n[ 'a', 'b', 'c', 'd' ]\n```\n\n当然，计算机暂时还没办法像人一样通过**观察**解决问题，所以得敲代码...\n\n问题本身很容易理解，但是代码并不好写。不使用underscore的话，程序是这样的:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\n\n// 对数组元素进行计数\nvar A = {};\n\nfor (var i = 0; i < X.length; i++)\n{\n    var x = X[i];\n    if (A.hasOwnProperty(X[i]))\n    {\n        A[x]++;\n    }\n    else\n    {\n        A[x] = 1;\n    }\n}\n\n\n// 将对象转化为二维数组\nvar B = [];\n\nfor (var a in A)\n{\n    B.push([a, A[a]]);\n}\n\n\n// 根据二维数组的第2列元素进行排序\nB.sort(\n    function(a, b)\n    {\n        return a[1] - b[1];\n    }\n);\n\n\n// 获取二维数组的第1列元素\nvar Y = [];\n\nfor (var i = 0; i < B.length; i++)\n{\n    Y.push(B[i][0]);\n}\n\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n虽然我在代码中使用了一些JavasScript自带的库函数例如sort，但是代码仍然比较冗长。\n\n使用了Underscore之后，代码被极大地简化了:\n\n```\nvar _ = require(\"underscore\");\n\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n可知，我使用了4个Underscore函数: [_.countBy](http://underscorejs.org/#countBy)，[_.pairs](http://underscorejs.org/#pairs)，[_.sortBy](http://underscorejs.org/#sortBy)和[_.pluck](http://underscorejs.org/#pluck)。并且通过[_.chain](http://underscorejs.org/#chain)将这4个函数依次链接起来，实现了前一段代码中完全相同的功能。\n\n下面，我会依次介绍代码中所使用的Underscore函数。\n\n## 二. 函数介绍\n\n#### **1. [_.countBy](http://underscorejs.org/#countBy)**\n\n功能: \n\n- 对数组中的元素进行计数\n\n实例:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.countBy(X);\n\nconsole.log(Y); // 输出: { b: 2, d: 4, a: 1, c: 3 }\n```\n\n#### **2. [_.pairs](http://underscorejs.org/#pairs)**\n\n功能: \n\n- 将对象中的属性与属性值转化为键值对数组\n\n实例:\n\n```\nvar X = {\n    b: 2,\n    d: 4,\n    a: 1,\n    c: 3\n}; // 输入\n\nvar Y = _.pairs(X);\n\nconsole.log(Y); // 输出: [ [ 'b', 2 ], [ 'd', 4 ], [ 'a', 1 ], [ 'c', 3 ] ]\n```\n\n#### **3. [_.sortBy](http://underscorejs.org/#sortBy)**\n\n功能: \n\n- 对数组中的元素进行排序；对于二维数组，可以根据某一列的元素值进行排序。\n\n实例:\n\n```\nvar X = [\n    ['b', 2],\n    ['d', 4],\n    ['a', 1],\n    ['c', 3]\n]; // 输入\n\nvar Y = _.sortBy(X, 1); // 根据二维数组的第2列进行排序\n\nconsole.log(Y); // 输出: [ [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ], [ 'd', 4 ] ]\n```\n\n#### **4. [_.pluck](http://underscorejs.org/#pluck)**\n\n功能: \n\n- 获取对象的某个属性的Value列表；或者获取二维数组中的某一列\n\n实例:\n\n```\nvar X = [\n    ['a', 1],\n    ['b', 2],\n    ['c', 3],\n    ['d', 4]\n]; // 输入\n\nvar Y = _.pluck(X, 0); // 获取二维数组的第1列\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n#### **5. [_.chain](http://underscorejs.org/#chain)**\n\n功能: \n\n- 将多个Underscore函数链接起来完成计算任务\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n很多时候，需要使用多个Underscore函数来完成单个计算任务。类似于Linux中的管道，前一个函数的输出是后一个函数的输入，这时可以通过使用[_.chain](http://underscorejs.org/#chain)将多个函数链接起来，最后使用[_.value](http://underscorejs.org/#value)获取计算结果。","source":"_posts/2016/09/18/underscore-example.md","raw":"title: Underscore实例教程\n\ndate: 2016-09-18 10:00\n\ntags: [NodeJS, Underscore]\n\n---\n\n**摘要:** [Underscore](http://underscorejs.org/)是一个轻量级的JavaScript库，提供了许多非常实用的函数。熟练使用Underscore可以更快地写出更简洁的代码。本文将通过一个简单的编程实例，介绍几个常用的Underscore函数。\n\n**GitHub地址:**\n\n- [kiwenlau/underscore-example](https://github.com/kiwenlau/underscore-example)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-18](http://kiwenlau.com/2016/09/18/underscore-example/)\n\n<img src=\"underscore-example/underscore-example.png\" width = \"500\"/>\n\n## 一. 编程实例\n\n输入数据是一个数组: \n\n```\n[\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n```\n\n其中，数组中存在重复的元素。例如，\"c\"重复了3次。\n\n现在需要**根据元素在数组中的重复个数进行排序**。通过**观察**可知，\"a\"为1个，\"b\"为2个，\"c\"为3个，\"d\"为4个。\n\n因此，输出结果是:\n\n```\n[ 'a', 'b', 'c', 'd' ]\n```\n\n当然，计算机暂时还没办法像人一样通过**观察**解决问题，所以得敲代码...\n\n问题本身很容易理解，但是代码并不好写。不使用underscore的话，程序是这样的:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\n\n// 对数组元素进行计数\nvar A = {};\n\nfor (var i = 0; i < X.length; i++)\n{\n    var x = X[i];\n    if (A.hasOwnProperty(X[i]))\n    {\n        A[x]++;\n    }\n    else\n    {\n        A[x] = 1;\n    }\n}\n\n\n// 将对象转化为二维数组\nvar B = [];\n\nfor (var a in A)\n{\n    B.push([a, A[a]]);\n}\n\n\n// 根据二维数组的第2列元素进行排序\nB.sort(\n    function(a, b)\n    {\n        return a[1] - b[1];\n    }\n);\n\n\n// 获取二维数组的第1列元素\nvar Y = [];\n\nfor (var i = 0; i < B.length; i++)\n{\n    Y.push(B[i][0]);\n}\n\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n虽然我在代码中使用了一些JavasScript自带的库函数例如sort，但是代码仍然比较冗长。\n\n使用了Underscore之后，代码被极大地简化了:\n\n```\nvar _ = require(\"underscore\");\n\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n可知，我使用了4个Underscore函数: [_.countBy](http://underscorejs.org/#countBy)，[_.pairs](http://underscorejs.org/#pairs)，[_.sortBy](http://underscorejs.org/#sortBy)和[_.pluck](http://underscorejs.org/#pluck)。并且通过[_.chain](http://underscorejs.org/#chain)将这4个函数依次链接起来，实现了前一段代码中完全相同的功能。\n\n下面，我会依次介绍代码中所使用的Underscore函数。\n\n## 二. 函数介绍\n\n#### **1. [_.countBy](http://underscorejs.org/#countBy)**\n\n功能: \n\n- 对数组中的元素进行计数\n\n实例:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.countBy(X);\n\nconsole.log(Y); // 输出: { b: 2, d: 4, a: 1, c: 3 }\n```\n\n#### **2. [_.pairs](http://underscorejs.org/#pairs)**\n\n功能: \n\n- 将对象中的属性与属性值转化为键值对数组\n\n实例:\n\n```\nvar X = {\n    b: 2,\n    d: 4,\n    a: 1,\n    c: 3\n}; // 输入\n\nvar Y = _.pairs(X);\n\nconsole.log(Y); // 输出: [ [ 'b', 2 ], [ 'd', 4 ], [ 'a', 1 ], [ 'c', 3 ] ]\n```\n\n#### **3. [_.sortBy](http://underscorejs.org/#sortBy)**\n\n功能: \n\n- 对数组中的元素进行排序；对于二维数组，可以根据某一列的元素值进行排序。\n\n实例:\n\n```\nvar X = [\n    ['b', 2],\n    ['d', 4],\n    ['a', 1],\n    ['c', 3]\n]; // 输入\n\nvar Y = _.sortBy(X, 1); // 根据二维数组的第2列进行排序\n\nconsole.log(Y); // 输出: [ [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ], [ 'd', 4 ] ]\n```\n\n#### **4. [_.pluck](http://underscorejs.org/#pluck)**\n\n功能: \n\n- 获取对象的某个属性的Value列表；或者获取二维数组中的某一列\n\n实例:\n\n```\nvar X = [\n    ['a', 1],\n    ['b', 2],\n    ['c', 3],\n    ['d', 4]\n]; // 输入\n\nvar Y = _.pluck(X, 0); // 获取二维数组的第1列\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n#### **5. [_.chain](http://underscorejs.org/#chain)**\n\n功能: \n\n- 将多个Underscore函数链接起来完成计算任务\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n很多时候，需要使用多个Underscore函数来完成单个计算任务。类似于Linux中的管道，前一个函数的输出是后一个函数的输入，这时可以通过使用[_.chain](http://underscorejs.org/#chain)将多个函数链接起来，最后使用[_.value](http://underscorejs.org/#value)获取计算结果。","slug":"2016/09/18/underscore-example","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzwe0019ivfy7oi09nen","content":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"http://underscorejs.org/\" target=\"_blank\" rel=\"external\">Underscore</a>&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;JavaScript&#x5E93;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x8BB8;&#x591A;&#x975E;&#x5E38;&#x5B9E;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;&#x719F;&#x7EC3;&#x4F7F;&#x7528;Underscore&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x5199;&#x51FA;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x4E2A;&#x5E38;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/underscore-example\" target=\"_blank\" rel=\"external\">kiwenlau/underscore-example</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/18/underscore-example/\">2016-09-18</a></li>\n</ul>\n<p><img src=\"/2016/09/18/underscore-example/underscore-example.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"><a href=\"#&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"></a>&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;</h2><p>&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;: </p>\n<figure class=\"highlight clojure\"><table><tr><td class=\"code\"><pre><div class=\"line\">[<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]<span class=\"comment\">;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;&#x6570;&#x7EC4;&#x4E2D;&#x5B58;&#x5728;&#x91CD;&#x590D;&#x7684;&#x5143;&#x7D20;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x201D;c&#x201D;&#x91CD;&#x590D;&#x4E86;3&#x6B21;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x9700;&#x8981;<strong>&#x6839;&#x636E;&#x5143;&#x7D20;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x91CD;&#x590D;&#x4E2A;&#x6570;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</strong>&#x3002;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x53EF;&#x77E5;&#xFF0C;&#x201D;a&#x201D;&#x4E3A;1&#x4E2A;&#xFF0C;&#x201D;b&#x201D;&#x4E3A;2&#x4E2A;&#xFF0C;&#x201D;c&#x201D;&#x4E3A;3&#x4E2A;&#xFF0C;&#x201D;d&#x201D;&#x4E3A;4&#x4E2A;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x662F;:</p>\n<figure class=\"highlight scheme\"><table><tr><td class=\"code\"><pre><div class=\"line\">[ <span class=\"symbol\">&apos;a</span>&apos;, <span class=\"symbol\">&apos;b</span>&apos;, <span class=\"symbol\">&apos;c</span>&apos;, <span class=\"symbol\">&apos;d</span>&apos; ]</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x8BA1;&#x7B97;&#x673A;&#x6682;&#x65F6;&#x8FD8;&#x6CA1;&#x529E;&#x6CD5;&#x50CF;&#x4EBA;&#x4E00;&#x6837;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x6572;&#x4EE3;&#x7801;&#x2026;</p>\n<p>&#x95EE;&#x9898;&#x672C;&#x8EAB;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x597D;&#x5199;&#x3002;&#x4E0D;&#x4F7F;&#x7528;underscore&#x7684;&#x8BDD;&#xFF0C;&#x7A0B;&#x5E8F;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\"><span class=\"keyword\">var</span> A = {};</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; X.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> x = X[i];</div><div class=\"line\">    <span class=\"keyword\">if</span> (A.hasOwnProperty(X[i]))</div><div class=\"line\">    {</div><div class=\"line\">        A[x]++;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        A[x] = <span class=\"number\">1</span>;</div><div class=\"line\">    }</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\"><span class=\"keyword\">var</span> B = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a <span class=\"keyword\">in</span> A)</div><div class=\"line\">{</div><div class=\"line\">    B.push([a, A[a]]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">B.sort(</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> a[<span class=\"number\">1</span>] - b[<span class=\"number\">1</span>];</div><div class=\"line\">    }</div><div class=\"line\">);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\"><span class=\"keyword\">var</span> Y = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; B.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    Y.push(B[i][<span class=\"number\">0</span>]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">console</span>.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x867D;&#x7136;&#x6211;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;JavasScript&#x81EA;&#x5E26;&#x7684;&#x5E93;&#x51FD;&#x6570;&#x4F8B;&#x5982;sort&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x6BD4;&#x8F83;&#x5197;&#x957F;&#x3002;</p>\n<p>&#x4F7F;&#x7528;&#x4E86;Underscore&#x4E4B;&#x540E;&#xFF0C;&#x4EE3;&#x7801;&#x88AB;&#x6781;&#x5927;&#x5730;&#x7B80;&#x5316;&#x4E86;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> <span class=\"literal\">_</span> = require(<span class=\"string\">&quot;underscore&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.chain(X)</div><div class=\"line\">    .countBy() <span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\">    .pairs()   <span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\">    .value();  <span class=\"comment\">// &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</span></div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4E86;4&#x4E2A;Underscore&#x51FD;&#x6570;: <a href=\"http://underscorejs.org/#countBy\" target=\"_blank\" rel=\"external\">_.countBy</a>&#xFF0C;<a href=\"http://underscorejs.org/#pairs\" target=\"_blank\" rel=\"external\">_.pairs</a>&#xFF0C;<a href=\"http://underscorejs.org/#sortBy\" target=\"_blank\" rel=\"external\">_.sortBy</a>&#x548C;<a href=\"http://underscorejs.org/#pluck\" target=\"_blank\" rel=\"external\">_.pluck</a>&#x3002;&#x5E76;&#x4E14;&#x901A;&#x8FC7;<a href=\"http://underscorejs.org/#chain\" target=\"_blank\" rel=\"external\">_.chain</a>&#x5C06;&#x8FD9;4&#x4E2A;&#x51FD;&#x6570;&#x4F9D;&#x6B21;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x524D;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4F1A;&#x4F9D;&#x6B21;&#x4ECB;&#x7ECD;&#x4EE3;&#x7801;&#x4E2D;&#x6240;&#x4F7F;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"></a>&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;</h2><h4 id=\"1-countBy\"><a href=\"#1-countBy\" class=\"headerlink\" title=\"1. _.countBy\"></a><strong>1. <a href=\"http://underscorejs.org/#countBy\" target=\"_blank\" rel=\"external\">_.countBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"comment\">// &#x8F93;&#x5165;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.countBy(X);</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// &#x8F93;&#x51FA;: { b: 2, d: 4, a: 1, c: 3 }</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-pairs\"><a href=\"#2-pairs\" class=\"headerlink\" title=\"2. _.pairs\"></a><strong>2. <a href=\"http://underscorejs.org/#pairs\" target=\"_blank\" rel=\"external\">_.pairs</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x5C5E;&#x6027;&#x503C;&#x8F6C;&#x5316;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = {</div><div class=\"line\">    b: <span class=\"number\">2</span>,</div><div class=\"line\">    d: <span class=\"number\">4</span>,</div><div class=\"line\">    a: <span class=\"number\">1</span>,</div><div class=\"line\">    c: <span class=\"number\">3</span></div><div class=\"line\">}; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pairs(<span class=\"symbol\">X</span>);</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ], [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"3-sortBy\"><a href=\"#3-sortBy\" class=\"headerlink\" title=\"3. _.sortBy\"></a><strong>3. <a href=\"http://underscorejs.org/#sortBy\" target=\"_blank\" rel=\"external\">_.sortBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1B;&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x67D0;&#x4E00;&#x5217;&#x7684;&#x5143;&#x7D20;&#x503C;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.sortBy(<span class=\"symbol\">X</span>, <span class=\"number\">1</span>); // &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"4-pluck\"><a href=\"#4-pluck\" class=\"headerlink\" title=\"4. _.pluck\"></a><strong>4. <a href=\"http://underscorejs.org/#pluck\" target=\"_blank\" rel=\"external\">_.pluck</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x7684;Value&#x5217;&#x8868;&#xFF1B;&#x6216;&#x8005;&#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x67D0;&#x4E00;&#x5217;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pluck(<span class=\"symbol\">X</span>, <span class=\"number\">0</span>); // &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<h4 id=\"5-chain\"><a href=\"#5-chain\" class=\"headerlink\" title=\"5. _.chain\"></a><strong>5. <a href=\"http://underscorejs.org/#chain\" target=\"_blank\" rel=\"external\">_.chain</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x5B8C;&#x6210;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">var X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"regexp\">//</span> &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var Y = _.chain(X)</div><div class=\"line\">    .countBy() <span class=\"regexp\">//</span> &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</div><div class=\"line\">    .pairs()   <span class=\"regexp\">//</span> &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"regexp\">//</span> &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;&#x5143;&#x7D20;</div><div class=\"line\">    .value();  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"regexp\">//</span> &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<p>&#x5F88;&#x591A;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x6765;&#x5B8C;&#x6210;&#x5355;&#x4E2A;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x540E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#chain\" target=\"_blank\" rel=\"external\">_.chain</a>&#x5C06;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#value\" target=\"_blank\" rel=\"external\">_.value</a>&#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x3002;</p>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"http://underscorejs.org/\">Underscore</a>&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;JavaScript&#x5E93;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x8BB8;&#x591A;&#x975E;&#x5E38;&#x5B9E;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;&#x719F;&#x7EC3;&#x4F7F;&#x7528;Underscore&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x5199;&#x51FA;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x4E2A;&#x5E38;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/underscore-example\">kiwenlau/underscore-example</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/18/underscore-example/\">2016-09-18</a></li>\n</ul>\n<p><img src=\"/2016/09/18/underscore-example/underscore-example.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"><a href=\"#&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"></a>&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;</h2><p>&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;: </p>\n<figure class=\"highlight clojure\"><table><tr><td class=\"code\"><pre><div class=\"line\">[<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]<span class=\"comment\">;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;&#x6570;&#x7EC4;&#x4E2D;&#x5B58;&#x5728;&#x91CD;&#x590D;&#x7684;&#x5143;&#x7D20;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x201D;c&#x201D;&#x91CD;&#x590D;&#x4E86;3&#x6B21;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x9700;&#x8981;<strong>&#x6839;&#x636E;&#x5143;&#x7D20;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x91CD;&#x590D;&#x4E2A;&#x6570;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</strong>&#x3002;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x53EF;&#x77E5;&#xFF0C;&#x201D;a&#x201D;&#x4E3A;1&#x4E2A;&#xFF0C;&#x201D;b&#x201D;&#x4E3A;2&#x4E2A;&#xFF0C;&#x201D;c&#x201D;&#x4E3A;3&#x4E2A;&#xFF0C;&#x201D;d&#x201D;&#x4E3A;4&#x4E2A;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x662F;:</p>\n<figure class=\"highlight scheme\"><table><tr><td class=\"code\"><pre><div class=\"line\">[ <span class=\"symbol\">&apos;a</span>&apos;, <span class=\"symbol\">&apos;b</span>&apos;, <span class=\"symbol\">&apos;c</span>&apos;, <span class=\"symbol\">&apos;d</span>&apos; ]</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x8BA1;&#x7B97;&#x673A;&#x6682;&#x65F6;&#x8FD8;&#x6CA1;&#x529E;&#x6CD5;&#x50CF;&#x4EBA;&#x4E00;&#x6837;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x6572;&#x4EE3;&#x7801;&#x2026;</p>\n<p>&#x95EE;&#x9898;&#x672C;&#x8EAB;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x597D;&#x5199;&#x3002;&#x4E0D;&#x4F7F;&#x7528;underscore&#x7684;&#x8BDD;&#xFF0C;&#x7A0B;&#x5E8F;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\"><span class=\"keyword\">var</span> A = {};</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; X.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> x = X[i];</div><div class=\"line\">    <span class=\"keyword\">if</span> (A.hasOwnProperty(X[i]))</div><div class=\"line\">    {</div><div class=\"line\">        A[x]++;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        A[x] = <span class=\"number\">1</span>;</div><div class=\"line\">    }</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\"><span class=\"keyword\">var</span> B = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a <span class=\"keyword\">in</span> A)</div><div class=\"line\">{</div><div class=\"line\">    B.push([a, A[a]]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">B.sort(</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> a[<span class=\"number\">1</span>] - b[<span class=\"number\">1</span>];</div><div class=\"line\">    }</div><div class=\"line\">);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\"><span class=\"keyword\">var</span> Y = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; B.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    Y.push(B[i][<span class=\"number\">0</span>]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">console</span>.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x867D;&#x7136;&#x6211;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;JavasScript&#x81EA;&#x5E26;&#x7684;&#x5E93;&#x51FD;&#x6570;&#x4F8B;&#x5982;sort&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x6BD4;&#x8F83;&#x5197;&#x957F;&#x3002;</p>\n<p>&#x4F7F;&#x7528;&#x4E86;Underscore&#x4E4B;&#x540E;&#xFF0C;&#x4EE3;&#x7801;&#x88AB;&#x6781;&#x5927;&#x5730;&#x7B80;&#x5316;&#x4E86;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> <span class=\"literal\">_</span> = require(<span class=\"string\">&quot;underscore&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.chain(X)</div><div class=\"line\">    .countBy() <span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\">    .pairs()   <span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\">    .value();  <span class=\"comment\">// &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</span></div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4E86;4&#x4E2A;Underscore&#x51FD;&#x6570;: <a href=\"http://underscorejs.org/#countBy\">_.countBy</a>&#xFF0C;<a href=\"http://underscorejs.org/#pairs\">_.pairs</a>&#xFF0C;<a href=\"http://underscorejs.org/#sortBy\">_.sortBy</a>&#x548C;<a href=\"http://underscorejs.org/#pluck\">_.pluck</a>&#x3002;&#x5E76;&#x4E14;&#x901A;&#x8FC7;<a href=\"http://underscorejs.org/#chain\">_.chain</a>&#x5C06;&#x8FD9;4&#x4E2A;&#x51FD;&#x6570;&#x4F9D;&#x6B21;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x524D;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4F1A;&#x4F9D;&#x6B21;&#x4ECB;&#x7ECD;&#x4EE3;&#x7801;&#x4E2D;&#x6240;&#x4F7F;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"></a>&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;</h2><h4 id=\"1-countBy\"><a href=\"#1-countBy\" class=\"headerlink\" title=\"1. _.countBy\"></a><strong>1. <a href=\"http://underscorejs.org/#countBy\">_.countBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"comment\">// &#x8F93;&#x5165;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.countBy(X);</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// &#x8F93;&#x51FA;: { b: 2, d: 4, a: 1, c: 3 }</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-pairs\"><a href=\"#2-pairs\" class=\"headerlink\" title=\"2. _.pairs\"></a><strong>2. <a href=\"http://underscorejs.org/#pairs\">_.pairs</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x5C5E;&#x6027;&#x503C;&#x8F6C;&#x5316;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = {</div><div class=\"line\">    b: <span class=\"number\">2</span>,</div><div class=\"line\">    d: <span class=\"number\">4</span>,</div><div class=\"line\">    a: <span class=\"number\">1</span>,</div><div class=\"line\">    c: <span class=\"number\">3</span></div><div class=\"line\">}; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pairs(<span class=\"symbol\">X</span>);</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ], [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"3-sortBy\"><a href=\"#3-sortBy\" class=\"headerlink\" title=\"3. _.sortBy\"></a><strong>3. <a href=\"http://underscorejs.org/#sortBy\">_.sortBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1B;&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x67D0;&#x4E00;&#x5217;&#x7684;&#x5143;&#x7D20;&#x503C;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.sortBy(<span class=\"symbol\">X</span>, <span class=\"number\">1</span>); // &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"4-pluck\"><a href=\"#4-pluck\" class=\"headerlink\" title=\"4. _.pluck\"></a><strong>4. <a href=\"http://underscorejs.org/#pluck\">_.pluck</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x7684;Value&#x5217;&#x8868;&#xFF1B;&#x6216;&#x8005;&#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x67D0;&#x4E00;&#x5217;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pluck(<span class=\"symbol\">X</span>, <span class=\"number\">0</span>); // &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<h4 id=\"5-chain\"><a href=\"#5-chain\" class=\"headerlink\" title=\"5. _.chain\"></a><strong>5. <a href=\"http://underscorejs.org/#chain\">_.chain</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x5B8C;&#x6210;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">var X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"regexp\">//</span> &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var Y = _.chain(X)</div><div class=\"line\">    .countBy() <span class=\"regexp\">//</span> &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</div><div class=\"line\">    .pairs()   <span class=\"regexp\">//</span> &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"regexp\">//</span> &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;&#x5143;&#x7D20;</div><div class=\"line\">    .value();  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"regexp\">//</span> &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<p>&#x5F88;&#x591A;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x6765;&#x5B8C;&#x6210;&#x5355;&#x4E2A;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x540E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#chain\">_.chain</a>&#x5C06;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#value\">_.value</a>&#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x3002;</p>"},{"title":"Fundebug抓到了这个Bug","date":"2016-12-06T16:00:00.000Z","_content":"\n[Fundebug](https://fundebug.com)网站使用了我们自己的[JavaScript](https://docs.fundebug.com/notifier/javascript/)错误检测插件，这样代码一旦发生错误，程序员小明就会及时收到报警邮件。\n\n<!-- more -->\n\n我们的前端代码做过严格的单元测试和端到端测试，讲(xiang)道(dang)理(ran)不会出什么错误。\n\n然而，现实是残酷的，总会有各种Bug出现：\n\n- ``this.$parent.elctrl is undefined``, \n- `Attempted to redefine property 'authenticate'.`, \n- `Cannot read property 'language' of null`\n- ...\n\n乍一看这些错误也没什么，然而事实证明它们其实是一个个大写的Bug。得益于[Fundebug](https://fundebug.com)实时监测，小明及时修复了这些问题。(此处应有掌声^*^)\n\n今天呢，我们来聊聊其中一个Bug。这个Bug是由于拼写失误造成的，它会导致网页无法正常显示，虽说刷新一下就好了，但是却会影响用户体验。然而，小明最初却忽略了Fundebug的报警。\n\n> 每一次报错都是一个潜在的Bug，不容忽视。\n\n### Bug回放\n\n11月15日早上8:56，小明收到一封报警邮件：\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"fundebug-catch-the-bug/email.png\" />\n</div>\n\nFundebug网站是基于`AngularJS`实现，这个错误与页面之间的跳转有关。由邮件可知，从`landing`状态跳转到`teamSign`状态时发生了错误。点击**查看详情**, 就能看到该错误的详细信息:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-detail.png\" />\n</div>\n\n在错误面板中，小明可以查看错误栈，请求，设备和用户信息。这些信息可以帮助小明快速定位错误。\n\n经过简单分析，小明断(xia)定(cai)网站的`landing`页面木有问题，这个错误应该是网络问题导致加载不完全而无法识别`teamSign`这个状态。如果网络好一点，加载成功了，就没问题了。然后他就将这个错误丢到一边去了。。。(Boss决定让小明跪键盘)\n\n但是，问题不是这么简单，这个错误之后一共出现了85次，累计影响了24个用户。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-count.png\" />\n</div>\n\n小明意识到问题的严重性之后，查找了`teamSign`跳转相关的代码。他发现，在登录验证的中间件里面，如果用户登录token因为超时失效，那么就会跳转到`teamSign`页面要求用户重新登录。然而，跳转到`teamSign`为什么会失败呢？为什么呢？为什么呢？原来是小明把\"teamSignin\"写成了\"teamSign\"。(Boss决定让小明滚出去)\n\n### 结论\n\n一个小小的拼写失误，却会对用户造成不小的困扰。而事实上，测试无法保证产品100%没有问题。使用[Fundebug](https://fundebug.com)进行实时错误监测，则可以第一时间发现并解决问题。\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","source":"_posts/2016/12/07/fundebug-catch-the-bug.md","raw":"---\ntitle: Fundebug抓到了这个Bug\n\ndate: 2016-12-07 00:00:00\n\ntags: [Fundebug]\n\n---\n\n[Fundebug](https://fundebug.com)网站使用了我们自己的[JavaScript](https://docs.fundebug.com/notifier/javascript/)错误检测插件，这样代码一旦发生错误，程序员小明就会及时收到报警邮件。\n\n<!-- more -->\n\n我们的前端代码做过严格的单元测试和端到端测试，讲(xiang)道(dang)理(ran)不会出什么错误。\n\n然而，现实是残酷的，总会有各种Bug出现：\n\n- ``this.$parent.elctrl is undefined``, \n- `Attempted to redefine property 'authenticate'.`, \n- `Cannot read property 'language' of null`\n- ...\n\n乍一看这些错误也没什么，然而事实证明它们其实是一个个大写的Bug。得益于[Fundebug](https://fundebug.com)实时监测，小明及时修复了这些问题。(此处应有掌声^*^)\n\n今天呢，我们来聊聊其中一个Bug。这个Bug是由于拼写失误造成的，它会导致网页无法正常显示，虽说刷新一下就好了，但是却会影响用户体验。然而，小明最初却忽略了Fundebug的报警。\n\n> 每一次报错都是一个潜在的Bug，不容忽视。\n\n### Bug回放\n\n11月15日早上8:56，小明收到一封报警邮件：\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"fundebug-catch-the-bug/email.png\" />\n</div>\n\nFundebug网站是基于`AngularJS`实现，这个错误与页面之间的跳转有关。由邮件可知，从`landing`状态跳转到`teamSign`状态时发生了错误。点击**查看详情**, 就能看到该错误的详细信息:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-detail.png\" />\n</div>\n\n在错误面板中，小明可以查看错误栈，请求，设备和用户信息。这些信息可以帮助小明快速定位错误。\n\n经过简单分析，小明断(xia)定(cai)网站的`landing`页面木有问题，这个错误应该是网络问题导致加载不完全而无法识别`teamSign`这个状态。如果网络好一点，加载成功了，就没问题了。然后他就将这个错误丢到一边去了。。。(Boss决定让小明跪键盘)\n\n但是，问题不是这么简单，这个错误之后一共出现了85次，累计影响了24个用户。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-count.png\" />\n</div>\n\n小明意识到问题的严重性之后，查找了`teamSign`跳转相关的代码。他发现，在登录验证的中间件里面，如果用户登录token因为超时失效，那么就会跳转到`teamSign`页面要求用户重新登录。然而，跳转到`teamSign`为什么会失败呢？为什么呢？为什么呢？原来是小明把\"teamSignin\"写成了\"teamSign\"。(Boss决定让小明滚出去)\n\n### 结论\n\n一个小小的拼写失误，却会对用户造成不小的困扰。而事实上，测试无法保证产品100%没有问题。使用[Fundebug](https://fundebug.com)进行实时错误监测，则可以第一时间发现并解决问题。\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","slug":"2016/12/07/fundebug-catch-the-bug","published":1,"updated":"2016-12-07T14:35:42.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ciz3dhzwf001bivfyra3y7k7o","content":"<p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7F51;&#x7AD9;&#x4F7F;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\" target=\"_blank\" rel=\"external\">JavaScript</a>&#x9519;&#x8BEF;&#x68C0;&#x6D4B;&#x63D2;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x4E00;&#x65E6;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x5C0F;&#x660E;&#x5C31;&#x4F1A;&#x53CA;&#x65F6;&#x6536;&#x5230;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x6211;&#x4EEC;&#x7684;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x505A;&#x8FC7;&#x4E25;&#x683C;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x548C;&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;&#xFF0C;&#x8BB2;(xiang)&#x9053;(dang)&#x7406;(ran)&#x4E0D;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x73B0;&#x5B9E;&#x662F;&#x6B8B;&#x9177;&#x7684;&#xFF0C;&#x603B;&#x4F1A;&#x6709;&#x5404;&#x79CD;Bug&#x51FA;&#x73B0;&#xFF1A;</p>\n<ul>\n<li><code>this.$parent.elctrl is undefined</code>, </li>\n<li><code>Attempted to redefine property &apos;authenticate&apos;.</code>, </li>\n<li><code>Cannot read property &apos;language&apos; of null</code></li>\n<li>&#x2026;</li>\n</ul>\n<p>&#x4E4D;&#x4E00;&#x770B;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x4E5F;&#x6CA1;&#x4EC0;&#x4E48;&#xFF0C;&#x7136;&#x800C;&#x4E8B;&#x5B9E;&#x8BC1;&#x660E;&#x5B83;&#x4EEC;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5927;&#x5199;&#x7684;Bug&#x3002;&#x5F97;&#x76CA;&#x4E8E;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#xFF0C;&#x5C0F;&#x660E;&#x53CA;&#x65F6;&#x4FEE;&#x590D;&#x4E86;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;(&#x6B64;&#x5904;&#x5E94;&#x6709;&#x638C;&#x58F0;^*^)</p>\n<p>&#x4ECA;&#x5929;&#x5462;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;Bug&#x3002;&#x8FD9;&#x4E2A;Bug&#x662F;&#x7531;&#x4E8E;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#x9020;&#x6210;&#x7684;&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x7F51;&#x9875;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A;&#xFF0C;&#x867D;&#x8BF4;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5C0F;&#x660E;&#x6700;&#x521D;&#x5374;&#x5FFD;&#x7565;&#x4E86;Fundebug&#x7684;&#x62A5;&#x8B66;&#x3002;</p>\n<blockquote>\n<p>&#x6BCF;&#x4E00;&#x6B21;&#x62A5;&#x9519;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x6F5C;&#x5728;&#x7684;Bug&#xFF0C;&#x4E0D;&#x5BB9;&#x5FFD;&#x89C6;&#x3002;</p>\n</blockquote>\n<h3 id=\"Bug&#x56DE;&#x653E;\"><a href=\"#Bug&#x56DE;&#x653E;\" class=\"headerlink\" title=\"Bug&#x56DE;&#x653E;\"></a>Bug&#x56DE;&#x653E;</h3><p>11&#x6708;15&#x65E5;&#x65E9;&#x4E0A;8:56&#xFF0C;&#x5C0F;&#x660E;&#x6536;&#x5230;&#x4E00;&#x5C01;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2016/12/07/fundebug-catch-the-bug/email.png\"><br></div>\n\n<p>Fundebug&#x7F51;&#x7AD9;&#x662F;&#x57FA;&#x4E8E;<code>AngularJS</code>&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E0E;&#x9875;&#x9762;&#x4E4B;&#x95F4;&#x7684;&#x8DF3;&#x8F6C;&#x6709;&#x5173;&#x3002;&#x7531;&#x90AE;&#x4EF6;&#x53EF;&#x77E5;&#xFF0C;&#x4ECE;<code>landing</code>&#x72B6;&#x6001;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x72B6;&#x6001;&#x65F6;&#x53D1;&#x751F;&#x4E86;&#x9519;&#x8BEF;&#x3002;&#x70B9;&#x51FB;<strong>&#x67E5;&#x770B;&#x8BE6;&#x60C5;</strong>, &#x5C31;&#x80FD;&#x770B;&#x5230;&#x8BE5;&#x9519;&#x8BEF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-detail.png\"><br></div>\n\n<p>&#x5728;&#x9519;&#x8BEF;&#x9762;&#x677F;&#x4E2D;&#xFF0C;&#x5C0F;&#x660E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x9519;&#x8BEF;&#x6808;&#xFF0C;&#x8BF7;&#x6C42;&#xFF0C;&#x8BBE;&#x5907;&#x548C;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5C0F;&#x660E;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x7B80;&#x5355;&#x5206;&#x6790;&#xFF0C;&#x5C0F;&#x660E;&#x65AD;(xia)&#x5B9A;(cai)&#x7F51;&#x7AD9;&#x7684;<code>landing</code>&#x9875;&#x9762;&#x6728;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5E94;&#x8BE5;&#x662F;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#x52A0;&#x8F7D;&#x4E0D;&#x5B8C;&#x5168;&#x800C;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;<code>teamSign</code>&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x7F51;&#x7EDC;&#x597D;&#x4E00;&#x70B9;&#xFF0C;&#x52A0;&#x8F7D;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x5C31;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x7136;&#x540E;&#x4ED6;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E22;&#x5230;&#x4E00;&#x8FB9;&#x53BB;&#x4E86;&#x3002;&#x3002;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x8DEA;&#x952E;&#x76D8;)</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x95EE;&#x9898;&#x4E0D;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E4B;&#x540E;&#x4E00;&#x5171;&#x51FA;&#x73B0;&#x4E86;85&#x6B21;&#xFF0C;&#x7D2F;&#x8BA1;&#x5F71;&#x54CD;&#x4E86;24&#x4E2A;&#x7528;&#x6237;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-count.png\"><br></div>\n\n<p>&#x5C0F;&#x660E;&#x610F;&#x8BC6;&#x5230;&#x95EE;&#x9898;&#x7684;&#x4E25;&#x91CD;&#x6027;&#x4E4B;&#x540E;&#xFF0C;&#x67E5;&#x627E;&#x4E86;<code>teamSign</code>&#x8DF3;&#x8F6C;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x4ED6;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x767B;&#x5F55;&#x9A8C;&#x8BC1;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x91CC;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x767B;&#x5F55;token&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x9875;&#x9762;&#x8981;&#x6C42;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5931;&#x8D25;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x539F;&#x6765;&#x662F;&#x5C0F;&#x660E;&#x628A;&#x201D;teamSignin&#x201D;&#x5199;&#x6210;&#x4E86;&#x201D;teamSign&#x201D;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x6EDA;&#x51FA;&#x53BB;)</p>\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#xFF0C;&#x5374;&#x4F1A;&#x5BF9;&#x7528;&#x6237;&#x9020;&#x6210;&#x4E0D;&#x5C0F;&#x7684;&#x56F0;&#x6270;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6D4B;&#x8BD5;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4EA7;&#x54C1;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F7F;&#x7528;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n\n","excerpt":"<p><a href=\"https://fundebug.com\">Fundebug</a>&#x7F51;&#x7AD9;&#x4F7F;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\">JavaScript</a>&#x9519;&#x8BEF;&#x68C0;&#x6D4B;&#x63D2;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x4E00;&#x65E6;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x5C0F;&#x660E;&#x5C31;&#x4F1A;&#x53CA;&#x65F6;&#x6536;&#x5230;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#x3002;</p>","more":"<p>&#x6211;&#x4EEC;&#x7684;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x505A;&#x8FC7;&#x4E25;&#x683C;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x548C;&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;&#xFF0C;&#x8BB2;(xiang)&#x9053;(dang)&#x7406;(ran)&#x4E0D;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x73B0;&#x5B9E;&#x662F;&#x6B8B;&#x9177;&#x7684;&#xFF0C;&#x603B;&#x4F1A;&#x6709;&#x5404;&#x79CD;Bug&#x51FA;&#x73B0;&#xFF1A;</p>\n<ul>\n<li><code>this.$parent.elctrl is undefined</code>, </li>\n<li><code>Attempted to redefine property &apos;authenticate&apos;.</code>, </li>\n<li><code>Cannot read property &apos;language&apos; of null</code></li>\n<li>&#x2026;</li>\n</ul>\n<p>&#x4E4D;&#x4E00;&#x770B;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x4E5F;&#x6CA1;&#x4EC0;&#x4E48;&#xFF0C;&#x7136;&#x800C;&#x4E8B;&#x5B9E;&#x8BC1;&#x660E;&#x5B83;&#x4EEC;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5927;&#x5199;&#x7684;Bug&#x3002;&#x5F97;&#x76CA;&#x4E8E;<a href=\"https://fundebug.com\">Fundebug</a>&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#xFF0C;&#x5C0F;&#x660E;&#x53CA;&#x65F6;&#x4FEE;&#x590D;&#x4E86;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;(&#x6B64;&#x5904;&#x5E94;&#x6709;&#x638C;&#x58F0;^*^)</p>\n<p>&#x4ECA;&#x5929;&#x5462;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;Bug&#x3002;&#x8FD9;&#x4E2A;Bug&#x662F;&#x7531;&#x4E8E;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#x9020;&#x6210;&#x7684;&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x7F51;&#x9875;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A;&#xFF0C;&#x867D;&#x8BF4;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5C0F;&#x660E;&#x6700;&#x521D;&#x5374;&#x5FFD;&#x7565;&#x4E86;Fundebug&#x7684;&#x62A5;&#x8B66;&#x3002;</p>\n<blockquote>\n<p>&#x6BCF;&#x4E00;&#x6B21;&#x62A5;&#x9519;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x6F5C;&#x5728;&#x7684;Bug&#xFF0C;&#x4E0D;&#x5BB9;&#x5FFD;&#x89C6;&#x3002;</p>\n</blockquote>\n<h3 id=\"Bug&#x56DE;&#x653E;\"><a href=\"#Bug&#x56DE;&#x653E;\" class=\"headerlink\" title=\"Bug&#x56DE;&#x653E;\"></a>Bug&#x56DE;&#x653E;</h3><p>11&#x6708;15&#x65E5;&#x65E9;&#x4E0A;8:56&#xFF0C;&#x5C0F;&#x660E;&#x6536;&#x5230;&#x4E00;&#x5C01;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2016/12/07/fundebug-catch-the-bug/email.png\"><br></div>\n\n<p>Fundebug&#x7F51;&#x7AD9;&#x662F;&#x57FA;&#x4E8E;<code>AngularJS</code>&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E0E;&#x9875;&#x9762;&#x4E4B;&#x95F4;&#x7684;&#x8DF3;&#x8F6C;&#x6709;&#x5173;&#x3002;&#x7531;&#x90AE;&#x4EF6;&#x53EF;&#x77E5;&#xFF0C;&#x4ECE;<code>landing</code>&#x72B6;&#x6001;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x72B6;&#x6001;&#x65F6;&#x53D1;&#x751F;&#x4E86;&#x9519;&#x8BEF;&#x3002;&#x70B9;&#x51FB;<strong>&#x67E5;&#x770B;&#x8BE6;&#x60C5;</strong>, &#x5C31;&#x80FD;&#x770B;&#x5230;&#x8BE5;&#x9519;&#x8BEF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-detail.png\"><br></div>\n\n<p>&#x5728;&#x9519;&#x8BEF;&#x9762;&#x677F;&#x4E2D;&#xFF0C;&#x5C0F;&#x660E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x9519;&#x8BEF;&#x6808;&#xFF0C;&#x8BF7;&#x6C42;&#xFF0C;&#x8BBE;&#x5907;&#x548C;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5C0F;&#x660E;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x7B80;&#x5355;&#x5206;&#x6790;&#xFF0C;&#x5C0F;&#x660E;&#x65AD;(xia)&#x5B9A;(cai)&#x7F51;&#x7AD9;&#x7684;<code>landing</code>&#x9875;&#x9762;&#x6728;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5E94;&#x8BE5;&#x662F;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#x52A0;&#x8F7D;&#x4E0D;&#x5B8C;&#x5168;&#x800C;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;<code>teamSign</code>&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x7F51;&#x7EDC;&#x597D;&#x4E00;&#x70B9;&#xFF0C;&#x52A0;&#x8F7D;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x5C31;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x7136;&#x540E;&#x4ED6;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E22;&#x5230;&#x4E00;&#x8FB9;&#x53BB;&#x4E86;&#x3002;&#x3002;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x8DEA;&#x952E;&#x76D8;)</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x95EE;&#x9898;&#x4E0D;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E4B;&#x540E;&#x4E00;&#x5171;&#x51FA;&#x73B0;&#x4E86;85&#x6B21;&#xFF0C;&#x7D2F;&#x8BA1;&#x5F71;&#x54CD;&#x4E86;24&#x4E2A;&#x7528;&#x6237;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-count.png\"><br></div>\n\n<p>&#x5C0F;&#x660E;&#x610F;&#x8BC6;&#x5230;&#x95EE;&#x9898;&#x7684;&#x4E25;&#x91CD;&#x6027;&#x4E4B;&#x540E;&#xFF0C;&#x67E5;&#x627E;&#x4E86;<code>teamSign</code>&#x8DF3;&#x8F6C;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x4ED6;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x767B;&#x5F55;&#x9A8C;&#x8BC1;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x91CC;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x767B;&#x5F55;token&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x9875;&#x9762;&#x8981;&#x6C42;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5931;&#x8D25;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x539F;&#x6765;&#x662F;&#x5C0F;&#x660E;&#x628A;&#x201D;teamSignin&#x201D;&#x5199;&#x6210;&#x4E86;&#x201D;teamSign&#x201D;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x6EDA;&#x51FA;&#x53BB;)</p>\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#xFF0C;&#x5374;&#x4F1A;&#x5BF9;&#x7528;&#x6237;&#x9020;&#x6210;&#x4E0D;&#x5C0F;&#x7684;&#x56F0;&#x6270;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6D4B;&#x8BD5;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4EA7;&#x54C1;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F7F;&#x7528;<a href=\"https://fundebug.com\">Fundebug</a>&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"Fundebug上线小程序错误监控啦","date":"2017-01-23T01:00:00.000Z","_content":"\n作为专业的JavaSript错误实时监测平台，[Fundebug](https://fundebug.com/)的**微信小程序实时错误监测服务**上线啦，我们能够帮助开发者及时，高效地发现并且解决小程序错误，从而提升用户体验。\n\n<!-- more -->\n\n#### 小程序大时代\n\n后移动互联网时代，创业者们纠结于开发APP还是公众号，而小程序的横空出世，让大家多了一种选择，也给未来增加了更多想象空间。\n\n小程序，正如它的名字，可以理解为迷你版的APP；它生根于微信帝国，因此也可以看作升级版的公众号。准确的说，小程序介于APP的灵活与公众号的轻巧之间，符合国人对中庸之道的信仰。对于那些低频，简单的工具类应用，小程序应该是一个不错的选择。\n\n从技术角度理解，小程序=**WXML + WXSS + JavaScrip**。WXML与WXSS只不过是换了个马甲的HTML与CSS，而JavaScript还是那个无处不在的JavaScript。或者说，小程序就是定制版的**HTML + CSS + JavaScript**。对于开发者，小程序没有什么神奇之处，不过是写几个简单的网页罢了。\n\n如果说小程序预示着一个应用轻型化的小时代，那么JavaScript正在开创属于它的大时代，从网页，到后端，到小程序，到APP以及智能硬件...\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-wxjs/fundebug-wxjs.jpg\" />\n</div>\n\n\n#### Fundebug为什么监测小程序？\n\n程序员通常是比较自信的，他们坚持**自己写的代码没有问题**。然而，再追问一下自己：\n\n- 我的代码真的100%没有问题吗？\n- 我做了完整的测试吗？\n- 难道我要花更多的时间没完没了的写单元测试？\n\n有时，用户打开某个页面是空白的：\n\n<div style=\"text-align: center;\">\n<img style=\"width:40%;\" src=\"fundebug-support-wxjs/empty.png\" />\n</div>\n\n然后，用户转身离开了:(\n\n**那么问题在哪？**\n\n- 小程序在用户的手机上出错了，可是开发者不知道啊；\n- 当有用户反馈问题的时候，其实更多用户已经被坑了啊；\n- 知道出问题了，然而开发者没有出错信息，无从下手啊；\n\n#### 为什么是Fundebug？\n\n- 小程序在用户的手机上出错了，Fundebug第一时间通过邮件提醒开发者；\n- Fundebug提供详细的出错信息和强大的错误管理面板，帮助开发者快速解决错误；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 两行代码搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n#### 如何使用Fundebug?\n\n##### 1. 下载Fundebug微信小程序插件<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download>fundebug.0.0.3.min.js</a>\n\n微信小程序不支持导入外部JavaScript文件，因此需要手动下载，然后放到项目目录内。\n\n##### 2. 在`app.js`中引入fundebug并配置`apikey`:\n\n```js\nvar fundebug = require('./libs/fundebug.0.0.3.min.js')\nfundebug.apikey = \"API-KEY\";\n```\n\n- `./libs/fundebug.0.0.3.min.js`为相对于`app.js`的路径 。\n- 获取**apiKey需要**[免费注册](https://fundebug.com/team/create)帐号并且[创建项目](https://fundebug.com/project/create)。\n\n##### 3. 将[https://fundebug.com](https://fundebug.com)添加到**request合法域名**\n\n具体步骤请查看[Fundebug文档](https://docs.fundebug.com/notifier/wxjs/)\n","source":"_posts/2017/01/23/fundebug-support-wxjs.md","raw":"---\ntitle: Fundebug上线小程序错误监控啦\n\ndate: 2017-01-23 09:00:00\n\ntags: [Fundebug, 小程序]\n---\n\n作为专业的JavaSript错误实时监测平台，[Fundebug](https://fundebug.com/)的**微信小程序实时错误监测服务**上线啦，我们能够帮助开发者及时，高效地发现并且解决小程序错误，从而提升用户体验。\n\n<!-- more -->\n\n#### 小程序大时代\n\n后移动互联网时代，创业者们纠结于开发APP还是公众号，而小程序的横空出世，让大家多了一种选择，也给未来增加了更多想象空间。\n\n小程序，正如它的名字，可以理解为迷你版的APP；它生根于微信帝国，因此也可以看作升级版的公众号。准确的说，小程序介于APP的灵活与公众号的轻巧之间，符合国人对中庸之道的信仰。对于那些低频，简单的工具类应用，小程序应该是一个不错的选择。\n\n从技术角度理解，小程序=**WXML + WXSS + JavaScrip**。WXML与WXSS只不过是换了个马甲的HTML与CSS，而JavaScript还是那个无处不在的JavaScript。或者说，小程序就是定制版的**HTML + CSS + JavaScript**。对于开发者，小程序没有什么神奇之处，不过是写几个简单的网页罢了。\n\n如果说小程序预示着一个应用轻型化的小时代，那么JavaScript正在开创属于它的大时代，从网页，到后端，到小程序，到APP以及智能硬件...\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-wxjs/fundebug-wxjs.jpg\" />\n</div>\n\n\n#### Fundebug为什么监测小程序？\n\n程序员通常是比较自信的，他们坚持**自己写的代码没有问题**。然而，再追问一下自己：\n\n- 我的代码真的100%没有问题吗？\n- 我做了完整的测试吗？\n- 难道我要花更多的时间没完没了的写单元测试？\n\n有时，用户打开某个页面是空白的：\n\n<div style=\"text-align: center;\">\n<img style=\"width:40%;\" src=\"fundebug-support-wxjs/empty.png\" />\n</div>\n\n然后，用户转身离开了:(\n\n**那么问题在哪？**\n\n- 小程序在用户的手机上出错了，可是开发者不知道啊；\n- 当有用户反馈问题的时候，其实更多用户已经被坑了啊；\n- 知道出问题了，然而开发者没有出错信息，无从下手啊；\n\n#### 为什么是Fundebug？\n\n- 小程序在用户的手机上出错了，Fundebug第一时间通过邮件提醒开发者；\n- Fundebug提供详细的出错信息和强大的错误管理面板，帮助开发者快速解决错误；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 两行代码搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n#### 如何使用Fundebug?\n\n##### 1. 下载Fundebug微信小程序插件<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download>fundebug.0.0.3.min.js</a>\n\n微信小程序不支持导入外部JavaScript文件，因此需要手动下载，然后放到项目目录内。\n\n##### 2. 在`app.js`中引入fundebug并配置`apikey`:\n\n```js\nvar fundebug = require('./libs/fundebug.0.0.3.min.js')\nfundebug.apikey = \"API-KEY\";\n```\n\n- `./libs/fundebug.0.0.3.min.js`为相对于`app.js`的路径 。\n- 获取**apiKey需要**[免费注册](https://fundebug.com/team/create)帐号并且[创建项目](https://fundebug.com/project/create)。\n\n##### 3. 将[https://fundebug.com](https://fundebug.com)添加到**request合法域名**\n\n具体步骤请查看[Fundebug文档](https://docs.fundebug.com/notifier/wxjs/)\n","slug":"2017/01/23/fundebug-support-wxjs","published":1,"updated":"2017-02-13T00:44:31.000Z","_id":"ciz3dhzwg001divfy7ulcmja0","comments":1,"layout":"post","photos":[],"link":"","content":"<p>&#x4F5C;&#x4E3A;&#x4E13;&#x4E1A;&#x7684;JavaSript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;<strong>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x670D;&#x52A1;</strong>&#x4E0A;&#x7EBF;&#x5566;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x53CA;&#x65F6;&#xFF0C;&#x9AD8;&#x6548;&#x5730;&#x53D1;&#x73B0;&#x5E76;&#x4E14;&#x89E3;&#x51B3;&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<a id=\"more\"></a>\n<h4 id=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"><a href=\"#&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\" class=\"headerlink\" title=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"></a>&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;</h4><p>&#x540E;&#x79FB;&#x52A8;&#x4E92;&#x8054;&#x7F51;&#x65F6;&#x4EE3;&#xFF0C;&#x521B;&#x4E1A;&#x8005;&#x4EEC;&#x7EA0;&#x7ED3;&#x4E8E;&#x5F00;&#x53D1;APP&#x8FD8;&#x662F;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x800C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x591A;&#x4E86;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#xFF0C;&#x4E5F;&#x7ED9;&#x672A;&#x6765;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x60F3;&#x8C61;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6B63;&#x5982;&#x5B83;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x8FF7;&#x4F60;&#x7248;&#x7684;APP&#xFF1B;&#x5B83;&#x751F;&#x6839;&#x4E8E;&#x5FAE;&#x4FE1;&#x5E1D;&#x56FD;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x5347;&#x7EA7;&#x7248;&#x7684;&#x516C;&#x4F17;&#x53F7;&#x3002;&#x51C6;&#x786E;&#x7684;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x4ECB;&#x4E8E;APP&#x7684;&#x7075;&#x6D3B;&#x4E0E;&#x516C;&#x4F17;&#x53F7;&#x7684;&#x8F7B;&#x5DE7;&#x4E4B;&#x95F4;&#xFF0C;&#x7B26;&#x5408;&#x56FD;&#x4EBA;&#x5BF9;&#x4E2D;&#x5EB8;&#x4E4B;&#x9053;&#x7684;&#x4FE1;&#x4EF0;&#x3002;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x4F4E;&#x9891;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#x5E94;&#x7528;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x4ECE;&#x6280;&#x672F;&#x89D2;&#x5EA6;&#x7406;&#x89E3;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;=<strong>WXML + WXSS + JavaScrip</strong>&#x3002;WXML&#x4E0E;WXSS&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x6362;&#x4E86;&#x4E2A;&#x9A6C;&#x7532;&#x7684;HTML&#x4E0E;CSS&#xFF0C;&#x800C;JavaScript&#x8FD8;&#x662F;&#x90A3;&#x4E2A;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#x7684;JavaScript&#x3002;&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;&#x5B9A;&#x5236;&#x7248;&#x7684;<strong>HTML + CSS + JavaScript</strong>&#x3002;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x795E;&#x5947;&#x4E4B;&#x5904;&#xFF0C;&#x4E0D;&#x8FC7;&#x662F;&#x5199;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x9875;&#x7F62;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x8BF4;&#x5C0F;&#x7A0B;&#x5E8F;&#x9884;&#x793A;&#x7740;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x8F7B;&#x578B;&#x5316;&#x7684;&#x5C0F;&#x65F6;&#x4EE3;&#xFF0C;&#x90A3;&#x4E48;JavaScript&#x6B63;&#x5728;&#x5F00;&#x521B;&#x5C5E;&#x4E8E;&#x5B83;&#x7684;&#x5927;&#x65F6;&#x4EE3;&#xFF0C;&#x4ECE;&#x7F51;&#x9875;&#xFF0C;&#x5230;&#x540E;&#x7AEF;&#xFF0C;&#x5230;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x5230;APP&#x4EE5;&#x53CA;&#x667A;&#x80FD;&#x786C;&#x4EF6;&#x2026;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg\"><br></div>\n\n\n<h4 id=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"><a href=\"#Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\" class=\"headerlink\" title=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"></a>Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;</h4><p>&#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x662F;&#x6BD4;&#x8F83;&#x81EA;&#x4FE1;&#x7684;&#xFF0C;&#x4ED6;&#x4EEC;&#x575A;&#x6301;<strong>&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x95EE;&#x9898;</strong>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x518D;&#x8FFD;&#x95EE;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#xFF1A;</p>\n<ul>\n<li>&#x6211;&#x7684;&#x4EE3;&#x7801;&#x771F;&#x7684;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x5417;&#xFF1F;</li>\n<li>&#x6211;&#x505A;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x6D4B;&#x8BD5;&#x5417;&#xFF1F;</li>\n<li>&#x96BE;&#x9053;&#x6211;&#x8981;&#x82B1;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x7684;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</li>\n</ul>\n<p>&#x6709;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x6253;&#x5F00;&#x67D0;&#x4E2A;&#x9875;&#x9762;&#x662F;&#x7A7A;&#x767D;&#x7684;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:40%;\" src=\"/2017/01/23/fundebug-support-wxjs/empty.png\"><br></div>\n\n<p>&#x7136;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x8F6C;&#x8EAB;&#x79BB;&#x5F00;&#x4E86;:(</p>\n<p><strong>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5728;&#x54EA;&#xFF1F;</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x77E5;&#x9053;&#x554A;&#xFF1B;</li>\n<li>&#x5F53;&#x6709;&#x7528;&#x6237;&#x53CD;&#x9988;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x66F4;&#x591A;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x88AB;&#x5751;&#x4E86;&#x554A;&#xFF1B;</li>\n<li>&#x77E5;&#x9053;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x6CA1;&#x6709;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#x554A;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;</h4><ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;Fundebug&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>Fundebug&#x63D0;&#x4F9B;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x9519;&#x8BEF;&#x7BA1;&#x7406;&#x9762;&#x677F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x5FEB;&#x901F;&#x89E3;&#x51B3;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<h4 id=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\"><a href=\"#&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?\"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?</h4><h5 id=\"1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\"><a href=\"#1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug.0.0.3.min.js\"></a>1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download=\"\" target=\"_blank\" rel=\"external\">fundebug.0.0.3.min.js</a></h5><p>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0D;&#x652F;&#x6301;&#x5BFC;&#x5165;&#x5916;&#x90E8;JavaScript&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4E0B;&#x8F7D;&#xFF0C;&#x7136;&#x540E;&#x653E;&#x5230;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x5185;&#x3002;</p>\n<h5 id=\"2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\"><a href=\"#2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\" class=\"headerlink\" title=\"2. &#x5728;app.js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:\"></a>2. &#x5728;<code>app.js</code>&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;<code>apikey</code>:</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fundebug = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;./libs/fundebug.0.0.3.min.js&apos;</span>)</div><div class=\"line\">fundebug.apikey = <span class=\"string\">&quot;API-KEY&quot;</span>;</div></pre></td></tr></table></figure>\n<ul>\n<li><code>./libs/fundebug.0.0.3.min.js</code>&#x4E3A;&#x76F8;&#x5BF9;&#x4E8E;<code>app.js</code>&#x7684;&#x8DEF;&#x5F84; &#x3002;</li>\n<li>&#x83B7;&#x53D6;<strong>apiKey&#x9700;&#x8981;</strong><a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5E10;&#x53F7;&#x5E76;&#x4E14;<a href=\"https://fundebug.com/project/create\" target=\"_blank\" rel=\"external\">&#x521B;&#x5EFA;&#x9879;&#x76EE;</a>&#x3002;</li>\n</ul>\n<h5 id=\"3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"><a href=\"#3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\" class=\"headerlink\" title=\"3. &#x5C06;https://fundebug.com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"></a>3. &#x5C06;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">https://fundebug.com</a>&#x6DFB;&#x52A0;&#x5230;<strong>request&#x5408;&#x6CD5;&#x57DF;&#x540D;</strong></h5><p>&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/wxjs/\" target=\"_blank\" rel=\"external\">Fundebug&#x6587;&#x6863;</a></p>\n","excerpt":"<p>&#x4F5C;&#x4E3A;&#x4E13;&#x4E1A;&#x7684;JavaSript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;<a href=\"https://fundebug.com/\">Fundebug</a>&#x7684;<strong>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x670D;&#x52A1;</strong>&#x4E0A;&#x7EBF;&#x5566;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x53CA;&#x65F6;&#xFF0C;&#x9AD8;&#x6548;&#x5730;&#x53D1;&#x73B0;&#x5E76;&#x4E14;&#x89E3;&#x51B3;&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>","more":"<h4 id=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"><a href=\"#&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\" class=\"headerlink\" title=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"></a>&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;</h4><p>&#x540E;&#x79FB;&#x52A8;&#x4E92;&#x8054;&#x7F51;&#x65F6;&#x4EE3;&#xFF0C;&#x521B;&#x4E1A;&#x8005;&#x4EEC;&#x7EA0;&#x7ED3;&#x4E8E;&#x5F00;&#x53D1;APP&#x8FD8;&#x662F;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x800C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x591A;&#x4E86;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#xFF0C;&#x4E5F;&#x7ED9;&#x672A;&#x6765;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x60F3;&#x8C61;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6B63;&#x5982;&#x5B83;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x8FF7;&#x4F60;&#x7248;&#x7684;APP&#xFF1B;&#x5B83;&#x751F;&#x6839;&#x4E8E;&#x5FAE;&#x4FE1;&#x5E1D;&#x56FD;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x5347;&#x7EA7;&#x7248;&#x7684;&#x516C;&#x4F17;&#x53F7;&#x3002;&#x51C6;&#x786E;&#x7684;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x4ECB;&#x4E8E;APP&#x7684;&#x7075;&#x6D3B;&#x4E0E;&#x516C;&#x4F17;&#x53F7;&#x7684;&#x8F7B;&#x5DE7;&#x4E4B;&#x95F4;&#xFF0C;&#x7B26;&#x5408;&#x56FD;&#x4EBA;&#x5BF9;&#x4E2D;&#x5EB8;&#x4E4B;&#x9053;&#x7684;&#x4FE1;&#x4EF0;&#x3002;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x4F4E;&#x9891;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#x5E94;&#x7528;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x4ECE;&#x6280;&#x672F;&#x89D2;&#x5EA6;&#x7406;&#x89E3;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;=<strong>WXML + WXSS + JavaScrip</strong>&#x3002;WXML&#x4E0E;WXSS&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x6362;&#x4E86;&#x4E2A;&#x9A6C;&#x7532;&#x7684;HTML&#x4E0E;CSS&#xFF0C;&#x800C;JavaScript&#x8FD8;&#x662F;&#x90A3;&#x4E2A;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#x7684;JavaScript&#x3002;&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;&#x5B9A;&#x5236;&#x7248;&#x7684;<strong>HTML + CSS + JavaScript</strong>&#x3002;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x795E;&#x5947;&#x4E4B;&#x5904;&#xFF0C;&#x4E0D;&#x8FC7;&#x662F;&#x5199;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x9875;&#x7F62;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x8BF4;&#x5C0F;&#x7A0B;&#x5E8F;&#x9884;&#x793A;&#x7740;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x8F7B;&#x578B;&#x5316;&#x7684;&#x5C0F;&#x65F6;&#x4EE3;&#xFF0C;&#x90A3;&#x4E48;JavaScript&#x6B63;&#x5728;&#x5F00;&#x521B;&#x5C5E;&#x4E8E;&#x5B83;&#x7684;&#x5927;&#x65F6;&#x4EE3;&#xFF0C;&#x4ECE;&#x7F51;&#x9875;&#xFF0C;&#x5230;&#x540E;&#x7AEF;&#xFF0C;&#x5230;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x5230;APP&#x4EE5;&#x53CA;&#x667A;&#x80FD;&#x786C;&#x4EF6;&#x2026;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg\"><br></div>\n\n\n<h4 id=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"><a href=\"#Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\" class=\"headerlink\" title=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"></a>Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;</h4><p>&#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x662F;&#x6BD4;&#x8F83;&#x81EA;&#x4FE1;&#x7684;&#xFF0C;&#x4ED6;&#x4EEC;&#x575A;&#x6301;<strong>&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x95EE;&#x9898;</strong>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x518D;&#x8FFD;&#x95EE;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#xFF1A;</p>\n<ul>\n<li>&#x6211;&#x7684;&#x4EE3;&#x7801;&#x771F;&#x7684;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x5417;&#xFF1F;</li>\n<li>&#x6211;&#x505A;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x6D4B;&#x8BD5;&#x5417;&#xFF1F;</li>\n<li>&#x96BE;&#x9053;&#x6211;&#x8981;&#x82B1;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x7684;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</li>\n</ul>\n<p>&#x6709;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x6253;&#x5F00;&#x67D0;&#x4E2A;&#x9875;&#x9762;&#x662F;&#x7A7A;&#x767D;&#x7684;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:40%;\" src=\"/2017/01/23/fundebug-support-wxjs/empty.png\"><br></div>\n\n<p>&#x7136;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x8F6C;&#x8EAB;&#x79BB;&#x5F00;&#x4E86;:(</p>\n<p><strong>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5728;&#x54EA;&#xFF1F;</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x77E5;&#x9053;&#x554A;&#xFF1B;</li>\n<li>&#x5F53;&#x6709;&#x7528;&#x6237;&#x53CD;&#x9988;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x66F4;&#x591A;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x88AB;&#x5751;&#x4E86;&#x554A;&#xFF1B;</li>\n<li>&#x77E5;&#x9053;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x6CA1;&#x6709;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#x554A;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;</h4><ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;Fundebug&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>Fundebug&#x63D0;&#x4F9B;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x9519;&#x8BEF;&#x7BA1;&#x7406;&#x9762;&#x677F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x5FEB;&#x901F;&#x89E3;&#x51B3;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<h4 id=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\"><a href=\"#&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?\"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?</h4><h5 id=\"1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\"><a href=\"#1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug.0.0.3.min.js\"></a>1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download=\"\">fundebug.0.0.3.min.js</a></h5><p>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0D;&#x652F;&#x6301;&#x5BFC;&#x5165;&#x5916;&#x90E8;JavaScript&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4E0B;&#x8F7D;&#xFF0C;&#x7136;&#x540E;&#x653E;&#x5230;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x5185;&#x3002;</p>\n<h5 id=\"2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\"><a href=\"#2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\" class=\"headerlink\" title=\"2. &#x5728;app.js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:\"></a>2. &#x5728;<code>app.js</code>&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;<code>apikey</code>:</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fundebug = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;./libs/fundebug.0.0.3.min.js&apos;</span>)</div><div class=\"line\">fundebug.apikey = <span class=\"string\">&quot;API-KEY&quot;</span>;</div></pre></td></tr></table></figure>\n<ul>\n<li><code>./libs/fundebug.0.0.3.min.js</code>&#x4E3A;&#x76F8;&#x5BF9;&#x4E8E;<code>app.js</code>&#x7684;&#x8DEF;&#x5F84; &#x3002;</li>\n<li>&#x83B7;&#x53D6;<strong>apiKey&#x9700;&#x8981;</strong><a href=\"https://fundebug.com/team/create\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5E10;&#x53F7;&#x5E76;&#x4E14;<a href=\"https://fundebug.com/project/create\">&#x521B;&#x5EFA;&#x9879;&#x76EE;</a>&#x3002;</li>\n</ul>\n<h5 id=\"3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"><a href=\"#3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\" class=\"headerlink\" title=\"3. &#x5C06;https://fundebug.com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"></a>3. &#x5C06;<a href=\"https://fundebug.com\">https://fundebug.com</a>&#x6DFB;&#x52A0;&#x5230;<strong>request&#x5408;&#x6CD5;&#x57DF;&#x540D;</strong></h5><p>&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/wxjs/\">Fundebug&#x6587;&#x6863;</a></p>"},{"title":"有浏览器的地方就有Fundebug","date":"2017-01-16T01:00:00.000Z","_content":"\n[Fundebug](https://fundebug.com)已经全面支持主流浏览器啦！\n\n对于前端开发者，兼容各种浏览器是一件非常痛苦的事情。在搜索框中输入关键字**JavaScript浏览器兼容**，结果是这样的:\n\n<!-- more -->\n\n- [IE和Firefox的Javascript兼容性总结](http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html)\n- [JavaScript中浏览器兼容问题](http://www.cnblogs.com/DF-fzh/p/5408241.html)\n- [JavaScript初学者建议：不要去管浏览器兼容](http://www.ituring.com.cn/article/67234)\n- ...\n\n#### 有浏览器的地方就有Fundebug\n\n[Fundebug](https://fundebug.com)是前端JavaScript错误实时监测平台，经过大量兼容性调试，Fundebug的JavaScript监测插件已经能够在各种主流浏览器中自动捕获错误，并且可以获取最全面的错误信息，帮助开发者更快的Debug。而对于近来不怎么受待见的IE浏览器，我们也进行了全面支持，**从IE 6到IE 11**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser.jpg\" />\n</div>\n\n#### 为什么要兼容各种浏览器？\n\n根据[百度统计](http://tongji.baidu.com/data/browser)的最新数据，2016年10月份到12月份国内的浏览器份额如图所示:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser-share.png\" />\n</div>\n\n可知，用户偏好千差万别，而各版本的IE的市场份额总计为26%，仅次于Chrome。**我还有什么话可说呢？**国内主流浏览器都采用双内核机制，即兼容模式和极速模式，而所谓兼容模式，使用的是triend内核，即IE内核。\n\n作为一个自带价值观的产品，Fundebug希望**通过兼容各种浏览器帮助开发者提升用户体验**。\n\n\n#### 兼容浏览器坑在哪里？\n\n- [Error对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)的属性各有不同，例如大名鼎鼎的Chrome的Error对象木有fileName，lineNumber以及columnNumber属性;\n- [Onerror事件](https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror)的参数各有不同，例如老版本的Firefox木有columnNumber 和error参数\n- API不同，例如老版本的IE木有[JSON对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON);\n- 同一个属性名在不同浏览器的含义不同；\n- 同一个属性在不同浏览器的名称不同；\n- 国内浏览器的IE兼容模式与真正的IE也略有不同;\n- ......\n\n这些问题大概前端工程师都会深有同感吧。\n\n#### 错误智能聚合\n\n同样的代码产生的同一个错误，在不同浏览器上的报错信息是各不相同的。name不同的错误可能是同一个错误，例如**SyntaxError**与**ReferenceError**；message不同的错误可能是同一个错误，例如**can not find variable fundebug**与**fundebug is not defined**。并且，同一个错误在不同浏览器下的lineNumber，columnNumber，stack，与url都有可能不同。\n\n对于这个问题，我们对收集的错误利用机器学习算法进行了智能聚合，尽量将同一个错误聚合到一起，减少重复报警。根据我们的初步估算，目前聚合算法能够将**90%**的重复错误成功聚合，这样极大地提高了用户分析错误的效率。\n\n还等什么呢？感觉免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","source":"_posts/2017/01/16/fundebug-support-all-browsers.md","raw":"---\ntitle: 有浏览器的地方就有Fundebug\n\ndate: 2017-01-16 09:00:00\n\ntags: [Fundebug, JavaScript]\n---\n\n[Fundebug](https://fundebug.com)已经全面支持主流浏览器啦！\n\n对于前端开发者，兼容各种浏览器是一件非常痛苦的事情。在搜索框中输入关键字**JavaScript浏览器兼容**，结果是这样的:\n\n<!-- more -->\n\n- [IE和Firefox的Javascript兼容性总结](http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html)\n- [JavaScript中浏览器兼容问题](http://www.cnblogs.com/DF-fzh/p/5408241.html)\n- [JavaScript初学者建议：不要去管浏览器兼容](http://www.ituring.com.cn/article/67234)\n- ...\n\n#### 有浏览器的地方就有Fundebug\n\n[Fundebug](https://fundebug.com)是前端JavaScript错误实时监测平台，经过大量兼容性调试，Fundebug的JavaScript监测插件已经能够在各种主流浏览器中自动捕获错误，并且可以获取最全面的错误信息，帮助开发者更快的Debug。而对于近来不怎么受待见的IE浏览器，我们也进行了全面支持，**从IE 6到IE 11**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser.jpg\" />\n</div>\n\n#### 为什么要兼容各种浏览器？\n\n根据[百度统计](http://tongji.baidu.com/data/browser)的最新数据，2016年10月份到12月份国内的浏览器份额如图所示:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser-share.png\" />\n</div>\n\n可知，用户偏好千差万别，而各版本的IE的市场份额总计为26%，仅次于Chrome。**我还有什么话可说呢？**国内主流浏览器都采用双内核机制，即兼容模式和极速模式，而所谓兼容模式，使用的是triend内核，即IE内核。\n\n作为一个自带价值观的产品，Fundebug希望**通过兼容各种浏览器帮助开发者提升用户体验**。\n\n\n#### 兼容浏览器坑在哪里？\n\n- [Error对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)的属性各有不同，例如大名鼎鼎的Chrome的Error对象木有fileName，lineNumber以及columnNumber属性;\n- [Onerror事件](https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror)的参数各有不同，例如老版本的Firefox木有columnNumber 和error参数\n- API不同，例如老版本的IE木有[JSON对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON);\n- 同一个属性名在不同浏览器的含义不同；\n- 同一个属性在不同浏览器的名称不同；\n- 国内浏览器的IE兼容模式与真正的IE也略有不同;\n- ......\n\n这些问题大概前端工程师都会深有同感吧。\n\n#### 错误智能聚合\n\n同样的代码产生的同一个错误，在不同浏览器上的报错信息是各不相同的。name不同的错误可能是同一个错误，例如**SyntaxError**与**ReferenceError**；message不同的错误可能是同一个错误，例如**can not find variable fundebug**与**fundebug is not defined**。并且，同一个错误在不同浏览器下的lineNumber，columnNumber，stack，与url都有可能不同。\n\n对于这个问题，我们对收集的错误利用机器学习算法进行了智能聚合，尽量将同一个错误聚合到一起，减少重复报警。根据我们的初步估算，目前聚合算法能够将**90%**的重复错误成功聚合，这样极大地提高了用户分析错误的效率。\n\n还等什么呢？感觉免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","slug":"2017/01/16/fundebug-support-all-browsers","published":1,"updated":"2017-02-13T00:45:41.000Z","_id":"ciz3dhzwj001givfyd8s5bx3d","comments":1,"layout":"post","photos":[],"link":"","content":"<p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5DF2;&#x7ECF;&#x5168;&#x9762;&#x652F;&#x6301;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x5566;&#xFF01;</p>\n<p>&#x5BF9;&#x4E8E;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x75DB;&#x82E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5728;&#x641C;&#x7D22;&#x6846;&#x4E2D;&#x8F93;&#x5165;&#x5173;&#x952E;&#x5B57;<strong>JavaScript&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</strong>&#xFF0C;&#x7ED3;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<a id=\"more\"></a>\n<ul>\n<li><a href=\"http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html\" target=\"_blank\" rel=\"external\">IE&#x548C;Firefox&#x7684;Javascript&#x517C;&#x5BB9;&#x6027;&#x603B;&#x7ED3;</a></li>\n<li><a href=\"http://www.cnblogs.com/DF-fzh/p/5408241.html\" target=\"_blank\" rel=\"external\">JavaScript&#x4E2D;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;&#x95EE;&#x9898;</a></li>\n<li><a href=\"http://www.ituring.com.cn/article/67234\" target=\"_blank\" rel=\"external\">JavaScript&#x521D;&#x5B66;&#x8005;&#x5EFA;&#x8BAE;&#xFF1A;&#x4E0D;&#x8981;&#x53BB;&#x7BA1;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</a></li>\n<li>&#x2026;</li>\n</ul>\n<h4 id=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"><a href=\"#&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\" class=\"headerlink\" title=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"></a>&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug</h4><p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x662F;&#x524D;&#x7AEF;JavaScript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;&#x7ECF;&#x8FC7;&#x5927;&#x91CF;&#x517C;&#x5BB9;&#x6027;&#x8C03;&#x8BD5;&#xFF0C;Fundebug&#x7684;JavaScript&#x76D1;&#x6D4B;&#x63D2;&#x4EF6;&#x5DF2;&#x7ECF;&#x80FD;&#x591F;&#x5728;&#x5404;&#x79CD;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x5168;&#x9762;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;Debug&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x8FD1;&#x6765;&#x4E0D;&#x600E;&#x4E48;&#x53D7;&#x5F85;&#x89C1;&#x7684;IE&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;&#x5168;&#x9762;&#x652F;&#x6301;&#xFF0C;<strong>&#x4ECE;IE 6&#x5230;IE 11</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser.jpg\"><br></div>\n\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;</h4><p>&#x6839;&#x636E;<a href=\"http://tongji.baidu.com/data/browser\" target=\"_blank\" rel=\"external\">&#x767E;&#x5EA6;&#x7EDF;&#x8BA1;</a>&#x7684;&#x6700;&#x65B0;&#x6570;&#x636E;&#xFF0C;2016&#x5E74;10&#x6708;&#x4EFD;&#x5230;12&#x6708;&#x4EFD;&#x56FD;&#x5185;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4EFD;&#x989D;&#x5982;&#x56FE;&#x6240;&#x793A;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser-share.png\"><br></div>\n\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x7528;&#x6237;&#x504F;&#x597D;&#x5343;&#x5DEE;&#x4E07;&#x522B;&#xFF0C;&#x800C;&#x5404;&#x7248;&#x672C;&#x7684;IE&#x7684;&#x5E02;&#x573A;&#x4EFD;&#x989D;&#x603B;&#x8BA1;&#x4E3A;26%&#xFF0C;&#x4EC5;&#x6B21;&#x4E8E;Chrome&#x3002;<strong>&#x6211;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x8BDD;&#x53EF;&#x8BF4;&#x5462;&#xFF1F;</strong>&#x56FD;&#x5185;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x91C7;&#x7528;&#x53CC;&#x5185;&#x6838;&#x673A;&#x5236;&#xFF0C;&#x5373;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x548C;&#x6781;&#x901F;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x6240;&#x8C13;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;triend&#x5185;&#x6838;&#xFF0C;&#x5373;IE&#x5185;&#x6838;&#x3002;</p>\n<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x81EA;&#x5E26;&#x4EF7;&#x503C;&#x89C2;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;Fundebug&#x5E0C;&#x671B;<strong>&#x901A;&#x8FC7;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;</strong>&#x3002;</p>\n<h4 id=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"><a href=\"#&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\" class=\"headerlink\" title=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"></a>&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;</h4><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error\" target=\"_blank\" rel=\"external\">Error&#x5BF9;&#x8C61;</a>&#x7684;&#x5C5E;&#x6027;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684;Chrome&#x7684;Error&#x5BF9;&#x8C61;&#x6728;&#x6709;fileName&#xFF0C;lineNumber&#x4EE5;&#x53CA;columnNumber&#x5C5E;&#x6027;;</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror\" target=\"_blank\" rel=\"external\">Onerror&#x4E8B;&#x4EF6;</a>&#x7684;&#x53C2;&#x6570;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;Firefox&#x6728;&#x6709;columnNumber &#x548C;error&#x53C2;&#x6570;</li>\n<li>API&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;IE&#x6728;&#x6709;<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON\" target=\"_blank\" rel=\"external\">JSON&#x5BF9;&#x8C61;</a>;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x540D;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x542B;&#x4E49;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x540D;&#x79F0;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x56FD;&#x5185;&#x6D4F;&#x89C8;&#x5668;&#x7684;IE&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x4E0E;&#x771F;&#x6B63;&#x7684;IE&#x4E5F;&#x7565;&#x6709;&#x4E0D;&#x540C;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5927;&#x6982;&#x524D;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E08;&#x90FD;&#x4F1A;&#x6DF1;&#x6709;&#x540C;&#x611F;&#x5427;&#x3002;</p>\n<h4 id=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"><a href=\"#&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\" class=\"headerlink\" title=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"></a>&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;</h4><p>&#x540C;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x4EA7;&#x751F;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x3002;name&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>SyntaxError</strong>&#x4E0E;<strong>ReferenceError</strong>&#xFF1B;message&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>can not find variable fundebug</strong>&#x4E0E;<strong>fundebug is not defined</strong>&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x7684;lineNumber&#xFF0C;columnNumber&#xFF0C;stack&#xFF0C;&#x4E0E;url&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6536;&#x96C6;&#x7684;&#x9519;&#x8BEF;&#x5229;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x4E86;&#x667A;&#x80FD;&#x805A;&#x5408;&#xFF0C;&#x5C3D;&#x91CF;&#x5C06;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x805A;&#x5408;&#x5230;&#x4E00;&#x8D77;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x62A5;&#x8B66;&#x3002;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x521D;&#x6B65;&#x4F30;&#x7B97;&#xFF0C;&#x76EE;&#x524D;&#x805A;&#x5408;&#x7B97;&#x6CD5;&#x80FD;&#x591F;&#x5C06;<strong>90%</strong>&#x7684;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#x6210;&#x529F;&#x805A;&#x5408;&#xFF0C;&#x8FD9;&#x6837;&#x6781;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x4E86;&#x7528;&#x6237;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x611F;&#x89C9;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n\n","excerpt":"<p><a href=\"https://fundebug.com\">Fundebug</a>&#x5DF2;&#x7ECF;&#x5168;&#x9762;&#x652F;&#x6301;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x5566;&#xFF01;</p>\n<p>&#x5BF9;&#x4E8E;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x75DB;&#x82E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5728;&#x641C;&#x7D22;&#x6846;&#x4E2D;&#x8F93;&#x5165;&#x5173;&#x952E;&#x5B57;<strong>JavaScript&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</strong>&#xFF0C;&#x7ED3;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>","more":"<ul>\n<li><a href=\"http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html\">IE&#x548C;Firefox&#x7684;Javascript&#x517C;&#x5BB9;&#x6027;&#x603B;&#x7ED3;</a></li>\n<li><a href=\"http://www.cnblogs.com/DF-fzh/p/5408241.html\">JavaScript&#x4E2D;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;&#x95EE;&#x9898;</a></li>\n<li><a href=\"http://www.ituring.com.cn/article/67234\">JavaScript&#x521D;&#x5B66;&#x8005;&#x5EFA;&#x8BAE;&#xFF1A;&#x4E0D;&#x8981;&#x53BB;&#x7BA1;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</a></li>\n<li>&#x2026;</li>\n</ul>\n<h4 id=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"><a href=\"#&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\" class=\"headerlink\" title=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"></a>&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug</h4><p><a href=\"https://fundebug.com\">Fundebug</a>&#x662F;&#x524D;&#x7AEF;JavaScript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;&#x7ECF;&#x8FC7;&#x5927;&#x91CF;&#x517C;&#x5BB9;&#x6027;&#x8C03;&#x8BD5;&#xFF0C;Fundebug&#x7684;JavaScript&#x76D1;&#x6D4B;&#x63D2;&#x4EF6;&#x5DF2;&#x7ECF;&#x80FD;&#x591F;&#x5728;&#x5404;&#x79CD;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x5168;&#x9762;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;Debug&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x8FD1;&#x6765;&#x4E0D;&#x600E;&#x4E48;&#x53D7;&#x5F85;&#x89C1;&#x7684;IE&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;&#x5168;&#x9762;&#x652F;&#x6301;&#xFF0C;<strong>&#x4ECE;IE 6&#x5230;IE 11</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser.jpg\"><br></div>\n\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;</h4><p>&#x6839;&#x636E;<a href=\"http://tongji.baidu.com/data/browser\">&#x767E;&#x5EA6;&#x7EDF;&#x8BA1;</a>&#x7684;&#x6700;&#x65B0;&#x6570;&#x636E;&#xFF0C;2016&#x5E74;10&#x6708;&#x4EFD;&#x5230;12&#x6708;&#x4EFD;&#x56FD;&#x5185;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4EFD;&#x989D;&#x5982;&#x56FE;&#x6240;&#x793A;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser-share.png\"><br></div>\n\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x7528;&#x6237;&#x504F;&#x597D;&#x5343;&#x5DEE;&#x4E07;&#x522B;&#xFF0C;&#x800C;&#x5404;&#x7248;&#x672C;&#x7684;IE&#x7684;&#x5E02;&#x573A;&#x4EFD;&#x989D;&#x603B;&#x8BA1;&#x4E3A;26%&#xFF0C;&#x4EC5;&#x6B21;&#x4E8E;Chrome&#x3002;<strong>&#x6211;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x8BDD;&#x53EF;&#x8BF4;&#x5462;&#xFF1F;</strong>&#x56FD;&#x5185;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x91C7;&#x7528;&#x53CC;&#x5185;&#x6838;&#x673A;&#x5236;&#xFF0C;&#x5373;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x548C;&#x6781;&#x901F;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x6240;&#x8C13;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;triend&#x5185;&#x6838;&#xFF0C;&#x5373;IE&#x5185;&#x6838;&#x3002;</p>\n<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x81EA;&#x5E26;&#x4EF7;&#x503C;&#x89C2;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;Fundebug&#x5E0C;&#x671B;<strong>&#x901A;&#x8FC7;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;</strong>&#x3002;</p>\n<h4 id=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"><a href=\"#&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\" class=\"headerlink\" title=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"></a>&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;</h4><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error\">Error&#x5BF9;&#x8C61;</a>&#x7684;&#x5C5E;&#x6027;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684;Chrome&#x7684;Error&#x5BF9;&#x8C61;&#x6728;&#x6709;fileName&#xFF0C;lineNumber&#x4EE5;&#x53CA;columnNumber&#x5C5E;&#x6027;;</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror\">Onerror&#x4E8B;&#x4EF6;</a>&#x7684;&#x53C2;&#x6570;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;Firefox&#x6728;&#x6709;columnNumber &#x548C;error&#x53C2;&#x6570;</li>\n<li>API&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;IE&#x6728;&#x6709;<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON\">JSON&#x5BF9;&#x8C61;</a>;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x540D;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x542B;&#x4E49;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x540D;&#x79F0;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x56FD;&#x5185;&#x6D4F;&#x89C8;&#x5668;&#x7684;IE&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x4E0E;&#x771F;&#x6B63;&#x7684;IE&#x4E5F;&#x7565;&#x6709;&#x4E0D;&#x540C;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5927;&#x6982;&#x524D;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E08;&#x90FD;&#x4F1A;&#x6DF1;&#x6709;&#x540C;&#x611F;&#x5427;&#x3002;</p>\n<h4 id=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"><a href=\"#&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\" class=\"headerlink\" title=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"></a>&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;</h4><p>&#x540C;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x4EA7;&#x751F;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x3002;name&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>SyntaxError</strong>&#x4E0E;<strong>ReferenceError</strong>&#xFF1B;message&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>can not find variable fundebug</strong>&#x4E0E;<strong>fundebug is not defined</strong>&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x7684;lineNumber&#xFF0C;columnNumber&#xFF0C;stack&#xFF0C;&#x4E0E;url&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6536;&#x96C6;&#x7684;&#x9519;&#x8BEF;&#x5229;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x4E86;&#x667A;&#x80FD;&#x805A;&#x5408;&#xFF0C;&#x5C3D;&#x91CF;&#x5C06;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x805A;&#x5408;&#x5230;&#x4E00;&#x8D77;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x62A5;&#x8B66;&#x3002;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x521D;&#x6B65;&#x4F30;&#x7B97;&#xFF0C;&#x76EE;&#x524D;&#x805A;&#x5408;&#x7B97;&#x6CD5;&#x80FD;&#x591F;&#x5C06;<strong>90%</strong>&#x7684;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#x6210;&#x529F;&#x805A;&#x5408;&#xFF0C;&#x8FD9;&#x6837;&#x6781;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x4E86;&#x7528;&#x6237;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x611F;&#x89C9;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"Fundebug专业为小程序踩坑","date":"2017-02-11T01:00:00.000Z","_content":"\n1月9日微信小程序上线，距离现在仅仅一个月，然而开发者们已经遇到了很多坑:\n\n<!-- more -->\n\n- [一名Android开发者的微信小程序填坑之路(1) - CSDN](http://blog.csdn.net/luoyanglizi/article/details/52681245)\n- [微信小程序坑集 - 博客园](http://www.cnblogs.com/dudeyouth/p/6277628.html)\n- [吐槽小程序开发踩过的坑, 以及一些解决方法 - 简书](http://www.jianshu.com/p/6359500b5576)\n- [微信小程序的坑, 你踩了么？- 知乎](https://www.zhihu.com/question/51145570?sort=created)\n- [微信小程序常见问题集合 - 微信小程序联盟](http://www.wxapp-union.com/thread-23-1-1.html)\n- ......\n\n#### 微信小程序兼容性问题\n\n小程序依托于微信，似乎天然拥有跨平台的优势。也就是说，开发者只需要开发一套代码，就可以完美运行在Android与iOS上。但是事实上，                                                                             小程序的兼容性问题往往会导致各种BUG。\n\n例1，在[微信小程序兼容性问题](http://www.jianshu.com/p/90220a55f542)中，博主有提到一个实例:\n> wx.request()返回的状态码statusCode在iOS下是Int，而在Android上却是String。如果判断statusCode的方法不当，可能就踩到坑里了。\n\n例2，在[微信小程序踩坑之wx.uploadFile](http://www.henkuai.com/thread-17813-1-1.html)中，楼主发现旧版本的微信会出错:\n> iOS可以上传文件，Android必须将微信升级到6.5.2版本以上才能上传文件。\n\n例3，在[一个有关二维码扫码的奇怪的问题](http://www.wxapp-union.com/forum.php?mod=viewthread&tid=2122&highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98)中，楼主遇到了一个ES 6的兼容性问题:\n> 开发工具和高版本的iOS支持[startsWith](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)，然而在iOS 8和Android不支持startsWith。\n\n为什么会这样呢？不妨学习一下[官方文档](https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html)吧: \n\n> - 在开发工具上， 小程序的JS代码是运行在nwjs中\n- 在iOS上，小程序的JS代码是运行在JavaScriptCore 中\n- 在Android上，小程序的JS代码是通过X5 JSCore来解析\n \n开发工具，iOS与Andriod的JavaScript脚本执行环境各不相同，所以存在兼容性问题也就不难理解了。开发工具上运行成功的代码，在iOS上未必能够运行成功，而在iOS上运行成功的代码，在Andriod上也可能会出错。\n\n另外，开发工具，iOS与Andriod上的微信本身代码也不一样，因此也会导致一些问题。\n\n#### Fundebug小程序错误监测\n\n更麻烦的是，测试并不能完全保证代码完全正确，一方面逐个测试各种手机是不现实的，另一方面，开发者很难全面考虑各种真实场景。\n\nFundebug能够实时监测小程序，捕获小程序Bug，然后反馈给开发者。这样，开发者可以及时发现并解决问题，提升用户体验。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\" />\n</div>\n\n**Fundebug的优势:**\n\n- 小程序在用户的手机上出错了，第一时间提醒开发者；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 添加两行代码，2分钟搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n\n使用方法请参考[微信小程序文档](https://docs.fundebug.com/notifier/wxjs/)。\n\n\n还等什么呢？赶紧免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n","source":"_posts/2017/02/11/weixin-miniprogram-need-fundebug.md","raw":"---\ntitle: Fundebug专业为小程序踩坑\n\ndate: 2017-02-11 09:00:00\n\ntags: [Fundebug, 小程序]\n---\n\n1月9日微信小程序上线，距离现在仅仅一个月，然而开发者们已经遇到了很多坑:\n\n<!-- more -->\n\n- [一名Android开发者的微信小程序填坑之路(1) - CSDN](http://blog.csdn.net/luoyanglizi/article/details/52681245)\n- [微信小程序坑集 - 博客园](http://www.cnblogs.com/dudeyouth/p/6277628.html)\n- [吐槽小程序开发踩过的坑, 以及一些解决方法 - 简书](http://www.jianshu.com/p/6359500b5576)\n- [微信小程序的坑, 你踩了么？- 知乎](https://www.zhihu.com/question/51145570?sort=created)\n- [微信小程序常见问题集合 - 微信小程序联盟](http://www.wxapp-union.com/thread-23-1-1.html)\n- ......\n\n#### 微信小程序兼容性问题\n\n小程序依托于微信，似乎天然拥有跨平台的优势。也就是说，开发者只需要开发一套代码，就可以完美运行在Android与iOS上。但是事实上，                                                                             小程序的兼容性问题往往会导致各种BUG。\n\n例1，在[微信小程序兼容性问题](http://www.jianshu.com/p/90220a55f542)中，博主有提到一个实例:\n> wx.request()返回的状态码statusCode在iOS下是Int，而在Android上却是String。如果判断statusCode的方法不当，可能就踩到坑里了。\n\n例2，在[微信小程序踩坑之wx.uploadFile](http://www.henkuai.com/thread-17813-1-1.html)中，楼主发现旧版本的微信会出错:\n> iOS可以上传文件，Android必须将微信升级到6.5.2版本以上才能上传文件。\n\n例3，在[一个有关二维码扫码的奇怪的问题](http://www.wxapp-union.com/forum.php?mod=viewthread&tid=2122&highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98)中，楼主遇到了一个ES 6的兼容性问题:\n> 开发工具和高版本的iOS支持[startsWith](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)，然而在iOS 8和Android不支持startsWith。\n\n为什么会这样呢？不妨学习一下[官方文档](https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html)吧: \n\n> - 在开发工具上， 小程序的JS代码是运行在nwjs中\n- 在iOS上，小程序的JS代码是运行在JavaScriptCore 中\n- 在Android上，小程序的JS代码是通过X5 JSCore来解析\n \n开发工具，iOS与Andriod的JavaScript脚本执行环境各不相同，所以存在兼容性问题也就不难理解了。开发工具上运行成功的代码，在iOS上未必能够运行成功，而在iOS上运行成功的代码，在Andriod上也可能会出错。\n\n另外，开发工具，iOS与Andriod上的微信本身代码也不一样，因此也会导致一些问题。\n\n#### Fundebug小程序错误监测\n\n更麻烦的是，测试并不能完全保证代码完全正确，一方面逐个测试各种手机是不现实的，另一方面，开发者很难全面考虑各种真实场景。\n\nFundebug能够实时监测小程序，捕获小程序Bug，然后反馈给开发者。这样，开发者可以及时发现并解决问题，提升用户体验。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\" />\n</div>\n\n**Fundebug的优势:**\n\n- 小程序在用户的手机上出错了，第一时间提醒开发者；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 添加两行代码，2分钟搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n\n使用方法请参考[微信小程序文档](https://docs.fundebug.com/notifier/wxjs/)。\n\n\n还等什么呢？赶紧免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n","slug":"2017/02/11/weixin-miniprogram-need-fundebug","published":1,"updated":"2017-02-13T00:43:58.000Z","_id":"ciz3dhzwl001iivfykg0dsa5r","comments":1,"layout":"post","photos":[],"link":"","content":"<p>1&#x6708;9&#x65E5;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0A;&#x7EBF;&#xFF0C;&#x8DDD;&#x79BB;&#x73B0;&#x5728;&#x4EC5;&#x4EC5;&#x4E00;&#x4E2A;&#x6708;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x4EEC;&#x5DF2;&#x7ECF;&#x9047;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5751;:</p>\n<a id=\"more\"></a>\n<ul>\n<li><a href=\"http://blog.csdn.net/luoyanglizi/article/details/52681245\" target=\"_blank\" rel=\"external\">&#x4E00;&#x540D;Android&#x5F00;&#x53D1;&#x8005;&#x7684;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x586B;&#x5751;&#x4E4B;&#x8DEF;(1) - CSDN</a></li>\n<li><a href=\"http://www.cnblogs.com/dudeyouth/p/6277628.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5751;&#x96C6; - &#x535A;&#x5BA2;&#x56ED;</a></li>\n<li><a href=\"http://www.jianshu.com/p/6359500b5576\" target=\"_blank\" rel=\"external\">&#x5410;&#x69FD;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8E29;&#x8FC7;&#x7684;&#x5751;, &#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5; - &#x7B80;&#x4E66;</a></li>\n<li><a href=\"https://www.zhihu.com/question/51145570?sort=created\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x5751;, &#x4F60;&#x8E29;&#x4E86;&#x4E48;&#xFF1F;- &#x77E5;&#x4E4E;</a></li>\n<li><a href=\"http://www.wxapp-union.com/thread-23-1-1.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x96C6;&#x5408; - &#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8054;&#x76DF;</a></li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<h4 id=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"><a href=\"#&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"></a>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</h4><p>&#x5C0F;&#x7A0B;&#x5E8F;&#x4F9D;&#x6258;&#x4E8E;&#x5FAE;&#x4FE1;&#xFF0C;&#x4F3C;&#x4E4E;&#x5929;&#x7136;&#x62E5;&#x6709;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x4F18;&#x52BF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EA;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x4E00;&#x5957;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x5728;Android&#x4E0E;iOS&#x4E0A;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;                                                                             &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x5F80;&#x5F80;&#x4F1A;&#x5BFC;&#x81F4;&#x5404;&#x79CD;BUG&#x3002;</p>\n<p>&#x4F8B;1&#xFF0C;&#x5728;<a href=\"http://www.jianshu.com/p/90220a55f542\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x535A;&#x4E3B;&#x6709;&#x63D0;&#x5230;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;:</p>\n<blockquote>\n<p>wx.request()&#x8FD4;&#x56DE;&#x7684;&#x72B6;&#x6001;&#x7801;statusCode&#x5728;iOS&#x4E0B;&#x662F;Int&#xFF0C;&#x800C;&#x5728;Android&#x4E0A;&#x5374;&#x662F;String&#x3002;&#x5982;&#x679C;&#x5224;&#x65AD;statusCode&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x5F53;&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x8E29;&#x5230;&#x5751;&#x91CC;&#x4E86;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;2&#xFF0C;&#x5728;<a href=\"http://www.henkuai.com/thread-17813-1-1.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8E29;&#x5751;&#x4E4B;wx.uploadFile</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x53D1;&#x73B0;&#x65E7;&#x7248;&#x672C;&#x7684;&#x5FAE;&#x4FE1;&#x4F1A;&#x51FA;&#x9519;:</p>\n<blockquote>\n<p>iOS&#x53EF;&#x4EE5;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#xFF0C;Android&#x5FC5;&#x987B;&#x5C06;&#x5FAE;&#x4FE1;&#x5347;&#x7EA7;&#x5230;6.5.2&#x7248;&#x672C;&#x4EE5;&#x4E0A;&#x624D;&#x80FD;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;3&#xFF0C;&#x5728;<a href=\"http://www.wxapp-union.com/forum.php?mod=viewthread&amp;tid=2122&amp;highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98\" target=\"_blank\" rel=\"external\">&#x4E00;&#x4E2A;&#x6709;&#x5173;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x7801;&#x7684;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;ES 6&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;:</p>\n<blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x548C;&#x9AD8;&#x7248;&#x672C;&#x7684;iOS&#x652F;&#x6301;<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith\" target=\"_blank\" rel=\"external\">startsWith</a>&#xFF0C;&#x7136;&#x800C;&#x5728;iOS 8&#x548C;Android&#x4E0D;&#x652F;&#x6301;startsWith&#x3002;</p>\n</blockquote>\n<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;&#xFF1F;&#x4E0D;&#x59A8;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html\" target=\"_blank\" rel=\"external\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x5427;: </p>\n<blockquote>\n<ul>\n<li>&#x5728;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#xFF0C; &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;nwjs&#x4E2D;</li>\n<li>&#x5728;iOS&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;JavaScriptCore &#x4E2D;</li>\n<li>&#x5728;Android&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x901A;&#x8FC7;X5 JSCore&#x6765;&#x89E3;&#x6790;</li>\n</ul>\n</blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x7684;JavaScript&#x811A;&#x672C;&#x6267;&#x884C;&#x73AF;&#x5883;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x5B58;&#x5728;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x4E5F;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;iOS&#x4E0A;&#x672A;&#x5FC5;&#x80FD;&#x591F;&#x8FD0;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x800C;&#x5728;iOS&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;Andriod&#x4E0A;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x4E0A;&#x7684;&#x5FAE;&#x4FE1;&#x672C;&#x8EAB;&#x4EE3;&#x7801;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>\n<h4 id=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"><a href=\"#Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\" class=\"headerlink\" title=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"></a>Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;</h4><p>&#x66F4;&#x9EBB;&#x70E6;&#x7684;&#x662F;&#xFF0C;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x4FDD;&#x8BC1;&#x4EE3;&#x7801;&#x5B8C;&#x5168;&#x6B63;&#x786E;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x9010;&#x4E2A;&#x6D4B;&#x8BD5;&#x5404;&#x79CD;&#x624B;&#x673A;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5F88;&#x96BE;&#x5168;&#x9762;&#x8003;&#x8651;&#x5404;&#x79CD;&#x771F;&#x5B9E;&#x573A;&#x666F;&#x3002;</p>\n<p>Fundebug&#x80FD;&#x591F;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6355;&#x83B7;&#x5C0F;&#x7A0B;&#x5E8F;Bug&#xFF0C;&#x7136;&#x540E;&#x53CD;&#x9988;&#x7ED9;&#x5F00;&#x53D1;&#x8005;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x53CA;&#x65F6;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\"><br></div>\n\n<p><strong>Fundebug&#x7684;&#x4F18;&#x52BF;:</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x6DFB;&#x52A0;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#xFF0C;2&#x5206;&#x949F;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<p>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://docs.fundebug.com/notifier/wxjs/\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x6587;&#x6863;</a>&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x8D76;&#x7D27;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n","excerpt":"<p>1&#x6708;9&#x65E5;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0A;&#x7EBF;&#xFF0C;&#x8DDD;&#x79BB;&#x73B0;&#x5728;&#x4EC5;&#x4EC5;&#x4E00;&#x4E2A;&#x6708;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x4EEC;&#x5DF2;&#x7ECF;&#x9047;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5751;:</p>","more":"<ul>\n<li><a href=\"http://blog.csdn.net/luoyanglizi/article/details/52681245\">&#x4E00;&#x540D;Android&#x5F00;&#x53D1;&#x8005;&#x7684;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x586B;&#x5751;&#x4E4B;&#x8DEF;(1) - CSDN</a></li>\n<li><a href=\"http://www.cnblogs.com/dudeyouth/p/6277628.html\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5751;&#x96C6; - &#x535A;&#x5BA2;&#x56ED;</a></li>\n<li><a href=\"http://www.jianshu.com/p/6359500b5576\">&#x5410;&#x69FD;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8E29;&#x8FC7;&#x7684;&#x5751;, &#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5; - &#x7B80;&#x4E66;</a></li>\n<li><a href=\"https://www.zhihu.com/question/51145570?sort=created\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x5751;, &#x4F60;&#x8E29;&#x4E86;&#x4E48;&#xFF1F;- &#x77E5;&#x4E4E;</a></li>\n<li><a href=\"http://www.wxapp-union.com/thread-23-1-1.html\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x96C6;&#x5408; - &#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8054;&#x76DF;</a></li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<h4 id=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"><a href=\"#&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"></a>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</h4><p>&#x5C0F;&#x7A0B;&#x5E8F;&#x4F9D;&#x6258;&#x4E8E;&#x5FAE;&#x4FE1;&#xFF0C;&#x4F3C;&#x4E4E;&#x5929;&#x7136;&#x62E5;&#x6709;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x4F18;&#x52BF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EA;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x4E00;&#x5957;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x5728;Android&#x4E0E;iOS&#x4E0A;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;                                                                             &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x5F80;&#x5F80;&#x4F1A;&#x5BFC;&#x81F4;&#x5404;&#x79CD;BUG&#x3002;</p>\n<p>&#x4F8B;1&#xFF0C;&#x5728;<a href=\"http://www.jianshu.com/p/90220a55f542\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x535A;&#x4E3B;&#x6709;&#x63D0;&#x5230;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;:</p>\n<blockquote>\n<p>wx.request()&#x8FD4;&#x56DE;&#x7684;&#x72B6;&#x6001;&#x7801;statusCode&#x5728;iOS&#x4E0B;&#x662F;Int&#xFF0C;&#x800C;&#x5728;Android&#x4E0A;&#x5374;&#x662F;String&#x3002;&#x5982;&#x679C;&#x5224;&#x65AD;statusCode&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x5F53;&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x8E29;&#x5230;&#x5751;&#x91CC;&#x4E86;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;2&#xFF0C;&#x5728;<a href=\"http://www.henkuai.com/thread-17813-1-1.html\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8E29;&#x5751;&#x4E4B;wx.uploadFile</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x53D1;&#x73B0;&#x65E7;&#x7248;&#x672C;&#x7684;&#x5FAE;&#x4FE1;&#x4F1A;&#x51FA;&#x9519;:</p>\n<blockquote>\n<p>iOS&#x53EF;&#x4EE5;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#xFF0C;Android&#x5FC5;&#x987B;&#x5C06;&#x5FAE;&#x4FE1;&#x5347;&#x7EA7;&#x5230;6.5.2&#x7248;&#x672C;&#x4EE5;&#x4E0A;&#x624D;&#x80FD;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;3&#xFF0C;&#x5728;<a href=\"http://www.wxapp-union.com/forum.php?mod=viewthread&amp;tid=2122&amp;highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98\">&#x4E00;&#x4E2A;&#x6709;&#x5173;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x7801;&#x7684;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;ES 6&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;:</p>\n<blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x548C;&#x9AD8;&#x7248;&#x672C;&#x7684;iOS&#x652F;&#x6301;<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith\">startsWith</a>&#xFF0C;&#x7136;&#x800C;&#x5728;iOS 8&#x548C;Android&#x4E0D;&#x652F;&#x6301;startsWith&#x3002;</p>\n</blockquote>\n<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;&#xFF1F;&#x4E0D;&#x59A8;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x5427;: </p>\n<blockquote>\n<ul>\n<li>&#x5728;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#xFF0C; &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;nwjs&#x4E2D;</li>\n<li>&#x5728;iOS&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;JavaScriptCore &#x4E2D;</li>\n<li>&#x5728;Android&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x901A;&#x8FC7;X5 JSCore&#x6765;&#x89E3;&#x6790;</li>\n</ul>\n</blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x7684;JavaScript&#x811A;&#x672C;&#x6267;&#x884C;&#x73AF;&#x5883;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x5B58;&#x5728;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x4E5F;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;iOS&#x4E0A;&#x672A;&#x5FC5;&#x80FD;&#x591F;&#x8FD0;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x800C;&#x5728;iOS&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;Andriod&#x4E0A;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x4E0A;&#x7684;&#x5FAE;&#x4FE1;&#x672C;&#x8EAB;&#x4EE3;&#x7801;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>\n<h4 id=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"><a href=\"#Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\" class=\"headerlink\" title=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"></a>Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;</h4><p>&#x66F4;&#x9EBB;&#x70E6;&#x7684;&#x662F;&#xFF0C;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x4FDD;&#x8BC1;&#x4EE3;&#x7801;&#x5B8C;&#x5168;&#x6B63;&#x786E;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x9010;&#x4E2A;&#x6D4B;&#x8BD5;&#x5404;&#x79CD;&#x624B;&#x673A;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5F88;&#x96BE;&#x5168;&#x9762;&#x8003;&#x8651;&#x5404;&#x79CD;&#x771F;&#x5B9E;&#x573A;&#x666F;&#x3002;</p>\n<p>Fundebug&#x80FD;&#x591F;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6355;&#x83B7;&#x5C0F;&#x7A0B;&#x5E8F;Bug&#xFF0C;&#x7136;&#x540E;&#x53CD;&#x9988;&#x7ED9;&#x5F00;&#x53D1;&#x8005;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x53CA;&#x65F6;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\"><br></div>\n\n<p><strong>Fundebug&#x7684;&#x4F18;&#x52BF;:</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x6DFB;&#x52A0;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#xFF0C;2&#x5206;&#x949F;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<p>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://docs.fundebug.com/notifier/wxjs/\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x6587;&#x6863;</a>&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x8D76;&#x7D27;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"}],"PostAsset":[{"_id":"source/_posts/2016/11/fundebug-is-online/with_fundebug.jpg","slug":"with_fundebug.jpg","post":"ciz3dhzu00000ivfyb1ffi556","modified":1,"renderable":0},{"_id":"source/_posts/2016/11/fundebug-is-online/without_fundebug.jpg","slug":"without_fundebug.jpg","post":"ciz3dhzu00000ivfyb1ffi556","modified":1,"renderable":0},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png","slug":"kubernetes-multiple-docker.png","post":"ciz3dhzv20007ivfytrtpbml2","modified":1,"renderable":0},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png","slug":"kubernetes-multiple-docker.png","post":"ciz3dhzv50008ivfy4q96zppf","modified":1,"renderable":0},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png","slug":"ubuntu-hadoop.png","post":"ciz3dhzuz0006ivfynxqfy758","modified":1,"renderable":0},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png","slug":"vagrant-vm-cluster.png","post":"ciz3dhzv9000aivfyev9sicmz","modified":1,"renderable":0},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-detail.png","slug":"error-detail.png","post":"ciz3dhzwf001bivfyra3y7k7o","modified":1,"renderable":0},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Mesos.png","slug":"Mesos.png","post":"ciz3dhzux0004ivfynoszshqa","modified":1,"renderable":0},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.graffle","slug":"mesos-marathon-platform.graffle","post":"ciz3dhzw4000yivfyeco9uwvb","modified":1,"renderable":0},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.graffle","post":"ciz3dhzuw0003ivfywr408ev1","slug":"image-architecture.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png","post":"ciz3dhzuw0003ivfywr408ev1","slug":"image-architecture.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.graffle","post":"ciz3dhzuz0006ivfynxqfy758","slug":"ubuntu-hadoop.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.graffle","post":"ciz3dhzv20007ivfytrtpbml2","slug":"kubernetes-multiple-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.graffle","post":"ciz3dhzv9000aivfyev9sicmz","slug":"vagrant-vm-cluster.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.graffle","post":"ciz3dhzv50008ivfy4q96zppf","slug":"kubernetes-multiple-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.graffle","post":"ciz3dhzv50008ivfy4q96zppf","slug":"kubernetes-single-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png","post":"ciz3dhzv50008ivfy4q96zppf","slug":"kubernetes-single-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Marathon.png","post":"ciz3dhzux0004ivfynoszshqa","slug":"Marathon.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/hello.png","post":"ciz3dhzux0004ivfynoszshqa","slug":"hello.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.graffle","post":"ciz3dhzux0004ivfynoszshqa","slug":"single-mesos-marathon.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png","post":"ciz3dhzux0004ivfynoszshqa","slug":"single-mesos-marathon.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png","slug":"mesos-marathon-platform.png","post":"ciz3dhzw4000yivfyeco9uwvb","modified":1,"renderable":0},{"_id":"source/_posts/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg","slug":"fundebug-wxjs.jpg","post":"ciz3dhzwl001iivfykg0dsa5r","modified":1,"renderable":0},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg","slug":"fundebug-wxjs.jpg","post":"ciz3dhzwg001divfy7ulcmja0","modified":1,"renderable":0},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.graffle","post":"ciz3dhzw2000vivfy1504vebk","slug":"hadoop-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png","slug":"hadoop-docker.png","post":"ciz3dhzw2000vivfy1504vebk","modified":1,"renderable":0},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.graffle","post":"ciz3dhzw3000wivfywsyhmxer","slug":"hadoop-cluster-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png","post":"ciz3dhzw3000wivfywsyhmxer","slug":"hadoop-cluster-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.graffle","post":"ciz3dhzw50010ivfy8ckcjuq0","slug":"vagrant-vm.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png","slug":"vagrant-vm.png","post":"ciz3dhzw50010ivfy8ckcjuq0","modified":1,"renderable":0},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.graffle","post":"ciz3dhzw80012ivfypy0moxg7","slug":"hadoop-cluster-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png","post":"ciz3dhzw80012ivfypy0moxg7","slug":"hadoop-cluster-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.graffle","post":"ciz3dhzwb0014ivfyfdme7uoy","slug":"service-discovery.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.png","post":"ciz3dhzwb0014ivfyfdme7uoy","slug":"service-discovery.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.graffle","slug":"mongodb-inverted-index.graffle","post":"ciz3dhzwc0016ivfyqdmkvq59","modified":1,"renderable":0},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png","slug":"mongodb-inverted-index.png","post":"ciz3dhzwc0016ivfyqdmkvq59","modified":1,"renderable":0},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.graffle","post":"ciz3dhzwe0019ivfy7oi09nen","slug":"underscore-example.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.png","post":"ciz3dhzwe0019ivfy7oi09nen","slug":"underscore-example.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/empty.png","post":"ciz3dhzwg001divfy7ulcmja0","slug":"empty.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser-share.png","post":"ciz3dhzwj001givfyd8s5bx3d","slug":"browser-share.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser.jpg","slug":"browser.jpg","post":"ciz3dhzwj001givfyd8s5bx3d","modified":1,"renderable":0},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/email.png","post":"ciz3dhzwf001bivfyra3y7k7o","slug":"email.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-count.png","post":"ciz3dhzwf001bivfyra3y7k7o","slug":"error-count.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/marathon.png","post":"ciz3dhzw4000yivfyeco9uwvb","slug":"marathon.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos.png","post":"ciz3dhzw4000yivfyeco9uwvb","slug":"mesos.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/nginx.png","post":"ciz3dhzw4000yivfyeco9uwvb","slug":"nginx.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/zookeeper.png","post":"ciz3dhzw4000yivfyeco9uwvb","slug":"zookeeper.png","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"ciz3dhzu00000ivfyb1ffi556","tag_id":"ciz3dhzu60001ivfy9s7ahyu1","_id":"ciz3dhzuc0002ivfynr3bfsaj"},{"post_id":"ciz3dhzuw0003ivfywr408ev1","tag_id":"ciz3dhzuz0005ivfy7l0y3bmo","_id":"ciz3dhzvg000civfyqgsy24oo"},{"post_id":"ciz3dhzuw0003ivfywr408ev1","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzvl000divfygfa2e8d4"},{"post_id":"ciz3dhzux0004ivfynoszshqa","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzvt000hivfyp61z7rkx"},{"post_id":"ciz3dhzux0004ivfynoszshqa","tag_id":"ciz3dhzvm000eivfyt80zc9jb","_id":"ciz3dhzvt000iivfy176sykpg"},{"post_id":"ciz3dhzux0004ivfynoszshqa","tag_id":"ciz3dhzvs000fivfyykrs5u0b","_id":"ciz3dhzvt000kivfyhxwoyhjk"},{"post_id":"ciz3dhzuz0006ivfynxqfy758","tag_id":"ciz3dhzuz0005ivfy7l0y3bmo","_id":"ciz3dhzvu000livfyn15xmmrf"},{"post_id":"ciz3dhzv20007ivfytrtpbml2","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzvu000oivfy889bsrr8"},{"post_id":"ciz3dhzv20007ivfytrtpbml2","tag_id":"ciz3dhzvu000mivfygzfdx2i2","_id":"ciz3dhzvu000pivfyhiu1dut6"},{"post_id":"ciz3dhzv50008ivfy4q96zppf","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzvv000sivfyo1v22d4f"},{"post_id":"ciz3dhzv50008ivfy4q96zppf","tag_id":"ciz3dhzvu000mivfygzfdx2i2","_id":"ciz3dhzvv000tivfy989sl1ve"},{"post_id":"ciz3dhzv9000aivfyev9sicmz","tag_id":"ciz3dhzvv000rivfyjxdaoeso","_id":"ciz3dhzvv000uivfye7d6h2r8"},{"post_id":"ciz3dhzw2000vivfy1504vebk","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzw3000xivfyfseil48z"},{"post_id":"ciz3dhzw2000vivfy1504vebk","tag_id":"ciz3dhzuz0005ivfy7l0y3bmo","_id":"ciz3dhzw5000zivfyjun28lwv"},{"post_id":"ciz3dhzw3000wivfywsyhmxer","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzw80011ivfym9vpg2l8"},{"post_id":"ciz3dhzw3000wivfywsyhmxer","tag_id":"ciz3dhzuz0005ivfy7l0y3bmo","_id":"ciz3dhzwa0013ivfy074gez7u"},{"post_id":"ciz3dhzw4000yivfyeco9uwvb","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzwc0015ivfy3g5gldlm"},{"post_id":"ciz3dhzw4000yivfyeco9uwvb","tag_id":"ciz3dhzvm000eivfyt80zc9jb","_id":"ciz3dhzwe0018ivfy400f356b"},{"post_id":"ciz3dhzw4000yivfyeco9uwvb","tag_id":"ciz3dhzvs000fivfyykrs5u0b","_id":"ciz3dhzwf001aivfyr57j7dna"},{"post_id":"ciz3dhzw50010ivfy8ckcjuq0","tag_id":"ciz3dhzvv000rivfyjxdaoeso","_id":"ciz3dhzwg001civfy2y643euf"},{"post_id":"ciz3dhzw80012ivfypy0moxg7","tag_id":"ciz3dhzv50009ivfygr69vpud","_id":"ciz3dhzwi001fivfyyffv4mgs"},{"post_id":"ciz3dhzw80012ivfypy0moxg7","tag_id":"ciz3dhzuz0005ivfy7l0y3bmo","_id":"ciz3dhzwl001hivfyah6cb6le"},{"post_id":"ciz3dhzwf001bivfyra3y7k7o","tag_id":"ciz3dhzu60001ivfy9s7ahyu1","_id":"ciz3dhzwp001kivfy1ty695ft"},{"post_id":"ciz3dhzwb0014ivfyfdme7uoy","tag_id":"ciz3dhzwe0017ivfyftv9jj2p","_id":"ciz3dhzwp001livfyiyppvpqz"},{"post_id":"ciz3dhzwc0016ivfyqdmkvq59","tag_id":"ciz3dhzwi001eivfyykdhhcfx","_id":"ciz3dhzwp001nivfyfn6vz2hk"},{"post_id":"ciz3dhzwe0019ivfy7oi09nen","tag_id":"ciz3dhzwo001jivfyrpgk790l","_id":"ciz3dhzwp001oivfymilh0g34"},{"post_id":"ciz3dhzwe0019ivfy7oi09nen","tag_id":"ciz3dhzwp001mivfyvumo5kl5","_id":"ciz3dhzwq001pivfyf5x8zoxj"},{"post_id":"ciz3dhzwl001iivfykg0dsa5r","tag_id":"ciz3dhzu60001ivfy9s7ahyu1","_id":"ciz3dmxco001sivfyft7dotmz"},{"post_id":"ciz3dhzwl001iivfykg0dsa5r","tag_id":"ciz3dmxcn001rivfyjik8etpa","_id":"ciz3dmxco001tivfy09h0ar8m"},{"post_id":"ciz3dhzwg001divfy7ulcmja0","tag_id":"ciz3dhzu60001ivfy9s7ahyu1","_id":"ciz3dnmgr001uivfyv474dxs4"},{"post_id":"ciz3dhzwg001divfy7ulcmja0","tag_id":"ciz3dmxcn001rivfyjik8etpa","_id":"ciz3dnmgs001vivfylm3j6uao"},{"post_id":"ciz3dhzwj001givfyd8s5bx3d","tag_id":"ciz3dhzu60001ivfy9s7ahyu1","_id":"ciz3dp4jn001xivfy5wj8xh3z"},{"post_id":"ciz3dhzwj001givfyd8s5bx3d","tag_id":"ciz3dp4jm001wivfy4xmc22ad","_id":"ciz3dp4jo001yivfyv0l8vu9q"}],"Tag":[{"name":"Fundebug","_id":"ciz3dhzu60001ivfy9s7ahyu1"},{"name":"Hadoop","_id":"ciz3dhzuz0005ivfy7l0y3bmo"},{"name":"Docker","_id":"ciz3dhzv50009ivfygr69vpud"},{"name":"Mesos","_id":"ciz3dhzvm000eivfyt80zc9jb"},{"name":"Marathon","_id":"ciz3dhzvs000fivfyykrs5u0b"},{"name":"Kubernetes","_id":"ciz3dhzvu000mivfygzfdx2i2"},{"name":"Vagrant","_id":"ciz3dhzvv000rivfyjxdaoeso"},{"name":"服务发现","_id":"ciz3dhzwe0017ivfyftv9jj2p"},{"name":"MongoDB","_id":"ciz3dhzwi001eivfyykdhhcfx"},{"name":"NodeJS","_id":"ciz3dhzwo001jivfyrpgk790l"},{"name":"Underscore","_id":"ciz3dhzwp001mivfyvumo5kl5"},{"name":"小程序","_id":"ciz3dmxcn001rivfyjik8etpa"},{"name":"JavaScript","_id":"ciz3dp4jm001wivfy4xmc22ad"}]}}