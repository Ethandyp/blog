{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"themes/light/source/css/gitment.css","path":"css/gitment.css","modified":1,"renderable":1},{"_id":"themes/light/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/light/source/img/fundebug.png","path":"img/fundebug.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/light/source/img/github.png","path":"img/github.png","modified":1,"renderable":1},{"_id":"themes/light/source/img/segmentfault.jpeg","path":"img/segmentfault.jpeg","modified":1,"renderable":1},{"_id":"themes/light/source/img/totop.png","path":"img/totop.png","modified":1,"renderable":1},{"_id":"themes/light/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/light/source/js/gallery.js","path":"js/gallery.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/jquery.imagesloaded.min.js","path":"js/jquery.imagesloaded.min.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/pv.js","path":"js/pv.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/totop.js","path":"js/totop.js","modified":1,"renderable":1},{"_id":"themes/light/source/img/alipay.JPG","path":"img/alipay.JPG","modified":1,"renderable":1},{"_id":"themes/light/source/img/kiwenlau.ico","path":"img/kiwenlau.ico","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.woff","path":"css/font/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.eot","path":"css/font/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/light/source/js/blog/20170306_ip.js","path":"js/blog/20170306_ip.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/blog/20170306_time.js","path":"js/blog/20170306_time.js","modified":1,"renderable":1},{"_id":"themes/light/source/img/wechat.JPG","path":"img/wechat.JPG","modified":1,"renderable":1},{"_id":"themes/light/source/js/gitment.js","path":"js/gitment.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/highcharts.js","path":"js/highcharts.js","modified":1,"renderable":1},{"_id":"themes/light/source/js/jquery.min.js","path":"js/jquery.min.js","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.ttf","path":"css/font/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/light/source/css/font/fontawesome-webfont.svg","path":"css/font/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/light/source/img/kiwenlau.jpg","path":"img/kiwenlau.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"4fec4ff3596122fd56e968ac3f4f6c15c2916d62","modified":1493002594000},{"_id":"source/robots.txt","hash":"b7d8a5701d5fb60fda9e17342c5fed7aec6b3ab2","modified":1478482378000},{"_id":"themes/light/_config.yml","hash":"04ef7915bed903d0aa9043c72c4efb040f35bac2","modified":1493210006000},{"_id":"themes/light/.DS_Store","hash":"824dcf60ff131d01cb67845152cf9a33ee58e38a","modified":1493210069000},{"_id":"source/_posts/.DS_Store","hash":"da14bb1236ba81b85f7bd830917adafd85f14ef5","modified":1493123281000},{"_id":"themes/light/languages/de.yml","hash":"e076c7f2eb29ebcfb04d94861bf3063c4b08078c","modified":1478482378000},{"_id":"themes/light/languages/default.yml","hash":"fd7397be7789b43c1c163ab4faf106318811c2a8","modified":1478482378000},{"_id":"themes/light/languages/es.yml","hash":"de273af604b27812cfd4195e7b7f28ceff2734b3","modified":1478482378000},{"_id":"themes/light/languages/ru.yml","hash":"35aadf8fdd28aaff8a1c8f50e80201dcf8ce0604","modified":1478482378000},{"_id":"themes/light/languages/zh-CN.yml","hash":"16979cea6653f9ed345b6ed2c09823d75a622ded","modified":1478482378000},{"_id":"themes/light/languages/zh-TW.yml","hash":"bcfd502bf073d4c451c13d05d2571f814d1766c9","modified":1478482378000},{"_id":"themes/light/layout/.DS_Store","hash":"d1a199a1292d6b412d6bd6739e373bc05bb0c70e","modified":1493210073000},{"_id":"themes/light/layout/archive.ejs","hash":"a18842e3d719fe3ca9b977a6995f8facc75c8673","modified":1478482378000},{"_id":"themes/light/layout/category.ejs","hash":"9b740fc33f6f028df60f0bc4312bf3ebd03aa8ea","modified":1478482378000},{"_id":"themes/light/layout/index.ejs","hash":"e569d8fe0741a24efb89e44781f9e616da17e036","modified":1478482378000},{"_id":"themes/light/layout/layout.ejs","hash":"72da76881ebf00e71d7cc196f377e37a17ec7a6f","modified":1478482378000},{"_id":"themes/light/layout/page.ejs","hash":"70cbc9854655773cc6ba84eecaaf330fed430465","modified":1478482378000},{"_id":"themes/light/layout/post.ejs","hash":"70cbc9854655773cc6ba84eecaaf330fed430465","modified":1478482378000},{"_id":"themes/light/layout/tag.ejs","hash":"45150a2365768b6b67880193c9264ad2bb4814db","modified":1478482378000},{"_id":"themes/light/source/.DS_Store","hash":"41e9f5236da821bd3e885e36242976c50b336446","modified":1493004670000},{"_id":"themes/light/layout/_partial/donate.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1492788186000},{"_id":"source/_posts/2015/.DS_Store","hash":"634421600953aab1b9fddd6b04f52192f9141369","modified":1478736879000},{"_id":"source/_posts/2016/.DS_Store","hash":"dd136d2e60995e49f8ea9cdfcfc1239eed8342fb","modified":1486946708000},{"_id":"source/_posts/2017/.DS_Store","hash":"795b107b2d5d063ce0786d5fd1e2a608e2b8f1ba","modified":1493123285000},{"_id":"themes/light/layout/_partial/.DS_Store","hash":"7a84a4288f753332a92b2232155812fec1d7e8b4","modified":1493210073000},{"_id":"themes/light/layout/_partial/archive.ejs","hash":"a46dbaa593fe6702c6f7e4cc0377e7b5019bc3dd","modified":1492921299000},{"_id":"themes/light/layout/_partial/article.ejs","hash":"cad1e1cb8647d9c8469bf1a4f96d34396e7c2b8d","modified":1493209911000},{"_id":"themes/light/layout/_partial/after_footer.ejs","hash":"172ace376a3f4f1a9e0b348cc677c5c6756387ab","modified":1493176456000},{"_id":"themes/light/layout/_partial/copyright.ejs","hash":"22118424dd0db2b75d1ffb22c95963e5f3adeaca","modified":1493207092000},{"_id":"themes/light/layout/_partial/footer.ejs","hash":"61224149335ae515b0c23e27070c11b05d78749d","modified":1478482378000},{"_id":"themes/light/layout/_partial/gitment.ejs","hash":"086b963ca884e8596db4859c1d24e5bb9ab80cc9","modified":1492913855000},{"_id":"themes/light/layout/_partial/header.ejs","hash":"d9a99aca97d8b41ed907fbf5b25df05da3ffa4f6","modified":1478482378000},{"_id":"themes/light/layout/_partial/sidebar.ejs","hash":"caf351797a18d03d8ee945ceb9f83785c50c09f9","modified":1478482378000},{"_id":"themes/light/layout/_partial/pagination.ejs","hash":"1206b630a07444e8744365f14ddb26095c925ae1","modified":1478482378000},{"_id":"themes/light/layout/_widget/advertisement.ejs","hash":"e055c89ae8d14e1c1640a3d46db289f03e8fa58d","modified":1493209980000},{"_id":"themes/light/layout/_widget/.DS_Store","hash":"e06cf99e0f0c4c65e4a6b8a3c2c0f5f7d0be5f88","modified":1493210078000},{"_id":"themes/light/layout/_partial/totop.ejs","hash":"344f31c40616865bc4bebe32514c66365fd74f2b","modified":1493004300000},{"_id":"themes/light/layout/_widget/donate.ejs","hash":"47403bf5a950ccc21fa353432c3fe11cb620e5e5","modified":1492787775000},{"_id":"themes/light/layout/_widget/category.ejs","hash":"8a2b90dc29661371f060f710668929c3588e15e4","modified":1478482378000},{"_id":"themes/light/layout/_partial/head.ejs","hash":"cb7c6bcd8a29a4b5111112cd2f45729045ce7e71","modified":1493178649000},{"_id":"themes/light/layout/_widget/link.ejs","hash":"eb6b276337bfc803b4f76d152323d8fac6c30ad4","modified":1493004379000},{"_id":"themes/light/layout/_widget/popular_posts.ejs","hash":"f3b13b2ce84da5585d2694c8b51310d4cc97b36e","modified":1493207535000},{"_id":"themes/light/layout/_widget/photo.ejs","hash":"f6275ec8b594ab0fc70ecf73102b468f6e497c4e","modified":1493004652000},{"_id":"themes/light/layout/_widget/recent_posts.ejs","hash":"8f2f3963bd568c681d7585bb8099fb1b3e1d4c81","modified":1478482378000},{"_id":"themes/light/layout/_widget/tag.ejs","hash":"1914db78bea49c333067d79fe7ad9567d2b08d00","modified":1478482378000},{"_id":"themes/light/layout/_widget/search.ejs","hash":"e517c8e6941d8d3bb4a2042fce258cc966488c53","modified":1478482378000},{"_id":"themes/light/source/css/gitment.css","hash":"7fbb18b73b44ed11193739c55fce53a6f173cf68","modified":1492911909000},{"_id":"themes/light/source/css/style.styl","hash":"c03b2520e4a85b981e29516cadc0a365e6500e3d","modified":1478482378000},{"_id":"themes/light/layout/_widget/tagcloud.ejs","hash":"9053f62cdbadbd109d6569f4a0381b7a05ba5dfc","modified":1478482378000},{"_id":"themes/light/layout/_widget/toc.ejs","hash":"b95422f579ed3747124cae680c8d4283e28ed267","modified":1478482378000},{"_id":"themes/light/source/css/.DS_Store","hash":"6cb65ea25f910042364bc05104e9062ab553d35c","modified":1492911972000},{"_id":"themes/light/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1478482378000},{"_id":"themes/light/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1478482378000},{"_id":"themes/light/source/fancybox/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1478482378000},{"_id":"themes/light/source/fancybox/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1478482378000},{"_id":"themes/light/source/img/fundebug.png","hash":"5470ee921cb4160af726031d01324e57eae2ea84","modified":1477112796000},{"_id":"themes/light/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1478482378000},{"_id":"themes/light/source/img/.DS_Store","hash":"9634e2e99021d65ed03e58088aabdbe3c23f5a0a","modified":1493004661000},{"_id":"themes/light/source/img/github.png","hash":"8e4af8e0da1da6fb685e86c19afb5322d559a8ca","modified":1478482378000},{"_id":"themes/light/source/img/segmentfault.jpeg","hash":"023e7eef6165635b2fee0fc013a8c45b0358a547","modified":1478482378000},{"_id":"themes/light/source/img/totop.png","hash":"74f4b1e0f3b47a1a27cee4a8cb712eb33994ca41","modified":1478482378000},{"_id":"themes/light/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1478482378000},{"_id":"themes/light/source/js/gallery.js","hash":"f8b17fc2dbd4fb939bb872d1232b404049355cfa","modified":1480653496000},{"_id":"themes/light/source/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1478482378000},{"_id":"themes/light/source/js/.DS_Store","hash":"c5714145c21c1596b0b16ce68c9092513d8273be","modified":1492911967000},{"_id":"themes/light/source/js/pv.js","hash":"1308c652c3f8b2c4ec1bd8a19cf7706243e9fbb5","modified":1493208215000},{"_id":"themes/light/source/js/totop.js","hash":"8fbd5fb07b1397839b75636607fa66e3391b4182","modified":1488337462000},{"_id":"themes/light/source/css/_base/utils.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1478482378000},{"_id":"themes/light/source/img/alipay.JPG","hash":"3a0ac497613bb00f56e0aec63b8864cc150dcde4","modified":1492748611000},{"_id":"themes/light/source/img/kiwenlau.ico","hash":"987d9c1658c3779037d96f49d8779b9bab18440b","modified":1478482378000},{"_id":"source/_posts/2015/09/.DS_Store","hash":"016edfce8354a2669c8f04da0fac2a840674c7b6","modified":1478736879000},{"_id":"source/_posts/2016/05/.DS_Store","hash":"d24e2bdd11ad412a3c1eabcb2e5d690199b69827","modified":1486946475000},{"_id":"source/_posts/2016/11/.DS_Store","hash":"7c7f699e15d572775589195a31a13d35b1476646","modified":1478740032000},{"_id":"source/_posts/2016/12/.DS_Store","hash":"52e0d71c55cbdeb9c746e0a87b114ded2f6ba55c","modified":1486946714000},{"_id":"source/_posts/2016/11/fundebug-is-online.md","hash":"d0289e7d75c8db814e13e176ca1d56ff95868f8b","modified":1481121350000},{"_id":"source/_posts/2017/01/.DS_Store","hash":"a3719fd1bebad93ed88a43cc4db5c2206f64ea5a","modified":1486946722000},{"_id":"source/_posts/2017/02/.DS_Store","hash":"e07e561c2d3bb6f96a9b03579eaf074914daa8f5","modified":1489655497000},{"_id":"source/_posts/2017/03/.DS_Store","hash":"f794252c3e9a1f9ab9e70db2c751008203082c05","modified":1491038011000},{"_id":"source/_posts/2017/04/.DS_Store","hash":"9481c6cad6ca2ab4825b3e4910645d06cb9d1608","modified":1493125534000},{"_id":"themes/light/layout/_partial/post/gallery.ejs","hash":"fafc2501d7e65983b0f5c2b58151ca12e57c0574","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/category.ejs","hash":"be740939c5c2d4ffdbed9557b4e63a590058b476","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/tag.ejs","hash":"095418df66a27a28cbab16d7cb0d16001b0e23f1","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/share.ejs","hash":"24c04b319f1b19e887c42db961b90a7e0ab26fdc","modified":1478482378000},{"_id":"themes/light/layout/_partial/post/title.ejs","hash":"d7fbc575d35ae68f9045a382c651450e4131f335","modified":1478482378000},{"_id":"themes/light/source/css/_base/layout.styl","hash":"1b58c21aa48a8f9f7f811af681ac182dd058e23d","modified":1478482378000},{"_id":"themes/light/source/css/_base/variable.styl","hash":"c4e07cb7f4ec980553cd19d9d2cd8a1a44d4cd82","modified":1478482378000},{"_id":"themes/light/source/css/_partial/archive.styl","hash":"072e9b8c5ee9acf95ac7cce9c34706d41e412229","modified":1478482378000},{"_id":"themes/light/source/css/_partial/article.styl","hash":"fda6b477b2137090fcc6d2bbe170dbf46b9699e7","modified":1478482378000},{"_id":"themes/light/source/css/_partial/comment.styl","hash":"a74254a6e713a522134cca4c644fde681c502823","modified":1478482378000},{"_id":"themes/light/source/css/_partial/footer.styl","hash":"1757872dbdbd09295a625f13e356aa798a8bb308","modified":1478482378000},{"_id":"themes/light/source/css/_partial/header.styl","hash":"0f932c9514d13fea70fe109242e17ee633a2b28a","modified":1478482378000},{"_id":"themes/light/source/css/_partial/index.styl","hash":"7a8c0ec6ab99a9f8e00c9687aca29d31752424a2","modified":1478482378000},{"_id":"themes/light/source/css/_partial/sidebar.styl","hash":"e21feea627a06c711f90d9830356c85e150f162e","modified":1478482378000},{"_id":"themes/light/source/css/_partial/syntax.styl","hash":"418b304ca39948bfbf720f3465962a1846f9a0e6","modified":1478482378000},{"_id":"themes/light/source/css/font/fontawesome-webfont.woff","hash":"0612cddf2f835cceffccc88fd194f97367d0b024","modified":1478482378000},{"_id":"themes/light/source/css/font/fontawesome-webfont.eot","hash":"d775f599ff3f23be082e6a9604b4898718923a37","modified":1478482378000},{"_id":"themes/light/source/js/blog/.DS_Store","hash":"1d164775213b2a54b5e9cd888934b68c9ed43154","modified":1488632201000},{"_id":"themes/light/source/js/blog/20170306_ip.js","hash":"e7afe8f904a71e938c9cae17e4612c113694b9e7","modified":1488702312000},{"_id":"themes/light/source/js/blog/20170306_time.js","hash":"f03d03c5f3fef48f6200f44e73e3efee6a71bcae","modified":1488702339000},{"_id":"themes/light/source/img/wechat.JPG","hash":"f7a0e2917a259dc9d4baf4cd13788ebe6ddb3547","modified":1492748611000},{"_id":"themes/light/source/js/gitment.js","hash":"376446d9c5930576016f97dd63e5e6616c94d8d4","modified":1492911935000},{"_id":"themes/light/source/js/highcharts.js","hash":"22f512de32b98166405948cd4c8e46f0f25cd8a3","modified":1484653980000},{"_id":"themes/light/source/js/jquery.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1488334899000},{"_id":"themes/light/source/css/font/fontawesome-webfont.ttf","hash":"a9468f6a1fe965fbcaf5a1bd6c11705e2fc5f84c","modified":1478482378000},{"_id":"themes/light/source/css/font/fontawesome-webfont.svg","hash":"d162419c91b8bab3a4fd327c933a0fcf3799c251","modified":1478482378000},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker.md","hash":"659fb635866560790aae7efa58b177355b4bb5f4","modified":1478482378000},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker.md","hash":"73c87cbd4d2cea2c2903c8620c041e1a2295bc2f","modified":1478482378000},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update.md","hash":"332aa8fd51e9a2850ea5ae1a78ff9db8bb73f5f9","modified":1478482378000},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker.md","hash":"fadb6cd129c08bcfd9bf0196d5a970894767cbbd","modified":1478482378000},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine.md","hash":"cdbdc494436a96dd6faaf0cf335ac4e1e63ae5a3","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container.md","hash":"5819960205910a689ccf40443f198edc1ea79a52","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker.md","hash":"a46ac2531bceff80cc62ff78de417dac746fac84","modified":1478482378000},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english.md","hash":"14b37b76e1c94a152c9a97ed07e94179649f4fb3","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform.md","hash":"acc74e6800d9d634c2f5cfe483fe10c2c8a34fef","modified":1478482378000},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu.md","hash":"af07ccf8c42a27f516f4d239c7c4c26d12dc3cf3","modified":1478482378000},{"_id":"source/_posts/2016/09/04/what-is-service-discovery.md","hash":"8b09a9a7c321087ca0a37711b3e05c68886f1399","modified":1491790449000},{"_id":"source/_posts/2016/09/18/underscore-example.md","hash":"fe54db22889e2dbaca70a3bca2687480d6ea9217","modified":1491790381000},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index.md","hash":"c40996da497a45209707ad29637a6723eb548c1b","modified":1478482378000},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster.md","hash":"895758b7c475183c6d8bc293db38f96fc01a2de6","modified":1478482378000},{"_id":"source/_posts/2016/12/07/.DS_Store","hash":"71ba65ec78223cfeb1b9de8f917bb7a3173f9bfc","modified":1486946714000},{"_id":"source/_posts/2017/01/16/.DS_Store","hash":"04b8078c699a520cc17e0cb706d2b57f963cd3c4","modified":1486946727000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug.md","hash":"21e90c4b32c2bfd9baba0e5fbe0f6d5999487079","modified":1481121342000},{"_id":"source/_posts/2017/01/23/.DS_Store","hash":"46bd85c6a4efef7303a0b76df0800f5108cf6752","modified":1485043119000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs.md","hash":"844bdd2bd1f967f9aa1277e1545f3c7be5697642","modified":1486946671000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers.md","hash":"2c29d707eb6f30d163c5aca828e2c00fd926ee26","modified":1486946741000},{"_id":"source/_posts/2017/02/11/.DS_Store","hash":"2e772adc0be0a86f40770ebc3686dd0dac303644","modified":1486946494000},{"_id":"source/_posts/2017/02/11/weixin-miniprogram-need-fundebug.md","hash":"7fc2cb22947cd4cfdc99429e695cea0243c343b6","modified":1486946638000},{"_id":"source/_posts/2017/02/18/.DS_Store","hash":"116854a64f9839aadcafd1b4881fe3395e9dc8ca","modified":1489667264000},{"_id":"source/_posts/2017/03/06/.DS_Store","hash":"b7a30d8ae28f888c2e9a0158fc31d1b9a49cfd7d","modified":1488700752000},{"_id":"source/_posts/2017/02/18/weixinjsbridge-is-not-defined.md","hash":"c07f68d3a6cdb0ed35e0f04ec3e3cef198d1ec0b","modified":1487936970000},{"_id":"source/_posts/2017/03/13/.DS_Store","hash":"5906616cf53d0f56252d83a74bcbbe7e38e9f969","modified":1489294057000},{"_id":"source/_posts/2017/03/17/.DS_Store","hash":"9fea6611c41b3d94aa99ed0c0f19637471a28673","modified":1489889709000},{"_id":"source/_posts/2017/03/06/jquery-is-not-defined.md","hash":"171a0c66cb26faac352478313fc15ea4a1851812","modified":1488804458000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial.md","hash":"016156b344bdd0df4cf472c72ca482f54f44b397","modified":1489655363000},{"_id":"source/_posts/2017/03/17/fundebug-support-nodejs.md","hash":"80301cfcdaa6bd090f69567231a0381d52a9556d","modified":1489837964000},{"_id":"source/_posts/2017/03/20/.DS_Store","hash":"931bb200380b7ae9efbdc2c61283a7f6efa9369e","modified":1489999511000},{"_id":"source/_posts/2017/03/26/.DS_Store","hash":"db39948eb3dc821e1044ec63b1ec368b948e38ec","modified":1490530729000},{"_id":"source/_posts/2017/03/29/.DS_Store","hash":"de881c3230d9db4a2ddc1ba661441dc9068c665c","modified":1491037938000},{"_id":"source/_posts/2017/03/29/user-behavior-track.md","hash":"492d7849b21b9d7e5f04668a88db2ae7df345baa","modified":1491790345000},{"_id":"source/_posts/2017/04/01/.DS_Store","hash":"c3ebba7bcc50f2eefc165506dc87299b6044b4d4","modified":1491038001000},{"_id":"source/_posts/2017/03/20/nodejs-unit-test.md","hash":"dca18e31b40dc847dcdc007de1543f4ff55af970","modified":1490002835000},{"_id":"source/_posts/2017/03/26/nodejs-docker.md","hash":"7669d7fc5aefb33d044c39a14b7889d033eaf6f9","modified":1490530735000},{"_id":"source/_posts/2017/04/05/.DS_Store","hash":"8f84fd9ebae398ba4aee2d355ce2fcde5b0bb530","modified":1491550583000},{"_id":"source/_posts/2017/04/06/.DS_Store","hash":"1e223efbb01132aa42d630ba45c4d38199f233ec","modified":1491474958000},{"_id":"source/_posts/2017/04/01/nodejs-async-await.md","hash":"87ac070ae114349d459114cfd6da732d17e2cdf8","modified":1492354019000},{"_id":"source/_posts/2017/04/07/.DS_Store","hash":"a32ee336073cd6cea7329a9754c737830ab5ad05","modified":1491528280000},{"_id":"source/_posts/2017/04/07/solve-script-error.md","hash":"3fc7e7ca7649a6d94c04ad6c8fac59e8310727c9","modified":1491528682000},{"_id":"source/_posts/2017/04/10/.DS_Store","hash":"472f43c661f39cde42dc5631e6b1b57a57ba1d1a","modified":1492353985000},{"_id":"source/_posts/2017/04/17/.DS_Store","hash":"8b0fbcce040a52b21ae45c3abbdf1f857af19b14","modified":1492243563000},{"_id":"source/_posts/2017/04/05/understand-script-error.md","hash":"0765f84de394cb94eb7a4e5264f75f2a705681be","modified":1491565987000},{"_id":"source/_posts/2017/04/17/about-docker-sock.md","hash":"eace014db93e0c0fa5965ae6e00c7156408e0bec","modified":1492351931000},{"_id":"source/_posts/2017/04/06/test-script-error.md","hash":"499b50bfe98004bc9126c372e485fc18bcaac127","modified":1491566113000},{"_id":"source/_posts/2017/04/24/.DS_Store","hash":"e54bcb719684bae383ff66383835d8ea350e60cc","modified":1492997697000},{"_id":"source/_posts/2017/04/10/nodejs-interview-2017.md","hash":"9dbaec86eca45bcf90669e5d6720ff2af7e74386","modified":1492353996000},{"_id":"source/_posts/2017/04/18/.DS_Store","hash":"b500a2b675394488a111bfe495787d2f5959a57b","modified":1492516522000},{"_id":"source/_posts/2017/04/25/.DS_Store","hash":"2c36eada393487ca2f2ed583bd6bfea5c3fe9a89","modified":1493120562000},{"_id":"source/_posts/2017/04/18/docker-system-explain.md","hash":"83275d9e6e5d3e0e55123e6b4544e2ba9e40412e","modified":1492516532000},{"_id":"source/_posts/2017/04/24/ssh-port-forwarding.md","hash":"51aad47181822d7266ad387841d14189e3501efe","modified":1492999856000},{"_id":"source/_posts/2017/04/25/node-command-option.md","hash":"a4abbfdaace3d2f8d4aca54a4ab2955d4c3a90d2","modified":1493123690000},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.graffle","hash":"363be32d8d54a021835f2125e7d93ab5f07ee3e1","modified":1478482378000},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png","hash":"018c8ad81bcf1ad54778e761bf6c630403eb5e80","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.graffle","hash":"7dcd48d344e3dc1c7bbcce0871aa44cc4f1f10a8","modified":1478482378000},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.graffle","hash":"851a2ee0c92e642e4dffedaac3fcaef10d216806","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.graffle","hash":"851a2ee0c92e642e4dffedaac3fcaef10d216806","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.graffle","hash":"927aa0c3be32943949d17fa5455c2602a56c87fa","modified":1478482378000},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.graffle","hash":"9a2bac1e19c9299faf7e698b2feabde9717bad76","modified":1478482378000},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.graffle","hash":"87e9b82b8aebd6a0239bc1582dec43e8356bf0d1","modified":1478482378000},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.graffle","hash":"33e193fb0f5600d82ebc8da745b09b2ae8d88e15","modified":1478482378000},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.graffle","hash":"7b5bd9e08cc3b4fc85dc7a04f106be0de6edd34b","modified":1478482378000},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.graffle","hash":"281797ad8328ad5a147bfaeb4aa33c127d839e8f","modified":1478482378000},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.graffle","hash":"b3e35ad7747c984f5069ad3589677e599395e34d","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/marathon.png","hash":"a3846ef25a058da2f9d67e5690bd501a3d1f94ff","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/nginx.png","hash":"e98b0adf233b13140e2a03a4feb8dc0f8f459af5","modified":1478482378000},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.graffle","hash":"d1c17c50056f8e3757d9a3fe686223cf62322d13","modified":1478482378000},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.graffle","hash":"73758ad67c6d2d8e04112b931a5babc5bb09af24","modified":1478482378000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/.DS_Store","hash":"9fafb72ffc9806b4d8da2d2ec2ebfe1a92acd433","modified":1481102050000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/.DS_Store","hash":"9da38aa687209f3db4a07f2cb09419318b9c9283","modified":1484571068000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-count.png","hash":"59a70b42bafe6159b1f56b07dffab29ecc84e9b8","modified":1481102064000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/.DS_Store","hash":"5f5b4ffa9b1d34d2f5a34b95d7b7e254691928ad","modified":1484988463000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/empty.png","hash":"d65573fd992349739115b21172ac24bb94857393","modified":1485009372000},{"_id":"source/_posts/2016/11/fundebug-is-online/with_fundebug.jpg","hash":"21c5b66c47b82be0faaac29d39a09922587e1ef8","modified":1478722462000},{"_id":"source/_posts/2016/11/fundebug-is-online/without_fundebug.jpg","hash":"0e677ff142f135356f97dc2975192c74aa153245","modified":1478722462000},{"_id":"source/_posts/2017/02/18/weixinjsbridge-is-not-defined/.DS_Store","hash":"370ccf8c9ec3adb427db11c785f47f187e31e6b4","modified":1487935016000},{"_id":"source/_posts/2017/03/06/jquery-is-not-defined/.DS_Store","hash":"f2bb5b573b591d2f7d43d095f91ac7f8fd9b7c22","modified":1488705401000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/.DS_Store","hash":"b4c0e817e7649bd50180a834d68bca3143100a9b","modified":1489312310000},{"_id":"source/_posts/2017/02/18/weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png","hash":"215c53767524334d5357327cc21c13810253af57","modified":1487934903000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap2.png","hash":"1e2e294e51d0102a572ce1c3e7e382fe0a47fdd5","modified":1489291945000},{"_id":"source/_posts/2017/03/17/fundebug-support-nodejs/.DS_Store","hash":"c06d1a6908d9f29bd6adfa007787fb68fb39f57f","modified":1489675467000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap3.png","hash":"4e36737f6568097035a5dc8a74bc676b0c1969e6","modified":1489312381000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap4.png","hash":"3f547d91548dadf50dd22eb2dc0270a63bed9bfa","modified":1489294034000},{"_id":"source/_posts/2017/03/20/nodejs-unit-test/.DS_Store","hash":"3dab9eacc5b5eb7fa3ea2b0b4d41eb2152b73e49","modified":1490005959000},{"_id":"source/_posts/2017/03/20/nodejs-unit-test/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1490000984000},{"_id":"source/_posts/2017/03/17/fundebug-support-nodejs/fundebug-nodejs.png","hash":"bd274c08206ef29cd8eb6605bbd656c1a430a1d3","modified":1489837964000},{"_id":"source/_posts/2017/03/26/nodejs-docker/.DS_Store","hash":"824427ad25434a36654c10ed158651a72b3fbdb9","modified":1490528412000},{"_id":"source/_posts/2017/03/29/user-behavior-track/.DS_Store","hash":"fbe2e99293f9f765066a496417ad504190cd5295","modified":1491037938000},{"_id":"source/_posts/2017/03/26/nodejs-docker/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1490529686000},{"_id":"source/_posts/2017/04/01/nodejs-async-await/.DS_Store","hash":"b505ca77e23981e5499e116a902d967c18589cca","modified":1490697192000},{"_id":"source/_posts/2017/03/26/nodejs-docker/nodejs-docker.png","hash":"8dc7707af9d54eb127033b7a2b095ada92040500","modified":1490529686000},{"_id":"source/_posts/2017/03/29/user-behavior-track/user-behavior-track.png","hash":"9781503a6149724661d1ebd37f4613f8ab11b260","modified":1490961931000},{"_id":"source/_posts/2017/04/01/nodejs-async-await/debug-promise.png","hash":"a6eff38be217603deebeb7500e85fc76e276bc41","modified":1491031270000},{"_id":"source/_posts/2017/04/05/understand-script-error/.DS_Store","hash":"4d3a56cdc6266b55fea4c3c8be50c5c5bf139c63","modified":1491481609000},{"_id":"source/_posts/2017/04/01/nodejs-async-await/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1490529686000},{"_id":"source/_posts/2017/04/01/nodejs-async-await/debug-async-await.png","hash":"9c929ae2c852697158369a4887b8258ded4e384e","modified":1491031294000},{"_id":"source/_posts/2017/04/06/test-script-error/01.png","hash":"657446d2083265735302bcc2d4bf2cc95f57c4bc","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/1chrome.png","hash":"d92a971123f6eab071c5b791191667b809e979b2","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/2firefox.png","hash":"b146496f3793a96d4ee3e8d7cb1cbaaefea04832","modified":1491482164000},{"_id":"source/_posts/2017/04/07/solve-script-error/.DS_Store","hash":"8cc8367c5731c0e802251ed24a9a04e69aa65ef5","modified":1491528796000},{"_id":"source/_posts/2017/04/06/test-script-error/chrome_error.png","hash":"bec33c134ddd7f1d1f2df6f4f6b6fe7fa89478b8","modified":1491482164000},{"_id":"source/_posts/2017/04/07/solve-script-error/QRCode.png","hash":"17815e593b4f7cdb21ed9a0359db8dbc0f146bf3","modified":1491482164000},{"_id":"source/_posts/2017/04/10/nodejs-interview-2017/.DS_Store","hash":"3ae5de57d5ea5fcdf0a3cef7a250054231169466","modified":1491790065000},{"_id":"source/_posts/2017/04/17/about-docker-sock/.DS_Store","hash":"0e86d795a3ab724fa789a068d2be7f71da42bf9e","modified":1492244235000},{"_id":"source/_posts/2017/04/10/nodejs-interview-2017/test_pyramid.png","hash":"5c21f9680fb220e7bc04a785f59bb8aec3b3b2e5","modified":1491788911000},{"_id":"source/_posts/2017/04/10/nodejs-interview-2017/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1491464674000},{"_id":"source/_posts/2017/04/18/docker-system-explain/.DS_Store","hash":"c28626a01a2569af81a11611df7abd67c3838829","modified":1492515025000},{"_id":"source/_posts/2017/04/24/ssh-port-forwarding/.DS_Store","hash":"426c6cb14eb1acac34770b7e18c28ba0297e8d82","modified":1492999691000},{"_id":"source/_posts/2017/04/25/node-command-option/.DS_Store","hash":"df5ff70cbf5b4f5c9a3bbc9af3ae49e69f0cb884","modified":1493120570000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Marathon.png","hash":"58abd8a1ba30eedef47649093a37291e29f21e00","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/hello.png","hash":"732ba80324b66a3ff47fafbde89f4c61dfb04a08","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png","hash":"f5b2995f300b1302e437ef8d4736341a3d5e7661","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png","hash":"ae7bd83a3077c4f1a1f85211321932ab2e8df3cd","modified":1478482378000},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png","hash":"a5ac1810938b8750268386ac39bbacfbf196c546","modified":1478482378000},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png","hash":"a5ac1810938b8750268386ac39bbacfbf196c546","modified":1478482378000},{"_id":"source/_posts/2017/04/25/node-command-option/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1491464674000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos.png","hash":"79e6dfb76d3585a5af23df5a2b185631ede2f179","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/zookeeper.png","hash":"24357ecf44a1046d4f9191bc7d27ffa4f5957b8c","modified":1478482378000},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.png","hash":"463575f691b762eb0dc52cdbf220b784024d4abf","modified":1478482378000},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.png","hash":"8295624fb096ba56f23e89e821a6453f54d55d25","modified":1478482378000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/email.png","hash":"44c53c1fcaca35c97dddd008586d05b31c2b90c0","modified":1481101965000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser-share.png","hash":"d771a27d5a87b85c6a943909cbd37b01d42c7588","modified":1484576485000},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg","hash":"6232670f38f5ceffa2da0c246c0f5ac770c7d981","modified":1484987539000},{"_id":"source/_posts/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg","hash":"6232670f38f5ceffa2da0c246c0f5ac770c7d981","modified":1486774942000},{"_id":"source/_posts/2017/03/06/jquery-is-not-defined/fundebug-jquery-error.png","hash":"fd4bd810e3c52f028577273582147b8881e037ac","modified":1488701869000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/fundebug-sourcemap.jpg","hash":"e71ed7627d1ab8bf4be327059d75f56ec0ac1fc0","modified":1488339954000},{"_id":"source/_posts/2017/04/05/understand-script-error/script-error-not-ok-chrome.png","hash":"021ba480b510c578a369e54ffaa7f7734857498a","modified":1491482164000},{"_id":"source/_posts/2017/04/17/about-docker-sock/01.png","hash":"9b5f698f81af9723a21528003889a57ed3bfd61d","modified":1492243001000},{"_id":"source/_posts/2017/04/17/about-docker-sock/02.png","hash":"6ad227ec3576ad6fc49a2f173f91e3e2bfc495ad","modified":1492243029000},{"_id":"source/_posts/2017/04/17/about-docker-sock/docker.JPG","hash":"a19f09cd2df10569384698159055b3e5652ccbcd","modified":1492243789000},{"_id":"source/_posts/2017/04/18/docker-system-explain/docker.JPG","hash":"a19f09cd2df10569384698159055b3e5652ccbcd","modified":1492243789000},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png","hash":"c3762c5e96023233997aef60d1c1e678d1998ba2","modified":1478482378000},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png","hash":"c3762c5e96023233997aef60d1c1e678d1998ba2","modified":1478482378000},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png","hash":"a4470187ff958413325ce3241dfea734d05ad4ef","modified":1478482378000},{"_id":"source/_posts/2017/04/24/ssh-port-forwarding/socket_proxy.png","hash":"17ed271eeb6558c6c5eb7f8e3d4be6e17d254581","modified":1492771954000},{"_id":"source/_posts/2017/04/24/ssh-port-forwarding/ssh_tunnel.jpeg","hash":"619c3047356b10d9731212abf42b43ad915a6c77","modified":1492999665000},{"_id":"source/_posts/2017/03/20/nodejs-unit-test/nodejs-unit-test.jpg","hash":"81a6dbd93a561f7fab4b867308bcae4dbd6e118b","modified":1489998390000},{"_id":"source/_posts/2017/03/29/user-behavior-track/fundebug-track-behavior.png","hash":"4cdf29106cfbd471f55d1801dc904c8adce73c4c","modified":1491037391000},{"_id":"source/_posts/2017/04/07/solve-script-error/script-error.png","hash":"1c884cc78784cd80d8cdc1e36bfb2b18471db030","modified":1491528336000},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png","hash":"d980b3c3af38a43af0168fd7defe0ded28be9652","modified":1478482378000},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-detail.png","hash":"aa35e26788a38cd49e492ba18c593f222323d7ae","modified":1481102064000},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap1.png","hash":"f3b042839974f56278c49f9260a349389c3494af","modified":1489291089000},{"_id":"source/_posts/2017/04/05/understand-script-error/script-error-ok.png","hash":"4a0d1dd17e797c2df8e9ec39048c6bac4646beed","modified":1491482164000},{"_id":"source/_posts/2017/04/05/understand-script-error/script-error.png","hash":"8bbfca2aeae2f8bf97044fd8b3a4adb18a46fcb3","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/2.png","hash":"d3302f43e94db29b75cf77743b3abe3fc61eed79","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/script-error.png","hash":"8bbfca2aeae2f8bf97044fd8b3a4adb18a46fcb3","modified":1491482164000},{"_id":"themes/light/source/img/kiwenlau.jpg","hash":"e163949f9617ee5a0b92ef131f6e2bb57a2c0e36","modified":1478482378000},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Mesos.png","hash":"5fbab0dbc5d46b0caa4fab577a0de8c174c0eab6","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.graffle","hash":"4383e6048a4699bb494d20ce8d1490d10c550b35","modified":1478482378000},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png","hash":"aa5290c71ba1721e39ed42fbef45465df0636699","modified":1478482378000},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser.jpg","hash":"408c2c7589aebb85837af85218230b32b5d63300","modified":1484576485000},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png","hash":"d877b65ca99e60fd05e04df49c83decda3e59e50","modified":1478482378000},{"_id":"source/_posts/2017/04/06/test-script-error/4.png","hash":"ba702785709216fa94239ff694b6328187ebb267","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/1.png","hash":"593bc8666eac82ccceefda8c4f9c028b25fad8c2","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/012.png","hash":"44b4f84e79cca059b987f4c6204dceeb1fbe42a4","modified":1491482164000},{"_id":"source/_posts/2017/04/06/test-script-error/5.png","hash":"fa1380d3e4e5d863502168ab3aab545eb85fcb66","modified":1491482164000},{"_id":"source/_posts/2017/04/07/solve-script-error/qiniu.png","hash":"618bdb7709998c629e81d392d93a9ace70516db3","modified":1491482164000},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.graffle","hash":"02a2b9ae30a9ee599151160d6a9eaf7f10661ebb","modified":1478482378000},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png","hash":"a54ce970b4aef1d48bb0eadd2b2b8290d8987557","modified":1478482378000},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png","hash":"0e96c1b51dcd1102d2c000f2510fedeb356d2b02","modified":1478482378000},{"_id":"public/baidusitemap.xml","hash":"9bf1fccb2bf42751358f90fe764425ca1433c80c","modified":1493210373758},{"_id":"public/atom.xml","hash":"984071f667dc3d317e1bfcc876eadded72409f33","modified":1493210374765},{"_id":"public/sitemap.xml","hash":"8c2423a5a70d0f1028bfc32113388e5ec0e5bad3","modified":1493210374766},{"_id":"public/archives/page/3/index.html","hash":"8797512f778fc0651e85ba12a7015bf11d1e98a4","modified":1493210374817},{"_id":"public/archives/2015/index.html","hash":"3aeed6767434c0d14666cd18dac089f1375a1c48","modified":1493210374817},{"_id":"public/archives/2015/06/index.html","hash":"f124e071029ec95575baa7cc1446c22631eca077","modified":1493210374817},{"_id":"public/archives/2015/09/index.html","hash":"610c7d211b38bd5eae1fda8ab6a80cb1757acb7b","modified":1493210374817},{"_id":"public/archives/2015/11/index.html","hash":"14be5852c4a479824a005982dc66d5601af5fa58","modified":1493210374818},{"_id":"public/archives/2016/index.html","hash":"d2c9e1e33675dd3f500cee9abd54ec160892a064","modified":1493210374818},{"_id":"public/archives/2016/01/index.html","hash":"15592686ad2b0d1481d13064fea7b8d22abb0c17","modified":1493210374818},{"_id":"public/archives/2016/05/index.html","hash":"b691854eb25047ed00d77192c9d1cd86fad569da","modified":1493210374818},{"_id":"public/archives/2016/06/index.html","hash":"b6b90ad0284049f98b9a6363e2c0c5ef82413850","modified":1493210374818},{"_id":"public/archives/2016/07/index.html","hash":"7d99ad923f8f6b1cf95e008cfb3b3b6591ba91a8","modified":1493210374819},{"_id":"public/archives/2016/09/index.html","hash":"7a28022071dcd851da5072fb218d0027e6ac1f06","modified":1493210374819},{"_id":"public/archives/2016/11/index.html","hash":"bc68f197a9f1715c901f61e3ef8aed9e711bb1ea","modified":1493210374819},{"_id":"public/archives/2016/12/index.html","hash":"2cf8f2e665b1c282c7d44a07fe2b12d94a8311c0","modified":1493210374819},{"_id":"public/archives/2017/page/2/index.html","hash":"61b618c5951f58708724a2064e404d17cc930360","modified":1493210374819},{"_id":"public/archives/2017/01/index.html","hash":"e24f62b619fc852671577c8de37379f2321428d9","modified":1493210374819},{"_id":"public/archives/2017/02/index.html","hash":"3218a6eccd6ec0053a1ad2e67b5113b760b8b2dd","modified":1493210374819},{"_id":"public/archives/2017/03/index.html","hash":"4bf6e7f810dd170a06f52e549fe279f67644d5f0","modified":1493210374819},{"_id":"public/archives/2017/04/index.html","hash":"a3bef0f2e2ea51c6b14b406c6f55a7cff2181e1e","modified":1493210374819},{"_id":"public/tags/Fundebug/index.html","hash":"e40961e198f0df8248cf7e92e93c6c770fad5abf","modified":1493210374819},{"_id":"public/tags/Hadoop/index.html","hash":"5418ea866fbb02d39da3728252acf250067fdf15","modified":1493210374819},{"_id":"public/tags/Docker/index.html","hash":"685608a93f4709d13b9fb11a6d75bcb029f1ec44","modified":1493210374821},{"_id":"public/tags/Kubernetes/index.html","hash":"fd833555c64b2b96ca40161c540a8f1809828152","modified":1493210374821},{"_id":"public/tags/Vagrant/index.html","hash":"28b0c97d24deeff846e6c857e15f84ef8a8c80e2","modified":1493210374821},{"_id":"public/tags/Mesos/index.html","hash":"9035f4feada93a6ef21d219ccd9dc02389bc5ff8","modified":1493210374821},{"_id":"public/tags/Marathon/index.html","hash":"99f6b2c90d8f563232ca818eaef47c77484f0928","modified":1493210374821},{"_id":"public/tags/Node-js/index.html","hash":"289cee7806ee7bfe0a2caf35e2d0c386154d064b","modified":1493210374821},{"_id":"public/tags/MongoDB/index.html","hash":"900b12c70930cbf973a4048237c1a9a3ce780478","modified":1493210374821},{"_id":"public/tags/小程序/index.html","hash":"7e3a6a2f5527b3cf2884f065f31ea1efba9c5ded","modified":1493210374821},{"_id":"public/tags/JavaScript/index.html","hash":"2085914a127f06b547de04948d2ebb537862bedd","modified":1493210374821},{"_id":"public/tags/Source-Map/index.html","hash":"67f92ad2832ecde6780e6ba8127cf7631268d370","modified":1493210374821},{"_id":"public/tags/翻译/index.html","hash":"06fef9033892512db12fdf7ca77c79db33dddc1d","modified":1493210374821},{"_id":"public/tags/BUG/index.html","hash":"bd7429930436f993ecd1b7a44d7803a690e3c652","modified":1493210374821},{"_id":"public/tags/Linux/index.html","hash":"de63c0dc595ce66a78cf854c19bcfa4545262356","modified":1493210374822},{"_id":"public/2017/04/25/node-command-option/index.html","hash":"5fa0c3c055323c2234688a104741e515fce93735","modified":1493210374822},{"_id":"public/2017/04/24/ssh-port-forwarding/index.html","hash":"a338461430f4467c639071db38d05344cb222bc7","modified":1493210374822},{"_id":"public/2017/04/18/docker-system-explain/index.html","hash":"9e8911e30a84f7ac356016f4103763d3691a8a99","modified":1493210374822},{"_id":"public/2017/04/17/about-docker-sock/index.html","hash":"616919e3687993874500a2df4fe3b53aa43e97ac","modified":1493210374822},{"_id":"public/2017/04/10/nodejs-interview-2017/index.html","hash":"d8239136da8135f83af39c8e2b9290f045b3737c","modified":1493210374822},{"_id":"public/2017/04/07/solve-script-error/index.html","hash":"39d6f701f1146394dc3dd71126273afc12bae56f","modified":1493210374822},{"_id":"public/2017/04/06/test-script-error/index.html","hash":"fef0ac77eb09c63fe2d6c68b8c85f04c8cc1d51a","modified":1493210374822},{"_id":"public/2017/04/01/nodejs-async-await/index.html","hash":"f3685b690fd4ff24c7a6c58bae7ab2f4965e1ef9","modified":1493210374822},{"_id":"public/2017/04/05/understand-script-error/index.html","hash":"2cbbf2cf92bc461f12deb482c06fbc9d5d68ee01","modified":1493210374822},{"_id":"public/2017/03/29/user-behavior-track/index.html","hash":"a8aa3db0b460a922f0e847a696191cb74ffa742e","modified":1493210374822},{"_id":"public/2017/03/26/nodejs-docker/index.html","hash":"f44d665d57c10e21c89f9cd15f401e871c223b5e","modified":1493210374822},{"_id":"public/2017/03/20/nodejs-unit-test/index.html","hash":"2e2dc855cfb0726b8528c601103f540d77817248","modified":1493210374822},{"_id":"public/2017/03/17/fundebug-support-nodejs/index.html","hash":"09a5be95b638851e244452d102bcce47a2c026d6","modified":1493210374822},{"_id":"public/2017/03/13/sourcemap-tutorial/index.html","hash":"0fdd67f9405dd56ff3f9f3968c537276019f8b19","modified":1493210374823},{"_id":"public/2017/03/06/jquery-is-not-defined/index.html","hash":"6192ae5b6c6806fffe539234f3cc488c5ea38a65","modified":1493210374823},{"_id":"public/2017/02/18/weixinjsbridge-is-not-defined/index.html","hash":"d4f231d434294b8af8ab4fe54de56179538641dd","modified":1493210374823},{"_id":"public/2017/02/11/weixin-miniprogram-need-fundebug/index.html","hash":"0fa75fc87d016a10e48219e178e41b7038bb215d","modified":1493210374823},{"_id":"public/2017/01/23/fundebug-support-wxjs/index.html","hash":"72d03899d744d943d5ac0d5ea095754356b80cbd","modified":1493210374823},{"_id":"public/2017/01/16/fundebug-support-all-browsers/index.html","hash":"4ec119f7d26520746046dca7b77797adcd18280b","modified":1493210374823},{"_id":"public/2016/12/07/fundebug-catch-the-bug/index.html","hash":"76cb6ec5bcd3131446b1c8f5abe580cae3157b64","modified":1493210374823},{"_id":"public/2016/11/fundebug-is-online/index.html","hash":"26162e07710ff043bda3c44fb7db0b978f91e1ab","modified":1493210374823},{"_id":"public/2016/09/18/underscore-example/index.html","hash":"7500703e609dac5f52efdbae50daf4e7d2932bf5","modified":1493210374824},{"_id":"public/2016/09/11/mongodb-inverted-index/index.html","hash":"6feb769fe500f23807240f0c2af293f592d4cbac","modified":1493210374824},{"_id":"public/2016/09/04/what-is-service-discovery/index.html","hash":"09e23f5eb24d1c2eae383b46d7f08e1ebe327c20","modified":1493210374824},{"_id":"public/2016/07/10/mesos-marathon-platform/index.html","hash":"1b8fefa641d2d526df924c493548b671c7ef71d7","modified":1493210374824},{"_id":"public/2016/07/03/vagrant-vm-cluster/index.html","hash":"5cdd05551c70d2a22249eb7eebd5cbba7037dd85","modified":1493210374824},{"_id":"public/2016/06/26/hadoop-cluster-docker-update-english/index.html","hash":"0c30be698561f21fbf169b80e93ed4850d1c055c","modified":1493210374824},{"_id":"public/2016/06/19/160619-vagrant-virtual-machine/index.html","hash":"44544de0ffcdafa70476ae8ec9bc420f95400e03","modified":1493210374824},{"_id":"public/2016/06/12/160612-hadoop-cluster-docker-update/index.html","hash":"b5526ea86b00c4e75f7912006b1f92253ff6f8e4","modified":1493210374824},{"_id":"public/2016/06/05/160605-compile-hadoop-docker/index.html","hash":"aeba336a532742680b20b0092c0734aa8dc83858","modified":1493210374824},{"_id":"public/2016/05/29/160529-compile-hadoop-ubuntu/index.html","hash":"5cb2310ee0f475205b77c5fae5325a87f0333e58","modified":1493210374824},{"_id":"public/2016/01/09/160109-multiple-processes--docker-container/index.html","hash":"82de90a5cefa0c5710bedd7281902feedb069217","modified":1493210374824},{"_id":"public/2015/11/28/151128-single-kubernetes-docker/index.html","hash":"6d6068a079f76bd4d38a3dcd86f180a7c90f7623","modified":1493210374824},{"_id":"public/2015/09/18/150918-single-mesos-docker/index.html","hash":"e88fdf31a940d1213ec95b676a08053e1f75c912","modified":1493210374824},{"_id":"public/2015/06/08/150608-hadoop-cluster-docker/index.html","hash":"528611d4aeb1025ce7f33c4d1035cf7e3ce40da8","modified":1493210374824},{"_id":"public/archives/index.html","hash":"59ce3896e7183a39f431e575d7cf7dd03080ac49","modified":1493210374824},{"_id":"public/archives/page/2/index.html","hash":"8f711fba9ab2ef89183971ed31400c36b918d033","modified":1493210374825},{"_id":"public/archives/2017/index.html","hash":"ff05e3711e85d6136311c3e81421269e1e0edb3c","modified":1493210374825},{"_id":"public/index.html","hash":"c6cfbd116117d89079f2740fd90c8676530e075d","modified":1493210374825},{"_id":"public/page/2/index.html","hash":"ed4bd926051e22ed60d5cd2cf4091dd57cf17d79","modified":1493210374825},{"_id":"public/page/3/index.html","hash":"a46b10c9746405075deb88358dfb8ab45c3b603a","modified":1493210374825},{"_id":"public/robots.txt","hash":"b7d8a5701d5fb60fda9e17342c5fed7aec6b3ab2","modified":1493210374846},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1493210374846},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1493210374846},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1493210374846},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1493210374846},{"_id":"public/img/fundebug.png","hash":"5470ee921cb4160af726031d01324e57eae2ea84","modified":1493210374846},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1493210374846},{"_id":"public/img/github.png","hash":"8e4af8e0da1da6fb685e86c19afb5322d559a8ca","modified":1493210374846},{"_id":"public/img/segmentfault.jpeg","hash":"023e7eef6165635b2fee0fc013a8c45b0358a547","modified":1493210374846},{"_id":"public/img/totop.png","hash":"74f4b1e0f3b47a1a27cee4a8cb712eb33994ca41","modified":1493210374846},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1493210374846},{"_id":"public/css/font/fontawesome-webfont.woff","hash":"0612cddf2f835cceffccc88fd194f97367d0b024","modified":1493210374846},{"_id":"public/css/font/fontawesome-webfont.eot","hash":"d775f599ff3f23be082e6a9604b4898718923a37","modified":1493210374846},{"_id":"public/2017/02/18/weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png","hash":"215c53767524334d5357327cc21c13810253af57","modified":1493210374847},{"_id":"public/2017/03/17/fundebug-support-nodejs/fundebug-nodejs.png","hash":"bd274c08206ef29cd8eb6605bbd656c1a430a1d3","modified":1493210374847},{"_id":"public/2015/06/08/150608-hadoop-cluster-docker/image-architecture.graffle","hash":"363be32d8d54a021835f2125e7d93ab5f07ee3e1","modified":1493210374847},{"_id":"public/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.graffle","hash":"851a2ee0c92e642e4dffedaac3fcaef10d216806","modified":1493210374847},{"_id":"public/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.graffle","hash":"87e9b82b8aebd6a0239bc1582dec43e8356bf0d1","modified":1493210374847},{"_id":"public/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png","hash":"018c8ad81bcf1ad54778e761bf6c630403eb5e80","modified":1493210374847},{"_id":"public/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.graffle","hash":"33e193fb0f5600d82ebc8da745b09b2ae8d88e15","modified":1493210374847},{"_id":"public/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.graffle","hash":"7b5bd9e08cc3b4fc85dc7a04f106be0de6edd34b","modified":1493210374847},{"_id":"public/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.graffle","hash":"281797ad8328ad5a147bfaeb4aa33c127d839e8f","modified":1493210374847},{"_id":"public/2016/09/04/what-is-service-discovery/service-discovery.graffle","hash":"d1c17c50056f8e3757d9a3fe686223cf62322d13","modified":1493210374847},{"_id":"public/2016/09/18/underscore-example/underscore-example.graffle","hash":"73758ad67c6d2d8e04112b931a5babc5bb09af24","modified":1493210374847},{"_id":"public/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.graffle","hash":"9a2bac1e19c9299faf7e698b2feabde9717bad76","modified":1493210374847},{"_id":"public/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.graffle","hash":"b3e35ad7747c984f5069ad3589677e599395e34d","modified":1493210374847},{"_id":"public/2017/01/23/fundebug-support-wxjs/empty.png","hash":"d65573fd992349739115b21172ac24bb94857393","modified":1493210374847},{"_id":"public/2017/03/29/user-behavior-track/user-behavior-track.png","hash":"9781503a6149724661d1ebd37f4613f8ab11b260","modified":1493210374847},{"_id":"public/2017/03/20/nodejs-unit-test/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1493210374847},{"_id":"public/2017/03/26/nodejs-docker/nodejs-docker.png","hash":"8dc7707af9d54eb127033b7a2b095ada92040500","modified":1493210374848},{"_id":"public/2017/03/26/nodejs-docker/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1493210374848},{"_id":"public/2016/12/07/fundebug-catch-the-bug/error-count.png","hash":"59a70b42bafe6159b1f56b07dffab29ecc84e9b8","modified":1493210374848},{"_id":"public/2017/04/01/nodejs-async-await/debug-async-await.png","hash":"9c929ae2c852697158369a4887b8258ded4e384e","modified":1493210374848},{"_id":"public/2017/04/01/nodejs-async-await/debug-promise.png","hash":"a6eff38be217603deebeb7500e85fc76e276bc41","modified":1493210374848},{"_id":"public/2017/04/01/nodejs-async-await/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1493210374848},{"_id":"public/2017/04/07/solve-script-error/QRCode.png","hash":"17815e593b4f7cdb21ed9a0359db8dbc0f146bf3","modified":1493210374848},{"_id":"public/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.graffle","hash":"851a2ee0c92e642e4dffedaac3fcaef10d216806","modified":1493210374848},{"_id":"public/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.graffle","hash":"927aa0c3be32943949d17fa5455c2602a56c87fa","modified":1493210374848},{"_id":"public/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.graffle","hash":"7dcd48d344e3dc1c7bbcce0871aa44cc4f1f10a8","modified":1493210374848},{"_id":"public/2017/03/13/sourcemap-tutorial/chrome-sourcemap2.png","hash":"1e2e294e51d0102a572ce1c3e7e382fe0a47fdd5","modified":1493210374848},{"_id":"public/2017/03/13/sourcemap-tutorial/chrome-sourcemap3.png","hash":"4e36737f6568097035a5dc8a74bc676b0c1969e6","modified":1493210374848},{"_id":"public/2017/03/13/sourcemap-tutorial/chrome-sourcemap4.png","hash":"3f547d91548dadf50dd22eb2dc0270a63bed9bfa","modified":1493210374848},{"_id":"public/2016/07/10/mesos-marathon-platform/marathon.png","hash":"a3846ef25a058da2f9d67e5690bd501a3d1f94ff","modified":1493210374848},{"_id":"public/2016/07/10/mesos-marathon-platform/nginx.png","hash":"e98b0adf233b13140e2a03a4feb8dc0f8f459af5","modified":1493210374848},{"_id":"public/2017/04/25/node-command-option/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1493210374848},{"_id":"public/2017/04/10/nodejs-interview-2017/test_pyramid.png","hash":"5c21f9680fb220e7bc04a785f59bb8aec3b3b2e5","modified":1493210374848},{"_id":"public/2017/04/10/nodejs-interview-2017/nodejs-qq-group.jpeg","hash":"38c7a1dd20184bba0651141c35a77ce0ac8047ac","modified":1493210374848},{"_id":"public/2017/04/06/test-script-error/01.png","hash":"657446d2083265735302bcc2d4bf2cc95f57c4bc","modified":1493210374848},{"_id":"public/2017/04/06/test-script-error/1chrome.png","hash":"d92a971123f6eab071c5b791191667b809e979b2","modified":1493210374848},{"_id":"public/2017/04/06/test-script-error/2firefox.png","hash":"b146496f3793a96d4ee3e8d7cb1cbaaefea04832","modified":1493210374849},{"_id":"public/2017/04/06/test-script-error/chrome_error.png","hash":"bec33c134ddd7f1d1f2df6f4f6b6fe7fa89478b8","modified":1493210374849},{"_id":"public/img/alipay.JPG","hash":"3a0ac497613bb00f56e0aec63b8864cc150dcde4","modified":1493210375344},{"_id":"public/img/kiwenlau.ico","hash":"987d9c1658c3779037d96f49d8779b9bab18440b","modified":1493210375345},{"_id":"public/css/font/fontawesome-webfont.ttf","hash":"a9468f6a1fe965fbcaf5a1bd6c11705e2fc5f84c","modified":1493210375347},{"_id":"public/css/font/fontawesome-webfont.svg","hash":"d162419c91b8bab3a4fd327c933a0fcf3799c251","modified":1493210375347},{"_id":"public/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg","hash":"6232670f38f5ceffa2da0c246c0f5ac770c7d981","modified":1493210375347},{"_id":"public/2017/03/06/jquery-is-not-defined/fundebug-jquery-error.png","hash":"fd4bd810e3c52f028577273582147b8881e037ac","modified":1493210375348},{"_id":"public/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png","hash":"a5ac1810938b8750268386ac39bbacfbf196c546","modified":1493210375348},{"_id":"public/2016/09/04/what-is-service-discovery/service-discovery.png","hash":"8295624fb096ba56f23e89e821a6453f54d55d25","modified":1493210375348},{"_id":"public/2016/09/18/underscore-example/underscore-example.png","hash":"463575f691b762eb0dc52cdbf220b784024d4abf","modified":1493210375348},{"_id":"public/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png","hash":"a5ac1810938b8750268386ac39bbacfbf196c546","modified":1493210375348},{"_id":"public/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg","hash":"6232670f38f5ceffa2da0c246c0f5ac770c7d981","modified":1493210375348},{"_id":"public/2017/01/16/fundebug-support-all-browsers/browser-share.png","hash":"d771a27d5a87b85c6a943909cbd37b01d42c7588","modified":1493210375348},{"_id":"public/2016/12/07/fundebug-catch-the-bug/email.png","hash":"44c53c1fcaca35c97dddd008586d05b31c2b90c0","modified":1493210375348},{"_id":"public/2017/04/05/understand-script-error/script-error-not-ok-chrome.png","hash":"021ba480b510c578a369e54ffaa7f7734857498a","modified":1493210375348},{"_id":"public/2015/09/18/150918-single-mesos-docker/Marathon.png","hash":"58abd8a1ba30eedef47649093a37291e29f21e00","modified":1493210375348},{"_id":"public/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png","hash":"ae7bd83a3077c4f1a1f85211321932ab2e8df3cd","modified":1493210375348},{"_id":"public/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png","hash":"f5b2995f300b1302e437ef8d4736341a3d5e7661","modified":1493210375349},{"_id":"public/2015/09/18/150918-single-mesos-docker/hello.png","hash":"732ba80324b66a3ff47fafbde89f4c61dfb04a08","modified":1493210375349},{"_id":"public/2017/03/13/sourcemap-tutorial/fundebug-sourcemap.jpg","hash":"e71ed7627d1ab8bf4be327059d75f56ec0ac1fc0","modified":1493210375349},{"_id":"public/2016/07/10/mesos-marathon-platform/mesos.png","hash":"79e6dfb76d3585a5af23df5a2b185631ede2f179","modified":1493210375349},{"_id":"public/2016/07/10/mesos-marathon-platform/zookeeper.png","hash":"24357ecf44a1046d4f9191bc7d27ffa4f5957b8c","modified":1493210375349},{"_id":"public/2017/04/18/docker-system-explain/docker.JPG","hash":"a19f09cd2df10569384698159055b3e5652ccbcd","modified":1493210375349},{"_id":"public/2017/04/24/ssh-port-forwarding/socket_proxy.png","hash":"17ed271eeb6558c6c5eb7f8e3d4be6e17d254581","modified":1493210375349},{"_id":"public/2017/04/24/ssh-port-forwarding/ssh_tunnel.jpeg","hash":"619c3047356b10d9731212abf42b43ad915a6c77","modified":1493210375350},{"_id":"public/2017/04/17/about-docker-sock/02.png","hash":"6ad227ec3576ad6fc49a2f173f91e3e2bfc495ad","modified":1493210375350},{"_id":"public/2017/04/17/about-docker-sock/01.png","hash":"9b5f698f81af9723a21528003889a57ed3bfd61d","modified":1493210375350},{"_id":"public/2017/04/17/about-docker-sock/docker.JPG","hash":"a19f09cd2df10569384698159055b3e5652ccbcd","modified":1493210375350},{"_id":"public/css/style.css","hash":"ccd771c6683ef7b4b908eb47a30a16ccf115620b","modified":1493210375359},{"_id":"public/fancybox/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1493210375359},{"_id":"public/js/gallery.js","hash":"f8b17fc2dbd4fb939bb872d1232b404049355cfa","modified":1493210375359},{"_id":"public/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1493210375359},{"_id":"public/js/pv.js","hash":"1308c652c3f8b2c4ec1bd8a19cf7706243e9fbb5","modified":1493210375359},{"_id":"public/js/totop.js","hash":"8fbd5fb07b1397839b75636607fa66e3391b4182","modified":1493210375359},{"_id":"public/js/blog/20170306_ip.js","hash":"e7afe8f904a71e938c9cae17e4612c113694b9e7","modified":1493210375360},{"_id":"public/js/blog/20170306_time.js","hash":"f03d03c5f3fef48f6200f44e73e3efee6a71bcae","modified":1493210375360},{"_id":"public/css/gitment.css","hash":"7fbb18b73b44ed11193739c55fce53a6f173cf68","modified":1493210375360},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1493210375360},{"_id":"public/js/gitment.js","hash":"376446d9c5930576016f97dd63e5e6616c94d8d4","modified":1493210375360},{"_id":"public/js/highcharts.js","hash":"22f512de32b98166405948cd4c8e46f0f25cd8a3","modified":1493210375360},{"_id":"public/js/jquery.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1493210375360},{"_id":"public/img/wechat.JPG","hash":"f7a0e2917a259dc9d4baf4cd13788ebe6ddb3547","modified":1493210375360},{"_id":"public/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png","hash":"c3762c5e96023233997aef60d1c1e678d1998ba2","modified":1493210375360},{"_id":"public/2016/11/fundebug-is-online/with_fundebug.jpg","hash":"21c5b66c47b82be0faaac29d39a09922587e1ef8","modified":1493210375360},{"_id":"public/2016/11/fundebug-is-online/without_fundebug.jpg","hash":"0e677ff142f135356f97dc2975192c74aa153245","modified":1493210375360},{"_id":"public/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png","hash":"a4470187ff958413325ce3241dfea734d05ad4ef","modified":1493210375360},{"_id":"public/2017/03/29/user-behavior-track/fundebug-track-behavior.png","hash":"4cdf29106cfbd471f55d1801dc904c8adce73c4c","modified":1493210375361},{"_id":"public/2017/03/20/nodejs-unit-test/nodejs-unit-test.jpg","hash":"81a6dbd93a561f7fab4b867308bcae4dbd6e118b","modified":1493210375361},{"_id":"public/2017/04/07/solve-script-error/script-error.png","hash":"1c884cc78784cd80d8cdc1e36bfb2b18471db030","modified":1493210375361},{"_id":"public/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png","hash":"c3762c5e96023233997aef60d1c1e678d1998ba2","modified":1493210375361},{"_id":"public/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png","hash":"d980b3c3af38a43af0168fd7defe0ded28be9652","modified":1493210375375},{"_id":"public/2016/12/07/fundebug-catch-the-bug/error-detail.png","hash":"aa35e26788a38cd49e492ba18c593f222323d7ae","modified":1493210375375},{"_id":"public/2017/03/13/sourcemap-tutorial/chrome-sourcemap1.png","hash":"f3b042839974f56278c49f9260a349389c3494af","modified":1493210375376},{"_id":"public/2017/04/05/understand-script-error/script-error-ok.png","hash":"4a0d1dd17e797c2df8e9ec39048c6bac4646beed","modified":1493210375376},{"_id":"public/2017/04/05/understand-script-error/script-error.png","hash":"8bbfca2aeae2f8bf97044fd8b3a4adb18a46fcb3","modified":1493210375376},{"_id":"public/2017/04/06/test-script-error/script-error.png","hash":"8bbfca2aeae2f8bf97044fd8b3a4adb18a46fcb3","modified":1493210375377},{"_id":"public/2017/04/06/test-script-error/2.png","hash":"d3302f43e94db29b75cf77743b3abe3fc61eed79","modified":1493210375377},{"_id":"public/2015/09/18/150918-single-mesos-docker/Mesos.png","hash":"5fbab0dbc5d46b0caa4fab577a0de8c174c0eab6","modified":1493210375390},{"_id":"public/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.graffle","hash":"4383e6048a4699bb494d20ce8d1490d10c550b35","modified":1493210375391},{"_id":"public/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png","hash":"aa5290c71ba1721e39ed42fbef45465df0636699","modified":1493210375391},{"_id":"public/2017/01/16/fundebug-support-all-browsers/browser.jpg","hash":"408c2c7589aebb85837af85218230b32b5d63300","modified":1493210375391},{"_id":"public/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png","hash":"d877b65ca99e60fd05e04df49c83decda3e59e50","modified":1493210375400},{"_id":"public/2017/04/06/test-script-error/4.png","hash":"ba702785709216fa94239ff694b6328187ebb267","modified":1493210375400},{"_id":"public/2017/04/07/solve-script-error/qiniu.png","hash":"618bdb7709998c629e81d392d93a9ace70516db3","modified":1493210375408},{"_id":"public/2017/04/06/test-script-error/012.png","hash":"44b4f84e79cca059b987f4c6204dceeb1fbe42a4","modified":1493210375408},{"_id":"public/2017/04/06/test-script-error/1.png","hash":"593bc8666eac82ccceefda8c4f9c028b25fad8c2","modified":1493210375408},{"_id":"public/2017/04/06/test-script-error/5.png","hash":"fa1380d3e4e5d863502168ab3aab545eb85fcb66","modified":1493210375409},{"_id":"public/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.graffle","hash":"02a2b9ae30a9ee599151160d6a9eaf7f10661ebb","modified":1493210375419},{"_id":"public/img/kiwenlau.jpg","hash":"e163949f9617ee5a0b92ef131f6e2bb57a2c0e36","modified":1493210375433},{"_id":"public/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png","hash":"a54ce970b4aef1d48bb0eadd2b2b8290d8987557","modified":1493210375434},{"_id":"public/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png","hash":"0e96c1b51dcd1102d2c000f2510fedeb356d2b02","modified":1493210375558}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"Fundebug上线了！","date":"2016-11-10T16:00:00.000Z","_content":"\n当我们解决了一个又一个Bug，然后进行了一轮又一轮代码审查，之后又跑了一遍又一遍测试，代码终于上线了！\n\n<!-- more -->\n\n然而，我们能够保证上线的代码一定没有Bug吗？似乎没有人可以这样肯定。\n\n用户使用应用的画风很可能是这样的:\n\n- 为啥『注册』按键点击了半天没有反应？！\n- 为啥『激活邮件』一直木有收到？！\n- 为啥狂按F5时页面并没有更新？！\n- 为啥APP莫名其妙地闪退了？！\n- ......\n\n这时，用户的内心是崩溃的，『这是什么破软件？果断弃了』。我们可怜的程序员如果知道挨骂了，也表示很无语，明明单元测试都通过了啊，覆盖率妥妥的100%有木有。。。\n\n其实呢，线上代码出Bug也是很正常的事：\n\n- 一些意想不到的边界条件（内存溢出，死循环，Null, Undefined）;\n- 代码的运行环境（各种浏览器，各种手机）千变万化;\n- 代码运行依赖的系统比如数据库(MySQL, MongoDB, Redis)偶尔抽风;\n- 峰值情况下网络超时，CPU和内存超负荷;\n- ......\n\n还有，网页应用是运行在用户的浏览器上，APP是运行在用户的手机上，所以应用出错的时候程序员是不知道的，这样的话，就无法及时解决Bug，用户体验是很不好的。\n\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/without_fundebug.jpg\" />\n</a>\n</div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n\n那么，您是否需要稳定，安全，智能的错误实时监控与纠错辅助服务？如果需要，[Fundebug](https://fundebug.com/)已经正式上线了，赶紧[免费注册](https://fundebug.com/team/create)吧!\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\" />\n</a>\n</div>\n\nFundebug, Debug with Fun! 我们致力于提供最专业的Bug实时监测服务，让Debug变得更加高效而有趣。目前我们提供JavaScript实时监测服务，您只需要添加一行代码:\n\n```\n<script src=\"https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js\" apikey=\"YOUR-API-KEY-HERE\"></script>\n```\n\n使用Fundebug，您就可以:\n\n- 邮件提醒，更及时地发现错误!\n- 智能面板，更方便地管理错误!\n- 任务分配，更高效地团队协助!\n- 错误搜索，更准确地定位错误！\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/with_fundebug.jpg\" />\n</a>\n</div>\n\n还等什么呢，赶紧为您的团队注册Fundebug帐号吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n\n\n","source":"_posts/2016/11/fundebug-is-online.md","raw":"---\ntitle: Fundebug上线了！\n\ndate: 2016-11-11 00:00:00\n\ntags: [Fundebug]\n\n---\n\n当我们解决了一个又一个Bug，然后进行了一轮又一轮代码审查，之后又跑了一遍又一遍测试，代码终于上线了！\n\n<!-- more -->\n\n然而，我们能够保证上线的代码一定没有Bug吗？似乎没有人可以这样肯定。\n\n用户使用应用的画风很可能是这样的:\n\n- 为啥『注册』按键点击了半天没有反应？！\n- 为啥『激活邮件』一直木有收到？！\n- 为啥狂按F5时页面并没有更新？！\n- 为啥APP莫名其妙地闪退了？！\n- ......\n\n这时，用户的内心是崩溃的，『这是什么破软件？果断弃了』。我们可怜的程序员如果知道挨骂了，也表示很无语，明明单元测试都通过了啊，覆盖率妥妥的100%有木有。。。\n\n其实呢，线上代码出Bug也是很正常的事：\n\n- 一些意想不到的边界条件（内存溢出，死循环，Null, Undefined）;\n- 代码的运行环境（各种浏览器，各种手机）千变万化;\n- 代码运行依赖的系统比如数据库(MySQL, MongoDB, Redis)偶尔抽风;\n- 峰值情况下网络超时，CPU和内存超负荷;\n- ......\n\n还有，网页应用是运行在用户的浏览器上，APP是运行在用户的手机上，所以应用出错的时候程序员是不知道的，这样的话，就无法及时解决Bug，用户体验是很不好的。\n\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/without_fundebug.jpg\" />\n</a>\n</div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n\n那么，您是否需要稳定，安全，智能的错误实时监控与纠错辅助服务？如果需要，[Fundebug](https://fundebug.com/)已经正式上线了，赶紧[免费注册](https://fundebug.com/team/create)吧!\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\" />\n</a>\n</div>\n\nFundebug, Debug with Fun! 我们致力于提供最专业的Bug实时监测服务，让Debug变得更加高效而有趣。目前我们提供JavaScript实时监测服务，您只需要添加一行代码:\n\n```\n<script src=\"https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js\" apikey=\"YOUR-API-KEY-HERE\"></script>\n```\n\n使用Fundebug，您就可以:\n\n- 邮件提醒，更及时地发现错误!\n- 智能面板，更方便地管理错误!\n- 任务分配，更高效地团队协助!\n- 错误搜索，更准确地定位错误！\n\n<div style=\"text-align: center;\">\n<a href=\"https://fundebug.com\">\n<img style=\"width:80%;\" src=\"fundebug-is-online/with_fundebug.jpg\" />\n</a>\n</div>\n\n还等什么呢，赶紧为您的团队注册Fundebug帐号吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n\n\n","slug":"2016/11/fundebug-is-online","published":1,"updated":"2016-12-07T14:35:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywejf0000mkfyiwy1fvqs","content":"<p>&#x5F53;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E86;&#x4E00;&#x4E2A;&#x53C8;&#x4E00;&#x4E2A;Bug&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x8F6E;&#x53C8;&#x4E00;&#x8F6E;&#x4EE3;&#x7801;&#x5BA1;&#x67E5;&#xFF0C;&#x4E4B;&#x540E;&#x53C8;&#x8DD1;&#x4E86;&#x4E00;&#x904D;&#x53C8;&#x4E00;&#x904D;&#x6D4B;&#x8BD5;&#xFF0C;&#x4EE3;&#x7801;&#x7EC8;&#x4E8E;&#x4E0A;&#x7EBF;&#x4E86;&#xFF01;</p>\n<a id=\"more\"></a>\n<p>&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x4E0A;&#x7EBF;&#x7684;&#x4EE3;&#x7801;&#x4E00;&#x5B9A;&#x6CA1;&#x6709;Bug&#x5417;&#xFF1F;&#x4F3C;&#x4E4E;&#x6CA1;&#x6709;&#x4EBA;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x80AF;&#x5B9A;&#x3002;</p>\n<p>&#x7528;&#x6237;&#x4F7F;&#x7528;&#x5E94;&#x7528;&#x7684;&#x753B;&#x98CE;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<ul>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6CE8;&#x518C;&#x300F;&#x6309;&#x952E;&#x70B9;&#x51FB;&#x4E86;&#x534A;&#x5929;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6FC0;&#x6D3B;&#x90AE;&#x4EF6;&#x300F;&#x4E00;&#x76F4;&#x6728;&#x6709;&#x6536;&#x5230;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x72C2;&#x6309;F5&#x65F6;&#x9875;&#x9762;&#x5E76;&#x6CA1;&#x6709;&#x66F4;&#x65B0;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;APP&#x83AB;&#x540D;&#x5176;&#x5999;&#x5730;&#x95EA;&#x9000;&#x4E86;&#xFF1F;&#xFF01;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x5185;&#x5FC3;&#x662F;&#x5D29;&#x6E83;&#x7684;&#xFF0C;&#x300E;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x7834;&#x8F6F;&#x4EF6;&#xFF1F;&#x679C;&#x65AD;&#x5F03;&#x4E86;&#x300F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x601C;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5982;&#x679C;&#x77E5;&#x9053;&#x6328;&#x9A82;&#x4E86;&#xFF0C;&#x4E5F;&#x8868;&#x793A;&#x5F88;&#x65E0;&#x8BED;&#xFF0C;&#x660E;&#x660E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x90FD;&#x901A;&#x8FC7;&#x4E86;&#x554A;&#xFF0C;&#x8986;&#x76D6;&#x7387;&#x59A5;&#x59A5;&#x7684;100%&#x6709;&#x6728;&#x6709;&#x3002;&#x3002;&#x3002;</p>\n<p>&#x5176;&#x5B9E;&#x5462;&#xFF0C;&#x7EBF;&#x4E0A;&#x4EE3;&#x7801;&#x51FA;Bug&#x4E5F;&#x662F;&#x5F88;&#x6B63;&#x5E38;&#x7684;&#x4E8B;&#xFF1A;</p>\n<ul>\n<li>&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x8FB9;&#x754C;&#x6761;&#x4EF6;&#xFF08;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;Null, Undefined&#xFF09;;</li>\n<li>&#x4EE3;&#x7801;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF08;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5404;&#x79CD;&#x624B;&#x673A;&#xFF09;&#x5343;&#x53D8;&#x4E07;&#x5316;;</li>\n<li>&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x7684;&#x7CFB;&#x7EDF;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;(MySQL, MongoDB, Redis)&#x5076;&#x5C14;&#x62BD;&#x98CE;;</li>\n<li>&#x5CF0;&#x503C;&#x60C5;&#x51B5;&#x4E0B;&#x7F51;&#x7EDC;&#x8D85;&#x65F6;&#xFF0C;CPU&#x548C;&#x5185;&#x5B58;&#x8D85;&#x8D1F;&#x8377;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD8;&#x6709;&#xFF0C;&#x7F51;&#x9875;&#x5E94;&#x7528;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#xFF0C;APP&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x7528;&#x51FA;&#x9519;&#x7684;&#x65F6;&#x5019;&#x7A0B;&#x5E8F;&#x5458;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x53CA;&#x65F6;&#x89E3;&#x51B3;Bug&#xFF0C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x5F88;&#x4E0D;&#x597D;&#x7684;&#x3002;</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/without_fundebug.jpg\"><br></a><br></div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n<p>&#x90A3;&#x4E48;&#xFF0C;&#x60A8;&#x662F;&#x5426;&#x9700;&#x8981;&#x7A33;&#x5B9A;&#xFF0C;&#x5B89;&#x5168;&#xFF0C;&#x667A;&#x80FD;&#x7684;&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x4E0E;&#x7EA0;&#x9519;&#x8F85;&#x52A9;&#x670D;&#x52A1;&#xFF1F;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5DF2;&#x7ECF;&#x6B63;&#x5F0F;&#x4E0A;&#x7EBF;&#x4E86;&#xFF0C;&#x8D76;&#x7D27;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5427;!</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\"><br><img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\"><br></a><br></div>\n\n<p>Fundebug, Debug with Fun! &#x6211;&#x4EEC;&#x81F4;&#x529B;&#x4E8E;&#x63D0;&#x4F9B;&#x6700;&#x4E13;&#x4E1A;&#x7684;Bug&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x8BA9;Debug&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x9AD8;&#x6548;&#x800C;&#x6709;&#x8DA3;&#x3002;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;JavaScript&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js&quot;</span> <span class=\"attr\">apikey</span>=<span class=\"string\">&quot;YOUR-API-KEY-HERE&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Fundebug&#xFF0C;&#x60A8;&#x5C31;&#x53EF;&#x4EE5;:</p>\n<ul>\n<li>&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#xFF0C;&#x66F4;&#x53CA;&#x65F6;&#x5730;&#x53D1;&#x73B0;&#x9519;&#x8BEF;!</li>\n<li>&#x667A;&#x80FD;&#x9762;&#x677F;&#xFF0C;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x7BA1;&#x7406;&#x9519;&#x8BEF;!</li>\n<li>&#x4EFB;&#x52A1;&#x5206;&#x914D;&#xFF0C;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x56E2;&#x961F;&#x534F;&#x52A9;!</li>\n<li>&#x9519;&#x8BEF;&#x641C;&#x7D22;&#xFF0C;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#xFF01;</li>\n</ul>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/with_fundebug.jpg\"><br></a><br></div>\n\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF0C;&#x8D76;&#x7D27;&#x4E3A;&#x60A8;&#x7684;&#x56E2;&#x961F;&#x6CE8;&#x518C;Fundebug&#x5E10;&#x53F7;&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n\n\n\n","excerpt":"<p>&#x5F53;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x4E86;&#x4E00;&#x4E2A;&#x53C8;&#x4E00;&#x4E2A;Bug&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x8F6E;&#x53C8;&#x4E00;&#x8F6E;&#x4EE3;&#x7801;&#x5BA1;&#x67E5;&#xFF0C;&#x4E4B;&#x540E;&#x53C8;&#x8DD1;&#x4E86;&#x4E00;&#x904D;&#x53C8;&#x4E00;&#x904D;&#x6D4B;&#x8BD5;&#xFF0C;&#x4EE3;&#x7801;&#x7EC8;&#x4E8E;&#x4E0A;&#x7EBF;&#x4E86;&#xFF01;</p>","more":"<p>&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x4E0A;&#x7EBF;&#x7684;&#x4EE3;&#x7801;&#x4E00;&#x5B9A;&#x6CA1;&#x6709;Bug&#x5417;&#xFF1F;&#x4F3C;&#x4E4E;&#x6CA1;&#x6709;&#x4EBA;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x80AF;&#x5B9A;&#x3002;</p>\n<p>&#x7528;&#x6237;&#x4F7F;&#x7528;&#x5E94;&#x7528;&#x7684;&#x753B;&#x98CE;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<ul>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6CE8;&#x518C;&#x300F;&#x6309;&#x952E;&#x70B9;&#x51FB;&#x4E86;&#x534A;&#x5929;&#x6CA1;&#x6709;&#x53CD;&#x5E94;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x300E;&#x6FC0;&#x6D3B;&#x90AE;&#x4EF6;&#x300F;&#x4E00;&#x76F4;&#x6728;&#x6709;&#x6536;&#x5230;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;&#x72C2;&#x6309;F5&#x65F6;&#x9875;&#x9762;&#x5E76;&#x6CA1;&#x6709;&#x66F4;&#x65B0;&#xFF1F;&#xFF01;</li>\n<li>&#x4E3A;&#x5565;APP&#x83AB;&#x540D;&#x5176;&#x5999;&#x5730;&#x95EA;&#x9000;&#x4E86;&#xFF1F;&#xFF01;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x5185;&#x5FC3;&#x662F;&#x5D29;&#x6E83;&#x7684;&#xFF0C;&#x300E;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x7834;&#x8F6F;&#x4EF6;&#xFF1F;&#x679C;&#x65AD;&#x5F03;&#x4E86;&#x300F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x601C;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5982;&#x679C;&#x77E5;&#x9053;&#x6328;&#x9A82;&#x4E86;&#xFF0C;&#x4E5F;&#x8868;&#x793A;&#x5F88;&#x65E0;&#x8BED;&#xFF0C;&#x660E;&#x660E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x90FD;&#x901A;&#x8FC7;&#x4E86;&#x554A;&#xFF0C;&#x8986;&#x76D6;&#x7387;&#x59A5;&#x59A5;&#x7684;100%&#x6709;&#x6728;&#x6709;&#x3002;&#x3002;&#x3002;</p>\n<p>&#x5176;&#x5B9E;&#x5462;&#xFF0C;&#x7EBF;&#x4E0A;&#x4EE3;&#x7801;&#x51FA;Bug&#x4E5F;&#x662F;&#x5F88;&#x6B63;&#x5E38;&#x7684;&#x4E8B;&#xFF1A;</p>\n<ul>\n<li>&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x8FB9;&#x754C;&#x6761;&#x4EF6;&#xFF08;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;Null, Undefined&#xFF09;;</li>\n<li>&#x4EE3;&#x7801;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF08;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5404;&#x79CD;&#x624B;&#x673A;&#xFF09;&#x5343;&#x53D8;&#x4E07;&#x5316;;</li>\n<li>&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x7684;&#x7CFB;&#x7EDF;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;(MySQL, MongoDB, Redis)&#x5076;&#x5C14;&#x62BD;&#x98CE;;</li>\n<li>&#x5CF0;&#x503C;&#x60C5;&#x51B5;&#x4E0B;&#x7F51;&#x7EDC;&#x8D85;&#x65F6;&#xFF0C;CPU&#x548C;&#x5185;&#x5B58;&#x8D85;&#x8D1F;&#x8377;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD8;&#x6709;&#xFF0C;&#x7F51;&#x9875;&#x5E94;&#x7528;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#xFF0C;APP&#x662F;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x7528;&#x51FA;&#x9519;&#x7684;&#x65F6;&#x5019;&#x7A0B;&#x5E8F;&#x5458;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x53CA;&#x65F6;&#x89E3;&#x51B3;Bug&#xFF0C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x5F88;&#x4E0D;&#x597D;&#x7684;&#x3002;</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/without_fundebug.jpg\"><br></a><br></div>\n\n<!--对于后端代码，目前一般的做法是把错误日志输出到文本里面，Debug的时候再去查看。程序员需要SSH登陆到服务器（也许是很多台服务器），然后用终端工具(grep, awk, vim...)进行查找，这种做法效率是很低的。-->\n<p>&#x90A3;&#x4E48;&#xFF0C;&#x60A8;&#x662F;&#x5426;&#x9700;&#x8981;&#x7A33;&#x5B9A;&#xFF0C;&#x5B89;&#x5168;&#xFF0C;&#x667A;&#x80FD;&#x7684;&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x4E0E;&#x7EA0;&#x9519;&#x8F85;&#x52A9;&#x670D;&#x52A1;&#xFF1F;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;<a href=\"https://fundebug.com/\">Fundebug</a>&#x5DF2;&#x7ECF;&#x6B63;&#x5F0F;&#x4E0A;&#x7EBF;&#x4E86;&#xFF0C;&#x8D76;&#x7D27;<a href=\"https://fundebug.com/team/create\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5427;!</p>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\"><br><img style=\"width:40%;\" src=\"https://fundebug.com/assets/images/logo/fundebug.jpg\"><br></a><br></div>\n\n<p>Fundebug, Debug with Fun! &#x6211;&#x4EEC;&#x81F4;&#x529B;&#x4E8E;&#x63D0;&#x4F9B;&#x6700;&#x4E13;&#x4E1A;&#x7684;Bug&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x8BA9;Debug&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x9AD8;&#x6548;&#x800C;&#x6709;&#x8DA3;&#x3002;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;JavaScript&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF0C;&#x60A8;&#x53EA;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/fundebug.0.1.0.min.js&quot;</span> <span class=\"attr\">apikey</span>=<span class=\"string\">&quot;YOUR-API-KEY-HERE&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Fundebug&#xFF0C;&#x60A8;&#x5C31;&#x53EF;&#x4EE5;:</p>\n<ul>\n<li>&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#xFF0C;&#x66F4;&#x53CA;&#x65F6;&#x5730;&#x53D1;&#x73B0;&#x9519;&#x8BEF;!</li>\n<li>&#x667A;&#x80FD;&#x9762;&#x677F;&#xFF0C;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x7BA1;&#x7406;&#x9519;&#x8BEF;!</li>\n<li>&#x4EFB;&#x52A1;&#x5206;&#x914D;&#xFF0C;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x56E2;&#x961F;&#x534F;&#x52A9;!</li>\n<li>&#x9519;&#x8BEF;&#x641C;&#x7D22;&#xFF0C;&#x66F4;&#x51C6;&#x786E;&#x5730;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#xFF01;</li>\n</ul>\n<div style=\"text-align: center;\"><br><a href=\"https://fundebug.com\"><br><img style=\"width:80%;\" src=\"/2016/11/fundebug-is-online/with_fundebug.jpg\"><br></a><br></div>\n\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF0C;&#x8D76;&#x7D27;&#x4E3A;&#x60A8;&#x7684;&#x56E2;&#x961F;&#x6CE8;&#x518C;Fundebug&#x5E10;&#x53F7;&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"基于Docker搭建多节点Hadoop集群","date":"2015-06-08T04:44:40.000Z","_content":"\n**摘要:** 本文已更新，请查看: [基于Docker搭建Hadoop集群之升级版](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)!!!\n\n**GitHub地址:**\n- [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-06-08](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n\n本文介绍了基于Docker在单机上搭建多节点Hadopp集群方法，Hadoop的Master和Slave分别运行在不同容器中。\n\n可以直接进入第三部分，快速在本机搭建一个3个节点的Hadoop集群\n\n## 一. 项目简介\n\n直接用机器搭建Hadoop集群是一个相当痛苦的过程，尤其对初学者来说。他们还没开始跑wordcount，可能就被这个问题折腾的体无完肤了。\n\n我的目标是将Hadoop集群运行在Docker容器中，使Hadoop开发者能够快速便捷地在本机搭建多节点的Hadoop集群。其实这个想法已经有了不少实现，但是都不是很理想，他们或者镜像太大，或者使用太慢，或者使用了第三方工具使得使用起来过于复杂...下表为一些已知的Hadoop on Docker项目以及其存在的问题。\n\n|项目                              |镜像大小   |问题                  |\n|:--------------------------------|:--------|:---------------------|\n|sequenceiq/hadoop-docker:latest  |1.491GB  | 镜像太大，只支持单个节点 |\n|sequenceiq/hadoop-docker:2.7.0   |1.76 GB  | 同上                  |\n|sequenceiq/hadoop-docker:2.6.0   |1.624GB  | 同上                  |\n|sequenceiq/ambari:latest         |1.782GB   | 镜像太大，使用太慢     |\n|sequenceiq/ambari:2.0.0          |4.804GB   | 同上                 |\n|sequenceiq/ambari:latest:1.70    |4.761GB   | 同上                 |\n|alvinhenrick/hadoop-mutinode     |4.331GB   | 镜像太大，构建太慢，增加节点麻烦，有bug|\n\n我的项目参考了alvinhenrick/hadoop-mutinode项目，不过我做了大量的优化和重构。alvinhenrick/hadoop-mutinode项目的Github主页以及作者所写的博客地址：[GitHub](https://github.com/alvinhenrick/hadoop-mutinode)，[博客](http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/)\n\n下面两个表是alvinhenrick/hadoop-mutinode项目与我的kiwenlau/hadoop-cluster-docker项目的参数对比\n\n|镜像名称\t                    |构建时间\t      | 镜像层数  | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n|alvinhenrick/serf          | 258.213s    | 21\t     | 239.4MB |\n|alvinhenrick/hadoop-base\t| 2236.055s   | 58\t     | 4.328GB |\n|alvinhenrick/hadoop-dn\t    | 51.959s     | 74\t     | 4.331GB |\n|alvinhenrick/hadoop-nn-dn  | 49.548s     |  84      | 4.331GB |\n\n|镜像名称\t                                 |构建时间\t       | 镜像层数   | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n| kiwenlau/serf-dnsmasq          | 509.46s        |  8\t        | 206.6 MB |\n|kiwenlau/hadoop-base\t         | 400.29s\t        |  7\t        | 775.4 MB |\n|kiwenlau/hadoop-master         | 5.41s            |  9\t        | 775.4 MB |\n|kiwenlau/hadoop-slave\t         | 2.41s\t        |  8 \t        | 775.4 MB |\n\n可知，我主要优化了这样几点\n- 更小的镜像大小\n- 更快的构造时间\n- 更少的镜像层数\n\n#### **更快更方便地改变Hadoop集群节点数目**\n\n另外，alvinhenrick/hadoop-mutinode项目增加节点时需要手动修改Hadoop配置文件然后重新构建hadoop-nn-dn镜像,然后修改容器启动脚本，才能实现增加节点的功能。而我通过shell脚本实现自动话，不到1分钟可以重新构建hadoop-master镜像，然后立即运行！！！本项目默认启动3个节点的Hadoop集群，支持任意节点数的hadoop集群。\n\n另外，启动hadoop, 运行wordcount以及重新构建镜像都采用了shell脚本实现自动化。这样使得整个项目的使用以及开发都变得非常方便快捷:)\n\n#### **开发测试环境**\n\n- 操作系统：ubuntu 14.04 和 ubuntu 12.04\n- 内核版本: 3.13.0-32-generic\n- Docker版本：1.5.0 和1.6.2\n\n#### **硬盘不够，内存不够，尤其是内核版本过低会导致运行失败:(**\n\n## 二. 镜像简介\n\n#### **本项目一共开发了4个镜像**\n\n- serf-dnsmasq\n- hadoop-base\n- hadoop-master\n- hadoop-slave\n\n#### **serf-dnsmasq镜像**\n\n- 基于ubuntu:15.04 (选它是因为它最小，不是因为它最新...)\n- 安装serf: serf是一个分布式的机器节点管理工具。它可以动态地发现所有hadoop集群节点。\n- 安装dnsmasq: dnsmasq作为轻量级的dns服务器。它可以为hadoop集群提供域名解析服务。\n\n容器启动时，master节点的IP会传给所有slave节点。serf会在container启动后立即启动。slave节点上的serf agent会马上发现master节点（master IP它们都知道嘛），master节点就马上发现了所有slave节点。然后它们之间通过互相交换信息，所有节点就能知道其他所有节点的存在了！(Everyone will know Everyone). serf发现新的节点时，就会重新配置dnsmasq,然后重启dnsmasq. 所以dnsmasq就能够解析集群的所有节点的域名啦。这个过程随着节点的增加会耗时更久，因此，若配置的Hadoop节点比较多，则在启动容器后需要测试serf是否发现了所有节点，dns是否能够解析所有节点域名。稍等片刻才能启动Hadoop。这个解决方案是由SequenceIQ公司提出的，该公司专注于将Hadoop运行在Docker中。请参考这个PPT：[Docker-based Hadoop Provisioning](http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning)\n\n#### **hadoop-base镜像**\n\n- 基于serf-dnsmasq镜像\n- 安装JDK(openjdk)\n- 安装openssh-server, 配置无密码ssh\n- 安装vim：介样就可以愉快地在容器中敲代码了:)\n- 安装Hadoop 2.3.0: 安装编译过的hadoop （2.5.2， 2.6.0， 2.7.0 都比2.3.0大，所以我懒得升级了）\n\n编译Hadoop的步骤请参考我的博客：[[Hadoop 2.30 在Ubuntu 14.04 中编译](http://www.cnblogs.com/kiwenlau/p/4227204.html)](http://www.cnblogs.com/kiwenlau/p/4227204.html)\n\n如果需要重新开发我的hadoop-base, 需要下载编译过的hadoop-2.3.0安装包，放到hadoop-cluster-docker/hadoop-base/files目录内。我编译的64位hadoop-2.3.0下载地址：[hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n\n另外，我还编译了64位的hadoop 2.5.2, 2.6.0, 2.7.0, 其下载地址如下：\n\n- [hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n- [hadoop-2.5.2](http://pan.baidu.com/s/1jGw24aa)\n- [hadoop-2.6.0](http://pan.baidu.com/s/1eQgvF2M)\n- [hadoop-2.7.0]( http://pan.baidu.com/s/1c0HD0Nu)\n\n#### **hadoop-master镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的master节点\n- 格式化namenode\n\n这一步需要配置slaves文件，而slaves文件需要列出所有节点的域名或者IP。因此，Hadoop节点数目不同时，slaves文件自然也不一样。因此，更改Hadoop集群节点数目时，需要修改slaves文件然后重新构建hadoop-master镜像。我编写了一个resize-cluster.sh脚本自动化这一过程。仅需给定节点数目作为脚本参数就可以轻松实现Hadoop集群节点数目的更改。由于hadoop-master镜像仅仅做一些配置工作，也无需下载任何文件，整个过程非常快，1分钟就足够了。\n\n#### **hadoop-slave镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的slave节点\n\n#### **镜像大小分析**\n\n下表为sudo docker images的运行结果\n\n|REPOSITORY       |   TAG    |  IMAGE ID       | CREATED     |   VIRTUAL SIZE |\n| ------------- | ------- | ---------- | ---------- | ------- |\n|index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0|    d63869855c03 |   17 hours ago  |  777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master|    0.1.0   | 7c9d32ede450  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   | 5571bd5de58e    |17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/serf-dnsmasq  |  0.1.0    |09ed89c24ee8   | 17 hours ago  |  206.7 MB |\n|ubuntu     |                               15.04   | bd94ae587483  |  3 weeks ago    |131.3 MB |\n\n\n易知以下几个结论：\n- serf-dnsmasq镜像在ubuntu:15.04镜像的基础上增加了75.4MB\n- hadoop-base镜像在serf-dnsmasq镜像的基础上增加了570.7MB\n- hadoop-master和hadoop-slave镜像在hadoop-base镜像的基础上大小几乎没有增加\n\n下表为docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0命令的部分运行结果\n\n|IMAGE      |    CREATED        |    CREATED BY         |                             SIZE\n |  -----  | ---------------  | ---------------  |  -----------  | \n|2039b9b81146 |   44 hours ago   |       /bin/sh -c #(nop) ADD   multi:a93c971a49514e787  |  158.5 MB | \n | cdb620312f30    |  44 hours ago   |       /bin/sh -c apt-get install -y openjdk-7-jdk    |  324.6 MB  | \n | da7d10c790c1   |   44 hours ago      |    /bin/sh -c apt-get install -y openssh-server   |   87.58 MB  | \n |  c65cb568defc    |  44 hours ago     |     /bin/sh -c curl -Lso serf.zip https://dl.bint  |  14.46 MB  | \n | 3e22b3d72e33     | 44 hours ago       |   /bin/sh -c apt-get update && apt-get install     |  60.89 MB   | \n |  b68f8c8d2140    |  3 weeks ago     |     /bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3  |   131.3 MB  | \n\n可知\n- 基础镜像ubuntu:15.04为131.3MB\n- 安装openjdk需要324.6MB\n- 安装hadoop需要158.5MB\n- ubuntu,openjdk与hadoop均为镜像所必须，三者一共占了:614.4MB\n\n#### **因此，我所开发的hadoop镜像以及接近最小，优化空间已经很小了**\n\n下图显示了项目的Docker镜像结构：\n\n<img src=\"150608-hadoop-cluster-docker/image-architecture.png\" width = \"500\"/>\n\n## 三. 3节点Hadoop集群搭建步骤\n\n#### 1. **拉取镜像**\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0\n```\n\n- 3~5分钟OK~\n\n*查看下载的镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n|REPOSITORY    |    TAG  |    IMAGE ID      |  CREATED  |      VIRTUAL SIZE |\n |  ----------  |  -----------  |  ---------  |   --------  |  \n| index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0    |d63869855c03  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master   |   0.1.0 |     7c9d32ede450   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base |       0.1.0     | 5571bd5de58e   |   17 hours ago  |    777.4 MB | \n |  index.alauda.cn/kiwenlau/serf-dnsmasq   |   0.1.0   |   09ed89c24ee8     | 17 hours ago     |  206.7 MB | \n\n- hadoop-base镜像是基于serf-dnsmasq镜像的，hadoop-slave镜像和hadoop-master镜像都是基于hadoop-base镜像\n- 所以其实4个镜像一共也就777.4MB:)\n\n#### **2. 修改镜像tag**\n\n```sh\nsudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0\nsudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0\nsudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0\nsudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0\n```\n\n*查看修改tag后镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n| REPOSITORY   |   TAG   |    IMAGE ID    |    CREATED    |      VIRTUAL SIZE  | \n |  ----------  |  -----  |  ---------  |  ----------  |  -----------  | \n| index.alauda.cn/kiwenlau/hadoop-slave  |    0.1.0   |   d63869855c03    |  17 hours ago   |   777.4 MB\n | kiwenlau/hadoop-slave    |                  0.1.0   |   d63869855c03   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-master  |  0.1.0 |     7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-master  |                  0.1.0   |   7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-base   |                   0.1.0  |    5571bd5de58e  |    17 hours ago   |   777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   |   5571bd5de58e   |   17 hours ago |     777.4 MB | \n | kiwenlau/serf-dnsmasq          |            0.1.0    |  09ed89c24ee8  |    17 hours ago    |  206.7 MB | \n | index.alauda.cn/kiwenlau/serf-dnsmasq  |    0.1.0   |   09ed89c24ee8     | 17 hours ago   |   206.7 MB | \n\n- 之所以要修改镜像，是因为我默认是将镜像上传到Dockerhub, 因此Dokerfile以及shell脚本中得镜像名称都是没有alauada前缀的，sorry for this....不过改tag还是很快滴\n- 若直接下载我在DockerHub中的镜像，自然就不需要修改tag...不过Alauda镜像下载速度很快的哈~\n\n#### **3.下载源代码**\n\n```sh\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n- 为了防止Github被XX, 我把代码导入到了开源中国的git仓库\n\n```sh\ngit clone http://git.oschina.net/kiwenlau/hadoop-cluster-docker\n```\n\n#### **4. 运行容器**\n\n```sh\ncd hadoop-cluster-docker\n./start-container.sh\n\n```\n\n*运行结果*\n\n```bash\nstart master container...\nstart slave1 container...\nstart slave2 container...\nroot@master:~#\n```\n\n- 一共开启了3个容器，1个master, 2个slave\n- 开启容器后就进入了master容器root用户的家目录（/root）\n\n*查看master的root用户家目录的文件*\n\n```sh\nls\n```\n\n*运行结果*\n\n```plain\nhdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh\n```\n\n- start-hadoop.sh是开启hadoop的shell脚本\n- run-wordcount.sh是运行wordcount的shell脚本，可以测试镜像是否正常工作\n\n#### **5.测试容器是否正常启动(此时已进入master容器)**\n\n*查看hadoop集群成员*\n\n```sh\nserf members\n```\n\n*运行结果*\n\n```bash\nmaster.kiwenlau.com  172.17.0.65:7946  alive\nslave1.kiwenlau.com  172.17.0.66:7946  alive\nslave2.kiwenlau.com  172.17.0.67:7946  alive\n```\n\n- 若结果缺少节点，可以稍等片刻，再执行“serf members”命令。因为serf agent需要时间发现所有节点。\n\n*测试ssh*\n\n```sh\nssh slave2.kiwenlau.com\n```\n\n*运行结果*\n\n```bash\nWarning: Permanently added 'slave2.kiwenlau.com,172.17.0.67' (ECDSA) to the list of known hosts.\nWelcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)\n* Documentation:  https://help.ubuntu.com/\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\nroot@slave2:~#\n```\n\n*退出slave2*\n\n```sh\nexit\n```\n\n*运行结果*\n\n```bash\nlogout\nConnection to slave2.kiwenlau.com closed.\n```\n\n- 若ssh失败，请稍等片刻再测试，因为dnsmasq的dns服务器启动需要时间。\n- 测试成功后，就可以开启Hadoop集群了！其实你也可以不进行测试，开启容器后耐心等待一分钟即可！\n\n#### **6. 开启hadoop**\n\n```sh\n./start-hadoop.sh\n```\n\n- 上一步ssh到slave2之后，请记得回到master啊!!！\n- 运行结果太多，忽略....\n- hadoop的启动速度取决于机器性能....\n\n#### **7. 运行wordcount**\n\n```sh\n./run-wordcount.sh\n```\n\n*运行结果*\n```bash\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\n- wordcount的执行速度取决于机器性能....\n\n## 四. N节点Hadoop集群搭建步骤\n\n#### **1. 准备工作**\n\n- 参考第二部分1~3：下载镜像，修改tag，下载源代码\n- 注意，你可以不下载serf-dnsmasq, 但是请最好下载hadoop-base，因为hadoop-master是基于hadoop-base构建的\n\n#### **2. 重新构建hadoop-master镜像**\n\n```sh\n./resize-cluster.sh 5\n```\n\n- 不要担心，1分钟就能搞定\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n\n#### **3. 启动容器**\n\n```sh\n./start-container.sh 5\n```\n\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n- 这个参数呢，最好还是得和上一步的参数一致:)\n- 这个参数如果比上一步的参数大，你多启动的节点，Hadoop不认识它们..\n- 这个参数如果比上一步的参数小，Hadoop觉得少启动的节点挂掉了..\n\n#### **4. 测试工作**\n\n- 参考第三部分5~7：测试容器，开启Hadoop，运行wordcount\n- 请注意，若节点增加，请务必先测试容器，然后再开启Hadoop, 因为serf可能还没有发现所有节点，而dnsmasq的DNS服务器表示还没有配置好服务\n- 测试等待时间取决于机器性能....\n\n","source":"_posts/2015/06/08/150608-hadoop-cluster-docker.md","raw":"title: 基于Docker搭建多节点Hadoop集群\n\ndate: 2015-06-08 12:44:40\n\ntags: [Hadoop, Docker]\n\n---\n\n**摘要:** 本文已更新，请查看: [基于Docker搭建Hadoop集群之升级版](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)!!!\n\n**GitHub地址:**\n- [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-06-08](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n\n本文介绍了基于Docker在单机上搭建多节点Hadopp集群方法，Hadoop的Master和Slave分别运行在不同容器中。\n\n可以直接进入第三部分，快速在本机搭建一个3个节点的Hadoop集群\n\n## 一. 项目简介\n\n直接用机器搭建Hadoop集群是一个相当痛苦的过程，尤其对初学者来说。他们还没开始跑wordcount，可能就被这个问题折腾的体无完肤了。\n\n我的目标是将Hadoop集群运行在Docker容器中，使Hadoop开发者能够快速便捷地在本机搭建多节点的Hadoop集群。其实这个想法已经有了不少实现，但是都不是很理想，他们或者镜像太大，或者使用太慢，或者使用了第三方工具使得使用起来过于复杂...下表为一些已知的Hadoop on Docker项目以及其存在的问题。\n\n|项目                              |镜像大小   |问题                  |\n|:--------------------------------|:--------|:---------------------|\n|sequenceiq/hadoop-docker:latest  |1.491GB  | 镜像太大，只支持单个节点 |\n|sequenceiq/hadoop-docker:2.7.0   |1.76 GB  | 同上                  |\n|sequenceiq/hadoop-docker:2.6.0   |1.624GB  | 同上                  |\n|sequenceiq/ambari:latest         |1.782GB   | 镜像太大，使用太慢     |\n|sequenceiq/ambari:2.0.0          |4.804GB   | 同上                 |\n|sequenceiq/ambari:latest:1.70    |4.761GB   | 同上                 |\n|alvinhenrick/hadoop-mutinode     |4.331GB   | 镜像太大，构建太慢，增加节点麻烦，有bug|\n\n我的项目参考了alvinhenrick/hadoop-mutinode项目，不过我做了大量的优化和重构。alvinhenrick/hadoop-mutinode项目的Github主页以及作者所写的博客地址：[GitHub](https://github.com/alvinhenrick/hadoop-mutinode)，[博客](http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/)\n\n下面两个表是alvinhenrick/hadoop-mutinode项目与我的kiwenlau/hadoop-cluster-docker项目的参数对比\n\n|镜像名称\t                    |构建时间\t      | 镜像层数  | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n|alvinhenrick/serf          | 258.213s    | 21\t     | 239.4MB |\n|alvinhenrick/hadoop-base\t| 2236.055s   | 58\t     | 4.328GB |\n|alvinhenrick/hadoop-dn\t    | 51.959s     | 74\t     | 4.331GB |\n|alvinhenrick/hadoop-nn-dn  | 49.548s     |  84      | 4.331GB |\n\n|镜像名称\t                                 |构建时间\t       | 镜像层数   | 镜像大小 |\n| :-------------------------| :---------- | :------- | :------- |\n| kiwenlau/serf-dnsmasq          | 509.46s        |  8\t        | 206.6 MB |\n|kiwenlau/hadoop-base\t         | 400.29s\t        |  7\t        | 775.4 MB |\n|kiwenlau/hadoop-master         | 5.41s            |  9\t        | 775.4 MB |\n|kiwenlau/hadoop-slave\t         | 2.41s\t        |  8 \t        | 775.4 MB |\n\n可知，我主要优化了这样几点\n- 更小的镜像大小\n- 更快的构造时间\n- 更少的镜像层数\n\n#### **更快更方便地改变Hadoop集群节点数目**\n\n另外，alvinhenrick/hadoop-mutinode项目增加节点时需要手动修改Hadoop配置文件然后重新构建hadoop-nn-dn镜像,然后修改容器启动脚本，才能实现增加节点的功能。而我通过shell脚本实现自动话，不到1分钟可以重新构建hadoop-master镜像，然后立即运行！！！本项目默认启动3个节点的Hadoop集群，支持任意节点数的hadoop集群。\n\n另外，启动hadoop, 运行wordcount以及重新构建镜像都采用了shell脚本实现自动化。这样使得整个项目的使用以及开发都变得非常方便快捷:)\n\n#### **开发测试环境**\n\n- 操作系统：ubuntu 14.04 和 ubuntu 12.04\n- 内核版本: 3.13.0-32-generic\n- Docker版本：1.5.0 和1.6.2\n\n#### **硬盘不够，内存不够，尤其是内核版本过低会导致运行失败:(**\n\n## 二. 镜像简介\n\n#### **本项目一共开发了4个镜像**\n\n- serf-dnsmasq\n- hadoop-base\n- hadoop-master\n- hadoop-slave\n\n#### **serf-dnsmasq镜像**\n\n- 基于ubuntu:15.04 (选它是因为它最小，不是因为它最新...)\n- 安装serf: serf是一个分布式的机器节点管理工具。它可以动态地发现所有hadoop集群节点。\n- 安装dnsmasq: dnsmasq作为轻量级的dns服务器。它可以为hadoop集群提供域名解析服务。\n\n容器启动时，master节点的IP会传给所有slave节点。serf会在container启动后立即启动。slave节点上的serf agent会马上发现master节点（master IP它们都知道嘛），master节点就马上发现了所有slave节点。然后它们之间通过互相交换信息，所有节点就能知道其他所有节点的存在了！(Everyone will know Everyone). serf发现新的节点时，就会重新配置dnsmasq,然后重启dnsmasq. 所以dnsmasq就能够解析集群的所有节点的域名啦。这个过程随着节点的增加会耗时更久，因此，若配置的Hadoop节点比较多，则在启动容器后需要测试serf是否发现了所有节点，dns是否能够解析所有节点域名。稍等片刻才能启动Hadoop。这个解决方案是由SequenceIQ公司提出的，该公司专注于将Hadoop运行在Docker中。请参考这个PPT：[Docker-based Hadoop Provisioning](http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning)\n\n#### **hadoop-base镜像**\n\n- 基于serf-dnsmasq镜像\n- 安装JDK(openjdk)\n- 安装openssh-server, 配置无密码ssh\n- 安装vim：介样就可以愉快地在容器中敲代码了:)\n- 安装Hadoop 2.3.0: 安装编译过的hadoop （2.5.2， 2.6.0， 2.7.0 都比2.3.0大，所以我懒得升级了）\n\n编译Hadoop的步骤请参考我的博客：[[Hadoop 2.30 在Ubuntu 14.04 中编译](http://www.cnblogs.com/kiwenlau/p/4227204.html)](http://www.cnblogs.com/kiwenlau/p/4227204.html)\n\n如果需要重新开发我的hadoop-base, 需要下载编译过的hadoop-2.3.0安装包，放到hadoop-cluster-docker/hadoop-base/files目录内。我编译的64位hadoop-2.3.0下载地址：[hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n\n另外，我还编译了64位的hadoop 2.5.2, 2.6.0, 2.7.0, 其下载地址如下：\n\n- [hadoop-2.3.0](http://pan.baidu.com/s/1sjFRaFz)\n- [hadoop-2.5.2](http://pan.baidu.com/s/1jGw24aa)\n- [hadoop-2.6.0](http://pan.baidu.com/s/1eQgvF2M)\n- [hadoop-2.7.0]( http://pan.baidu.com/s/1c0HD0Nu)\n\n#### **hadoop-master镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的master节点\n- 格式化namenode\n\n这一步需要配置slaves文件，而slaves文件需要列出所有节点的域名或者IP。因此，Hadoop节点数目不同时，slaves文件自然也不一样。因此，更改Hadoop集群节点数目时，需要修改slaves文件然后重新构建hadoop-master镜像。我编写了一个resize-cluster.sh脚本自动化这一过程。仅需给定节点数目作为脚本参数就可以轻松实现Hadoop集群节点数目的更改。由于hadoop-master镜像仅仅做一些配置工作，也无需下载任何文件，整个过程非常快，1分钟就足够了。\n\n#### **hadoop-slave镜像**\n\n- 基于hadoop-base镜像\n- 配置hadoop的slave节点\n\n#### **镜像大小分析**\n\n下表为sudo docker images的运行结果\n\n|REPOSITORY       |   TAG    |  IMAGE ID       | CREATED     |   VIRTUAL SIZE |\n| ------------- | ------- | ---------- | ---------- | ------- |\n|index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0|    d63869855c03 |   17 hours ago  |  777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master|    0.1.0   | 7c9d32ede450  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   | 5571bd5de58e    |17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/serf-dnsmasq  |  0.1.0    |09ed89c24ee8   | 17 hours ago  |  206.7 MB |\n|ubuntu     |                               15.04   | bd94ae587483  |  3 weeks ago    |131.3 MB |\n\n\n易知以下几个结论：\n- serf-dnsmasq镜像在ubuntu:15.04镜像的基础上增加了75.4MB\n- hadoop-base镜像在serf-dnsmasq镜像的基础上增加了570.7MB\n- hadoop-master和hadoop-slave镜像在hadoop-base镜像的基础上大小几乎没有增加\n\n下表为docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0命令的部分运行结果\n\n|IMAGE      |    CREATED        |    CREATED BY         |                             SIZE\n |  -----  | ---------------  | ---------------  |  -----------  | \n|2039b9b81146 |   44 hours ago   |       /bin/sh -c #(nop) ADD   multi:a93c971a49514e787  |  158.5 MB | \n | cdb620312f30    |  44 hours ago   |       /bin/sh -c apt-get install -y openjdk-7-jdk    |  324.6 MB  | \n | da7d10c790c1   |   44 hours ago      |    /bin/sh -c apt-get install -y openssh-server   |   87.58 MB  | \n |  c65cb568defc    |  44 hours ago     |     /bin/sh -c curl -Lso serf.zip https://dl.bint  |  14.46 MB  | \n | 3e22b3d72e33     | 44 hours ago       |   /bin/sh -c apt-get update && apt-get install     |  60.89 MB   | \n |  b68f8c8d2140    |  3 weeks ago     |     /bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3  |   131.3 MB  | \n\n可知\n- 基础镜像ubuntu:15.04为131.3MB\n- 安装openjdk需要324.6MB\n- 安装hadoop需要158.5MB\n- ubuntu,openjdk与hadoop均为镜像所必须，三者一共占了:614.4MB\n\n#### **因此，我所开发的hadoop镜像以及接近最小，优化空间已经很小了**\n\n下图显示了项目的Docker镜像结构：\n\n<img src=\"150608-hadoop-cluster-docker/image-architecture.png\" width = \"500\"/>\n\n## 三. 3节点Hadoop集群搭建步骤\n\n#### 1. **拉取镜像**\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0\nsudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0\n```\n\n- 3~5分钟OK~\n\n*查看下载的镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n|REPOSITORY    |    TAG  |    IMAGE ID      |  CREATED  |      VIRTUAL SIZE |\n |  ----------  |  -----------  |  ---------  |   --------  |  \n| index.alauda.cn/kiwenlau/hadoop-slave   | 0.1.0    |d63869855c03  |  17 hours ago   | 777.4 MB|\n|index.alauda.cn/kiwenlau/hadoop-master   |   0.1.0 |     7c9d32ede450   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base |       0.1.0     | 5571bd5de58e   |   17 hours ago  |    777.4 MB | \n |  index.alauda.cn/kiwenlau/serf-dnsmasq   |   0.1.0   |   09ed89c24ee8     | 17 hours ago     |  206.7 MB | \n\n- hadoop-base镜像是基于serf-dnsmasq镜像的，hadoop-slave镜像和hadoop-master镜像都是基于hadoop-base镜像\n- 所以其实4个镜像一共也就777.4MB:)\n\n#### **2. 修改镜像tag**\n\n```sh\nsudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0\nsudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0\nsudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0\nsudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0\n```\n\n*查看修改tag后镜像*\n\n```sh\nsudo docker images\n```\n\n*运行结果*\n\n| REPOSITORY   |   TAG   |    IMAGE ID    |    CREATED    |      VIRTUAL SIZE  | \n |  ----------  |  -----  |  ---------  |  ----------  |  -----------  | \n| index.alauda.cn/kiwenlau/hadoop-slave  |    0.1.0   |   d63869855c03    |  17 hours ago   |   777.4 MB\n | kiwenlau/hadoop-slave    |                  0.1.0   |   d63869855c03   |   17 hours ago  |    777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-master  |  0.1.0 |     7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-master  |                  0.1.0   |   7c9d32ede450   |   17 hours ago |     777.4 MB | \n | kiwenlau/hadoop-base   |                   0.1.0  |    5571bd5de58e  |    17 hours ago   |   777.4 MB | \n | index.alauda.cn/kiwenlau/hadoop-base  |    0.1.0   |   5571bd5de58e   |   17 hours ago |     777.4 MB | \n | kiwenlau/serf-dnsmasq          |            0.1.0    |  09ed89c24ee8  |    17 hours ago    |  206.7 MB | \n | index.alauda.cn/kiwenlau/serf-dnsmasq  |    0.1.0   |   09ed89c24ee8     | 17 hours ago   |   206.7 MB | \n\n- 之所以要修改镜像，是因为我默认是将镜像上传到Dockerhub, 因此Dokerfile以及shell脚本中得镜像名称都是没有alauada前缀的，sorry for this....不过改tag还是很快滴\n- 若直接下载我在DockerHub中的镜像，自然就不需要修改tag...不过Alauda镜像下载速度很快的哈~\n\n#### **3.下载源代码**\n\n```sh\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n- 为了防止Github被XX, 我把代码导入到了开源中国的git仓库\n\n```sh\ngit clone http://git.oschina.net/kiwenlau/hadoop-cluster-docker\n```\n\n#### **4. 运行容器**\n\n```sh\ncd hadoop-cluster-docker\n./start-container.sh\n\n```\n\n*运行结果*\n\n```bash\nstart master container...\nstart slave1 container...\nstart slave2 container...\nroot@master:~#\n```\n\n- 一共开启了3个容器，1个master, 2个slave\n- 开启容器后就进入了master容器root用户的家目录（/root）\n\n*查看master的root用户家目录的文件*\n\n```sh\nls\n```\n\n*运行结果*\n\n```plain\nhdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh\n```\n\n- start-hadoop.sh是开启hadoop的shell脚本\n- run-wordcount.sh是运行wordcount的shell脚本，可以测试镜像是否正常工作\n\n#### **5.测试容器是否正常启动(此时已进入master容器)**\n\n*查看hadoop集群成员*\n\n```sh\nserf members\n```\n\n*运行结果*\n\n```bash\nmaster.kiwenlau.com  172.17.0.65:7946  alive\nslave1.kiwenlau.com  172.17.0.66:7946  alive\nslave2.kiwenlau.com  172.17.0.67:7946  alive\n```\n\n- 若结果缺少节点，可以稍等片刻，再执行“serf members”命令。因为serf agent需要时间发现所有节点。\n\n*测试ssh*\n\n```sh\nssh slave2.kiwenlau.com\n```\n\n*运行结果*\n\n```bash\nWarning: Permanently added 'slave2.kiwenlau.com,172.17.0.67' (ECDSA) to the list of known hosts.\nWelcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)\n* Documentation:  https://help.ubuntu.com/\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\nroot@slave2:~#\n```\n\n*退出slave2*\n\n```sh\nexit\n```\n\n*运行结果*\n\n```bash\nlogout\nConnection to slave2.kiwenlau.com closed.\n```\n\n- 若ssh失败，请稍等片刻再测试，因为dnsmasq的dns服务器启动需要时间。\n- 测试成功后，就可以开启Hadoop集群了！其实你也可以不进行测试，开启容器后耐心等待一分钟即可！\n\n#### **6. 开启hadoop**\n\n```sh\n./start-hadoop.sh\n```\n\n- 上一步ssh到slave2之后，请记得回到master啊!!！\n- 运行结果太多，忽略....\n- hadoop的启动速度取决于机器性能....\n\n#### **7. 运行wordcount**\n\n```sh\n./run-wordcount.sh\n```\n\n*运行结果*\n```bash\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\n- wordcount的执行速度取决于机器性能....\n\n## 四. N节点Hadoop集群搭建步骤\n\n#### **1. 准备工作**\n\n- 参考第二部分1~3：下载镜像，修改tag，下载源代码\n- 注意，你可以不下载serf-dnsmasq, 但是请最好下载hadoop-base，因为hadoop-master是基于hadoop-base构建的\n\n#### **2. 重新构建hadoop-master镜像**\n\n```sh\n./resize-cluster.sh 5\n```\n\n- 不要担心，1分钟就能搞定\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n\n#### **3. 启动容器**\n\n```sh\n./start-container.sh 5\n```\n\n- 你可以为resize-cluster.sh脚本设不同的正整数作为参数数1, 2, 3, 4, 5, 6...\n- 这个参数呢，最好还是得和上一步的参数一致:)\n- 这个参数如果比上一步的参数大，你多启动的节点，Hadoop不认识它们..\n- 这个参数如果比上一步的参数小，Hadoop觉得少启动的节点挂掉了..\n\n#### **4. 测试工作**\n\n- 参考第三部分5~7：测试容器，开启Hadoop，运行wordcount\n- 请注意，若节点增加，请务必先测试容器，然后再开启Hadoop, 因为serf可能还没有发现所有节点，而dnsmasq的DNS服务器表示还没有配置好服务\n- 测试等待时间取决于机器性能....\n\n","slug":"2015/06/08/150608-hadoop-cluster-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweln0003mkfyu12heh2y","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x5DF2;&#x66F4;&#x65B0;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x4E4B;&#x5347;&#x7EA7;&#x7248;</a>!!!</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">2015-06-08</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x5728;&#x5355;&#x673A;&#x4E0A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadopp&#x96C6;&#x7FA4;&#x65B9;&#x6CD5;&#xFF0C;Hadoop&#x7684;Master&#x548C;Slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#xFF0C;&#x5FEB;&#x901F;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;</p>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;</h2><p>&#x76F4;&#x63A5;&#x7528;&#x673A;&#x5668;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5F53;&#x75DB;&#x82E6;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C24;&#x5176;&#x5BF9;&#x521D;&#x5B66;&#x8005;&#x6765;&#x8BF4;&#x3002;&#x4ED6;&#x4EEC;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;&#x8DD1;wordcount&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x88AB;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6298;&#x817E;&#x7684;&#x4F53;&#x65E0;&#x5B8C;&#x80A4;&#x4E86;&#x3002;</p>\n<p>&#x6211;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5C06;Hadoop&#x96C6;&#x7FA4;&#x8FD0;&#x884C;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x4F7F;Hadoop&#x5F00;&#x53D1;&#x8005;&#x80FD;&#x591F;&#x5FEB;&#x901F;&#x4FBF;&#x6377;&#x5730;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E0D;&#x5C11;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x7406;&#x60F3;&#xFF0C;&#x4ED6;&#x4EEC;&#x6216;&#x8005;&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x592A;&#x6162;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E86;&#x7B2C;&#x4E09;&#x65B9;&#x5DE5;&#x5177;&#x4F7F;&#x5F97;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#x2026;&#x4E0B;&#x8868;&#x4E3A;&#x4E00;&#x4E9B;&#x5DF2;&#x77E5;&#x7684;Hadoop on Docker&#x9879;&#x76EE;&#x4EE5;&#x53CA;&#x5176;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x9879;&#x76EE;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n<th style=\"text-align:left\">&#x95EE;&#x9898;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:latest</td>\n<td style=\"text-align:left\">1.491GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x53EA;&#x652F;&#x6301;&#x5355;&#x4E2A;&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.7.0</td>\n<td style=\"text-align:left\">1.76 GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.6.0</td>\n<td style=\"text-align:left\">1.624GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest</td>\n<td style=\"text-align:left\">1.782GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x4F7F;&#x7528;&#x592A;&#x6162;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:2.0.0</td>\n<td style=\"text-align:left\">4.804GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest:1.70</td>\n<td style=\"text-align:left\">4.761GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-mutinode</td>\n<td style=\"text-align:left\">4.331GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6784;&#x5EFA;&#x592A;&#x6162;&#xFF0C;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x6709;bug</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6211;&#x7684;&#x9879;&#x76EE;&#x53C2;&#x8003;&#x4E86;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x505A;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x548C;&#x91CD;&#x6784;&#x3002;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x7684;Github&#x4E3B;&#x9875;&#x4EE5;&#x53CA;&#x4F5C;&#x8005;&#x6240;&#x5199;&#x7684;&#x535A;&#x5BA2;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/alvinhenrick/hadoop-mutinode\" target=\"_blank\" rel=\"external\">GitHub</a>&#xFF0C;<a href=\"http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/\" target=\"_blank\" rel=\"external\">&#x535A;&#x5BA2;</a></p>\n<p>&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x8868;&#x662F;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x4E0E;&#x6211;&#x7684;kiwenlau/hadoop-cluster-docker&#x9879;&#x76EE;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x6BD4;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/serf</td>\n<td style=\"text-align:left\">258.213s</td>\n<td style=\"text-align:left\">21</td>\n<td style=\"text-align:left\">239.4MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-base</td>\n<td style=\"text-align:left\">2236.055s</td>\n<td style=\"text-align:left\">58</td>\n<td style=\"text-align:left\">4.328GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-dn</td>\n<td style=\"text-align:left\">51.959s</td>\n<td style=\"text-align:left\">74</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-nn-dn</td>\n<td style=\"text-align:left\">49.548s</td>\n<td style=\"text-align:left\">84</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">kiwenlau/serf-dnsmasq</td>\n<td style=\"text-align:left\">509.46s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">206.6 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-base</td>\n<td style=\"text-align:left\">400.29s</td>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-master</td>\n<td style=\"text-align:left\">5.41s</td>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-slave</td>\n<td style=\"text-align:left\">2.41s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E3B;&#x8981;&#x4F18;&#x5316;&#x4E86;&#x8FD9;&#x6837;&#x51E0;&#x70B9;</p>\n<ul>\n<li>&#x66F4;&#x5C0F;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;</li>\n<li>&#x66F4;&#x5FEB;&#x7684;&#x6784;&#x9020;&#x65F6;&#x95F4;</li>\n<li>&#x66F4;&#x5C11;&#x7684;&#x955C;&#x50CF;&#x5C42;&#x6570;</li>\n</ul>\n<h4 id=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"><a href=\"#&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\" class=\"headerlink\" title=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"></a><strong>&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;</strong></h4><p>&#x53E6;&#x5916;&#xFF0C;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x65F6;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4FEE;&#x6539;Hadoop&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-nn-dn&#x955C;&#x50CF;,&#x7136;&#x540E;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x811A;&#x672C;&#xFF0C;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x7684;&#x529F;&#x80FD;&#x3002;&#x800C;&#x6211;&#x901A;&#x8FC7;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x8BDD;&#xFF0C;&#x4E0D;&#x5230;1&#x5206;&#x949F;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#xFF01;&#xFF01;&#xFF01;&#x672C;&#x9879;&#x76EE;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x652F;&#x6301;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6570;&#x7684;hadoop&#x96C6;&#x7FA4;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x542F;&#x52A8;hadoop, &#x8FD0;&#x884C;wordcount&#x4EE5;&#x53CA;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x90FD;&#x91C7;&#x7528;&#x4E86;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x8FD9;&#x6837;&#x4F7F;&#x5F97;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x4F7F;&#x7528;&#x4EE5;&#x53CA;&#x5F00;&#x53D1;&#x90FD;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;:)</p>\n<h4 id=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"><a href=\"#&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"></a><strong>&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;</strong></h4><ul>\n<li>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF1A;ubuntu 14.04 &#x548C; ubuntu 12.04</li>\n<li>&#x5185;&#x6838;&#x7248;&#x672C;: 3.13.0-32-generic</li>\n<li>Docker&#x7248;&#x672C;&#xFF1A;1.5.0 &#x548C;1.6.2</li>\n</ul>\n<h4 id=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\"><a href=\"#&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\" class=\"headerlink\" title=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(\"></a><strong>&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(</strong></h4><h2 id=\"&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><h4 id=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"><a href=\"#&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"></a><strong>&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;</strong></h4><ul>\n<li>serf-dnsmasq</li>\n<li>hadoop-base</li>\n<li>hadoop-master</li>\n<li>hadoop-slave</li>\n</ul>\n<h4 id=\"serf-dnsmasq&#x955C;&#x50CF;\"><a href=\"#serf-dnsmasq&#x955C;&#x50CF;\" class=\"headerlink\" title=\"serf-dnsmasq&#x955C;&#x50CF;\"></a><strong>serf-dnsmasq&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;ubuntu:15.04 (&#x9009;&#x5B83;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x5C0F;&#xFF0C;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x65B0;&#x2026;)</li>\n<li>&#x5B89;&#x88C5;serf: serf&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x5730;&#x53D1;&#x73B0;&#x6240;&#x6709;hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x3002;</li>\n<li>&#x5B89;&#x88C5;dnsmasq: dnsmasq&#x4F5C;&#x4E3A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x4E3A;hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;&#x57DF;&#x540D;&#x89E3;&#x6790;&#x670D;&#x52A1;&#x3002;</li>\n</ul>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;master&#x8282;&#x70B9;&#x7684;IP&#x4F1A;&#x4F20;&#x7ED9;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;serf&#x4F1A;&#x5728;container&#x542F;&#x52A8;&#x540E;&#x7ACB;&#x5373;&#x542F;&#x52A8;&#x3002;slave&#x8282;&#x70B9;&#x4E0A;&#x7684;serf agent&#x4F1A;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;master&#x8282;&#x70B9;&#xFF08;master IP&#x5B83;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x561B;&#xFF09;&#xFF0C;master&#x8282;&#x70B9;&#x5C31;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;&#x7136;&#x540E;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x4E92;&#x76F8;&#x4EA4;&#x6362;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x6709;&#x8282;&#x70B9;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x5B58;&#x5728;&#x4E86;&#xFF01;(Everyone will know Everyone). serf&#x53D1;&#x73B0;&#x65B0;&#x7684;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x914D;&#x7F6E;dnsmasq,&#x7136;&#x540E;&#x91CD;&#x542F;dnsmasq. &#x6240;&#x4EE5;dnsmasq&#x5C31;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x96C6;&#x7FA4;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x5566;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x968F;&#x7740;&#x8282;&#x70B9;&#x7684;&#x589E;&#x52A0;&#x4F1A;&#x8017;&#x65F6;&#x66F4;&#x4E45;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x82E5;&#x914D;&#x7F6E;&#x7684;Hadoop&#x8282;&#x70B9;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5219;&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#x9700;&#x8981;&#x6D4B;&#x8BD5;serf&#x662F;&#x5426;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;dns&#x662F;&#x5426;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x6240;&#x6709;&#x8282;&#x70B9;&#x57DF;&#x540D;&#x3002;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x624D;&#x80FD;&#x542F;&#x52A8;Hadoop&#x3002;&#x8FD9;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x7531;SequenceIQ&#x516C;&#x53F8;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x8BE5;&#x516C;&#x53F8;&#x4E13;&#x6CE8;&#x4E8E;&#x5C06;Hadoop&#x8FD0;&#x884C;&#x5728;Docker&#x4E2D;&#x3002;&#x8BF7;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;PPT&#xFF1A;<a href=\"http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning\" target=\"_blank\" rel=\"external\">Docker-based Hadoop Provisioning</a></p>\n<h4 id=\"hadoop-base&#x955C;&#x50CF;\"><a href=\"#hadoop-base&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-base&#x955C;&#x50CF;\"></a><strong>hadoop-base&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;</li>\n<li>&#x5B89;&#x88C5;JDK(openjdk)</li>\n<li>&#x5B89;&#x88C5;openssh-server, &#x914D;&#x7F6E;&#x65E0;&#x5BC6;&#x7801;ssh</li>\n<li>&#x5B89;&#x88C5;vim&#xFF1A;&#x4ECB;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x6109;&#x5FEB;&#x5730;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x6572;&#x4EE3;&#x7801;&#x4E86;:)</li>\n<li>&#x5B89;&#x88C5;Hadoop 2.3.0: &#x5B89;&#x88C5;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop &#xFF08;2.5.2&#xFF0C; 2.6.0&#xFF0C; 2.7.0 &#x90FD;&#x6BD4;2.3.0&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x61D2;&#x5F97;&#x5347;&#x7EA7;&#x4E86;&#xFF09;</li>\n</ul>\n<p>&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x8BF7;&#x53C2;&#x8003;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF1A;<a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\" target=\"_blank\" rel=\"external\"><a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\" target=\"_blank\" rel=\"external\">Hadoop 2.30 &#x5728;Ubuntu 14.04 &#x4E2D;&#x7F16;&#x8BD1;</a></a></p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5F00;&#x53D1;&#x6211;&#x7684;hadoop-base, &#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop-2.3.0&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x653E;&#x5230;hadoop-cluster-docker/hadoop-base/files&#x76EE;&#x5F55;&#x5185;&#x3002;&#x6211;&#x7F16;&#x8BD1;&#x7684;64&#x4F4D;hadoop-2.3.0&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"http://pan.baidu.com/s/1sjFRaFz\" target=\"_blank\" rel=\"external\">hadoop-2.3.0</a></p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x6211;&#x8FD8;&#x7F16;&#x8BD1;&#x4E86;64&#x4F4D;&#x7684;hadoop 2.5.2, 2.6.0, 2.7.0, &#x5176;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x5982;&#x4E0B;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://pan.baidu.com/s/1sjFRaFz\" target=\"_blank\" rel=\"external\">hadoop-2.3.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1jGw24aa\" target=\"_blank\" rel=\"external\">hadoop-2.5.2</a></li>\n<li><a href=\"http://pan.baidu.com/s/1eQgvF2M\" target=\"_blank\" rel=\"external\">hadoop-2.6.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1c0HD0Nu\" target=\"_blank\" rel=\"external\">hadoop-2.7.0</a></li>\n</ul>\n<h4 id=\"hadoop-master&#x955C;&#x50CF;\"><a href=\"#hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-master&#x955C;&#x50CF;\"></a><strong>hadoop-master&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;master&#x8282;&#x70B9;</li>\n<li>&#x683C;&#x5F0F;&#x5316;namenode</li>\n</ul>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x9700;&#x8981;&#x914D;&#x7F6E;slaves&#x6587;&#x4EF6;&#xFF0C;&#x800C;slaves&#x6587;&#x4EF6;&#x9700;&#x8981;&#x5217;&#x51FA;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x6216;&#x8005;IP&#x3002;&#x56E0;&#x6B64;&#xFF0C;Hadoop&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4E0D;&#x540C;&#x65F6;&#xFF0C;slaves&#x6587;&#x4EF6;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x66F4;&#x6539;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;slaves&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#x3002;&#x6211;&#x7F16;&#x5199;&#x4E86;&#x4E00;&#x4E2A;resize-cluster.sh&#x811A;&#x672C;&#x81EA;&#x52A8;&#x5316;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x3002;&#x4EC5;&#x9700;&#x7ED9;&#x5B9A;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x53C2;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x7684;&#x66F4;&#x6539;&#x3002;&#x7531;&#x4E8E;hadoop-master&#x955C;&#x50CF;&#x4EC5;&#x4EC5;&#x505A;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x65E0;&#x9700;&#x4E0B;&#x8F7D;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>\n<h4 id=\"hadoop-slave&#x955C;&#x50CF;\"><a href=\"#hadoop-slave&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-slave&#x955C;&#x50CF;\"></a><strong>hadoop-slave&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;slave&#x8282;&#x70B9;</li>\n</ul>\n<h4 id=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"><a href=\"#&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"></a><strong>&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;</strong></h4><p>&#x4E0B;&#x8868;&#x4E3A;sudo docker images&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>ubuntu</td>\n<td>15.04</td>\n<td>bd94ae587483</td>\n<td>3 weeks ago</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6613;&#x77E5;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF1A;</p>\n<ul>\n<li>serf-dnsmasq&#x955C;&#x50CF;&#x5728;ubuntu:15.04&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;75.4MB</li>\n<li>hadoop-base&#x955C;&#x50CF;&#x5728;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;570.7MB</li>\n<li>hadoop-master&#x548C;hadoop-slave&#x955C;&#x50CF;&#x5728;hadoop-base&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5927;&#x5C0F;&#x51E0;&#x4E4E;&#x6CA1;&#x6709;&#x589E;&#x52A0;</li>\n</ul>\n<p>&#x4E0B;&#x8868;&#x4E3A;docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0&#x547D;&#x4EE4;&#x7684;&#x90E8;&#x5206;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>IMAGE</th>\n<th>CREATED</th>\n<th>CREATED BY</th>\n<th>SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2039b9b81146</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c #(nop) ADD   multi:a93c971a49514e787</td>\n<td>158.5 MB</td>\n</tr>\n<tr>\n<td>cdb620312f30</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openjdk-7-jdk</td>\n<td>324.6 MB</td>\n</tr>\n<tr>\n<td>da7d10c790c1</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openssh-server</td>\n<td>87.58 MB</td>\n</tr>\n<tr>\n<td>c65cb568defc</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c curl -Lso serf.zip <a href=\"https://dl.bint\" target=\"_blank\" rel=\"external\">https://dl.bint</a></td>\n<td>14.46 MB</td>\n</tr>\n<tr>\n<td>3e22b3d72e33</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get update &amp;&amp; apt-get install</td>\n<td>60.89 MB</td>\n</tr>\n<tr>\n<td>b68f8c8d2140</td>\n<td>3 weeks ago</td>\n<td>/bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;</p>\n<ul>\n<li>&#x57FA;&#x7840;&#x955C;&#x50CF;ubuntu:15.04&#x4E3A;131.3MB</li>\n<li>&#x5B89;&#x88C5;openjdk&#x9700;&#x8981;324.6MB</li>\n<li>&#x5B89;&#x88C5;hadoop&#x9700;&#x8981;158.5MB</li>\n<li>ubuntu,openjdk&#x4E0E;hadoop&#x5747;&#x4E3A;&#x955C;&#x50CF;&#x6240;&#x5FC5;&#x987B;&#xFF0C;&#x4E09;&#x8005;&#x4E00;&#x5171;&#x5360;&#x4E86;:614.4MB</li>\n</ul>\n<h4 id=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"><a href=\"#&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\" class=\"headerlink\" title=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"></a><strong>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;</strong></h4><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x9879;&#x76EE;&#x7684;Docker&#x955C;&#x50CF;&#x7ED3;&#x6784;&#xFF1A;</p>\n<p><img src=\"/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png\" width=\"500\"></p>\n<h2 id=\"&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\"><a href=\"#1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x62C9;&#x53D6;&#x955C;&#x50CF;\"></a>1. <strong>&#x62C9;&#x53D6;&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<ul>\n<li>3~5&#x5206;&#x949F;OK~</li>\n</ul>\n<p><em>&#x67E5;&#x770B;&#x4E0B;&#x8F7D;&#x7684;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>hadoop-base&#x955C;&#x50CF;&#x662F;&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#xFF0C;hadoop-slave&#x955C;&#x50CF;&#x548C;hadoop-master&#x955C;&#x50CF;&#x90FD;&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x6240;&#x4EE5;&#x5176;&#x5B9E;4&#x4E2A;&#x955C;&#x50CF;&#x4E00;&#x5171;&#x4E5F;&#x5C31;777.4MB:)</li>\n</ul>\n<h4 id=\"2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"><a href=\"#2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\" class=\"headerlink\" title=\"2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"></a><strong>2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<p><em>&#x67E5;&#x770B;&#x4FEE;&#x6539;tag&#x540E;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x4FEE;&#x6539;&#x955C;&#x50CF;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x9ED8;&#x8BA4;&#x662F;&#x5C06;&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;Dockerhub, &#x56E0;&#x6B64;Dokerfile&#x4EE5;&#x53CA;shell&#x811A;&#x672C;&#x4E2D;&#x5F97;&#x955C;&#x50CF;&#x540D;&#x79F0;&#x90FD;&#x662F;&#x6CA1;&#x6709;alauada&#x524D;&#x7F00;&#x7684;&#xFF0C;sorry for this&#x2026;.&#x4E0D;&#x8FC7;&#x6539;tag&#x8FD8;&#x662F;&#x5F88;&#x5FEB;&#x6EF4;</li>\n<li>&#x82E5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x5728;DockerHub&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;tag&#x2026;&#x4E0D;&#x8FC7;Alauda&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#x7684;&#x54C8;~</li>\n</ul>\n<h4 id=\"3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"><a href=\"#3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\" class=\"headerlink\" title=\"3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"></a><strong>3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E3A;&#x4E86;&#x9632;&#x6B62;Github&#x88AB;XX, &#x6211;&#x628A;&#x4EE3;&#x7801;&#x5BFC;&#x5165;&#x5230;&#x4E86;&#x5F00;&#x6E90;&#x4E2D;&#x56FD;&#x7684;git&#x4ED3;&#x5E93;</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> http://git.oschina.net/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> hadoop-cluster-docker</div><div class=\"line\">./start-container.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">start master container...</div><div class=\"line\">start slave1 container...</div><div class=\"line\">start slave2 container...</div><div class=\"line\">root@master:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E00;&#x5171;&#x5F00;&#x542F;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;master&#x5BB9;&#x5668;root&#x7528;&#x6237;&#x7684;&#x5BB6;&#x76EE;&#x5F55;&#xFF08;/root&#xFF09;</li>\n</ul>\n<p><em>&#x67E5;&#x770B;master&#x7684;root&#x7528;&#x6237;&#x5BB6;&#x76EE;&#x5F55;&#x7684;&#x6587;&#x4EF6;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ls</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">hdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>start-hadoop.sh&#x662F;&#x5F00;&#x542F;hadoop&#x7684;shell&#x811A;&#x672C;</li>\n<li>run-wordcount.sh&#x662F;&#x8FD0;&#x884C;wordcount&#x7684;shell&#x811A;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x955C;&#x50CF;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;</li>\n</ul>\n<h4 id=\"5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\"><a href=\"#5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)\"></a><strong>5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)</strong></h4><p><em>&#x67E5;&#x770B;hadoop&#x96C6;&#x7FA4;&#x6210;&#x5458;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">serf members</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">master.kiwenlau.com  172.17.0.65:7946  alive</div><div class=\"line\">slave1.kiwenlau.com  172.17.0.66:7946  alive</div><div class=\"line\">slave2.kiwenlau.com  172.17.0.67:7946  alive</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;&#x7ED3;&#x679C;&#x7F3A;&#x5C11;&#x8282;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x201C;serf members&#x201D;&#x547D;&#x4EE4;&#x3002;&#x56E0;&#x4E3A;serf agent&#x9700;&#x8981;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#x3002;</li>\n</ul>\n<p><em>&#x6D4B;&#x8BD5;ssh</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ssh slave2.kiwenlau.com</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Warning: Permanently added <span class=\"string\">&apos;slave2.kiwenlau.com,172.17.0.67&apos;</span> (ECDSA) to the list of known hosts.</div><div class=\"line\">Welcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)</div><div class=\"line\">* Documentation:  https://help.ubuntu.com/</div><div class=\"line\">The programs included with the Ubuntu system are free software;</div><div class=\"line\">the exact distribution terms <span class=\"keyword\">for</span> each program are described <span class=\"keyword\">in</span> the</div><div class=\"line\">individual files <span class=\"keyword\">in</span> /usr/share/doc/*/copyright.</div><div class=\"line\">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</div><div class=\"line\">applicable law.</div><div class=\"line\">root@slave2:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<p><em>&#x9000;&#x51FA;slave2</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">exit</span></div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">logout</span></div><div class=\"line\">Connection to slave2.kiwenlau.com closed.</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;ssh&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x518D;&#x6D4B;&#x8BD5;&#xFF0C;&#x56E0;&#x4E3A;dnsmasq&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x3002;</li>\n<li>&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x542F;Hadoop&#x96C6;&#x7FA4;&#x4E86;&#xFF01;&#x5176;&#x5B9E;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x8010;&#x5FC3;&#x7B49;&#x5F85;&#x4E00;&#x5206;&#x949F;&#x5373;&#x53EF;&#xFF01;</li>\n</ul>\n<h4 id=\"6-&#x5F00;&#x542F;hadoop\"><a href=\"#6-&#x5F00;&#x542F;hadoop\" class=\"headerlink\" title=\"6. &#x5F00;&#x542F;hadoop\"></a><strong>6. &#x5F00;&#x542F;hadoop</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-hadoop.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0A;&#x4E00;&#x6B65;ssh&#x5230;slave2&#x4E4B;&#x540E;&#xFF0C;&#x8BF7;&#x8BB0;&#x5F97;&#x56DE;&#x5230;master&#x554A;!!&#xFF01;</li>\n<li>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x592A;&#x591A;&#xFF0C;&#x5FFD;&#x7565;&#x2026;.</li>\n<li>hadoop&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h4 id=\"7-&#x8FD0;&#x884C;wordcount\"><a href=\"#7-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"7. &#x8FD0;&#x884C;wordcount\"></a><strong>7. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./run-wordcount.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">input file1.txt:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\">input file2.txt:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t1</div><div class=\"line\">Hadoop\t1</div><div class=\"line\">Hello\t2</div></pre></td></tr></table></figure></p>\n<ul>\n<li>wordcount&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h2 id=\"&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"><a href=\"#1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"></a><strong>1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x4FEE;&#x6539;tag&#xFF0C;&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</li>\n<li>&#x6CE8;&#x610F;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x4E0B;&#x8F7D;serf-dnsmasq, &#x4F46;&#x662F;&#x8BF7;&#x6700;&#x597D;&#x4E0B;&#x8F7D;hadoop-base&#xFF0C;&#x56E0;&#x4E3A;hadoop-master&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x6784;&#x5EFA;&#x7684;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-cluster.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0D;&#x8981;&#x62C5;&#x5FC3;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x80FD;&#x641E;&#x5B9A;</li>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5462;&#xFF0C;&#x6700;&#x597D;&#x8FD8;&#x662F;&#x5F97;&#x548C;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x4E00;&#x81F4;:)</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5927;&#xFF0C;&#x4F60;&#x591A;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#xFF0C;Hadoop&#x4E0D;&#x8BA4;&#x8BC6;&#x5B83;&#x4EEC;..</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5C0F;&#xFF0C;Hadoop&#x89C9;&#x5F97;&#x5C11;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;..</li>\n</ul>\n<h4 id=\"4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"><a href=\"#4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"></a><strong>4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E09;&#x90E8;&#x5206;5~7&#xFF1A;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x5F00;&#x542F;Hadoop&#xFF0C;&#x8FD0;&#x884C;wordcount</li>\n<li>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x82E5;&#x8282;&#x70B9;&#x589E;&#x52A0;&#xFF0C;&#x8BF7;&#x52A1;&#x5FC5;&#x5148;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5F00;&#x542F;Hadoop, &#x56E0;&#x4E3A;serf&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;&#x800C;dnsmasq&#x7684;DNS&#x670D;&#x52A1;&#x5668;&#x8868;&#x793A;&#x8FD8;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x597D;&#x670D;&#x52A1;</li>\n<li>&#x6D4B;&#x8BD5;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x5DF2;&#x66F4;&#x65B0;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x4E4B;&#x5347;&#x7EA7;&#x7248;</a>!!!</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau\">kiwenlau/hadoop-cluster-docker</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">2015-06-08</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x5728;&#x5355;&#x673A;&#x4E0A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadopp&#x96C6;&#x7FA4;&#x65B9;&#x6CD5;&#xFF0C;Hadoop&#x7684;Master&#x548C;Slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#xFF0C;&#x5FEB;&#x901F;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;</p>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x7B80;&#x4ECB;</h2><p>&#x76F4;&#x63A5;&#x7528;&#x673A;&#x5668;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5F53;&#x75DB;&#x82E6;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C24;&#x5176;&#x5BF9;&#x521D;&#x5B66;&#x8005;&#x6765;&#x8BF4;&#x3002;&#x4ED6;&#x4EEC;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;&#x8DD1;wordcount&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x88AB;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6298;&#x817E;&#x7684;&#x4F53;&#x65E0;&#x5B8C;&#x80A4;&#x4E86;&#x3002;</p>\n<p>&#x6211;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5C06;Hadoop&#x96C6;&#x7FA4;&#x8FD0;&#x884C;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x4F7F;Hadoop&#x5F00;&#x53D1;&#x8005;&#x80FD;&#x591F;&#x5FEB;&#x901F;&#x4FBF;&#x6377;&#x5730;&#x5728;&#x672C;&#x673A;&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#x3002;&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E0D;&#x5C11;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x90FD;&#x4E0D;&#x662F;&#x5F88;&#x7406;&#x60F3;&#xFF0C;&#x4ED6;&#x4EEC;&#x6216;&#x8005;&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x592A;&#x6162;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x4E86;&#x7B2C;&#x4E09;&#x65B9;&#x5DE5;&#x5177;&#x4F7F;&#x5F97;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#x2026;&#x4E0B;&#x8868;&#x4E3A;&#x4E00;&#x4E9B;&#x5DF2;&#x77E5;&#x7684;Hadoop on Docker&#x9879;&#x76EE;&#x4EE5;&#x53CA;&#x5176;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x9879;&#x76EE;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n<th style=\"text-align:left\">&#x95EE;&#x9898;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:latest</td>\n<td style=\"text-align:left\">1.491GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x53EA;&#x652F;&#x6301;&#x5355;&#x4E2A;&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.7.0</td>\n<td style=\"text-align:left\">1.76 GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/hadoop-docker:2.6.0</td>\n<td style=\"text-align:left\">1.624GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest</td>\n<td style=\"text-align:left\">1.782GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x4F7F;&#x7528;&#x592A;&#x6162;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:2.0.0</td>\n<td style=\"text-align:left\">4.804GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sequenceiq/ambari:latest:1.70</td>\n<td style=\"text-align:left\">4.761GB</td>\n<td style=\"text-align:left\">&#x540C;&#x4E0A;</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-mutinode</td>\n<td style=\"text-align:left\">4.331GB</td>\n<td style=\"text-align:left\">&#x955C;&#x50CF;&#x592A;&#x5927;&#xFF0C;&#x6784;&#x5EFA;&#x592A;&#x6162;&#xFF0C;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x9EBB;&#x70E6;&#xFF0C;&#x6709;bug</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6211;&#x7684;&#x9879;&#x76EE;&#x53C2;&#x8003;&#x4E86;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x505A;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x548C;&#x91CD;&#x6784;&#x3002;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x7684;Github&#x4E3B;&#x9875;&#x4EE5;&#x53CA;&#x4F5C;&#x8005;&#x6240;&#x5199;&#x7684;&#x535A;&#x5BA2;&#x5730;&#x5740;&#xFF1A;<a href=\"https://github.com/alvinhenrick/hadoop-mutinode\">GitHub</a>&#xFF0C;<a href=\"http://alvinhenrick.com/2014/07/16/hadoop-yarn-multinode-cluster-with-docker/\">&#x535A;&#x5BA2;</a></p>\n<p>&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x8868;&#x662F;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x4E0E;&#x6211;&#x7684;kiwenlau/hadoop-cluster-docker&#x9879;&#x76EE;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x6BD4;</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/serf</td>\n<td style=\"text-align:left\">258.213s</td>\n<td style=\"text-align:left\">21</td>\n<td style=\"text-align:left\">239.4MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-base</td>\n<td style=\"text-align:left\">2236.055s</td>\n<td style=\"text-align:left\">58</td>\n<td style=\"text-align:left\">4.328GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-dn</td>\n<td style=\"text-align:left\">51.959s</td>\n<td style=\"text-align:left\">74</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">alvinhenrick/hadoop-nn-dn</td>\n<td style=\"text-align:left\">49.548s</td>\n<td style=\"text-align:left\">84</td>\n<td style=\"text-align:left\">4.331GB</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x540D;&#x79F0;</th>\n<th style=\"text-align:left\">&#x6784;&#x5EFA;&#x65F6;&#x95F4;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5C42;&#x6570;</th>\n<th style=\"text-align:left\">&#x955C;&#x50CF;&#x5927;&#x5C0F;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">kiwenlau/serf-dnsmasq</td>\n<td style=\"text-align:left\">509.46s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">206.6 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-base</td>\n<td style=\"text-align:left\">400.29s</td>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-master</td>\n<td style=\"text-align:left\">5.41s</td>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">kiwenlau/hadoop-slave</td>\n<td style=\"text-align:left\">2.41s</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">775.4 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E3B;&#x8981;&#x4F18;&#x5316;&#x4E86;&#x8FD9;&#x6837;&#x51E0;&#x70B9;</p>\n<ul>\n<li>&#x66F4;&#x5C0F;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;</li>\n<li>&#x66F4;&#x5FEB;&#x7684;&#x6784;&#x9020;&#x65F6;&#x95F4;</li>\n<li>&#x66F4;&#x5C11;&#x7684;&#x955C;&#x50CF;&#x5C42;&#x6570;</li>\n</ul>\n<h4 id=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"><a href=\"#&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\" class=\"headerlink\" title=\"&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;\"></a><strong>&#x66F4;&#x5FEB;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x6539;&#x53D8;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;</strong></h4><p>&#x53E6;&#x5916;&#xFF0C;alvinhenrick/hadoop-mutinode&#x9879;&#x76EE;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x65F6;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4FEE;&#x6539;Hadoop&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-nn-dn&#x955C;&#x50CF;,&#x7136;&#x540E;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x811A;&#x672C;&#xFF0C;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x589E;&#x52A0;&#x8282;&#x70B9;&#x7684;&#x529F;&#x80FD;&#x3002;&#x800C;&#x6211;&#x901A;&#x8FC7;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x8BDD;&#xFF0C;&#x4E0D;&#x5230;1&#x5206;&#x949F;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#xFF01;&#xFF01;&#xFF01;&#x672C;&#x9879;&#x76EE;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x652F;&#x6301;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6570;&#x7684;hadoop&#x96C6;&#x7FA4;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x542F;&#x52A8;hadoop, &#x8FD0;&#x884C;wordcount&#x4EE5;&#x53CA;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x90FD;&#x91C7;&#x7528;&#x4E86;shell&#x811A;&#x672C;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x8FD9;&#x6837;&#x4F7F;&#x5F97;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x4F7F;&#x7528;&#x4EE5;&#x53CA;&#x5F00;&#x53D1;&#x90FD;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;:)</p>\n<h4 id=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"><a href=\"#&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;\"></a><strong>&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;</strong></h4><ul>\n<li>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF1A;ubuntu 14.04 &#x548C; ubuntu 12.04</li>\n<li>&#x5185;&#x6838;&#x7248;&#x672C;: 3.13.0-32-generic</li>\n<li>Docker&#x7248;&#x672C;&#xFF1A;1.5.0 &#x548C;1.6.2</li>\n</ul>\n<h4 id=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\"><a href=\"#&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;\" class=\"headerlink\" title=\"&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(\"></a><strong>&#x786C;&#x76D8;&#x4E0D;&#x591F;&#xFF0C;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5185;&#x6838;&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#x4F1A;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;:(</strong></h4><h2 id=\"&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. &#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><h4 id=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"><a href=\"#&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;\"></a><strong>&#x672C;&#x9879;&#x76EE;&#x4E00;&#x5171;&#x5F00;&#x53D1;&#x4E86;4&#x4E2A;&#x955C;&#x50CF;</strong></h4><ul>\n<li>serf-dnsmasq</li>\n<li>hadoop-base</li>\n<li>hadoop-master</li>\n<li>hadoop-slave</li>\n</ul>\n<h4 id=\"serf-dnsmasq&#x955C;&#x50CF;\"><a href=\"#serf-dnsmasq&#x955C;&#x50CF;\" class=\"headerlink\" title=\"serf-dnsmasq&#x955C;&#x50CF;\"></a><strong>serf-dnsmasq&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;ubuntu:15.04 (&#x9009;&#x5B83;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x5C0F;&#xFF0C;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6700;&#x65B0;&#x2026;)</li>\n<li>&#x5B89;&#x88C5;serf: serf&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x673A;&#x5668;&#x8282;&#x70B9;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x5730;&#x53D1;&#x73B0;&#x6240;&#x6709;hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x3002;</li>\n<li>&#x5B89;&#x88C5;dnsmasq: dnsmasq&#x4F5C;&#x4E3A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x4E3A;hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;&#x57DF;&#x540D;&#x89E3;&#x6790;&#x670D;&#x52A1;&#x3002;</li>\n</ul>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;master&#x8282;&#x70B9;&#x7684;IP&#x4F1A;&#x4F20;&#x7ED9;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;serf&#x4F1A;&#x5728;container&#x542F;&#x52A8;&#x540E;&#x7ACB;&#x5373;&#x542F;&#x52A8;&#x3002;slave&#x8282;&#x70B9;&#x4E0A;&#x7684;serf agent&#x4F1A;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;master&#x8282;&#x70B9;&#xFF08;master IP&#x5B83;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x561B;&#xFF09;&#xFF0C;master&#x8282;&#x70B9;&#x5C31;&#x9A6C;&#x4E0A;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;slave&#x8282;&#x70B9;&#x3002;&#x7136;&#x540E;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x4E92;&#x76F8;&#x4EA4;&#x6362;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x6709;&#x8282;&#x70B9;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x5B58;&#x5728;&#x4E86;&#xFF01;(Everyone will know Everyone). serf&#x53D1;&#x73B0;&#x65B0;&#x7684;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x914D;&#x7F6E;dnsmasq,&#x7136;&#x540E;&#x91CD;&#x542F;dnsmasq. &#x6240;&#x4EE5;dnsmasq&#x5C31;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x96C6;&#x7FA4;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x5566;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x968F;&#x7740;&#x8282;&#x70B9;&#x7684;&#x589E;&#x52A0;&#x4F1A;&#x8017;&#x65F6;&#x66F4;&#x4E45;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x82E5;&#x914D;&#x7F6E;&#x7684;Hadoop&#x8282;&#x70B9;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5219;&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#x9700;&#x8981;&#x6D4B;&#x8BD5;serf&#x662F;&#x5426;&#x53D1;&#x73B0;&#x4E86;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;dns&#x662F;&#x5426;&#x80FD;&#x591F;&#x89E3;&#x6790;&#x6240;&#x6709;&#x8282;&#x70B9;&#x57DF;&#x540D;&#x3002;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x624D;&#x80FD;&#x542F;&#x52A8;Hadoop&#x3002;&#x8FD9;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x7531;SequenceIQ&#x516C;&#x53F8;&#x63D0;&#x51FA;&#x7684;&#xFF0C;&#x8BE5;&#x516C;&#x53F8;&#x4E13;&#x6CE8;&#x4E8E;&#x5C06;Hadoop&#x8FD0;&#x884C;&#x5728;Docker&#x4E2D;&#x3002;&#x8BF7;&#x53C2;&#x8003;&#x8FD9;&#x4E2A;PPT&#xFF1A;<a href=\"http://www.slideshare.net/JanosMatyas/docker-based-hadoop-provisioning\">Docker-based Hadoop Provisioning</a></p>\n<h4 id=\"hadoop-base&#x955C;&#x50CF;\"><a href=\"#hadoop-base&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-base&#x955C;&#x50CF;\"></a><strong>hadoop-base&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;</li>\n<li>&#x5B89;&#x88C5;JDK(openjdk)</li>\n<li>&#x5B89;&#x88C5;openssh-server, &#x914D;&#x7F6E;&#x65E0;&#x5BC6;&#x7801;ssh</li>\n<li>&#x5B89;&#x88C5;vim&#xFF1A;&#x4ECB;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x6109;&#x5FEB;&#x5730;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x6572;&#x4EE3;&#x7801;&#x4E86;:)</li>\n<li>&#x5B89;&#x88C5;Hadoop 2.3.0: &#x5B89;&#x88C5;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop &#xFF08;2.5.2&#xFF0C; 2.6.0&#xFF0C; 2.7.0 &#x90FD;&#x6BD4;2.3.0&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x61D2;&#x5F97;&#x5347;&#x7EA7;&#x4E86;&#xFF09;</li>\n</ul>\n<p>&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x8BF7;&#x53C2;&#x8003;&#x6211;&#x7684;&#x535A;&#x5BA2;&#xFF1A;<a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\"><a href=\"http://www.cnblogs.com/kiwenlau/p/4227204.html\">Hadoop 2.30 &#x5728;Ubuntu 14.04 &#x4E2D;&#x7F16;&#x8BD1;</a></a></p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5F00;&#x53D1;&#x6211;&#x7684;hadoop-base, &#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;hadoop-2.3.0&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x653E;&#x5230;hadoop-cluster-docker/hadoop-base/files&#x76EE;&#x5F55;&#x5185;&#x3002;&#x6211;&#x7F16;&#x8BD1;&#x7684;64&#x4F4D;hadoop-2.3.0&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"http://pan.baidu.com/s/1sjFRaFz\">hadoop-2.3.0</a></p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x6211;&#x8FD8;&#x7F16;&#x8BD1;&#x4E86;64&#x4F4D;&#x7684;hadoop 2.5.2, 2.6.0, 2.7.0, &#x5176;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x5982;&#x4E0B;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://pan.baidu.com/s/1sjFRaFz\">hadoop-2.3.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1jGw24aa\">hadoop-2.5.2</a></li>\n<li><a href=\"http://pan.baidu.com/s/1eQgvF2M\">hadoop-2.6.0</a></li>\n<li><a href=\"http://pan.baidu.com/s/1c0HD0Nu\">hadoop-2.7.0</a></li>\n</ul>\n<h4 id=\"hadoop-master&#x955C;&#x50CF;\"><a href=\"#hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-master&#x955C;&#x50CF;\"></a><strong>hadoop-master&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;master&#x8282;&#x70B9;</li>\n<li>&#x683C;&#x5F0F;&#x5316;namenode</li>\n</ul>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x9700;&#x8981;&#x914D;&#x7F6E;slaves&#x6587;&#x4EF6;&#xFF0C;&#x800C;slaves&#x6587;&#x4EF6;&#x9700;&#x8981;&#x5217;&#x51FA;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x57DF;&#x540D;&#x6216;&#x8005;IP&#x3002;&#x56E0;&#x6B64;&#xFF0C;Hadoop&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4E0D;&#x540C;&#x65F6;&#xFF0C;slaves&#x6587;&#x4EF6;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x66F4;&#x6539;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;slaves&#x6587;&#x4EF6;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;&#x3002;&#x6211;&#x7F16;&#x5199;&#x4E86;&#x4E00;&#x4E2A;resize-cluster.sh&#x811A;&#x672C;&#x81EA;&#x52A8;&#x5316;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x3002;&#x4EC5;&#x9700;&#x7ED9;&#x5B9A;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x53C2;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;Hadoop&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x6570;&#x76EE;&#x7684;&#x66F4;&#x6539;&#x3002;&#x7531;&#x4E8E;hadoop-master&#x955C;&#x50CF;&#x4EC5;&#x4EC5;&#x505A;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x65E0;&#x9700;&#x4E0B;&#x8F7D;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF0C;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>\n<h4 id=\"hadoop-slave&#x955C;&#x50CF;\"><a href=\"#hadoop-slave&#x955C;&#x50CF;\" class=\"headerlink\" title=\"hadoop-slave&#x955C;&#x50CF;\"></a><strong>hadoop-slave&#x955C;&#x50CF;</strong></h4><ul>\n<li>&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x914D;&#x7F6E;hadoop&#x7684;slave&#x8282;&#x70B9;</li>\n</ul>\n<h4 id=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"><a href=\"#&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;\"></a><strong>&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x5206;&#x6790;</strong></h4><p>&#x4E0B;&#x8868;&#x4E3A;sudo docker images&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>ubuntu</td>\n<td>15.04</td>\n<td>bd94ae587483</td>\n<td>3 weeks ago</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6613;&#x77E5;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF1A;</p>\n<ul>\n<li>serf-dnsmasq&#x955C;&#x50CF;&#x5728;ubuntu:15.04&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;75.4MB</li>\n<li>hadoop-base&#x955C;&#x50CF;&#x5728;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;570.7MB</li>\n<li>hadoop-master&#x548C;hadoop-slave&#x955C;&#x50CF;&#x5728;hadoop-base&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5927;&#x5C0F;&#x51E0;&#x4E4E;&#x6CA1;&#x6709;&#x589E;&#x52A0;</li>\n</ul>\n<p>&#x4E0B;&#x8868;&#x4E3A;docker history index.alauda.cn/kiwenlau/hadoop-base:0.1.0&#x547D;&#x4EE4;&#x7684;&#x90E8;&#x5206;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>\n<table>\n<thead>\n<tr>\n<th>IMAGE</th>\n<th>CREATED</th>\n<th>CREATED BY</th>\n<th>SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>2039b9b81146</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c #(nop) ADD   multi:a93c971a49514e787</td>\n<td>158.5 MB</td>\n</tr>\n<tr>\n<td>cdb620312f30</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openjdk-7-jdk</td>\n<td>324.6 MB</td>\n</tr>\n<tr>\n<td>da7d10c790c1</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get install -y openssh-server</td>\n<td>87.58 MB</td>\n</tr>\n<tr>\n<td>c65cb568defc</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c curl -Lso serf.zip <a href=\"https://dl.bint\">https://dl.bint</a></td>\n<td>14.46 MB</td>\n</tr>\n<tr>\n<td>3e22b3d72e33</td>\n<td>44 hours ago</td>\n<td>/bin/sh -c apt-get update &amp;&amp; apt-get install</td>\n<td>60.89 MB</td>\n</tr>\n<tr>\n<td>b68f8c8d2140</td>\n<td>3 weeks ago</td>\n<td>/bin/sh -c #(nop) ADD file:d90f7467c470bfa9a3</td>\n<td>131.3 MB</td>\n</tr>\n</tbody>\n</table>\n<p>&#x53EF;&#x77E5;</p>\n<ul>\n<li>&#x57FA;&#x7840;&#x955C;&#x50CF;ubuntu:15.04&#x4E3A;131.3MB</li>\n<li>&#x5B89;&#x88C5;openjdk&#x9700;&#x8981;324.6MB</li>\n<li>&#x5B89;&#x88C5;hadoop&#x9700;&#x8981;158.5MB</li>\n<li>ubuntu,openjdk&#x4E0E;hadoop&#x5747;&#x4E3A;&#x955C;&#x50CF;&#x6240;&#x5FC5;&#x987B;&#xFF0C;&#x4E09;&#x8005;&#x4E00;&#x5171;&#x5360;&#x4E86;:614.4MB</li>\n</ul>\n<h4 id=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"><a href=\"#&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\" class=\"headerlink\" title=\"&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;\"></a><strong>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x6240;&#x5F00;&#x53D1;&#x7684;hadoop&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x63A5;&#x8FD1;&#x6700;&#x5C0F;&#xFF0C;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;</strong></h4><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x9879;&#x76EE;&#x7684;Docker&#x955C;&#x50CF;&#x7ED3;&#x6784;&#xFF1A;</p>\n<p><img src=\"/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png\" width=\"500\"></p>\n<h2 id=\"&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\"><a href=\"#1-&#x62C9;&#x53D6;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x62C9;&#x53D6;&#x955C;&#x50CF;\"></a>1. <strong>&#x62C9;&#x53D6;&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<ul>\n<li>3~5&#x5206;&#x949F;OK~</li>\n</ul>\n<p><em>&#x67E5;&#x770B;&#x4E0B;&#x8F7D;&#x7684;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>hadoop-base&#x955C;&#x50CF;&#x662F;&#x57FA;&#x4E8E;serf-dnsmasq&#x955C;&#x50CF;&#x7684;&#xFF0C;hadoop-slave&#x955C;&#x50CF;&#x548C;hadoop-master&#x955C;&#x50CF;&#x90FD;&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x955C;&#x50CF;</li>\n<li>&#x6240;&#x4EE5;&#x5176;&#x5B9E;4&#x4E2A;&#x955C;&#x50CF;&#x4E00;&#x5171;&#x4E5F;&#x5C31;777.4MB:)</li>\n</ul>\n<h4 id=\"2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"><a href=\"#2-&#x4FEE;&#x6539;&#x955C;&#x50CF;tag\" class=\"headerlink\" title=\"2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag\"></a><strong>2. &#x4FEE;&#x6539;&#x955C;&#x50CF;tag</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker tag d63869855c03 kiwenlau/hadoop-slave:0.1.0</div><div class=\"line\">sudo docker tag 7c9d32ede450 kiwenlau/hadoop-master:0.1.0</div><div class=\"line\">sudo docker tag 5571bd5de58e kiwenlau/hadoop-base:0.1.0</div><div class=\"line\">sudo docker tag 09ed89c24ee8 kiwenlau/serf-dnsmasq:0.1.0</div></pre></td></tr></table></figure>\n<p><em>&#x67E5;&#x770B;&#x4FEE;&#x6539;tag&#x540E;&#x955C;&#x50CF;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<table>\n<thead>\n<tr>\n<th>REPOSITORY</th>\n<th>TAG</th>\n<th>IMAGE ID</th>\n<th>CREATED</th>\n<th>VIRTUAL SIZE</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-slave</td>\n<td>0.1.0</td>\n<td>d63869855c03</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-master</td>\n<td>0.1.0</td>\n<td>7c9d32ede450</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/hadoop-base</td>\n<td>0.1.0</td>\n<td>5571bd5de58e</td>\n<td>17 hours ago</td>\n<td>777.4 MB</td>\n</tr>\n<tr>\n<td>kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n<tr>\n<td>index.alauda.cn/kiwenlau/serf-dnsmasq</td>\n<td>0.1.0</td>\n<td>09ed89c24ee8</td>\n<td>17 hours ago</td>\n<td>206.7 MB</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x4FEE;&#x6539;&#x955C;&#x50CF;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x9ED8;&#x8BA4;&#x662F;&#x5C06;&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;Dockerhub, &#x56E0;&#x6B64;Dokerfile&#x4EE5;&#x53CA;shell&#x811A;&#x672C;&#x4E2D;&#x5F97;&#x955C;&#x50CF;&#x540D;&#x79F0;&#x90FD;&#x662F;&#x6CA1;&#x6709;alauada&#x524D;&#x7F00;&#x7684;&#xFF0C;sorry for this&#x2026;.&#x4E0D;&#x8FC7;&#x6539;tag&#x8FD8;&#x662F;&#x5F88;&#x5FEB;&#x6EF4;</li>\n<li>&#x82E5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x5728;DockerHub&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;tag&#x2026;&#x4E0D;&#x8FC7;Alauda&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#x7684;&#x54C8;~</li>\n</ul>\n<h4 id=\"3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"><a href=\"#3-&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\" class=\"headerlink\" title=\"3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;\"></a><strong>3.&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E3A;&#x4E86;&#x9632;&#x6B62;Github&#x88AB;XX, &#x6211;&#x628A;&#x4EE3;&#x7801;&#x5BFC;&#x5165;&#x5230;&#x4E86;&#x5F00;&#x6E90;&#x4E2D;&#x56FD;&#x7684;git&#x4ED3;&#x5E93;</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> http://git.oschina.net/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> hadoop-cluster-docker</div><div class=\"line\">./start-container.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">start master container...</div><div class=\"line\">start slave1 container...</div><div class=\"line\">start slave2 container...</div><div class=\"line\">root@master:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E00;&#x5171;&#x5F00;&#x542F;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;master&#x5BB9;&#x5668;root&#x7528;&#x6237;&#x7684;&#x5BB6;&#x76EE;&#x5F55;&#xFF08;/root&#xFF09;</li>\n</ul>\n<p><em>&#x67E5;&#x770B;master&#x7684;root&#x7528;&#x6237;&#x5BB6;&#x76EE;&#x5F55;&#x7684;&#x6587;&#x4EF6;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ls</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">hdfs  run-wordcount.sh\tserf_log  start-hadoop.sh  start-ssh-serf.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>start-hadoop.sh&#x662F;&#x5F00;&#x542F;hadoop&#x7684;shell&#x811A;&#x672C;</li>\n<li>run-wordcount.sh&#x662F;&#x8FD0;&#x884C;wordcount&#x7684;shell&#x811A;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x6D4B;&#x8BD5;&#x955C;&#x50CF;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;</li>\n</ul>\n<h4 id=\"5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\"><a href=\"#5-&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;-&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)\"></a><strong>5.&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;(&#x6B64;&#x65F6;&#x5DF2;&#x8FDB;&#x5165;master&#x5BB9;&#x5668;)</strong></h4><p><em>&#x67E5;&#x770B;hadoop&#x96C6;&#x7FA4;&#x6210;&#x5458;</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">serf members</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">master.kiwenlau.com  172.17.0.65:7946  alive</div><div class=\"line\">slave1.kiwenlau.com  172.17.0.66:7946  alive</div><div class=\"line\">slave2.kiwenlau.com  172.17.0.67:7946  alive</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;&#x7ED3;&#x679C;&#x7F3A;&#x5C11;&#x8282;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x201C;serf members&#x201D;&#x547D;&#x4EE4;&#x3002;&#x56E0;&#x4E3A;serf agent&#x9700;&#x8981;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#x3002;</li>\n</ul>\n<p><em>&#x6D4B;&#x8BD5;ssh</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">ssh slave2.kiwenlau.com</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Warning: Permanently added <span class=\"string\">&apos;slave2.kiwenlau.com,172.17.0.67&apos;</span> (ECDSA) to the list of known hosts.</div><div class=\"line\">Welcome to Ubuntu 15.04 (GNU/Linux 3.13.0-53-generic x86_64)</div><div class=\"line\">* Documentation:  https://help.ubuntu.com/</div><div class=\"line\">The programs included with the Ubuntu system are free software;</div><div class=\"line\">the exact distribution terms <span class=\"keyword\">for</span> each program are described <span class=\"keyword\">in</span> the</div><div class=\"line\">individual files <span class=\"keyword\">in</span> /usr/share/doc/*/copyright.</div><div class=\"line\">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</div><div class=\"line\">applicable law.</div><div class=\"line\">root@slave2:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<p><em>&#x9000;&#x51FA;slave2</em></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">exit</span></div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">logout</span></div><div class=\"line\">Connection to slave2.kiwenlau.com closed.</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x82E5;ssh&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x7A0D;&#x7B49;&#x7247;&#x523B;&#x518D;&#x6D4B;&#x8BD5;&#xFF0C;&#x56E0;&#x4E3A;dnsmasq&#x7684;dns&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x3002;</li>\n<li>&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x542F;Hadoop&#x96C6;&#x7FA4;&#x4E86;&#xFF01;&#x5176;&#x5B9E;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5F00;&#x542F;&#x5BB9;&#x5668;&#x540E;&#x8010;&#x5FC3;&#x7B49;&#x5F85;&#x4E00;&#x5206;&#x949F;&#x5373;&#x53EF;&#xFF01;</li>\n</ul>\n<h4 id=\"6-&#x5F00;&#x542F;hadoop\"><a href=\"#6-&#x5F00;&#x542F;hadoop\" class=\"headerlink\" title=\"6. &#x5F00;&#x542F;hadoop\"></a><strong>6. &#x5F00;&#x542F;hadoop</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-hadoop.sh</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0A;&#x4E00;&#x6B65;ssh&#x5230;slave2&#x4E4B;&#x540E;&#xFF0C;&#x8BF7;&#x8BB0;&#x5F97;&#x56DE;&#x5230;master&#x554A;!!&#xFF01;</li>\n<li>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x592A;&#x591A;&#xFF0C;&#x5FFD;&#x7565;&#x2026;.</li>\n<li>hadoop&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h4 id=\"7-&#x8FD0;&#x884C;wordcount\"><a href=\"#7-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"7. &#x8FD0;&#x884C;wordcount\"></a><strong>7. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./run-wordcount.sh</div></pre></td></tr></table></figure>\n<p><em>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</em><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">input file1.txt:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\">input file2.txt:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t1</div><div class=\"line\">Hadoop\t1</div><div class=\"line\">Hello\t2</div></pre></td></tr></table></figure></p>\n<ul>\n<li>wordcount&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>\n<h2 id=\"&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x56DB;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x56DB;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"><a href=\"#1-&#x51C6;&#x5907;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;\"></a><strong>1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x4FEE;&#x6539;tag&#xFF0C;&#x4E0B;&#x8F7D;&#x6E90;&#x4EE3;&#x7801;</li>\n<li>&#x6CE8;&#x610F;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x4E0B;&#x8F7D;serf-dnsmasq, &#x4F46;&#x662F;&#x8BF7;&#x6700;&#x597D;&#x4E0B;&#x8F7D;hadoop-base&#xFF0C;&#x56E0;&#x4E3A;hadoop-master&#x662F;&#x57FA;&#x4E8E;hadoop-base&#x6784;&#x5EFA;&#x7684;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;hadoop-master&#x955C;&#x50CF;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-cluster.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0D;&#x8981;&#x62C5;&#x5FC3;&#xFF0C;1&#x5206;&#x949F;&#x5C31;&#x80FD;&#x641E;&#x5B9A;</li>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container.sh 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;resize-cluster.sh&#x811A;&#x672C;&#x8BBE;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x6574;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x6570;1, 2, 3, 4, 5, 6&#x2026;</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5462;&#xFF0C;&#x6700;&#x597D;&#x8FD8;&#x662F;&#x5F97;&#x548C;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x4E00;&#x81F4;:)</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5927;&#xFF0C;&#x4F60;&#x591A;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#xFF0C;Hadoop&#x4E0D;&#x8BA4;&#x8BC6;&#x5B83;&#x4EEC;..</li>\n<li>&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x5982;&#x679C;&#x6BD4;&#x4E0A;&#x4E00;&#x6B65;&#x7684;&#x53C2;&#x6570;&#x5C0F;&#xFF0C;Hadoop&#x89C9;&#x5F97;&#x5C11;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;..</li>\n</ul>\n<h4 id=\"4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"><a href=\"#4-&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;\"></a><strong>4. &#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E09;&#x90E8;&#x5206;5~7&#xFF1A;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x5F00;&#x542F;Hadoop&#xFF0C;&#x8FD0;&#x884C;wordcount</li>\n<li>&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x82E5;&#x8282;&#x70B9;&#x589E;&#x52A0;&#xFF0C;&#x8BF7;&#x52A1;&#x5FC5;&#x5148;&#x6D4B;&#x8BD5;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5F00;&#x542F;Hadoop, &#x56E0;&#x4E3A;serf&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x8282;&#x70B9;&#xFF0C;&#x800C;dnsmasq&#x7684;DNS&#x670D;&#x52A1;&#x5668;&#x8868;&#x793A;&#x8FD8;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x597D;&#x670D;&#x52A1;</li>\n<li>&#x6D4B;&#x8BD5;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x53D6;&#x51B3;&#x4E8E;&#x673A;&#x5668;&#x6027;&#x80FD;&#x2026;.</li>\n</ul>"},{"title":"基于Docker搭建单机版Kuberntes","date":"2015-11-28T01:00:00.000Z","_content":"\n**摘要:** 本文介绍了基于Docker搭建单机版Kuberntes的方法，Kubernetes的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-11-28](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n\n## 一. Kubernetes简介\n\n2006年，Google工程师Rohit Seth发起了Cgroups内核项目。Cgroups是容器实现CPU，内存等资源隔离的基础，由此可见Google其实很早就开始涉足容器技术。而事实上，Google内部使用容器技术已经长达十年，目前谷歌所有业务包括搜索，Gmail，MapReduce等均运行在容器之中。Google内部使用的集群管理系统--Borg，堪称其容器技术的瑞士军刀。\n\n2014年，Google发起了开源容器集群管理系统--Kubernetes，其设计之初就吸取了Borg的经验和教训，并原生支持了Docker。因此，Kubernetees与较早的集群管理系统Mesos和YARN相比，对容器技术尤其是Docker的支持更加原生，同时提供了更强大的机制实现资源调度，负载均衡，高可用等底层功能，使开发者可以专注于开发应用。\n\n与其他集群系统一致，Kubernetes也采用了Master/Slave结构。下表显示了Kubernetes的各个组件及其功能。\n\n| 角色     | 组件               | 功能                                           |\n| ------- |:-----------------: | :--------------------------------------------:|\n| Master  | apiserver          | 提供RESTful接口                                |\n| Master  | scheduler          | 负责调度，将pod分配到Slave节点                   |\n| Master  | controller-manager | 负责Master的其他功能                           |\n| Master  | etde               | 储存配置信息，节点信息，pod信息等                 |\n| Slave   | kubelet            | 负责管理Pod、容器和容器镜像                       |\n| Slave   | proxy              | 将访问Service的请求转发给对应的Pod，做一些负载均衡  |\n| 客户端   | kubectl            | 命令行工具，向apiserver发起创建Pod等请求          |\n\n\n## 二. kiwenlau/kubernetes镜像简介\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。事实上，Kuberenetes未来的开发目标正是将Kubernetes的各个组件运行到容器之中，这样可以方便Kubernetes的部署和升级。现在我将Kubernetes的各个组件全部运行在容器中必然存在很多问题且很多问题是未知的，因此这个项目仅做学习测试而不宜部署到生产环境中。Kubernetes各个组件容器之间的通信通过docker link实现，其中apiserver与ectd的4001端口进行通信，scheduler，controller-manager，kubelet，proxy以及kubectl与apiserver的8080端口进行通信。\n\n<img src=\"151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n集群的大致运行流程是这样的: 用户通过kubectl命令向apiserver发起创建Pod的请求; scheduler将创建Pod的任务分配给kubelet；kubelet中包含了一个docker命令行工具，该工具会向Docker deamon发起创建容器的请求; Docker deamon负责下载镜像然后创建容器。\n\n我将Docker deamon运行在Ubuntu主机上，因此Docker daemon所创建的应用容器与Kubernetes各个组件的容器均运行在Ubuntu主机上。docker socket采用volume的形式挂载到kubelet容器内，因此kubelet中的docker命令行工具可以直接与主机上的Docker daemon进行通信。\n\n我是直接将kubernetes发布的各个组件的二进制可执行文件安装在/usr/local/bin目录下，因此，修改Dockerfile中的Kubernetes下载链接的版本号，就可以快速构建其他版本的Kubernetes镜像。另外，仅需修改网络配置，就可以很方便地在多个节点上部署Kubernetes。\n\nkiwenlau/kubernetes:1.0.7镜像版本信息:\n\n- ubuntu: 14.04\n- Kubernetes: 1.0.7\n- ectd: 2.2.1\n\nUbuntu主机版本信息:\n\n- ubuntu: 14.04.3 LTS\n- kernel: 3.16.0-30-generic\n- docker: 1.9.1\n\n\n\n## 三. 运行步骤\n\n#### **1. 安装Docker**\n\nubuntu 14.04上安装Docker: \n\n```\ncurl -fLsS https://get.docker.com/ | sh\n```\n\n其他系统请参考: [https://docs.docker.com/](https://docs.docker.com/)\n\n#### **2. 下载Docker镜像**\n\n我将kiwenlau/kubernetes:1.07以及其他用到的Docker镜像都放在[灵雀云](http://www.alauda.cn/)\n\n```\nsudo docker pull index.alauda.cn/kiwenlau/kubernetes:1.0.7\nsudo docker pull index.alauda.cn/kiwenlau/etcd:v2.2.1\nsudo docker pull index.alauda.cn/kiwenlau/nginx:1.9.7\nsudo docker pull index.alauda.cn/kiwenlau/pause:0.8.0\n```\n\n#### **3. 启动Kubernetes**\n\n```sh\ngit clone https://github.com/kiwenlau/single-kubernetes-docker\ncd single-kubernetes-docker/\nsudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh\nsudo ./start-kubernetes-alauda.sh\n```\n\n运行结束后进入kubectl容器。容器主机名为kubeclt。可以通过\"exit\"命令退出容器返回到主机，然后可以通过\"sudo docker exec -it kubectl bash\"命令再次进入kubectl容器。\n\n\n#### **4. 测试Kubernetes**\n\n运行测试脚本，该脚本会启动一个nginx pod。\n\n```\nchmod +x test-kubernetes-alauda.sh\n./test-kubernetes-alauda.sh \n```\n\n输出\n\n```\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n```\n\n\n## 四. 参考\n\n1. [meteorhacks/hyperkube](https://github.com/meteorhacks/hyperkube)\n2. [meteorhacks/kube-init](https://github.com/meteorhacks/kube-init)\n3. [Kubernetes: The Future of Cloud Hosting](https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud)\n4. [Kubernetes 架构浅析](http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io)\n5. [An Introduction to Kubernetes](https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes)\n\n","source":"_posts/2015/11/28/151128-single-kubernetes-docker.md","raw":"title: 基于Docker搭建单机版Kuberntes\n\ndate: 2015-11-28 09:00:00\n\ntags: [Docker, Kubernetes]\n\n---\n\n**摘要:** 本文介绍了基于Docker搭建单机版Kuberntes的方法，Kubernetes的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-11-28](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n\n## 一. Kubernetes简介\n\n2006年，Google工程师Rohit Seth发起了Cgroups内核项目。Cgroups是容器实现CPU，内存等资源隔离的基础，由此可见Google其实很早就开始涉足容器技术。而事实上，Google内部使用容器技术已经长达十年，目前谷歌所有业务包括搜索，Gmail，MapReduce等均运行在容器之中。Google内部使用的集群管理系统--Borg，堪称其容器技术的瑞士军刀。\n\n2014年，Google发起了开源容器集群管理系统--Kubernetes，其设计之初就吸取了Borg的经验和教训，并原生支持了Docker。因此，Kubernetees与较早的集群管理系统Mesos和YARN相比，对容器技术尤其是Docker的支持更加原生，同时提供了更强大的机制实现资源调度，负载均衡，高可用等底层功能，使开发者可以专注于开发应用。\n\n与其他集群系统一致，Kubernetes也采用了Master/Slave结构。下表显示了Kubernetes的各个组件及其功能。\n\n| 角色     | 组件               | 功能                                           |\n| ------- |:-----------------: | :--------------------------------------------:|\n| Master  | apiserver          | 提供RESTful接口                                |\n| Master  | scheduler          | 负责调度，将pod分配到Slave节点                   |\n| Master  | controller-manager | 负责Master的其他功能                           |\n| Master  | etde               | 储存配置信息，节点信息，pod信息等                 |\n| Slave   | kubelet            | 负责管理Pod、容器和容器镜像                       |\n| Slave   | proxy              | 将访问Service的请求转发给对应的Pod，做一些负载均衡  |\n| 客户端   | kubectl            | 命令行工具，向apiserver发起创建Pod等请求          |\n\n\n## 二. kiwenlau/kubernetes镜像简介\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。事实上，Kuberenetes未来的开发目标正是将Kubernetes的各个组件运行到容器之中，这样可以方便Kubernetes的部署和升级。现在我将Kubernetes的各个组件全部运行在容器中必然存在很多问题且很多问题是未知的，因此这个项目仅做学习测试而不宜部署到生产环境中。Kubernetes各个组件容器之间的通信通过docker link实现，其中apiserver与ectd的4001端口进行通信，scheduler，controller-manager，kubelet，proxy以及kubectl与apiserver的8080端口进行通信。\n\n<img src=\"151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n集群的大致运行流程是这样的: 用户通过kubectl命令向apiserver发起创建Pod的请求; scheduler将创建Pod的任务分配给kubelet；kubelet中包含了一个docker命令行工具，该工具会向Docker deamon发起创建容器的请求; Docker deamon负责下载镜像然后创建容器。\n\n我将Docker deamon运行在Ubuntu主机上，因此Docker daemon所创建的应用容器与Kubernetes各个组件的容器均运行在Ubuntu主机上。docker socket采用volume的形式挂载到kubelet容器内，因此kubelet中的docker命令行工具可以直接与主机上的Docker daemon进行通信。\n\n我是直接将kubernetes发布的各个组件的二进制可执行文件安装在/usr/local/bin目录下，因此，修改Dockerfile中的Kubernetes下载链接的版本号，就可以快速构建其他版本的Kubernetes镜像。另外，仅需修改网络配置，就可以很方便地在多个节点上部署Kubernetes。\n\nkiwenlau/kubernetes:1.0.7镜像版本信息:\n\n- ubuntu: 14.04\n- Kubernetes: 1.0.7\n- ectd: 2.2.1\n\nUbuntu主机版本信息:\n\n- ubuntu: 14.04.3 LTS\n- kernel: 3.16.0-30-generic\n- docker: 1.9.1\n\n\n\n## 三. 运行步骤\n\n#### **1. 安装Docker**\n\nubuntu 14.04上安装Docker: \n\n```\ncurl -fLsS https://get.docker.com/ | sh\n```\n\n其他系统请参考: [https://docs.docker.com/](https://docs.docker.com/)\n\n#### **2. 下载Docker镜像**\n\n我将kiwenlau/kubernetes:1.07以及其他用到的Docker镜像都放在[灵雀云](http://www.alauda.cn/)\n\n```\nsudo docker pull index.alauda.cn/kiwenlau/kubernetes:1.0.7\nsudo docker pull index.alauda.cn/kiwenlau/etcd:v2.2.1\nsudo docker pull index.alauda.cn/kiwenlau/nginx:1.9.7\nsudo docker pull index.alauda.cn/kiwenlau/pause:0.8.0\n```\n\n#### **3. 启动Kubernetes**\n\n```sh\ngit clone https://github.com/kiwenlau/single-kubernetes-docker\ncd single-kubernetes-docker/\nsudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh\nsudo ./start-kubernetes-alauda.sh\n```\n\n运行结束后进入kubectl容器。容器主机名为kubeclt。可以通过\"exit\"命令退出容器返回到主机，然后可以通过\"sudo docker exec -it kubectl bash\"命令再次进入kubectl容器。\n\n\n#### **4. 测试Kubernetes**\n\n运行测试脚本，该脚本会启动一个nginx pod。\n\n```\nchmod +x test-kubernetes-alauda.sh\n./test-kubernetes-alauda.sh \n```\n\n输出\n\n```\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n```\n\n\n## 四. 参考\n\n1. [meteorhacks/hyperkube](https://github.com/meteorhacks/hyperkube)\n2. [meteorhacks/kube-init](https://github.com/meteorhacks/kube-init)\n3. [Kubernetes: The Future of Cloud Hosting](https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud)\n4. [Kubernetes 架构浅析](http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io)\n5. [An Introduction to Kubernetes](https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes)\n\n","slug":"2015/11/28/151128-single-kubernetes-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywelo0004mkfyohflgdc8","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">2015-11-28</a></li>\n</ul>\n<h2 id=\"&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Kubernetes&#x7B80;&#x4ECB;\"></a>&#x4E00;. Kubernetes&#x7B80;&#x4ECB;</h2><p>2006&#x5E74;&#xFF0C;Google&#x5DE5;&#x7A0B;&#x5E08;Rohit Seth&#x53D1;&#x8D77;&#x4E86;Cgroups&#x5185;&#x6838;&#x9879;&#x76EE;&#x3002;Cgroups&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;CPU&#xFF0C;&#x5185;&#x5B58;&#x7B49;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x89C1;Google&#x5176;&#x5B9E;&#x5F88;&#x65E9;&#x5C31;&#x5F00;&#x59CB;&#x6D89;&#x8DB3;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5DF2;&#x7ECF;&#x957F;&#x8FBE;&#x5341;&#x5E74;&#xFF0C;&#x76EE;&#x524D;&#x8C37;&#x6B4C;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x5305;&#x62EC;&#x641C;&#x7D22;&#xFF0C;Gmail&#xFF0C;MapReduce&#x7B49;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Borg&#xFF0C;&#x582A;&#x79F0;&#x5176;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x745E;&#x58EB;&#x519B;&#x5200;&#x3002;</p>\n<p>2014&#x5E74;&#xFF0C;Google&#x53D1;&#x8D77;&#x4E86;&#x5F00;&#x6E90;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Kubernetes&#xFF0C;&#x5176;&#x8BBE;&#x8BA1;&#x4E4B;&#x521D;&#x5C31;&#x5438;&#x53D6;&#x4E86;Borg&#x7684;&#x7ECF;&#x9A8C;&#x548C;&#x6559;&#x8BAD;&#xFF0C;&#x5E76;&#x539F;&#x751F;&#x652F;&#x6301;&#x4E86;Docker&#x3002;&#x56E0;&#x6B64;&#xFF0C;Kubernetees&#x4E0E;&#x8F83;&#x65E9;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;Mesos&#x548C;YARN&#x76F8;&#x6BD4;&#xFF0C;&#x5BF9;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5C24;&#x5176;&#x662F;Docker&#x7684;&#x652F;&#x6301;&#x66F4;&#x52A0;&#x539F;&#x751F;&#xFF0C;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x9AD8;&#x53EF;&#x7528;&#x7B49;&#x5E95;&#x5C42;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4E13;&#x6CE8;&#x4E8E;&#x5F00;&#x53D1;&#x5E94;&#x7528;&#x3002;</p>\n<p>&#x4E0E;&#x5176;&#x4ED6;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x4E00;&#x81F4;&#xFF0C;Kubernetes&#x4E5F;&#x91C7;&#x7528;&#x4E86;Master/Slave&#x7ED3;&#x6784;&#x3002;&#x4E0B;&#x8868;&#x663E;&#x793A;&#x4E86;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x53CA;&#x5176;&#x529F;&#x80FD;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th>&#x89D2;&#x8272;</th>\n<th style=\"text-align:center\">&#x7EC4;&#x4EF6;</th>\n<th style=\"text-align:center\">&#x529F;&#x80FD;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">apiserver</td>\n<td style=\"text-align:center\">&#x63D0;&#x4F9B;RESTful&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">scheduler</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#xFF0C;&#x5C06;pod&#x5206;&#x914D;&#x5230;Slave&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">controller-manager</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;Master&#x7684;&#x5176;&#x4ED6;&#x529F;&#x80FD;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">etde</td>\n<td style=\"text-align:center\">&#x50A8;&#x5B58;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#xFF0C;pod&#x4FE1;&#x606F;&#x7B49;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">kubelet</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x7BA1;&#x7406;Pod&#x3001;&#x5BB9;&#x5668;&#x548C;&#x5BB9;&#x5668;&#x955C;&#x50CF;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">proxy</td>\n<td style=\"text-align:center\">&#x5C06;&#x8BBF;&#x95EE;Service&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;Pod&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</td>\n</tr>\n<tr>\n<td>&#x5BA2;&#x6237;&#x7AEF;</td>\n<td style=\"text-align:center\">kubectl</td>\n<td style=\"text-align:center\">&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7B49;&#x8BF7;&#x6C42;</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Kuberenetes&#x672A;&#x6765;&#x7684;&#x5F00;&#x53D1;&#x76EE;&#x6807;&#x6B63;&#x662F;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x8FD0;&#x884C;&#x5230;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;Kubernetes&#x7684;&#x90E8;&#x7F72;&#x548C;&#x5347;&#x7EA7;&#x3002;&#x73B0;&#x5728;&#x6211;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5168;&#x90E8;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x5FC5;&#x7136;&#x5B58;&#x5728;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x4E14;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x662F;&#x672A;&#x77E5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x4EC5;&#x505A;&#x5B66;&#x4E60;&#x6D4B;&#x8BD5;&#x800C;&#x4E0D;&#x5B9C;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x3002;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901A;&#x8FC7;docker link&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4E2D;apiserver&#x4E0E;ectd&#x7684;4001&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;scheduler&#xFF0C;controller-manager&#xFF0C;kubelet&#xFF0C;proxy&#x4EE5;&#x53CA;kubectl&#x4E0E;apiserver&#x7684;8080&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><img src=\"/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<p>&#x96C6;&#x7FA4;&#x7684;&#x5927;&#x81F4;&#x8FD0;&#x884C;&#x6D41;&#x7A0B;&#x662F;&#x8FD9;&#x6837;&#x7684;: &#x7528;&#x6237;&#x901A;&#x8FC7;kubectl&#x547D;&#x4EE4;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7684;&#x8BF7;&#x6C42;; scheduler&#x5C06;&#x521B;&#x5EFA;Pod&#x7684;&#x4EFB;&#x52A1;&#x5206;&#x914D;&#x7ED9;kubelet&#xFF1B;kubelet&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x8BE5;&#x5DE5;&#x5177;&#x4F1A;&#x5411;Docker deamon&#x53D1;&#x8D77;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#x8BF7;&#x6C42;; Docker deamon&#x8D1F;&#x8D23;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x6211;&#x5C06;Docker deamon&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Docker daemon&#x6240;&#x521B;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x4E0E;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x5BB9;&#x5668;&#x5747;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x3002;docker socket&#x91C7;&#x7528;volume&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x5230;kubelet&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x56E0;&#x6B64;kubelet&#x4E2D;&#x7684;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0E;&#x4E3B;&#x673A;&#x4E0A;&#x7684;Docker daemon&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x6211;&#x662F;&#x76F4;&#x63A5;&#x5C06;kubernetes&#x53D1;&#x5E03;&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5B89;&#x88C5;&#x5728;/usr/local/bin&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4FEE;&#x6539;Dockerfile&#x4E2D;&#x7684;Kubernetes&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x6784;&#x5EFA;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Kubernetes&#x955C;&#x50CF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5728;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72;Kubernetes&#x3002;</p>\n<p>kiwenlau/kubernetes:1.0.7&#x955C;&#x50CF;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04</li>\n<li>Kubernetes: 1.0.7</li>\n<li>ectd: 2.2.1</li>\n</ul>\n<p>Ubuntu&#x4E3B;&#x673A;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04.3 LTS</li>\n<li>kernel: 3.16.0-30-generic</li>\n<li>docker: 1.9.1</li>\n</ul>\n<h2 id=\"&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"></a>&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x5B89;&#x88C5;Docker\"><a href=\"#1-&#x5B89;&#x88C5;Docker\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;Docker\"></a><strong>1. &#x5B89;&#x88C5;Docker</strong></h4><p>ubuntu 14.04&#x4E0A;&#x5B89;&#x88C5;Docker: </p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -fLsS http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | <span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x8BF7;&#x53C2;&#x8003;: <a href=\"https://docs.docker.com/\" target=\"_blank\" rel=\"external\">https://docs.docker.com/</a></p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>&#x6211;&#x5C06;kiwenlau/kubernetes:1.07&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7528;&#x5230;&#x7684;Docker&#x955C;&#x50CF;&#x90FD;&#x653E;&#x5728;<a href=\"http://www.alauda.cn/\" target=\"_blank\" rel=\"external\">&#x7075;&#x96C0;&#x4E91;</a></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/kubernetes:<span class=\"number\">1.0</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/etcd:v2.<span class=\"number\">2.1</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/nginx:<span class=\"number\">1.9</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/pause:<span class=\"number\">0.8</span>.<span class=\"number\">0</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x542F;&#x52A8;Kubernetes\"><a href=\"#3-&#x542F;&#x52A8;Kubernetes\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Kubernetes\"></a><strong>3. &#x542F;&#x52A8;Kubernetes</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/single-kubernetes-docker</div><div class=\"line\"><span class=\"built_in\">cd</span> single-kubernetes-docker/</div><div class=\"line\">sudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh</div><div class=\"line\">sudo ./start-kubernetes-alauda.sh</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;&#x5BB9;&#x5668;&#x4E3B;&#x673A;&#x540D;&#x4E3A;kubeclt&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;exit&#x201D;&#x547D;&#x4EE4;&#x9000;&#x51FA;&#x5BB9;&#x5668;&#x8FD4;&#x56DE;&#x5230;&#x4E3B;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;sudo docker exec -it kubectl bash&#x201D;&#x547D;&#x4EE4;&#x518D;&#x6B21;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;</p>\n<h4 id=\"4-&#x6D4B;&#x8BD5;Kubernetes\"><a href=\"#4-&#x6D4B;&#x8BD5;Kubernetes\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;Kubernetes\"></a><strong>4. &#x6D4B;&#x8BD5;Kubernetes</strong></h4><p>&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#xFF0C;&#x8BE5;&#x811A;&#x672C;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;nginx pod&#x3002;</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">chmod +x <span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div><div class=\"line\">./<span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"css\"></span></div><div class=\"line\">&#xA0; &#xA0; <span class=\"selector-tag\">body</span> {</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">width</span>: <span class=\"number\">35em</span>;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</div><div class=\"line\">&#xA0; &#xA0; }</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</div><div class=\"line\">working. Further configuration is required.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>For online documentation and support please refer to</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></div><div class=\"line\">Commercial support is available at</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>Thank you for using nginx.<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x53C2;&#x8003;\"><a href=\"#&#x56DB;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x56DB;. &#x53C2;&#x8003;\"></a>&#x56DB;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://github.com/meteorhacks/hyperkube\" target=\"_blank\" rel=\"external\">meteorhacks/hyperkube</a></li>\n<li><a href=\"https://github.com/meteorhacks/kube-init\" target=\"_blank\" rel=\"external\">meteorhacks/kube-init</a></li>\n<li><a href=\"https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud\" target=\"_blank\" rel=\"external\">Kubernetes: The Future of Cloud Hosting</a></li>\n<li><a href=\"http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io\" target=\"_blank\" rel=\"external\">Kubernetes &#x67B6;&#x6784;&#x6D45;&#x6790;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes\" target=\"_blank\" rel=\"external\">An Introduction to Kubernetes</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">2015-11-28</a></li>\n</ul>\n<h2 id=\"&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Kubernetes&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Kubernetes&#x7B80;&#x4ECB;\"></a>&#x4E00;. Kubernetes&#x7B80;&#x4ECB;</h2><p>2006&#x5E74;&#xFF0C;Google&#x5DE5;&#x7A0B;&#x5E08;Rohit Seth&#x53D1;&#x8D77;&#x4E86;Cgroups&#x5185;&#x6838;&#x9879;&#x76EE;&#x3002;Cgroups&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;CPU&#xFF0C;&#x5185;&#x5B58;&#x7B49;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x89C1;Google&#x5176;&#x5B9E;&#x5F88;&#x65E9;&#x5C31;&#x5F00;&#x59CB;&#x6D89;&#x8DB3;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5DF2;&#x7ECF;&#x957F;&#x8FBE;&#x5341;&#x5E74;&#xFF0C;&#x76EE;&#x524D;&#x8C37;&#x6B4C;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x5305;&#x62EC;&#x641C;&#x7D22;&#xFF0C;Gmail&#xFF0C;MapReduce&#x7B49;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;Google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Borg&#xFF0C;&#x582A;&#x79F0;&#x5176;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x745E;&#x58EB;&#x519B;&#x5200;&#x3002;</p>\n<p>2014&#x5E74;&#xFF0C;Google&#x53D1;&#x8D77;&#x4E86;&#x5F00;&#x6E90;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x2013;Kubernetes&#xFF0C;&#x5176;&#x8BBE;&#x8BA1;&#x4E4B;&#x521D;&#x5C31;&#x5438;&#x53D6;&#x4E86;Borg&#x7684;&#x7ECF;&#x9A8C;&#x548C;&#x6559;&#x8BAD;&#xFF0C;&#x5E76;&#x539F;&#x751F;&#x652F;&#x6301;&#x4E86;Docker&#x3002;&#x56E0;&#x6B64;&#xFF0C;Kubernetees&#x4E0E;&#x8F83;&#x65E9;&#x7684;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;Mesos&#x548C;YARN&#x76F8;&#x6BD4;&#xFF0C;&#x5BF9;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x5C24;&#x5176;&#x662F;Docker&#x7684;&#x652F;&#x6301;&#x66F4;&#x52A0;&#x539F;&#x751F;&#xFF0C;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x9AD8;&#x53EF;&#x7528;&#x7B49;&#x5E95;&#x5C42;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4E13;&#x6CE8;&#x4E8E;&#x5F00;&#x53D1;&#x5E94;&#x7528;&#x3002;</p>\n<p>&#x4E0E;&#x5176;&#x4ED6;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x4E00;&#x81F4;&#xFF0C;Kubernetes&#x4E5F;&#x91C7;&#x7528;&#x4E86;Master/Slave&#x7ED3;&#x6784;&#x3002;&#x4E0B;&#x8868;&#x663E;&#x793A;&#x4E86;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x53CA;&#x5176;&#x529F;&#x80FD;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th>&#x89D2;&#x8272;</th>\n<th style=\"text-align:center\">&#x7EC4;&#x4EF6;</th>\n<th style=\"text-align:center\">&#x529F;&#x80FD;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">apiserver</td>\n<td style=\"text-align:center\">&#x63D0;&#x4F9B;RESTful&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">scheduler</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#xFF0C;&#x5C06;pod&#x5206;&#x914D;&#x5230;Slave&#x8282;&#x70B9;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">controller-manager</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;Master&#x7684;&#x5176;&#x4ED6;&#x529F;&#x80FD;</td>\n</tr>\n<tr>\n<td>Master</td>\n<td style=\"text-align:center\">etde</td>\n<td style=\"text-align:center\">&#x50A8;&#x5B58;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#xFF0C;pod&#x4FE1;&#x606F;&#x7B49;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">kubelet</td>\n<td style=\"text-align:center\">&#x8D1F;&#x8D23;&#x7BA1;&#x7406;Pod&#x3001;&#x5BB9;&#x5668;&#x548C;&#x5BB9;&#x5668;&#x955C;&#x50CF;</td>\n</tr>\n<tr>\n<td>Slave</td>\n<td style=\"text-align:center\">proxy</td>\n<td style=\"text-align:center\">&#x5C06;&#x8BBF;&#x95EE;Service&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;Pod&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</td>\n</tr>\n<tr>\n<td>&#x5BA2;&#x6237;&#x7AEF;</td>\n<td style=\"text-align:center\">kubectl</td>\n<td style=\"text-align:center\">&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7B49;&#x8BF7;&#x6C42;</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"><a href=\"#&#x4E8C;-kiwenlau-kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;\"></a>&#x4E8C;. kiwenlau/kubernetes&#x955C;&#x50CF;&#x7B80;&#x4ECB;</h2><p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;Kuberenetes&#x672A;&#x6765;&#x7684;&#x5F00;&#x53D1;&#x76EE;&#x6807;&#x6B63;&#x662F;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x8FD0;&#x884C;&#x5230;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;Kubernetes&#x7684;&#x90E8;&#x7F72;&#x548C;&#x5347;&#x7EA7;&#x3002;&#x73B0;&#x5728;&#x6211;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5168;&#x90E8;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x5FC5;&#x7136;&#x5B58;&#x5728;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x4E14;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x662F;&#x672A;&#x77E5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x4EC5;&#x505A;&#x5B66;&#x4E60;&#x6D4B;&#x8BD5;&#x800C;&#x4E0D;&#x5B9C;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x3002;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901A;&#x8FC7;docker link&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4E2D;apiserver&#x4E0E;ectd&#x7684;4001&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;scheduler&#xFF0C;controller-manager&#xFF0C;kubelet&#xFF0C;proxy&#x4EE5;&#x53CA;kubectl&#x4E0E;apiserver&#x7684;8080&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><img src=\"/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<p>&#x96C6;&#x7FA4;&#x7684;&#x5927;&#x81F4;&#x8FD0;&#x884C;&#x6D41;&#x7A0B;&#x662F;&#x8FD9;&#x6837;&#x7684;: &#x7528;&#x6237;&#x901A;&#x8FC7;kubectl&#x547D;&#x4EE4;&#x5411;apiserver&#x53D1;&#x8D77;&#x521B;&#x5EFA;Pod&#x7684;&#x8BF7;&#x6C42;; scheduler&#x5C06;&#x521B;&#x5EFA;Pod&#x7684;&#x4EFB;&#x52A1;&#x5206;&#x914D;&#x7ED9;kubelet&#xFF1B;kubelet&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x8BE5;&#x5DE5;&#x5177;&#x4F1A;&#x5411;Docker deamon&#x53D1;&#x8D77;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#x8BF7;&#x6C42;; Docker deamon&#x8D1F;&#x8D23;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x6211;&#x5C06;Docker deamon&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Docker daemon&#x6240;&#x521B;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x5BB9;&#x5668;&#x4E0E;Kubernetes&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x5BB9;&#x5668;&#x5747;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x3002;docker socket&#x91C7;&#x7528;volume&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x5230;kubelet&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x56E0;&#x6B64;kubelet&#x4E2D;&#x7684;docker&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0E;&#x4E3B;&#x673A;&#x4E0A;&#x7684;Docker daemon&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p>&#x6211;&#x662F;&#x76F4;&#x63A5;&#x5C06;kubernetes&#x53D1;&#x5E03;&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x5B89;&#x88C5;&#x5728;/usr/local/bin&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4FEE;&#x6539;Dockerfile&#x4E2D;&#x7684;Kubernetes&#x4E0B;&#x8F7D;&#x94FE;&#x63A5;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x6784;&#x5EFA;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Kubernetes&#x955C;&#x50CF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5728;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72;Kubernetes&#x3002;</p>\n<p>kiwenlau/kubernetes:1.0.7&#x955C;&#x50CF;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04</li>\n<li>Kubernetes: 1.0.7</li>\n<li>ectd: 2.2.1</li>\n</ul>\n<p>Ubuntu&#x4E3B;&#x673A;&#x7248;&#x672C;&#x4FE1;&#x606F;:</p>\n<ul>\n<li>ubuntu: 14.04.3 LTS</li>\n<li>kernel: 3.16.0-30-generic</li>\n<li>docker: 1.9.1</li>\n</ul>\n<h2 id=\"&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-&#x8FD0;&#x884C;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;\"></a>&#x4E09;. &#x8FD0;&#x884C;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x5B89;&#x88C5;Docker\"><a href=\"#1-&#x5B89;&#x88C5;Docker\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;Docker\"></a><strong>1. &#x5B89;&#x88C5;Docker</strong></h4><p>ubuntu 14.04&#x4E0A;&#x5B89;&#x88C5;Docker: </p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -fLsS http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | <span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x8BF7;&#x53C2;&#x8003;: <a href=\"https://docs.docker.com/\">https://docs.docker.com/</a></p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>&#x6211;&#x5C06;kiwenlau/kubernetes:1.07&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7528;&#x5230;&#x7684;Docker&#x955C;&#x50CF;&#x90FD;&#x653E;&#x5728;<a href=\"http://www.alauda.cn/\">&#x7075;&#x96C0;&#x4E91;</a></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/kubernetes:<span class=\"number\">1.0</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/etcd:v2.<span class=\"number\">2.1</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/nginx:<span class=\"number\">1.9</span>.<span class=\"number\">7</span></div><div class=\"line\">sudo docker pull index<span class=\"selector-class\">.alauda</span><span class=\"selector-class\">.cn</span>/kiwenlau/pause:<span class=\"number\">0.8</span>.<span class=\"number\">0</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x542F;&#x52A8;Kubernetes\"><a href=\"#3-&#x542F;&#x52A8;Kubernetes\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Kubernetes\"></a><strong>3. &#x542F;&#x52A8;Kubernetes</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/kiwenlau/single-kubernetes-docker</div><div class=\"line\"><span class=\"built_in\">cd</span> single-kubernetes-docker/</div><div class=\"line\">sudo chmod +x start-kubernetes-alauda.sh stop-kubernetes.sh</div><div class=\"line\">sudo ./start-kubernetes-alauda.sh</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;&#x5BB9;&#x5668;&#x4E3B;&#x673A;&#x540D;&#x4E3A;kubeclt&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;exit&#x201D;&#x547D;&#x4EE4;&#x9000;&#x51FA;&#x5BB9;&#x5668;&#x8FD4;&#x56DE;&#x5230;&#x4E3B;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;sudo docker exec -it kubectl bash&#x201D;&#x547D;&#x4EE4;&#x518D;&#x6B21;&#x8FDB;&#x5165;kubectl&#x5BB9;&#x5668;&#x3002;</p>\n<h4 id=\"4-&#x6D4B;&#x8BD5;Kubernetes\"><a href=\"#4-&#x6D4B;&#x8BD5;Kubernetes\" class=\"headerlink\" title=\"4. &#x6D4B;&#x8BD5;Kubernetes\"></a><strong>4. &#x6D4B;&#x8BD5;Kubernetes</strong></h4><p>&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#xFF0C;&#x8BE5;&#x811A;&#x672C;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;nginx pod&#x3002;</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">chmod +x <span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div><div class=\"line\">./<span class=\"keyword\">test</span>-kubernetes-alauda.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"css\"></span></div><div class=\"line\">&#xA0; &#xA0; <span class=\"selector-tag\">body</span> {</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">width</span>: <span class=\"number\">35em</span>;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> auto;</div><div class=\"line\">&#xA0; &#xA0; &#xA0; &#xA0; <span class=\"attribute\">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</div><div class=\"line\">&#xA0; &#xA0; }</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Welcome to nginx!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</div><div class=\"line\">working. Further configuration is required.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>For online documentation and support please refer to</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></div><div class=\"line\">Commercial support is available at</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">em</span>&gt;</span>Thank you for using nginx.<span class=\"tag\">&lt;/<span class=\"name\">em</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x53C2;&#x8003;\"><a href=\"#&#x56DB;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x56DB;. &#x53C2;&#x8003;\"></a>&#x56DB;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://github.com/meteorhacks/hyperkube\">meteorhacks/hyperkube</a></li>\n<li><a href=\"https://github.com/meteorhacks/kube-init\">meteorhacks/kube-init</a></li>\n<li><a href=\"https://meteorhacks.com/learn-kubernetes-the-future-of-the-cloud\">Kubernetes: The Future of Cloud Hosting</a></li>\n<li><a href=\"http://weibo.com/p/1001603912843031387951?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io\">Kubernetes &#x67B6;&#x6784;&#x6D45;&#x6790;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes\">An Introduction to Kubernetes</a></li>\n</ol>"},{"title":"基于Docker搭建Hadoop集群之升级版","date":"2016-06-12T02:00:00.000Z","_content":"\n**摘要:** [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker)是去年参加[Docker巨好玩](http://www.alauda.cn/2015/04/28/docker-great/)比赛开发的，得了[二等奖](http://www.alauda.cn/2015/06/11/presentation/)并赢了一块苹果手表，目前这个项目已经在GitHub上获得了236个Star，DockerHub的镜像下载次数2000+。总之，项目还算很受欢迎吧，这篇博客将介绍项目的升级版。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-12](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)\n\n## 一. 项目介绍\n\n将[Hadoop](http://hadoop.apache.org/)打包到[Docker](https://www.docker.com/)镜像中，就可以快速地在单个机器上搭建Hadoop集群，这样可以方便新手测试和学习。\n\n如下图所示，Hadoop的master和slave分别运行在不同的Docker容器中，其中hadoop-master容器中运行NameNode和ResourceManager，hadoop-slave容器中运行DataNode和NodeManager。NameNode和DataNode是Hadoop分布式文件系统HDFS的组件，负责储存输入以及输出数据，而ResourceManager和NodeManager是Hadoop集群资源管理系统YARN的组件，负责CPU和内存资源的调度。\n\n<img src=\"160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width = \"500\"/>\n\n之前的版本使用serf/dnsmasq为Hadoop集群提供DNS服务，由于Docker网络功能更新，现在并不需要了。更新的版本中，使用以下命令为Hadoop集群创建单独的网络:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n然后在运行Hadoop容器时，使用\"--net=hadoop\"选项，这时所有容器将运行在hadoop网络中，它们可以通过容器名称进行通信。\n\n**项目更新要点：**\n\n- 去除serf/dnsmasq\n- 合并Master和Slave镜像\n- 使用[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)项目编译的Hadoo进行安装\n- 优化Hadoop配置\n\n## 二. 3节点Hadoop集群搭建步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. 下载GitHub仓库**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. 创建Hadoop网络**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. 运行Docker容器**\n\n```\ncd hadoop-cluster-docker\n./start-container.sh\n```\n\n**运行结果**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n\n- 启动了3个容器，1个master, 2个slave\n- 运行后就进入了hadoop-master容器的/root目录\n\n#### **5. 启动hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. 运行wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**运行结果**\n\n```\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\nHadoop网页管理地址:\n\n- NameNode: [http://192.168.59.1:50070/](http://192.168.59.1:50070/)\n- ResourceManager: [http://192.168.59.1:8088/](http://192.168.59.1:8088/)\n\n192.168.59.1为运行容器的主机的IP。\n\n## 三. N节点Hadoop集群搭建步骤\n\n#### **1. 准备**\n\n- 参考第二部分1~3：下载Docker镜像，下载GitHub仓库，以及创建Hadoop网络\n\n#### **2. 重新构建Docker镜像**\n\n```\n./resize-cluster.sh 5\n```\n- 可以指定任意N(N>1)\n\n#### **3. 启动Docker容器**\n\n```\n./start-container.sh 5\n```\n- 与第2步中的N保持一致。\n\n#### **4. 运行Hadoop**\n\n- 参考第二部分5~6：启动Hadoop，并运行wordcount。\n\n## 参考\n\n1. [基于Docker搭建多节点Hadoop集群](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","source":"_posts/2016/06/12/160612-hadoop-cluster-docker-update.md","raw":"title: 基于Docker搭建Hadoop集群之升级版\n\ndate: 2016-06-12 10:00\n\ntags: [Docker, Hadoop]\n\n---\n\n**摘要:** [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker)是去年参加[Docker巨好玩](http://www.alauda.cn/2015/04/28/docker-great/)比赛开发的，得了[二等奖](http://www.alauda.cn/2015/06/11/presentation/)并赢了一块苹果手表，目前这个项目已经在GitHub上获得了236个Star，DockerHub的镜像下载次数2000+。总之，项目还算很受欢迎吧，这篇博客将介绍项目的升级版。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-12](http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/)\n\n## 一. 项目介绍\n\n将[Hadoop](http://hadoop.apache.org/)打包到[Docker](https://www.docker.com/)镜像中，就可以快速地在单个机器上搭建Hadoop集群，这样可以方便新手测试和学习。\n\n如下图所示，Hadoop的master和slave分别运行在不同的Docker容器中，其中hadoop-master容器中运行NameNode和ResourceManager，hadoop-slave容器中运行DataNode和NodeManager。NameNode和DataNode是Hadoop分布式文件系统HDFS的组件，负责储存输入以及输出数据，而ResourceManager和NodeManager是Hadoop集群资源管理系统YARN的组件，负责CPU和内存资源的调度。\n\n<img src=\"160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width = \"500\"/>\n\n之前的版本使用serf/dnsmasq为Hadoop集群提供DNS服务，由于Docker网络功能更新，现在并不需要了。更新的版本中，使用以下命令为Hadoop集群创建单独的网络:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n然后在运行Hadoop容器时，使用\"--net=hadoop\"选项，这时所有容器将运行在hadoop网络中，它们可以通过容器名称进行通信。\n\n**项目更新要点：**\n\n- 去除serf/dnsmasq\n- 合并Master和Slave镜像\n- 使用[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)项目编译的Hadoo进行安装\n- 优化Hadoop配置\n\n## 二. 3节点Hadoop集群搭建步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. 下载GitHub仓库**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. 创建Hadoop网络**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. 运行Docker容器**\n\n```\ncd hadoop-cluster-docker\n./start-container.sh\n```\n\n**运行结果**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n\n- 启动了3个容器，1个master, 2个slave\n- 运行后就进入了hadoop-master容器的/root目录\n\n#### **5. 启动hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. 运行wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**运行结果**\n\n```\ninput file1.txt:\nHello Hadoop\ninput file2.txt:\nHello Docker\nwordcount output:\nDocker\t1\nHadoop\t1\nHello\t2\n```\n\nHadoop网页管理地址:\n\n- NameNode: [http://192.168.59.1:50070/](http://192.168.59.1:50070/)\n- ResourceManager: [http://192.168.59.1:8088/](http://192.168.59.1:8088/)\n\n192.168.59.1为运行容器的主机的IP。\n\n## 三. N节点Hadoop集群搭建步骤\n\n#### **1. 准备**\n\n- 参考第二部分1~3：下载Docker镜像，下载GitHub仓库，以及创建Hadoop网络\n\n#### **2. 重新构建Docker镜像**\n\n```\n./resize-cluster.sh 5\n```\n- 可以指定任意N(N>1)\n\n#### **3. 启动Docker容器**\n\n```\n./start-container.sh 5\n```\n- 与第2步中的N保持一致。\n\n#### **4. 运行Hadoop**\n\n- 参考第二部分5~6：启动Hadoop，并运行wordcount。\n\n## 参考\n\n1. [基于Docker搭建多节点Hadoop集群](http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","slug":"2016/06/12/160612-hadoop-cluster-docker-update","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywelq0006mkfy0ewfxeq4","content":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a>&#x662F;&#x53BB;&#x5E74;&#x53C2;&#x52A0;<a href=\"http://www.alauda.cn/2015/04/28/docker-great/\" target=\"_blank\" rel=\"external\">Docker&#x5DE8;&#x597D;&#x73A9;</a>&#x6BD4;&#x8D5B;&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x5F97;&#x4E86;<a href=\"http://www.alauda.cn/2015/06/11/presentation/\" target=\"_blank\" rel=\"external\">&#x4E8C;&#x7B49;&#x5956;</a>&#x5E76;&#x8D62;&#x4E86;&#x4E00;&#x5757;&#x82F9;&#x679C;&#x624B;&#x8868;&#xFF0C;&#x76EE;&#x524D;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x5DF2;&#x7ECF;&#x5728;GitHub&#x4E0A;&#x83B7;&#x5F97;&#x4E86;236&#x4E2A;Star&#xFF0C;DockerHub&#x7684;&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x6B21;&#x6570;2000+&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x9879;&#x76EE;&#x8FD8;&#x7B97;&#x5F88;&#x53D7;&#x6B22;&#x8FCE;&#x5427;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x9879;&#x76EE;&#x7684;&#x5347;&#x7EA7;&#x7248;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">2016-06-12</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;</h2><p>&#x5C06;<a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a>&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x65B0;&#x624B;&#x6D4B;&#x8BD5;&#x548C;&#x5B66;&#x4E60;&#x3002;</p>\n<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;Hadoop&#x7684;master&#x548C;slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x7684;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5176;&#x4E2D;hadoop-master&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;NameNode&#x548C;ResourceManager&#xFF0C;hadoop-slave&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;DataNode&#x548C;NodeManager&#x3002;NameNode&#x548C;DataNode&#x662F;Hadoop&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;HDFS&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;&#x50A8;&#x5B58;&#x8F93;&#x5165;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x800C;ResourceManager&#x548C;NodeManager&#x662F;Hadoop&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;YARN&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;CPU&#x548C;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;&#x3002;</p>\n<p><img src=\"/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x4F7F;&#x7528;serf/dnsmasq&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;DNS&#x670D;&#x52A1;&#xFF0C;&#x7531;&#x4E8E;Docker&#x7F51;&#x7EDC;&#x529F;&#x80FD;&#x66F4;&#x65B0;&#xFF0C;&#x73B0;&#x5728;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;&#x66F4;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x521B;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x7F51;&#x7EDC;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;Hadoop&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x201D;&#x2013;net=hadoop&#x201D;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x65F6;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x5C06;&#x8FD0;&#x884C;&#x5728;hadoop&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x540D;&#x79F0;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><strong>&#x9879;&#x76EE;&#x66F4;&#x65B0;&#x8981;&#x70B9;&#xFF1A;</strong></p>\n<ul>\n<li>&#x53BB;&#x9664;serf/dnsmasq</li>\n<li>&#x5408;&#x5E76;Master&#x548C;Slave&#x955C;&#x50CF;</li>\n<li>&#x4F7F;&#x7528;<a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a>&#x9879;&#x76EE;&#x7F16;&#x8BD1;&#x7684;Hadoo&#x8FDB;&#x884C;&#x5B89;&#x88C5;</li>\n<li>&#x4F18;&#x5316;Hadoop&#x914D;&#x7F6E;</li>\n</ul>\n<h2 id=\"&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"><a href=\"#3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"></a><strong>3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x542F;&#x52A8;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x8FD0;&#x884C;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;hadoop-master&#x5BB9;&#x5668;&#x7684;/root&#x76EE;&#x5F55;</li>\n</ul>\n<h4 id=\"5-&#x542F;&#x52A8;hadoop\"><a href=\"#5-&#x542F;&#x52A8;hadoop\" class=\"headerlink\" title=\"5. &#x542F;&#x52A8;hadoop\"></a><strong>5. &#x542F;&#x52A8;hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;wordcount\"><a href=\"#6-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;wordcount\"></a><strong>6. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t<span class=\"number\">1</span></div><div class=\"line\">Hadoop\t<span class=\"number\">1</span></div><div class=\"line\">Hello\t<span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<p>Hadoop&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x5730;&#x5740;:</p>\n<ul>\n<li>NameNode: <a href=\"http://192.168.59.1:50070/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:50070/</a></li>\n<li>ResourceManager: <a href=\"http://192.168.59.1:8088/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:8088/</a></li>\n</ul>\n<p>192.168.59.1&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#x3002;</p>\n<h2 id=\"&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;\"><a href=\"#1-&#x51C6;&#x5907;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;\"></a><strong>1. &#x51C6;&#x5907;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;&#xFF0C;&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;&#xFF0C;&#x4EE5;&#x53CA;&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4EFB;&#x610F;N(N&gt;1)</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container<span class=\"selector-class\">.sh</span> <span class=\"number\">5</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0E;&#x7B2C;2&#x6B65;&#x4E2D;&#x7684;N&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<h4 id=\"4-&#x8FD0;&#x884C;Hadoop\"><a href=\"#4-&#x8FD0;&#x884C;Hadoop\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Hadoop\"></a><strong>4. &#x8FD0;&#x884C;Hadoop</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;5~6&#xFF1A;&#x542F;&#x52A8;Hadoop&#xFF0C;&#x5E76;&#x8FD0;&#x884C;wordcount&#x3002;</li>\n</ul>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\" target=\"_blank\" rel=\"external\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">kiwenlau/hadoop-cluster-docker</a>&#x662F;&#x53BB;&#x5E74;&#x53C2;&#x52A0;<a href=\"http://www.alauda.cn/2015/04/28/docker-great/\">Docker&#x5DE8;&#x597D;&#x73A9;</a>&#x6BD4;&#x8D5B;&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x5F97;&#x4E86;<a href=\"http://www.alauda.cn/2015/06/11/presentation/\">&#x4E8C;&#x7B49;&#x5956;</a>&#x5E76;&#x8D62;&#x4E86;&#x4E00;&#x5757;&#x82F9;&#x679C;&#x624B;&#x8868;&#xFF0C;&#x76EE;&#x524D;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x5DF2;&#x7ECF;&#x5728;GitHub&#x4E0A;&#x83B7;&#x5F97;&#x4E86;236&#x4E2A;Star&#xFF0C;DockerHub&#x7684;&#x955C;&#x50CF;&#x4E0B;&#x8F7D;&#x6B21;&#x6570;2000+&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x9879;&#x76EE;&#x8FD8;&#x7B97;&#x5F88;&#x53D7;&#x6B22;&#x8FCE;&#x5427;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x9879;&#x76EE;&#x7684;&#x5347;&#x7EA7;&#x7248;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/\">2016-06-12</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E00;-&#x9879;&#x76EE;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;\"></a>&#x4E00;. &#x9879;&#x76EE;&#x4ECB;&#x7ECD;</h2><p>&#x5C06;<a href=\"http://hadoop.apache.org/\">Hadoop</a>&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x642D;&#x5EFA;Hadoop&#x96C6;&#x7FA4;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x65B0;&#x624B;&#x6D4B;&#x8BD5;&#x548C;&#x5B66;&#x4E60;&#x3002;</p>\n<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;Hadoop&#x7684;master&#x548C;slave&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x4E0D;&#x540C;&#x7684;Docker&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5176;&#x4E2D;hadoop-master&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;NameNode&#x548C;ResourceManager&#xFF0C;hadoop-slave&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;DataNode&#x548C;NodeManager&#x3002;NameNode&#x548C;DataNode&#x662F;Hadoop&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;HDFS&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;&#x50A8;&#x5B58;&#x8F93;&#x5165;&#x4EE5;&#x53CA;&#x8F93;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x800C;ResourceManager&#x548C;NodeManager&#x662F;Hadoop&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;YARN&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x8D1F;&#x8D23;CPU&#x548C;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;&#x3002;</p>\n<p><img src=\"/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x4F7F;&#x7528;serf/dnsmasq&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x63D0;&#x4F9B;DNS&#x670D;&#x52A1;&#xFF0C;&#x7531;&#x4E8E;Docker&#x7F51;&#x7EDC;&#x529F;&#x80FD;&#x66F4;&#x65B0;&#xFF0C;&#x73B0;&#x5728;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;&#x66F4;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E3A;Hadoop&#x96C6;&#x7FA4;&#x521B;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x7F51;&#x7EDC;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;Hadoop&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x201D;&#x2013;net=hadoop&#x201D;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x65F6;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x5C06;&#x8FD0;&#x884C;&#x5728;hadoop&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x540D;&#x79F0;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<p><strong>&#x9879;&#x76EE;&#x66F4;&#x65B0;&#x8981;&#x70B9;&#xFF1A;</strong></p>\n<ul>\n<li>&#x53BB;&#x9664;serf/dnsmasq</li>\n<li>&#x5408;&#x5E76;Master&#x548C;Slave&#x955C;&#x50CF;</li>\n<li>&#x4F7F;&#x7528;<a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a>&#x9879;&#x76EE;&#x7F16;&#x8BD1;&#x7684;Hadoo&#x8FDB;&#x884C;&#x5B89;&#x88C5;</li>\n<li>&#x4F18;&#x5316;Hadoop&#x914D;&#x7F6E;</li>\n</ul>\n<h2 id=\"&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. 3&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#2-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>2. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"><a href=\"#3-&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;\"></a><strong>3. &#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#4-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"></a><strong>4. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x542F;&#x52A8;&#x4E86;3&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;1&#x4E2A;master, 2&#x4E2A;slave</li>\n<li>&#x8FD0;&#x884C;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x4E86;hadoop-master&#x5BB9;&#x5668;&#x7684;/root&#x76EE;&#x5F55;</li>\n</ul>\n<h4 id=\"5-&#x542F;&#x52A8;hadoop\"><a href=\"#5-&#x542F;&#x52A8;hadoop\" class=\"headerlink\" title=\"5. &#x542F;&#x52A8;hadoop\"></a><strong>5. &#x542F;&#x52A8;hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;wordcount\"><a href=\"#6-&#x8FD0;&#x884C;wordcount\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;wordcount\"></a><strong>6. &#x8FD0;&#x884C;wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker\t<span class=\"number\">1</span></div><div class=\"line\">Hadoop\t<span class=\"number\">1</span></div><div class=\"line\">Hello\t<span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<p>Hadoop&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x5730;&#x5740;:</p>\n<ul>\n<li>NameNode: <a href=\"http://192.168.59.1:50070/\">http://192.168.59.1:50070/</a></li>\n<li>ResourceManager: <a href=\"http://192.168.59.1:8088/\">http://192.168.59.1:8088/</a></li>\n</ul>\n<p>192.168.59.1&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#x3002;</p>\n<h2 id=\"&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E09;-N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E09;. N&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;&#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x51C6;&#x5907;\"><a href=\"#1-&#x51C6;&#x5907;\" class=\"headerlink\" title=\"1. &#x51C6;&#x5907;\"></a><strong>1. &#x51C6;&#x5907;</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;1~3&#xFF1A;&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;&#xFF0C;&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;&#xFF0C;&#x4EE5;&#x53CA;&#x521B;&#x5EFA;Hadoop&#x7F51;&#x7EDC;</li>\n</ul>\n<h4 id=\"2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"><a href=\"#2-&#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"></a><strong>2. &#x91CD;&#x65B0;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4EFB;&#x610F;N(N&gt;1)</li>\n</ul>\n<h4 id=\"3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"><a href=\"#3-&#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;\"></a><strong>3. &#x542F;&#x52A8;Docker&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">./start-container<span class=\"selector-class\">.sh</span> <span class=\"number\">5</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x4E0E;&#x7B2C;2&#x6B65;&#x4E2D;&#x7684;N&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<h4 id=\"4-&#x8FD0;&#x884C;Hadoop\"><a href=\"#4-&#x8FD0;&#x884C;Hadoop\" class=\"headerlink\" title=\"4. &#x8FD0;&#x884C;Hadoop\"></a><strong>4. &#x8FD0;&#x884C;Hadoop</strong></h4><ul>\n<li>&#x53C2;&#x8003;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;5~6&#xFF1A;&#x542F;&#x52A8;Hadoop&#xFF0C;&#x5E76;&#x8FD0;&#x884C;wordcount&#x3002;</li>\n</ul>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://kiwenlau.com/2015/06/08/150608-hadoop-cluster-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Hadoop&#x96C6;&#x7FA4;</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>"},{"title":"基于Docker编译Hadoop","date":"2016-06-05T02:00:00.000Z","_content":"\n**摘要:** 将编译Hadoop所需要的依赖软件安装到Docker镜像中，然后在Docker容器中编译Hadoop，可以提高编译效率，同时避免污染主机。编译其他软件时，也可以参考这篇博客的方法。\n\n**GitHub地址:**\n- [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-05](http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/)\n\n<img src=\"160605-compile-hadoop-docker/hadoop-docker.png\" width = \"300\"/>\n\n在前一篇博客中，我介绍了[64位Ubuntu中编译Hadoop的步骤](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)。这篇博客将介绍基于Docker编译Hadoop的方法。\n\n## 一. 编译步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/compile-hadoop\n```\n\n或者自行构建Docker镜像\n\n```\nsudo docker build -t kiwenlau/compile-hadoop .\n```\n\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nexport VERSION=2.7.2\nwget http://archive.apache.org/dist/hadoop/core/hadoop-$VERSION/hadoop-$VERSION-src.tar.gz\ntar -xzvf hadoop-$VERSION-src.tar.gz\n```\n\n#### **3. 运行Docker容器，在容器中编译Hadoop**\n\n```\nsudo docker run -v $(pwd)/hadoop-$VERSION-src:/hadoop-$VERSION-src kiwenlau/compile-hadoop /root/compile.sh $VERSION\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 23:46.056s\n[INFO] Finished at: Tue May 31 16:40:53 UTC 2016\n[INFO] Final Memory: 210M/915M\n[INFO] ------------------------------------------------------------------------\n\n\ncomile hadoop 2.7.2 success!\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.7.2-src/hadoop-dist/target/hadoop-2.7.2.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，仅需改变VERSION的值。\n\n可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/$VERSION/hadoop-VERSION.tar.gz\n```\n\n## 二. 方法总结\n\n编译其他软件时，也可以参考本文介绍的方法，具体细节可以参考源码[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n#### **1. 构建编译所需的Docker镜像**\n\n编译软件往往需要安装很多依赖，而编译不同的软件有时需要不同版本的依赖，如果直接在主机上安装这些依赖会污染主机，而且也不易重复。\n\n#### **2. 下载软件源码**\n\n源码不放在Docker镜像里面，可以方便编译不同版本的软件，也可以提高构建Docker镜像的效率。\n\n#### **3. 运行Docker容器编译软件**\n\n软件源码以数据卷(volume)的形式挂载的容器内，编译所得的可执行文件也将位于数据卷内。\n\n","source":"_posts/2016/06/05/160605-compile-hadoop-docker.md","raw":"title: 基于Docker编译Hadoop\n\ndate: 2016-06-05 10:00\n\ntags: [Docker, Hadoop]\n\n---\n\n**摘要:** 将编译Hadoop所需要的依赖软件安装到Docker镜像中，然后在Docker容器中编译Hadoop，可以提高编译效率，同时避免污染主机。编译其他软件时，也可以参考这篇博客的方法。\n\n**GitHub地址:**\n- [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-05](http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/)\n\n<img src=\"160605-compile-hadoop-docker/hadoop-docker.png\" width = \"300\"/>\n\n在前一篇博客中，我介绍了[64位Ubuntu中编译Hadoop的步骤](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)。这篇博客将介绍基于Docker编译Hadoop的方法。\n\n## 一. 编译步骤\n\n#### **1. 下载Docker镜像**\n\n```\nsudo docker pull kiwenlau/compile-hadoop\n```\n\n或者自行构建Docker镜像\n\n```\nsudo docker build -t kiwenlau/compile-hadoop .\n```\n\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nexport VERSION=2.7.2\nwget http://archive.apache.org/dist/hadoop/core/hadoop-$VERSION/hadoop-$VERSION-src.tar.gz\ntar -xzvf hadoop-$VERSION-src.tar.gz\n```\n\n#### **3. 运行Docker容器，在容器中编译Hadoop**\n\n```\nsudo docker run -v $(pwd)/hadoop-$VERSION-src:/hadoop-$VERSION-src kiwenlau/compile-hadoop /root/compile.sh $VERSION\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 23:46.056s\n[INFO] Finished at: Tue May 31 16:40:53 UTC 2016\n[INFO] Final Memory: 210M/915M\n[INFO] ------------------------------------------------------------------------\n\n\ncomile hadoop 2.7.2 success!\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.7.2-src/hadoop-dist/target/hadoop-2.7.2.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，仅需改变VERSION的值。\n\n可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/$VERSION/hadoop-VERSION.tar.gz\n```\n\n## 二. 方法总结\n\n编译其他软件时，也可以参考本文介绍的方法，具体细节可以参考源码[kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n\n#### **1. 构建编译所需的Docker镜像**\n\n编译软件往往需要安装很多依赖，而编译不同的软件有时需要不同版本的依赖，如果直接在主机上安装这些依赖会污染主机，而且也不易重复。\n\n#### **2. 下载软件源码**\n\n源码不放在Docker镜像里面，可以方便编译不同版本的软件，也可以提高构建Docker镜像的效率。\n\n#### **3. 运行Docker容器编译软件**\n\n软件源码以数据卷(volume)的形式挂载的容器内，编译所得的可执行文件也将位于数据卷内。\n\n","slug":"2016/06/05/160605-compile-hadoop-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywelr0007mkfyitkebrj0","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x7F16;&#x8BD1;Hadoop&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x7F16;&#x8BD1;&#x6548;&#x7387;&#xFF0C;&#x540C;&#x65F6;&#x907F;&#x514D;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#x3002;&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/\">2016-06-05</a></li>\n</ul>\n<p><img src=\"/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png\" width=\"300\"></p>\n<p>&#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">64&#x4F4D;Ubuntu&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;</a>&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x57FA;&#x4E8E;Docker&#x7F16;&#x8BD1;Hadoop&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"></a>&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"keyword\">compile</span>-hadoop</div></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x81EA;&#x884C;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">sudo</span> docker <span class=\"keyword\">build </span>-t kiwenlau/compile-hadoop .</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\" target=\"_blank\" rel=\"external\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight elixir\"><table><tr><td class=\"code\"><pre><div class=\"line\">export VERSION=<span class=\"number\">2.7</span>.<span class=\"number\">2</span></div><div class=\"line\">wget <span class=\"symbol\">http:</span>/<span class=\"regexp\">/archive.apache.org/dist</span><span class=\"regexp\">/hadoop/core</span><span class=\"regexp\">/hadoop-$VERSION/hadoop</span>-<span class=\"variable\">$VERSION</span>-src.tar.gz</div><div class=\"line\">tar -xzvf hadoop-<span class=\"variable\">$VERSION</span>-src.tar.gz</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> -v $(<span class=\"built_in\">pwd</span>)/hadoop-<span class=\"variable\">$VERSION</span>-src:/hadoop-<span class=\"variable\">$VERSION</span>-src kiwenlau/compile-hadoop /root/compile.sh <span class=\"variable\">$VERSION</span></span></div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">23</span><span class=\"selector-pseudo\">:46.056s</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Tue</span> <span class=\"selector-tag\">May</span> <span class=\"selector-tag\">31</span> <span class=\"selector-tag\">16</span><span class=\"selector-pseudo\">:40</span><span class=\"selector-pseudo\">:53</span> <span class=\"selector-tag\">UTC</span> <span class=\"selector-tag\">2016</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">210M</span>/<span class=\"selector-tag\">915M</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">comile</span> <span class=\"selector-tag\">hadoop</span> <span class=\"selector-tag\">2</span><span class=\"selector-class\">.7</span><span class=\"selector-class\">.2</span> <span class=\"selector-tag\">success</span>!</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4EC5;&#x9700;&#x6539;&#x53D8;VERSION&#x7684;&#x503C;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/$VERSION/</span>hadoop-VERSION.tar.gz</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"><a href=\"#&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"></a>&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;</h2><p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6E90;&#x7801;<a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a></p>\n<h4 id=\"1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;</strong></h4><p>&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x5F88;&#x591A;&#x4F9D;&#x8D56;&#xFF0C;&#x800C;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7684;&#x8F6F;&#x4EF6;&#x6709;&#x65F6;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x8FD9;&#x4E9B;&#x4F9D;&#x8D56;&#x4F1A;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x6613;&#x91CD;&#x590D;&#x3002;</p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;</strong></h4><p>&#x6E90;&#x7801;&#x4E0D;&#x653E;&#x5728;Docker&#x955C;&#x50CF;&#x91CC;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;</strong></h4><p>&#x8F6F;&#x4EF6;&#x6E90;&#x7801;&#x4EE5;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x7684;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x6240;&#x5F97;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E5F;&#x5C06;&#x4F4D;&#x4E8E;&#x6570;&#x636E;&#x5377;&#x5185;&#x3002;</p>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x7F16;&#x8BD1;Hadoop&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x7F16;&#x8BD1;&#x6548;&#x7387;&#xFF0C;&#x540C;&#x65F6;&#x907F;&#x514D;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#x3002;&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/05/160605-compile-hadoop-docker/\">2016-06-05</a></li>\n</ul>\n<p><img src=\"/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png\" width=\"300\"></p>\n<p>&#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">64&#x4F4D;Ubuntu&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;</a>&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x57FA;&#x4E8E;Docker&#x7F16;&#x8BD1;Hadoop&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E00;-&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;\"></a>&#x4E00;. &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"keyword\">compile</span>-hadoop</div></pre></td></tr></table></figure>\n<p>&#x6216;&#x8005;&#x81EA;&#x884C;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">sudo</span> docker <span class=\"keyword\">build </span>-t kiwenlau/compile-hadoop .</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight elixir\"><table><tr><td class=\"code\"><pre><div class=\"line\">export VERSION=<span class=\"number\">2.7</span>.<span class=\"number\">2</span></div><div class=\"line\">wget <span class=\"symbol\">http:</span>/<span class=\"regexp\">/archive.apache.org/dist</span><span class=\"regexp\">/hadoop/core</span><span class=\"regexp\">/hadoop-$VERSION/hadoop</span>-<span class=\"variable\">$VERSION</span>-src.tar.gz</div><div class=\"line\">tar -xzvf hadoop-<span class=\"variable\">$VERSION</span>-src.tar.gz</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> -v $(<span class=\"built_in\">pwd</span>)/hadoop-<span class=\"variable\">$VERSION</span>-src:/hadoop-<span class=\"variable\">$VERSION</span>-src kiwenlau/compile-hadoop /root/compile.sh <span class=\"variable\">$VERSION</span></span></div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">23</span><span class=\"selector-pseudo\">:46.056s</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Tue</span> <span class=\"selector-tag\">May</span> <span class=\"selector-tag\">31</span> <span class=\"selector-tag\">16</span><span class=\"selector-pseudo\">:40</span><span class=\"selector-pseudo\">:53</span> <span class=\"selector-tag\">UTC</span> <span class=\"selector-tag\">2016</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">210M</span>/<span class=\"selector-tag\">915M</span></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">comile</span> <span class=\"selector-tag\">hadoop</span> <span class=\"selector-tag\">2</span><span class=\"selector-class\">.7</span><span class=\"selector-class\">.2</span> <span class=\"selector-tag\">success</span>!</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.7</span><span class=\"number\">.2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4EC5;&#x9700;&#x6539;&#x53D8;VERSION&#x7684;&#x503C;&#x3002;</p>\n<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/$VERSION/</span>hadoop-VERSION.tar.gz</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"><a href=\"#&#x4E8C;-&#x65B9;&#x6CD5;&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;\"></a>&#x4E8C;. &#x65B9;&#x6CD5;&#x603B;&#x7ED3;</h2><p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6E90;&#x7801;<a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a></p>\n<h4 id=\"1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;\"></a><strong>1. &#x6784;&#x5EFA;&#x7F16;&#x8BD1;&#x6240;&#x9700;&#x7684;Docker&#x955C;&#x50CF;</strong></h4><p>&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;&#x5F80;&#x5F80;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x5F88;&#x591A;&#x4F9D;&#x8D56;&#xFF0C;&#x800C;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7684;&#x8F6F;&#x4EF6;&#x6709;&#x65F6;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x8FD9;&#x4E9B;&#x4F9D;&#x8D56;&#x4F1A;&#x6C61;&#x67D3;&#x4E3B;&#x673A;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x6613;&#x91CD;&#x590D;&#x3002;</p>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x8F6F;&#x4EF6;&#x6E90;&#x7801;</strong></h4><p>&#x6E90;&#x7801;&#x4E0D;&#x653E;&#x5728;Docker&#x955C;&#x50CF;&#x91CC;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7F16;&#x8BD1;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<h4 id=\"3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7F16;&#x8BD1;&#x8F6F;&#x4EF6;</strong></h4><p>&#x8F6F;&#x4EF6;&#x6E90;&#x7801;&#x4EE5;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x7684;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x6240;&#x5F97;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E5F;&#x5C06;&#x4F4D;&#x4E8E;&#x6570;&#x636E;&#x5377;&#x5185;&#x3002;</p>"},{"title":"使用Vagrant快速创建虚拟机","date":"2016-06-19T02:00:00.000Z","_content":"\n**摘要:** 手动创建虚拟机非常不方便，重装起来也很麻烦，打包成镜像的话则不易修改，很难进行版本控制，也无法移植到云端。[Vagrant](https://www.vagrantup.com/)可以将创建虚拟机的过程代码化，有效地解决了以上所提的痛点。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-19](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n<img src=\"160619-vagrant-virtual-machine/vagrant-vm.png\" width = \"300\"/>\n\n## 一. 快速入门\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 创建虚拟机**\n\n```\nmkdir vagrant-ubuntu\ncd vagrant-ubuntu\nvagrant box add ubuntu/trusty64\nvagrant init ubuntu/trusty64\nvagrant up --provider virtualbox\nvagrant ssh\n```\n\n- **vagrant box add:** 下载创建虚拟机所依赖的**box**\n- **vagrant init:** 生成创建虚拟机的所依赖的**Vagrantfile**\n- **vagrant up:** 创建虚拟机\n- **vagrant ssh:** SSH登陆虚拟机\n\n不妨查看一下Vagrant自动生成的**Vagrantfile**, 我删除了所有注释：\n\n```\nVagrant.configure(2) do |config|\n   config.vm.box = \"ubuntu/trusty64\"\nend\n```\n**Vagrantfile**的内容非常简单，仅定义虚拟机所依赖的**Box**为**ubuntu/trusty64**。**Box**相当于虚拟机所依赖的镜像文件。因此，这里创建的虚拟机是ubuntu trusty(14.04)。如果你需要创建其他Linux发行版例如Debian或者CentOS，可以在[这里](https://atlas.hashicorp.com/boxes/search)搜索对应的**Box**.\n\nVagrant虚拟机的默认配置:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 主机上的vagrant-ubuntu目录与虚拟机内的/vagrant目录内容实时同步\n- 内存：512MB\n- CPU: 1\n\n默认配置并不一定满足开发需求，下一小节将介绍如何进行自定义配置。\n\n\n## 二. 自定义配置\n\n#### **1. 修改Vagrantfile**\n\n```\nvim Vagrantfile\n```\n\n可以通过注释理解每个自定义配置的含义。\n\n```\nVagrant.configure(2) do |config|\n\n  # 设置虚拟机的Box\n  config.vm.box = \"ubuntu/trusty64\"\n  \n  # 设置虚拟机的主机名\n  config.vm.hostname=\"ubuntu\"\n  \n  # 设置虚拟机的IP\n  config.vm.network \"private_network\", ip: \"192.168.0.2\"\n  \n  # 设置主机与虚拟机的共享目录\n  config.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n  # VirtaulBox相关配置\n  config.vm.provider \"virtualbox\" do |v|\n\n      # 设置虚拟机的名称\n      v.name = \"ubuntu\"\n\n      # 设置虚拟机的内存大小\n      v.memory = 2048\n\n      # 设置虚拟机的CPU个数\n      v.cpus = 1\n  end\n  \n  # 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n\nend\n```\n\n#### **2. 在桌面上创建share目录**\n\n主机上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **3. 创建虚拟机**\n\n```\nvagrant destroy\nvagrant up --provider virtualbox\n```\n\n#### **4. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.0.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH无密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@127.0.0.1 -p 2222 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n其中，2222是主机SSH登陆虚拟机的转发端口，可以通过以下命令查看:\n\n```\nvagrant ssh-config | grep Port\n  Port 2222\n```\n\n此时SSH登陆虚拟机则不再需要输入密码。\n\n#### **5. 关于Provision**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provider virtualbox --provision\n```\n\n其实，Vagrant支持创建[Docker Provision](https://www.vagrantup.com/docs/provisioning/docker.html)，可以用于创建Docker主机，功能很多，但是用起来不如使用Shell脚本灵活。\n\n## 三. Vagrant与Docker比较\n\n[Vagrant](https://www.vagrantup.com/)与[Docker](https://www.docker.com/)都可以用于快速创建开发环境，但是，Vagrant是用于创建虚拟机的，而Docker是用于创建容器的，所以两者的功能并不相同。实际工作中，我两个都用，Vagrant仅用于创建虚拟机作为容器运行环境，而Docker用于开发和运行实际应用。这样实现了开发环境两层隔离，MacBook不需要安装多余的软件，Vagrant所创建的虚拟机也仅需要安装Docker等少数软件，这样更加方便和安全。\n\nVagrant是基于Vagrantfile创建虚拟机，而Docker是基于Dockerfile创建容器镜像。两者都是将应用的运行环境代码化，所以非常灵活，易于重复，也可以作版本控制。但是，Vagrantfile的语法其实非常简陋，远没有Dockerfile灵活。因此，Vagrant仅适合于创建开发环境，或者作为容器运行的环境，并不适合打包应用。\n\nVagrant的功能与[Docker Machine](https://docs.docker.com/machine/)功能一致，都是用于创建虚拟机。但是，Docker Machine是专用于创建Docker主机的，而Vagrant可以用于创建不同的开发环境。理论上Docker用户使用Docker Machine会更方便，但是我并没有选择Docker Machine，因为感觉并没有实际需求。Docker Machine所创建的本地虚拟机默认基于Docker专用的Linux发行版[boot2docker](https://github.com/boot2docker/boot2docker)，云端虚拟机默认基于ubuntu，对其他Linux发行版的支持还处于实验阶段。而Vagrant稳定支持更多Linux发行版，所以可以满足更多需求。Vagrant可以通过Vagrantfile进行自定义配置，而Docker Machine并没有对应功能，因此Vagrant用于创建虚拟机更加灵活。\n\n","source":"_posts/2016/06/19/160619-vagrant-virtual-machine.md","raw":"title: 使用Vagrant快速创建虚拟机\n\ndate: 2016-06-19 10:00\n\ntags: [Vagrant]\n\n---\n\n**摘要:** 手动创建虚拟机非常不方便，重装起来也很麻烦，打包成镜像的话则不易修改，很难进行版本控制，也无法移植到云端。[Vagrant](https://www.vagrantup.com/)可以将创建虚拟机的过程代码化，有效地解决了以上所提的痛点。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-06-19](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n<img src=\"160619-vagrant-virtual-machine/vagrant-vm.png\" width = \"300\"/>\n\n## 一. 快速入门\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 创建虚拟机**\n\n```\nmkdir vagrant-ubuntu\ncd vagrant-ubuntu\nvagrant box add ubuntu/trusty64\nvagrant init ubuntu/trusty64\nvagrant up --provider virtualbox\nvagrant ssh\n```\n\n- **vagrant box add:** 下载创建虚拟机所依赖的**box**\n- **vagrant init:** 生成创建虚拟机的所依赖的**Vagrantfile**\n- **vagrant up:** 创建虚拟机\n- **vagrant ssh:** SSH登陆虚拟机\n\n不妨查看一下Vagrant自动生成的**Vagrantfile**, 我删除了所有注释：\n\n```\nVagrant.configure(2) do |config|\n   config.vm.box = \"ubuntu/trusty64\"\nend\n```\n**Vagrantfile**的内容非常简单，仅定义虚拟机所依赖的**Box**为**ubuntu/trusty64**。**Box**相当于虚拟机所依赖的镜像文件。因此，这里创建的虚拟机是ubuntu trusty(14.04)。如果你需要创建其他Linux发行版例如Debian或者CentOS，可以在[这里](https://atlas.hashicorp.com/boxes/search)搜索对应的**Box**.\n\nVagrant虚拟机的默认配置:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 主机上的vagrant-ubuntu目录与虚拟机内的/vagrant目录内容实时同步\n- 内存：512MB\n- CPU: 1\n\n默认配置并不一定满足开发需求，下一小节将介绍如何进行自定义配置。\n\n\n## 二. 自定义配置\n\n#### **1. 修改Vagrantfile**\n\n```\nvim Vagrantfile\n```\n\n可以通过注释理解每个自定义配置的含义。\n\n```\nVagrant.configure(2) do |config|\n\n  # 设置虚拟机的Box\n  config.vm.box = \"ubuntu/trusty64\"\n  \n  # 设置虚拟机的主机名\n  config.vm.hostname=\"ubuntu\"\n  \n  # 设置虚拟机的IP\n  config.vm.network \"private_network\", ip: \"192.168.0.2\"\n  \n  # 设置主机与虚拟机的共享目录\n  config.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n  # VirtaulBox相关配置\n  config.vm.provider \"virtualbox\" do |v|\n\n      # 设置虚拟机的名称\n      v.name = \"ubuntu\"\n\n      # 设置虚拟机的内存大小\n      v.memory = 2048\n\n      # 设置虚拟机的CPU个数\n      v.cpus = 1\n  end\n  \n  # 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n\nend\n```\n\n#### **2. 在桌面上创建share目录**\n\n主机上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **3. 创建虚拟机**\n\n```\nvagrant destroy\nvagrant up --provider virtualbox\n```\n\n#### **4. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.0.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH无密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@127.0.0.1 -p 2222 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n其中，2222是主机SSH登陆虚拟机的转发端口，可以通过以下命令查看:\n\n```\nvagrant ssh-config | grep Port\n  Port 2222\n```\n\n此时SSH登陆虚拟机则不再需要输入密码。\n\n#### **5. 关于Provision**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\n  config.vm.provision \"shell\", inline: <<-SHELL\n\n     # 安装Docker 1.11.0\n     apt-get update\n     apt-get install apt-transport-https ca-certificates\n     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n     echo deb https://apt.dockerproject.org/repo ubuntu-trusty main > /etc/apt/sources.list.d/docker.list\n     apt-get update;\n     apt-get install -y -q docker-engine=1.11.0-0~trusty\n     usermod -aG docker vagrant\n\n  SHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provider virtualbox --provision\n```\n\n其实，Vagrant支持创建[Docker Provision](https://www.vagrantup.com/docs/provisioning/docker.html)，可以用于创建Docker主机，功能很多，但是用起来不如使用Shell脚本灵活。\n\n## 三. Vagrant与Docker比较\n\n[Vagrant](https://www.vagrantup.com/)与[Docker](https://www.docker.com/)都可以用于快速创建开发环境，但是，Vagrant是用于创建虚拟机的，而Docker是用于创建容器的，所以两者的功能并不相同。实际工作中，我两个都用，Vagrant仅用于创建虚拟机作为容器运行环境，而Docker用于开发和运行实际应用。这样实现了开发环境两层隔离，MacBook不需要安装多余的软件，Vagrant所创建的虚拟机也仅需要安装Docker等少数软件，这样更加方便和安全。\n\nVagrant是基于Vagrantfile创建虚拟机，而Docker是基于Dockerfile创建容器镜像。两者都是将应用的运行环境代码化，所以非常灵活，易于重复，也可以作版本控制。但是，Vagrantfile的语法其实非常简陋，远没有Dockerfile灵活。因此，Vagrant仅适合于创建开发环境，或者作为容器运行的环境，并不适合打包应用。\n\nVagrant的功能与[Docker Machine](https://docs.docker.com/machine/)功能一致，都是用于创建虚拟机。但是，Docker Machine是专用于创建Docker主机的，而Vagrant可以用于创建不同的开发环境。理论上Docker用户使用Docker Machine会更方便，但是我并没有选择Docker Machine，因为感觉并没有实际需求。Docker Machine所创建的本地虚拟机默认基于Docker专用的Linux发行版[boot2docker](https://github.com/boot2docker/boot2docker)，云端虚拟机默认基于ubuntu，对其他Linux发行版的支持还处于实验阶段。而Vagrant稳定支持更多Linux发行版，所以可以满足更多需求。Vagrant可以通过Vagrantfile进行自定义配置，而Docker Machine并没有对应功能，因此Vagrant用于创建虚拟机更加灵活。\n\n","slug":"2016/06/19/160619-vagrant-virtual-machine","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywelv0008mkfyp3cfeah2","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x624B;&#x52A8;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x91CD;&#x88C5;&#x8D77;&#x6765;&#x4E5F;&#x5F88;&#x9EBB;&#x70E6;&#xFF0C;&#x6253;&#x5305;&#x6210;&#x955C;&#x50CF;&#x7684;&#x8BDD;&#x5219;&#x4E0D;&#x6613;&#x4FEE;&#x6539;&#xFF0C;&#x5F88;&#x96BE;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x79FB;&#x690D;&#x5230;&#x4E91;&#x7AEF;&#x3002;<a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"external\">Vagrant</a>&#x53EF;&#x4EE5;&#x5C06;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6709;&#x6548;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x4EE5;&#x4E0A;&#x6240;&#x63D0;&#x7684;&#x75DB;&#x70B9;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">2016-06-19</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<p><img src=\"/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png\" width=\"300\"></p>\n<h2 id=\"&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\"><a href=\"#&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\" class=\"headerlink\" title=\"&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;\"></a>&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\" target=\"_blank\" rel=\"external\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\" target=\"_blank\" rel=\"external\">Vagrant</a></strong></h4><h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> vagrant-ubuntu</div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-ubuntu</div><div class=\"line\">vagrant box <span class=\"built_in\">add</span> ubuntu/trusty64</div><div class=\"line\">vagrant init ubuntu/trusty64</div><div class=\"line\">vagrant <span class=\"keyword\">up</span> --provider virtualbox</div><div class=\"line\">vagrant ssh</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>vagrant box add:</strong> &#x4E0B;&#x8F7D;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>box</strong></li>\n<li><strong>vagrant init:</strong> &#x751F;&#x6210;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Vagrantfile</strong></li>\n<li><strong>vagrant up:</strong> &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n</ul>\n<p>&#x4E0D;&#x59A8;&#x67E5;&#x770B;&#x4E00;&#x4E0B;Vagrant&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;<strong>Vagrantfile</strong>, &#x6211;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#xFF1A;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"built_in\">do</span> |<span class=\"built_in\">config</span>|</div><div class=\"line\">   <span class=\"built_in\">config</span>.vm.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"><span class=\"built_in\">end</span></div></pre></td></tr></table></figure>\n<p><strong>Vagrantfile</strong>&#x7684;&#x5185;&#x5BB9;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4EC5;&#x5B9A;&#x4E49;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Box</strong>&#x4E3A;<strong>ubuntu/trusty64</strong>&#x3002;<strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x662F;ubuntu trusty(14.04)&#x3002;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x4F8B;&#x5982;Debian&#x6216;&#x8005;CentOS&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://atlas.hashicorp.com/boxes/search\" target=\"_blank\" rel=\"external\">&#x8FD9;&#x91CC;</a>&#x641C;&#x7D22;&#x5BF9;&#x5E94;&#x7684;<strong>Box</strong>.</p>\n<p>Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x4E3B;&#x673A;&#x4E0A;&#x7684;vagrant-ubuntu&#x76EE;&#x5F55;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/vagrant&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;512MB</li>\n<li>CPU: 1</li>\n</ul>\n<p>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x6EE1;&#x8DB3;&#x5F00;&#x53D1;&#x9700;&#x6C42;&#xFF0C;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"><a href=\"#&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"></a>&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;</h2><h4 id=\"1-&#x4FEE;&#x6539;Vagrantfile\"><a href=\"#1-&#x4FEE;&#x6539;Vagrantfile\" class=\"headerlink\" title=\"1. &#x4FEE;&#x6539;Vagrantfile\"></a><strong>1. &#x4FEE;&#x6539;Vagrantfile</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vim Vagrantfile</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#x3002;</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"keyword\">do</span> |config|</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</span></div><div class=\"line\">  config.vm.<span class=\"built_in\">box</span> = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">  config.vm.hostname=<span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">  config.vm.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.0.2&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">  config.vm.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provider <span class=\"string\">&quot;virtualbox&quot;</span> <span class=\"keyword\">do</span> |v|</div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">      v.name = <span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span></div><div class=\"line\">      v.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">      v.cpus = <span class=\"number\">1</span></div><div class=\"line\">  <span class=\"keyword\">end</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-<span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\">     <span class=\"meta\"># &#x5B89;&#x88C5;Docker 1.11.0</span></div><div class=\"line\">     apt-get update</div><div class=\"line\">     apt-get install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-get update;</div><div class=\"line\">     apt-get install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">end</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x4E3B;&#x673A;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant destroy</div><div class=\"line\">vagrant up <span class=\"comment\">--provider virtualbox</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">0</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x65E0;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">127.0.0.1</span> -p <span class=\"number\">2222</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;2222&#x662F;&#x4E3B;&#x673A;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8F6C;&#x53D1;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight vhdl\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant ssh-config | grep <span class=\"keyword\">Port</span></div><div class=\"line\">  <span class=\"keyword\">Port</span> <span class=\"number\">2222</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#x3002;</p>\n<h4 id=\"5-&#x5173;&#x4E8E;Provision\"><a href=\"#5-&#x5173;&#x4E8E;Provision\" class=\"headerlink\" title=\"5. &#x5173;&#x4E8E;Provision\"></a><strong>5. &#x5173;&#x4E8E;Provision</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">     # &#x5B89;&#x88C5;Docker <span class=\"number\">1.11</span><span class=\"number\">.0</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span>;</div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">halt</span></div><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">up</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provider</span> <span class=\"comment\">virtualbox</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provision</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#xFF0C;Vagrant&#x652F;&#x6301;&#x521B;&#x5EFA;<a href=\"https://www.vagrantup.com/docs/provisioning/docker.html\" target=\"_blank\" rel=\"external\">Docker Provision</a>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#xFF0C;&#x529F;&#x80FD;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x7528;&#x8D77;&#x6765;&#x4E0D;&#x5982;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x7075;&#x6D3B;&#x3002;</p>\n<h2 id=\"&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"><a href=\"#&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\" class=\"headerlink\" title=\"&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"></a>&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;</h2><p><a href=\"https://www.vagrantup.com/\" target=\"_blank\" rel=\"external\">Vagrant</a>&#x4E0E;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;Vagrant&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#xFF0C;&#x800C;Docker&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E24;&#x8005;&#x7684;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#x3002;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x4E24;&#x4E2A;&#x90FD;&#x7528;&#xFF0C;Vagrant&#x4EC5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x800C;Docker&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x548C;&#x8FD0;&#x884C;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x3002;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x4E86;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E24;&#x5C42;&#x9694;&#x79BB;&#xFF0C;MacBook&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x591A;&#x4F59;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;Vagrant&#x6240;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x4E5F;&#x4EC5;&#x9700;&#x8981;&#x5B89;&#x88C5;Docker&#x7B49;&#x5C11;&#x6570;&#x8F6F;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x548C;&#x5B89;&#x5168;&#x3002;</p>\n<p>Vagrant&#x662F;&#x57FA;&#x4E8E;Vagrantfile&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C;Docker&#x662F;&#x57FA;&#x4E8E;Dockerfile&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x3002;&#x4E24;&#x8005;&#x90FD;&#x662F;&#x5C06;&#x5E94;&#x7528;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#xFF0C;&#x6613;&#x4E8E;&#x91CD;&#x590D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x7248;&#x672C;&#x63A7;&#x5236;&#x3002;&#x4F46;&#x662F;&#xFF0C;Vagrantfile&#x7684;&#x8BED;&#x6CD5;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x964B;&#xFF0C;&#x8FDC;&#x6CA1;&#x6709;Dockerfile&#x7075;&#x6D3B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Vagrant&#x4EC5;&#x9002;&#x5408;&#x4E8E;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x6216;&#x8005;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6253;&#x5305;&#x5E94;&#x7528;&#x3002;</p>\n<p>Vagrant&#x7684;&#x529F;&#x80FD;&#x4E0E;<a href=\"https://docs.docker.com/machine/\" target=\"_blank\" rel=\"external\">Docker Machine</a>&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x90FD;&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x3002;&#x4F46;&#x662F;&#xFF0C;Docker Machine&#x662F;&#x4E13;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#x7684;&#xFF0C;&#x800C;Vagrant&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;&#x7406;&#x8BBA;&#x4E0A;Docker&#x7528;&#x6237;&#x4F7F;&#x7528;Docker Machine&#x4F1A;&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x9009;&#x62E9;Docker Machine&#xFF0C;&#x56E0;&#x4E3A;&#x611F;&#x89C9;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x3002;Docker Machine&#x6240;&#x521B;&#x5EFA;&#x7684;&#x672C;&#x5730;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;Docker&#x4E13;&#x7528;&#x7684;Linux&#x53D1;&#x884C;&#x7248;<a href=\"https://github.com/boot2docker/boot2docker\" target=\"_blank\" rel=\"external\">boot2docker</a>&#xFF0C;&#x4E91;&#x7AEF;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;ubuntu&#xFF0C;&#x5BF9;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x7684;&#x652F;&#x6301;&#x8FD8;&#x5904;&#x4E8E;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#x3002;&#x800C;Vagrant&#x7A33;&#x5B9A;&#x652F;&#x6301;&#x66F4;&#x591A;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x66F4;&#x591A;&#x9700;&#x6C42;&#x3002;Vagrant&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Vagrantfile&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#xFF0C;&#x800C;Docker Machine&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;Vagrant&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</p>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x624B;&#x52A8;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x91CD;&#x88C5;&#x8D77;&#x6765;&#x4E5F;&#x5F88;&#x9EBB;&#x70E6;&#xFF0C;&#x6253;&#x5305;&#x6210;&#x955C;&#x50CF;&#x7684;&#x8BDD;&#x5219;&#x4E0D;&#x6613;&#x4FEE;&#x6539;&#xFF0C;&#x5F88;&#x96BE;&#x8FDB;&#x884C;&#x7248;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x79FB;&#x690D;&#x5230;&#x4E91;&#x7AEF;&#x3002;<a href=\"https://www.vagrantup.com/\">Vagrant</a>&#x53EF;&#x4EE5;&#x5C06;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6709;&#x6548;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x4EE5;&#x4E0A;&#x6240;&#x63D0;&#x7684;&#x75DB;&#x70B9;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">2016-06-19</a></li>\n</ul>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<p><img src=\"/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png\" width=\"300\"></p>\n<h2 id=\"&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\"><a href=\"#&#x4E00;-&#x5FEB;&#x901F;&#x5165;&#x95E8;\" class=\"headerlink\" title=\"&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;\"></a>&#x4E00;. &#x5FEB;&#x901F;&#x5165;&#x95E8;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\">Vagrant</a></strong></h4><h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> vagrant-ubuntu</div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-ubuntu</div><div class=\"line\">vagrant box <span class=\"built_in\">add</span> ubuntu/trusty64</div><div class=\"line\">vagrant init ubuntu/trusty64</div><div class=\"line\">vagrant <span class=\"keyword\">up</span> --provider virtualbox</div><div class=\"line\">vagrant ssh</div></pre></td></tr></table></figure>\n<ul>\n<li><strong>vagrant box add:</strong> &#x4E0B;&#x8F7D;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>box</strong></li>\n<li><strong>vagrant init:</strong> &#x751F;&#x6210;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Vagrantfile</strong></li>\n<li><strong>vagrant up:</strong> &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n</ul>\n<p>&#x4E0D;&#x59A8;&#x67E5;&#x770B;&#x4E00;&#x4E0B;Vagrant&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;<strong>Vagrantfile</strong>, &#x6211;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#xFF1A;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"built_in\">do</span> |<span class=\"built_in\">config</span>|</div><div class=\"line\">   <span class=\"built_in\">config</span>.vm.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"><span class=\"built_in\">end</span></div></pre></td></tr></table></figure>\n<p><strong>Vagrantfile</strong>&#x7684;&#x5185;&#x5BB9;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4EC5;&#x5B9A;&#x4E49;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;<strong>Box</strong>&#x4E3A;<strong>ubuntu/trusty64</strong>&#x3002;<strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x662F;ubuntu trusty(14.04)&#x3002;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x4F8B;&#x5982;Debian&#x6216;&#x8005;CentOS&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<a href=\"https://atlas.hashicorp.com/boxes/search\">&#x8FD9;&#x91CC;</a>&#x641C;&#x7D22;&#x5BF9;&#x5E94;&#x7684;<strong>Box</strong>.</p>\n<p>Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x4E3B;&#x673A;&#x4E0A;&#x7684;vagrant-ubuntu&#x76EE;&#x5F55;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/vagrant&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;512MB</li>\n<li>CPU: 1</li>\n</ul>\n<p>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x6EE1;&#x8DB3;&#x5F00;&#x53D1;&#x9700;&#x6C42;&#xFF0C;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"><a href=\"#&#x4E8C;-&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;\"></a>&#x4E8C;. &#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;</h2><h4 id=\"1-&#x4FEE;&#x6539;Vagrantfile\"><a href=\"#1-&#x4FEE;&#x6539;Vagrantfile\" class=\"headerlink\" title=\"1. &#x4FEE;&#x6539;Vagrantfile\"></a><strong>1. &#x4FEE;&#x6539;Vagrantfile</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vim Vagrantfile</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#x3002;</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"number\">2</span>) <span class=\"keyword\">do</span> |config|</div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</span></div><div class=\"line\">  config.vm.<span class=\"built_in\">box</span> = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">  config.vm.hostname=<span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">  config.vm.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.0.2&quot;</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">  config.vm.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"meta\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provider <span class=\"string\">&quot;virtualbox&quot;</span> <span class=\"keyword\">do</span> |v|</div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">      v.name = <span class=\"string\">&quot;ubuntu&quot;</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;</span></div><div class=\"line\">      v.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">      <span class=\"meta\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">      v.cpus = <span class=\"number\">1</span></div><div class=\"line\">  <span class=\"keyword\">end</span></div><div class=\"line\">  </div><div class=\"line\">  <span class=\"meta\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-<span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\">     <span class=\"meta\"># &#x5B89;&#x88C5;Docker 1.11.0</span></div><div class=\"line\">     apt-get update</div><div class=\"line\">     apt-get install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-get update;</div><div class=\"line\">     apt-get install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  <span class=\"built_in\">SHELL</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">end</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#2-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>2. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x4E3B;&#x673A;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\"><a href=\"#3-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;-1\" class=\"headerlink\" title=\"3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>3. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant destroy</div><div class=\"line\">vagrant up <span class=\"comment\">--provider virtualbox</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#4-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>4. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">0</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x65E0;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">127.0.0.1</span> -p <span class=\"number\">2222</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;2222&#x662F;&#x4E3B;&#x673A;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x7684;&#x8F6C;&#x53D1;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight vhdl\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant ssh-config | grep <span class=\"keyword\">Port</span></div><div class=\"line\">  <span class=\"keyword\">Port</span> <span class=\"number\">2222</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x8F93;&#x5165;&#x5BC6;&#x7801;&#x3002;</p>\n<h4 id=\"5-&#x5173;&#x4E8E;Provision\"><a href=\"#5-&#x5173;&#x4E8E;Provision\" class=\"headerlink\" title=\"5. &#x5173;&#x4E8E;Provision\"></a><strong>5. &#x5173;&#x4E8E;Provision</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">  config.vm.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">     # &#x5B89;&#x88C5;Docker <span class=\"number\">1.11</span><span class=\"number\">.0</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install apt-transport-https ca-certificates</div><div class=\"line\">     apt-<span class=\"built_in\">key</span> adv --keyserver hkp:<span class=\"comment\">//p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span></div><div class=\"line\">     echo deb https:<span class=\"comment\">//apt.dockerproject.org/repo ubuntu-trusty main &gt; /etc/apt/sources.list.d/docker.list</span></div><div class=\"line\">     apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span>;</div><div class=\"line\">     apt-<span class=\"built_in\">get</span> install -y -q docker-engine=<span class=\"number\">1.11</span><span class=\"number\">.0</span><span class=\"number\">-0</span>~trusty</div><div class=\"line\">     usermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">  SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight brainfuck\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">halt</span></div><div class=\"line\"><span class=\"comment\">vagrant</span> <span class=\"comment\">up</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provider</span> <span class=\"comment\">virtualbox</span> <span class=\"literal\">-</span><span class=\"literal\">-</span><span class=\"comment\">provision</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#xFF0C;Vagrant&#x652F;&#x6301;&#x521B;&#x5EFA;<a href=\"https://www.vagrantup.com/docs/provisioning/docker.html\">Docker Provision</a>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#xFF0C;&#x529F;&#x80FD;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x7528;&#x8D77;&#x6765;&#x4E0D;&#x5982;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x7075;&#x6D3B;&#x3002;</p>\n<h2 id=\"&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"><a href=\"#&#x4E09;-Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\" class=\"headerlink\" title=\"&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;\"></a>&#x4E09;. Vagrant&#x4E0E;Docker&#x6BD4;&#x8F83;</h2><p><a href=\"https://www.vagrantup.com/\">Vagrant</a>&#x4E0E;<a href=\"https://www.docker.com/\">Docker</a>&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;Vagrant&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x7684;&#xFF0C;&#x800C;Docker&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E24;&#x8005;&#x7684;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#x3002;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x4E24;&#x4E2A;&#x90FD;&#x7528;&#xFF0C;Vagrant&#x4EC5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x800C;Docker&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x548C;&#x8FD0;&#x884C;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x3002;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x4E86;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E24;&#x5C42;&#x9694;&#x79BB;&#xFF0C;MacBook&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x591A;&#x4F59;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;Vagrant&#x6240;&#x521B;&#x5EFA;&#x7684;&#x865A;&#x62DF;&#x673A;&#x4E5F;&#x4EC5;&#x9700;&#x8981;&#x5B89;&#x88C5;Docker&#x7B49;&#x5C11;&#x6570;&#x8F6F;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x548C;&#x5B89;&#x5168;&#x3002;</p>\n<p>Vagrant&#x662F;&#x57FA;&#x4E8E;Vagrantfile&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C;Docker&#x662F;&#x57FA;&#x4E8E;Dockerfile&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x3002;&#x4E24;&#x8005;&#x90FD;&#x662F;&#x5C06;&#x5E94;&#x7528;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x4EE3;&#x7801;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#xFF0C;&#x6613;&#x4E8E;&#x91CD;&#x590D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x7248;&#x672C;&#x63A7;&#x5236;&#x3002;&#x4F46;&#x662F;&#xFF0C;Vagrantfile&#x7684;&#x8BED;&#x6CD5;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x964B;&#xFF0C;&#x8FDC;&#x6CA1;&#x6709;Dockerfile&#x7075;&#x6D3B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Vagrant&#x4EC5;&#x9002;&#x5408;&#x4E8E;&#x521B;&#x5EFA;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x6216;&#x8005;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6253;&#x5305;&#x5E94;&#x7528;&#x3002;</p>\n<p>Vagrant&#x7684;&#x529F;&#x80FD;&#x4E0E;<a href=\"https://docs.docker.com/machine/\">Docker Machine</a>&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x90FD;&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x3002;&#x4F46;&#x662F;&#xFF0C;Docker Machine&#x662F;&#x4E13;&#x7528;&#x4E8E;&#x521B;&#x5EFA;Docker&#x4E3B;&#x673A;&#x7684;&#xFF0C;&#x800C;Vagrant&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;&#x7406;&#x8BBA;&#x4E0A;Docker&#x7528;&#x6237;&#x4F7F;&#x7528;Docker Machine&#x4F1A;&#x66F4;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x9009;&#x62E9;Docker Machine&#xFF0C;&#x56E0;&#x4E3A;&#x611F;&#x89C9;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x3002;Docker Machine&#x6240;&#x521B;&#x5EFA;&#x7684;&#x672C;&#x5730;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;Docker&#x4E13;&#x7528;&#x7684;Linux&#x53D1;&#x884C;&#x7248;<a href=\"https://github.com/boot2docker/boot2docker\">boot2docker</a>&#xFF0C;&#x4E91;&#x7AEF;&#x865A;&#x62DF;&#x673A;&#x9ED8;&#x8BA4;&#x57FA;&#x4E8E;ubuntu&#xFF0C;&#x5BF9;&#x5176;&#x4ED6;Linux&#x53D1;&#x884C;&#x7248;&#x7684;&#x652F;&#x6301;&#x8FD8;&#x5904;&#x4E8E;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#x3002;&#x800C;Vagrant&#x7A33;&#x5B9A;&#x652F;&#x6301;&#x66F4;&#x591A;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x66F4;&#x591A;&#x9700;&#x6C42;&#x3002;Vagrant&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Vagrantfile&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#xFF0C;&#x800C;Docker Machine&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x5E94;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;Vagrant&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</p>"},{"title":"基于Docker搭建单机版Mesos/Marathon","date":"2015-09-18T04:00:00.000Z","_content":"\n**摘要:** 本文介绍了基于Docker搭建单机版Mesos/Marathon的方法，Mesos/Marathon的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-mesos-docker](https://github.com/kiwenlau/single-mesos-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-09-18](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)\n\n## 一. 简介\n\n[Mesos](http://mesos.apache.org)是集群资源管理系统，[Marathon](http://mesosphere.github.io/marathon)是运行在Mesos之上的集群计算架构。将Mesos和Marathon打包到[Docker](https://www.docker.com/)镜像中，开发者便可以在本机上快速搭建Mesos/Marathon集群，进行学习和测试。\n\n**kiwenlau/single-mesos**镜像非常简单。Docker容器运行在Ubuntu主机之上，Mesos和Marathon运行在该容器之中。具体来讲，Docker容器中运行了一个Mesos Master和一个Mesos Slave，以及Marathon和[ZooKeeper](https://zookeeper.apache.org/)。集群架构如下图：\n\n<img src=\"150918-single-mesos-docker/single-mesos-marathon.png\" width = \"500\"/>\n\n\n## 二. 搭建Mesos/Marathon集群\n\n#### **1. 下载Docker镜像:**\n\n```sh\nsudo docker pull kiwenlau/single-mesos:3.0\n```\n\n#### **2. 运行Docker容器:**\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0\n```\n\ndocker run命令运行成功后即进入容器内部，以下为输出：\n\n```bash\nStart ZooKeeper...\nStart Mesos master...\nStart Mesos slave...\nStart Marathon...\n```\n\n\n## 三. 测试Mesos/Marathon集群\n\n#### **1. 通过curl命令调用Marathon的REST API, 创建一个hello程序：**\n\n```sh\ncurl -v -H \"Content-Type: application/json\" -X POST --data \"@hello.json\" http://127.0.0.1:8080/v2/apps\n```\n\n下面为hello.json。由cmd可知，该程序每隔1秒往output.txt文件中写入hello。\n\n```bash\n{\n  \"id\": \"hello\",\n  \"cmd\": \"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\n  \"cpus\": 0.1,\n  \"mem\": 10.0,\n  \"instances\": 1\n}\n```\n\ncurl执行结果:\n\n```bash\n* Hostname was NOT found in DNS cache\n*   Trying 127.0.0.1...\n* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)\n> POST /v2/apps HTTP/1.1\n> User-Agent: curl/7.35.0\n> Host: 127.0.0.1:8080\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 139\n> \n* upload completely sent off: 139 out of 139 bytes\n< HTTP/1.1 201 Created\n< X-Marathon-Leader: http://ec054cabb9af:8080\n< Cache-Control: no-cache, no-store, must-revalidate\n< Pragma: no-cache\n< Expires: 0\n< Location: http://127.0.0.1:8080/v2/apps/hello\n< Content-Type: application/json; qs=2\n< Transfer-Encoding: chunked\n* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted\n< Server: Jetty(8.y.z-SNAPSHOT)\n< \n* Connection #0 to host 127.0.0.1 left intact\n{\"id\":\"/hello\",\"cmd\":\"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\"args\":null,\"user\":null,\"env\":{},\"instances\":1,\"cpus\":0.1,\"mem\":10.0,\"disk\":0.0,\"executor\":\"\",\"constraints\":[],\"uris\":[],\"storeUrls\":[],\"ports\":[0],\"requirePorts\":false,\"backoffFactor\":1.15,\"container\":null,\"healthChecks\":[],\"dependencies\":[],\"upgradeStrategy\":{\"minimumHealthCapacity\":1.0,\"maximumOverCapacity\":1.0},\"labels\":{},\"acceptedResourceRoles\":null,\"version\":\"2015-09-16T11:22:27.967Z\",\"deployments\":[{\"id\":\"2cd2fdd4-e5f9-4088-895f-7976349b7a19\"}],\"tasks\":[],\"tasksStaged\":0,\"tasksRunning\":0,\"tasksHealthy\":0,\"tasksUnhealthy\":0,\"backoffSeconds\":1,\"maxLaunchDelaySeconds\":3600}\n```\n\n#### **2. 查看hello程序的运行结果：**\n\n```sh\ntail -f output.txt\n```\n当你看到终端不断输出\"hello\"时说明运行成功。\n\n#### **3. 使用浏览器查看Mesos和Marathon的网页管理界面**\n\n**注意**将IP替换运行Docker容器的主机IP地址\n\nMesos网页管理界面地址：[http://192.168.59.10:5050](http://192.168.59.10:5050)\n\nMesos网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Mesos.png\" width = \"500\"/>\n\nMarathon网页管理界面地址：[http://192.168.59.10:8080](http://192.168.59.10:8080)\n\nMarathon网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Marathon.png\" width = \"500\"/>\n\n#### **4. 通过Marathon网页管理界面创建测试程序**\n\n在Marathon的网页管理界面上点击\"New APP\"，在弹框中配置测试程序。ID为\"hello\", Command为\"echo hello >> /root/output.txt\", 然后点击\"Create\"即可。如下图：\n\n<img src=\"150918-single-mesos-docker/hello.png\" width = \"300\"/>\n\n\n## 四. 存在的问题\n\n其实，参考[Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)，可以很快地在ubuntu主机上直接搭建一个单节点的Mesos/Marathon集群。但是，当我安装该教程的步骤将Mesos/Marathon集群打包到Docker镜像中时，遇到了一个比较奇怪的问题。\n\n在Docker容器中使用**\"sudo service mesos-master start\"**和**\"sudo service mesos-slave start\"**命令启动Mesos Master和Mesos Slave时，出现**\"mesos-master: unrecognized service\"**和**\"mesos-slave: unrecognized service\"**错误。但是，我在ubuntu主机上安装Mesos/Marathon集群后，使用同样的命令启动Mesos并没有问题。后来，我是通过直接执行mesos-master和mesos-slave命令启动Mesos，命令如下：\n\n```sh\n/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/log/mesos  \n```\n\n```sh\n/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/log/mesos\n```\n\n由这个问题可知，虽然在Docker容器几乎可以运行任意程序，似乎和Ubuntu主机没有区别。但是事实上，**Docker容器与ubuntu主机并非完全一致**，而且这些细节的不同点比较坑。这一点很值得探讨，可以让大家在使用Docker时少走些弯路。对于提到的问题，虽然是解决了，然而我仍然不清楚其中的原因:(\n\n\n## 五. Docker镜像备份\n\n我将Docker镜像上传到了灵雀云（Alaudo）的Docker仓库，可以通过以下命令下载和运行：\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n## 六. 参考\n\n1. [Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)\n2. [Setting up a Cluster on Mesos and Marathon](https://open.mesosphere.com/getting-started/datacenter/install/#master-setup)\n3. [An Introduction to Mesosphere](https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere)\n4. [How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04](https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04)\n5. [Deploy a Mesos Cluster with 7 Commands Using Docker](https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586)\n6. [sekka1/mesosphere-docker](https://github.com/sekka1/mesosphere-docker)\n7. [Marathon: Application Basics](http://mesosphere.github.io/marathon/docs/application-basics.html)\n8. [Marathon: REST API](http://mesosphere.github.io/marathon/docs/rest-api.html)\n\n","source":"_posts/2015/09/18/150918-single-mesos-docker.md","raw":"title: 基于Docker搭建单机版Mesos/Marathon\n\ndate: 2015-09-18 12:00:00\n\ntags: [Docker,Mesos,Marathon]\n\n---\n\n**摘要:** 本文介绍了基于Docker搭建单机版Mesos/Marathon的方法，Mesos/Marathon的所有组件均运行于单个容器中。\n\n**GitHub地址:**\n- [kiwenlau/single-mesos-docker](https://github.com/kiwenlau/single-mesos-docker)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2015-09-18](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)\n\n## 一. 简介\n\n[Mesos](http://mesos.apache.org)是集群资源管理系统，[Marathon](http://mesosphere.github.io/marathon)是运行在Mesos之上的集群计算架构。将Mesos和Marathon打包到[Docker](https://www.docker.com/)镜像中，开发者便可以在本机上快速搭建Mesos/Marathon集群，进行学习和测试。\n\n**kiwenlau/single-mesos**镜像非常简单。Docker容器运行在Ubuntu主机之上，Mesos和Marathon运行在该容器之中。具体来讲，Docker容器中运行了一个Mesos Master和一个Mesos Slave，以及Marathon和[ZooKeeper](https://zookeeper.apache.org/)。集群架构如下图：\n\n<img src=\"150918-single-mesos-docker/single-mesos-marathon.png\" width = \"500\"/>\n\n\n## 二. 搭建Mesos/Marathon集群\n\n#### **1. 下载Docker镜像:**\n\n```sh\nsudo docker pull kiwenlau/single-mesos:3.0\n```\n\n#### **2. 运行Docker容器:**\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0\n```\n\ndocker run命令运行成功后即进入容器内部，以下为输出：\n\n```bash\nStart ZooKeeper...\nStart Mesos master...\nStart Mesos slave...\nStart Marathon...\n```\n\n\n## 三. 测试Mesos/Marathon集群\n\n#### **1. 通过curl命令调用Marathon的REST API, 创建一个hello程序：**\n\n```sh\ncurl -v -H \"Content-Type: application/json\" -X POST --data \"@hello.json\" http://127.0.0.1:8080/v2/apps\n```\n\n下面为hello.json。由cmd可知，该程序每隔1秒往output.txt文件中写入hello。\n\n```bash\n{\n  \"id\": \"hello\",\n  \"cmd\": \"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\n  \"cpus\": 0.1,\n  \"mem\": 10.0,\n  \"instances\": 1\n}\n```\n\ncurl执行结果:\n\n```bash\n* Hostname was NOT found in DNS cache\n*   Trying 127.0.0.1...\n* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)\n> POST /v2/apps HTTP/1.1\n> User-Agent: curl/7.35.0\n> Host: 127.0.0.1:8080\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 139\n> \n* upload completely sent off: 139 out of 139 bytes\n< HTTP/1.1 201 Created\n< X-Marathon-Leader: http://ec054cabb9af:8080\n< Cache-Control: no-cache, no-store, must-revalidate\n< Pragma: no-cache\n< Expires: 0\n< Location: http://127.0.0.1:8080/v2/apps/hello\n< Content-Type: application/json; qs=2\n< Transfer-Encoding: chunked\n* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted\n< Server: Jetty(8.y.z-SNAPSHOT)\n< \n* Connection #0 to host 127.0.0.1 left intact\n{\"id\":\"/hello\",\"cmd\":\"while [ true ] ; do echo hello >> /root/output.txt; sleep 1; done\",\"args\":null,\"user\":null,\"env\":{},\"instances\":1,\"cpus\":0.1,\"mem\":10.0,\"disk\":0.0,\"executor\":\"\",\"constraints\":[],\"uris\":[],\"storeUrls\":[],\"ports\":[0],\"requirePorts\":false,\"backoffFactor\":1.15,\"container\":null,\"healthChecks\":[],\"dependencies\":[],\"upgradeStrategy\":{\"minimumHealthCapacity\":1.0,\"maximumOverCapacity\":1.0},\"labels\":{},\"acceptedResourceRoles\":null,\"version\":\"2015-09-16T11:22:27.967Z\",\"deployments\":[{\"id\":\"2cd2fdd4-e5f9-4088-895f-7976349b7a19\"}],\"tasks\":[],\"tasksStaged\":0,\"tasksRunning\":0,\"tasksHealthy\":0,\"tasksUnhealthy\":0,\"backoffSeconds\":1,\"maxLaunchDelaySeconds\":3600}\n```\n\n#### **2. 查看hello程序的运行结果：**\n\n```sh\ntail -f output.txt\n```\n当你看到终端不断输出\"hello\"时说明运行成功。\n\n#### **3. 使用浏览器查看Mesos和Marathon的网页管理界面**\n\n**注意**将IP替换运行Docker容器的主机IP地址\n\nMesos网页管理界面地址：[http://192.168.59.10:5050](http://192.168.59.10:5050)\n\nMesos网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Mesos.png\" width = \"500\"/>\n\nMarathon网页管理界面地址：[http://192.168.59.10:8080](http://192.168.59.10:8080)\n\nMarathon网页管理界面如图，可知hello程序正在运行：\n\n<img src=\"150918-single-mesos-docker/Marathon.png\" width = \"500\"/>\n\n#### **4. 通过Marathon网页管理界面创建测试程序**\n\n在Marathon的网页管理界面上点击\"New APP\"，在弹框中配置测试程序。ID为\"hello\", Command为\"echo hello >> /root/output.txt\", 然后点击\"Create\"即可。如下图：\n\n<img src=\"150918-single-mesos-docker/hello.png\" width = \"300\"/>\n\n\n## 四. 存在的问题\n\n其实，参考[Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)，可以很快地在ubuntu主机上直接搭建一个单节点的Mesos/Marathon集群。但是，当我安装该教程的步骤将Mesos/Marathon集群打包到Docker镜像中时，遇到了一个比较奇怪的问题。\n\n在Docker容器中使用**\"sudo service mesos-master start\"**和**\"sudo service mesos-slave start\"**命令启动Mesos Master和Mesos Slave时，出现**\"mesos-master: unrecognized service\"**和**\"mesos-slave: unrecognized service\"**错误。但是，我在ubuntu主机上安装Mesos/Marathon集群后，使用同样的命令启动Mesos并没有问题。后来，我是通过直接执行mesos-master和mesos-slave命令启动Mesos，命令如下：\n\n```sh\n/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/log/mesos  \n```\n\n```sh\n/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/log/mesos\n```\n\n由这个问题可知，虽然在Docker容器几乎可以运行任意程序，似乎和Ubuntu主机没有区别。但是事实上，**Docker容器与ubuntu主机并非完全一致**，而且这些细节的不同点比较坑。这一点很值得探讨，可以让大家在使用Docker时少走些弯路。对于提到的问题，虽然是解决了，然而我仍然不清楚其中的原因:(\n\n\n## 五. Docker镜像备份\n\n我将Docker镜像上传到了灵雀云（Alaudo）的Docker仓库，可以通过以下命令下载和运行：\n\n```sh\nsudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n```sh\nsudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0\n```\n\n## 六. 参考\n\n1. [Setting up a Single Node Mesosphere Cluster](https://open.mesosphere.com/getting-started/developer/single-node-install/)\n2. [Setting up a Cluster on Mesos and Marathon](https://open.mesosphere.com/getting-started/datacenter/install/#master-setup)\n3. [An Introduction to Mesosphere](https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere)\n4. [How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04](https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04)\n5. [Deploy a Mesos Cluster with 7 Commands Using Docker](https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586)\n6. [sekka1/mesosphere-docker](https://github.com/sekka1/mesosphere-docker)\n7. [Marathon: Application Basics](http://mesosphere.github.io/marathon/docs/application-basics.html)\n8. [Marathon: REST API](http://mesosphere.github.io/marathon/docs/rest-api.html)\n\n","slug":"2015/09/18/150918-single-mesos-docker","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywem2000amkfy1ygd2heg","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Mesos/Marathon&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-mesos-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-mesos-docker</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">2015-09-18</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p><a href=\"http://mesos.apache.org\" target=\"_blank\" rel=\"external\">Mesos</a>&#x662F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#xFF0C;<a href=\"http://mesosphere.github.io/marathon\" target=\"_blank\" rel=\"external\">Marathon</a>&#x662F;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x96C6;&#x7FA4;&#x8BA1;&#x7B97;&#x67B6;&#x6784;&#x3002;&#x5C06;Mesos&#x548C;Marathon&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4FBF;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x5FEB;&#x901F;&#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;&#xFF0C;&#x8FDB;&#x884C;&#x5B66;&#x4E60;&#x548C;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p><strong>kiwenlau/single-mesos</strong>&#x955C;&#x50CF;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E4B;&#x4E0A;&#xFF0C;Mesos&#x548C;Marathon&#x8FD0;&#x884C;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BB2;&#xFF0C;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;Mesos Master&#x548C;&#x4E00;&#x4E2A;Mesos Slave&#xFF0C;&#x4EE5;&#x53CA;Marathon&#x548C;<a href=\"https://zookeeper.apache.org/\" target=\"_blank\" rel=\"external\">ZooKeeper</a>&#x3002;&#x96C6;&#x7FA4;&#x67B6;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png\" width=\"500\"></p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:\"></a><strong>2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<p>docker run&#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#x5373;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#xFF0C;&#x4EE5;&#x4E0B;&#x4E3A;&#x8F93;&#x51FA;&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Start ZooKeeper...</div><div class=\"line\">Start Mesos master...</div><div class=\"line\">Start Mesos slave...</div><div class=\"line\">Start Marathon...</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"><a href=\"#1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\" class=\"headerlink\" title=\"1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"></a><strong>1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -v -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -X POST --data <span class=\"string\">&quot;@hello.json&quot;</span> http://127.0.0.1:8080/v2/apps</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x4E3A;hello.json&#x3002;&#x7531;cmd&#x53EF;&#x77E5;&#xFF0C;&#x8BE5;&#x7A0B;&#x5E8F;&#x6BCF;&#x9694;1&#x79D2;&#x5F80;output.txt&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;hello&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">  <span class=\"string\">&quot;id&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cmd&quot;</span>: <span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cpus&quot;</span>: 0.1,</div><div class=\"line\">  <span class=\"string\">&quot;mem&quot;</span>: 10.0,</div><div class=\"line\">  <span class=\"string\">&quot;instances&quot;</span>: 1</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>curl&#x6267;&#x884C;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">* Hostname was NOT found <span class=\"keyword\">in</span> DNS cache</div><div class=\"line\">*   Trying 127.0.0.1...</div><div class=\"line\">* Connected to 127.0.0.1 (127.0.0.1) port 8080 (<span class=\"comment\">#0)</span></div><div class=\"line\">&gt; POST /v2/apps HTTP/1.1</div><div class=\"line\">&gt; User-Agent: curl/7.35.0</div><div class=\"line\">&gt; Host: 127.0.0.1:8080</div><div class=\"line\">&gt; Accept: */*</div><div class=\"line\">&gt; Content-Type: application/json</div><div class=\"line\">&gt; Content-Length: 139</div><div class=\"line\">&gt; </div><div class=\"line\">* upload completely sent off: 139 out of 139 bytes</div><div class=\"line\">&lt; HTTP/1.1 201 Created</div><div class=\"line\">&lt; X-Marathon-Leader: http://ec054cabb9af:8080</div><div class=\"line\">&lt; Cache-Control: no-cache, no-store, must-revalidate</div><div class=\"line\">&lt; Pragma: no-cache</div><div class=\"line\">&lt; Expires: 0</div><div class=\"line\">&lt; Location: http://127.0.0.1:8080/v2/apps/hello</div><div class=\"line\">&lt; Content-Type: application/json; qs=2</div><div class=\"line\">&lt; Transfer-Encoding: chunked</div><div class=\"line\">* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted</div><div class=\"line\">&lt; Server: Jetty(8.y.z-SNAPSHOT)</div><div class=\"line\">&lt; </div><div class=\"line\">* Connection <span class=\"comment\">#0 to host 127.0.0.1 left intact</span></div><div class=\"line\">{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;/hello&quot;</span>,<span class=\"string\">&quot;cmd&quot;</span>:<span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,<span class=\"string\">&quot;args&quot;</span>:null,<span class=\"string\">&quot;user&quot;</span>:null,<span class=\"string\">&quot;env&quot;</span>:{},<span class=\"string\">&quot;instances&quot;</span>:1,<span class=\"string\">&quot;cpus&quot;</span>:0.1,<span class=\"string\">&quot;mem&quot;</span>:10.0,<span class=\"string\">&quot;disk&quot;</span>:0.0,<span class=\"string\">&quot;executor&quot;</span>:<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;constraints&quot;</span>:[],<span class=\"string\">&quot;uris&quot;</span>:[],<span class=\"string\">&quot;storeUrls&quot;</span>:[],<span class=\"string\">&quot;ports&quot;</span>:[0],<span class=\"string\">&quot;requirePorts&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;backoffFactor&quot;</span>:1.15,<span class=\"string\">&quot;container&quot;</span>:null,<span class=\"string\">&quot;healthChecks&quot;</span>:[],<span class=\"string\">&quot;dependencies&quot;</span>:[],<span class=\"string\">&quot;upgradeStrategy&quot;</span>:{<span class=\"string\">&quot;minimumHealthCapacity&quot;</span>:1.0,<span class=\"string\">&quot;maximumOverCapacity&quot;</span>:1.0},<span class=\"string\">&quot;labels&quot;</span>:{},<span class=\"string\">&quot;acceptedResourceRoles&quot;</span>:null,<span class=\"string\">&quot;version&quot;</span>:<span class=\"string\">&quot;2015-09-16T11:22:27.967Z&quot;</span>,<span class=\"string\">&quot;deployments&quot;</span>:[{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;2cd2fdd4-e5f9-4088-895f-7976349b7a19&quot;</span>}],<span class=\"string\">&quot;tasks&quot;</span>:[],<span class=\"string\">&quot;tasksStaged&quot;</span>:0,<span class=\"string\">&quot;tasksRunning&quot;</span>:0,<span class=\"string\">&quot;tasksHealthy&quot;</span>:0,<span class=\"string\">&quot;tasksUnhealthy&quot;</span>:0,<span class=\"string\">&quot;backoffSeconds&quot;</span>:1,<span class=\"string\">&quot;maxLaunchDelaySeconds&quot;</span>:3600}</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"><a href=\"#2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\" class=\"headerlink\" title=\"2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"></a><strong>2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">tail <span class=\"_\">-f</span> output.txt</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x4F60;&#x770B;&#x5230;&#x7EC8;&#x7AEF;&#x4E0D;&#x65AD;&#x8F93;&#x51FA;&#x201D;hello&#x201D;&#x65F6;&#x8BF4;&#x660E;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x3002;</p>\n<h4 id=\"3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"><a href=\"#3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\" class=\"headerlink\" title=\"3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"></a><strong>3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;</strong></h4><p><strong>&#x6CE8;&#x610F;</strong>&#x5C06;IP&#x66FF;&#x6362;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#x5730;&#x5740;</p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:5050\" target=\"_blank\" rel=\"external\">http://192.168.59.10:5050</a></p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Mesos.png\" width=\"500\"></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:8080\" target=\"_blank\" rel=\"external\">http://192.168.59.10:8080</a></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Marathon.png\" width=\"500\"></p>\n<h4 id=\"4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"><a href=\"#4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\" class=\"headerlink\" title=\"4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"></a><strong>4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;</strong></h4><p>&#x5728;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x4E0A;&#x70B9;&#x51FB;&#x201D;New APP&#x201D;&#xFF0C;&#x5728;&#x5F39;&#x6846;&#x4E2D;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x3002;ID&#x4E3A;&#x201D;hello&#x201D;, Command&#x4E3A;&#x201D;echo hello &gt;&gt; /root/output.txt&#x201D;, &#x7136;&#x540E;&#x70B9;&#x51FB;&#x201D;Create&#x201D;&#x5373;&#x53EF;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/hello.png\" width=\"300\"></p>\n<h2 id=\"&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"><a href=\"#&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"></a>&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</h2><p>&#x5176;&#x5B9E;&#xFF0C;&#x53C2;&#x8003;<a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\" target=\"_blank\" rel=\"external\">Setting up a Single Node Mesosphere Cluster</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5730;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x76F4;&#x63A5;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x5B89;&#x88C5;&#x8BE5;&#x6559;&#x7A0B;&#x7684;&#x6B65;&#x9AA4;&#x5C06;Mesos/Marathon&#x96C6;&#x7FA4;&#x6253;&#x5305;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#x65F6;&#xFF0C;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528;<strong>&#x201C;sudo service mesos-master start&#x201D;</strong>&#x548C;<strong>&#x201C;sudo service mesos-slave start&#x201D;</strong>&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos Master&#x548C;Mesos Slave&#x65F6;&#xFF0C;&#x51FA;&#x73B0;<strong>&#x201C;mesos-master: unrecognized service&#x201D;</strong>&#x548C;<strong>&#x201C;mesos-slave: unrecognized service&#x201D;</strong>&#x9519;&#x8BEF;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;Mesos/Marathon&#x96C6;&#x7FA4;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#x5E76;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x540E;&#x6765;&#xFF0C;&#x6211;&#x662F;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x6267;&#x884C;mesos-master&#x548C;mesos-slave&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<p>&#x7531;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x53EF;&#x77E5;&#xFF0C;&#x867D;&#x7136;&#x5728;Docker&#x5BB9;&#x5668;&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4EFB;&#x610F;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F3C;&#x4E4E;&#x548C;Ubuntu&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x533A;&#x522B;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;<strong>Docker&#x5BB9;&#x5668;&#x4E0E;ubuntu&#x4E3B;&#x673A;&#x5E76;&#x975E;&#x5B8C;&#x5168;&#x4E00;&#x81F4;</strong>&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x7EC6;&#x8282;&#x7684;&#x4E0D;&#x540C;&#x70B9;&#x6BD4;&#x8F83;&#x5751;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x5F88;&#x503C;&#x5F97;&#x63A2;&#x8BA8;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5927;&#x5BB6;&#x5728;&#x4F7F;&#x7528;Docker&#x65F6;&#x5C11;&#x8D70;&#x4E9B;&#x5F2F;&#x8DEF;&#x3002;&#x5BF9;&#x4E8E;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x867D;&#x7136;&#x662F;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x6211;&#x4ECD;&#x7136;&#x4E0D;&#x6E05;&#x695A;&#x5176;&#x4E2D;&#x7684;&#x539F;&#x56E0;:(</p>\n<h2 id=\"&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"><a href=\"#&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\" class=\"headerlink\" title=\"&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"></a>&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;</h2><p>&#x6211;&#x5C06;Docker&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;&#x4E86;&#x7075;&#x96C0;&#x4E91;&#xFF08;Alaudo&#xFF09;&#x7684;Docker&#x4ED3;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E0B;&#x8F7D;&#x548C;&#x8FD0;&#x884C;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h2 id=\"&#x516D;-&#x53C2;&#x8003;\"><a href=\"#&#x516D;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x516D;. &#x53C2;&#x8003;\"></a>&#x516D;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\" target=\"_blank\" rel=\"external\">Setting up a Single Node Mesosphere Cluster</a></li>\n<li><a href=\"https://open.mesosphere.com/getting-started/datacenter/install/#master-setup\" target=\"_blank\" rel=\"external\">Setting up a Cluster on Mesos and Marathon</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere\" target=\"_blank\" rel=\"external\">An Introduction to Mesosphere</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04\" target=\"_blank\" rel=\"external\">How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04</a></li>\n<li><a href=\"https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586\" target=\"_blank\" rel=\"external\">Deploy a Mesos Cluster with 7 Commands Using Docker</a></li>\n<li><a href=\"https://github.com/sekka1/mesosphere-docker\" target=\"_blank\" rel=\"external\">sekka1/mesosphere-docker</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/application-basics.html\" target=\"_blank\" rel=\"external\">Marathon: Application Basics</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/rest-api.html\" target=\"_blank\" rel=\"external\">Marathon: REST API</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon&#x7684;&#x65B9;&#x6CD5;&#xFF0C;Mesos/Marathon&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x4E8E;&#x5355;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-mesos-docker\">kiwenlau/single-mesos-docker</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">2015-09-18</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p><a href=\"http://mesos.apache.org\">Mesos</a>&#x662F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#xFF0C;<a href=\"http://mesosphere.github.io/marathon\">Marathon</a>&#x662F;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x96C6;&#x7FA4;&#x8BA1;&#x7B97;&#x67B6;&#x6784;&#x3002;&#x5C06;Mesos&#x548C;Marathon&#x6253;&#x5305;&#x5230;<a href=\"https://www.docker.com/\">Docker</a>&#x955C;&#x50CF;&#x4E2D;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4FBF;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x5FEB;&#x901F;&#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;&#xFF0C;&#x8FDB;&#x884C;&#x5B66;&#x4E60;&#x548C;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p><strong>kiwenlau/single-mesos</strong>&#x955C;&#x50CF;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E4B;&#x4E0A;&#xFF0C;Mesos&#x548C;Marathon&#x8FD0;&#x884C;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BB2;&#xFF0C;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;Mesos Master&#x548C;&#x4E00;&#x4E2A;Mesos Slave&#xFF0C;&#x4EE5;&#x53CA;Marathon&#x548C;<a href=\"https://zookeeper.apache.org/\">ZooKeeper</a>&#x3002;&#x96C6;&#x7FA4;&#x67B6;&#x6784;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png\" width=\"500\"></p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:\"></a><strong>1. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:\"></a><strong>2. &#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;:</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<p>docker run&#x547D;&#x4EE4;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#x5373;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#xFF0C;&#x4EE5;&#x4E0B;&#x4E3A;&#x8F93;&#x51FA;&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">Start ZooKeeper...</div><div class=\"line\">Start Mesos master...</div><div class=\"line\">Start Mesos slave...</div><div class=\"line\">Start Marathon...</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\"><a href=\"#&#x4E09;-&#x6D4B;&#x8BD5;Mesos-Marathon&#x96C6;&#x7FA4;\" class=\"headerlink\" title=\"&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;\"></a>&#x4E09;. &#x6D4B;&#x8BD5;Mesos/Marathon&#x96C6;&#x7FA4;</h2><h4 id=\"1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"><a href=\"#1-&#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST-API-&#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\" class=\"headerlink\" title=\"1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;\"></a><strong>1. &#x901A;&#x8FC7;curl&#x547D;&#x4EE4;&#x8C03;&#x7528;Marathon&#x7684;REST API, &#x521B;&#x5EFA;&#x4E00;&#x4E2A;hello&#x7A0B;&#x5E8F;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -v -H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> -X POST --data <span class=\"string\">&quot;@hello.json&quot;</span> http://127.0.0.1:8080/v2/apps</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x4E3A;hello.json&#x3002;&#x7531;cmd&#x53EF;&#x77E5;&#xFF0C;&#x8BE5;&#x7A0B;&#x5E8F;&#x6BCF;&#x9694;1&#x79D2;&#x5F80;output.txt&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;hello&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">  <span class=\"string\">&quot;id&quot;</span>: <span class=\"string\">&quot;hello&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cmd&quot;</span>: <span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,</div><div class=\"line\">  <span class=\"string\">&quot;cpus&quot;</span>: 0.1,</div><div class=\"line\">  <span class=\"string\">&quot;mem&quot;</span>: 10.0,</div><div class=\"line\">  <span class=\"string\">&quot;instances&quot;</span>: 1</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>curl&#x6267;&#x884C;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">* Hostname was NOT found <span class=\"keyword\">in</span> DNS cache</div><div class=\"line\">*   Trying 127.0.0.1...</div><div class=\"line\">* Connected to 127.0.0.1 (127.0.0.1) port 8080 (<span class=\"comment\">#0)</span></div><div class=\"line\">&gt; POST /v2/apps HTTP/1.1</div><div class=\"line\">&gt; User-Agent: curl/7.35.0</div><div class=\"line\">&gt; Host: 127.0.0.1:8080</div><div class=\"line\">&gt; Accept: */*</div><div class=\"line\">&gt; Content-Type: application/json</div><div class=\"line\">&gt; Content-Length: 139</div><div class=\"line\">&gt; </div><div class=\"line\">* upload completely sent off: 139 out of 139 bytes</div><div class=\"line\">&lt; HTTP/1.1 201 Created</div><div class=\"line\">&lt; X-Marathon-Leader: http://ec054cabb9af:8080</div><div class=\"line\">&lt; Cache-Control: no-cache, no-store, must-revalidate</div><div class=\"line\">&lt; Pragma: no-cache</div><div class=\"line\">&lt; Expires: 0</div><div class=\"line\">&lt; Location: http://127.0.0.1:8080/v2/apps/hello</div><div class=\"line\">&lt; Content-Type: application/json; qs=2</div><div class=\"line\">&lt; Transfer-Encoding: chunked</div><div class=\"line\">* Server Jetty(8.y.z-SNAPSHOT) is not blacklisted</div><div class=\"line\">&lt; Server: Jetty(8.y.z-SNAPSHOT)</div><div class=\"line\">&lt; </div><div class=\"line\">* Connection <span class=\"comment\">#0 to host 127.0.0.1 left intact</span></div><div class=\"line\">{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;/hello&quot;</span>,<span class=\"string\">&quot;cmd&quot;</span>:<span class=\"string\">&quot;while [ true ] ; do echo hello &gt;&gt; /root/output.txt; sleep 1; done&quot;</span>,<span class=\"string\">&quot;args&quot;</span>:null,<span class=\"string\">&quot;user&quot;</span>:null,<span class=\"string\">&quot;env&quot;</span>:{},<span class=\"string\">&quot;instances&quot;</span>:1,<span class=\"string\">&quot;cpus&quot;</span>:0.1,<span class=\"string\">&quot;mem&quot;</span>:10.0,<span class=\"string\">&quot;disk&quot;</span>:0.0,<span class=\"string\">&quot;executor&quot;</span>:<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;constraints&quot;</span>:[],<span class=\"string\">&quot;uris&quot;</span>:[],<span class=\"string\">&quot;storeUrls&quot;</span>:[],<span class=\"string\">&quot;ports&quot;</span>:[0],<span class=\"string\">&quot;requirePorts&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;backoffFactor&quot;</span>:1.15,<span class=\"string\">&quot;container&quot;</span>:null,<span class=\"string\">&quot;healthChecks&quot;</span>:[],<span class=\"string\">&quot;dependencies&quot;</span>:[],<span class=\"string\">&quot;upgradeStrategy&quot;</span>:{<span class=\"string\">&quot;minimumHealthCapacity&quot;</span>:1.0,<span class=\"string\">&quot;maximumOverCapacity&quot;</span>:1.0},<span class=\"string\">&quot;labels&quot;</span>:{},<span class=\"string\">&quot;acceptedResourceRoles&quot;</span>:null,<span class=\"string\">&quot;version&quot;</span>:<span class=\"string\">&quot;2015-09-16T11:22:27.967Z&quot;</span>,<span class=\"string\">&quot;deployments&quot;</span>:[{<span class=\"string\">&quot;id&quot;</span>:<span class=\"string\">&quot;2cd2fdd4-e5f9-4088-895f-7976349b7a19&quot;</span>}],<span class=\"string\">&quot;tasks&quot;</span>:[],<span class=\"string\">&quot;tasksStaged&quot;</span>:0,<span class=\"string\">&quot;tasksRunning&quot;</span>:0,<span class=\"string\">&quot;tasksHealthy&quot;</span>:0,<span class=\"string\">&quot;tasksUnhealthy&quot;</span>:0,<span class=\"string\">&quot;backoffSeconds&quot;</span>:1,<span class=\"string\">&quot;maxLaunchDelaySeconds&quot;</span>:3600}</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"><a href=\"#2-&#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\" class=\"headerlink\" title=\"2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;\"></a><strong>2. &#x67E5;&#x770B;hello&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</strong></h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">tail <span class=\"_\">-f</span> output.txt</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x4F60;&#x770B;&#x5230;&#x7EC8;&#x7AEF;&#x4E0D;&#x65AD;&#x8F93;&#x51FA;&#x201D;hello&#x201D;&#x65F6;&#x8BF4;&#x660E;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x3002;</p>\n<h4 id=\"3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"><a href=\"#3-&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\" class=\"headerlink\" title=\"3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;\"></a><strong>3. &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;Mesos&#x548C;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;</strong></h4><p><strong>&#x6CE8;&#x610F;</strong>&#x5C06;IP&#x66FF;&#x6362;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#x5730;&#x5740;</p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:5050\">http://192.168.59.10:5050</a></p>\n<p>Mesos&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Mesos.png\" width=\"500\"></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5730;&#x5740;&#xFF1A;<a href=\"http://192.168.59.10:8080\">http://192.168.59.10:8080</a></p>\n<p>Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x77E5;hello&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/Marathon.png\" width=\"500\"></p>\n<h4 id=\"4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"><a href=\"#4-&#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\" class=\"headerlink\" title=\"4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;\"></a><strong>4. &#x901A;&#x8FC7;Marathon&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;</strong></h4><p>&#x5728;Marathon&#x7684;&#x7F51;&#x9875;&#x7BA1;&#x7406;&#x754C;&#x9762;&#x4E0A;&#x70B9;&#x51FB;&#x201D;New APP&#x201D;&#xFF0C;&#x5728;&#x5F39;&#x6846;&#x4E2D;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x3002;ID&#x4E3A;&#x201D;hello&#x201D;, Command&#x4E3A;&#x201D;echo hello &gt;&gt; /root/output.txt&#x201D;, &#x7136;&#x540E;&#x70B9;&#x51FB;&#x201D;Create&#x201D;&#x5373;&#x53EF;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>\n<p><img src=\"/2015/09/18/150918-single-mesos-docker/hello.png\" width=\"300\"></p>\n<h2 id=\"&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"><a href=\"#&#x56DB;-&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;\"></a>&#x56DB;. &#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;</h2><p>&#x5176;&#x5B9E;&#xFF0C;&#x53C2;&#x8003;<a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\">Setting up a Single Node Mesosphere Cluster</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5730;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x76F4;&#x63A5;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x6211;&#x5B89;&#x88C5;&#x8BE5;&#x6559;&#x7A0B;&#x7684;&#x6B65;&#x9AA4;&#x5C06;Mesos/Marathon&#x96C6;&#x7FA4;&#x6253;&#x5305;&#x5230;Docker&#x955C;&#x50CF;&#x4E2D;&#x65F6;&#xFF0C;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528;<strong>&#x201C;sudo service mesos-master start&#x201D;</strong>&#x548C;<strong>&#x201C;sudo service mesos-slave start&#x201D;</strong>&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos Master&#x548C;Mesos Slave&#x65F6;&#xFF0C;&#x51FA;&#x73B0;<strong>&#x201C;mesos-master: unrecognized service&#x201D;</strong>&#x548C;<strong>&#x201C;mesos-slave: unrecognized service&#x201D;</strong>&#x9519;&#x8BEF;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x5728;ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;Mesos/Marathon&#x96C6;&#x7FA4;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#x5E76;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x540E;&#x6765;&#xFF0C;&#x6211;&#x662F;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x6267;&#x884C;mesos-master&#x548C;mesos-slave&#x547D;&#x4EE4;&#x542F;&#x52A8;Mesos&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-master --zk=zk://127.0.0.1:2181/mesos --quorum=1 --work_dir=/var/lib/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">/usr/sbin/mesos-slave --master=zk://127.0.0.1:2181/mesos --log_dir=/<span class=\"built_in\">log</span>/mesos</div></pre></td></tr></table></figure>\n<p>&#x7531;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x53EF;&#x77E5;&#xFF0C;&#x867D;&#x7136;&#x5728;Docker&#x5BB9;&#x5668;&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4EFB;&#x610F;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F3C;&#x4E4E;&#x548C;Ubuntu&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x533A;&#x522B;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;<strong>Docker&#x5BB9;&#x5668;&#x4E0E;ubuntu&#x4E3B;&#x673A;&#x5E76;&#x975E;&#x5B8C;&#x5168;&#x4E00;&#x81F4;</strong>&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x7EC6;&#x8282;&#x7684;&#x4E0D;&#x540C;&#x70B9;&#x6BD4;&#x8F83;&#x5751;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x5F88;&#x503C;&#x5F97;&#x63A2;&#x8BA8;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5927;&#x5BB6;&#x5728;&#x4F7F;&#x7528;Docker&#x65F6;&#x5C11;&#x8D70;&#x4E9B;&#x5F2F;&#x8DEF;&#x3002;&#x5BF9;&#x4E8E;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x867D;&#x7136;&#x662F;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x6211;&#x4ECD;&#x7136;&#x4E0D;&#x6E05;&#x695A;&#x5176;&#x4E2D;&#x7684;&#x539F;&#x56E0;:(</p>\n<h2 id=\"&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"><a href=\"#&#x4E94;-Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\" class=\"headerlink\" title=\"&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;\"></a>&#x4E94;. Docker&#x955C;&#x50CF;&#x5907;&#x4EFD;</h2><p>&#x6211;&#x5C06;Docker&#x955C;&#x50CF;&#x4E0A;&#x4F20;&#x5230;&#x4E86;&#x7075;&#x96C0;&#x4E91;&#xFF08;Alaudo&#xFF09;&#x7684;Docker&#x4ED3;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x4E0B;&#x8F7D;&#x548C;&#x8FD0;&#x884C;&#xFF1A;</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run -p 5050:5050 -p 8080:8080 --name mesos -it -w /root index.alauda.cn/kiwenlau/single-mesos:3.0</div></pre></td></tr></table></figure>\n<h2 id=\"&#x516D;-&#x53C2;&#x8003;\"><a href=\"#&#x516D;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x516D;. &#x53C2;&#x8003;\"></a>&#x516D;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://open.mesosphere.com/getting-started/developer/single-node-install/\">Setting up a Single Node Mesosphere Cluster</a></li>\n<li><a href=\"https://open.mesosphere.com/getting-started/datacenter/install/#master-setup\">Setting up a Cluster on Mesos and Marathon</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-mesosphere\">An Introduction to Mesosphere</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-configure-a-production-ready-mesosphere-cluster-on-ubuntu-14-04\">How To Configure a Production-Ready Mesosphere Cluster on Ubuntu 14.04</a></li>\n<li><a href=\"https://medium.com/@gargar454/deploy-a-mesos-cluster-with-7-commands-using-docker-57951e020586\">Deploy a Mesos Cluster with 7 Commands Using Docker</a></li>\n<li><a href=\"https://github.com/sekka1/mesosphere-docker\">sekka1/mesosphere-docker</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/application-basics.html\">Marathon: Application Basics</a></li>\n<li><a href=\"http://mesosphere.github.io/marathon/docs/rest-api.html\">Marathon: REST API</a></li>\n</ol>"},{"title":"如何运行多进程Docker容器？","date":"2016-01-09T13:00:00.000Z","_content":"\n**摘要:** 本文介绍了两种在Docker容器中运行多个进程的方法: **shell脚本**和**supervisor**。\n\n**GitHub地址:**\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-01-09](http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/)\n\n## 一. 简介\n\n一般来说，Docker容器比较适合运行单个进程。例如，项目\"**使用多个Docker容器运行Kubernetes**\"，Kubernetes的各个组件分别运行在各个容器之中，每个容器只运行单个进程。\n\n然而，很多时候我们需要在Docker容器中运行多个进程。例如，项目\"**使用单个Docker容器运行Kubernetes**\"，kubernetes的各个组件均运行在同一个容器中，该容器中运行了多个进程。那么，**如何运行多进程Docker容器？**\n\n一种方法是使用**Shell脚本**，另一种方法是使用进程管理工具[Supervisor](http://supervisord.org/)。[kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)和[kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)分别采用了这两种方法，用于启动多个进程来运行Kubernetes的各个组件，从而实现\"**使用单个Docker容器运行Kubernetes**\"。下面我将分别介绍两种不同方法。\n\n## 二. 使用Shell脚本运行多进程Docker容器\n\n这个方法大家应该会比较熟悉，使用Shell脚本依次启动Kubernetes的各个组件即可。以下为**start-kubernetes.sh**\n\n```\n#!/bin/bash\n\n# start docker daemon\ndocker daemon > /var/log/docker.log 2>&1 &\n\n# start etcd\netcd --data-dir=/var/etcd/data > /var/log/etcd.log 2>&1 &\n\n# wait for ectd to setup\nsleep 5\n\n# start apiserver\nkube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001 > /var/log/kube-apiserver.log 2>&1 &\n\n# wait for apiserver to setup\nsleep 5\n\n# start controller manager, sheduler, kubelet and proxy\nkube-controller-manager --master=http://0.0.0.0:8080 > /var/log/kube-controller-manager.log 2>&1 &\nkube-scheduler --master=http://0.0.0.0:8080 > /var/log/kube-scheduler.log 2>&1 &\nkubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"  > /var/log/kubelet.log 2>&1 &\nkube-proxy --master=http://0.0.0.0:8080 > /var/log/kube-proxy.log 2>&1 &\n\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n然后在Dockerfile中，将**start-kubernetes.sh**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"start-kubernetes.sh\"]\n```\n\n**需要注意**的一点在于，**start-kubernetes.sh**脚本将作为Docker容器的1号进程运行，必须始终保持运行。因为**Docker容器仅在1号进程运行时保持运行**，换言之，Docker容器将在1号进程退出后**Exited**。由于Kubernetes的各个组件都以后台进程方式执行，我在脚本末尾添加了死循环，以保持**start-kubernetes.sh**脚本始终处于运行状态。\n\n```\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n## 三. 使用supervisor运行多进程Docker容器\n\n[Supervisor](http://supervisord.org/)是进程管理工具。这时，需要编写supervisor的配置文件**kubernetes.conf**:\n\n```\n[supervisord]\nnodaemon=true\n\n[program:etcd]\ncommand=etcd --data-dir=/var/etcd/data\nautorestart=true\nstdout_logfile=/var/log/etcd.stdout.log\nstderr_logfile=/var/log/etcd.stderr.log\n\n[program:kube-apiserver]\ncommand=kube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001\nautorestart=true\nstdout_logfile=/var/log/kube-apiserver.stdout.log\nstderr_logfile=/var/log/kube-apiserver.stderr.log\n\n[program:kube-controller-manager]\ncommand=kube-controller-manager --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/controller-manager.stdout.log\nstderr_logfile=/var/log/controller-manager.stderr.log\n\n[program:kube-scheduler]\ncommand=kube-scheduler --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-scheduler.stdout.log\nstderr_logfile=/var/log/kube-scheduler.stderr.log\n\n[program:kubelet]\ncommand=kubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"\nautorestart=true\nstdout_logfile=/var/log/kubelet.stdout.log\nstderr_logfile=/var/log/kubelet.stderr.log\n\n[program:kube-proxy]\ncommand=kube-proxy --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-proxy.stdout.log\nstderr_logfile=/var/log/kube-proxy.stderr.log\n\n[program:docker]\ncommand=docker daemon\nautorestart=true\nstdout_logfile=/var/log/docker.stdout.log\nstderr_logfile=/var/log/docker.stderr.log\n```\n\n可知，将Kubernetes的各个组件的启动命令设为command即可。autorestart参数设为true，意味着supervisor将负责重启意外退出的组件。stdout_logfile和stderr_logfile参数则可以用于设置命令的标准输出文件和标准错误输出文件。\n\n然后在Dockerfile中，将**supervisord**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/conf.d/kubernetes.conf\"]\n```\n\n此时, supervisord是Docker容器中的1号进程，也需要始终保持运行状态。nodaemon设为true时，表示supervisor保持前台运行而非在后台运行。若supervisor在后台运行，则Docker容器也会在执行supervisord命令后立即Exited.\n\n```\n[supervisord]\nnodaemon=true\n```\n\n\n\n## 四. 总结\n\n使用Shell脚本运行多进程Docker容器，优势是大家比较熟悉。由于需要保持Docker容器的1号进程始终运行，这一点比较容易出错。若要实现进程意外退出后自动重启的话，使用shell脚本比较麻烦。\n\n使用supervisor运行多进程Docker容器，非常方便。另外，保持1号进程保持运行，以及进程意外退出后自动重启，实现起来都很简单。\n\n\n#### **使用多个Docker容器运行Kubernetes**\n\n**GitHub地址**\n\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n#### **使用单个Docker容器运行Kubernetes**\n\n**GitHub地址:**\n\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n该项目中，我将kubernetes的所有组件：etcd, controller manager, apiserver, scheduler, kubelet, proxy以及docker daemon均运行在同一个Docker容器之中。\n\n容器启动时，各个组件由shell脚本或者supervisor启动。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width = \"500\"/>\n\n## 参考\n1. [Using Supervisor with Docker](https://docs.docker.com/engine/articles/using_supervisord/)\n2. [How To Install and Manage Supervisor on Ubuntu and Debian VPS](https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps)\n3. [基于Docker搭建单机版Kuberntes](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n4. [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n","source":"_posts/2016/01/09/160109-multiple-processes--docker-container.md","raw":"title: 如何运行多进程Docker容器？\n\ndate: 2016-01-09 21:00:00\n\ntags: [Docker, Kubernetes]\n\n---\n\n**摘要:** 本文介绍了两种在Docker容器中运行多个进程的方法: **shell脚本**和**supervisor**。\n\n**GitHub地址:**\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-01-09](http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/)\n\n## 一. 简介\n\n一般来说，Docker容器比较适合运行单个进程。例如，项目\"**使用多个Docker容器运行Kubernetes**\"，Kubernetes的各个组件分别运行在各个容器之中，每个容器只运行单个进程。\n\n然而，很多时候我们需要在Docker容器中运行多个进程。例如，项目\"**使用单个Docker容器运行Kubernetes**\"，kubernetes的各个组件均运行在同一个容器中，该容器中运行了多个进程。那么，**如何运行多进程Docker容器？**\n\n一种方法是使用**Shell脚本**，另一种方法是使用进程管理工具[Supervisor](http://supervisord.org/)。[kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)和[kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)分别采用了这两种方法，用于启动多个进程来运行Kubernetes的各个组件，从而实现\"**使用单个Docker容器运行Kubernetes**\"。下面我将分别介绍两种不同方法。\n\n## 二. 使用Shell脚本运行多进程Docker容器\n\n这个方法大家应该会比较熟悉，使用Shell脚本依次启动Kubernetes的各个组件即可。以下为**start-kubernetes.sh**\n\n```\n#!/bin/bash\n\n# start docker daemon\ndocker daemon > /var/log/docker.log 2>&1 &\n\n# start etcd\netcd --data-dir=/var/etcd/data > /var/log/etcd.log 2>&1 &\n\n# wait for ectd to setup\nsleep 5\n\n# start apiserver\nkube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001 > /var/log/kube-apiserver.log 2>&1 &\n\n# wait for apiserver to setup\nsleep 5\n\n# start controller manager, sheduler, kubelet and proxy\nkube-controller-manager --master=http://0.0.0.0:8080 > /var/log/kube-controller-manager.log 2>&1 &\nkube-scheduler --master=http://0.0.0.0:8080 > /var/log/kube-scheduler.log 2>&1 &\nkubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"  > /var/log/kubelet.log 2>&1 &\nkube-proxy --master=http://0.0.0.0:8080 > /var/log/kube-proxy.log 2>&1 &\n\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n然后在Dockerfile中，将**start-kubernetes.sh**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"start-kubernetes.sh\"]\n```\n\n**需要注意**的一点在于，**start-kubernetes.sh**脚本将作为Docker容器的1号进程运行，必须始终保持运行。因为**Docker容器仅在1号进程运行时保持运行**，换言之，Docker容器将在1号进程退出后**Exited**。由于Kubernetes的各个组件都以后台进程方式执行，我在脚本末尾添加了死循环，以保持**start-kubernetes.sh**脚本始终处于运行状态。\n\n```\n# just keep this script running\nwhile [[ true ]]; do\n\tsleep 1\ndone\n```\n\n## 三. 使用supervisor运行多进程Docker容器\n\n[Supervisor](http://supervisord.org/)是进程管理工具。这时，需要编写supervisor的配置文件**kubernetes.conf**:\n\n```\n[supervisord]\nnodaemon=true\n\n[program:etcd]\ncommand=etcd --data-dir=/var/etcd/data\nautorestart=true\nstdout_logfile=/var/log/etcd.stdout.log\nstderr_logfile=/var/log/etcd.stderr.log\n\n[program:kube-apiserver]\ncommand=kube-apiserver --service-cluster-ip-range=10.0.0.1/24 --insecure-bind-address=0.0.0.0 --etcd_servers=http://127.0.0.1:4001\nautorestart=true\nstdout_logfile=/var/log/kube-apiserver.stdout.log\nstderr_logfile=/var/log/kube-apiserver.stderr.log\n\n[program:kube-controller-manager]\ncommand=kube-controller-manager --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/controller-manager.stdout.log\nstderr_logfile=/var/log/controller-manager.stderr.log\n\n[program:kube-scheduler]\ncommand=kube-scheduler --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-scheduler.stdout.log\nstderr_logfile=/var/log/kube-scheduler.stderr.log\n\n[program:kubelet]\ncommand=kubelet --api_servers=http://0.0.0.0:8080 --address=0.0.0.0 --cluster_dns=10.0.0.10 --cluster_domain=\"kubernetes.local\" --pod-infra-container-image=\"kiwenlau/pause:0.8.0\"\nautorestart=true\nstdout_logfile=/var/log/kubelet.stdout.log\nstderr_logfile=/var/log/kubelet.stderr.log\n\n[program:kube-proxy]\ncommand=kube-proxy --master=http://0.0.0.0:8080\nautorestart=true\nstdout_logfile=/var/log/kube-proxy.stdout.log\nstderr_logfile=/var/log/kube-proxy.stderr.log\n\n[program:docker]\ncommand=docker daemon\nautorestart=true\nstdout_logfile=/var/log/docker.stdout.log\nstderr_logfile=/var/log/docker.stderr.log\n```\n\n可知，将Kubernetes的各个组件的启动命令设为command即可。autorestart参数设为true，意味着supervisor将负责重启意外退出的组件。stdout_logfile和stderr_logfile参数则可以用于设置命令的标准输出文件和标准错误输出文件。\n\n然后在Dockerfile中，将**supervisord**指定为Docker容器默认执行的命令即可:\n\n```\nCMD [\"supervisord\", \"-c\", \"/etc/supervisor/conf.d/kubernetes.conf\"]\n```\n\n此时, supervisord是Docker容器中的1号进程，也需要始终保持运行状态。nodaemon设为true时，表示supervisor保持前台运行而非在后台运行。若supervisor在后台运行，则Docker容器也会在执行supervisord命令后立即Exited.\n\n```\n[supervisord]\nnodaemon=true\n```\n\n\n\n## 四. 总结\n\n使用Shell脚本运行多进程Docker容器，优势是大家比较熟悉。由于需要保持Docker容器的1号进程始终运行，这一点比较容易出错。若要实现进程意外退出后自动重启的话，使用shell脚本比较麻烦。\n\n使用supervisor运行多进程Docker容器，非常方便。另外，保持1号进程保持运行，以及进程意外退出后自动重启，实现起来都很简单。\n\n\n#### **使用多个Docker容器运行Kubernetes**\n\n**GitHub地址**\n\n- [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n下图显示了我在Ubuntu主机上运行单机版Kubernetes的架构。可知，我一共运行了7个容器，分别运行Kubernetes的各个组件。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width = \"500\"/>\n\n#### **使用单个Docker容器运行Kubernetes**\n\n**GitHub地址:**\n\n- [kiwenlau/kubernetes-shell](https://github.com/kiwenlau/kubernetes-shell)\n- [kiwenlau/kubernetes-supervisor](https://github.com/kiwenlau/kubernetes-supervisor)\n\n该项目中，我将kubernetes的所有组件：etcd, controller manager, apiserver, scheduler, kubelet, proxy以及docker daemon均运行在同一个Docker容器之中。\n\n容器启动时，各个组件由shell脚本或者supervisor启动。\n\n<img src=\"160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width = \"500\"/>\n\n## 参考\n1. [Using Supervisor with Docker](https://docs.docker.com/engine/articles/using_supervisord/)\n2. [How To Install and Manage Supervisor on Ubuntu and Debian VPS](https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps)\n3. [基于Docker搭建单机版Kuberntes](http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/)\n4. [kiwenlau/single-kubernetes-docker](https://github.com/kiwenlau/single-kubernetes-docker)\n\n","slug":"2016/01/09/160109-multiple-processes--docker-container","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywem8000bmkfyj6268n5l","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x79CD;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;: <strong>shell&#x811A;&#x672C;</strong>&#x548C;<strong>supervisor</strong>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/\">2016-01-09</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;Docker&#x5BB9;&#x5668;&#x6BD4;&#x8F83;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x53EA;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#xFF0C;<strong>&#x5982;&#x4F55;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF1F;</strong></p>\n<p>&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;<strong>Shell&#x811A;&#x672C;</strong>&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;<a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"external\">Supervisor</a>&#x3002;<a href=\"https://github.com/kiwenlau/kubernetes-shell\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-shell</a>&#x548C;<a href=\"https://github.com/kiwenlau/kubernetes-supervisor\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-supervisor</a>&#x5206;&#x522B;&#x91C7;&#x7528;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x6765;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x5C06;&#x5206;&#x522B;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x4F1A;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#xFF0C;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x4F9D;&#x6B21;&#x542F;&#x52A8;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5373;&#x53EF;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;<strong>start-kubernetes.sh</strong></p>\n<figure class=\"highlight maxima\"><table><tr><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\"># start docker daemon</div><div class=\"line\">docker daemon &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/docker.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># start etcd</div><div class=\"line\">etcd --data-dir=/<span class=\"built_in\">var</span>/etcd/data &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/etcd.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> ectd to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start apiserver</div><div class=\"line\">kube-apiserver --service-cluster-ip-<span class=\"built_in\">range</span>=<span class=\"number\">10.0</span>.0.1/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.0.0 --etcd_servers=http://<span class=\"number\">127.0</span>.0.1:<span class=\"number\">4001</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-apiserver.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> apiserver to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start controller manager, sheduler, kubelet <span class=\"keyword\">and</span> proxy</div><div class=\"line\">kube-controller-manager --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-controller-manager.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-scheduler --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-scheduler.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kubelet --api_servers=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.0.0 --cluster_dns=<span class=\"number\">10.0</span>.0.10 --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-<span class=\"built_in\">image</span>=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span>  &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kubelet.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-proxy --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-proxy.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> [[ <span class=\"literal\">true</span> ]]; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>start-kubernetes.sh</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;start-kubernetes.sh&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p><strong>&#x9700;&#x8981;&#x6CE8;&#x610F;</strong>&#x7684;&#x4E00;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x5C06;&#x4F5C;&#x4E3A;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x3002;&#x56E0;&#x4E3A;<strong>Docker&#x5BB9;&#x5668;&#x4EC5;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x65F6;&#x4FDD;&#x6301;&#x8FD0;&#x884C;</strong>&#xFF0C;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;Docker&#x5BB9;&#x5668;&#x5C06;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x540E;<strong>Exited</strong>&#x3002;&#x7531;&#x4E8E;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x90FD;&#x4EE5;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x6211;&#x5728;&#x811A;&#x672C;&#x672B;&#x5C3E;&#x6DFB;&#x52A0;&#x4E86;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x59CB;&#x7EC8;&#x5904;&#x4E8E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"code\"><pre><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> <span class=\"string\">[[ true ]]</span>; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p><a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"external\">Supervisor</a>&#x662F;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x7F16;&#x5199;supervisor&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<strong>kubernetes.conf</strong>:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:etcd]</div><div class=\"line\"><span class=\"attr\">command</span>=etcd --data-dir=/var/etcd/data</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/etcd.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/etcd.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-apiserver]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-apiserver --service-cluster-ip-range=<span class=\"number\">10.0</span>.<span class=\"number\">0.1</span>/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --etcd_servers=http://<span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">4001</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-apiserver.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-apiserver.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-controller-manager]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-controller-manager --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/controller-manager.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/controller-manager.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-scheduler]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-scheduler --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-scheduler.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-scheduler.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kubelet]</div><div class=\"line\"><span class=\"attr\">command</span>=kubelet --api_servers=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --cluster_dns=<span class=\"number\">10.0</span>.<span class=\"number\">0.10</span> --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-image=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kubelet.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kubelet.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-proxy]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-proxy --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-proxy.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-proxy.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:docker]</div><div class=\"line\"><span class=\"attr\">command</span>=docker daemon</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/docker.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/docker.stderr.log</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x8BBE;&#x4E3A;command&#x5373;&#x53EF;&#x3002;autorestart&#x53C2;&#x6570;&#x8BBE;&#x4E3A;true&#xFF0C;&#x610F;&#x5473;&#x7740;supervisor&#x5C06;&#x8D1F;&#x8D23;&#x91CD;&#x542F;&#x610F;&#x5916;&#x9000;&#x51FA;&#x7684;&#x7EC4;&#x4EF6;&#x3002;stdout_logfile&#x548C;stderr_logfile&#x53C2;&#x6570;&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x547D;&#x4EE4;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x548C;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>supervisord</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;supervisord&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;/etc/supervisor/conf.d/kubernetes.conf&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;, supervisord&#x662F;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;nodaemon&#x8BBE;&#x4E3A;true&#x65F6;&#xFF0C;&#x8868;&#x793A;supervisor&#x4FDD;&#x6301;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#x800C;&#x975E;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x3002;&#x82E5;supervisor&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;&#x5219;Docker&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x5728;&#x6267;&#x884C;supervisord&#x547D;&#x4EE4;&#x540E;&#x7ACB;&#x5373;Exited.</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x603B;&#x7ED3;\"><a href=\"#&#x56DB;-&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x56DB;. &#x603B;&#x7ED3;\"></a>&#x56DB;. &#x603B;&#x7ED3;</h2><p>&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x4F18;&#x52BF;&#x662F;&#x5927;&#x5BB6;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;&#x7531;&#x4E8E;&#x9700;&#x8981;&#x4FDD;&#x6301;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x59CB;&#x7EC8;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;&#x82E5;&#x8981;&#x5B9E;&#x73B0;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x3002;</p>\n<p>&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4FDD;&#x6301;1&#x53F7;&#x8FDB;&#x7A0B;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x53CA;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#xFF0C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;</p>\n<h4 id=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>\n<p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<h4 id=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\" target=\"_blank\" rel=\"external\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>\n<p>&#x8BE5;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#xFF1A;etcd, controller manager, apiserver, scheduler, kubelet, proxy&#x4EE5;&#x53CA;docker daemon&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;</p>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7531;shell&#x811A;&#x672C;&#x6216;&#x8005;supervisor&#x542F;&#x52A8;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width=\"500\"></p>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://docs.docker.com/engine/articles/using_supervisord/\" target=\"_blank\" rel=\"external\">Using Supervisor with Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps\" target=\"_blank\" rel=\"external\">How To Install and Manage Supervisor on Ubuntu and Debian VPS</a></li>\n<li><a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes</a></li>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\" target=\"_blank\" rel=\"external\">kiwenlau/single-kubernetes-docker</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x4E24;&#x79CD;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;: <strong>shell&#x811A;&#x672C;</strong>&#x548C;<strong>supervisor</strong>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/01/09/160109-multiple-processes--docker-container/\">2016-01-09</a></li>\n</ul>\n<h2 id=\"&#x4E00;-&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. &#x7B80;&#x4ECB;\"></a>&#x4E00;. &#x7B80;&#x4ECB;</h2><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;Docker&#x5BB9;&#x5668;&#x6BD4;&#x8F83;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5206;&#x522B;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x53EA;&#x8FD0;&#x884C;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x9879;&#x76EE;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#xFF0C;kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x90A3;&#x4E48;&#xFF0C;<strong>&#x5982;&#x4F55;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF1F;</strong></p>\n<p>&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;<strong>Shell&#x811A;&#x672C;</strong>&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;<a href=\"http://supervisord.org/\">Supervisor</a>&#x3002;<a href=\"https://github.com/kiwenlau/kubernetes-shell\">kiwenlau/kubernetes-shell</a>&#x548C;<a href=\"https://github.com/kiwenlau/kubernetes-supervisor\">kiwenlau/kubernetes-supervisor</a>&#x5206;&#x522B;&#x91C7;&#x7528;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x6765;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x201D;<strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong>&#x201C;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x5C06;&#x5206;&#x522B;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x65B9;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E8C;-&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E8C;. &#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x4F1A;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#xFF0C;&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x4F9D;&#x6B21;&#x542F;&#x52A8;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x5373;&#x53EF;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;<strong>start-kubernetes.sh</strong></p>\n<figure class=\"highlight maxima\"><table><tr><td class=\"code\"><pre><div class=\"line\">#!/bin/bash</div><div class=\"line\"></div><div class=\"line\"># start docker daemon</div><div class=\"line\">docker daemon &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/docker.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># start etcd</div><div class=\"line\">etcd --data-dir=/<span class=\"built_in\">var</span>/etcd/data &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/etcd.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> ectd to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start apiserver</div><div class=\"line\">kube-apiserver --service-cluster-ip-<span class=\"built_in\">range</span>=<span class=\"number\">10.0</span>.0.1/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.0.0 --etcd_servers=http://<span class=\"number\">127.0</span>.0.1:<span class=\"number\">4001</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-apiserver.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># wait <span class=\"keyword\">for</span> apiserver to setup</div><div class=\"line\">sleep <span class=\"number\">5</span></div><div class=\"line\"></div><div class=\"line\"># start controller manager, sheduler, kubelet <span class=\"keyword\">and</span> proxy</div><div class=\"line\">kube-controller-manager --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-controller-manager.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-scheduler --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-scheduler.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kubelet --api_servers=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.0.0 --cluster_dns=<span class=\"number\">10.0</span>.0.10 --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-<span class=\"built_in\">image</span>=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span>  &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kubelet.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\">kube-proxy --master=http://<span class=\"number\">0.0</span>.0.0:<span class=\"number\">8080</span> &gt; /<span class=\"built_in\">var</span>/<span class=\"built_in\">log</span>/kube-proxy.<span class=\"built_in\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp;</div><div class=\"line\"></div><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> [[ <span class=\"literal\">true</span> ]]; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>start-kubernetes.sh</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;start-kubernetes.sh&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p><strong>&#x9700;&#x8981;&#x6CE8;&#x610F;</strong>&#x7684;&#x4E00;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x5C06;&#x4F5C;&#x4E3A;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x3002;&#x56E0;&#x4E3A;<strong>Docker&#x5BB9;&#x5668;&#x4EC5;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x65F6;&#x4FDD;&#x6301;&#x8FD0;&#x884C;</strong>&#xFF0C;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;Docker&#x5BB9;&#x5668;&#x5C06;&#x5728;1&#x53F7;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x540E;<strong>Exited</strong>&#x3002;&#x7531;&#x4E8E;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x90FD;&#x4EE5;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x6211;&#x5728;&#x811A;&#x672C;&#x672B;&#x5C3E;&#x6DFB;&#x52A0;&#x4E86;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4EE5;&#x4FDD;&#x6301;<strong>start-kubernetes.sh</strong>&#x811A;&#x672C;&#x59CB;&#x7EC8;&#x5904;&#x4E8E;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"code\"><pre><div class=\"line\"># just keep this script running</div><div class=\"line\"><span class=\"keyword\">while</span> <span class=\"string\">[[ true ]]</span>; <span class=\"keyword\">do</span></div><div class=\"line\">\tsleep <span class=\"number\">1</span></div><div class=\"line\">done</div></pre></td></tr></table></figure>\n<h2 id=\"&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x4E09;-&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;\"></a>&#x4E09;. &#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;</h2><p><a href=\"http://supervisord.org/\">Supervisor</a>&#x662F;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x7F16;&#x5199;supervisor&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<strong>kubernetes.conf</strong>:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:etcd]</div><div class=\"line\"><span class=\"attr\">command</span>=etcd --data-dir=/var/etcd/data</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/etcd.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/etcd.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-apiserver]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-apiserver --service-cluster-ip-range=<span class=\"number\">10.0</span>.<span class=\"number\">0.1</span>/<span class=\"number\">24</span> --insecure-bind-address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --etcd_servers=http://<span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">4001</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-apiserver.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-apiserver.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-controller-manager]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-controller-manager --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/controller-manager.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/controller-manager.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-scheduler]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-scheduler --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-scheduler.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-scheduler.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kubelet]</div><div class=\"line\"><span class=\"attr\">command</span>=kubelet --api_servers=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span> --address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span> --cluster_dns=<span class=\"number\">10.0</span>.<span class=\"number\">0.10</span> --cluster_domain=<span class=\"string\">&quot;kubernetes.local&quot;</span> --pod-infra-container-image=<span class=\"string\">&quot;kiwenlau/pause:0.8.0&quot;</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kubelet.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kubelet.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:kube-proxy]</div><div class=\"line\"><span class=\"attr\">command</span>=kube-proxy --master=http://<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">8080</span></div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/kube-proxy.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/kube-proxy.stderr.log</div><div class=\"line\"><span class=\"section\"></span></div><div class=\"line\">[program:docker]</div><div class=\"line\"><span class=\"attr\">command</span>=docker daemon</div><div class=\"line\"><span class=\"attr\">autorestart</span>=<span class=\"literal\">true</span></div><div class=\"line\"><span class=\"attr\">stdout_logfile</span>=/var/log/docker.stdout.log</div><div class=\"line\"><span class=\"attr\">stderr_logfile</span>=/var/log/docker.stderr.log</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x542F;&#x52A8;&#x547D;&#x4EE4;&#x8BBE;&#x4E3A;command&#x5373;&#x53EF;&#x3002;autorestart&#x53C2;&#x6570;&#x8BBE;&#x4E3A;true&#xFF0C;&#x610F;&#x5473;&#x7740;supervisor&#x5C06;&#x8D1F;&#x8D23;&#x91CD;&#x542F;&#x610F;&#x5916;&#x9000;&#x51FA;&#x7684;&#x7EC4;&#x4EF6;&#x3002;stdout_logfile&#x548C;stderr_logfile&#x53C2;&#x6570;&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x547D;&#x4EE4;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x548C;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x7136;&#x540E;&#x5728;Dockerfile&#x4E2D;&#xFF0C;&#x5C06;<strong>supervisord</strong>&#x6307;&#x5B9A;&#x4E3A;Docker&#x5BB9;&#x5668;&#x9ED8;&#x8BA4;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x5373;&#x53EF;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;supervisord&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;/etc/supervisor/conf.d/kubernetes.conf&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;, supervisord&#x662F;Docker&#x5BB9;&#x5668;&#x4E2D;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;nodaemon&#x8BBE;&#x4E3A;true&#x65F6;&#xFF0C;&#x8868;&#x793A;supervisor&#x4FDD;&#x6301;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#x800C;&#x975E;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x3002;&#x82E5;supervisor&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;&#x5219;Docker&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x5728;&#x6267;&#x884C;supervisord&#x547D;&#x4EE4;&#x540E;&#x7ACB;&#x5373;Exited.</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">[supervisord]</span></div><div class=\"line\"><span class=\"attr\">nodaemon</span>=<span class=\"literal\">true</span></div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-&#x603B;&#x7ED3;\"><a href=\"#&#x56DB;-&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x56DB;. &#x603B;&#x7ED3;\"></a>&#x56DB;. &#x603B;&#x7ED3;</h2><p>&#x4F7F;&#x7528;Shell&#x811A;&#x672C;&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x4F18;&#x52BF;&#x662F;&#x5927;&#x5BB6;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;&#x7531;&#x4E8E;&#x9700;&#x8981;&#x4FDD;&#x6301;Docker&#x5BB9;&#x5668;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x59CB;&#x7EC8;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;&#x82E5;&#x8981;&#x5B9E;&#x73B0;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x3002;</p>\n<p>&#x4F7F;&#x7528;supervisor&#x8FD0;&#x884C;&#x591A;&#x8FDB;&#x7A0B;Docker&#x5BB9;&#x5668;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4FDD;&#x6301;1&#x53F7;&#x8FDB;&#x7A0B;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#xFF0C;&#x4EE5;&#x53CA;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x540E;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#xFF0C;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;</p>\n<h4 id=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x591A;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\">kiwenlau/single-kubernetes-docker</a></li>\n</ul>\n<p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x6211;&#x5728;Ubuntu&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x5355;&#x673A;&#x7248;Kubernetes&#x7684;&#x67B6;&#x6784;&#x3002;&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4E00;&#x5171;&#x8FD0;&#x884C;&#x4E86;7&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Kubernetes&#x7684;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png\" width=\"500\"></p>\n<h4 id=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"><a href=\"#&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes\"></a><strong>&#x4F7F;&#x7528;&#x5355;&#x4E2A;Docker&#x5BB9;&#x5668;&#x8FD0;&#x884C;Kubernetes</strong></h4><p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-shell\">kiwenlau/kubernetes-shell</a></li>\n<li><a href=\"https://github.com/kiwenlau/kubernetes-supervisor\">kiwenlau/kubernetes-supervisor</a></li>\n</ul>\n<p>&#x8BE5;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;kubernetes&#x7684;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#xFF1A;etcd, controller manager, apiserver, scheduler, kubelet, proxy&#x4EE5;&#x53CA;docker daemon&#x5747;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x4E4B;&#x4E2D;&#x3002;</p>\n<p>&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x7531;shell&#x811A;&#x672C;&#x6216;&#x8005;supervisor&#x542F;&#x52A8;&#x3002;</p>\n<p><img src=\"/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png\" width=\"500\"></p>\n<h2 id=\"&#x53C2;&#x8003;\"><a href=\"#&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;\"></a>&#x53C2;&#x8003;</h2><ol>\n<li><a href=\"https://docs.docker.com/engine/articles/using_supervisord/\">Using Supervisor with Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps\">How To Install and Manage Supervisor on Ubuntu and Debian VPS</a></li>\n<li><a href=\"http://kiwenlau.com/2015/11/28/151128-single-kubernetes-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Kuberntes</a></li>\n<li><a href=\"https://github.com/kiwenlau/single-kubernetes-docker\">kiwenlau/single-kubernetes-docker</a></li>\n</ol>"},{"title":"Run Hadoop Cluster in Docker Update","date":"2016-06-26T02:00:00.000Z","_content":"\n**Abstract:** Last year, I developed [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project, which aims to help user quickly build [Hadoop](http://hadoop.apache.org/) cluster on local host using [Docker](https://www.docker.com/). The project is quite popular with 250+ stars on [GitHub](https://github.com/kiwenlau/hadoop-cluster-docker) and 2500+ pulls on [Docker Hub](https://hub.docker.com/r/kiwenlau/hadoop-master/). In this blog, I'd like to introduce the update version.\n\n<!-- more -->\n\n- Author: [KiwenLau](http://kiwenlau.com/)\n- Date: [2016-06-26](http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/)\n\n## Introduction\n\nBy packaging [Hadoop](http://hadoop.apache.org/) into [Docker](https://www.docker.com/) image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:\n\n- How to configure Hadoop cluster correctly?\n- How to run word count application?\n- How to manage HDFS?\n- How to run test program on local host?\n\nFollowing figure shows the architecture of [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(**HDFS**), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(**YARN**). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. \n\n<img src=\"hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width = \"500\"/>\n\nIn the old version, I use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don't need to use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) any more. We can create a independent network for Hadoop cluster using following command:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\nBy using \"--net=hadoop\" option when we start Hadoop containers, these containers will attach to the \"hadoop\" network and they are able to communicate with container name.\n\n**Key points of update：**\n\n- eliminate [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) \n- merge master and slave image\n- install Hadoop using [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n- simplify Hadoop configuration\n\n## 3 Nodes Hadoop Cluster\n\n#### **1. pull docker image**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. clone github repository**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. create hadoop network**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh\n```\n\n**output:**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n- start 3 containers with 1 master and 2 slaves\n- you will get into the /root directory of hadoop-master container\n\n#### **5. start hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. run wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**output**\n\n```\ninput file1.txt:\nHello Hadoop\n\ninput file2.txt:\nHello Docker\n\nwordcount output:\nDocker    1\nHadoop    1\nHello    2\n```\n\n## Arbitrary size Hadoop cluster\n\n#### **1. pull docker images and clone github repository**\n\ndo 1~3 like previous section\n\n#### **2. rebuild docker image**\n\n```\nsudo ./resize-cluster.sh 5\n```\n- specify parameter > 1: 2, 3..\n- this script just rebuild hadoop image with different **slaves** file, which pecifies the name of all slave nodes\n\n\n#### **3. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh 5\n```\n- use the same parameter as the step 2\n\n#### **4. run hadoop cluster** \n\ndo 5~6 like previous section\n\n## References\n\n1. [Quickly build arbitrary size Hadoop Cluster based on Docker](http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","source":"_posts/2016/06/26/hadoop-cluster-docker-update-english.md","raw":"title: Run Hadoop Cluster in Docker Update\n\ndate: 2016-06-26 10:00\n\ntags: [Docker, Hadoop]\n\n---\n\n**Abstract:** Last year, I developed [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project, which aims to help user quickly build [Hadoop](http://hadoop.apache.org/) cluster on local host using [Docker](https://www.docker.com/). The project is quite popular with 250+ stars on [GitHub](https://github.com/kiwenlau/hadoop-cluster-docker) and 2500+ pulls on [Docker Hub](https://hub.docker.com/r/kiwenlau/hadoop-master/). In this blog, I'd like to introduce the update version.\n\n<!-- more -->\n\n- Author: [KiwenLau](http://kiwenlau.com/)\n- Date: [2016-06-26](http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/)\n\n## Introduction\n\nBy packaging [Hadoop](http://hadoop.apache.org/) into [Docker](https://www.docker.com/) image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:\n\n- How to configure Hadoop cluster correctly?\n- How to run word count application?\n- How to manage HDFS?\n- How to run test program on local host?\n\nFollowing figure shows the architecture of [kiwenlau/hadoop-cluster-docker](https://github.com/kiwenlau/hadoop-cluster-docker) project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(**HDFS**), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(**YARN**). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. \n\n<img src=\"hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width = \"500\"/>\n\nIn the old version, I use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don't need to use [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) any more. We can create a independent network for Hadoop cluster using following command:\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\nBy using \"--net=hadoop\" option when we start Hadoop containers, these containers will attach to the \"hadoop\" network and they are able to communicate with container name.\n\n**Key points of update：**\n\n- eliminate [serf](https://www.serfdom.io/)/[dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) \n- merge master and slave image\n- install Hadoop using [kiwenlau/compile-hadoop](https://github.com/kiwenlau/compile-hadoop)\n- simplify Hadoop configuration\n\n## 3 Nodes Hadoop Cluster\n\n#### **1. pull docker image**\n\n```\nsudo docker pull kiwenlau/hadoop:1.0\n```\n\n#### **2. clone github repository**\n\n```\ngit clone https://github.com/kiwenlau/hadoop-cluster-docker\n```\n\n#### **3. create hadoop network**\n\n```\nsudo docker network create --driver=bridge hadoop\n```\n\n#### **4. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh\n```\n\n**output:**\n\n```\nstart hadoop-master container...\nstart hadoop-slave1 container...\nstart hadoop-slave2 container...\nroot@hadoop-master:~# \n```\n- start 3 containers with 1 master and 2 slaves\n- you will get into the /root directory of hadoop-master container\n\n#### **5. start hadoop**\n\n```\n./start-hadoop.sh\n```\n\n#### **6. run wordcount**\n\n```\n./run-wordcount.sh\n```\n\n**output**\n\n```\ninput file1.txt:\nHello Hadoop\n\ninput file2.txt:\nHello Docker\n\nwordcount output:\nDocker    1\nHadoop    1\nHello    2\n```\n\n## Arbitrary size Hadoop cluster\n\n#### **1. pull docker images and clone github repository**\n\ndo 1~3 like previous section\n\n#### **2. rebuild docker image**\n\n```\nsudo ./resize-cluster.sh 5\n```\n- specify parameter > 1: 2, 3..\n- this script just rebuild hadoop image with different **slaves** file, which pecifies the name of all slave nodes\n\n\n#### **3. start container**\n\n```\ncd hadoop-cluster-docker\nsudo ./start-container.sh 5\n```\n- use the same parameter as the step 2\n\n#### **4. run hadoop cluster** \n\ndo 5~6 like previous section\n\n## References\n\n1. [Quickly build arbitrary size Hadoop Cluster based on Docker](http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html)\n2. [How to Install Hadoop on Ubuntu 13.10](https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10)\n\n","slug":"2016/06/26/hadoop-cluster-docker-update-english","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweme000dmkfyd6cr8gze","content":"<p><strong>Abstract:</strong> Last year, I developed <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a> project, which aims to help user quickly build <a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a> cluster on local host using <a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>. The project is quite popular with 250+ stars on <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">GitHub</a> and 2500+ pulls on <a href=\"https://hub.docker.com/r/kiwenlau/hadoop-master/\" target=\"_blank\" rel=\"external\">Docker Hub</a>. In this blog, I&#x2019;d like to introduce the update version.</p>\n<a id=\"more\"></a>\n<ul>\n<li>Author: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>Date: <a href=\"http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/\">2016-06-26</a></li>\n</ul>\n<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>By packaging <a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a> into <a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a> image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:</p>\n<ul>\n<li>How to configure Hadoop cluster correctly?</li>\n<li>How to run word count application?</li>\n<li>How to manage HDFS?</li>\n<li>How to run test program on local host?</li>\n</ul>\n<p>Following figure shows the architecture of <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\" target=\"_blank\" rel=\"external\">kiwenlau/hadoop-cluster-docker</a> project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(<strong>HDFS</strong>), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(<strong>YARN</strong>). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. </p>\n<p><img src=\"/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>In the old version, I use <a href=\"https://www.serfdom.io/\" target=\"_blank\" rel=\"external\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\" target=\"_blank\" rel=\"external\">dnsmasq</a> to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don&#x2019;t need to use <a href=\"https://www.serfdom.io/\" target=\"_blank\" rel=\"external\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\" target=\"_blank\" rel=\"external\">dnsmasq</a> any more. We can create a independent network for Hadoop cluster using following command:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>By using &#x201C;&#x2013;net=hadoop&#x201D; option when we start Hadoop containers, these containers will attach to the &#x201C;hadoop&#x201D; network and they are able to communicate with container name.</p>\n<p><strong>Key points of update&#xFF1A;</strong></p>\n<ul>\n<li>eliminate <a href=\"https://www.serfdom.io/\" target=\"_blank\" rel=\"external\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\" target=\"_blank\" rel=\"external\">dnsmasq</a> </li>\n<li>merge master and slave image</li>\n<li>install Hadoop using <a href=\"https://github.com/kiwenlau/compile-hadoop\" target=\"_blank\" rel=\"external\">kiwenlau/compile-hadoop</a></li>\n<li>simplify Hadoop configuration</li>\n</ul>\n<h2 id=\"3-Nodes-Hadoop-Cluster\"><a href=\"#3-Nodes-Hadoop-Cluster\" class=\"headerlink\" title=\"3 Nodes Hadoop Cluster\"></a>3 Nodes Hadoop Cluster</h2><h4 id=\"1-pull-docker-image\"><a href=\"#1-pull-docker-image\" class=\"headerlink\" title=\"1. pull docker image\"></a><strong>1. pull docker image</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-clone-github-repository\"><a href=\"#2-clone-github-repository\" class=\"headerlink\" title=\"2. clone github repository\"></a><strong>2. clone github repository</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-create-hadoop-network\"><a href=\"#3-create-hadoop-network\" class=\"headerlink\" title=\"3. create hadoop network\"></a><strong>3. create hadoop network</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-start-container\"><a href=\"#4-start-container\" class=\"headerlink\" title=\"4. start container\"></a><strong>4. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>output:</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>start 3 containers with 1 master and 2 slaves</li>\n<li>you will get into the /root directory of hadoop-master container</li>\n</ul>\n<h4 id=\"5-start-hadoop\"><a href=\"#5-start-hadoop\" class=\"headerlink\" title=\"5. start hadoop\"></a><strong>5. start hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-run-wordcount\"><a href=\"#6-run-wordcount\" class=\"headerlink\" title=\"6. run wordcount\"></a><strong>6. run wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>output</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\"></div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker    <span class=\"number\">1</span></div><div class=\"line\">Hadoop    <span class=\"number\">1</span></div><div class=\"line\">Hello    <span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<h2 id=\"Arbitrary-size-Hadoop-cluster\"><a href=\"#Arbitrary-size-Hadoop-cluster\" class=\"headerlink\" title=\"Arbitrary size Hadoop cluster\"></a>Arbitrary size Hadoop cluster</h2><h4 id=\"1-pull-docker-images-and-clone-github-repository\"><a href=\"#1-pull-docker-images-and-clone-github-repository\" class=\"headerlink\" title=\"1. pull docker images and clone github repository\"></a><strong>1. pull docker images and clone github repository</strong></h4><p>do 1~3 like previous section</p>\n<h4 id=\"2-rebuild-docker-image\"><a href=\"#2-rebuild-docker-image\" class=\"headerlink\" title=\"2. rebuild docker image\"></a><strong>2. rebuild docker image</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>specify parameter &gt; 1: 2, 3..</li>\n<li>this script just rebuild hadoop image with different <strong>slaves</strong> file, which pecifies the name of all slave nodes</li>\n</ul>\n<h4 id=\"3-start-container\"><a href=\"#3-start-container\" class=\"headerlink\" title=\"3. start container\"></a><strong>3. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>use the same parameter as the step 2</li>\n</ul>\n<h4 id=\"4-run-hadoop-cluster\"><a href=\"#4-run-hadoop-cluster\" class=\"headerlink\" title=\"4. run hadoop cluster\"></a><strong>4. run hadoop cluster</strong></h4><p>do 5~6 like previous section</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ol>\n<li><a href=\"http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html\" target=\"_blank\" rel=\"external\">Quickly build arbitrary size Hadoop Cluster based on Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\" target=\"_blank\" rel=\"external\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>\n","excerpt":"<p><strong>Abstract:</strong> Last year, I developed <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">kiwenlau/hadoop-cluster-docker</a> project, which aims to help user quickly build <a href=\"http://hadoop.apache.org/\">Hadoop</a> cluster on local host using <a href=\"https://www.docker.com/\">Docker</a>. The project is quite popular with 250+ stars on <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">GitHub</a> and 2500+ pulls on <a href=\"https://hub.docker.com/r/kiwenlau/hadoop-master/\">Docker Hub</a>. In this blog, I&#x2019;d like to introduce the update version.</p>","more":"<ul>\n<li>Author: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>Date: <a href=\"http://kiwenlau.com/2016/06/26/hadoop-cluster-docker-update-english/\">2016-06-26</a></li>\n</ul>\n<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>By packaging <a href=\"http://hadoop.apache.org/\">Hadoop</a> into <a href=\"https://www.docker.com/\">Docker</a> image, we can easily build a Hadoop cluster within Docker containers on local host. This is very help for beginners, who want to learn:</p>\n<ul>\n<li>How to configure Hadoop cluster correctly?</li>\n<li>How to run word count application?</li>\n<li>How to manage HDFS?</li>\n<li>How to run test program on local host?</li>\n</ul>\n<p>Following figure shows the architecture of <a href=\"https://github.com/kiwenlau/hadoop-cluster-docker\">kiwenlau/hadoop-cluster-docker</a> project. Hadoop master and slaves run within different Docker containers, NameNode and ResourceManager run within hadoop-master container while DataNode and NodeManager run within hadoop-slave container. NameNode and DataNode are the components of Hadoop Distributed File System(<strong>HDFS</strong>), while ResourceManager and NodeManager are the components of Hadoop cluster resource management system called Yet Another Resource Manager(<strong>YARN</strong>). HDFS is in charge of storing input and output data, while YARN is in charge of managing CPU and Memory resources. </p>\n<p><img src=\"/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png\" width=\"500\"></p>\n<p>In the old version, I use <a href=\"https://www.serfdom.io/\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">dnsmasq</a> to provide DNS service for Hadoop cluster, which is not an elegant solution because it requires extra installation/configuration and it will delay the cluster startup procedure. Thanks to the enhancement of Docker network function, we don&#x2019;t need to use <a href=\"https://www.serfdom.io/\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">dnsmasq</a> any more. We can create a independent network for Hadoop cluster using following command:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<p>By using &#x201C;&#x2013;net=hadoop&#x201D; option when we start Hadoop containers, these containers will attach to the &#x201C;hadoop&#x201D; network and they are able to communicate with container name.</p>\n<p><strong>Key points of update&#xFF1A;</strong></p>\n<ul>\n<li>eliminate <a href=\"https://www.serfdom.io/\">serf</a>/<a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">dnsmasq</a> </li>\n<li>merge master and slave image</li>\n<li>install Hadoop using <a href=\"https://github.com/kiwenlau/compile-hadoop\">kiwenlau/compile-hadoop</a></li>\n<li>simplify Hadoop configuration</li>\n</ul>\n<h2 id=\"3-Nodes-Hadoop-Cluster\"><a href=\"#3-Nodes-Hadoop-Cluster\" class=\"headerlink\" title=\"3 Nodes Hadoop Cluster\"></a>3 Nodes Hadoop Cluster</h2><h4 id=\"1-pull-docker-image\"><a href=\"#1-pull-docker-image\" class=\"headerlink\" title=\"1. pull docker image\"></a><strong>1. pull docker image</strong></h4><figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">hadoop:</span><span class=\"number\">1.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-clone-github-repository\"><a href=\"#2-clone-github-repository\" class=\"headerlink\" title=\"2. clone github repository\"></a><strong>2. clone github repository</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/hadoop-cluster-docker</div></pre></td></tr></table></figure>\n<h4 id=\"3-create-hadoop-network\"><a href=\"#3-create-hadoop-network\" class=\"headerlink\" title=\"3. create hadoop network\"></a><strong>3. create hadoop network</strong></h4><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker network <span class=\"built_in\">create</span> <span class=\"comment\">--driver=bridge hadoop</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-start-container\"><a href=\"#4-start-container\" class=\"headerlink\" title=\"4. start container\"></a><strong>4. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span></div></pre></td></tr></table></figure>\n<p><strong>output:</strong></p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"literal\">start</span> hadoop-<span class=\"keyword\">master</span> <span class=\"title\">container</span>...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave1 container...</div><div class=\"line\"><span class=\"literal\">start</span> hadoop-slave2 container...</div><div class=\"line\">root@hadoop-<span class=\"literal\">master</span>:~<span class=\"comment\">#</span></div></pre></td></tr></table></figure>\n<ul>\n<li>start 3 containers with 1 master and 2 slaves</li>\n<li>you will get into the /root directory of hadoop-master container</li>\n</ul>\n<h4 id=\"5-start-hadoop\"><a href=\"#5-start-hadoop\" class=\"headerlink\" title=\"5. start hadoop\"></a><strong>5. start hadoop</strong></h4><figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"literal\">start</span>-hadoop.sh</div></pre></td></tr></table></figure>\n<h4 id=\"6-run-wordcount\"><a href=\"#6-run-wordcount\" class=\"headerlink\" title=\"6. run wordcount\"></a><strong>6. run wordcount</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">./<span class=\"keyword\">run</span><span class=\"bash\">-wordcount.sh</span></div></pre></td></tr></table></figure>\n<p><strong>output</strong></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">input</span> file1<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Hadoop</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-tag\">input</span> file2<span class=\"selector-class\">.txt</span>:</div><div class=\"line\">Hello Docker</div><div class=\"line\"></div><div class=\"line\">wordcount output:</div><div class=\"line\">Docker    <span class=\"number\">1</span></div><div class=\"line\">Hadoop    <span class=\"number\">1</span></div><div class=\"line\">Hello    <span class=\"number\">2</span></div></pre></td></tr></table></figure>\n<h2 id=\"Arbitrary-size-Hadoop-cluster\"><a href=\"#Arbitrary-size-Hadoop-cluster\" class=\"headerlink\" title=\"Arbitrary size Hadoop cluster\"></a>Arbitrary size Hadoop cluster</h2><h4 id=\"1-pull-docker-images-and-clone-github-repository\"><a href=\"#1-pull-docker-images-and-clone-github-repository\" class=\"headerlink\" title=\"1. pull docker images and clone github repository\"></a><strong>1. pull docker images and clone github repository</strong></h4><p>do 1~3 like previous section</p>\n<h4 id=\"2-rebuild-docker-image\"><a href=\"#2-rebuild-docker-image\" class=\"headerlink\" title=\"2. rebuild docker image\"></a><strong>2. rebuild docker image</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./resize-<span class=\"keyword\">cluster</span>.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>specify parameter &gt; 1: 2, 3..</li>\n<li>this script just rebuild hadoop image with different <strong>slaves</strong> file, which pecifies the name of all slave nodes</li>\n</ul>\n<h4 id=\"3-start-container\"><a href=\"#3-start-container\" class=\"headerlink\" title=\"3. start container\"></a><strong>3. start container</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">cd</span> hadoop-<span class=\"keyword\">cluster</span>-docker</div><div class=\"line\">sudo ./start-container.<span class=\"keyword\">sh</span> 5</div></pre></td></tr></table></figure>\n<ul>\n<li>use the same parameter as the step 2</li>\n</ul>\n<h4 id=\"4-run-hadoop-cluster\"><a href=\"#4-run-hadoop-cluster\" class=\"headerlink\" title=\"4. run hadoop cluster\"></a><strong>4. run hadoop cluster</strong></h4><p>do 5~6 like previous section</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ol>\n<li><a href=\"http://kiwenlau.blogspot.jp/2015/05/quickly-build-arbitrary-size-hadoop.html\">Quickly build arbitrary size Hadoop Cluster based on Docker</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-on-ubuntu-13-10\">How to Install Hadoop on Ubuntu 13.10</a></li>\n</ol>"},{"title":"基于Docker搭建多节点Mesos/Marathon","date":"2016-07-10T02:00:00.000Z","_content":"\n**摘要:** 在之前的一篇博客中，我介绍了[基于Docker搭建单机版Mesos/Marathon](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)，但是仅仅使用了单个节点。而在这篇博客中，我将介绍[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)，开发者可以使用3个节点快速地搭建一个真正的分布式容器集群系统。**服务发现**和**负载均衡**是容器集群必不可少的功能，我选择了[Marathon LB](https://github.com/mesosphere/marathon-lb)来实现。\n\n**GitHub地址:** [kiwenlau/mesos-marathon-platform](https://github.com/kiwenlau/mesos-marathon-platform)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-10](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)\n\n<img src=\"mesos-marathon-platform/mesos-marathon-platform.png\" width = \"500\"/>\n\n## 一. Mesos/Marathon简介\n\n#### **1. Mesos**\n\n[Mesos](http://mesos.apache.org/)是**分布式集群资源管理系统**，负责调度集群内的CPU，内存以及磁盘等资源。Hadoop MapReduce, Spark以及Storm等**分布式计算框架**很流行，但是为每一个计算框架搭建单独的集群非常地浪费资源，也无法实现数据共享，而Mesos的设计初衷就是让不同的**分布式计算框架**能够共享一个集群。\n\nMesos资源调度算法分为两个层次: Mesos监控集群的空余资源，并将空余资源按照一定规则分配给各个计算框架；而各个计算框架会根据需要选择接受或者拒绝所分配的资源。这时，Mesos与各个计算框架都参与了资源的调度: Mesos负责分配资源; 而计算框架接受或者拒绝资源。因此，Mesos的责任非常清晰而且简单：分配集群资源。Mesos的双层调度算法提高了可扩展性，并且可以更方便地支持不同的计算框架。\n\n目前主流的集群资源管理系统还有Hadoop YARN，Kubernetes以及Swarm。Hadoop YARN目前仅适合运行分布式计算框架例如Spark；Kubernetes与Swarm仅适合运行容器应用；而Mesos对分布式计算框架以及容器应用的支持都很成熟。并且，Kubernetes与Swarm可以作为计算框架运行在Mesos之上。Kubernetes的功能强大，但是有些过度设计导致复杂度很高，而Swarm的设计简单很多但是功能相对缺乏，大家可以根据需要选择。个人认为，**使用Mesos的话，最好选择Marathon作为容器编排系统**，架构非常简单，且功能丰富。\n\n#### **2. Marathon**\n\n[Marathon](https://mesosphere.github.io/marathon/)是容器编排系统，是运行于Mesos之上的众多计算框架之一。用户可以通过Marathon提交，监控并调度容器应用，然后Mesos负责运行容器。另外，[Aurora](http://aurora.apache.org/)与Marathon功能一致，同为容器编排系统。相比而言，Marathon的架构比Aurora更简单，没有从节点，且对[Docker](https://www.docker.com/)的支持更为完善。Marathon由Mesosphere公司负责开发，社区很活跃，文档也很完善。\n\nMarathon具有**容错功能**：当容器由于节点崩溃等原因意外停止运行时，Marathon会自动将容器调度到其他节点。这一点类似进程管理工具例如[Supervisor](http://supervisord.org/)：当进程意外退出时，Supervisor会重启进程。然而，自动容错功能并不适合有状态服务，即带有数据卷(volume)的容器，例如MongoDB与MySQL。因为数据很难跨节点移动，目前的技术还不够成熟。因此，**Marathon目前仅适合运行无状态的服务，而数据库等有状态服务应该单独部署**。这样做也可以提高数据的安全性。\n\n#### **3. Marathon LB**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**与**负载均衡**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n当使用Marathon部署容器时，容器运行的节点(IP)与使用的端口(PORT)是Mesos/Marathon平台负责调度的，无法事先确定。这样的话，每次访问服务时，需要手动去查询容器运行的IP与PORT。并且，容器出错时会发生重新调度，IP与PORT会变化。因此，访问服务会非常不方便。通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP，这样每次部署服务时，IP与PORT是固定的，就方便很多了。Marathon LB会监听Marathon的调度事件，获取容器运行的IP与PORT，然后更新代理服务器Haproxy的配置文件。因此，当部署新的容器或者容器发生变化时，仍然可以通过固定的IP与PORT访问该容器。这就是所谓的**服务发现**。\n\n同一个服务往往对应着多个容器副本，Marathon LB作为代理服务器，同时实现了**负载均衡**的功能。服务请求能够使用Round Robin方式发送给各个容器。\n                           \n## 二. 搭建步骤\n\n#### **1. 创建虚拟机**\n\n按照[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以快速地在单个机器上创建Mesos/Marathon平台运行所需要的3个虚拟机节点。\n\n其中，node1为主机点(Master)，运行zookeeper, mesos_master, marathon以及marathon-lb容器; node2与node3为从节点(Slave)，运行mesos_slave容器；使用marathon部署nginx时，nginx容器运行在从节点上。如下表所示:\n\n| 节点    | IP           | 运行的容器                                      |\n|:------- |:-------------| :----------------------------------------------|\n| node1  | 192.168.59.1 | zookeeper, mesos_master, marathon, marathon-lb |\n| node2  | 192.168.59.2 | mesos_slave1, nginx                                   |\n| node3  | 192.168.59.3 | mesos_slave2, nginx                                   |\n\n#### **2. 开启Docker daemon的监听端口**\n\n因为**start-containers.sh**使用了远程启动容器的方式，因此需要开启Docker daemon的TCP监听端口。提醒一下，**开启Docker daemon端口是不安全的**，生产环境中不能打开，或者做好防火墙配置。不希望开启Docker daemon的监听端口的话，可以使用start-containers.sh中的命令直接运行容器，只是稍微麻烦一点。\n\nMaster, Slave1和Slave2:\n\n```\nsudo vim /etc/default/docker\n```\n\n修改**DOCKER_OPTS**\n\n```\nDOCKER_OPTS=\"-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n```\n\n重启Docker\n\n```\nsudo restart docker\n```\n\n#### **3. 下载Docker镜像** \n\nMaster:\n\n```\nsudo docker pull kiwenlau/zookeeper:3.4.8 \nsudo docker pull kiwenlau/mesos:0.26.0 \nsudo docker pull kiwenlau/marathon:1.1.1  \nsudo docker pull kiwenlau/marathonlb:1.3.0\n```\n\nSlave1 和 Slave2:\n\n```\nsudo docker pull kiwenlau/mesos:0.26.0\n```\n\n#### **4. 下载GitHub仓库** \n\nMaster:\n\n```\ngit clone https://github.com/kiwenlau/mesos-marathon-platform\n```\n\n\n#### **5. 运行容器** \n\nMaster:\n\n```\ncd mesos-marathon-platform\nsudo ./start-containers.sh\n```\n\n网页管理:\n\n- Mesos: [http://192.168.59.1:5050/](http://192.168.59.1:5050/)\n- Marathon: [http://192.168.59.1:8080/](http://192.168.59.1:8080/)  \n\n\n如果需要增加Slave节点，或者配置不同的节点IP，仅需修改start-contaniers.sh脚本中以下内容：\n\n```\nMASTER_IP=192.168.59.1\nSLAVE_IP=(192.168.59.2 192.168.59.3)\n```\n\n#### **6. 运行Nginx:** \n\n下载nginx镜像(Slave1和Slave2):\n\n```\nsudo docker pull nginx:1.10\n```\n\n运行Nginx(Master):\n\n```\nsudo ./run-nginx.sh \n```\n\nNginx的的定义如下(nginx.json):\n\n```\n{\n    \"id\": \"nginx\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 2,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，servicePort表示nginx绑定的端口为**10000**，而marathon-lb容器运行的节点IP为**192.168.59.1**。因此nginx的访问地址为：\n\n- [http://192.168.59.1:10000/](http://192.168.59.1:10000/)\n\n而实际上，两个nginx容器运行在Slave节点上，且端口是随机分配的。\n\n\n## 三. 参考\n\n1. [Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center](http://mesos.berkeley.edu/mesos_tech_report.pdf)\n","source":"_posts/2016/07/10/mesos-marathon-platform.md","raw":"title: 基于Docker搭建多节点Mesos/Marathon\n\ndate: 2016-07-10 10:00\n\ntags: [Docker, Mesos, Marathon]\n\n---\n\n**摘要:** 在之前的一篇博客中，我介绍了[基于Docker搭建单机版Mesos/Marathon](http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/)，但是仅仅使用了单个节点。而在这篇博客中，我将介绍[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)，开发者可以使用3个节点快速地搭建一个真正的分布式容器集群系统。**服务发现**和**负载均衡**是容器集群必不可少的功能，我选择了[Marathon LB](https://github.com/mesosphere/marathon-lb)来实现。\n\n**GitHub地址:** [kiwenlau/mesos-marathon-platform](https://github.com/kiwenlau/mesos-marathon-platform)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-10](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)\n\n<img src=\"mesos-marathon-platform/mesos-marathon-platform.png\" width = \"500\"/>\n\n## 一. Mesos/Marathon简介\n\n#### **1. Mesos**\n\n[Mesos](http://mesos.apache.org/)是**分布式集群资源管理系统**，负责调度集群内的CPU，内存以及磁盘等资源。Hadoop MapReduce, Spark以及Storm等**分布式计算框架**很流行，但是为每一个计算框架搭建单独的集群非常地浪费资源，也无法实现数据共享，而Mesos的设计初衷就是让不同的**分布式计算框架**能够共享一个集群。\n\nMesos资源调度算法分为两个层次: Mesos监控集群的空余资源，并将空余资源按照一定规则分配给各个计算框架；而各个计算框架会根据需要选择接受或者拒绝所分配的资源。这时，Mesos与各个计算框架都参与了资源的调度: Mesos负责分配资源; 而计算框架接受或者拒绝资源。因此，Mesos的责任非常清晰而且简单：分配集群资源。Mesos的双层调度算法提高了可扩展性，并且可以更方便地支持不同的计算框架。\n\n目前主流的集群资源管理系统还有Hadoop YARN，Kubernetes以及Swarm。Hadoop YARN目前仅适合运行分布式计算框架例如Spark；Kubernetes与Swarm仅适合运行容器应用；而Mesos对分布式计算框架以及容器应用的支持都很成熟。并且，Kubernetes与Swarm可以作为计算框架运行在Mesos之上。Kubernetes的功能强大，但是有些过度设计导致复杂度很高，而Swarm的设计简单很多但是功能相对缺乏，大家可以根据需要选择。个人认为，**使用Mesos的话，最好选择Marathon作为容器编排系统**，架构非常简单，且功能丰富。\n\n#### **2. Marathon**\n\n[Marathon](https://mesosphere.github.io/marathon/)是容器编排系统，是运行于Mesos之上的众多计算框架之一。用户可以通过Marathon提交，监控并调度容器应用，然后Mesos负责运行容器。另外，[Aurora](http://aurora.apache.org/)与Marathon功能一致，同为容器编排系统。相比而言，Marathon的架构比Aurora更简单，没有从节点，且对[Docker](https://www.docker.com/)的支持更为完善。Marathon由Mesosphere公司负责开发，社区很活跃，文档也很完善。\n\nMarathon具有**容错功能**：当容器由于节点崩溃等原因意外停止运行时，Marathon会自动将容器调度到其他节点。这一点类似进程管理工具例如[Supervisor](http://supervisord.org/)：当进程意外退出时，Supervisor会重启进程。然而，自动容错功能并不适合有状态服务，即带有数据卷(volume)的容器，例如MongoDB与MySQL。因为数据很难跨节点移动，目前的技术还不够成熟。因此，**Marathon目前仅适合运行无状态的服务，而数据库等有状态服务应该单独部署**。这样做也可以提高数据的安全性。\n\n#### **3. Marathon LB**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**与**负载均衡**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n当使用Marathon部署容器时，容器运行的节点(IP)与使用的端口(PORT)是Mesos/Marathon平台负责调度的，无法事先确定。这样的话，每次访问服务时，需要手动去查询容器运行的IP与PORT。并且，容器出错时会发生重新调度，IP与PORT会变化。因此，访问服务会非常不方便。通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP，这样每次部署服务时，IP与PORT是固定的，就方便很多了。Marathon LB会监听Marathon的调度事件，获取容器运行的IP与PORT，然后更新代理服务器Haproxy的配置文件。因此，当部署新的容器或者容器发生变化时，仍然可以通过固定的IP与PORT访问该容器。这就是所谓的**服务发现**。\n\n同一个服务往往对应着多个容器副本，Marathon LB作为代理服务器，同时实现了**负载均衡**的功能。服务请求能够使用Round Robin方式发送给各个容器。\n                           \n## 二. 搭建步骤\n\n#### **1. 创建虚拟机**\n\n按照[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以快速地在单个机器上创建Mesos/Marathon平台运行所需要的3个虚拟机节点。\n\n其中，node1为主机点(Master)，运行zookeeper, mesos_master, marathon以及marathon-lb容器; node2与node3为从节点(Slave)，运行mesos_slave容器；使用marathon部署nginx时，nginx容器运行在从节点上。如下表所示:\n\n| 节点    | IP           | 运行的容器                                      |\n|:------- |:-------------| :----------------------------------------------|\n| node1  | 192.168.59.1 | zookeeper, mesos_master, marathon, marathon-lb |\n| node2  | 192.168.59.2 | mesos_slave1, nginx                                   |\n| node3  | 192.168.59.3 | mesos_slave2, nginx                                   |\n\n#### **2. 开启Docker daemon的监听端口**\n\n因为**start-containers.sh**使用了远程启动容器的方式，因此需要开启Docker daemon的TCP监听端口。提醒一下，**开启Docker daemon端口是不安全的**，生产环境中不能打开，或者做好防火墙配置。不希望开启Docker daemon的监听端口的话，可以使用start-containers.sh中的命令直接运行容器，只是稍微麻烦一点。\n\nMaster, Slave1和Slave2:\n\n```\nsudo vim /etc/default/docker\n```\n\n修改**DOCKER_OPTS**\n\n```\nDOCKER_OPTS=\"-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n```\n\n重启Docker\n\n```\nsudo restart docker\n```\n\n#### **3. 下载Docker镜像** \n\nMaster:\n\n```\nsudo docker pull kiwenlau/zookeeper:3.4.8 \nsudo docker pull kiwenlau/mesos:0.26.0 \nsudo docker pull kiwenlau/marathon:1.1.1  \nsudo docker pull kiwenlau/marathonlb:1.3.0\n```\n\nSlave1 和 Slave2:\n\n```\nsudo docker pull kiwenlau/mesos:0.26.0\n```\n\n#### **4. 下载GitHub仓库** \n\nMaster:\n\n```\ngit clone https://github.com/kiwenlau/mesos-marathon-platform\n```\n\n\n#### **5. 运行容器** \n\nMaster:\n\n```\ncd mesos-marathon-platform\nsudo ./start-containers.sh\n```\n\n网页管理:\n\n- Mesos: [http://192.168.59.1:5050/](http://192.168.59.1:5050/)\n- Marathon: [http://192.168.59.1:8080/](http://192.168.59.1:8080/)  \n\n\n如果需要增加Slave节点，或者配置不同的节点IP，仅需修改start-contaniers.sh脚本中以下内容：\n\n```\nMASTER_IP=192.168.59.1\nSLAVE_IP=(192.168.59.2 192.168.59.3)\n```\n\n#### **6. 运行Nginx:** \n\n下载nginx镜像(Slave1和Slave2):\n\n```\nsudo docker pull nginx:1.10\n```\n\n运行Nginx(Master):\n\n```\nsudo ./run-nginx.sh \n```\n\nNginx的的定义如下(nginx.json):\n\n```\n{\n    \"id\": \"nginx\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 2,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，servicePort表示nginx绑定的端口为**10000**，而marathon-lb容器运行的节点IP为**192.168.59.1**。因此nginx的访问地址为：\n\n- [http://192.168.59.1:10000/](http://192.168.59.1:10000/)\n\n而实际上，两个nginx容器运行在Slave节点上，且端口是随机分配的。\n\n\n## 三. 参考\n\n1. [Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center](http://mesos.berkeley.edu/mesos_tech_report.pdf)\n","slug":"2016/07/10/mesos-marathon-platform","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemi000fmkfyfxyxolth","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x4E4B;&#x524D;&#x7684;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon</a>&#xFF0C;&#x4F46;&#x662F;&#x4EC5;&#x4EC5;&#x4F7F;&#x7528;&#x4E86;&#x5355;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x800C;&#x5728;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;3&#x4E2A;&#x8282;&#x70B9;&#x5FEB;&#x901F;&#x5730;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x3002;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x548C;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x4E86;<a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong> <a href=\"https://github.com/kiwenlau/mesos-marathon-platform\" target=\"_blank\" rel=\"external\">kiwenlau/mesos-marathon-platform</a></p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">2016-07-10</a></li>\n</ul>\n<p><img src=\"/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;\"></a>&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;</h2><h4 id=\"1-Mesos\"><a href=\"#1-Mesos\" class=\"headerlink\" title=\"1. Mesos\"></a><strong>1. Mesos</strong></h4><p><a href=\"http://mesos.apache.org/\" target=\"_blank\" rel=\"external\">Mesos</a>&#x662F;<strong>&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x96C6;&#x7FA4;&#x5185;&#x7684;CPU&#xFF0C;&#x5185;&#x5B58;&#x4EE5;&#x53CA;&#x78C1;&#x76D8;&#x7B49;&#x8D44;&#x6E90;&#x3002;Hadoop MapReduce, Spark&#x4EE5;&#x53CA;Storm&#x7B49;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x5F88;&#x6D41;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x642D;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x96C6;&#x7FA4;&#x975E;&#x5E38;&#x5730;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5171;&#x4EAB;&#xFF0C;&#x800C;Mesos&#x7684;&#x8BBE;&#x8BA1;&#x521D;&#x8877;&#x5C31;&#x662F;&#x8BA9;&#x4E0D;&#x540C;&#x7684;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x80FD;&#x591F;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x3002;</p>\n<p>Mesos&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x5C42;&#x6B21;: Mesos&#x76D1;&#x63A7;&#x96C6;&#x7FA4;&#x7684;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x5C06;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x89C4;&#x5219;&#x5206;&#x914D;&#x7ED9;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#xFF1B;&#x800C;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F1A;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x6240;&#x5206;&#x914D;&#x7684;&#x8D44;&#x6E90;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;Mesos&#x4E0E;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x90FD;&#x53C2;&#x4E0E;&#x4E86;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;: Mesos&#x8D1F;&#x8D23;&#x5206;&#x914D;&#x8D44;&#x6E90;; &#x800C;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Mesos&#x7684;&#x8D23;&#x4EFB;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x800C;&#x4E14;&#x7B80;&#x5355;&#xFF1A;&#x5206;&#x914D;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x3002;Mesos&#x7684;&#x53CC;&#x5C42;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x63D0;&#x9AD8;&#x4E86;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x4E3B;&#x6D41;&#x7684;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x8FD8;&#x6709;Hadoop YARN&#xFF0C;Kubernetes&#x4EE5;&#x53CA;Swarm&#x3002;Hadoop YARN&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F8B;&#x5982;Spark&#xFF1B;Kubernetes&#x4E0E;Swarm&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF1B;&#x800C;Mesos&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4EE5;&#x53CA;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x7684;&#x652F;&#x6301;&#x90FD;&#x5F88;&#x6210;&#x719F;&#x3002;&#x5E76;&#x4E14;&#xFF0C;Kubernetes&#x4E0E;Swarm&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x3002;Kubernetes&#x7684;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;&#x5BFC;&#x81F4;&#x590D;&#x6742;&#x5EA6;&#x5F88;&#x9AD8;&#xFF0C;&#x800C;Swarm&#x7684;&#x8BBE;&#x8BA1;&#x7B80;&#x5355;&#x5F88;&#x591A;&#x4F46;&#x662F;&#x529F;&#x80FD;&#x76F8;&#x5BF9;&#x7F3A;&#x4E4F;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x3002;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#xFF0C;<strong>&#x4F7F;&#x7528;Mesos&#x7684;&#x8BDD;&#xFF0C;&#x6700;&#x597D;&#x9009;&#x62E9;Marathon&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x67B6;&#x6784;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4E14;&#x529F;&#x80FD;&#x4E30;&#x5BCC;&#x3002;</p>\n<h4 id=\"2-Marathon\"><a href=\"#2-Marathon\" class=\"headerlink\" title=\"2. Marathon\"></a><strong>2. Marathon</strong></h4><p><a href=\"https://mesosphere.github.io/marathon/\" target=\"_blank\" rel=\"external\">Marathon</a>&#x662F;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#xFF0C;&#x662F;&#x8FD0;&#x884C;&#x4E8E;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x4F17;&#x591A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4E4B;&#x4E00;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Marathon&#x63D0;&#x4EA4;&#xFF0C;&#x76D1;&#x63A7;&#x5E76;&#x8C03;&#x5EA6;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF0C;&#x7136;&#x540E;Mesos&#x8D1F;&#x8D23;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x53E6;&#x5916;&#xFF0C;<a href=\"http://aurora.apache.org/\" target=\"_blank\" rel=\"external\">Aurora</a>&#x4E0E;Marathon&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x540C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#x3002;&#x76F8;&#x6BD4;&#x800C;&#x8A00;&#xFF0C;Marathon&#x7684;&#x67B6;&#x6784;&#x6BD4;Aurora&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x4ECE;&#x8282;&#x70B9;&#xFF0C;&#x4E14;&#x5BF9;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x7684;&#x652F;&#x6301;&#x66F4;&#x4E3A;&#x5B8C;&#x5584;&#x3002;Marathon&#x7531;Mesosphere&#x516C;&#x53F8;&#x8D1F;&#x8D23;&#x5F00;&#x53D1;&#xFF0C;&#x793E;&#x533A;&#x5F88;&#x6D3B;&#x8DC3;&#xFF0C;&#x6587;&#x6863;&#x4E5F;&#x5F88;&#x5B8C;&#x5584;&#x3002;</p>\n<p>Marathon&#x5177;&#x6709;<strong>&#x5BB9;&#x9519;&#x529F;&#x80FD;</strong>&#xFF1A;&#x5F53;&#x5BB9;&#x5668;&#x7531;&#x4E8E;&#x8282;&#x70B9;&#x5D29;&#x6E83;&#x7B49;&#x539F;&#x56E0;&#x610F;&#x5916;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;Marathon&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x5BB9;&#x5668;&#x8C03;&#x5EA6;&#x5230;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x7C7B;&#x4F3C;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x4F8B;&#x5982;<a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"external\">Supervisor</a>&#xFF1A;&#x5F53;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x65F6;&#xFF0C;Supervisor&#x4F1A;&#x91CD;&#x542F;&#x8FDB;&#x7A0B;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x81EA;&#x52A8;&#x5BB9;&#x9519;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#xFF0C;&#x5373;&#x5E26;&#x6709;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F8B;&#x5982;MongoDB&#x4E0E;MySQL&#x3002;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5F88;&#x96BE;&#x8DE8;&#x8282;&#x70B9;&#x79FB;&#x52A8;&#xFF0C;&#x76EE;&#x524D;&#x7684;&#x6280;&#x672F;&#x8FD8;&#x4E0D;&#x591F;&#x6210;&#x719F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>Marathon&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x6570;&#x636E;&#x5E93;&#x7B49;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#x5E94;&#x8BE5;&#x5355;&#x72EC;&#x90E8;&#x7F72;</strong>&#x3002;&#x8FD9;&#x6837;&#x505A;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p>\n<h4 id=\"3-Marathon-LB\"><a href=\"#3-Marathon-LB\" class=\"headerlink\" title=\"3. Marathon LB\"></a><strong>3. Marathon LB</strong></h4><p><a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x4E0E;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\" target=\"_blank\" rel=\"external\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x5F53;&#x4F7F;&#x7528;Marathon&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;(IP)&#x4E0E;&#x4F7F;&#x7528;&#x7684;&#x7AEF;&#x53E3;(PORT)&#x662F;Mesos/Marathon&#x5E73;&#x53F0;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x7684;&#xFF0C;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6BCF;&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5BB9;&#x5668;&#x51FA;&#x9519;&#x65F6;&#x4F1A;&#x53D1;&#x751F;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#xFF0C;IP&#x4E0E;PORT&#x4F1A;&#x53D8;&#x5316;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4F1A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x90E8;&#x7F72;&#x670D;&#x52A1;&#x65F6;&#xFF0C;IP&#x4E0E;PORT&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5C31;&#x65B9;&#x4FBF;&#x5F88;&#x591A;&#x4E86;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x90E8;&#x7F72;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#x6216;&#x8005;&#x5BB9;&#x5668;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;PORT&#x8BBF;&#x95EE;&#x8BE5;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x3002;</p>\n<p>&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5F80;&#x5F80;&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x526F;&#x672C;&#xFF0C;Marathon LB&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7684;&#x529F;&#x80FD;&#x3002;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x80FD;&#x591F;&#x4F7F;&#x7528;Round Robin&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><p>&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x521B;&#x5EFA;Mesos/Marathon&#x5E73;&#x53F0;&#x8FD0;&#x884C;&#x6240;&#x9700;&#x8981;&#x7684;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x8282;&#x70B9;&#x3002;</p>\n<p>&#x5176;&#x4E2D;&#xFF0C;node1&#x4E3A;&#x4E3B;&#x673A;&#x70B9;(Master)&#xFF0C;&#x8FD0;&#x884C;zookeeper, mesos_master, marathon&#x4EE5;&#x53CA;marathon-lb&#x5BB9;&#x5668;; node2&#x4E0E;node3&#x4E3A;&#x4ECE;&#x8282;&#x70B9;(Slave)&#xFF0C;&#x8FD0;&#x884C;mesos_slave&#x5BB9;&#x5668;&#xFF1B;&#x4F7F;&#x7528;marathon&#x90E8;&#x7F72;nginx&#x65F6;&#xFF0C;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;&#x4ECE;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x5982;&#x4E0B;&#x8868;&#x6240;&#x793A;:</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x8282;&#x70B9;</th>\n<th style=\"text-align:left\">IP</th>\n<th style=\"text-align:left\">&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">node1</td>\n<td style=\"text-align:left\">192.168.59.1</td>\n<td style=\"text-align:left\">zookeeper, mesos_master, marathon, marathon-lb</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node2</td>\n<td style=\"text-align:left\">192.168.59.2</td>\n<td style=\"text-align:left\">mesos_slave1, nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node3</td>\n<td style=\"text-align:left\">192.168.59.3</td>\n<td style=\"text-align:left\">mesos_slave2, nginx</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"><a href=\"#2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\" class=\"headerlink\" title=\"2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"></a><strong>2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;</strong></h4><p>&#x56E0;&#x4E3A;<strong>start-containers.sh</strong>&#x4F7F;&#x7528;&#x4E86;&#x8FDC;&#x7A0B;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5F00;&#x542F;Docker daemon&#x7684;TCP&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x3002;&#x63D0;&#x9192;&#x4E00;&#x4E0B;&#xFF0C;<strong>&#x5F00;&#x542F;Docker daemon&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;</strong>&#xFF0C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4E0D;&#x80FD;&#x6253;&#x5F00;&#xFF0C;&#x6216;&#x8005;&#x505A;&#x597D;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x3002;&#x4E0D;&#x5E0C;&#x671B;&#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;start-containers.sh&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x7A0D;&#x5FAE;&#x9EBB;&#x70E6;&#x4E00;&#x70B9;&#x3002;</p>\n<p>Master, Slave1&#x548C;Slave2:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo vim <span class=\"regexp\">/etc/</span><span class=\"keyword\">default</span><span class=\"regexp\">/docker</span></div></pre></td></tr></table></figure>\n<p>&#x4FEE;&#x6539;<strong>DOCKER_OPTS</strong></p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">DOCKER_OPTS</span>=<span class=\"string\">&quot;-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock&quot;</span></div></pre></td></tr></table></figure>\n<p>&#x91CD;&#x542F;Docker</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">sudo restart docker</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>Master:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">zookeeper:</span><span class=\"number\">3.4</span><span class=\"number\">.8</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathon:</span><span class=\"number\">1.1</span><span class=\"number\">.1</span>  </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathonlb:</span><span class=\"number\">1.3</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<p>Slave1 &#x548C; Slave2:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><p>Master:</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/mesos-marathon-platform</div></pre></td></tr></table></figure>\n<h4 id=\"5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><p>Master:</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> mesos-marathon-platform</div><div class=\"line\">sudo ./<span class=\"built_in\">start</span>-containers.sh</div></pre></td></tr></table></figure>\n<p>&#x7F51;&#x9875;&#x7BA1;&#x7406;:</p>\n<ul>\n<li>Mesos: <a href=\"http://192.168.59.1:5050/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:5050/</a></li>\n<li>Marathon: <a href=\"http://192.168.59.1:8080/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:8080/</a>  </li>\n</ul>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x589E;&#x52A0;Slave&#x8282;&#x70B9;&#xFF0C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;start-contaniers.sh&#x811A;&#x672C;&#x4E2D;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">MASTER_IP=<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.1</span></div><div class=\"line\">SLAVE_IP=(<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.2</span> <span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.3</span>)</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;Nginx\"><a href=\"#6-&#x8FD0;&#x884C;Nginx\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;Nginx:\"></a><strong>6. &#x8FD0;&#x884C;Nginx:</strong></h4><p>&#x4E0B;&#x8F7D;nginx&#x955C;&#x50CF;(Slave1&#x548C;Slave2):</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;Nginx(Master):</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./<span class=\"keyword\">run</span><span class=\"bash\">-nginx.sh</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x7684;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;(nginx.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;servicePort&#x8868;&#x793A;nginx&#x7ED1;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>10000</strong>&#xFF0C;&#x800C;marathon-lb&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;IP&#x4E3A;<strong>192.168.59.1</strong>&#x3002;&#x56E0;&#x6B64;nginx&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#x4E3A;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://192.168.59.1:10000/\" target=\"_blank\" rel=\"external\">http://192.168.59.1:10000/</a></li>\n</ul>\n<p>&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E24;&#x4E2A;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x4E14;&#x7AEF;&#x53E3;&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://mesos.berkeley.edu/mesos_tech_report.pdf\" target=\"_blank\" rel=\"external\">Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x4E4B;&#x524D;&#x7684;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2015/09/18/150918-single-mesos-docker/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x5355;&#x673A;&#x7248;Mesos/Marathon</a>&#xFF0C;&#x4F46;&#x662F;&#x4EC5;&#x4EC5;&#x4F7F;&#x7528;&#x4E86;&#x5355;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x800C;&#x5728;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;3&#x4E2A;&#x8282;&#x70B9;&#x5FEB;&#x901F;&#x5730;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x3002;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x548C;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x4E86;<a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong> <a href=\"https://github.com/kiwenlau/mesos-marathon-platform\">kiwenlau/mesos-marathon-platform</a></p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">2016-07-10</a></li>\n</ul>\n<p><img src=\"/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\"><a href=\"#&#x4E00;-Mesos-Marathon&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;\"></a>&#x4E00;. Mesos/Marathon&#x7B80;&#x4ECB;</h2><h4 id=\"1-Mesos\"><a href=\"#1-Mesos\" class=\"headerlink\" title=\"1. Mesos\"></a><strong>1. Mesos</strong></h4><p><a href=\"http://mesos.apache.org/\">Mesos</a>&#x662F;<strong>&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x96C6;&#x7FA4;&#x5185;&#x7684;CPU&#xFF0C;&#x5185;&#x5B58;&#x4EE5;&#x53CA;&#x78C1;&#x76D8;&#x7B49;&#x8D44;&#x6E90;&#x3002;Hadoop MapReduce, Spark&#x4EE5;&#x53CA;Storm&#x7B49;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x5F88;&#x6D41;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x642D;&#x5EFA;&#x5355;&#x72EC;&#x7684;&#x96C6;&#x7FA4;&#x975E;&#x5E38;&#x5730;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5171;&#x4EAB;&#xFF0C;&#x800C;Mesos&#x7684;&#x8BBE;&#x8BA1;&#x521D;&#x8877;&#x5C31;&#x662F;&#x8BA9;&#x4E0D;&#x540C;&#x7684;<strong>&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;</strong>&#x80FD;&#x591F;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x3002;</p>\n<p>Mesos&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x5C42;&#x6B21;: Mesos&#x76D1;&#x63A7;&#x96C6;&#x7FA4;&#x7684;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x5C06;&#x7A7A;&#x4F59;&#x8D44;&#x6E90;&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x89C4;&#x5219;&#x5206;&#x914D;&#x7ED9;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#xFF1B;&#x800C;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F1A;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x6240;&#x5206;&#x914D;&#x7684;&#x8D44;&#x6E90;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;Mesos&#x4E0E;&#x5404;&#x4E2A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x90FD;&#x53C2;&#x4E0E;&#x4E86;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;: Mesos&#x8D1F;&#x8D23;&#x5206;&#x914D;&#x8D44;&#x6E90;; &#x800C;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x63A5;&#x53D7;&#x6216;&#x8005;&#x62D2;&#x7EDD;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;Mesos&#x7684;&#x8D23;&#x4EFB;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x800C;&#x4E14;&#x7B80;&#x5355;&#xFF1A;&#x5206;&#x914D;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x3002;Mesos&#x7684;&#x53CC;&#x5C42;&#x8C03;&#x5EA6;&#x7B97;&#x6CD5;&#x63D0;&#x9AD8;&#x4E86;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x66F4;&#x65B9;&#x4FBF;&#x5730;&#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x4E3B;&#x6D41;&#x7684;&#x96C6;&#x7FA4;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x8FD8;&#x6709;Hadoop YARN&#xFF0C;Kubernetes&#x4EE5;&#x53CA;Swarm&#x3002;Hadoop YARN&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4F8B;&#x5982;Spark&#xFF1B;Kubernetes&#x4E0E;Swarm&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF1B;&#x800C;Mesos&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4EE5;&#x53CA;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x7684;&#x652F;&#x6301;&#x90FD;&#x5F88;&#x6210;&#x719F;&#x3002;&#x5E76;&#x4E14;&#xFF0C;Kubernetes&#x4E0E;Swarm&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x8FD0;&#x884C;&#x5728;Mesos&#x4E4B;&#x4E0A;&#x3002;Kubernetes&#x7684;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;&#x5BFC;&#x81F4;&#x590D;&#x6742;&#x5EA6;&#x5F88;&#x9AD8;&#xFF0C;&#x800C;Swarm&#x7684;&#x8BBE;&#x8BA1;&#x7B80;&#x5355;&#x5F88;&#x591A;&#x4F46;&#x662F;&#x529F;&#x80FD;&#x76F8;&#x5BF9;&#x7F3A;&#x4E4F;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x9009;&#x62E9;&#x3002;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#xFF0C;<strong>&#x4F7F;&#x7528;Mesos&#x7684;&#x8BDD;&#xFF0C;&#x6700;&#x597D;&#x9009;&#x62E9;Marathon&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;</strong>&#xFF0C;&#x67B6;&#x6784;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4E14;&#x529F;&#x80FD;&#x4E30;&#x5BCC;&#x3002;</p>\n<h4 id=\"2-Marathon\"><a href=\"#2-Marathon\" class=\"headerlink\" title=\"2. Marathon\"></a><strong>2. Marathon</strong></h4><p><a href=\"https://mesosphere.github.io/marathon/\">Marathon</a>&#x662F;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#xFF0C;&#x662F;&#x8FD0;&#x884C;&#x4E8E;Mesos&#x4E4B;&#x4E0A;&#x7684;&#x4F17;&#x591A;&#x8BA1;&#x7B97;&#x6846;&#x67B6;&#x4E4B;&#x4E00;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Marathon&#x63D0;&#x4EA4;&#xFF0C;&#x76D1;&#x63A7;&#x5E76;&#x8C03;&#x5EA6;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF0C;&#x7136;&#x540E;Mesos&#x8D1F;&#x8D23;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x53E6;&#x5916;&#xFF0C;<a href=\"http://aurora.apache.org/\">Aurora</a>&#x4E0E;Marathon&#x529F;&#x80FD;&#x4E00;&#x81F4;&#xFF0C;&#x540C;&#x4E3A;&#x5BB9;&#x5668;&#x7F16;&#x6392;&#x7CFB;&#x7EDF;&#x3002;&#x76F8;&#x6BD4;&#x800C;&#x8A00;&#xFF0C;Marathon&#x7684;&#x67B6;&#x6784;&#x6BD4;Aurora&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x4ECE;&#x8282;&#x70B9;&#xFF0C;&#x4E14;&#x5BF9;<a href=\"https://www.docker.com/\">Docker</a>&#x7684;&#x652F;&#x6301;&#x66F4;&#x4E3A;&#x5B8C;&#x5584;&#x3002;Marathon&#x7531;Mesosphere&#x516C;&#x53F8;&#x8D1F;&#x8D23;&#x5F00;&#x53D1;&#xFF0C;&#x793E;&#x533A;&#x5F88;&#x6D3B;&#x8DC3;&#xFF0C;&#x6587;&#x6863;&#x4E5F;&#x5F88;&#x5B8C;&#x5584;&#x3002;</p>\n<p>Marathon&#x5177;&#x6709;<strong>&#x5BB9;&#x9519;&#x529F;&#x80FD;</strong>&#xFF1A;&#x5F53;&#x5BB9;&#x5668;&#x7531;&#x4E8E;&#x8282;&#x70B9;&#x5D29;&#x6E83;&#x7B49;&#x539F;&#x56E0;&#x610F;&#x5916;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;Marathon&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x5BB9;&#x5668;&#x8C03;&#x5EA6;&#x5230;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x7C7B;&#x4F3C;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x4F8B;&#x5982;<a href=\"http://supervisord.org/\">Supervisor</a>&#xFF1A;&#x5F53;&#x8FDB;&#x7A0B;&#x610F;&#x5916;&#x9000;&#x51FA;&#x65F6;&#xFF0C;Supervisor&#x4F1A;&#x91CD;&#x542F;&#x8FDB;&#x7A0B;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x81EA;&#x52A8;&#x5BB9;&#x9519;&#x529F;&#x80FD;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#xFF0C;&#x5373;&#x5E26;&#x6709;&#x6570;&#x636E;&#x5377;(volume)&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F8B;&#x5982;MongoDB&#x4E0E;MySQL&#x3002;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5F88;&#x96BE;&#x8DE8;&#x8282;&#x70B9;&#x79FB;&#x52A8;&#xFF0C;&#x76EE;&#x524D;&#x7684;&#x6280;&#x672F;&#x8FD8;&#x4E0D;&#x591F;&#x6210;&#x719F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>Marathon&#x76EE;&#x524D;&#x4EC5;&#x9002;&#x5408;&#x8FD0;&#x884C;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x800C;&#x6570;&#x636E;&#x5E93;&#x7B49;&#x6709;&#x72B6;&#x6001;&#x670D;&#x52A1;&#x5E94;&#x8BE5;&#x5355;&#x72EC;&#x90E8;&#x7F72;</strong>&#x3002;&#x8FD9;&#x6837;&#x505A;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p>\n<h4 id=\"3-Marathon-LB\"><a href=\"#3-Marathon-LB\" class=\"headerlink\" title=\"3. Marathon LB\"></a><strong>3. Marathon LB</strong></h4><p><a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x4E0E;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x5F53;&#x4F7F;&#x7528;Marathon&#x90E8;&#x7F72;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;(IP)&#x4E0E;&#x4F7F;&#x7528;&#x7684;&#x7AEF;&#x53E3;(PORT)&#x662F;Mesos/Marathon&#x5E73;&#x53F0;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x7684;&#xFF0C;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6BCF;&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5BB9;&#x5668;&#x51FA;&#x9519;&#x65F6;&#x4F1A;&#x53D1;&#x751F;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#xFF0C;IP&#x4E0E;PORT&#x4F1A;&#x53D8;&#x5316;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4F1A;&#x975E;&#x5E38;&#x4E0D;&#x65B9;&#x4FBF;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x90E8;&#x7F72;&#x670D;&#x52A1;&#x65F6;&#xFF0C;IP&#x4E0E;PORT&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x5C31;&#x65B9;&#x4FBF;&#x5F88;&#x591A;&#x4E86;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;PORT&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x90E8;&#x7F72;&#x65B0;&#x7684;&#x5BB9;&#x5668;&#x6216;&#x8005;&#x5BB9;&#x5668;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;PORT&#x8BBF;&#x95EE;&#x8BE5;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x3002;</p>\n<p>&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5F80;&#x5F80;&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x526F;&#x672C;&#xFF0C;Marathon LB&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5B9E;&#x73B0;&#x4E86;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7684;&#x529F;&#x80FD;&#x3002;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x80FD;&#x591F;&#x4F7F;&#x7528;Round Robin&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"><a href=\"#&#x4E8C;-&#x642D;&#x5EFA;&#x6B65;&#x9AA4;\" class=\"headerlink\" title=\"&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;\"></a>&#x4E8C;. &#x642D;&#x5EFA;&#x6B65;&#x9AA4;</h2><h4 id=\"1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#1-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>1. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><p>&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x5728;&#x5355;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x521B;&#x5EFA;Mesos/Marathon&#x5E73;&#x53F0;&#x8FD0;&#x884C;&#x6240;&#x9700;&#x8981;&#x7684;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x8282;&#x70B9;&#x3002;</p>\n<p>&#x5176;&#x4E2D;&#xFF0C;node1&#x4E3A;&#x4E3B;&#x673A;&#x70B9;(Master)&#xFF0C;&#x8FD0;&#x884C;zookeeper, mesos_master, marathon&#x4EE5;&#x53CA;marathon-lb&#x5BB9;&#x5668;; node2&#x4E0E;node3&#x4E3A;&#x4ECE;&#x8282;&#x70B9;(Slave)&#xFF0C;&#x8FD0;&#x884C;mesos_slave&#x5BB9;&#x5668;&#xFF1B;&#x4F7F;&#x7528;marathon&#x90E8;&#x7F72;nginx&#x65F6;&#xFF0C;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;&#x4ECE;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x5982;&#x4E0B;&#x8868;&#x6240;&#x793A;:</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">&#x8282;&#x70B9;</th>\n<th style=\"text-align:left\">IP</th>\n<th style=\"text-align:left\">&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">node1</td>\n<td style=\"text-align:left\">192.168.59.1</td>\n<td style=\"text-align:left\">zookeeper, mesos_master, marathon, marathon-lb</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node2</td>\n<td style=\"text-align:left\">192.168.59.2</td>\n<td style=\"text-align:left\">mesos_slave1, nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">node3</td>\n<td style=\"text-align:left\">192.168.59.3</td>\n<td style=\"text-align:left\">mesos_slave2, nginx</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"><a href=\"#2-&#x5F00;&#x542F;Docker-daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\" class=\"headerlink\" title=\"2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;\"></a><strong>2. &#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;</strong></h4><p>&#x56E0;&#x4E3A;<strong>start-containers.sh</strong>&#x4F7F;&#x7528;&#x4E86;&#x8FDC;&#x7A0B;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5F00;&#x542F;Docker daemon&#x7684;TCP&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x3002;&#x63D0;&#x9192;&#x4E00;&#x4E0B;&#xFF0C;<strong>&#x5F00;&#x542F;Docker daemon&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;</strong>&#xFF0C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4E0D;&#x80FD;&#x6253;&#x5F00;&#xFF0C;&#x6216;&#x8005;&#x505A;&#x597D;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x3002;&#x4E0D;&#x5E0C;&#x671B;&#x5F00;&#x542F;Docker daemon&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;start-containers.sh&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x7A0D;&#x5FAE;&#x9EBB;&#x70E6;&#x4E00;&#x70B9;&#x3002;</p>\n<p>Master, Slave1&#x548C;Slave2:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo vim <span class=\"regexp\">/etc/</span><span class=\"keyword\">default</span><span class=\"regexp\">/docker</span></div></pre></td></tr></table></figure>\n<p>&#x4FEE;&#x6539;<strong>DOCKER_OPTS</strong></p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attr\">DOCKER_OPTS</span>=<span class=\"string\">&quot;-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock&quot;</span></div></pre></td></tr></table></figure>\n<p>&#x91CD;&#x542F;Docker</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">sudo restart docker</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"><a href=\"#3-&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;\"></a><strong>3. &#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;</strong></h4><p>Master:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">zookeeper:</span><span class=\"number\">3.4</span><span class=\"number\">.8</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span> </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathon:</span><span class=\"number\">1.1</span><span class=\"number\">.1</span>  </div><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">marathonlb:</span><span class=\"number\">1.3</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<p>Slave1 &#x548C; Slave2:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker pull kiwenlau/<span class=\"string\">mesos:</span><span class=\"number\">0.26</span><span class=\"number\">.0</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"><a href=\"#4-&#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\" class=\"headerlink\" title=\"4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;\"></a><strong>4. &#x4E0B;&#x8F7D;GitHub&#x4ED3;&#x5E93;</strong></h4><p>Master:</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">git <span class=\"keyword\">clone</span> <span class=\"title\">https</span>://github.com/kiwenlau/mesos-marathon-platform</div></pre></td></tr></table></figure>\n<h4 id=\"5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#5-&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a><strong>5. &#x8FD0;&#x884C;&#x5BB9;&#x5668;</strong></h4><p>Master:</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> mesos-marathon-platform</div><div class=\"line\">sudo ./<span class=\"built_in\">start</span>-containers.sh</div></pre></td></tr></table></figure>\n<p>&#x7F51;&#x9875;&#x7BA1;&#x7406;:</p>\n<ul>\n<li>Mesos: <a href=\"http://192.168.59.1:5050/\">http://192.168.59.1:5050/</a></li>\n<li>Marathon: <a href=\"http://192.168.59.1:8080/\">http://192.168.59.1:8080/</a>  </li>\n</ul>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x589E;&#x52A0;Slave&#x8282;&#x70B9;&#xFF0C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x4EC5;&#x9700;&#x4FEE;&#x6539;start-contaniers.sh&#x811A;&#x672C;&#x4E2D;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">MASTER_IP=<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.1</span></div><div class=\"line\">SLAVE_IP=(<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.2</span> <span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.3</span>)</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x8FD0;&#x884C;Nginx\"><a href=\"#6-&#x8FD0;&#x884C;Nginx\" class=\"headerlink\" title=\"6. &#x8FD0;&#x884C;Nginx:\"></a><strong>6. &#x8FD0;&#x884C;Nginx:</strong></h4><p>&#x4E0B;&#x8F7D;nginx&#x955C;&#x50CF;(Slave1&#x548C;Slave2):</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;Nginx(Master):</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo ./<span class=\"keyword\">run</span><span class=\"bash\">-nginx.sh</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x7684;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;(nginx.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;servicePort&#x8868;&#x793A;nginx&#x7ED1;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>10000</strong>&#xFF0C;&#x800C;marathon-lb&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;IP&#x4E3A;<strong>192.168.59.1</strong>&#x3002;&#x56E0;&#x6B64;nginx&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#x4E3A;&#xFF1A;</p>\n<ul>\n<li><a href=\"http://192.168.59.1:10000/\">http://192.168.59.1:10000/</a></li>\n</ul>\n<p>&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E24;&#x4E2A;nginx&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x4E14;&#x7AEF;&#x53E3;&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://mesos.berkeley.edu/mesos_tech_report.pdf\">Mesos: A Platform for Fine-Grained Resource Sharing in the Data Center</a></li>\n</ol>"},{"title":"64位Ubuntu中编译Hadoop的步骤","date":"2016-05-29T01:00:00.000Z","_content":"\n**摘要:** 本文介绍了在64位Ubuntu 14.04中编译Hadoop的步骤。\n\nHadoop二进制包下载地址：[百度网盘](https://pan.baidu.com/s/1hrGLqlA) [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-05-29](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)\n\n<img src=\"160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width = \"300\"/>\n\nHadoop官网提供的二进制包是在32位系统上编译的，在64系统上运行会出错：\n\n```\nWARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n```\n\n这时需要自行编译Hadoop源码。以下为编译步骤:\n\n#### **1. 安装依赖软件**\n\n```\nsudo apt-get update\nsudo apt-get install -y openjdk-7-jdk libprotobuf-dev protobuf-compiler maven cmake build-essential pkg-config libssl-dev zlib1g-dev llvm-gcc automake autoconf make\n```\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nwget http://archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz\ntar -xzvf hadoop-2.3.0-src.tar.gz\n```\n\n#### **3. 编译Hadoop**\n\n```\ncd hadoop-2.3.0-src\nmvn package -Pdist,native -DskipTests –Dtar\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] ------------------------------------------------------------------------\n\n[INFO] BUILD SUCCESS\n\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Total time: 14:59.240s\n\n[INFO] Finished at: Thu Jan 15 18:51:59 JST 2015\n\n[INFO] Final Memory: 168M/435M\n\n[INFO] ------------------------------------------------------------------------\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.3.0-src/hadoop-dist/target/hadoop-2.3.0.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，也可以直接下载我编译好的Hadoop:\n\n- [百度网盘](https://pan.baidu.com/s/1hrGLqlA)\n- [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\nLinux终端用户可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.3.0/hadoop-2.3.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.4.0/hadoop-2.4.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.5.0/hadoop-2.5.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.6.0/hadoop-2.6.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.0/hadoop-2.7.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.2/hadoop-2.7.2.tar.gz\n```\n\n另外, 使用自行编译的Hadoop二进制包安装Hadoop时需要删除.bashrc文件与hadoop-env.sh文件中下面两行（默认不会有这两行，但是尝试解决报错时可能改写了）\n\n```\nexport HADOOP_COMMON_LIB_NATIVE_DIR=\"~/hadoop/lib/\"\nexport HADOOP_OPTS=\"$HADOOP_OPTS -Djava.library.path=~/hadoop/lib/\"\n```\n\n","source":"_posts/2016/05/29/160529-compile-hadoop-ubuntu.md","raw":"title: 64位Ubuntu中编译Hadoop的步骤\n\ndate: 2016-05-29 09:00\n\ntags: [Hadoop]\n\n---\n\n**摘要:** 本文介绍了在64位Ubuntu 14.04中编译Hadoop的步骤。\n\nHadoop二进制包下载地址：[百度网盘](https://pan.baidu.com/s/1hrGLqlA) [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-05-29](http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/)\n\n<img src=\"160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width = \"300\"/>\n\nHadoop官网提供的二进制包是在32位系统上编译的，在64系统上运行会出错：\n\n```\nWARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n```\n\n这时需要自行编译Hadoop源码。以下为编译步骤:\n\n#### **1. 安装依赖软件**\n\n```\nsudo apt-get update\nsudo apt-get install -y openjdk-7-jdk libprotobuf-dev protobuf-compiler maven cmake build-essential pkg-config libssl-dev zlib1g-dev llvm-gcc automake autoconf make\n```\n\n#### **2. 下载并解压[Hadoop源文件](http://archive.apache.org/dist/hadoop/core/)**\n\n```\nwget http://archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz\ntar -xzvf hadoop-2.3.0-src.tar.gz\n```\n\n#### **3. 编译Hadoop**\n\n```\ncd hadoop-2.3.0-src\nmvn package -Pdist,native -DskipTests –Dtar\n```\n\n这一步比较耗时，大概需要15~30分钟。 \n\n正确执行的结果如下:\n\n```\n[INFO] ------------------------------------------------------------------------\n\n[INFO] BUILD SUCCESS\n\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Total time: 14:59.240s\n\n[INFO] Finished at: Thu Jan 15 18:51:59 JST 2015\n\n[INFO] Final Memory: 168M/435M\n\n[INFO] ------------------------------------------------------------------------\n```\n\n编译好的二进制文件包位于\n\n```\nhadoop-2.3.0-src/hadoop-dist/target/hadoop-2.3.0.tar.gz\n```\n\n编译其他版本的Hadoop的步骤一致，也可以直接下载我编译好的Hadoop:\n\n- [百度网盘](https://pan.baidu.com/s/1hrGLqlA)\n- [GitHub](https://github.com/kiwenlau/compile-hadoop/releases)\n\nLinux终端用户可以使用wget命令直接下载GitHub上的Hadoop二进制包:\n\n```\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.3.0/hadoop-2.3.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.4.0/hadoop-2.4.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.5.0/hadoop-2.5.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.6.0/hadoop-2.6.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.0/hadoop-2.7.0.tar.gz\nwget https://github.com/kiwenlau/compile-hadoop/releases/download/2.7.2/hadoop-2.7.2.tar.gz\n```\n\n另外, 使用自行编译的Hadoop二进制包安装Hadoop时需要删除.bashrc文件与hadoop-env.sh文件中下面两行（默认不会有这两行，但是尝试解决报错时可能改写了）\n\n```\nexport HADOOP_COMMON_LIB_NATIVE_DIR=\"~/hadoop/lib/\"\nexport HADOOP_OPTS=\"$HADOOP_OPTS -Djava.library.path=~/hadoop/lib/\"\n```\n\n","slug":"2016/05/29/160529-compile-hadoop-ubuntu","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemm000imkfyo069b6jm","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x5728;64&#x4F4D;Ubuntu 14.04&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x3002;</p>\n<p>Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"https://pan.baidu.com/s/1hrGLqlA\" target=\"_blank\" rel=\"external\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a> <a href=\"https://github.com/kiwenlau/compile-hadoop/releases\" target=\"_blank\" rel=\"external\">GitHub</a></p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">2016-05-29</a></li>\n</ul>\n<p><img src=\"/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width=\"300\"></p>\n<p>Hadoop&#x5B98;&#x7F51;&#x63D0;&#x4F9B;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x662F;&#x5728;32&#x4F4D;&#x7CFB;&#x7EDF;&#x4E0A;&#x7F16;&#x8BD1;&#x7684;&#xFF0C;&#x5728;64&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;&#x4F1A;&#x51FA;&#x9519;&#xFF1A;</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\">WARN util.NativeCodeLoader: Unable to <span class=\"keyword\">load</span> <span class=\"keyword\">native</span>-hadoop <span class=\"keyword\">library</span> <span class=\"keyword\">for</span> your platform... <span class=\"keyword\">using</span> builtin-<span class=\"keyword\">java</span> classes <span class=\"keyword\">where</span> applicable</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x81EA;&#x884C;&#x7F16;&#x8BD1;Hadoop&#x6E90;&#x7801;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;:</p>\n<h4 id=\"1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"><a href=\"#1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"></a><strong>1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;</strong></h4><figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> install -y openjdk<span class=\"number\">-7</span>-jdk libprotobuf-<span class=\"built_in\">dev</span> protobuf-compiler maven cmake build-essential pkg-config libssl-<span class=\"built_in\">dev</span> zlib1g-<span class=\"built_in\">dev</span> llvm-gcc automake autoconf make</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\" target=\"_blank\" rel=\"external\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget http:<span class=\"comment\">//archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz</span></div><div class=\"line\">tar -xzvf hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">cd hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src</div><div class=\"line\">mvn <span class=\"keyword\">package</span> <span class=\"title\">-Pd</span>ist,native -DskipTests &#x2013;Dtar</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">14</span><span class=\"selector-pseudo\">:59.240s</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Thu</span> <span class=\"selector-tag\">Jan</span> <span class=\"selector-tag\">15</span> <span class=\"selector-tag\">18</span><span class=\"selector-pseudo\">:51</span><span class=\"selector-pseudo\">:59</span> <span class=\"selector-tag\">JST</span> <span class=\"selector-tag\">2015</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">168M</span>/<span class=\"selector-tag\">435M</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x7F16;&#x8BD1;&#x597D;&#x7684;Hadoop:</p>\n<ul>\n<li><a href=\"https://pan.baidu.com/s/1hrGLqlA\" target=\"_blank\" rel=\"external\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a></li>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop/releases\" target=\"_blank\" rel=\"external\">GitHub</a></li>\n</ul>\n<p>Linux&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.3.0/</span>hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.4.0/</span>hadoop-<span class=\"number\">2.4</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.5.0/</span>hadoop-<span class=\"number\">2.5</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.6.0/</span>hadoop-<span class=\"number\">2.6</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.0/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.2/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x53E6;&#x5916;, &#x4F7F;&#x7528;&#x81EA;&#x884C;&#x7F16;&#x8BD1;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x5B89;&#x88C5;Hadoop&#x65F6;&#x9700;&#x8981;&#x5220;&#x9664;.bashrc&#x6587;&#x4EF6;&#x4E0E;hadoop-env.sh&#x6587;&#x4EF6;&#x4E2D;&#x4E0B;&#x9762;&#x4E24;&#x884C;&#xFF08;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x6709;&#x8FD9;&#x4E24;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5C1D;&#x8BD5;&#x89E3;&#x51B3;&#x62A5;&#x9519;&#x65F6;&#x53EF;&#x80FD;&#x6539;&#x5199;&#x4E86;&#xFF09;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class=\"string\">&quot;~/hadoop/lib/&quot;</span></div><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_OPTS=<span class=\"string\">&quot;<span class=\"variable\">$HADOOP_OPTS</span> -Djava.library.path=~/hadoop/lib/&quot;</span></div></pre></td></tr></table></figure>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x5728;64&#x4F4D;Ubuntu 14.04&#x4E2D;&#x7F16;&#x8BD1;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x3002;</p>\n<p>Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href=\"https://pan.baidu.com/s/1hrGLqlA\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a> <a href=\"https://github.com/kiwenlau/compile-hadoop/releases\">GitHub</a></p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/05/29/160529-compile-hadoop-ubuntu/\">2016-05-29</a></li>\n</ul>\n<p><img src=\"/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png\" width=\"300\"></p>\n<p>Hadoop&#x5B98;&#x7F51;&#x63D0;&#x4F9B;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x662F;&#x5728;32&#x4F4D;&#x7CFB;&#x7EDF;&#x4E0A;&#x7F16;&#x8BD1;&#x7684;&#xFF0C;&#x5728;64&#x7CFB;&#x7EDF;&#x4E0A;&#x8FD0;&#x884C;&#x4F1A;&#x51FA;&#x9519;&#xFF1A;</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\">WARN util.NativeCodeLoader: Unable to <span class=\"keyword\">load</span> <span class=\"keyword\">native</span>-hadoop <span class=\"keyword\">library</span> <span class=\"keyword\">for</span> your platform... <span class=\"keyword\">using</span> builtin-<span class=\"keyword\">java</span> classes <span class=\"keyword\">where</span> applicable</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x81EA;&#x884C;&#x7F16;&#x8BD1;Hadoop&#x6E90;&#x7801;&#x3002;&#x4EE5;&#x4E0B;&#x4E3A;&#x7F16;&#x8BD1;&#x6B65;&#x9AA4;:</p>\n<h4 id=\"1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"><a href=\"#1-&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;\"></a><strong>1. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x8F6F;&#x4EF6;</strong></h4><figure class=\"highlight q\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> <span class=\"keyword\">update</span></div><div class=\"line\">sudo apt-<span class=\"built_in\">get</span> install -y openjdk<span class=\"number\">-7</span>-jdk libprotobuf-<span class=\"built_in\">dev</span> protobuf-compiler maven cmake build-essential pkg-config libssl-<span class=\"built_in\">dev</span> zlib1g-<span class=\"built_in\">dev</span> llvm-gcc automake autoconf make</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"><a href=\"#2-&#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;Hadoop&#x6E90;&#x6587;&#x4EF6;\"></a><strong>2. &#x4E0B;&#x8F7D;&#x5E76;&#x89E3;&#x538B;<a href=\"http://archive.apache.org/dist/hadoop/core/\">Hadoop&#x6E90;&#x6587;&#x4EF6;</a></strong></h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget http:<span class=\"comment\">//archive.apache.org/dist/hadoop/core/hadoop-2.3.0/hadoop-2.3.0-src.tar.gz</span></div><div class=\"line\">tar -xzvf hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src<span class=\"selector-class\">.tar</span><span class=\"selector-class\">.gz</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x7F16;&#x8BD1;Hadoop\"><a href=\"#3-&#x7F16;&#x8BD1;Hadoop\" class=\"headerlink\" title=\"3. &#x7F16;&#x8BD1;Hadoop\"></a><strong>3. &#x7F16;&#x8BD1;Hadoop</strong></h4><figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">cd hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>-src</div><div class=\"line\">mvn <span class=\"keyword\">package</span> <span class=\"title\">-Pd</span>ist,native -DskipTests &#x2013;Dtar</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E00;&#x6B65;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#xFF0C;&#x5927;&#x6982;&#x9700;&#x8981;15~30&#x5206;&#x949F;&#x3002; </p>\n<p>&#x6B63;&#x786E;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">BUILD</span> <span class=\"selector-tag\">SUCCESS</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Total</span> <span class=\"selector-tag\">time</span>: <span class=\"selector-tag\">14</span><span class=\"selector-pseudo\">:59.240s</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Finished</span> <span class=\"selector-tag\">at</span>: <span class=\"selector-tag\">Thu</span> <span class=\"selector-tag\">Jan</span> <span class=\"selector-tag\">15</span> <span class=\"selector-tag\">18</span><span class=\"selector-pseudo\">:51</span><span class=\"selector-pseudo\">:59</span> <span class=\"selector-tag\">JST</span> <span class=\"selector-tag\">2015</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">Final</span> <span class=\"selector-tag\">Memory</span>: <span class=\"selector-tag\">168M</span>/<span class=\"selector-tag\">435M</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-attr\">[INFO]</span> <span class=\"selector-tag\">------------------------------------------------------------------------</span></div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x5305;&#x4F4D;&#x4E8E;</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>-src/hadoop-dist/target/hadoop<span class=\"number\">-2.3</span><span class=\"number\">.0</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x7F16;&#x8BD1;&#x5176;&#x4ED6;&#x7248;&#x672C;&#x7684;Hadoop&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x81F4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x6211;&#x7F16;&#x8BD1;&#x597D;&#x7684;Hadoop:</p>\n<ul>\n<li><a href=\"https://pan.baidu.com/s/1hrGLqlA\">&#x767E;&#x5EA6;&#x7F51;&#x76D8;</a></li>\n<li><a href=\"https://github.com/kiwenlau/compile-hadoop/releases\">GitHub</a></li>\n</ul>\n<p>Linux&#x7EC8;&#x7AEF;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;wget&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x4E0B;&#x8F7D;GitHub&#x4E0A;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.3.0/</span>hadoop-<span class=\"number\">2.3</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.4.0/</span>hadoop-<span class=\"number\">2.4</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.5.0/</span>hadoop-<span class=\"number\">2.5</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.6.0/</span>hadoop-<span class=\"number\">2.6</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.0/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">0</span>.tar.gz</div><div class=\"line\">wget https:<span class=\"regexp\">//gi</span>thub.com<span class=\"regexp\">/kiwenlau/</span>compile-hadoop<span class=\"regexp\">/releases/</span>download<span class=\"regexp\">/2.7.2/</span>hadoop-<span class=\"number\">2.7</span>.<span class=\"number\">2</span>.tar.gz</div></pre></td></tr></table></figure>\n<p>&#x53E6;&#x5916;, &#x4F7F;&#x7528;&#x81EA;&#x884C;&#x7F16;&#x8BD1;&#x7684;Hadoop&#x4E8C;&#x8FDB;&#x5236;&#x5305;&#x5B89;&#x88C5;Hadoop&#x65F6;&#x9700;&#x8981;&#x5220;&#x9664;.bashrc&#x6587;&#x4EF6;&#x4E0E;hadoop-env.sh&#x6587;&#x4EF6;&#x4E2D;&#x4E0B;&#x9762;&#x4E24;&#x884C;&#xFF08;&#x9ED8;&#x8BA4;&#x4E0D;&#x4F1A;&#x6709;&#x8FD9;&#x4E24;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5C1D;&#x8BD5;&#x89E3;&#x51B3;&#x62A5;&#x9519;&#x65F6;&#x53EF;&#x80FD;&#x6539;&#x5199;&#x4E86;&#xFF09;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_COMMON_LIB_NATIVE_DIR=<span class=\"string\">&quot;~/hadoop/lib/&quot;</span></div><div class=\"line\"><span class=\"built_in\">export</span> HADOOP_OPTS=<span class=\"string\">&quot;<span class=\"variable\">$HADOOP_OPTS</span> -Djava.library.path=~/hadoop/lib/&quot;</span></div></pre></td></tr></table></figure>"},{"title":"什么是服务发现？","date":"2016-09-04T02:00:00.000Z","_content":"\n**摘要:** 将容器应用部署到集群时，其服务地址，即**IP**和**端口**, 是由集群系统动态分配的。那么，当我们需要访问这个服务时，如何确定它的地址呢？这时，就需要**服务发现(Service Discovery)**了。本文将以Nginx的部署为例，介绍服务发现的原理与实践。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-04](http://kiwenlau.com/2016/09/04/what-is-service-discovery/)\n\n<img src=\"what-is-service-discovery/service-discovery.png\" width = \"500\"/>\n\n## 一. 单机部署Nginx\n\n[Nginx](https://nginx.org)作为网页服务器，功能与Apache一致。使用[Docker](https://www.docker.com/), 可以快速部署Nginx。\n\n#### **1. 下载Nginx镜像**\n\n```\nsudo docker pull nginx:1.10\n```\n\n#### **2. 运行Nginx容器**\n\n```\nsudo docker run -d \\\n                -p 8080:80 \\\n                nginx:1.10\n```\n\n其中，**-d**选项表示Nginx容器在后台运行，**-p**选项表示主机的**8080**端口映射为容器的**80**端口。\n\n#### **3. 访问Nginx服务**\n\n使用浏览器服务Nginx\n\n[http://192.168.59.1:8080](http://192.168.59.1:8080)\n\n或者使用curl命令访问Nginx, 其返回结果为html文件。\n\n```\ncurl 192.168.59.1:8080\n```\n\nNginx的服务地址是192.168.59.1:8080，其中，**192.168.59.1**是运行Nginx容器的主机的IP，而**8080**是Nginx提供服务的端口。\n\n可知，将容器应用部署到单个主机上时，服务的IP即为运行容器的主机IP，而服务的端口可以通过**-p**选项手动指定，这时服务地址相当于是静态分配的，因此不存在服务发现的问题。然而，当我们将容器应用部署到多个节点的集群时呢？\n\n## 二. Mesos/Marathon集群中部署Nginx\n\n首先，可以按照[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)介绍的方法，快速搭建3个节点的Mesos/Marathon集群。部署Nginx时，可以不使用服务发现，也可以使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现。通过对比两种方式，可以更好地理解服务发现。\n\n**1. 不使用服务发现**\n\nNginx定义(nginx1.json):\n\n```\n{\n    \"id\": \"nginx1\",\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，**instances**为1，表示仅部署单个Nginx容器; **hostPort**为0，表示Nginx容器绑定的主机端口由Marathon随机分配。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx1.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx容器可能运行node2(192.168.59.2)上，也可能运行在node3(192.168.59.3)上，因此Nginx服务的IP是无法事先确定的。而Nginx容器绑定的主机端口由Marathon随机分配，也不确定。\n\n当然，服务端口可以通过**hostPort**指定，但是这样做并不合适，因为有可能会发生端口冲突。当集群中运行了非常多不同的服务时，**静态分配端口是不现实的，也限制了集群的灵活性与扩展性**。\n\n在Slave节点上使用**docker ps**命令可以获取Nginx服务的IP与端口。\n\nnode2(192.168.59.2)\n\n```\nsudo docker ps | grep nginx\nb863d407b880        nginx:1.10              \"nginx -g 'daemon off\"   15 minutes ago      Up 15 minutes       443/tcp, 0.0.0.0:31575->80/tcp   mesos-d34d0b5b-c3b1-4020-9bb2-bb8582252bf3-S0.d2de6d05-9751-4fbe-af10-d7e35e9e6c7b\n```\n\nnode3(192.168.59.3)\n\n```\nsudo docker ps | grep nginx\n```\n\n可知Nginx服务的IP与端口分别为**192.168.59.2**和**31575**，即Nginx的服务地址为：[http://192.168.59.2:31575](http://192.168.59.2:31575)\n\n每次重新部署Nginx时，其IP和端口会发生变化，这就意味着每次都要手动去查询服务地址，这很不方便，且无法将部署任务自动化。在容器集群中，通常需要运行非常多不同的应用，这就意味着**服务发现**是容器集群系统的必备功能。\n\n\n**2. 使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。因此，当重新部署Nginx时，我们仍然可以通过固定的IP与端口访问该服务。\n\nNginx定义(nginx2.json):\n\n```\n{\n    \"id\": \"nginx2\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，nginx2.json只有**HAPROXY_GROUP**与**servicePort**两处修改。**HAPROXY_GROUP**为external，表示Nginx将使用分组为external的**Marathon LB**做服务发现。**servicePort**为10000，表示Nginx将使用**Marathon LB**节点的10000端口提供服务。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx2.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx服务的IP为运行Marathon LB的节点IP，即**192.168.59.1**，而Nginx服务的端口为**servicePort**指定的端口，即10000。因此，Nginx的服务地址为：[http://192.168.59.1:10000](http://192.168.59.1:10000)。而Nginx容器的实际地址为[http://192.168.59.2:31270](http://192.168.59.2:31270)，Marathon LB使用Haproxy作为代理服务器转发的服务请求。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。下面即为Marathon LB自动生成的Haproxy配置文件: \n\n```\nfrontend nginx2_10000\n  bind *:10000\n  mode http\n  use_backend nginx2_10000\n\nbackend nginx2_10000\n  balance roundrobin\n  mode http\n  option forwardfor\n  http-request set-header X-Forwarded-Port %[dst_port]\n  http-request add-header X-Forwarded-Proto https if { ssl_fc }\n  option  httpchk GET /\n  timeout check 20s\n  server 192_168_59_2_31270 192.168.59.2:31270 check inter 60s fall 4\n```\n\n可知Haproxy中，niginx服务的前端(frontend)地址为: *:10000，而后端(backend)地址为: 192.168.59.2:31270。Haproxy负责将服务请求转发到Nginx容器。\n\n当我们重新部署Nginx时，Nginx容器的IP和端口会发生变化，Marathon LB会更新Haproxy的配置文件，因此我们仍然可以通过[http://192.168.59.1:10000](http://192.168.59.1:10000)访问服务。\n\n因此，Marathon LB的任务就是发现服务的地址(IP和端口)，然后用户就不用每次手动查询了。[bamboo](https://github.com/QubitProducts/bamboo)与[nixy](https://github.com/martensson/nixy)实现了同样的功能。\n\n## 三. 参考\n\n1. [Understanding Modern Service Discovery with Docker](http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/)\n2. [基于Docker技术构建PaaS云平台](http://www.eurekao.com/build-paas-platform-base-on-docker/)\n3. [Youzan 服务发现概述](http://tech.youzan.com/haunt-youzan-service-discovery/)\n\n\n","source":"_posts/2016/09/04/what-is-service-discovery.md","raw":"title: 什么是服务发现？\n\ndate: 2016-09-04 10:00\n\ntags: [Docker]\n\n---\n\n**摘要:** 将容器应用部署到集群时，其服务地址，即**IP**和**端口**, 是由集群系统动态分配的。那么，当我们需要访问这个服务时，如何确定它的地址呢？这时，就需要**服务发现(Service Discovery)**了。本文将以Nginx的部署为例，介绍服务发现的原理与实践。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-04](http://kiwenlau.com/2016/09/04/what-is-service-discovery/)\n\n<img src=\"what-is-service-discovery/service-discovery.png\" width = \"500\"/>\n\n## 一. 单机部署Nginx\n\n[Nginx](https://nginx.org)作为网页服务器，功能与Apache一致。使用[Docker](https://www.docker.com/), 可以快速部署Nginx。\n\n#### **1. 下载Nginx镜像**\n\n```\nsudo docker pull nginx:1.10\n```\n\n#### **2. 运行Nginx容器**\n\n```\nsudo docker run -d \\\n                -p 8080:80 \\\n                nginx:1.10\n```\n\n其中，**-d**选项表示Nginx容器在后台运行，**-p**选项表示主机的**8080**端口映射为容器的**80**端口。\n\n#### **3. 访问Nginx服务**\n\n使用浏览器服务Nginx\n\n[http://192.168.59.1:8080](http://192.168.59.1:8080)\n\n或者使用curl命令访问Nginx, 其返回结果为html文件。\n\n```\ncurl 192.168.59.1:8080\n```\n\nNginx的服务地址是192.168.59.1:8080，其中，**192.168.59.1**是运行Nginx容器的主机的IP，而**8080**是Nginx提供服务的端口。\n\n可知，将容器应用部署到单个主机上时，服务的IP即为运行容器的主机IP，而服务的端口可以通过**-p**选项手动指定，这时服务地址相当于是静态分配的，因此不存在服务发现的问题。然而，当我们将容器应用部署到多个节点的集群时呢？\n\n## 二. Mesos/Marathon集群中部署Nginx\n\n首先，可以按照[基于Docker搭建多节点Mesos/Marathon](http://kiwenlau.com/2016/07/10/mesos-marathon-platform/)介绍的方法，快速搭建3个节点的Mesos/Marathon集群。部署Nginx时，可以不使用服务发现，也可以使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现。通过对比两种方式，可以更好地理解服务发现。\n\n**1. 不使用服务发现**\n\nNginx定义(nginx1.json):\n\n```\n{\n    \"id\": \"nginx1\",\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，**instances**为1，表示仅部署单个Nginx容器; **hostPort**为0，表示Nginx容器绑定的主机端口由Marathon随机分配。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx1.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx容器可能运行node2(192.168.59.2)上，也可能运行在node3(192.168.59.3)上，因此Nginx服务的IP是无法事先确定的。而Nginx容器绑定的主机端口由Marathon随机分配，也不确定。\n\n当然，服务端口可以通过**hostPort**指定，但是这样做并不合适，因为有可能会发生端口冲突。当集群中运行了非常多不同的服务时，**静态分配端口是不现实的，也限制了集群的灵活性与扩展性**。\n\n在Slave节点上使用**docker ps**命令可以获取Nginx服务的IP与端口。\n\nnode2(192.168.59.2)\n\n```\nsudo docker ps | grep nginx\nb863d407b880        nginx:1.10              \"nginx -g 'daemon off\"   15 minutes ago      Up 15 minutes       443/tcp, 0.0.0.0:31575->80/tcp   mesos-d34d0b5b-c3b1-4020-9bb2-bb8582252bf3-S0.d2de6d05-9751-4fbe-af10-d7e35e9e6c7b\n```\n\nnode3(192.168.59.3)\n\n```\nsudo docker ps | grep nginx\n```\n\n可知Nginx服务的IP与端口分别为**192.168.59.2**和**31575**，即Nginx的服务地址为：[http://192.168.59.2:31575](http://192.168.59.2:31575)\n\n每次重新部署Nginx时，其IP和端口会发生变化，这就意味着每次都要手动去查询服务地址，这很不方便，且无法将部署任务自动化。在容器集群中，通常需要运行非常多不同的应用，这就意味着**服务发现**是容器集群系统的必备功能。\n\n\n**2. 使用[Marathon LB](https://github.com/mesosphere/marathon-lb)提供服务发现**\n\n[Marathon LB](https://github.com/mesosphere/marathon-lb)是Marathon的**服务发现**系统。Marathon LB通过使用[Haproxy](http://www.haproxy.org/)实现了代理服务器的功能。\n\n通过使用Marathon LB可以配置服务的固定端口，而服务的IP就是运行Marathon LB的节点IP。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。因此，当重新部署Nginx时，我们仍然可以通过固定的IP与端口访问该服务。\n\nNginx定义(nginx2.json):\n\n```\n{\n    \"id\": \"nginx2\",\n    \"labels\": {\n        \"HAPROXY_GROUP\": \"external\"\n    },\n    \"cpus\": 0.2,\n    \"mem\": 20.0,\n    \"instances\": 1,\n    \"healthChecks\": [{\n        \"path\": \"/\"\n    }],\n    \"container\": {\n        \"type\": \"DOCKER\",\n        \"docker\": {\n            \"image\": \"nginx:1.10\",\n            \"network\": \"BRIDGE\",\n            \"portMappings\": [{ \"containerPort\": 80, \"hostPort\": 0, \"servicePort\": 10000, \"protocol\": \"tcp\" }]\n        }\n    }\n}\n```\n\n其中，nginx2.json只有**HAPROXY_GROUP**与**servicePort**两处修改。**HAPROXY_GROUP**为external，表示Nginx将使用分组为external的**Marathon LB**做服务发现。**servicePort**为10000，表示Nginx将使用**Marathon LB**节点的10000端口提供服务。\n\n部署Nginx:\n\n```\ncurl -Ss \\\n     -X POST \\\n     -H \"Content-Type: application/json\" \\\n     --data \"@nginx2.json\" \\\n     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool\n```\n\n这时，Nginx服务的IP为运行Marathon LB的节点IP，即**192.168.59.1**，而Nginx服务的端口为**servicePort**指定的端口，即10000。因此，Nginx的服务地址为：[http://192.168.59.1:10000](http://192.168.59.1:10000)。而Nginx容器的实际地址为[http://192.168.59.2:31270](http://192.168.59.2:31270)，Marathon LB使用Haproxy作为代理服务器转发的服务请求。Marathon LB会监听Marathon的调度事件，获取容器实际运行的IP与端口，然后更新Haproxy的配置文件。下面即为Marathon LB自动生成的Haproxy配置文件: \n\n```\nfrontend nginx2_10000\n  bind *:10000\n  mode http\n  use_backend nginx2_10000\n\nbackend nginx2_10000\n  balance roundrobin\n  mode http\n  option forwardfor\n  http-request set-header X-Forwarded-Port %[dst_port]\n  http-request add-header X-Forwarded-Proto https if { ssl_fc }\n  option  httpchk GET /\n  timeout check 20s\n  server 192_168_59_2_31270 192.168.59.2:31270 check inter 60s fall 4\n```\n\n可知Haproxy中，niginx服务的前端(frontend)地址为: *:10000，而后端(backend)地址为: 192.168.59.2:31270。Haproxy负责将服务请求转发到Nginx容器。\n\n当我们重新部署Nginx时，Nginx容器的IP和端口会发生变化，Marathon LB会更新Haproxy的配置文件，因此我们仍然可以通过[http://192.168.59.1:10000](http://192.168.59.1:10000)访问服务。\n\n因此，Marathon LB的任务就是发现服务的地址(IP和端口)，然后用户就不用每次手动查询了。[bamboo](https://github.com/QubitProducts/bamboo)与[nixy](https://github.com/martensson/nixy)实现了同样的功能。\n\n## 三. 参考\n\n1. [Understanding Modern Service Discovery with Docker](http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/)\n2. [基于Docker技术构建PaaS云平台](http://www.eurekao.com/build-paas-platform-base-on-docker/)\n3. [Youzan 服务发现概述](http://tech.youzan.com/haunt-youzan-service-discovery/)\n\n\n","slug":"2016/09/04/what-is-service-discovery","published":1,"updated":"2017-04-10T02:14:09.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemp000kmkfyvwpjpiz2","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x96C6;&#x7FA4;&#x65F6;&#xFF0C;&#x5176;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x5373;<strong>IP</strong>&#x548C;<strong>&#x7AEF;&#x53E3;</strong>, &#x662F;&#x7531;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x5B83;&#x7684;&#x5730;&#x5740;&#x5462;&#xFF1F;&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;(Service Discovery)</strong>&#x4E86;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4EE5;Nginx&#x7684;&#x90E8;&#x7F72;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x539F;&#x7406;&#x4E0E;&#x5B9E;&#x8DF5;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/04/what-is-service-discovery/\">2016-09-04</a></li>\n</ul>\n<p><img src=\"/2016/09/04/what-is-service-discovery/service-discovery.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"></a>&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx</h2><p><a href=\"https://nginx.org\" target=\"_blank\" rel=\"external\">Nginx</a>&#x4F5C;&#x4E3A;&#x7F51;&#x9875;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x529F;&#x80FD;&#x4E0E;Apache&#x4E00;&#x81F4;&#x3002;&#x4F7F;&#x7528;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>, &#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x90E8;&#x7F72;Nginx&#x3002;</p>\n<h4 id=\"1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;</strong></h4><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"></a><strong>2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> <span class=\"_\">-d</span> \\</span></div><div class=\"line\">                -p 8080:80 \\</div><div class=\"line\">                nginx:1.10</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>-d</strong>&#x9009;&#x9879;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;<strong>-p</strong>&#x9009;&#x9879;&#x8868;&#x793A;&#x4E3B;&#x673A;&#x7684;<strong>8080</strong>&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x4E3A;&#x5BB9;&#x5668;&#x7684;<strong>80</strong>&#x7AEF;&#x53E3;&#x3002;</p>\n<h4 id=\"3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"><a href=\"#3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\" class=\"headerlink\" title=\"3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"></a><strong>3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;</strong></h4><p>&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x670D;&#x52A1;Nginx</p>\n<p><a href=\"http://192.168.59.1:8080\" target=\"_blank\" rel=\"external\">http://192.168.59.1:8080</a></p>\n<p>&#x6216;&#x8005;&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;Nginx, &#x5176;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4E3A;html&#x6587;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">curl</span> 192<span class=\"selector-class\">.168</span><span class=\"selector-class\">.59</span><span class=\"selector-class\">.1</span><span class=\"selector-pseudo\">:8080</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x662F;192.168.59.1:8080&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;<strong>192.168.59.1</strong>&#x662F;&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#xFF0C;&#x800C;<strong>8080</strong>&#x662F;Nginx&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x5355;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x7684;IP&#x5373;&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>-p</strong>&#x9009;&#x9879;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#xFF0C;&#x8FD9;&#x65F6;&#x670D;&#x52A1;&#x5730;&#x5740;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x9759;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x96C6;&#x7FA4;&#x65F6;&#x5462;&#xFF1F;</p>\n<h2 id=\"&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"></a>&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx</h2><p>&#x9996;&#x5148;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5FEB;&#x901F;&#x642D;&#x5EFA;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>\n<p><strong>1. &#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx1.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx1&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>instances</strong>&#x4E3A;1&#xFF0C;&#x8868;&#x793A;&#x4EC5;&#x90E8;&#x7F72;&#x5355;&#x4E2A;Nginx&#x5BB9;&#x5668;; <strong>hostPort</strong>&#x4E3A;0&#xFF0C;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx1.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x53EF;&#x80FD;&#x8FD0;&#x884C;node2(192.168.59.2)&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8FD0;&#x884C;&#x5728;node3(192.168.59.3)&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Nginx&#x670D;&#x52A1;&#x7684;IP&#x662F;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x7684;&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#xFF0C;&#x4E5F;&#x4E0D;&#x786E;&#x5B9A;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>hostPort</strong>&#x6307;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x5E76;&#x4E0D;&#x5408;&#x9002;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x7AEF;&#x53E3;&#x51B2;&#x7A81;&#x3002;&#x5F53;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x65F6;&#xFF0C;<strong>&#x9759;&#x6001;&#x5206;&#x914D;&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x4E5F;&#x9650;&#x5236;&#x4E86;&#x96C6;&#x7FA4;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x4E0E;&#x6269;&#x5C55;&#x6027;</strong>&#x3002;</p>\n<p>&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528;<strong>docker ps</strong>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>node2(192.168.59.2)</p>\n<figure class=\"highlight dns\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker ps | grep nginx</div><div class=\"line\">b863d<span class=\"number\">407b880</span>        nginx:<span class=\"number\">1</span>.<span class=\"number\">10</span>              &quot;nginx -g &apos;daemon off&quot;   <span class=\"number\">15</span> minutes ago      Up <span class=\"number\">15</span> minutes       <span class=\"number\">443</span>/tcp, <span class=\"number\">0.0.0.0</span>:<span class=\"number\">31575</span>-&gt;<span class=\"number\">80</span>/tcp   mesos-d34d0b5b-c<span class=\"number\">3b1-4020</span>-<span class=\"number\">9</span>bb2-bb8582252bf3-S0.d2de<span class=\"number\">6d05-9751</span>-<span class=\"number\">4</span>fbe-af10-d7e35e9e6c7b</div></pre></td></tr></table></figure>\n<p>node3(192.168.59.3)</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">ps</span> | <span class=\"keyword\">grep</span> nginx</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x5206;&#x522B;&#x4E3A;<strong>192.168.59.2</strong>&#x548C;<strong>31575</strong>&#xFF0C;&#x5373;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.2:31575\" target=\"_blank\" rel=\"external\">http://192.168.59.2:31575</a></p>\n<p>&#x6BCF;&#x6B21;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x5176;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x5F88;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x4E14;&#x65E0;&#x6CD5;&#x5C06;&#x90E8;&#x7F72;&#x4EFB;&#x52A1;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x5728;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x7684;&#x5FC5;&#x5907;&#x529F;&#x80FD;&#x3002;</p>\n<p><strong>2. &#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p><a href=\"https://github.com/mesosphere/marathon-lb\" target=\"_blank\" rel=\"external\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\" target=\"_blank\" rel=\"external\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;</p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx2.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx2&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;nginx2.json&#x53EA;&#x6709;<strong>HAPROXY_GROUP</strong>&#x4E0E;<strong>servicePort</strong>&#x4E24;&#x5904;&#x4FEE;&#x6539;&#x3002;<strong>HAPROXY_GROUP</strong>&#x4E3A;external&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;&#x5206;&#x7EC4;&#x4E3A;external&#x7684;<strong>Marathon LB</strong>&#x505A;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;<strong>servicePort</strong>&#x4E3A;10000&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;<strong>Marathon LB</strong>&#x8282;&#x70B9;&#x7684;10000&#x7AEF;&#x53E3;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx2.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E3A;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x5373;<strong>192.168.59.1</strong>&#xFF0C;&#x800C;Nginx&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>servicePort</strong>&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5373;10000&#x3002;&#x56E0;&#x6B64;&#xFF0C;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.1:10000\" target=\"_blank\" rel=\"external\">http://192.168.59.1:10000</a>&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7684;&#x5B9E;&#x9645;&#x5730;&#x5740;&#x4E3A;<a href=\"http://192.168.59.2:31270\" target=\"_blank\" rel=\"external\">http://192.168.59.2:31270</a>&#xFF0C;Marathon LB&#x4F7F;&#x7528;Haproxy&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8F6C;&#x53D1;&#x7684;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x5373;&#x4E3A;Marathon LB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;Haproxy&#x914D;&#x7F6E;&#x6587;&#x4EF6;: </p>\n<figure class=\"highlight smali\"><table><tr><td class=\"code\"><pre><div class=\"line\">frontend nginx2_10000</div><div class=\"line\">  bind *:10000</div><div class=\"line\">  mode http</div><div class=\"line\">  use_backend nginx2_10000</div><div class=\"line\"></div><div class=\"line\">backend nginx2_10000</div><div class=\"line\">  balance roundrobin</div><div class=\"line\">  mode http</div><div class=\"line\">  option forwardfor</div><div class=\"line\">  http-request set-header X-Forwarded-Port %[dst_port]</div><div class=\"line\">  http-request<span class=\"built_in\"> add-header </span>X-Forwarded-Proto https<span class=\"built_in\"> if </span>{ ssl_fc }</div><div class=\"line\">  option  httpchk GET /</div><div class=\"line\">  timeout<span class=\"built_in\"> check </span>20s</div><div class=\"line\">  server 192_168_59_2_31270 192.168.59.2:31270<span class=\"built_in\"> check </span>inter 60s fall 4</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Haproxy&#x4E2D;&#xFF0C;niginx&#x670D;&#x52A1;&#x7684;&#x524D;&#x7AEF;(frontend)&#x5730;&#x5740;&#x4E3A;: *:10000&#xFF0C;&#x800C;&#x540E;&#x7AEF;(backend)&#x5730;&#x5740;&#x4E3A;: 192.168.59.2:31270&#x3002;Haproxy&#x8D1F;&#x8D23;&#x5C06;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;Nginx&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x7684;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;Marathon LB&#x4F1A;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://192.168.59.1:10000\" target=\"_blank\" rel=\"external\">http://192.168.59.1:10000</a>&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;Marathon LB&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;(IP&#x548C;&#x7AEF;&#x53E3;)&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6237;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x624B;&#x52A8;&#x67E5;&#x8BE2;&#x4E86;&#x3002;<a href=\"https://github.com/QubitProducts/bamboo\" target=\"_blank\" rel=\"external\">bamboo</a>&#x4E0E;<a href=\"https://github.com/martensson/nixy\" target=\"_blank\" rel=\"external\">nixy</a>&#x5B9E;&#x73B0;&#x4E86;&#x540C;&#x6837;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/\" target=\"_blank\" rel=\"external\">Understanding Modern Service Discovery with Docker</a></li>\n<li><a href=\"http://www.eurekao.com/build-paas-platform-base-on-docker/\" target=\"_blank\" rel=\"external\">&#x57FA;&#x4E8E;Docker&#x6280;&#x672F;&#x6784;&#x5EFA;PaaS&#x4E91;&#x5E73;&#x53F0;</a></li>\n<li><a href=\"http://tech.youzan.com/haunt-youzan-service-discovery/\" target=\"_blank\" rel=\"external\">Youzan &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6982;&#x8FF0;</a></li>\n</ol>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x96C6;&#x7FA4;&#x65F6;&#xFF0C;&#x5176;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x5373;<strong>IP</strong>&#x548C;<strong>&#x7AEF;&#x53E3;</strong>, &#x662F;&#x7531;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x786E;&#x5B9A;&#x5B83;&#x7684;&#x5730;&#x5740;&#x5462;&#xFF1F;&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;(Service Discovery)</strong>&#x4E86;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4EE5;Nginx&#x7684;&#x90E8;&#x7F72;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x539F;&#x7406;&#x4E0E;&#x5B9E;&#x8DF5;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/04/what-is-service-discovery/\">2016-09-04</a></li>\n</ul>\n<p><img src=\"/2016/09/04/what-is-service-discovery/service-discovery.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E00;-&#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx\"></a>&#x4E00;. &#x5355;&#x673A;&#x90E8;&#x7F72;Nginx</h2><p><a href=\"https://nginx.org\">Nginx</a>&#x4F5C;&#x4E3A;&#x7F51;&#x9875;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x529F;&#x80FD;&#x4E0E;Apache&#x4E00;&#x81F4;&#x3002;&#x4F7F;&#x7528;<a href=\"https://www.docker.com/\">Docker</a>, &#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x90E8;&#x7F72;Nginx&#x3002;</p>\n<h4 id=\"1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"><a href=\"#1-&#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;\"></a><strong>1. &#x4E0B;&#x8F7D;Nginx&#x955C;&#x50CF;</strong></h4><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">sudo</span> <span class=\"selector-tag\">docker</span> <span class=\"selector-tag\">pull</span> <span class=\"selector-tag\">nginx</span><span class=\"selector-pseudo\">:1.10</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"><a href=\"#2-&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;\"></a><strong>2. &#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;</strong></h4><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">run</span><span class=\"bash\"> <span class=\"_\">-d</span> \\</span></div><div class=\"line\">                -p 8080:80 \\</div><div class=\"line\">                nginx:1.10</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>-d</strong>&#x9009;&#x9879;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF0C;<strong>-p</strong>&#x9009;&#x9879;&#x8868;&#x793A;&#x4E3B;&#x673A;&#x7684;<strong>8080</strong>&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x4E3A;&#x5BB9;&#x5668;&#x7684;<strong>80</strong>&#x7AEF;&#x53E3;&#x3002;</p>\n<h4 id=\"3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"><a href=\"#3-&#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\" class=\"headerlink\" title=\"3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;\"></a><strong>3. &#x8BBF;&#x95EE;Nginx&#x670D;&#x52A1;</strong></h4><p>&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x670D;&#x52A1;Nginx</p>\n<p><a href=\"http://192.168.59.1:8080\">http://192.168.59.1:8080</a></p>\n<p>&#x6216;&#x8005;&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;Nginx, &#x5176;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4E3A;html&#x6587;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">curl</span> 192<span class=\"selector-class\">.168</span><span class=\"selector-class\">.59</span><span class=\"selector-class\">.1</span><span class=\"selector-pseudo\">:8080</span></div></pre></td></tr></table></figure>\n<p>Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x662F;192.168.59.1:8080&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;<strong>192.168.59.1</strong>&#x662F;&#x8FD0;&#x884C;Nginx&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x7684;IP&#xFF0C;&#x800C;<strong>8080</strong>&#x662F;Nginx&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x5355;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x7684;IP&#x5373;&#x4E3A;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x7684;&#x4E3B;&#x673A;IP&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>-p</strong>&#x9009;&#x9879;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#xFF0C;&#x8FD9;&#x65F6;&#x670D;&#x52A1;&#x5730;&#x5740;&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x9759;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5C06;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x5230;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x96C6;&#x7FA4;&#x65F6;&#x5462;&#xFF1F;</p>\n<h2 id=\"&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"><a href=\"#&#x4E8C;-Mesos-Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\" class=\"headerlink\" title=\"&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx\"></a>&#x4E8C;. Mesos/Marathon&#x96C6;&#x7FA4;&#x4E2D;&#x90E8;&#x7F72;Nginx</h2><p>&#x9996;&#x5148;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;&#x7167;<a href=\"http://kiwenlau.com/2016/07/10/mesos-marathon-platform/\">&#x57FA;&#x4E8E;Docker&#x642D;&#x5EFA;&#x591A;&#x8282;&#x70B9;Mesos/Marathon</a>&#x4ECB;&#x7ECD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5FEB;&#x901F;&#x642D;&#x5EFA;3&#x4E2A;&#x8282;&#x70B9;&#x7684;Mesos/Marathon&#x96C6;&#x7FA4;&#x3002;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>\n<p><strong>1. &#x4E0D;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx1.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx1&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>instances</strong>&#x4E3A;1&#xFF0C;&#x8868;&#x793A;&#x4EC5;&#x90E8;&#x7F72;&#x5355;&#x4E2A;Nginx&#x5BB9;&#x5668;; <strong>hostPort</strong>&#x4E3A;0&#xFF0C;&#x8868;&#x793A;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx1.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x53EF;&#x80FD;&#x8FD0;&#x884C;node2(192.168.59.2)&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8FD0;&#x884C;&#x5728;node3(192.168.59.3)&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;Nginx&#x670D;&#x52A1;&#x7684;IP&#x662F;&#x65E0;&#x6CD5;&#x4E8B;&#x5148;&#x786E;&#x5B9A;&#x7684;&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x7AEF;&#x53E3;&#x7531;Marathon&#x968F;&#x673A;&#x5206;&#x914D;&#xFF0C;&#x4E5F;&#x4E0D;&#x786E;&#x5B9A;&#x3002;</p>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>hostPort</strong>&#x6307;&#x5B9A;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x5E76;&#x4E0D;&#x5408;&#x9002;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x7AEF;&#x53E3;&#x51B2;&#x7A81;&#x3002;&#x5F53;&#x96C6;&#x7FA4;&#x4E2D;&#x8FD0;&#x884C;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x65F6;&#xFF0C;<strong>&#x9759;&#x6001;&#x5206;&#x914D;&#x7AEF;&#x53E3;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x4E5F;&#x9650;&#x5236;&#x4E86;&#x96C6;&#x7FA4;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x4E0E;&#x6269;&#x5C55;&#x6027;</strong>&#x3002;</p>\n<p>&#x5728;Slave&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528;<strong>docker ps</strong>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x3002;</p>\n<p>node2(192.168.59.2)</p>\n<figure class=\"highlight dns\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker ps | grep nginx</div><div class=\"line\">b863d<span class=\"number\">407b880</span>        nginx:<span class=\"number\">1</span>.<span class=\"number\">10</span>              &quot;nginx -g &apos;daemon off&quot;   <span class=\"number\">15</span> minutes ago      Up <span class=\"number\">15</span> minutes       <span class=\"number\">443</span>/tcp, <span class=\"number\">0.0.0.0</span>:<span class=\"number\">31575</span>-&gt;<span class=\"number\">80</span>/tcp   mesos-d34d0b5b-c<span class=\"number\">3b1-4020</span>-<span class=\"number\">9</span>bb2-bb8582252bf3-S0.d2de<span class=\"number\">6d05-9751</span>-<span class=\"number\">4</span>fbe-af10-d7e35e9e6c7b</div></pre></td></tr></table></figure>\n<p>node3(192.168.59.3)</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"keyword\">ps</span> | <span class=\"keyword\">grep</span> nginx</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x5206;&#x522B;&#x4E3A;<strong>192.168.59.2</strong>&#x548C;<strong>31575</strong>&#xFF0C;&#x5373;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.2:31575\">http://192.168.59.2:31575</a></p>\n<p>&#x6BCF;&#x6B21;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x5176;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x624B;&#x52A8;&#x53BB;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x5F88;&#x4E0D;&#x65B9;&#x4FBF;&#xFF0C;&#x4E14;&#x65E0;&#x6CD5;&#x5C06;&#x90E8;&#x7F72;&#x4EFB;&#x52A1;&#x81EA;&#x52A8;&#x5316;&#x3002;&#x5728;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x975E;&#x5E38;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x662F;&#x5BB9;&#x5668;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x7684;&#x5FC5;&#x5907;&#x529F;&#x80FD;&#x3002;</p>\n<p><strong>2. &#x4F7F;&#x7528;<a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong></p>\n<p><a href=\"https://github.com/mesosphere/marathon-lb\">Marathon LB</a>&#x662F;Marathon&#x7684;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#x7CFB;&#x7EDF;&#x3002;Marathon LB&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://www.haproxy.org/\">Haproxy</a>&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;Marathon LB&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x56FA;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x7684;IP&#x5C31;&#x662F;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x56FA;&#x5B9A;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;</p>\n<p>Nginx&#x5B9A;&#x4E49;(nginx2.json):</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"attr\">&quot;id&quot;</span>: <span class=\"string\">&quot;nginx2&quot;</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;labels&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;HAPROXY_GROUP&quot;</span>: <span class=\"string\">&quot;external&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    <span class=\"attr\">&quot;cpus&quot;</span>: <span class=\"number\">0.2</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;mem&quot;</span>: <span class=\"number\">20.0</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;instances&quot;</span>: <span class=\"number\">1</span>,</div><div class=\"line\">    <span class=\"attr\">&quot;healthChecks&quot;</span>: [{</div><div class=\"line\">        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/&quot;</span></div><div class=\"line\">    }],</div><div class=\"line\">    <span class=\"attr\">&quot;container&quot;</span>: {</div><div class=\"line\">        <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;DOCKER&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;docker&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;image&quot;</span>: <span class=\"string\">&quot;nginx:1.10&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;network&quot;</span>: <span class=\"string\">&quot;BRIDGE&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">&quot;portMappings&quot;</span>: [{ <span class=\"attr\">&quot;containerPort&quot;</span>: <span class=\"number\">80</span>, <span class=\"attr\">&quot;hostPort&quot;</span>: <span class=\"number\">0</span>, <span class=\"attr\">&quot;servicePort&quot;</span>: <span class=\"number\">10000</span>, <span class=\"attr\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;tcp&quot;</span> }]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;nginx2.json&#x53EA;&#x6709;<strong>HAPROXY_GROUP</strong>&#x4E0E;<strong>servicePort</strong>&#x4E24;&#x5904;&#x4FEE;&#x6539;&#x3002;<strong>HAPROXY_GROUP</strong>&#x4E3A;external&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;&#x5206;&#x7EC4;&#x4E3A;external&#x7684;<strong>Marathon LB</strong>&#x505A;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;<strong>servicePort</strong>&#x4E3A;10000&#xFF0C;&#x8868;&#x793A;Nginx&#x5C06;&#x4F7F;&#x7528;<strong>Marathon LB</strong>&#x8282;&#x70B9;&#x7684;10000&#x7AEF;&#x53E3;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x90E8;&#x7F72;Nginx:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -Ss \\</div><div class=\"line\">     -<span class=\"ruby\">X POST \\</span></div><div class=\"line\">     -<span class=\"ruby\">H <span class=\"string\">&quot;Content-Type: application/json&quot;</span> \\</span></div><div class=\"line\">     -<span class=\"ruby\">-data <span class=\"string\">&quot;@nginx2.json&quot;</span> \\</span></div><div class=\"line\">     http://127.0.0.1:8080/v2/apps | python2.7 -mjson.tool</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;Nginx&#x670D;&#x52A1;&#x7684;IP&#x4E3A;&#x8FD0;&#x884C;Marathon LB&#x7684;&#x8282;&#x70B9;IP&#xFF0C;&#x5373;<strong>192.168.59.1</strong>&#xFF0C;&#x800C;Nginx&#x670D;&#x52A1;&#x7684;&#x7AEF;&#x53E3;&#x4E3A;<strong>servicePort</strong>&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5373;10000&#x3002;&#x56E0;&#x6B64;&#xFF0C;Nginx&#x7684;&#x670D;&#x52A1;&#x5730;&#x5740;&#x4E3A;&#xFF1A;<a href=\"http://192.168.59.1:10000\">http://192.168.59.1:10000</a>&#x3002;&#x800C;Nginx&#x5BB9;&#x5668;&#x7684;&#x5B9E;&#x9645;&#x5730;&#x5740;&#x4E3A;<a href=\"http://192.168.59.2:31270\">http://192.168.59.2:31270</a>&#xFF0C;Marathon LB&#x4F7F;&#x7528;Haproxy&#x4F5C;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8F6C;&#x53D1;&#x7684;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x3002;Marathon LB&#x4F1A;&#x76D1;&#x542C;Marathon&#x7684;&#x8C03;&#x5EA6;&#x4E8B;&#x4EF6;&#xFF0C;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;IP&#x4E0E;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x4E0B;&#x9762;&#x5373;&#x4E3A;Marathon LB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;Haproxy&#x914D;&#x7F6E;&#x6587;&#x4EF6;: </p>\n<figure class=\"highlight smali\"><table><tr><td class=\"code\"><pre><div class=\"line\">frontend nginx2_10000</div><div class=\"line\">  bind *:10000</div><div class=\"line\">  mode http</div><div class=\"line\">  use_backend nginx2_10000</div><div class=\"line\"></div><div class=\"line\">backend nginx2_10000</div><div class=\"line\">  balance roundrobin</div><div class=\"line\">  mode http</div><div class=\"line\">  option forwardfor</div><div class=\"line\">  http-request set-header X-Forwarded-Port %[dst_port]</div><div class=\"line\">  http-request<span class=\"built_in\"> add-header </span>X-Forwarded-Proto https<span class=\"built_in\"> if </span>{ ssl_fc }</div><div class=\"line\">  option  httpchk GET /</div><div class=\"line\">  timeout<span class=\"built_in\"> check </span>20s</div><div class=\"line\">  server 192_168_59_2_31270 192.168.59.2:31270<span class=\"built_in\"> check </span>inter 60s fall 4</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Haproxy&#x4E2D;&#xFF0C;niginx&#x670D;&#x52A1;&#x7684;&#x524D;&#x7AEF;(frontend)&#x5730;&#x5740;&#x4E3A;: *:10000&#xFF0C;&#x800C;&#x540E;&#x7AEF;(backend)&#x5730;&#x5740;&#x4E3A;: 192.168.59.2:31270&#x3002;Haproxy&#x8D1F;&#x8D23;&#x5C06;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;Nginx&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x91CD;&#x65B0;&#x90E8;&#x7F72;Nginx&#x65F6;&#xFF0C;Nginx&#x5BB9;&#x5668;&#x7684;IP&#x548C;&#x7AEF;&#x53E3;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;Marathon LB&#x4F1A;&#x66F4;&#x65B0;Haproxy&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://192.168.59.1:10000\">http://192.168.59.1:10000</a>&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;Marathon LB&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x53D1;&#x73B0;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;(IP&#x548C;&#x7AEF;&#x53E3;)&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6237;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x624B;&#x52A8;&#x67E5;&#x8BE2;&#x4E86;&#x3002;<a href=\"https://github.com/QubitProducts/bamboo\">bamboo</a>&#x4E0E;<a href=\"https://github.com/martensson/nixy\">nixy</a>&#x5B9E;&#x73B0;&#x4E86;&#x540C;&#x6837;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E09;-&#x53C2;&#x8003;\"><a href=\"#&#x4E09;-&#x53C2;&#x8003;\" class=\"headerlink\" title=\"&#x4E09;. &#x53C2;&#x8003;\"></a>&#x4E09;. &#x53C2;&#x8003;</h2><ol>\n<li><a href=\"http://progrium.com/blog/2014/07/29/understanding-modern-service-discovery-with-docker/\">Understanding Modern Service Discovery with Docker</a></li>\n<li><a href=\"http://www.eurekao.com/build-paas-platform-base-on-docker/\">&#x57FA;&#x4E8E;Docker&#x6280;&#x672F;&#x6784;&#x5EFA;PaaS&#x4E91;&#x5E73;&#x53F0;</a></li>\n<li><a href=\"http://tech.youzan.com/haunt-youzan-service-discovery/\">Youzan &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6982;&#x8FF0;</a></li>\n</ol>"},{"title":"Underscore实例教程","date":"2016-09-18T02:00:00.000Z","_content":"\n**摘要:** [Underscore](http://underscorejs.org/)是一个轻量级的JavaScript库，提供了许多非常实用的函数。熟练使用Underscore可以更快地写出更简洁的代码。本文将通过一个简单的编程实例，介绍几个常用的Underscore函数。\n\n**GitHub地址:**\n\n- [kiwenlau/underscore-example](https://github.com/kiwenlau/underscore-example)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-18](http://kiwenlau.com/2016/09/18/underscore-example/)\n\n<img src=\"underscore-example/underscore-example.png\" width = \"500\"/>\n\n## 一. 编程实例\n\n输入数据是一个数组: \n\n```\n[\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n```\n\n其中，数组中存在重复的元素。例如，\"c\"重复了3次。\n\n现在需要**根据元素在数组中的重复个数进行排序**。通过**观察**可知，\"a\"为1个，\"b\"为2个，\"c\"为3个，\"d\"为4个。\n\n因此，输出结果是:\n\n```\n[ 'a', 'b', 'c', 'd' ]\n```\n\n当然，计算机暂时还没办法像人一样通过**观察**解决问题，所以得敲代码...\n\n问题本身很容易理解，但是代码并不好写。不使用underscore的话，程序是这样的:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\n\n// 对数组元素进行计数\nvar A = {};\n\nfor (var i = 0; i < X.length; i++)\n{\n    var x = X[i];\n    if (A.hasOwnProperty(X[i]))\n    {\n        A[x]++;\n    }\n    else\n    {\n        A[x] = 1;\n    }\n}\n\n\n// 将对象转化为二维数组\nvar B = [];\n\nfor (var a in A)\n{\n    B.push([a, A[a]]);\n}\n\n\n// 根据二维数组的第2列元素进行排序\nB.sort(\n    function(a, b)\n    {\n        return a[1] - b[1];\n    }\n);\n\n\n// 获取二维数组的第1列元素\nvar Y = [];\n\nfor (var i = 0; i < B.length; i++)\n{\n    Y.push(B[i][0]);\n}\n\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n虽然我在代码中使用了一些JavasScript自带的库函数例如sort，但是代码仍然比较冗长。\n\n使用了Underscore之后，代码被极大地简化了:\n\n```\nvar _ = require(\"underscore\");\n\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n可知，我使用了4个Underscore函数: [_.countBy](http://underscorejs.org/#countBy)，[_.pairs](http://underscorejs.org/#pairs)，[_.sortBy](http://underscorejs.org/#sortBy)和[_.pluck](http://underscorejs.org/#pluck)。并且通过[_.chain](http://underscorejs.org/#chain)将这4个函数依次链接起来，实现了前一段代码中完全相同的功能。\n\n下面，我会依次介绍代码中所使用的Underscore函数。\n\n## 二. 函数介绍\n\n#### **1. [_.countBy](http://underscorejs.org/#countBy)**\n\n功能: \n\n- 对数组中的元素进行计数\n\n实例:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.countBy(X);\n\nconsole.log(Y); // 输出: { b: 2, d: 4, a: 1, c: 3 }\n```\n\n#### **2. [_.pairs](http://underscorejs.org/#pairs)**\n\n功能: \n\n- 将对象中的属性与属性值转化为键值对数组\n\n实例:\n\n```\nvar X = {\n    b: 2,\n    d: 4,\n    a: 1,\n    c: 3\n}; // 输入\n\nvar Y = _.pairs(X);\n\nconsole.log(Y); // 输出: [ [ 'b', 2 ], [ 'd', 4 ], [ 'a', 1 ], [ 'c', 3 ] ]\n```\n\n#### **3. [_.sortBy](http://underscorejs.org/#sortBy)**\n\n功能: \n\n- 对数组中的元素进行排序；对于二维数组，可以根据某一列的元素值进行排序。\n\n实例:\n\n```\nvar X = [\n    ['b', 2],\n    ['d', 4],\n    ['a', 1],\n    ['c', 3]\n]; // 输入\n\nvar Y = _.sortBy(X, 1); // 根据二维数组的第2列进行排序\n\nconsole.log(Y); // 输出: [ [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ], [ 'd', 4 ] ]\n```\n\n#### **4. [_.pluck](http://underscorejs.org/#pluck)**\n\n功能: \n\n- 获取对象的某个属性的Value列表；或者获取二维数组中的某一列\n\n实例:\n\n```\nvar X = [\n    ['a', 1],\n    ['b', 2],\n    ['c', 3],\n    ['d', 4]\n]; // 输入\n\nvar Y = _.pluck(X, 0); // 获取二维数组的第1列\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n#### **5. [_.chain](http://underscorejs.org/#chain)**\n\n功能: \n\n- 将多个Underscore函数链接起来完成计算任务\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n很多时候，需要使用多个Underscore函数来完成单个计算任务。类似于Linux中的管道，前一个函数的输出是后一个函数的输入，这时可以通过使用[_.chain](http://underscorejs.org/#chain)将多个函数链接起来，最后使用[_.value](http://underscorejs.org/#value)获取计算结果。","source":"_posts/2016/09/18/underscore-example.md","raw":"title: Underscore实例教程\n\ndate: 2016-09-18 10:00\n\ntags: [Node.js]\n\n---\n\n**摘要:** [Underscore](http://underscorejs.org/)是一个轻量级的JavaScript库，提供了许多非常实用的函数。熟练使用Underscore可以更快地写出更简洁的代码。本文将通过一个简单的编程实例，介绍几个常用的Underscore函数。\n\n**GitHub地址:**\n\n- [kiwenlau/underscore-example](https://github.com/kiwenlau/underscore-example)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-18](http://kiwenlau.com/2016/09/18/underscore-example/)\n\n<img src=\"underscore-example/underscore-example.png\" width = \"500\"/>\n\n## 一. 编程实例\n\n输入数据是一个数组: \n\n```\n[\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n```\n\n其中，数组中存在重复的元素。例如，\"c\"重复了3次。\n\n现在需要**根据元素在数组中的重复个数进行排序**。通过**观察**可知，\"a\"为1个，\"b\"为2个，\"c\"为3个，\"d\"为4个。\n\n因此，输出结果是:\n\n```\n[ 'a', 'b', 'c', 'd' ]\n```\n\n当然，计算机暂时还没办法像人一样通过**观察**解决问题，所以得敲代码...\n\n问题本身很容易理解，但是代码并不好写。不使用underscore的话，程序是这样的:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\n\n// 对数组元素进行计数\nvar A = {};\n\nfor (var i = 0; i < X.length; i++)\n{\n    var x = X[i];\n    if (A.hasOwnProperty(X[i]))\n    {\n        A[x]++;\n    }\n    else\n    {\n        A[x] = 1;\n    }\n}\n\n\n// 将对象转化为二维数组\nvar B = [];\n\nfor (var a in A)\n{\n    B.push([a, A[a]]);\n}\n\n\n// 根据二维数组的第2列元素进行排序\nB.sort(\n    function(a, b)\n    {\n        return a[1] - b[1];\n    }\n);\n\n\n// 获取二维数组的第1列元素\nvar Y = [];\n\nfor (var i = 0; i < B.length; i++)\n{\n    Y.push(B[i][0]);\n}\n\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n虽然我在代码中使用了一些JavasScript自带的库函数例如sort，但是代码仍然比较冗长。\n\n使用了Underscore之后，代码被极大地简化了:\n\n```\nvar _ = require(\"underscore\");\n\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"];\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // [ 'a', 'b', 'c', 'd' ]\n```\n\n可知，我使用了4个Underscore函数: [_.countBy](http://underscorejs.org/#countBy)，[_.pairs](http://underscorejs.org/#pairs)，[_.sortBy](http://underscorejs.org/#sortBy)和[_.pluck](http://underscorejs.org/#pluck)。并且通过[_.chain](http://underscorejs.org/#chain)将这4个函数依次链接起来，实现了前一段代码中完全相同的功能。\n\n下面，我会依次介绍代码中所使用的Underscore函数。\n\n## 二. 函数介绍\n\n#### **1. [_.countBy](http://underscorejs.org/#countBy)**\n\n功能: \n\n- 对数组中的元素进行计数\n\n实例:\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.countBy(X);\n\nconsole.log(Y); // 输出: { b: 2, d: 4, a: 1, c: 3 }\n```\n\n#### **2. [_.pairs](http://underscorejs.org/#pairs)**\n\n功能: \n\n- 将对象中的属性与属性值转化为键值对数组\n\n实例:\n\n```\nvar X = {\n    b: 2,\n    d: 4,\n    a: 1,\n    c: 3\n}; // 输入\n\nvar Y = _.pairs(X);\n\nconsole.log(Y); // 输出: [ [ 'b', 2 ], [ 'd', 4 ], [ 'a', 1 ], [ 'c', 3 ] ]\n```\n\n#### **3. [_.sortBy](http://underscorejs.org/#sortBy)**\n\n功能: \n\n- 对数组中的元素进行排序；对于二维数组，可以根据某一列的元素值进行排序。\n\n实例:\n\n```\nvar X = [\n    ['b', 2],\n    ['d', 4],\n    ['a', 1],\n    ['c', 3]\n]; // 输入\n\nvar Y = _.sortBy(X, 1); // 根据二维数组的第2列进行排序\n\nconsole.log(Y); // 输出: [ [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ], [ 'd', 4 ] ]\n```\n\n#### **4. [_.pluck](http://underscorejs.org/#pluck)**\n\n功能: \n\n- 获取对象的某个属性的Value列表；或者获取二维数组中的某一列\n\n实例:\n\n```\nvar X = [\n    ['a', 1],\n    ['b', 2],\n    ['c', 3],\n    ['d', 4]\n]; // 输入\n\nvar Y = _.pluck(X, 0); // 获取二维数组的第1列\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n#### **5. [_.chain](http://underscorejs.org/#chain)**\n\n功能: \n\n- 将多个Underscore函数链接起来完成计算任务\n\n```\nvar X = [\"b\", \"d\", \"a\", \"d\", \"d\", \"b\", \"c\", \"c\", \"d\", \"c\"]; // 输入\n\nvar Y = _.chain(X)\n    .countBy() // 对数组元素进行计数\n    .pairs()   // 将对象转化为二维数组\n    .sortBy(1) // 根据二维数组的第2列元素进行排序\n    .pluck(0)  // 获取二维数组的第1列元素\n    .value();  // 获取计算结果\n\nconsole.log(Y); // 输出: [ 'a', 'b', 'c', 'd' ]\n```\n\n很多时候，需要使用多个Underscore函数来完成单个计算任务。类似于Linux中的管道，前一个函数的输出是后一个函数的输入，这时可以通过使用[_.chain](http://underscorejs.org/#chain)将多个函数链接起来，最后使用[_.value](http://underscorejs.org/#value)获取计算结果。","slug":"2016/09/18/underscore-example","published":1,"updated":"2017-04-10T02:13:01.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemt000nmkfyfhfzdno9","content":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"http://underscorejs.org/\" target=\"_blank\" rel=\"external\">Underscore</a>&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;JavaScript&#x5E93;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x8BB8;&#x591A;&#x975E;&#x5E38;&#x5B9E;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;&#x719F;&#x7EC3;&#x4F7F;&#x7528;Underscore&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x5199;&#x51FA;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x4E2A;&#x5E38;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/underscore-example\" target=\"_blank\" rel=\"external\">kiwenlau/underscore-example</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/18/underscore-example/\">2016-09-18</a></li>\n</ul>\n<p><img src=\"/2016/09/18/underscore-example/underscore-example.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"><a href=\"#&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"></a>&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;</h2><p>&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;: </p>\n<figure class=\"highlight clojure\"><table><tr><td class=\"code\"><pre><div class=\"line\">[<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]<span class=\"comment\">;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;&#x6570;&#x7EC4;&#x4E2D;&#x5B58;&#x5728;&#x91CD;&#x590D;&#x7684;&#x5143;&#x7D20;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x201D;c&#x201D;&#x91CD;&#x590D;&#x4E86;3&#x6B21;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x9700;&#x8981;<strong>&#x6839;&#x636E;&#x5143;&#x7D20;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x91CD;&#x590D;&#x4E2A;&#x6570;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</strong>&#x3002;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x53EF;&#x77E5;&#xFF0C;&#x201D;a&#x201D;&#x4E3A;1&#x4E2A;&#xFF0C;&#x201D;b&#x201D;&#x4E3A;2&#x4E2A;&#xFF0C;&#x201D;c&#x201D;&#x4E3A;3&#x4E2A;&#xFF0C;&#x201D;d&#x201D;&#x4E3A;4&#x4E2A;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x662F;:</p>\n<figure class=\"highlight scheme\"><table><tr><td class=\"code\"><pre><div class=\"line\">[ <span class=\"symbol\">&apos;a</span>&apos;, <span class=\"symbol\">&apos;b</span>&apos;, <span class=\"symbol\">&apos;c</span>&apos;, <span class=\"symbol\">&apos;d</span>&apos; ]</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x8BA1;&#x7B97;&#x673A;&#x6682;&#x65F6;&#x8FD8;&#x6CA1;&#x529E;&#x6CD5;&#x50CF;&#x4EBA;&#x4E00;&#x6837;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x6572;&#x4EE3;&#x7801;&#x2026;</p>\n<p>&#x95EE;&#x9898;&#x672C;&#x8EAB;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x597D;&#x5199;&#x3002;&#x4E0D;&#x4F7F;&#x7528;underscore&#x7684;&#x8BDD;&#xFF0C;&#x7A0B;&#x5E8F;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\"><span class=\"keyword\">var</span> A = {};</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; X.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> x = X[i];</div><div class=\"line\">    <span class=\"keyword\">if</span> (A.hasOwnProperty(X[i]))</div><div class=\"line\">    {</div><div class=\"line\">        A[x]++;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        A[x] = <span class=\"number\">1</span>;</div><div class=\"line\">    }</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\"><span class=\"keyword\">var</span> B = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a <span class=\"keyword\">in</span> A)</div><div class=\"line\">{</div><div class=\"line\">    B.push([a, A[a]]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">B.sort(</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> a[<span class=\"number\">1</span>] - b[<span class=\"number\">1</span>];</div><div class=\"line\">    }</div><div class=\"line\">);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\"><span class=\"keyword\">var</span> Y = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; B.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    Y.push(B[i][<span class=\"number\">0</span>]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">console</span>.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x867D;&#x7136;&#x6211;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;JavasScript&#x81EA;&#x5E26;&#x7684;&#x5E93;&#x51FD;&#x6570;&#x4F8B;&#x5982;sort&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x6BD4;&#x8F83;&#x5197;&#x957F;&#x3002;</p>\n<p>&#x4F7F;&#x7528;&#x4E86;Underscore&#x4E4B;&#x540E;&#xFF0C;&#x4EE3;&#x7801;&#x88AB;&#x6781;&#x5927;&#x5730;&#x7B80;&#x5316;&#x4E86;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> <span class=\"literal\">_</span> = require(<span class=\"string\">&quot;underscore&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.chain(X)</div><div class=\"line\">    .countBy() <span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\">    .pairs()   <span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\">    .value();  <span class=\"comment\">// &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</span></div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4E86;4&#x4E2A;Underscore&#x51FD;&#x6570;: <a href=\"http://underscorejs.org/#countBy\" target=\"_blank\" rel=\"external\">_.countBy</a>&#xFF0C;<a href=\"http://underscorejs.org/#pairs\" target=\"_blank\" rel=\"external\">_.pairs</a>&#xFF0C;<a href=\"http://underscorejs.org/#sortBy\" target=\"_blank\" rel=\"external\">_.sortBy</a>&#x548C;<a href=\"http://underscorejs.org/#pluck\" target=\"_blank\" rel=\"external\">_.pluck</a>&#x3002;&#x5E76;&#x4E14;&#x901A;&#x8FC7;<a href=\"http://underscorejs.org/#chain\" target=\"_blank\" rel=\"external\">_.chain</a>&#x5C06;&#x8FD9;4&#x4E2A;&#x51FD;&#x6570;&#x4F9D;&#x6B21;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x524D;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4F1A;&#x4F9D;&#x6B21;&#x4ECB;&#x7ECD;&#x4EE3;&#x7801;&#x4E2D;&#x6240;&#x4F7F;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"></a>&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;</h2><h4 id=\"1-countBy\"><a href=\"#1-countBy\" class=\"headerlink\" title=\"1. _.countBy\"></a><strong>1. <a href=\"http://underscorejs.org/#countBy\" target=\"_blank\" rel=\"external\">_.countBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"comment\">// &#x8F93;&#x5165;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.countBy(X);</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// &#x8F93;&#x51FA;: { b: 2, d: 4, a: 1, c: 3 }</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-pairs\"><a href=\"#2-pairs\" class=\"headerlink\" title=\"2. _.pairs\"></a><strong>2. <a href=\"http://underscorejs.org/#pairs\" target=\"_blank\" rel=\"external\">_.pairs</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x5C5E;&#x6027;&#x503C;&#x8F6C;&#x5316;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = {</div><div class=\"line\">    b: <span class=\"number\">2</span>,</div><div class=\"line\">    d: <span class=\"number\">4</span>,</div><div class=\"line\">    a: <span class=\"number\">1</span>,</div><div class=\"line\">    c: <span class=\"number\">3</span></div><div class=\"line\">}; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pairs(<span class=\"symbol\">X</span>);</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ], [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"3-sortBy\"><a href=\"#3-sortBy\" class=\"headerlink\" title=\"3. _.sortBy\"></a><strong>3. <a href=\"http://underscorejs.org/#sortBy\" target=\"_blank\" rel=\"external\">_.sortBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1B;&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x67D0;&#x4E00;&#x5217;&#x7684;&#x5143;&#x7D20;&#x503C;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.sortBy(<span class=\"symbol\">X</span>, <span class=\"number\">1</span>); // &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"4-pluck\"><a href=\"#4-pluck\" class=\"headerlink\" title=\"4. _.pluck\"></a><strong>4. <a href=\"http://underscorejs.org/#pluck\" target=\"_blank\" rel=\"external\">_.pluck</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x7684;Value&#x5217;&#x8868;&#xFF1B;&#x6216;&#x8005;&#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x67D0;&#x4E00;&#x5217;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pluck(<span class=\"symbol\">X</span>, <span class=\"number\">0</span>); // &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<h4 id=\"5-chain\"><a href=\"#5-chain\" class=\"headerlink\" title=\"5. _.chain\"></a><strong>5. <a href=\"http://underscorejs.org/#chain\" target=\"_blank\" rel=\"external\">_.chain</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x5B8C;&#x6210;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">var X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"regexp\">//</span> &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var Y = _.chain(X)</div><div class=\"line\">    .countBy() <span class=\"regexp\">//</span> &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</div><div class=\"line\">    .pairs()   <span class=\"regexp\">//</span> &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"regexp\">//</span> &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;&#x5143;&#x7D20;</div><div class=\"line\">    .value();  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"regexp\">//</span> &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<p>&#x5F88;&#x591A;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x6765;&#x5B8C;&#x6210;&#x5355;&#x4E2A;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x540E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#chain\" target=\"_blank\" rel=\"external\">_.chain</a>&#x5C06;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#value\" target=\"_blank\" rel=\"external\">_.value</a>&#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x3002;</p>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> <a href=\"http://underscorejs.org/\">Underscore</a>&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;JavaScript&#x5E93;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x8BB8;&#x591A;&#x975E;&#x5E38;&#x5B9E;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;&#x719F;&#x7EC3;&#x4F7F;&#x7528;Underscore&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x5199;&#x51FA;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x4E2A;&#x5E38;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/underscore-example\">kiwenlau/underscore-example</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/18/underscore-example/\">2016-09-18</a></li>\n</ul>\n<p><img src=\"/2016/09/18/underscore-example/underscore-example.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"><a href=\"#&#x4E00;-&#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\" class=\"headerlink\" title=\"&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;\"></a>&#x4E00;. &#x7F16;&#x7A0B;&#x5B9E;&#x4F8B;</h2><p>&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;: </p>\n<figure class=\"highlight clojure\"><table><tr><td class=\"code\"><pre><div class=\"line\">[<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]<span class=\"comment\">;</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;&#x6570;&#x7EC4;&#x4E2D;&#x5B58;&#x5728;&#x91CD;&#x590D;&#x7684;&#x5143;&#x7D20;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x201D;c&#x201D;&#x91CD;&#x590D;&#x4E86;3&#x6B21;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x9700;&#x8981;<strong>&#x6839;&#x636E;&#x5143;&#x7D20;&#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x91CD;&#x590D;&#x4E2A;&#x6570;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</strong>&#x3002;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x53EF;&#x77E5;&#xFF0C;&#x201D;a&#x201D;&#x4E3A;1&#x4E2A;&#xFF0C;&#x201D;b&#x201D;&#x4E3A;2&#x4E2A;&#xFF0C;&#x201D;c&#x201D;&#x4E3A;3&#x4E2A;&#xFF0C;&#x201D;d&#x201D;&#x4E3A;4&#x4E2A;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x662F;:</p>\n<figure class=\"highlight scheme\"><table><tr><td class=\"code\"><pre><div class=\"line\">[ <span class=\"symbol\">&apos;a</span>&apos;, <span class=\"symbol\">&apos;b</span>&apos;, <span class=\"symbol\">&apos;c</span>&apos;, <span class=\"symbol\">&apos;d</span>&apos; ]</div></pre></td></tr></table></figure>\n<p>&#x5F53;&#x7136;&#xFF0C;&#x8BA1;&#x7B97;&#x673A;&#x6682;&#x65F6;&#x8FD8;&#x6CA1;&#x529E;&#x6CD5;&#x50CF;&#x4EBA;&#x4E00;&#x6837;&#x901A;&#x8FC7;<strong>&#x89C2;&#x5BDF;</strong>&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x6572;&#x4EE3;&#x7801;&#x2026;</p>\n<p>&#x95EE;&#x9898;&#x672C;&#x8EAB;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x597D;&#x5199;&#x3002;&#x4E0D;&#x4F7F;&#x7528;underscore&#x7684;&#x8BDD;&#xFF0C;&#x7A0B;&#x5E8F;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\"><span class=\"keyword\">var</span> A = {};</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; X.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> x = X[i];</div><div class=\"line\">    <span class=\"keyword\">if</span> (A.hasOwnProperty(X[i]))</div><div class=\"line\">    {</div><div class=\"line\">        A[x]++;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        A[x] = <span class=\"number\">1</span>;</div><div class=\"line\">    }</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\"><span class=\"keyword\">var</span> B = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> a <span class=\"keyword\">in</span> A)</div><div class=\"line\">{</div><div class=\"line\">    B.push([a, A[a]]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">B.sort(</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> a[<span class=\"number\">1</span>] - b[<span class=\"number\">1</span>];</div><div class=\"line\">    }</div><div class=\"line\">);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\"><span class=\"keyword\">var</span> Y = [];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; B.length; i++)</div><div class=\"line\">{</div><div class=\"line\">    Y.push(B[i][<span class=\"number\">0</span>]);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">console</span>.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x867D;&#x7136;&#x6211;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;JavasScript&#x81EA;&#x5E26;&#x7684;&#x5E93;&#x51FD;&#x6570;&#x4F8B;&#x5982;sort&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x6BD4;&#x8F83;&#x5197;&#x957F;&#x3002;</p>\n<p>&#x4F7F;&#x7528;&#x4E86;Underscore&#x4E4B;&#x540E;&#xFF0C;&#x4EE3;&#x7801;&#x88AB;&#x6781;&#x5927;&#x5730;&#x7B80;&#x5316;&#x4E86;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> <span class=\"literal\">_</span> = require(<span class=\"string\">&quot;underscore&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.chain(X)</div><div class=\"line\">    .countBy() <span class=\"comment\">// &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</span></div><div class=\"line\">    .pairs()   <span class=\"comment\">// &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</span></div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"comment\">// &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;2&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</span></div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"comment\">// &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;1&#x5217;&#x5143;&#x7D20;</span></div><div class=\"line\">    .value();  <span class=\"comment\">// &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</span></div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// [ &apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos; ]</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4E86;4&#x4E2A;Underscore&#x51FD;&#x6570;: <a href=\"http://underscorejs.org/#countBy\">_.countBy</a>&#xFF0C;<a href=\"http://underscorejs.org/#pairs\">_.pairs</a>&#xFF0C;<a href=\"http://underscorejs.org/#sortBy\">_.sortBy</a>&#x548C;<a href=\"http://underscorejs.org/#pluck\">_.pluck</a>&#x3002;&#x5E76;&#x4E14;&#x901A;&#x8FC7;<a href=\"http://underscorejs.org/#chain\">_.chain</a>&#x5C06;&#x8FD9;4&#x4E2A;&#x51FD;&#x6570;&#x4F9D;&#x6B21;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x524D;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<p>&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4F1A;&#x4F9D;&#x6B21;&#x4ECB;&#x7ECD;&#x4EE3;&#x7801;&#x4E2D;&#x6240;&#x4F7F;&#x7528;&#x7684;Underscore&#x51FD;&#x6570;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"><a href=\"#&#x4E8C;-&#x51FD;&#x6570;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;\"></a>&#x4E8C;. &#x51FD;&#x6570;&#x4ECB;&#x7ECD;</h2><h4 id=\"1-countBy\"><a href=\"#1-countBy\" class=\"headerlink\" title=\"1. _.countBy\"></a><strong>1. <a href=\"http://underscorejs.org/#countBy\">_.countBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight haxe\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"comment\">// &#x8F93;&#x5165;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> Y = <span class=\"literal\">_</span>.countBy(X);</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"comment\">// &#x8F93;&#x51FA;: { b: 2, d: 4, a: 1, c: 3 }</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-pairs\"><a href=\"#2-pairs\" class=\"headerlink\" title=\"2. _.pairs\"></a><strong>2. <a href=\"http://underscorejs.org/#pairs\">_.pairs</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x4E0E;&#x5C5E;&#x6027;&#x503C;&#x8F6C;&#x5316;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = {</div><div class=\"line\">    b: <span class=\"number\">2</span>,</div><div class=\"line\">    d: <span class=\"number\">4</span>,</div><div class=\"line\">    a: <span class=\"number\">1</span>,</div><div class=\"line\">    c: <span class=\"number\">3</span></div><div class=\"line\">}; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pairs(<span class=\"symbol\">X</span>);</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ], [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"3-sortBy\"><a href=\"#3-sortBy\" class=\"headerlink\" title=\"3. _.sortBy\"></a><strong>3. <a href=\"http://underscorejs.org/#sortBy\">_.sortBy</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5BF9;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1B;&#x5BF9;&#x4E8E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x67D0;&#x4E00;&#x5217;&#x7684;&#x5143;&#x7D20;&#x503C;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.sortBy(<span class=\"symbol\">X</span>, <span class=\"number\">1</span>); // &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span> ], [ <span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span> ], [ <span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span> ], [ <span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span> ] ]</div></pre></td></tr></table></figure>\n<h4 id=\"4-pluck\"><a href=\"#4-pluck\" class=\"headerlink\" title=\"4. _.pluck\"></a><strong>4. <a href=\"http://underscorejs.org/#pluck\">_.pluck</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7684;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x7684;Value&#x5217;&#x8868;&#xFF1B;&#x6216;&#x8005;&#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x67D0;&#x4E00;&#x5217;</li>\n</ul>\n<p>&#x5B9E;&#x4F8B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">var <span class=\"symbol\">X</span> = [</div><div class=\"line\">    [<span class=\"string\">&apos;a&apos;</span>, <span class=\"number\">1</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;b&apos;</span>, <span class=\"number\">2</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;c&apos;</span>, <span class=\"number\">3</span>],</div><div class=\"line\">    [<span class=\"string\">&apos;d&apos;</span>, <span class=\"number\">4</span>]</div><div class=\"line\">]; // &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var <span class=\"symbol\">Y</span> = <span class=\"symbol\">_</span>.pluck(<span class=\"symbol\">X</span>, <span class=\"number\">0</span>); // &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;</div><div class=\"line\"></div><div class=\"line\">console.log(<span class=\"symbol\">Y</span>); // &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<h4 id=\"5-chain\"><a href=\"#5-chain\" class=\"headerlink\" title=\"5. _.chain\"></a><strong>5. <a href=\"http://underscorejs.org/#chain\">_.chain</a></strong></h4><p>&#x529F;&#x80FD;: </p>\n<ul>\n<li>&#x5C06;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x5B8C;&#x6210;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;</li>\n</ul>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">var X = [<span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;b&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;c&quot;</span>, <span class=\"string\">&quot;d&quot;</span>, <span class=\"string\">&quot;c&quot;</span>]; <span class=\"regexp\">//</span> &#x8F93;&#x5165;</div><div class=\"line\"></div><div class=\"line\">var Y = _.chain(X)</div><div class=\"line\">    .countBy() <span class=\"regexp\">//</span> &#x5BF9;&#x6570;&#x7EC4;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8BA1;&#x6570;</div><div class=\"line\">    .pairs()   <span class=\"regexp\">//</span> &#x5C06;&#x5BF9;&#x8C61;&#x8F6C;&#x5316;&#x4E3A;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;</div><div class=\"line\">    .sortBy(<span class=\"number\">1</span>) <span class=\"regexp\">//</span> &#x6839;&#x636E;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">2</span>&#x5217;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</div><div class=\"line\">    .pluck(<span class=\"number\">0</span>)  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#x7684;&#x7B2C;<span class=\"number\">1</span>&#x5217;&#x5143;&#x7D20;</div><div class=\"line\">    .value();  <span class=\"regexp\">//</span> &#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;</div><div class=\"line\"></div><div class=\"line\">console.log(Y); <span class=\"regexp\">//</span> &#x8F93;&#x51FA;: [ <span class=\"string\">&apos;a&apos;</span>, <span class=\"string\">&apos;b&apos;</span>, <span class=\"string\">&apos;c&apos;</span>, <span class=\"string\">&apos;d&apos;</span> ]</div></pre></td></tr></table></figure>\n<p>&#x5F88;&#x591A;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x591A;&#x4E2A;Underscore&#x51FD;&#x6570;&#x6765;&#x5B8C;&#x6210;&#x5355;&#x4E2A;&#x8BA1;&#x7B97;&#x4EFB;&#x52A1;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x540E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#chain\">_.chain</a>&#x5C06;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x4F7F;&#x7528;<a href=\"http://underscorejs.org/#value\">_.value</a>&#x83B7;&#x53D6;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x3002;</p>"},{"title":"MongoDB优化之倒排索引","date":"2016-09-11T02:00:00.000Z","_content":"\n**摘要:** 为MongoDB中的数据构建倒排索引(Inverted Index)，然后缓存到内存中，可以大幅提升搜索性能。本文将通过为电影数据构建演员索引，介绍两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)和[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n**GitHub地址:**\n\n- [kiwenlau/mongodb-inverted-index](https://github.com/kiwenlau/mongodb-inverted-index)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-11](http://kiwenlau.com/2016/09/11/mongodb-inverted-index/)\n\n<img src=\"mongodb-inverted-index/mongodb-inverted-index.png\" width = \"500\"/>\n\n## 一. 倒排索引\n\n倒排索引(Inverted Index)，也称为反向索引，[维基百科](https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95)的定义是这样的:\n\n> 是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。\n\n这个定义比较学术，也就是比较反人类，忽略...\n\n倒排索引是搜索引擎中的核心数据结构。搜索引擎的爬虫获取的网页数据可以视为键值对，其中，Key是网页地址(url)，而Value是网页内容。网页的内容是由很多关键词(word)组成的，可以视为关键词数组。因此，爬虫获取的网页数据可以这样表示:\n\n```\n<url1, [word2, word3]>\n<url2, [word2]>\n<url3, [word1, word2]>\n```\n\n但是，用户是通过关键词进行搜索的，直接使用原始数据进行查询的话则需要遍历所有键值对中的关键词数组，效率是非常低的。\n\n因此，用于搜索的数据结构应该以关键词(word)为Key，以网页地址(url)为Value:\n\n```\n<word1, [url3]>\n<word2, [ur1, url2, url3]>\n<word3, [url1]>\n```\n\n这样的话，查询关键词word2，立即能够获取结果: [ur1, url2, url3]。\n\n简单地说，**倒排索引就是把Key与Value对调之后的索引**，构建倒排索引的目的是提升搜索性能。\n\n## 二. 测试数据\n\n[MongoDB](https://www.mongodb.com/)是文档型数据库，其数据有三个层级: 数据库(database)，集合(collection)和文档(document)，分别对应关系型数据库中的三个层级的: 数据库(database), 表(table)，行(row)。MongDB中每个的文档是一个JSON文件，例如，本文使用的movie集合中的一个文档如下所示:\n\n```\n{\n\t\"_id\" : ObjectId(\"57d02d60b128567fc130287d\"),\n\t\"movie\" : \"Pride & Prejudice\",\n\t\"starList\" : [\n\t\t\"Keira Knightley\",\n\t\t\"Matthew Macfadyen\"\n\t],\n\t\"__v\" : 0\n}\n```\n\n该文档一共有4个属性:\n\n- _id: 文档ID，由MongoDB自动生成。\n- __v: 文档版本，由MongoDB的NodeJS接口Mongoose自动生成。\n- movie: 电影名称。\n- starList: 演员列表。 \n\n可知，这个文档表示电影[《傲慢与偏见》](https://movie.douban.com/subject/1418200/)，由女神[凯拉·奈特莉](https://movie.douban.com/celebrity/1054448/)主演。\n\n忽略`_id`与`__v`，movie集合的数据如下:\n\n```\n{\n    \"movie\": \"Pride & Prejudice\",\n    \"starList\": [\"Keira Knightley\", \"Matthew Macfadyen\"]\n},\n{\n    \"movie\": \"Begin Again\",\n    \"starList\": [\"Keira Knightley\", \"Mark Ruffalo\"]\n},\n{\n    \"movie\": \"The Imitation Game\",\n    \"starList\": [\"Keira Knightley\", \"Benedict Cumberbatch\"]\n}\n```\n\n其中，Key为电影名称(movie)，而Value为演员列表(starList)。\n\n这时查询Keira Knightley所主演的电影的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js)如下:\n\n```\nMovie.find(\n{\n    starList: \"Keira Knightley\"\n},\n{\n    _id: 0,\n    movie: 1\n}, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"search movie success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n- 注：本文所有代码使用了MongoDB的NodeJS接口[Mongoose](http://mongoosejs.com/)，它与MongoDB Shell的接口基本一致。\n\n代码并不复杂，但是数据量大时查询性能会很差，因为这个查询需要:\n\n- 遍历整个movie集合的所有文档\n- 遍历每个文档的startList数组\n\n构建倒排索引可以有效地提升搜索性能。本文将介绍MongoDB中两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)与[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n\n## 三 MapReduce\n\n[MapReduce](http://research.google.com/archive/mapreduce.html)是由谷歌提出的编程模型，适用于多种大数据处理场景，在搜索引擎中，MapReduce可以用于构建网页数据的倒排索引，也可以用于编写网页排序算法PageRank(由谷歌创始人佩奇和布林提出)。\n\nMapReduce的输入数据与输出数据均为键值对。MapReduce分为两个函数: Map与Reduce。\n\n- Map函数将输入键值`<k1, v1>`对进行变换，输出中间键值对`<k2, v2>`。\n- MapReduce框架会自动对中间键值对`<k2, v2>`进行分组，Key相同的键值对会被合并为一个键值对`<k2, list(v2)>`。\n- Reduce函数对`<k2, list(v2)>`的Value进行合并，生成结果键值对`<k2, v3>`。\n\n使用MapReduce构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js)如下:\n\n```\nvar option = {};\n\noption.map = function()\n{\n    var movie = this.movie;\n    this.starList.forEach(function(star)\n    {\n        emit(star,\n        {\n            movieList: [movie]\n        });\n    });\n};\n\noption.reduce = function(key, values)\n{\n    var movieList = [];\n    values.forEach(function(value)\n    {\n        movieList.push(value.movieList[0]);\n    });\n    return {\n        movieList: movieList\n    };\n};\n\nMovie.mapReduce(option, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- Map函数的输入数据是Movie集合中的各个文档，在代码中用this表示。文档的movie与starList属性构成键值对`<movie, starList>`。Map函数遍历starList，为每个start生成键值对`<star, movieList>`。这时Key与Value进行了对调，且starList被拆分了，movieList仅包含单个movie。\n- MongoDB的MapReduce执行框架对成键值对`<star, movieList>`进行分组，star相同的键值对会被合并为一个键值对`<star, list(movieList)>`。这一步是自动进行的，因此在代码中并没有体现。\n- Reduce函数的输入数据是键值对`<star, list(movieList)>`，在代码中，star即为key，而list(movieList)即为values，两者为Reduce函数的参数。Reduce函数合并list(movieList)，从而得到键值对`<star, movieList>`，最终，movieList中将包含该star的所有movie。\n\n在代码中，Map函数与Reduce返回的键值对中的Value是一个对象`{ movieList: movieList }`，而不是数组`movieList`，因此代码和结果都显得比较奇怪。MongoDB的MapReduce框架不支持Reduce函数返回数组，因此只能将movieList放在对象里面返回。\n\n输出结果:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"value\": {\n            \"movieList\": [\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\",\n                \"Begin Again\",\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"value\": {\n            \"movieList\": [\n                \"Begin Again\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\"\n            ]\n        }\n    }\n]\n```\n\n## 四. Aggregation Pipeline\n\n[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)，中文称作聚合管道，用于汇总MongoDB中多个文档中的数据，也可以用于构建倒排索引。\n\nAggregation Pipeline进行各种[聚合操作](https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/)，并且可以将多个聚合操作组合使用，类似于Linux中的管道操作，前一个操作的输出是下一个操作的输入。\n\n使用Aggregation Pipeline构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js)如下:\n\n```\nMovie.aggregate([\n{\n    \"$unwind\": \"$starList\"\n},\n{\n    \"$group\":\n    {\n        \"_id\": \"$starList\",\n        \"movieList\":\n        {\n            \"$push\": \"$movie\"\n        }\n    }\n},\n{\n    \"$project\":\n    {\n        \"_id\": 0,\n        \"star\": \"$_id\",\n        \"movieList\": 1\n    }\n}], function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- $unwind: 将starList拆分，输出结果(忽略`_id`与`__v`)为:\n\n```\n[\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Matthew Macfadyen\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Mark Ruffalo\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Benedict Cumberbatch\"\n    }\n]\n```\n\n- $group: 根据文档的starList属性进行分组，然后将分组文档的movie属性合并为movieList，输出结果为:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"movieList\": [\n            \"The Imitation Game\"\n        ]\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"movieList\": [\n            \"Pride & Prejudice\"\n        ]\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"movieList\": [\n            \"Begin Again\"\n        ]\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"movieList\": [\n            \"Pride & Prejudice\",\n            \"Begin Again\",\n            \"The Imitation Game\"\n        ]\n    }\n]\n```\n","source":"_posts/2016/09/11/mongodb-inverted-index.md","raw":"title: MongoDB优化之倒排索引\n\ndate: 2016-09-11 10:00\n\ntags: [MongoDB]\n\n---\n\n**摘要:** 为MongoDB中的数据构建倒排索引(Inverted Index)，然后缓存到内存中，可以大幅提升搜索性能。本文将通过为电影数据构建演员索引，介绍两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)和[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n**GitHub地址:**\n\n- [kiwenlau/mongodb-inverted-index](https://github.com/kiwenlau/mongodb-inverted-index)\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-09-11](http://kiwenlau.com/2016/09/11/mongodb-inverted-index/)\n\n<img src=\"mongodb-inverted-index/mongodb-inverted-index.png\" width = \"500\"/>\n\n## 一. 倒排索引\n\n倒排索引(Inverted Index)，也称为反向索引，[维基百科](https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95)的定义是这样的:\n\n> 是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射。\n\n这个定义比较学术，也就是比较反人类，忽略...\n\n倒排索引是搜索引擎中的核心数据结构。搜索引擎的爬虫获取的网页数据可以视为键值对，其中，Key是网页地址(url)，而Value是网页内容。网页的内容是由很多关键词(word)组成的，可以视为关键词数组。因此，爬虫获取的网页数据可以这样表示:\n\n```\n<url1, [word2, word3]>\n<url2, [word2]>\n<url3, [word1, word2]>\n```\n\n但是，用户是通过关键词进行搜索的，直接使用原始数据进行查询的话则需要遍历所有键值对中的关键词数组，效率是非常低的。\n\n因此，用于搜索的数据结构应该以关键词(word)为Key，以网页地址(url)为Value:\n\n```\n<word1, [url3]>\n<word2, [ur1, url2, url3]>\n<word3, [url1]>\n```\n\n这样的话，查询关键词word2，立即能够获取结果: [ur1, url2, url3]。\n\n简单地说，**倒排索引就是把Key与Value对调之后的索引**，构建倒排索引的目的是提升搜索性能。\n\n## 二. 测试数据\n\n[MongoDB](https://www.mongodb.com/)是文档型数据库，其数据有三个层级: 数据库(database)，集合(collection)和文档(document)，分别对应关系型数据库中的三个层级的: 数据库(database), 表(table)，行(row)。MongDB中每个的文档是一个JSON文件，例如，本文使用的movie集合中的一个文档如下所示:\n\n```\n{\n\t\"_id\" : ObjectId(\"57d02d60b128567fc130287d\"),\n\t\"movie\" : \"Pride & Prejudice\",\n\t\"starList\" : [\n\t\t\"Keira Knightley\",\n\t\t\"Matthew Macfadyen\"\n\t],\n\t\"__v\" : 0\n}\n```\n\n该文档一共有4个属性:\n\n- _id: 文档ID，由MongoDB自动生成。\n- __v: 文档版本，由MongoDB的NodeJS接口Mongoose自动生成。\n- movie: 电影名称。\n- starList: 演员列表。 \n\n可知，这个文档表示电影[《傲慢与偏见》](https://movie.douban.com/subject/1418200/)，由女神[凯拉·奈特莉](https://movie.douban.com/celebrity/1054448/)主演。\n\n忽略`_id`与`__v`，movie集合的数据如下:\n\n```\n{\n    \"movie\": \"Pride & Prejudice\",\n    \"starList\": [\"Keira Knightley\", \"Matthew Macfadyen\"]\n},\n{\n    \"movie\": \"Begin Again\",\n    \"starList\": [\"Keira Knightley\", \"Mark Ruffalo\"]\n},\n{\n    \"movie\": \"The Imitation Game\",\n    \"starList\": [\"Keira Knightley\", \"Benedict Cumberbatch\"]\n}\n```\n\n其中，Key为电影名称(movie)，而Value为演员列表(starList)。\n\n这时查询Keira Knightley所主演的电影的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js)如下:\n\n```\nMovie.find(\n{\n    starList: \"Keira Knightley\"\n},\n{\n    _id: 0,\n    movie: 1\n}, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"search movie success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n- 注：本文所有代码使用了MongoDB的NodeJS接口[Mongoose](http://mongoosejs.com/)，它与MongoDB Shell的接口基本一致。\n\n代码并不复杂，但是数据量大时查询性能会很差，因为这个查询需要:\n\n- 遍历整个movie集合的所有文档\n- 遍历每个文档的startList数组\n\n构建倒排索引可以有效地提升搜索性能。本文将介绍MongoDB中两种构建倒排索引的方法：[MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)与[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)。\n\n\n## 三 MapReduce\n\n[MapReduce](http://research.google.com/archive/mapreduce.html)是由谷歌提出的编程模型，适用于多种大数据处理场景，在搜索引擎中，MapReduce可以用于构建网页数据的倒排索引，也可以用于编写网页排序算法PageRank(由谷歌创始人佩奇和布林提出)。\n\nMapReduce的输入数据与输出数据均为键值对。MapReduce分为两个函数: Map与Reduce。\n\n- Map函数将输入键值`<k1, v1>`对进行变换，输出中间键值对`<k2, v2>`。\n- MapReduce框架会自动对中间键值对`<k2, v2>`进行分组，Key相同的键值对会被合并为一个键值对`<k2, list(v2)>`。\n- Reduce函数对`<k2, list(v2)>`的Value进行合并，生成结果键值对`<k2, v3>`。\n\n使用MapReduce构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js)如下:\n\n```\nvar option = {};\n\noption.map = function()\n{\n    var movie = this.movie;\n    this.starList.forEach(function(star)\n    {\n        emit(star,\n        {\n            movieList: [movie]\n        });\n    });\n};\n\noption.reduce = function(key, values)\n{\n    var movieList = [];\n    values.forEach(function(value)\n    {\n        movieList.push(value.movieList[0]);\n    });\n    return {\n        movieList: movieList\n    };\n};\n\nMovie.mapReduce(option, function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- Map函数的输入数据是Movie集合中的各个文档，在代码中用this表示。文档的movie与starList属性构成键值对`<movie, starList>`。Map函数遍历starList，为每个start生成键值对`<star, movieList>`。这时Key与Value进行了对调，且starList被拆分了，movieList仅包含单个movie。\n- MongoDB的MapReduce执行框架对成键值对`<star, movieList>`进行分组，star相同的键值对会被合并为一个键值对`<star, list(movieList)>`。这一步是自动进行的，因此在代码中并没有体现。\n- Reduce函数的输入数据是键值对`<star, list(movieList)>`，在代码中，star即为key，而list(movieList)即为values，两者为Reduce函数的参数。Reduce函数合并list(movieList)，从而得到键值对`<star, movieList>`，最终，movieList中将包含该star的所有movie。\n\n在代码中，Map函数与Reduce返回的键值对中的Value是一个对象`{ movieList: movieList }`，而不是数组`movieList`，因此代码和结果都显得比较奇怪。MongoDB的MapReduce框架不支持Reduce函数返回数组，因此只能将movieList放在对象里面返回。\n\n输出结果:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"value\": {\n            \"movieList\": [\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\",\n                \"Begin Again\",\n                \"The Imitation Game\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"value\": {\n            \"movieList\": [\n                \"Begin Again\"\n            ]\n        }\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"value\": {\n            \"movieList\": [\n                \"Pride & Prejudice\"\n            ]\n        }\n    }\n]\n```\n\n## 四. Aggregation Pipeline\n\n[Aggregation Pipeline](https://docs.mongodb.com/manual/core/aggregation-pipeline/)，中文称作聚合管道，用于汇总MongoDB中多个文档中的数据，也可以用于构建倒排索引。\n\nAggregation Pipeline进行各种[聚合操作](https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/)，并且可以将多个聚合操作组合使用，类似于Linux中的管道操作，前一个操作的输出是下一个操作的输入。\n\n使用Aggregation Pipeline构建倒排索引的NodeJS[代码](https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js)如下:\n\n```\nMovie.aggregate([\n{\n    \"$unwind\": \"$starList\"\n},\n{\n    \"$group\":\n    {\n        \"_id\": \"$starList\",\n        \"movieList\":\n        {\n            \"$push\": \"$movie\"\n        }\n    }\n},\n{\n    \"$project\":\n    {\n        \"_id\": 0,\n        \"star\": \"$_id\",\n        \"movieList\": 1\n    }\n}], function(err, results)\n{\n    if (err)\n    {\n        console.log(err);\n        process.exit(1);\n    }\n    console.log(\"create inverted index success:\\n\");\n    console.log(JSON.stringify(results, null, 4));\n    process.exit(0);\n});\n```\n\n代码解释:\n\n- $unwind: 将starList拆分，输出结果(忽略`_id`与`__v`)为:\n\n```\n[\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Pride & Prejudice\",\n        \"starList\": \"Matthew Macfadyen\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"Begin Again\",\n        \"starList\": \"Mark Ruffalo\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Keira Knightley\"\n    },\n    {\n        \"movie\": \"The Imitation Game\",\n        \"starList\": \"Benedict Cumberbatch\"\n    }\n]\n```\n\n- $group: 根据文档的starList属性进行分组，然后将分组文档的movie属性合并为movieList，输出结果为:\n\n```\n[\n    {\n        \"_id\": \"Benedict Cumberbatch\",\n        \"movieList\": [\n            \"The Imitation Game\"\n        ]\n    },\n    {\n        \"_id\": \"Matthew Macfadyen\",\n        \"movieList\": [\n            \"Pride & Prejudice\"\n        ]\n    },\n    {\n        \"_id\": \"Mark Ruffalo\",\n        \"movieList\": [\n            \"Begin Again\"\n        ]\n    },\n    {\n        \"_id\": \"Keira Knightley\",\n        \"movieList\": [\n            \"Pride & Prejudice\",\n            \"Begin Again\",\n            \"The Imitation Game\"\n        ]\n    }\n]\n```\n","slug":"2016/09/11/mongodb-inverted-index","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemu000pmkfykvr594m3","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x4E3A;MongoDB&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x7136;&#x540E;&#x7F13;&#x5B58;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E3A;&#x7535;&#x5F71;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x6F14;&#x5458;&#x7D22;&#x5F15;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\" target=\"_blank\" rel=\"external\">MapReduce</a>&#x548C;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">Aggregation Pipeline</a>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/mongodb-inverted-index\" target=\"_blank\" rel=\"external\">kiwenlau/mongodb-inverted-index</a></li>\n</ul>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/11/mongodb-inverted-index/\">2016-09-11</a></li>\n</ul>\n<p><img src=\"/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\"><a href=\"#&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\" class=\"headerlink\" title=\"&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;\"></a>&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;</h2><p>&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;&#x53CD;&#x5411;&#x7D22;&#x5F15;&#xFF0C;<a href=\"https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95\" target=\"_blank\" rel=\"external\">&#x7EF4;&#x57FA;&#x767E;&#x79D1;</a>&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<blockquote>\n<p>&#x662F;&#x4E00;&#x79CD;&#x7D22;&#x5F15;&#x65B9;&#x6CD5;&#xFF0C;&#x88AB;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x5728;&#x5168;&#x6587;&#x641C;&#x7D22;&#x4E0B;&#x67D0;&#x4E2A;&#x5355;&#x8BCD;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x6216;&#x8005;&#x4E00;&#x7EC4;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x7684;&#x6620;&#x5C04;&#x3002;</p>\n</blockquote>\n<p>&#x8FD9;&#x4E2A;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x5B66;&#x672F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BD4;&#x8F83;&#x53CD;&#x4EBA;&#x7C7B;&#xFF0C;&#x5FFD;&#x7565;&#x2026;</p>\n<p>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x662F;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x7684;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;Key&#x662F;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#xFF0C;&#x800C;Value&#x662F;&#x7F51;&#x9875;&#x5185;&#x5BB9;&#x3002;&#x7F51;&#x9875;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x7531;&#x5F88;&#x591A;&#x5173;&#x952E;&#x8BCD;(word)&#x7EC4;&#x6210;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8868;&#x793A;:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;url1, <span class=\"string\">[word2, word3]</span>&gt;</div><div class=\"line\">&lt;url2, <span class=\"string\">[word2]</span>&gt;</div><div class=\"line\">&lt;url3, <span class=\"string\">[word1, word2]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x901A;&#x8FC7;&#x5173;&#x952E;&#x8BCD;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x539F;&#x59CB;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x8BDD;&#x5219;&#x9700;&#x8981;&#x904D;&#x5386;&#x6240;&#x6709;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#xFF0C;&#x6548;&#x7387;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x7528;&#x4E8E;&#x641C;&#x7D22;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5E94;&#x8BE5;&#x4EE5;&#x5173;&#x952E;&#x8BCD;(word)&#x4E3A;Key&#xFF0C;&#x4EE5;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#x4E3A;Value:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;word1, <span class=\"string\">[url3]</span>&gt;</div><div class=\"line\">&lt;word2, <span class=\"string\">[ur1, url2, url3]</span>&gt;</div><div class=\"line\">&lt;word3, <span class=\"string\">[url1]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x67E5;&#x8BE2;&#x5173;&#x952E;&#x8BCD;word2&#xFF0C;&#x7ACB;&#x5373;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x7ED3;&#x679C;: [ur1, url2, url3]&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;<strong>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x5C31;&#x662F;&#x628A;Key&#x4E0E;Value&#x5BF9;&#x8C03;&#x4E4B;&#x540E;&#x7684;&#x7D22;&#x5F15;</strong>&#xFF0C;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x76EE;&#x7684;&#x662F;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\"><a href=\"#&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;\"></a>&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;</h2><p><a href=\"https://www.mongodb.com/\" target=\"_blank\" rel=\"external\">MongoDB</a>&#x662F;&#x6587;&#x6863;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x6709;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;: &#x6570;&#x636E;&#x5E93;(database)&#xFF0C;&#x96C6;&#x5408;(collection)&#x548C;&#x6587;&#x6863;(document)&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;&#x7684;: &#x6570;&#x636E;&#x5E93;(database), &#x8868;(table)&#xFF0C;&#x884C;(row)&#x3002;MongDB&#x4E2D;&#x6BCF;&#x4E2A;&#x7684;&#x6587;&#x6863;&#x662F;&#x4E00;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x672C;&#x6587;&#x4F7F;&#x7528;&#x7684;movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x5982;&#x4E0B;&#x6240;&#x793A;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">\t<span class=\"attr\">&quot;_id&quot;</span> : ObjectId(<span class=\"string\">&quot;57d02d60b128567fc130287d&quot;</span>),</div><div class=\"line\">\t<span class=\"attr\">&quot;movie&quot;</span> : <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">\t<span class=\"attr\">&quot;starList&quot;</span> : [</div><div class=\"line\">\t\t<span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">\t\t<span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">\t],</div><div class=\"line\">\t<span class=\"attr\">&quot;__v&quot;</span> : <span class=\"number\">0</span></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x6587;&#x6863;&#x4E00;&#x5171;&#x6709;4&#x4E2A;&#x5C5E;&#x6027;:</p>\n<ul>\n<li>_id: &#x6587;&#x6863;ID&#xFF0C;&#x7531;MongoDB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>__v: &#x6587;&#x6863;&#x7248;&#x672C;&#xFF0C;&#x7531;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;Mongoose&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>movie: &#x7535;&#x5F71;&#x540D;&#x79F0;&#x3002;</li>\n<li>starList: &#x6F14;&#x5458;&#x5217;&#x8868;&#x3002; </li>\n</ul>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x8868;&#x793A;&#x7535;&#x5F71;<a href=\"https://movie.douban.com/subject/1418200/\" target=\"_blank\" rel=\"external\">&#x300A;&#x50B2;&#x6162;&#x4E0E;&#x504F;&#x89C1;&#x300B;</a>&#xFF0C;&#x7531;&#x5973;&#x795E;<a href=\"https://movie.douban.com/celebrity/1054448/\" target=\"_blank\" rel=\"external\">&#x51EF;&#x62C9;&#xB7;&#x5948;&#x7279;&#x8389;</a>&#x4E3B;&#x6F14;&#x3002;</p>\n<p>&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>&#xFF0C;movie&#x96C6;&#x5408;&#x7684;&#x6570;&#x636E;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Mark Ruffalo&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>]</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;Key&#x4E3A;&#x7535;&#x5F71;&#x540D;&#x79F0;(movie)&#xFF0C;&#x800C;Value&#x4E3A;&#x6F14;&#x5458;&#x5217;&#x8868;(starList)&#x3002;</p>\n<p>&#x8FD9;&#x65F6;&#x67E5;&#x8BE2;Keira Knightley&#x6240;&#x4E3B;&#x6F14;&#x7684;&#x7535;&#x5F71;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js\" target=\"_blank\" rel=\"external\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.find(</div><div class=\"line\">{</div><div class=\"line\">    starList: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    _id: <span class=\"number\">0</span>,</div><div class=\"line\">    movie: <span class=\"number\">1</span></div><div class=\"line\">}, <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;search movie success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x6CE8;&#xFF1A;&#x672C;&#x6587;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x4E86;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;<a href=\"http://mongoosejs.com/\" target=\"_blank\" rel=\"external\">Mongoose</a>&#xFF0C;&#x5B83;&#x4E0E;MongoDB Shell&#x7684;&#x63A5;&#x53E3;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<p>&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x91CF;&#x5927;&#x65F6;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x4F1A;&#x5F88;&#x5DEE;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x9700;&#x8981;:</p>\n<ul>\n<li>&#x904D;&#x5386;&#x6574;&#x4E2A;movie&#x96C6;&#x5408;&#x7684;&#x6240;&#x6709;&#x6587;&#x6863;</li>\n<li>&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x7684;startList&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4ECB;&#x7ECD;MongoDB&#x4E2D;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\" target=\"_blank\" rel=\"external\">MapReduce</a>&#x4E0E;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">Aggregation Pipeline</a>&#x3002;</p>\n<h2 id=\"&#x4E09;-MapReduce\"><a href=\"#&#x4E09;-MapReduce\" class=\"headerlink\" title=\"&#x4E09; MapReduce\"></a>&#x4E09; MapReduce</h2><p><a href=\"http://research.google.com/archive/mapreduce.html\" target=\"_blank\" rel=\"external\">MapReduce</a>&#x662F;&#x7531;&#x8C37;&#x6B4C;&#x63D0;&#x51FA;&#x7684;&#x7F16;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x79CD;&#x5927;&#x6570;&#x636E;&#x5904;&#x7406;&#x573A;&#x666F;&#xFF0C;&#x5728;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#xFF0C;MapReduce&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x7F51;&#x9875;&#x6570;&#x636E;&#x7684;&#x5012;&#x6392;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x7F51;&#x9875;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;PageRank(&#x7531;&#x8C37;&#x6B4C;&#x521B;&#x59CB;&#x4EBA;&#x4F69;&#x5947;&#x548C;&#x5E03;&#x6797;&#x63D0;&#x51FA;)&#x3002;</p>\n<p>MapReduce&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x4E0E;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x5747;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x3002;MapReduce&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x51FD;&#x6570;: Map&#x4E0E;Reduce&#x3002;</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x5C06;&#x8F93;&#x5165;&#x952E;&#x503C;<code>&lt;k1, v1&gt;</code>&#x5BF9;&#x8FDB;&#x884C;&#x53D8;&#x6362;&#xFF0C;&#x8F93;&#x51FA;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x3002;</li>\n<li>MapReduce&#x6846;&#x67B6;&#x4F1A;&#x81EA;&#x52A8;&#x5BF9;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;Key&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x7684;Value&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x751F;&#x6210;&#x7ED3;&#x679C;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v3&gt;</code>&#x3002;</li>\n</ul>\n<p>&#x4F7F;&#x7528;MapReduce&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js\" target=\"_blank\" rel=\"external\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> option = {};</div><div class=\"line\"></div><div class=\"line\">option.map = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movie = <span class=\"keyword\">this</span>.movie;</div><div class=\"line\">    <span class=\"keyword\">this</span>.starList.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">star</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        emit(star,</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"attr\">movieList</span>: [movie]</div><div class=\"line\">        });</div><div class=\"line\">    });</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">option.reduce = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, values</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movieList = [];</div><div class=\"line\">    values.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        movieList.push(value.movieList[<span class=\"number\">0</span>]);</div><div class=\"line\">    });</div><div class=\"line\">    <span class=\"keyword\">return</span> {</div><div class=\"line\">        <span class=\"attr\">movieList</span>: movieList</div><div class=\"line\">    };</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">Movie.mapReduce(option, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">        process.exit(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.stringify(results, <span class=\"literal\">null</span>, <span class=\"number\">4</span>));</div><div class=\"line\">    process.exit(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;Movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x6587;&#x6863;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7528;this&#x8868;&#x793A;&#x3002;&#x6587;&#x6863;&#x7684;movie&#x4E0E;starList&#x5C5E;&#x6027;&#x6784;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;movie, starList&gt;</code>&#x3002;Map&#x51FD;&#x6570;&#x904D;&#x5386;starList&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;start&#x751F;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x3002;&#x8FD9;&#x65F6;Key&#x4E0E;Value&#x8FDB;&#x884C;&#x4E86;&#x5BF9;&#x8C03;&#xFF0C;&#x4E14;starList&#x88AB;&#x62C6;&#x5206;&#x4E86;&#xFF0C;movieList&#x4EC5;&#x5305;&#x542B;&#x5355;&#x4E2A;movie&#x3002;</li>\n<li>MongoDB&#x7684;MapReduce&#x6267;&#x884C;&#x6846;&#x67B6;&#x5BF9;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;star&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#x3002;&#x8FD9;&#x4E00;&#x6B65;&#x662F;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x4F53;&#x73B0;&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;star&#x5373;&#x4E3A;key&#xFF0C;&#x800C;list(movieList)&#x5373;&#x4E3A;values&#xFF0C;&#x4E24;&#x8005;&#x4E3A;Reduce&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x3002;Reduce&#x51FD;&#x6570;&#x5408;&#x5E76;list(movieList)&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#xFF0C;&#x6700;&#x7EC8;&#xFF0C;movieList&#x4E2D;&#x5C06;&#x5305;&#x542B;&#x8BE5;star&#x7684;&#x6240;&#x6709;movie&#x3002;</li>\n</ul>\n<p>&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;Map&#x51FD;&#x6570;&#x4E0E;Reduce&#x8FD4;&#x56DE;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;Value&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;<code>{ movieList: movieList }</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;<code>movieList</code>&#xFF0C;&#x56E0;&#x6B64;&#x4EE3;&#x7801;&#x548C;&#x7ED3;&#x679C;&#x90FD;&#x663E;&#x5F97;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x3002;MongoDB&#x7684;MapReduce&#x6846;&#x67B6;&#x4E0D;&#x652F;&#x6301;Reduce&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x5C06;movieList&#x653E;&#x5728;&#x5BF9;&#x8C61;&#x91CC;&#x9762;&#x8FD4;&#x56DE;&#x3002;</p>\n<p>&#x8F93;&#x51FA;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-Aggregation-Pipeline\"><a href=\"#&#x56DB;-Aggregation-Pipeline\" class=\"headerlink\" title=\"&#x56DB;. Aggregation Pipeline\"></a>&#x56DB;. Aggregation Pipeline</h2><p><a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">Aggregation Pipeline</a>&#xFF0C;&#x4E2D;&#x6587;&#x79F0;&#x4F5C;&#x805A;&#x5408;&#x7BA1;&#x9053;&#xFF0C;&#x7528;&#x4E8E;&#x6C47;&#x603B;MongoDB&#x4E2D;&#x591A;&#x4E2A;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x3002;</p>\n<p>Aggregation Pipeline&#x8FDB;&#x884C;&#x5404;&#x79CD;<a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/\" target=\"_blank\" rel=\"external\">&#x805A;&#x5408;&#x64CD;&#x4F5C;</a>&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A;&#x805A;&#x5408;&#x64CD;&#x4F5C;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#x64CD;&#x4F5C;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x5165;&#x3002;</p>\n<p>&#x4F7F;&#x7528;Aggregation Pipeline&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js\" target=\"_blank\" rel=\"external\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.aggregate([</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$unwind&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$group&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>:</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"string\">&quot;$push&quot;</span>: <span class=\"string\">&quot;$movie&quot;</span></div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$project&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"number\">0</span>,</div><div class=\"line\">        <span class=\"string\">&quot;star&quot;</span>: <span class=\"string\">&quot;$_id&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>: <span class=\"number\">1</span></div><div class=\"line\">    }</div><div class=\"line\">}], <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>$unwind: &#x5C06;starList&#x62C6;&#x5206;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;(&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>)&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span></div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<ul>\n<li>$group: &#x6839;&#x636E;&#x6587;&#x6863;&#x7684;starList&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5206;&#x7EC4;&#x6587;&#x6863;&#x7684;movie&#x5C5E;&#x6027;&#x5408;&#x5E76;&#x4E3A;movieList&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x4E3A;MongoDB&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x7136;&#x540E;&#x7F13;&#x5B58;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x901A;&#x8FC7;&#x4E3A;&#x7535;&#x5F71;&#x6570;&#x636E;&#x6784;&#x5EFA;&#x6F14;&#x5458;&#x7D22;&#x5F15;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\">MapReduce</a>&#x548C;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\">Aggregation Pipeline</a>&#x3002;</p>\n<p><strong>GitHub&#x5730;&#x5740;:</strong></p>\n<ul>\n<li><a href=\"https://github.com/kiwenlau/mongodb-inverted-index\">kiwenlau/mongodb-inverted-index</a></li>\n</ul>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/09/11/mongodb-inverted-index/\">2016-09-11</a></li>\n</ul>\n<p><img src=\"/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png\" width=\"500\"></p>\n<h2 id=\"&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\"><a href=\"#&#x4E00;-&#x5012;&#x6392;&#x7D22;&#x5F15;\" class=\"headerlink\" title=\"&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;\"></a>&#x4E00;. &#x5012;&#x6392;&#x7D22;&#x5F15;</h2><p>&#x5012;&#x6392;&#x7D22;&#x5F15;(Inverted Index)&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;&#x53CD;&#x5411;&#x7D22;&#x5F15;&#xFF0C;<a href=\"https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95\">&#x7EF4;&#x57FA;&#x767E;&#x79D1;</a>&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<blockquote>\n<p>&#x662F;&#x4E00;&#x79CD;&#x7D22;&#x5F15;&#x65B9;&#x6CD5;&#xFF0C;&#x88AB;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x5728;&#x5168;&#x6587;&#x641C;&#x7D22;&#x4E0B;&#x67D0;&#x4E2A;&#x5355;&#x8BCD;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x6216;&#x8005;&#x4E00;&#x7EC4;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#x7684;&#x6620;&#x5C04;&#x3002;</p>\n</blockquote>\n<p>&#x8FD9;&#x4E2A;&#x5B9A;&#x4E49;&#x6BD4;&#x8F83;&#x5B66;&#x672F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BD4;&#x8F83;&#x53CD;&#x4EBA;&#x7C7B;&#xFF0C;&#x5FFD;&#x7565;&#x2026;</p>\n<p>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x662F;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x7684;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;Key&#x662F;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#xFF0C;&#x800C;Value&#x662F;&#x7F51;&#x9875;&#x5185;&#x5BB9;&#x3002;&#x7F51;&#x9875;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x7531;&#x5F88;&#x591A;&#x5173;&#x952E;&#x8BCD;(word)&#x7EC4;&#x6210;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x722C;&#x866B;&#x83B7;&#x53D6;&#x7684;&#x7F51;&#x9875;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8868;&#x793A;:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;url1, <span class=\"string\">[word2, word3]</span>&gt;</div><div class=\"line\">&lt;url2, <span class=\"string\">[word2]</span>&gt;</div><div class=\"line\">&lt;url3, <span class=\"string\">[word1, word2]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x901A;&#x8FC7;&#x5173;&#x952E;&#x8BCD;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x7684;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x539F;&#x59CB;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x8BDD;&#x5219;&#x9700;&#x8981;&#x904D;&#x5386;&#x6240;&#x6709;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x6570;&#x7EC4;&#xFF0C;&#x6548;&#x7387;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x7528;&#x4E8E;&#x641C;&#x7D22;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5E94;&#x8BE5;&#x4EE5;&#x5173;&#x952E;&#x8BCD;(word)&#x4E3A;Key&#xFF0C;&#x4EE5;&#x7F51;&#x9875;&#x5730;&#x5740;(url)&#x4E3A;Value:</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;word1, <span class=\"string\">[url3]</span>&gt;</div><div class=\"line\">&lt;word2, <span class=\"string\">[ur1, url2, url3]</span>&gt;</div><div class=\"line\">&lt;word3, <span class=\"string\">[url1]</span>&gt;</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x67E5;&#x8BE2;&#x5173;&#x952E;&#x8BCD;word2&#xFF0C;&#x7ACB;&#x5373;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x7ED3;&#x679C;: [ur1, url2, url3]&#x3002;</p>\n<p>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;<strong>&#x5012;&#x6392;&#x7D22;&#x5F15;&#x5C31;&#x662F;&#x628A;Key&#x4E0E;Value&#x5BF9;&#x8C03;&#x4E4B;&#x540E;&#x7684;&#x7D22;&#x5F15;</strong>&#xFF0C;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x76EE;&#x7684;&#x662F;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\"><a href=\"#&#x4E8C;-&#x6D4B;&#x8BD5;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;\"></a>&#x4E8C;. &#x6D4B;&#x8BD5;&#x6570;&#x636E;</h2><p><a href=\"https://www.mongodb.com/\">MongoDB</a>&#x662F;&#x6587;&#x6863;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x6709;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;: &#x6570;&#x636E;&#x5E93;(database)&#xFF0C;&#x96C6;&#x5408;(collection)&#x548C;&#x6587;&#x6863;(document)&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4E09;&#x4E2A;&#x5C42;&#x7EA7;&#x7684;: &#x6570;&#x636E;&#x5E93;(database), &#x8868;(table)&#xFF0C;&#x884C;(row)&#x3002;MongDB&#x4E2D;&#x6BCF;&#x4E2A;&#x7684;&#x6587;&#x6863;&#x662F;&#x4E00;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x672C;&#x6587;&#x4F7F;&#x7528;&#x7684;movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x5982;&#x4E0B;&#x6240;&#x793A;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">\t<span class=\"attr\">&quot;_id&quot;</span> : ObjectId(<span class=\"string\">&quot;57d02d60b128567fc130287d&quot;</span>),</div><div class=\"line\">\t<span class=\"attr\">&quot;movie&quot;</span> : <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">\t<span class=\"attr\">&quot;starList&quot;</span> : [</div><div class=\"line\">\t\t<span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">\t\t<span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">\t],</div><div class=\"line\">\t<span class=\"attr\">&quot;__v&quot;</span> : <span class=\"number\">0</span></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8BE5;&#x6587;&#x6863;&#x4E00;&#x5171;&#x6709;4&#x4E2A;&#x5C5E;&#x6027;:</p>\n<ul>\n<li>_id: &#x6587;&#x6863;ID&#xFF0C;&#x7531;MongoDB&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>__v: &#x6587;&#x6863;&#x7248;&#x672C;&#xFF0C;&#x7531;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;Mongoose&#x81EA;&#x52A8;&#x751F;&#x6210;&#x3002;</li>\n<li>movie: &#x7535;&#x5F71;&#x540D;&#x79F0;&#x3002;</li>\n<li>starList: &#x6F14;&#x5458;&#x5217;&#x8868;&#x3002; </li>\n</ul>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x8868;&#x793A;&#x7535;&#x5F71;<a href=\"https://movie.douban.com/subject/1418200/\">&#x300A;&#x50B2;&#x6162;&#x4E0E;&#x504F;&#x89C1;&#x300B;</a>&#xFF0C;&#x7531;&#x5973;&#x795E;<a href=\"https://movie.douban.com/celebrity/1054448/\">&#x51EF;&#x62C9;&#xB7;&#x5948;&#x7279;&#x8389;</a>&#x4E3B;&#x6F14;&#x3002;</p>\n<p>&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>&#xFF0C;movie&#x96C6;&#x5408;&#x7684;&#x6570;&#x636E;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight prolog\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Mark Ruffalo&quot;</span>]</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;starList&quot;</span>: [<span class=\"string\">&quot;Keira Knightley&quot;</span>, <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>]</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;Key&#x4E3A;&#x7535;&#x5F71;&#x540D;&#x79F0;(movie)&#xFF0C;&#x800C;Value&#x4E3A;&#x6F14;&#x5458;&#x5217;&#x8868;(starList)&#x3002;</p>\n<p>&#x8FD9;&#x65F6;&#x67E5;&#x8BE2;Keira Knightley&#x6240;&#x4E3B;&#x6F14;&#x7684;&#x7535;&#x5F71;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/search.js\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.find(</div><div class=\"line\">{</div><div class=\"line\">    starList: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    _id: <span class=\"number\">0</span>,</div><div class=\"line\">    movie: <span class=\"number\">1</span></div><div class=\"line\">}, <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;search movie success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x6CE8;&#xFF1A;&#x672C;&#x6587;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x4E86;MongoDB&#x7684;NodeJS&#x63A5;&#x53E3;<a href=\"http://mongoosejs.com/\">Mongoose</a>&#xFF0C;&#x5B83;&#x4E0E;MongoDB Shell&#x7684;&#x63A5;&#x53E3;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x3002;</li>\n</ul>\n<p>&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x91CF;&#x5927;&#x65F6;&#x67E5;&#x8BE2;&#x6027;&#x80FD;&#x4F1A;&#x5F88;&#x5DEE;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x9700;&#x8981;:</p>\n<ul>\n<li>&#x904D;&#x5386;&#x6574;&#x4E2A;movie&#x96C6;&#x5408;&#x7684;&#x6240;&#x6709;&#x6587;&#x6863;</li>\n<li>&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x7684;startList&#x6570;&#x7EC4;</li>\n</ul>\n<p>&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x63D0;&#x5347;&#x641C;&#x7D22;&#x6027;&#x80FD;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4ECB;&#x7ECD;MongoDB&#x4E2D;&#x4E24;&#x79CD;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<a href=\"https://docs.mongodb.com/manual/core/map-reduce/\">MapReduce</a>&#x4E0E;<a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\">Aggregation Pipeline</a>&#x3002;</p>\n<h2 id=\"&#x4E09;-MapReduce\"><a href=\"#&#x4E09;-MapReduce\" class=\"headerlink\" title=\"&#x4E09; MapReduce\"></a>&#x4E09; MapReduce</h2><p><a href=\"http://research.google.com/archive/mapreduce.html\">MapReduce</a>&#x662F;&#x7531;&#x8C37;&#x6B4C;&#x63D0;&#x51FA;&#x7684;&#x7F16;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x591A;&#x79CD;&#x5927;&#x6570;&#x636E;&#x5904;&#x7406;&#x573A;&#x666F;&#xFF0C;&#x5728;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x4E2D;&#xFF0C;MapReduce&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x7F51;&#x9875;&#x6570;&#x636E;&#x7684;&#x5012;&#x6392;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x7F51;&#x9875;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;PageRank(&#x7531;&#x8C37;&#x6B4C;&#x521B;&#x59CB;&#x4EBA;&#x4F69;&#x5947;&#x548C;&#x5E03;&#x6797;&#x63D0;&#x51FA;)&#x3002;</p>\n<p>MapReduce&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x4E0E;&#x8F93;&#x51FA;&#x6570;&#x636E;&#x5747;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#x3002;MapReduce&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x51FD;&#x6570;: Map&#x4E0E;Reduce&#x3002;</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x5C06;&#x8F93;&#x5165;&#x952E;&#x503C;<code>&lt;k1, v1&gt;</code>&#x5BF9;&#x8FDB;&#x884C;&#x53D8;&#x6362;&#xFF0C;&#x8F93;&#x51FA;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x3002;</li>\n<li>MapReduce&#x6846;&#x67B6;&#x4F1A;&#x81EA;&#x52A8;&#x5BF9;&#x4E2D;&#x95F4;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v2&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;Key&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x5BF9;<code>&lt;k2, list(v2)&gt;</code>&#x7684;Value&#x8FDB;&#x884C;&#x5408;&#x5E76;&#xFF0C;&#x751F;&#x6210;&#x7ED3;&#x679C;&#x952E;&#x503C;&#x5BF9;<code>&lt;k2, v3&gt;</code>&#x3002;</li>\n</ul>\n<p>&#x4F7F;&#x7528;MapReduce&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/mapreduce.js\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> option = {};</div><div class=\"line\"></div><div class=\"line\">option.map = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movie = <span class=\"keyword\">this</span>.movie;</div><div class=\"line\">    <span class=\"keyword\">this</span>.starList.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">star</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        emit(star,</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"attr\">movieList</span>: [movie]</div><div class=\"line\">        });</div><div class=\"line\">    });</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">option.reduce = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, values</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> movieList = [];</div><div class=\"line\">    values.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        movieList.push(value.movieList[<span class=\"number\">0</span>]);</div><div class=\"line\">    });</div><div class=\"line\">    <span class=\"keyword\">return</span> {</div><div class=\"line\">        <span class=\"attr\">movieList</span>: movieList</div><div class=\"line\">    };</div><div class=\"line\">};</div><div class=\"line\"></div><div class=\"line\">Movie.mapReduce(option, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, results</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">        process.exit(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.stringify(results, <span class=\"literal\">null</span>, <span class=\"number\">4</span>));</div><div class=\"line\">    process.exit(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>Map&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;Movie&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x6587;&#x6863;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7528;this&#x8868;&#x793A;&#x3002;&#x6587;&#x6863;&#x7684;movie&#x4E0E;starList&#x5C5E;&#x6027;&#x6784;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;movie, starList&gt;</code>&#x3002;Map&#x51FD;&#x6570;&#x904D;&#x5386;starList&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;start&#x751F;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x3002;&#x8FD9;&#x65F6;Key&#x4E0E;Value&#x8FDB;&#x884C;&#x4E86;&#x5BF9;&#x8C03;&#xFF0C;&#x4E14;starList&#x88AB;&#x62C6;&#x5206;&#x4E86;&#xFF0C;movieList&#x4EC5;&#x5305;&#x542B;&#x5355;&#x4E2A;movie&#x3002;</li>\n<li>MongoDB&#x7684;MapReduce&#x6267;&#x884C;&#x6846;&#x67B6;&#x5BF9;&#x6210;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;star&#x76F8;&#x540C;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4F1A;&#x88AB;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#x3002;&#x8FD9;&#x4E00;&#x6B65;&#x662F;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x4F53;&#x73B0;&#x3002;</li>\n<li>Reduce&#x51FD;&#x6570;&#x7684;&#x8F93;&#x5165;&#x6570;&#x636E;&#x662F;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, list(movieList)&gt;</code>&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;star&#x5373;&#x4E3A;key&#xFF0C;&#x800C;list(movieList)&#x5373;&#x4E3A;values&#xFF0C;&#x4E24;&#x8005;&#x4E3A;Reduce&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x3002;Reduce&#x51FD;&#x6570;&#x5408;&#x5E76;list(movieList)&#xFF0C;&#x4ECE;&#x800C;&#x5F97;&#x5230;&#x952E;&#x503C;&#x5BF9;<code>&lt;star, movieList&gt;</code>&#xFF0C;&#x6700;&#x7EC8;&#xFF0C;movieList&#x4E2D;&#x5C06;&#x5305;&#x542B;&#x8BE5;star&#x7684;&#x6240;&#x6709;movie&#x3002;</li>\n</ul>\n<p>&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;Map&#x51FD;&#x6570;&#x4E0E;Reduce&#x8FD4;&#x56DE;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x4E2D;&#x7684;Value&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;<code>{ movieList: movieList }</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;<code>movieList</code>&#xFF0C;&#x56E0;&#x6B64;&#x4EE3;&#x7801;&#x548C;&#x7ED3;&#x679C;&#x90FD;&#x663E;&#x5F97;&#x6BD4;&#x8F83;&#x5947;&#x602A;&#x3002;MongoDB&#x7684;MapReduce&#x6846;&#x67B6;&#x4E0D;&#x652F;&#x6301;Reduce&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x5C06;movieList&#x653E;&#x5728;&#x5BF9;&#x8C61;&#x91CC;&#x9762;&#x8FD4;&#x56DE;&#x3002;</p>\n<p>&#x8F93;&#x51FA;&#x7ED3;&#x679C;:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">                <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;value&quot;</span>: {</div><div class=\"line\">            <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">                <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">            ]</div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<h2 id=\"&#x56DB;-Aggregation-Pipeline\"><a href=\"#&#x56DB;-Aggregation-Pipeline\" class=\"headerlink\" title=\"&#x56DB;. Aggregation Pipeline\"></a>&#x56DB;. Aggregation Pipeline</h2><p><a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/\">Aggregation Pipeline</a>&#xFF0C;&#x4E2D;&#x6587;&#x79F0;&#x4F5C;&#x805A;&#x5408;&#x7BA1;&#x9053;&#xFF0C;&#x7528;&#x4E8E;&#x6C47;&#x603B;MongoDB&#x4E2D;&#x591A;&#x4E2A;&#x6587;&#x6863;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x3002;</p>\n<p>Aggregation Pipeline&#x8FDB;&#x884C;&#x5404;&#x79CD;<a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/\">&#x805A;&#x5408;&#x64CD;&#x4F5C;</a>&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A;&#x805A;&#x5408;&#x64CD;&#x4F5C;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E2D;&#x7684;&#x7BA1;&#x9053;&#x64CD;&#x4F5C;&#xFF0C;&#x524D;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x8F93;&#x5165;&#x3002;</p>\n<p>&#x4F7F;&#x7528;Aggregation Pipeline&#x6784;&#x5EFA;&#x5012;&#x6392;&#x7D22;&#x5F15;&#x7684;NodeJS<a href=\"https://github.com/kiwenlau/mongodb-inverted-index/blob/master/aggregation Pipeline.js\">&#x4EE3;&#x7801;</a>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><div class=\"line\">Movie.aggregate([</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$unwind&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span></div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$group&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"string\">&quot;$starList&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>:</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"string\">&quot;$push&quot;</span>: <span class=\"string\">&quot;$movie&quot;</span></div><div class=\"line\">        }</div><div class=\"line\">    }</div><div class=\"line\">},</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;$project&quot;</span>:</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;_id&quot;</span>: <span class=\"number\">0</span>,</div><div class=\"line\">        <span class=\"string\">&quot;star&quot;</span>: <span class=\"string\">&quot;$_id&quot;</span>,</div><div class=\"line\">        <span class=\"string\">&quot;movieList&quot;</span>: <span class=\"number\">1</span></div><div class=\"line\">    }</div><div class=\"line\">}], <span class=\"keyword\">function</span>(err, results)</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        console.log(err);</div><div class=\"line\">        process.<span class=\"keyword\">exit</span>(<span class=\"number\">1</span>);</div><div class=\"line\">    }</div><div class=\"line\">    console.log(<span class=\"string\">&quot;create inverted index success:\\n&quot;</span>);</div><div class=\"line\">    console.log(JSON.stringify(results, null, <span class=\"number\">4</span>));</div><div class=\"line\">    process.<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x4EE3;&#x7801;&#x89E3;&#x91CA;:</p>\n<ul>\n<li>$unwind: &#x5C06;starList&#x62C6;&#x5206;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;(&#x5FFD;&#x7565;<code>_id</code>&#x4E0E;<code>__v</code>)&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span></div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;movie&quot;</span>: <span class=\"string\">&quot;The Imitation Game&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;starList&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span></div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>\n<ul>\n<li>$group: &#x6839;&#x636E;&#x6587;&#x6863;&#x7684;starList&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5206;&#x7EC4;&#x6587;&#x6863;&#x7684;movie&#x5C5E;&#x6027;&#x5408;&#x5E76;&#x4E3A;movieList&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E3A;:</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><div class=\"line\">[</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Benedict Cumberbatch&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Matthew Macfadyen&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Mark Ruffalo&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    },</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;Keira Knightley&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">&quot;movieList&quot;</span>: [</div><div class=\"line\">            <span class=\"string\">&quot;Pride &amp; Prejudice&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;Begin Again&quot;</span>,</div><div class=\"line\">            <span class=\"string\">&quot;The Imitation Game&quot;</span></div><div class=\"line\">        ]</div><div class=\"line\">    }</div><div class=\"line\">]</div></pre></td></tr></table></figure>"},{"title":"使用Vagrant创建多节点虚拟机集群","date":"2016-07-03T02:00:00.000Z","_content":"\n**摘要:** 在前一篇博客中，我介绍了[使用Vagrant快速创建虚拟机](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)，但是所创建的只是单个虚拟机。这篇博客将介绍[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以作为[Hadoop](http://hadoop.apache.org/)，[Spark](http://spark.apache.org/)以及[Storm](http://storm.apache.org/)等分布式系统的运行环境。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-03](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)\n\n<img src=\"vagrant-vm-cluster/vagrant-vm-cluster.png\" width = \"500\"/>\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n## 一. 集群创建\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 下载Box**\n\n```\nvagrant box add ubuntu/trusty64\n```\n\n**Box**相当于虚拟机所依赖的镜像文件。\n\n#### **4. 编辑Vagrantfile**\n\n```\nmkdir vagrant-cluster\ncd vagrant-cluster\nvim Vagrantfile\n```\n\nVagrantfile如下，可以通过注释理解每个自定义配置的含义：\n\n```\nVagrant.configure(\"2\") do |config|\n\n\t(1..3).each do |i|\n\n\t\tconfig.vm.define \"node#{i}\" do |node|\n\n\t\t# 设置虚拟机的Box\n\t\tnode.vm.box = \"ubuntu/trusty64\"\n\n\t\t# 设置虚拟机的主机名\n\t\tnode.vm.hostname=\"node#{i}\"\n\n\t\t# 设置虚拟机的IP\n\t\tnode.vm.network \"private_network\", ip: \"192.168.59.#{i}\"\n\n\t\t# 设置主机与虚拟机的共享目录\n\t\tnode.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n\t\t# VirtaulBox相关配置\n\t\tnode.vm.provider \"virtualbox\" do |v|\n\n\t\t\t# 设置虚拟机的名称\n\t\t\tv.name = \"node#{i}\"\n\n\t\t\t# 设置虚拟机的内存大小  \n\t\t\tv.memory = 2048\n\n\t\t\t# 设置虚拟机的CPU个数\n\t\t\tv.cpus = 1\n\t\tend\n  \n\t\t# 使用shell脚本进行软件安装和配置\n\t\tnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t\t\t# 安装docker 1.11.0\n\t\t\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\t\t\tusermod -aG docker vagrant\n\t\t\t\n\t\tSHELL\n\n\t\tend\n\tend\nend\n```\n\n与创建单个虚拟机相比，创建多个虚拟机时多了一层循环，而变量i可以用于设置节点的名称与IP，使用**#{i}**取值：\n\n```\n(1..3).each do |i|\n\nend\n```\n\n可知，一共创建了3个虚拟机。\n\n#### **5. 在桌面上创建share目录**\n\n桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **6. 创建虚拟机**\n\n```\nvagrant up\n```\n\n创建3个虚拟机大概需要15分钟，当然这和机器性能还有网速相关。安装Docker可能会比较慢，不需要的话删除下面几行就可以了：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\n\nSHELL\n```\n\n下面是Vagrant虚拟机的配置，可以根据需要进行更改:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n- 内存：2GB\n- CPU: 1\n\n\n## 二. 集群管理\n\n#### **1. 常用命令**\n\n下面是一些常用的Vagrant管理命令，操作特定虚拟机时仅需指定虚拟机的名称。\n\n- **vagrant ssh:** SSH登陆虚拟机\n- **vagrant halt:** 关闭虚拟机\n- **vagrant destroy:** 删除虚拟机\n- **vagrant ssh-config** 查看虚拟机SSH配置\n\n**启动单个虚拟机：**\n\n```\nvagrant up node1\n```\n\n**启动多个虚拟机：**\n\n```\nvagrant up node1 node3\n```\n\n**启动所有虚拟机：**\n\n```\nvagrant up\n```\n\n#### **2. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.59.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH免密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@192.168.59.2 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n#### **3. 重新安装软件**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\nSHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provision\n```\n\n#### **4. 共享目录挂载出错**\n\nVirtualBox设置共享目录时需要在虚拟机中安装VirtualBox Guest Additions，这个Vagrant会自动安装。但是，VirtualBox Guest Additions是内核模块，当虚拟机的内核升级之后，VirtualBox Guest Additions会失效，导致共享目录挂载失败，出错信息如下:\n\n```\nFailed to mount folders in Linux guest. This is usually because\nthe \"vboxsf\" file system is not available. Please verify that\nthe guest additions are properly installed in the guest and\ncan work properly. The command attempted was:\n\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant\n\nThe error output from the last command was:\n\nstdin: is not a tty\n/sbin/mount.vboxsf: mounting failed with the error: No such device\n```\n\n安装Vagrant插件[vagrant-vbguest](https://github.com/dotless-de/vagrant-vbguest)可以解决这个问题，因为该插件会在虚拟机内核升级之后重新安装VirtualBox Guest Additions。\n\n```\nvagrant plugin install vagrant-vbguest\n```","source":"_posts/2016/07/03/vagrant-vm-cluster.md","raw":"title: 使用Vagrant创建多节点虚拟机集群\n\ndate: 2016-07-03 10:00\n\ntags: [Vagrant]\n\n---\n\n**摘要:** 在前一篇博客中，我介绍了[使用Vagrant快速创建虚拟机](http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/)，但是所创建的只是单个虚拟机。这篇博客将介绍[使用Vagrant创建多节点虚拟机集群](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)，可以作为[Hadoop](http://hadoop.apache.org/)，[Spark](http://spark.apache.org/)以及[Storm](http://storm.apache.org/)等分布式系统的运行环境。\n\n<!-- more -->\n\n- 作者: [KiwenLau](http://kiwenlau.com/)\n- 日期: [2016-07-03](http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/)\n\n<img src=\"vagrant-vm-cluster/vagrant-vm-cluster.png\" width = \"500\"/>\n\n本文所有操作是在MacBook上进行的，Windows上的操作大部分一致，但是可能会有一些小问题。\n\n## 一. 集群创建\n\n#### **1. 安装[VirtualBox](https://www.virtualbox.org/wiki/Downloads)**\n\n#### **2. 安装[Vagrant](https://www.vagrantup.com/downloads.html)**\n\n#### **3. 下载Box**\n\n```\nvagrant box add ubuntu/trusty64\n```\n\n**Box**相当于虚拟机所依赖的镜像文件。\n\n#### **4. 编辑Vagrantfile**\n\n```\nmkdir vagrant-cluster\ncd vagrant-cluster\nvim Vagrantfile\n```\n\nVagrantfile如下，可以通过注释理解每个自定义配置的含义：\n\n```\nVagrant.configure(\"2\") do |config|\n\n\t(1..3).each do |i|\n\n\t\tconfig.vm.define \"node#{i}\" do |node|\n\n\t\t# 设置虚拟机的Box\n\t\tnode.vm.box = \"ubuntu/trusty64\"\n\n\t\t# 设置虚拟机的主机名\n\t\tnode.vm.hostname=\"node#{i}\"\n\n\t\t# 设置虚拟机的IP\n\t\tnode.vm.network \"private_network\", ip: \"192.168.59.#{i}\"\n\n\t\t# 设置主机与虚拟机的共享目录\n\t\tnode.vm.synced_folder \"~/Desktop/share\", \"/home/vagrant/share\"\n\n\t\t# VirtaulBox相关配置\n\t\tnode.vm.provider \"virtualbox\" do |v|\n\n\t\t\t# 设置虚拟机的名称\n\t\t\tv.name = \"node#{i}\"\n\n\t\t\t# 设置虚拟机的内存大小  \n\t\t\tv.memory = 2048\n\n\t\t\t# 设置虚拟机的CPU个数\n\t\t\tv.cpus = 1\n\t\tend\n  \n\t\t# 使用shell脚本进行软件安装和配置\n\t\tnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t\t\t# 安装docker 1.11.0\n\t\t\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\t\t\tusermod -aG docker vagrant\n\t\t\t\n\t\tSHELL\n\n\t\tend\n\tend\nend\n```\n\n与创建单个虚拟机相比，创建多个虚拟机时多了一层循环，而变量i可以用于设置节点的名称与IP，使用**#{i}**取值：\n\n```\n(1..3).each do |i|\n\nend\n```\n\n可知，一共创建了3个虚拟机。\n\n#### **5. 在桌面上创建share目录**\n\n桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n\n```\nmkdir ~/Desktop/share\n```\n\n#### **6. 创建虚拟机**\n\n```\nvagrant up\n```\n\n创建3个虚拟机大概需要15分钟，当然这和机器性能还有网速相关。安装Docker可能会比较慢，不需要的话删除下面几行就可以了：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\n\nSHELL\n```\n\n下面是Vagrant虚拟机的配置，可以根据需要进行更改:\n\n- 用户/密码: vagrant/vagrant\n- 共享目录: 桌面上的share目录将与虚拟机内的/home/vagrant/share目录内容实时同步\n- 内存：2GB\n- CPU: 1\n\n\n## 二. 集群管理\n\n#### **1. 常用命令**\n\n下面是一些常用的Vagrant管理命令，操作特定虚拟机时仅需指定虚拟机的名称。\n\n- **vagrant ssh:** SSH登陆虚拟机\n- **vagrant halt:** 关闭虚拟机\n- **vagrant destroy:** 删除虚拟机\n- **vagrant ssh-config** 查看虚拟机SSH配置\n\n**启动单个虚拟机：**\n\n```\nvagrant up node1\n```\n\n**启动多个虚拟机：**\n\n```\nvagrant up node1 node3\n```\n\n**启动所有虚拟机：**\n\n```\nvagrant up\n```\n\n#### **2. SSH免密码登陆**\n\n使用**vagrant ssh**命令登陆虚拟机必须切换到Vagrantfile所在的目录，而直接使用虚拟机IP登陆虚拟机则更为方便:\n\n```\nssh vagrant@192.168.59.2\n```\n\n此时SSH登陆需要输入虚拟机vagrant用户的密码，即**vagrant**\n\n将主机的公钥复制到虚拟机的authorized_keys文件中即可实现SSH免密码登陆:\n\n```\ncat $HOME/.ssh/id_rsa.pub | ssh vagrant@192.168.59.2 'cat >> $HOME/.ssh/authorized_keys'\n```\n\n#### **3. 重新安装软件**\n\nVagrant中有下面一段内容：\n\n```\n# 使用shell脚本进行软件安装和配置\nnode.vm.provision \"shell\", inline: <<-SHELL\n\n\t# 安装docker 1.11.0\n\twget -qO- https://get.docker.com/ | sed 's/docker-engine/docker-engine=1.11.0-0~trusty/' | sh\n\tusermod -aG docker vagrant\nSHELL\n```\n\n其实就是嵌入了一段Shell脚本进行软件的安装和配置，这里我安装了[Docker](https://www.docker.com/)，当然也可以安装其他所需要的软件。修改此段内容之后，重新创建虚拟机需要使用\"--provision\"选项。\n\n```\nvagrant halt\nvagrant up --provision\n```\n\n#### **4. 共享目录挂载出错**\n\nVirtualBox设置共享目录时需要在虚拟机中安装VirtualBox Guest Additions，这个Vagrant会自动安装。但是，VirtualBox Guest Additions是内核模块，当虚拟机的内核升级之后，VirtualBox Guest Additions会失效，导致共享目录挂载失败，出错信息如下:\n\n```\nFailed to mount folders in Linux guest. This is usually because\nthe \"vboxsf\" file system is not available. Please verify that\nthe guest additions are properly installed in the guest and\ncan work properly. The command attempted was:\n\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant\nmount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant\n\nThe error output from the last command was:\n\nstdin: is not a tty\n/sbin/mount.vboxsf: mounting failed with the error: No such device\n```\n\n安装Vagrant插件[vagrant-vbguest](https://github.com/dotless-de/vagrant-vbguest)可以解决这个问题，因为该插件会在虚拟机内核升级之后重新安装VirtualBox Guest Additions。\n\n```\nvagrant plugin install vagrant-vbguest\n```","slug":"2016/07/03/vagrant-vm-cluster","published":1,"updated":"2016-11-07T01:32:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemw000smkfywf6ujmll","content":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">&#x4F7F;&#x7528;Vagrant&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</a>&#xFF0C;&#x4F46;&#x662F;&#x6240;&#x521B;&#x5EFA;&#x7684;&#x53EA;&#x662F;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<a href=\"http://hadoop.apache.org/\" target=\"_blank\" rel=\"external\">Hadoop</a>&#xFF0C;<a href=\"http://spark.apache.org/\" target=\"_blank\" rel=\"external\">Spark</a>&#x4EE5;&#x53CA;<a href=\"http://storm.apache.org/\" target=\"_blank\" rel=\"external\">Storm</a>&#x7B49;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">2016-07-03</a></li>\n</ul>\n<p><img src=\"/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png\" width=\"500\"></p>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"><a href=\"#&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\" class=\"headerlink\" title=\"&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"></a>&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\" target=\"_blank\" rel=\"external\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\" target=\"_blank\" rel=\"external\">Vagrant</a></strong></h4><h4 id=\"3-&#x4E0B;&#x8F7D;Box\"><a href=\"#3-&#x4E0B;&#x8F7D;Box\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Box\"></a><strong>3. &#x4E0B;&#x8F7D;Box</strong></h4><figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">vagrant</span> <span class=\"keyword\">box </span><span class=\"keyword\">add </span>ubuntu/trusty64</div></pre></td></tr></table></figure>\n<p><strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;</p>\n<h4 id=\"4-&#x7F16;&#x8F91;Vagrantfile\"><a href=\"#4-&#x7F16;&#x8F91;Vagrantfile\" class=\"headerlink\" title=\"4. &#x7F16;&#x8F91;Vagrantfile\"></a><strong>4. &#x7F16;&#x8F91;Vagrantfile</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">mkdir</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\">vim Vagrantfile</div></pre></td></tr></table></figure>\n<p>Vagrantfile&#x5982;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#xFF1A;</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"string\">&quot;2&quot;</span>) do |config|</div><div class=\"line\"></div><div class=\"line\">\t(<span class=\"number\">1</span>..<span class=\"number\">3</span>).each do |i|</div><div class=\"line\"></div><div class=\"line\">\t\tconfig.vm.define <span class=\"string\">&quot;node#{i}&quot;</span> do |<span class=\"keyword\">node</span><span class=\"title\">|</span></div><div class=\"line\"></div><div class=\"line\">\t\t# &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.<span class=\"attr\">hostname=</span><span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.59.#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provider <span class=\"string\">&quot;virtualbox&quot;</span> do |v|</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">\t\t\tv.name = <span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;  </span></div><div class=\"line\">\t\t\tv.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">\t\t\tv.cpus = <span class=\"number\">1</span></div><div class=\"line\">\t\tend</div><div class=\"line\">  </div><div class=\"line\">\t\t<span class=\"comment\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: <span class=\"tag\">&lt;&lt;-SHELL</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t# &#x5B89;&#x88C5;docker 1.11.0</div><div class=\"line\">\t\t\twget -qO- https://get.docker.com/ | sed &apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos; | sh</div><div class=\"line\">\t\t\tusermod -aG docker vagrant</div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\tSHELL</div><div class=\"line\"></div><div class=\"line\">\t\tend</div><div class=\"line\">\tend</div><div class=\"line\">end</div></pre></td></tr></table></figure>\n<p>&#x4E0E;&#x521B;&#x5EFA;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x76F8;&#x6BD4;&#xFF0C;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x5FAA;&#x73AF;&#xFF0C;&#x800C;&#x53D8;&#x91CF;i&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x540D;&#x79F0;&#x4E0E;IP&#xFF0C;&#x4F7F;&#x7528;<strong>#{i}</strong>&#x53D6;&#x503C;&#xFF1A;</p>\n<figure class=\"highlight coq\"><table><tr><td class=\"code\"><pre><div class=\"line\">(<span class=\"number\">1.</span><span class=\"number\">.3</span>).each <span class=\"built_in\">do</span> |<span class=\"type\">i</span>|</div><div class=\"line\"></div><div class=\"line\"><span class=\"type\">end</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4E00;&#x5171;&#x521B;&#x5EFA;&#x4E86;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;</p>\n<h4 id=\"5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x5927;&#x6982;&#x9700;&#x8981;15&#x5206;&#x949F;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x548C;&#x673A;&#x5668;&#x6027;&#x80FD;&#x8FD8;&#x6709;&#x7F51;&#x901F;&#x76F8;&#x5173;&#x3002;&#x5B89;&#x88C5;Docker&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x6162;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x5220;&#x9664;&#x4E0B;&#x9762;&#x51E0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x662F;Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x66F4;&#x6539;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;2GB</li>\n<li>CPU: 1</li>\n</ul>\n<h2 id=\"&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"><a href=\"#&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"></a>&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;</h2><h4 id=\"1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\"><a href=\"#1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\" class=\"headerlink\" title=\"1. &#x5E38;&#x7528;&#x547D;&#x4EE4;\"></a><strong>1. &#x5E38;&#x7528;&#x547D;&#x4EE4;</strong></h4><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;Vagrant&#x7BA1;&#x7406;&#x547D;&#x4EE4;&#xFF0C;&#x64CD;&#x4F5C;&#x7279;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x4EC5;&#x9700;&#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<ul>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant halt:</strong> &#x5173;&#x95ED;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant destroy:</strong> &#x5220;&#x9664;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh-config</strong> &#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;SSH&#x914D;&#x7F6E;</li>\n</ul>\n<p><strong>&#x542F;&#x52A8;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1 node3</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x6240;&#x6709;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">59</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">192.168.59.2</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant halt</div><div class=\"line\">vagrant up <span class=\"comment\">--provision</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"><a href=\"#4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\" class=\"headerlink\" title=\"4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"></a><strong>4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;</strong></h4><p>VirtualBox&#x8BBE;&#x7F6E;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x65F6;&#x9700;&#x8981;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x5B89;&#x88C5;VirtualBox Guest Additions&#xFF0C;&#x8FD9;&#x4E2A;Vagrant&#x4F1A;&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x3002;&#x4F46;&#x662F;&#xFF0C;VirtualBox Guest Additions&#x662F;&#x5185;&#x6838;&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#xFF0C;VirtualBox Guest Additions&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x5BFC;&#x81F4;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">Failed <span class=\"built_in\">to</span> mount <span class=\"built_in\">folders</span> <span class=\"keyword\">in</span> Linux guest. This is usually because</div><div class=\"line\"><span class=\"keyword\">the</span> <span class=\"string\">&quot;vboxsf&quot;</span> <span class=\"built_in\">file</span> <span class=\"keyword\">system</span> is <span class=\"keyword\">not</span> available. Please verify that</div><div class=\"line\"><span class=\"keyword\">the</span> guest additions are properly installed <span class=\"keyword\">in</span> <span class=\"keyword\">the</span> guest <span class=\"keyword\">and</span></div><div class=\"line\">can work properly. The <span class=\"keyword\">command</span> <span class=\"title\">attempted</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant</div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant</div><div class=\"line\"></div><div class=\"line\">The error output <span class=\"built_in\">from</span> <span class=\"keyword\">the</span> <span class=\"keyword\">last</span> <span class=\"keyword\">command</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">stdin</span>: is <span class=\"keyword\">not</span> <span class=\"keyword\">a</span> tty</div><div class=\"line\">/sbin/mount.vboxsf: mounting failed <span class=\"keyword\">with</span> <span class=\"keyword\">the</span> error: No such device</div></pre></td></tr></table></figure>\n<p>&#x5B89;&#x88C5;Vagrant&#x63D2;&#x4EF6;<a href=\"https://github.com/dotless-de/vagrant-vbguest\" target=\"_blank\" rel=\"external\">vagrant-vbguest</a>&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x63D2;&#x4EF6;&#x4F1A;&#x5728;&#x865A;&#x62DF;&#x673A;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x5B89;&#x88C5;VirtualBox Guest Additions&#x3002;</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant plugin <span class=\"keyword\">install</span> vagrant-vbguest</div></pre></td></tr></table></figure>","excerpt":"<p><strong>&#x6458;&#x8981;:</strong> &#x5728;&#x524D;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E86;<a href=\"http://kiwenlau.com/2016/06/19/160619-vagrant-virtual-machine/\">&#x4F7F;&#x7528;Vagrant&#x5FEB;&#x901F;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</a>&#xFF0C;&#x4F46;&#x662F;&#x6240;&#x521B;&#x5EFA;&#x7684;&#x53EA;&#x662F;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;<a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">&#x4F7F;&#x7528;Vagrant&#x521B;&#x5EFA;&#x591A;&#x8282;&#x70B9;&#x865A;&#x62DF;&#x673A;&#x96C6;&#x7FA4;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;<a href=\"http://hadoop.apache.org/\">Hadoop</a>&#xFF0C;<a href=\"http://spark.apache.org/\">Spark</a>&#x4EE5;&#x53CA;<a href=\"http://storm.apache.org/\">Storm</a>&#x7B49;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;</p>","more":"<ul>\n<li>&#x4F5C;&#x8005;: <a href=\"http://kiwenlau.com/\">KiwenLau</a></li>\n<li>&#x65E5;&#x671F;: <a href=\"http://kiwenlau.com/2016/07/03/vagrant-vm-cluster/\">2016-07-03</a></li>\n</ul>\n<p><img src=\"/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png\" width=\"500\"></p>\n<p>&#x672C;&#x6587;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x662F;&#x5728;MacBook&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#xFF0C;Windows&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x90E8;&#x5206;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>\n<h2 id=\"&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"><a href=\"#&#x4E00;-&#x96C6;&#x7FA4;&#x521B;&#x5EFA;\" class=\"headerlink\" title=\"&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;\"></a>&#x4E00;. &#x96C6;&#x7FA4;&#x521B;&#x5EFA;</h2><h4 id=\"1-&#x5B89;&#x88C5;VirtualBox\"><a href=\"#1-&#x5B89;&#x88C5;VirtualBox\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;VirtualBox\"></a><strong>1. &#x5B89;&#x88C5;<a href=\"https://www.virtualbox.org/wiki/Downloads\">VirtualBox</a></strong></h4><h4 id=\"2-&#x5B89;&#x88C5;Vagrant\"><a href=\"#2-&#x5B89;&#x88C5;Vagrant\" class=\"headerlink\" title=\"2. &#x5B89;&#x88C5;Vagrant\"></a><strong>2. &#x5B89;&#x88C5;<a href=\"https://www.vagrantup.com/downloads.html\">Vagrant</a></strong></h4><h4 id=\"3-&#x4E0B;&#x8F7D;Box\"><a href=\"#3-&#x4E0B;&#x8F7D;Box\" class=\"headerlink\" title=\"3. &#x4E0B;&#x8F7D;Box\"></a><strong>3. &#x4E0B;&#x8F7D;Box</strong></h4><figure class=\"highlight armasm\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"symbol\">vagrant</span> <span class=\"keyword\">box </span><span class=\"keyword\">add </span>ubuntu/trusty64</div></pre></td></tr></table></figure>\n<p><strong>Box</strong>&#x76F8;&#x5F53;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x3002;</p>\n<h4 id=\"4-&#x7F16;&#x8F91;Vagrantfile\"><a href=\"#4-&#x7F16;&#x8F91;Vagrantfile\" class=\"headerlink\" title=\"4. &#x7F16;&#x8F91;Vagrantfile\"></a><strong>4. &#x7F16;&#x8F91;Vagrantfile</strong></h4><figure class=\"highlight stata\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">mkdir</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\"><span class=\"keyword\">cd</span> vagrant-<span class=\"keyword\">cluster</span></div><div class=\"line\">vim Vagrantfile</div></pre></td></tr></table></figure>\n<p>Vagrantfile&#x5982;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6CE8;&#x91CA;&#x7406;&#x89E3;&#x6BCF;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x7684;&#x542B;&#x4E49;&#xFF1A;</p>\n<figure class=\"highlight crmsh\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vagrant.configure(<span class=\"string\">&quot;2&quot;</span>) do |config|</div><div class=\"line\"></div><div class=\"line\">\t(<span class=\"number\">1</span>..<span class=\"number\">3</span>).each do |i|</div><div class=\"line\"></div><div class=\"line\">\t\tconfig.vm.define <span class=\"string\">&quot;node#{i}&quot;</span> do |<span class=\"keyword\">node</span><span class=\"title\">|</span></div><div class=\"line\"></div><div class=\"line\">\t\t# &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;Box</div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.box = <span class=\"string\">&quot;ubuntu/trusty64&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.<span class=\"attr\">hostname=</span><span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;IP</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.network <span class=\"string\">&quot;private_network&quot;</span>, ip: <span class=\"string\">&quot;192.168.59.#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5171;&#x4EAB;&#x76EE;&#x5F55;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.synced_folder <span class=\"string\">&quot;~/Desktop/share&quot;</span>, <span class=\"string\">&quot;/home/vagrant/share&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\"># VirtaulBox&#x76F8;&#x5173;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provider <span class=\"string\">&quot;virtualbox&quot;</span> do |v|</div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;</span></div><div class=\"line\">\t\t\tv.name = <span class=\"string\">&quot;node#{i}&quot;</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;  </span></div><div class=\"line\">\t\t\tv.memory = <span class=\"number\">2048</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t<span class=\"comment\"># &#x8BBE;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7684;CPU&#x4E2A;&#x6570;</span></div><div class=\"line\">\t\t\tv.cpus = <span class=\"number\">1</span></div><div class=\"line\">\t\tend</div><div class=\"line\">  </div><div class=\"line\">\t\t<span class=\"comment\"># &#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</span></div><div class=\"line\">\t\t<span class=\"keyword\">node</span>.<span class=\"title\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: <span class=\"tag\">&lt;&lt;-SHELL</span></div><div class=\"line\"></div><div class=\"line\">\t\t\t# &#x5B89;&#x88C5;docker 1.11.0</div><div class=\"line\">\t\t\twget -qO- https://get.docker.com/ | sed &apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos; | sh</div><div class=\"line\">\t\t\tusermod -aG docker vagrant</div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\tSHELL</div><div class=\"line\"></div><div class=\"line\">\t\tend</div><div class=\"line\">\tend</div><div class=\"line\">end</div></pre></td></tr></table></figure>\n<p>&#x4E0E;&#x521B;&#x5EFA;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x76F8;&#x6BD4;&#xFF0C;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x5FAA;&#x73AF;&#xFF0C;&#x800C;&#x53D8;&#x91CF;i&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x8282;&#x70B9;&#x7684;&#x540D;&#x79F0;&#x4E0E;IP&#xFF0C;&#x4F7F;&#x7528;<strong>#{i}</strong>&#x53D6;&#x503C;&#xFF1A;</p>\n<figure class=\"highlight coq\"><table><tr><td class=\"code\"><pre><div class=\"line\">(<span class=\"number\">1.</span><span class=\"number\">.3</span>).each <span class=\"built_in\">do</span> |<span class=\"type\">i</span>|</div><div class=\"line\"></div><div class=\"line\"><span class=\"type\">end</span></div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4E00;&#x5171;&#x521B;&#x5EFA;&#x4E86;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x3002;</p>\n<h4 id=\"5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"><a href=\"#5-&#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\" class=\"headerlink\" title=\"5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;\"></a><strong>5. &#x5728;&#x684C;&#x9762;&#x4E0A;&#x521B;&#x5EFA;share&#x76EE;&#x5F55;</strong></h4><p>&#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">mkdir</span> ~/Desktop/share</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"><a href=\"#6-&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\" class=\"headerlink\" title=\"6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;\"></a><strong>6. &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</strong></h4><figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<p>&#x521B;&#x5EFA;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x5927;&#x6982;&#x9700;&#x8981;15&#x5206;&#x949F;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x548C;&#x673A;&#x5668;&#x6027;&#x80FD;&#x8FD8;&#x6709;&#x7F51;&#x901F;&#x76F8;&#x5173;&#x3002;&#x5B89;&#x88C5;Docker&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x6162;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x5220;&#x9664;&#x4E0B;&#x9762;&#x51E0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\"></div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x662F;Vagrant&#x865A;&#x62DF;&#x673A;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x66F4;&#x6539;:</p>\n<ul>\n<li>&#x7528;&#x6237;/&#x5BC6;&#x7801;: vagrant/vagrant</li>\n<li>&#x5171;&#x4EAB;&#x76EE;&#x5F55;: &#x684C;&#x9762;&#x4E0A;&#x7684;share&#x76EE;&#x5F55;&#x5C06;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684;/home/vagrant/share&#x76EE;&#x5F55;&#x5185;&#x5BB9;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</li>\n<li>&#x5185;&#x5B58;&#xFF1A;2GB</li>\n<li>CPU: 1</li>\n</ul>\n<h2 id=\"&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"><a href=\"#&#x4E8C;-&#x96C6;&#x7FA4;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;\"></a>&#x4E8C;. &#x96C6;&#x7FA4;&#x7BA1;&#x7406;</h2><h4 id=\"1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\"><a href=\"#1-&#x5E38;&#x7528;&#x547D;&#x4EE4;\" class=\"headerlink\" title=\"1. &#x5E38;&#x7528;&#x547D;&#x4EE4;\"></a><strong>1. &#x5E38;&#x7528;&#x547D;&#x4EE4;</strong></h4><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;Vagrant&#x7BA1;&#x7406;&#x547D;&#x4EE4;&#xFF0C;&#x64CD;&#x4F5C;&#x7279;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x65F6;&#x4EC5;&#x9700;&#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<ul>\n<li><strong>vagrant ssh:</strong> SSH&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant halt:</strong> &#x5173;&#x95ED;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant destroy:</strong> &#x5220;&#x9664;&#x865A;&#x62DF;&#x673A;</li>\n<li><strong>vagrant ssh-config</strong> &#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;SSH&#x914D;&#x7F6E;</li>\n</ul>\n<p><strong>&#x542F;&#x52A8;&#x5355;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant</span> up node1 node3</div></pre></td></tr></table></figure>\n<p><strong>&#x542F;&#x52A8;&#x6240;&#x6709;&#x865A;&#x62DF;&#x673A;&#xFF1A;</strong></p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">vagrant up</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"><a href=\"#2-SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\" class=\"headerlink\" title=\"2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;\"></a><strong>2. SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;</strong></h4><p>&#x4F7F;&#x7528;<strong>vagrant ssh</strong>&#x547D;&#x4EE4;&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5FC5;&#x987B;&#x5207;&#x6362;&#x5230;Vagrantfile&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x673A;IP&#x767B;&#x9646;&#x865A;&#x62DF;&#x673A;&#x5219;&#x66F4;&#x4E3A;&#x65B9;&#x4FBF;:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">ssh</span> <span class=\"selector-tag\">vagrant</span>@<span class=\"keyword\">192</span>.<span class=\"keyword\">168</span>.<span class=\"keyword\">59</span>.<span class=\"keyword\">2</span></div></pre></td></tr></table></figure>\n<p>&#x6B64;&#x65F6;SSH&#x767B;&#x9646;&#x9700;&#x8981;&#x8F93;&#x5165;&#x865A;&#x62DF;&#x673A;vagrant&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x5373;<strong>vagrant</strong></p>\n<p>&#x5C06;&#x4E3B;&#x673A;&#x7684;&#x516C;&#x94A5;&#x590D;&#x5236;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7684;authorized_keys&#x6587;&#x4EF6;&#x4E2D;&#x5373;&#x53EF;&#x5B9E;&#x73B0;SSH&#x514D;&#x5BC6;&#x7801;&#x767B;&#x9646;:</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"attribute\">cat</span> <span class=\"variable\">$HOME</span>/.ssh/id_rsa.pub | ssh vagrant@<span class=\"number\">192.168.59.2</span> <span class=\"string\">&apos;cat &gt;&gt; <span class=\"variable\">$HOME</span>/.ssh/authorized_keys&apos;</span></div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"><a href=\"#3-&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;\"></a><strong>3. &#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;</strong></h4><p>Vagrant&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x4E00;&#x6BB5;&#x5185;&#x5BB9;&#xFF1A;</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x4F7F;&#x7528;<span class=\"keyword\">shell</span>&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;</div><div class=\"line\">node.<span class=\"keyword\">vm</span>.provision <span class=\"string\">&quot;shell&quot;</span>, inline: &lt;&lt;-SHELL</div><div class=\"line\"></div><div class=\"line\">\t# &#x5B89;&#x88C5;docker <span class=\"number\">1.11</span>.<span class=\"number\">0</span></div><div class=\"line\">\twget -qO- http<span class=\"variable\">s:</span>//<span class=\"built_in\">get</span>.docker.<span class=\"keyword\">com</span>/ | sed <span class=\"string\">&apos;s/docker-engine/docker-engine=1.11.0-0~trusty/&apos;</span> | <span class=\"keyword\">sh</span></div><div class=\"line\">\tusermod -aG docker vagrant</div><div class=\"line\">SHELL</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5D4C;&#x5165;&#x4E86;&#x4E00;&#x6BB5;Shell&#x811A;&#x672C;&#x8FDB;&#x884C;&#x8F6F;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5B89;&#x88C5;&#x4E86;<a href=\"https://www.docker.com/\">Docker</a>&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x5176;&#x4ED6;&#x6240;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x3002;&#x4FEE;&#x6539;&#x6B64;&#x6BB5;&#x5185;&#x5BB9;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x201D;&#x2013;provision&#x201D;&#x9009;&#x9879;&#x3002;</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant halt</div><div class=\"line\">vagrant up <span class=\"comment\">--provision</span></div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"><a href=\"#4-&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\" class=\"headerlink\" title=\"4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;\"></a><strong>4. &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x51FA;&#x9519;</strong></h4><p>VirtualBox&#x8BBE;&#x7F6E;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x65F6;&#x9700;&#x8981;&#x5728;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x5B89;&#x88C5;VirtualBox Guest Additions&#xFF0C;&#x8FD9;&#x4E2A;Vagrant&#x4F1A;&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x3002;&#x4F46;&#x662F;&#xFF0C;VirtualBox Guest Additions&#x662F;&#x5185;&#x6838;&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#xFF0C;VirtualBox Guest Additions&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x5BFC;&#x81F4;&#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\">Failed <span class=\"built_in\">to</span> mount <span class=\"built_in\">folders</span> <span class=\"keyword\">in</span> Linux guest. This is usually because</div><div class=\"line\"><span class=\"keyword\">the</span> <span class=\"string\">&quot;vboxsf&quot;</span> <span class=\"built_in\">file</span> <span class=\"keyword\">system</span> is <span class=\"keyword\">not</span> available. Please verify that</div><div class=\"line\"><span class=\"keyword\">the</span> guest additions are properly installed <span class=\"keyword\">in</span> <span class=\"keyword\">the</span> guest <span class=\"keyword\">and</span></div><div class=\"line\">can work properly. The <span class=\"keyword\">command</span> <span class=\"title\">attempted</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`getent group vagrant | cut -d: -f3` vagrant /vagrant</div><div class=\"line\">mount -t vboxsf -o uid=`id -u vagrant`,gid=`id -g vagrant` vagrant /vagrant</div><div class=\"line\"></div><div class=\"line\">The error output <span class=\"built_in\">from</span> <span class=\"keyword\">the</span> <span class=\"keyword\">last</span> <span class=\"keyword\">command</span> <span class=\"title\">was</span>:</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">stdin</span>: is <span class=\"keyword\">not</span> <span class=\"keyword\">a</span> tty</div><div class=\"line\">/sbin/mount.vboxsf: mounting failed <span class=\"keyword\">with</span> <span class=\"keyword\">the</span> error: No such device</div></pre></td></tr></table></figure>\n<p>&#x5B89;&#x88C5;Vagrant&#x63D2;&#x4EF6;<a href=\"https://github.com/dotless-de/vagrant-vbguest\">vagrant-vbguest</a>&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x63D2;&#x4EF6;&#x4F1A;&#x5728;&#x865A;&#x62DF;&#x673A;&#x5185;&#x6838;&#x5347;&#x7EA7;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x5B89;&#x88C5;VirtualBox Guest Additions&#x3002;</p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"code\"><pre><div class=\"line\">vagrant plugin <span class=\"keyword\">install</span> vagrant-vbguest</div></pre></td></tr></table></figure>"},{"title":"Fundebug上线小程序错误监控啦","date":"2017-01-23T01:00:00.000Z","_content":"\n作为专业的JavaSript错误实时监测平台，[Fundebug](https://fundebug.com/)的**微信小程序实时错误监测服务**上线啦，我们能够帮助开发者及时，高效地发现并且解决小程序错误，从而提升用户体验。\n\n<!-- more -->\n\n#### 小程序大时代\n\n后移动互联网时代，创业者们纠结于开发APP还是公众号，而小程序的横空出世，让大家多了一种选择，也给未来增加了更多想象空间。\n\n小程序，正如它的名字，可以理解为迷你版的APP；它生根于微信帝国，因此也可以看作升级版的公众号。准确的说，小程序介于APP的灵活与公众号的轻巧之间，符合国人对中庸之道的信仰。对于那些低频，简单的工具类应用，小程序应该是一个不错的选择。\n\n从技术角度理解，小程序=**WXML + WXSS + JavaScrip**。WXML与WXSS只不过是换了个马甲的HTML与CSS，而JavaScript还是那个无处不在的JavaScript。或者说，小程序就是定制版的**HTML + CSS + JavaScript**。对于开发者，小程序没有什么神奇之处，不过是写几个简单的网页罢了。\n\n如果说小程序预示着一个应用轻型化的小时代，那么JavaScript正在开创属于它的大时代，从网页，到后端，到小程序，到APP以及智能硬件...\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-wxjs/fundebug-wxjs.jpg\" />\n</div>\n\n\n#### Fundebug为什么监测小程序？\n\n程序员通常是比较自信的，他们坚持**自己写的代码没有问题**。然而，再追问一下自己：\n\n- 我的代码真的100%没有问题吗？\n- 我做了完整的测试吗？\n- 难道我要花更多的时间没完没了的写单元测试？\n\n有时，用户打开某个页面是空白的：\n\n<div style=\"text-align: center;\">\n<img style=\"width:40%;\" src=\"fundebug-support-wxjs/empty.png\" />\n</div>\n\n然后，用户转身离开了:(\n\n**那么问题在哪？**\n\n- 小程序在用户的手机上出错了，可是开发者不知道啊；\n- 当有用户反馈问题的时候，其实更多用户已经被坑了啊；\n- 知道出问题了，然而开发者没有出错信息，无从下手啊；\n\n#### 为什么是Fundebug？\n\n- 小程序在用户的手机上出错了，Fundebug第一时间通过邮件提醒开发者；\n- Fundebug提供详细的出错信息和强大的错误管理面板，帮助开发者快速解决错误；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 两行代码搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n#### 如何使用Fundebug?\n\n##### 1. 下载Fundebug微信小程序插件<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download>fundebug.0.0.3.min.js</a>\n\n微信小程序不支持导入外部JavaScript文件，因此需要手动下载，然后放到项目目录内。\n\n##### 2. 在`app.js`中引入fundebug并配置`apikey`:\n\n```js\nvar fundebug = require('./libs/fundebug.0.0.3.min.js')\nfundebug.apikey = \"API-KEY\";\n```\n\n- `./libs/fundebug.0.0.3.min.js`为相对于`app.js`的路径 。\n- 获取**apiKey需要**[免费注册](https://fundebug.com/team/create)帐号并且[创建项目](https://fundebug.com/project/create)。\n\n##### 3. 将[https://fundebug.com](https://fundebug.com)添加到**request合法域名**\n\n具体步骤请查看[Fundebug文档](https://docs.fundebug.com/notifier/wxjs/)\n","source":"_posts/2017/01/23/fundebug-support-wxjs.md","raw":"---\ntitle: Fundebug上线小程序错误监控啦\n\ndate: 2017-01-23 09:00:00\n\ntags: [Fundebug, 小程序]\n---\n\n作为专业的JavaSript错误实时监测平台，[Fundebug](https://fundebug.com/)的**微信小程序实时错误监测服务**上线啦，我们能够帮助开发者及时，高效地发现并且解决小程序错误，从而提升用户体验。\n\n<!-- more -->\n\n#### 小程序大时代\n\n后移动互联网时代，创业者们纠结于开发APP还是公众号，而小程序的横空出世，让大家多了一种选择，也给未来增加了更多想象空间。\n\n小程序，正如它的名字，可以理解为迷你版的APP；它生根于微信帝国，因此也可以看作升级版的公众号。准确的说，小程序介于APP的灵活与公众号的轻巧之间，符合国人对中庸之道的信仰。对于那些低频，简单的工具类应用，小程序应该是一个不错的选择。\n\n从技术角度理解，小程序=**WXML + WXSS + JavaScrip**。WXML与WXSS只不过是换了个马甲的HTML与CSS，而JavaScript还是那个无处不在的JavaScript。或者说，小程序就是定制版的**HTML + CSS + JavaScript**。对于开发者，小程序没有什么神奇之处，不过是写几个简单的网页罢了。\n\n如果说小程序预示着一个应用轻型化的小时代，那么JavaScript正在开创属于它的大时代，从网页，到后端，到小程序，到APP以及智能硬件...\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-wxjs/fundebug-wxjs.jpg\" />\n</div>\n\n\n#### Fundebug为什么监测小程序？\n\n程序员通常是比较自信的，他们坚持**自己写的代码没有问题**。然而，再追问一下自己：\n\n- 我的代码真的100%没有问题吗？\n- 我做了完整的测试吗？\n- 难道我要花更多的时间没完没了的写单元测试？\n\n有时，用户打开某个页面是空白的：\n\n<div style=\"text-align: center;\">\n<img style=\"width:40%;\" src=\"fundebug-support-wxjs/empty.png\" />\n</div>\n\n然后，用户转身离开了:(\n\n**那么问题在哪？**\n\n- 小程序在用户的手机上出错了，可是开发者不知道啊；\n- 当有用户反馈问题的时候，其实更多用户已经被坑了啊；\n- 知道出问题了，然而开发者没有出错信息，无从下手啊；\n\n#### 为什么是Fundebug？\n\n- 小程序在用户的手机上出错了，Fundebug第一时间通过邮件提醒开发者；\n- Fundebug提供详细的出错信息和强大的错误管理面板，帮助开发者快速解决错误；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 两行代码搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n#### 如何使用Fundebug?\n\n##### 1. 下载Fundebug微信小程序插件<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download>fundebug.0.0.3.min.js</a>\n\n微信小程序不支持导入外部JavaScript文件，因此需要手动下载，然后放到项目目录内。\n\n##### 2. 在`app.js`中引入fundebug并配置`apikey`:\n\n```js\nvar fundebug = require('./libs/fundebug.0.0.3.min.js')\nfundebug.apikey = \"API-KEY\";\n```\n\n- `./libs/fundebug.0.0.3.min.js`为相对于`app.js`的路径 。\n- 获取**apiKey需要**[免费注册](https://fundebug.com/team/create)帐号并且[创建项目](https://fundebug.com/project/create)。\n\n##### 3. 将[https://fundebug.com](https://fundebug.com)添加到**request合法域名**\n\n具体步骤请查看[Fundebug文档](https://docs.fundebug.com/notifier/wxjs/)\n","slug":"2017/01/23/fundebug-support-wxjs","published":1,"updated":"2017-02-13T00:44:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemw000umkfyftllgbl9","content":"<p>&#x4F5C;&#x4E3A;&#x4E13;&#x4E1A;&#x7684;JavaSript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;<strong>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x670D;&#x52A1;</strong>&#x4E0A;&#x7EBF;&#x5566;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x53CA;&#x65F6;&#xFF0C;&#x9AD8;&#x6548;&#x5730;&#x53D1;&#x73B0;&#x5E76;&#x4E14;&#x89E3;&#x51B3;&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<a id=\"more\"></a>\n<h4 id=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"><a href=\"#&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\" class=\"headerlink\" title=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"></a>&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;</h4><p>&#x540E;&#x79FB;&#x52A8;&#x4E92;&#x8054;&#x7F51;&#x65F6;&#x4EE3;&#xFF0C;&#x521B;&#x4E1A;&#x8005;&#x4EEC;&#x7EA0;&#x7ED3;&#x4E8E;&#x5F00;&#x53D1;APP&#x8FD8;&#x662F;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x800C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x591A;&#x4E86;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#xFF0C;&#x4E5F;&#x7ED9;&#x672A;&#x6765;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x60F3;&#x8C61;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6B63;&#x5982;&#x5B83;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x8FF7;&#x4F60;&#x7248;&#x7684;APP&#xFF1B;&#x5B83;&#x751F;&#x6839;&#x4E8E;&#x5FAE;&#x4FE1;&#x5E1D;&#x56FD;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x5347;&#x7EA7;&#x7248;&#x7684;&#x516C;&#x4F17;&#x53F7;&#x3002;&#x51C6;&#x786E;&#x7684;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x4ECB;&#x4E8E;APP&#x7684;&#x7075;&#x6D3B;&#x4E0E;&#x516C;&#x4F17;&#x53F7;&#x7684;&#x8F7B;&#x5DE7;&#x4E4B;&#x95F4;&#xFF0C;&#x7B26;&#x5408;&#x56FD;&#x4EBA;&#x5BF9;&#x4E2D;&#x5EB8;&#x4E4B;&#x9053;&#x7684;&#x4FE1;&#x4EF0;&#x3002;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x4F4E;&#x9891;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#x5E94;&#x7528;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x4ECE;&#x6280;&#x672F;&#x89D2;&#x5EA6;&#x7406;&#x89E3;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;=<strong>WXML + WXSS + JavaScrip</strong>&#x3002;WXML&#x4E0E;WXSS&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x6362;&#x4E86;&#x4E2A;&#x9A6C;&#x7532;&#x7684;HTML&#x4E0E;CSS&#xFF0C;&#x800C;JavaScript&#x8FD8;&#x662F;&#x90A3;&#x4E2A;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#x7684;JavaScript&#x3002;&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;&#x5B9A;&#x5236;&#x7248;&#x7684;<strong>HTML + CSS + JavaScript</strong>&#x3002;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x795E;&#x5947;&#x4E4B;&#x5904;&#xFF0C;&#x4E0D;&#x8FC7;&#x662F;&#x5199;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x9875;&#x7F62;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x8BF4;&#x5C0F;&#x7A0B;&#x5E8F;&#x9884;&#x793A;&#x7740;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x8F7B;&#x578B;&#x5316;&#x7684;&#x5C0F;&#x65F6;&#x4EE3;&#xFF0C;&#x90A3;&#x4E48;JavaScript&#x6B63;&#x5728;&#x5F00;&#x521B;&#x5C5E;&#x4E8E;&#x5B83;&#x7684;&#x5927;&#x65F6;&#x4EE3;&#xFF0C;&#x4ECE;&#x7F51;&#x9875;&#xFF0C;&#x5230;&#x540E;&#x7AEF;&#xFF0C;&#x5230;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x5230;APP&#x4EE5;&#x53CA;&#x667A;&#x80FD;&#x786C;&#x4EF6;&#x2026;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg\"><br></div>\n\n\n<h4 id=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"><a href=\"#Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\" class=\"headerlink\" title=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"></a>Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;</h4><p>&#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x662F;&#x6BD4;&#x8F83;&#x81EA;&#x4FE1;&#x7684;&#xFF0C;&#x4ED6;&#x4EEC;&#x575A;&#x6301;<strong>&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x95EE;&#x9898;</strong>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x518D;&#x8FFD;&#x95EE;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#xFF1A;</p>\n<ul>\n<li>&#x6211;&#x7684;&#x4EE3;&#x7801;&#x771F;&#x7684;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x5417;&#xFF1F;</li>\n<li>&#x6211;&#x505A;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x6D4B;&#x8BD5;&#x5417;&#xFF1F;</li>\n<li>&#x96BE;&#x9053;&#x6211;&#x8981;&#x82B1;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x7684;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</li>\n</ul>\n<p>&#x6709;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x6253;&#x5F00;&#x67D0;&#x4E2A;&#x9875;&#x9762;&#x662F;&#x7A7A;&#x767D;&#x7684;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:40%;\" src=\"/2017/01/23/fundebug-support-wxjs/empty.png\"><br></div>\n\n<p>&#x7136;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x8F6C;&#x8EAB;&#x79BB;&#x5F00;&#x4E86;:(</p>\n<p><strong>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5728;&#x54EA;&#xFF1F;</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x77E5;&#x9053;&#x554A;&#xFF1B;</li>\n<li>&#x5F53;&#x6709;&#x7528;&#x6237;&#x53CD;&#x9988;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x66F4;&#x591A;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x88AB;&#x5751;&#x4E86;&#x554A;&#xFF1B;</li>\n<li>&#x77E5;&#x9053;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x6CA1;&#x6709;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#x554A;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;</h4><ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;Fundebug&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>Fundebug&#x63D0;&#x4F9B;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x9519;&#x8BEF;&#x7BA1;&#x7406;&#x9762;&#x677F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x5FEB;&#x901F;&#x89E3;&#x51B3;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<h4 id=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\"><a href=\"#&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?\"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?</h4><h5 id=\"1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\"><a href=\"#1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug.0.0.3.min.js\"></a>1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download=\"\" target=\"_blank\" rel=\"external\">fundebug.0.0.3.min.js</a></h5><p>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0D;&#x652F;&#x6301;&#x5BFC;&#x5165;&#x5916;&#x90E8;JavaScript&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4E0B;&#x8F7D;&#xFF0C;&#x7136;&#x540E;&#x653E;&#x5230;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x5185;&#x3002;</p>\n<h5 id=\"2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\"><a href=\"#2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\" class=\"headerlink\" title=\"2. &#x5728;app.js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:\"></a>2. &#x5728;<code>app.js</code>&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;<code>apikey</code>:</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fundebug = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;./libs/fundebug.0.0.3.min.js&apos;</span>)</div><div class=\"line\">fundebug.apikey = <span class=\"string\">&quot;API-KEY&quot;</span>;</div></pre></td></tr></table></figure>\n<ul>\n<li><code>./libs/fundebug.0.0.3.min.js</code>&#x4E3A;&#x76F8;&#x5BF9;&#x4E8E;<code>app.js</code>&#x7684;&#x8DEF;&#x5F84; &#x3002;</li>\n<li>&#x83B7;&#x53D6;<strong>apiKey&#x9700;&#x8981;</strong><a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5E10;&#x53F7;&#x5E76;&#x4E14;<a href=\"https://fundebug.com/project/create\" target=\"_blank\" rel=\"external\">&#x521B;&#x5EFA;&#x9879;&#x76EE;</a>&#x3002;</li>\n</ul>\n<h5 id=\"3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"><a href=\"#3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\" class=\"headerlink\" title=\"3. &#x5C06;https://fundebug.com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"></a>3. &#x5C06;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">https://fundebug.com</a>&#x6DFB;&#x52A0;&#x5230;<strong>request&#x5408;&#x6CD5;&#x57DF;&#x540D;</strong></h5><p>&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/wxjs/\" target=\"_blank\" rel=\"external\">Fundebug&#x6587;&#x6863;</a></p>\n","excerpt":"<p>&#x4F5C;&#x4E3A;&#x4E13;&#x4E1A;&#x7684;JavaSript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;<a href=\"https://fundebug.com/\">Fundebug</a>&#x7684;<strong>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x670D;&#x52A1;</strong>&#x4E0A;&#x7EBF;&#x5566;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x53CA;&#x65F6;&#xFF0C;&#x9AD8;&#x6548;&#x5730;&#x53D1;&#x73B0;&#x5E76;&#x4E14;&#x89E3;&#x51B3;&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>","more":"<h4 id=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"><a href=\"#&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\" class=\"headerlink\" title=\"&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;\"></a>&#x5C0F;&#x7A0B;&#x5E8F;&#x5927;&#x65F6;&#x4EE3;</h4><p>&#x540E;&#x79FB;&#x52A8;&#x4E92;&#x8054;&#x7F51;&#x65F6;&#x4EE3;&#xFF0C;&#x521B;&#x4E1A;&#x8005;&#x4EEC;&#x7EA0;&#x7ED3;&#x4E8E;&#x5F00;&#x53D1;APP&#x8FD8;&#x662F;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x800C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x6A2A;&#x7A7A;&#x51FA;&#x4E16;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x591A;&#x4E86;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#xFF0C;&#x4E5F;&#x7ED9;&#x672A;&#x6765;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x60F3;&#x8C61;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6B63;&#x5982;&#x5B83;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x8FF7;&#x4F60;&#x7248;&#x7684;APP&#xFF1B;&#x5B83;&#x751F;&#x6839;&#x4E8E;&#x5FAE;&#x4FE1;&#x5E1D;&#x56FD;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x5347;&#x7EA7;&#x7248;&#x7684;&#x516C;&#x4F17;&#x53F7;&#x3002;&#x51C6;&#x786E;&#x7684;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x4ECB;&#x4E8E;APP&#x7684;&#x7075;&#x6D3B;&#x4E0E;&#x516C;&#x4F17;&#x53F7;&#x7684;&#x8F7B;&#x5DE7;&#x4E4B;&#x95F4;&#xFF0C;&#x7B26;&#x5408;&#x56FD;&#x4EBA;&#x5BF9;&#x4E2D;&#x5EB8;&#x4E4B;&#x9053;&#x7684;&#x4FE1;&#x4EF0;&#x3002;&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x4F4E;&#x9891;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#x5E94;&#x7528;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>\n<p>&#x4ECE;&#x6280;&#x672F;&#x89D2;&#x5EA6;&#x7406;&#x89E3;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;=<strong>WXML + WXSS + JavaScrip</strong>&#x3002;WXML&#x4E0E;WXSS&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x6362;&#x4E86;&#x4E2A;&#x9A6C;&#x7532;&#x7684;HTML&#x4E0E;CSS&#xFF0C;&#x800C;JavaScript&#x8FD8;&#x662F;&#x90A3;&#x4E2A;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#x7684;JavaScript&#x3002;&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;&#x5B9A;&#x5236;&#x7248;&#x7684;<strong>HTML + CSS + JavaScript</strong>&#x3002;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x795E;&#x5947;&#x4E4B;&#x5904;&#xFF0C;&#x4E0D;&#x8FC7;&#x662F;&#x5199;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7F51;&#x9875;&#x7F62;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x8BF4;&#x5C0F;&#x7A0B;&#x5E8F;&#x9884;&#x793A;&#x7740;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x8F7B;&#x578B;&#x5316;&#x7684;&#x5C0F;&#x65F6;&#x4EE3;&#xFF0C;&#x90A3;&#x4E48;JavaScript&#x6B63;&#x5728;&#x5F00;&#x521B;&#x5C5E;&#x4E8E;&#x5B83;&#x7684;&#x5927;&#x65F6;&#x4EE3;&#xFF0C;&#x4ECE;&#x7F51;&#x9875;&#xFF0C;&#x5230;&#x540E;&#x7AEF;&#xFF0C;&#x5230;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x5230;APP&#x4EE5;&#x53CA;&#x667A;&#x80FD;&#x786C;&#x4EF6;&#x2026;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg\"><br></div>\n\n\n<h4 id=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"><a href=\"#Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\" class=\"headerlink\" title=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;\"></a>Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF1F;</h4><p>&#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x662F;&#x6BD4;&#x8F83;&#x81EA;&#x4FE1;&#x7684;&#xFF0C;&#x4ED6;&#x4EEC;&#x575A;&#x6301;<strong>&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x95EE;&#x9898;</strong>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x518D;&#x8FFD;&#x95EE;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#xFF1A;</p>\n<ul>\n<li>&#x6211;&#x7684;&#x4EE3;&#x7801;&#x771F;&#x7684;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x5417;&#xFF1F;</li>\n<li>&#x6211;&#x505A;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x6D4B;&#x8BD5;&#x5417;&#xFF1F;</li>\n<li>&#x96BE;&#x9053;&#x6211;&#x8981;&#x82B1;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x7684;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</li>\n</ul>\n<p>&#x6709;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x6253;&#x5F00;&#x67D0;&#x4E2A;&#x9875;&#x9762;&#x662F;&#x7A7A;&#x767D;&#x7684;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:40%;\" src=\"/2017/01/23/fundebug-support-wxjs/empty.png\"><br></div>\n\n<p>&#x7136;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x8F6C;&#x8EAB;&#x79BB;&#x5F00;&#x4E86;:(</p>\n<p><strong>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5728;&#x54EA;&#xFF1F;</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x77E5;&#x9053;&#x554A;&#xFF1B;</li>\n<li>&#x5F53;&#x6709;&#x7528;&#x6237;&#x53CD;&#x9988;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x5B9E;&#x66F4;&#x591A;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x88AB;&#x5751;&#x4E86;&#x554A;&#xFF1B;</li>\n<li>&#x77E5;&#x9053;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x6CA1;&#x6709;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#x554A;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;</h4><ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;Fundebug&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>Fundebug&#x63D0;&#x4F9B;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x548C;&#x5F3A;&#x5927;&#x7684;&#x9519;&#x8BEF;&#x7BA1;&#x7406;&#x9762;&#x677F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x5FEB;&#x901F;&#x89E3;&#x51B3;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<h4 id=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\"><a href=\"#&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?\"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?</h4><h5 id=\"1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\"><a href=\"#1-&#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug-0-0-3-min-js\" class=\"headerlink\" title=\"1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;fundebug.0.0.3.min.js\"></a>1. &#x4E0B;&#x8F7D;Fundebug&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x63D2;&#x4EF6;<a href=\"https://ojv8yfncs.qnssl.com/fundebug.0.0.3.min.js\" download=\"\">fundebug.0.0.3.min.js</a></h5><p>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0D;&#x652F;&#x6301;&#x5BFC;&#x5165;&#x5916;&#x90E8;JavaScript&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4E0B;&#x8F7D;&#xFF0C;&#x7136;&#x540E;&#x653E;&#x5230;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x5185;&#x3002;</p>\n<h5 id=\"2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\"><a href=\"#2-&#x5728;app-js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\" class=\"headerlink\" title=\"2. &#x5728;app.js&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:\"></a>2. &#x5728;<code>app.js</code>&#x4E2D;&#x5F15;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;<code>apikey</code>:</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fundebug = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;./libs/fundebug.0.0.3.min.js&apos;</span>)</div><div class=\"line\">fundebug.apikey = <span class=\"string\">&quot;API-KEY&quot;</span>;</div></pre></td></tr></table></figure>\n<ul>\n<li><code>./libs/fundebug.0.0.3.min.js</code>&#x4E3A;&#x76F8;&#x5BF9;&#x4E8E;<code>app.js</code>&#x7684;&#x8DEF;&#x5F84; &#x3002;</li>\n<li>&#x83B7;&#x53D6;<strong>apiKey&#x9700;&#x8981;</strong><a href=\"https://fundebug.com/team/create\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5E10;&#x53F7;&#x5E76;&#x4E14;<a href=\"https://fundebug.com/project/create\">&#x521B;&#x5EFA;&#x9879;&#x76EE;</a>&#x3002;</li>\n</ul>\n<h5 id=\"3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"><a href=\"#3-&#x5C06;https-fundebug-com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\" class=\"headerlink\" title=\"3. &#x5C06;https://fundebug.com&#x6DFB;&#x52A0;&#x5230;request&#x5408;&#x6CD5;&#x57DF;&#x540D;\"></a>3. &#x5C06;<a href=\"https://fundebug.com\">https://fundebug.com</a>&#x6DFB;&#x52A0;&#x5230;<strong>request&#x5408;&#x6CD5;&#x57DF;&#x540D;</strong></h5><p>&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/wxjs/\">Fundebug&#x6587;&#x6863;</a></p>"},{"title":"有浏览器的地方就有Fundebug","date":"2017-01-16T01:00:00.000Z","_content":"\n[Fundebug](https://fundebug.com)已经全面支持主流浏览器啦！\n\n对于前端开发者，兼容各种浏览器是一件非常痛苦的事情。在搜索框中输入关键字**JavaScript浏览器兼容**，结果是这样的:\n\n<!-- more -->\n\n- [IE和Firefox的Javascript兼容性总结](http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html)\n- [JavaScript中浏览器兼容问题](http://www.cnblogs.com/DF-fzh/p/5408241.html)\n- [JavaScript初学者建议：不要去管浏览器兼容](http://www.ituring.com.cn/article/67234)\n- ...\n\n#### 有浏览器的地方就有Fundebug\n\n[Fundebug](https://fundebug.com)是前端JavaScript错误实时监测平台，经过大量兼容性调试，Fundebug的JavaScript监测插件已经能够在各种主流浏览器中自动捕获错误，并且可以获取最全面的错误信息，帮助开发者更快的Debug。而对于近来不怎么受待见的IE浏览器，我们也进行了全面支持，**从IE 6到IE 11**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser.jpg\" />\n</div>\n\n#### 为什么要兼容各种浏览器？\n\n根据[百度统计](http://tongji.baidu.com/data/browser)的最新数据，2016年10月份到12月份国内的浏览器份额如图所示:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser-share.png\" />\n</div>\n\n可知，用户偏好千差万别，而各版本的IE的市场份额总计为26%，仅次于Chrome。**我还有什么话可说呢？**国内主流浏览器都采用双内核机制，即兼容模式和极速模式，而所谓兼容模式，使用的是triend内核，即IE内核。\n\n作为一个自带价值观的产品，Fundebug希望**通过兼容各种浏览器帮助开发者提升用户体验**。\n\n\n#### 兼容浏览器坑在哪里？\n\n- [Error对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)的属性各有不同，例如大名鼎鼎的Chrome的Error对象木有fileName，lineNumber以及columnNumber属性;\n- [Onerror事件](https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror)的参数各有不同，例如老版本的Firefox木有columnNumber 和error参数\n- API不同，例如老版本的IE木有[JSON对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON);\n- 同一个属性名在不同浏览器的含义不同；\n- 同一个属性在不同浏览器的名称不同；\n- 国内浏览器的IE兼容模式与真正的IE也略有不同;\n- ......\n\n这些问题大概前端工程师都会深有同感吧。\n\n#### 错误智能聚合\n\n同样的代码产生的同一个错误，在不同浏览器上的报错信息是各不相同的。name不同的错误可能是同一个错误，例如**SyntaxError**与**ReferenceError**；message不同的错误可能是同一个错误，例如**can not find variable fundebug**与**fundebug is not defined**。并且，同一个错误在不同浏览器下的lineNumber，columnNumber，stack，与url都有可能不同。\n\n对于这个问题，我们对收集的错误利用机器学习算法进行了智能聚合，尽量将同一个错误聚合到一起，减少重复报警。根据我们的初步估算，目前聚合算法能够将**90%**的重复错误成功聚合，这样极大地提高了用户分析错误的效率。\n\n还等什么呢？感觉免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","source":"_posts/2017/01/16/fundebug-support-all-browsers.md","raw":"---\ntitle: 有浏览器的地方就有Fundebug\n\ndate: 2017-01-16 09:00:00\n\ntags: [Fundebug, JavaScript]\n---\n\n[Fundebug](https://fundebug.com)已经全面支持主流浏览器啦！\n\n对于前端开发者，兼容各种浏览器是一件非常痛苦的事情。在搜索框中输入关键字**JavaScript浏览器兼容**，结果是这样的:\n\n<!-- more -->\n\n- [IE和Firefox的Javascript兼容性总结](http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html)\n- [JavaScript中浏览器兼容问题](http://www.cnblogs.com/DF-fzh/p/5408241.html)\n- [JavaScript初学者建议：不要去管浏览器兼容](http://www.ituring.com.cn/article/67234)\n- ...\n\n#### 有浏览器的地方就有Fundebug\n\n[Fundebug](https://fundebug.com)是前端JavaScript错误实时监测平台，经过大量兼容性调试，Fundebug的JavaScript监测插件已经能够在各种主流浏览器中自动捕获错误，并且可以获取最全面的错误信息，帮助开发者更快的Debug。而对于近来不怎么受待见的IE浏览器，我们也进行了全面支持，**从IE 6到IE 11**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser.jpg\" />\n</div>\n\n#### 为什么要兼容各种浏览器？\n\n根据[百度统计](http://tongji.baidu.com/data/browser)的最新数据，2016年10月份到12月份国内的浏览器份额如图所示:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-all-browsers/browser-share.png\" />\n</div>\n\n可知，用户偏好千差万别，而各版本的IE的市场份额总计为26%，仅次于Chrome。**我还有什么话可说呢？**国内主流浏览器都采用双内核机制，即兼容模式和极速模式，而所谓兼容模式，使用的是triend内核，即IE内核。\n\n作为一个自带价值观的产品，Fundebug希望**通过兼容各种浏览器帮助开发者提升用户体验**。\n\n\n#### 兼容浏览器坑在哪里？\n\n- [Error对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)的属性各有不同，例如大名鼎鼎的Chrome的Error对象木有fileName，lineNumber以及columnNumber属性;\n- [Onerror事件](https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror)的参数各有不同，例如老版本的Firefox木有columnNumber 和error参数\n- API不同，例如老版本的IE木有[JSON对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON);\n- 同一个属性名在不同浏览器的含义不同；\n- 同一个属性在不同浏览器的名称不同；\n- 国内浏览器的IE兼容模式与真正的IE也略有不同;\n- ......\n\n这些问题大概前端工程师都会深有同感吧。\n\n#### 错误智能聚合\n\n同样的代码产生的同一个错误，在不同浏览器上的报错信息是各不相同的。name不同的错误可能是同一个错误，例如**SyntaxError**与**ReferenceError**；message不同的错误可能是同一个错误，例如**can not find variable fundebug**与**fundebug is not defined**。并且，同一个错误在不同浏览器下的lineNumber，columnNumber，stack，与url都有可能不同。\n\n对于这个问题，我们对收集的错误利用机器学习算法进行了智能聚合，尽量将同一个错误聚合到一起，减少重复报警。根据我们的初步估算，目前聚合算法能够将**90%**的重复错误成功聚合，这样极大地提高了用户分析错误的效率。\n\n还等什么呢？感觉免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","slug":"2017/01/16/fundebug-support-all-browsers","published":1,"updated":"2017-02-13T00:45:41.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywemy000xmkfyrkybvlyf","content":"<p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5DF2;&#x7ECF;&#x5168;&#x9762;&#x652F;&#x6301;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x5566;&#xFF01;</p>\n<p>&#x5BF9;&#x4E8E;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x75DB;&#x82E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5728;&#x641C;&#x7D22;&#x6846;&#x4E2D;&#x8F93;&#x5165;&#x5173;&#x952E;&#x5B57;<strong>JavaScript&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</strong>&#xFF0C;&#x7ED3;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<a id=\"more\"></a>\n<ul>\n<li><a href=\"http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html\" target=\"_blank\" rel=\"external\">IE&#x548C;Firefox&#x7684;Javascript&#x517C;&#x5BB9;&#x6027;&#x603B;&#x7ED3;</a></li>\n<li><a href=\"http://www.cnblogs.com/DF-fzh/p/5408241.html\" target=\"_blank\" rel=\"external\">JavaScript&#x4E2D;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;&#x95EE;&#x9898;</a></li>\n<li><a href=\"http://www.ituring.com.cn/article/67234\" target=\"_blank\" rel=\"external\">JavaScript&#x521D;&#x5B66;&#x8005;&#x5EFA;&#x8BAE;&#xFF1A;&#x4E0D;&#x8981;&#x53BB;&#x7BA1;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</a></li>\n<li>&#x2026;</li>\n</ul>\n<h4 id=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"><a href=\"#&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\" class=\"headerlink\" title=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"></a>&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug</h4><p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x662F;&#x524D;&#x7AEF;JavaScript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;&#x7ECF;&#x8FC7;&#x5927;&#x91CF;&#x517C;&#x5BB9;&#x6027;&#x8C03;&#x8BD5;&#xFF0C;Fundebug&#x7684;JavaScript&#x76D1;&#x6D4B;&#x63D2;&#x4EF6;&#x5DF2;&#x7ECF;&#x80FD;&#x591F;&#x5728;&#x5404;&#x79CD;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x5168;&#x9762;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;Debug&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x8FD1;&#x6765;&#x4E0D;&#x600E;&#x4E48;&#x53D7;&#x5F85;&#x89C1;&#x7684;IE&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;&#x5168;&#x9762;&#x652F;&#x6301;&#xFF0C;<strong>&#x4ECE;IE 6&#x5230;IE 11</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser.jpg\"><br></div>\n\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;</h4><p>&#x6839;&#x636E;<a href=\"http://tongji.baidu.com/data/browser\" target=\"_blank\" rel=\"external\">&#x767E;&#x5EA6;&#x7EDF;&#x8BA1;</a>&#x7684;&#x6700;&#x65B0;&#x6570;&#x636E;&#xFF0C;2016&#x5E74;10&#x6708;&#x4EFD;&#x5230;12&#x6708;&#x4EFD;&#x56FD;&#x5185;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4EFD;&#x989D;&#x5982;&#x56FE;&#x6240;&#x793A;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser-share.png\"><br></div>\n\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x7528;&#x6237;&#x504F;&#x597D;&#x5343;&#x5DEE;&#x4E07;&#x522B;&#xFF0C;&#x800C;&#x5404;&#x7248;&#x672C;&#x7684;IE&#x7684;&#x5E02;&#x573A;&#x4EFD;&#x989D;&#x603B;&#x8BA1;&#x4E3A;26%&#xFF0C;&#x4EC5;&#x6B21;&#x4E8E;Chrome&#x3002;<strong>&#x6211;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x8BDD;&#x53EF;&#x8BF4;&#x5462;&#xFF1F;</strong>&#x56FD;&#x5185;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x91C7;&#x7528;&#x53CC;&#x5185;&#x6838;&#x673A;&#x5236;&#xFF0C;&#x5373;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x548C;&#x6781;&#x901F;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x6240;&#x8C13;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;triend&#x5185;&#x6838;&#xFF0C;&#x5373;IE&#x5185;&#x6838;&#x3002;</p>\n<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x81EA;&#x5E26;&#x4EF7;&#x503C;&#x89C2;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;Fundebug&#x5E0C;&#x671B;<strong>&#x901A;&#x8FC7;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;</strong>&#x3002;</p>\n<h4 id=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"><a href=\"#&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\" class=\"headerlink\" title=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"></a>&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;</h4><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error\" target=\"_blank\" rel=\"external\">Error&#x5BF9;&#x8C61;</a>&#x7684;&#x5C5E;&#x6027;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684;Chrome&#x7684;Error&#x5BF9;&#x8C61;&#x6728;&#x6709;fileName&#xFF0C;lineNumber&#x4EE5;&#x53CA;columnNumber&#x5C5E;&#x6027;;</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror\" target=\"_blank\" rel=\"external\">Onerror&#x4E8B;&#x4EF6;</a>&#x7684;&#x53C2;&#x6570;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;Firefox&#x6728;&#x6709;columnNumber &#x548C;error&#x53C2;&#x6570;</li>\n<li>API&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;IE&#x6728;&#x6709;<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON\" target=\"_blank\" rel=\"external\">JSON&#x5BF9;&#x8C61;</a>;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x540D;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x542B;&#x4E49;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x540D;&#x79F0;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x56FD;&#x5185;&#x6D4F;&#x89C8;&#x5668;&#x7684;IE&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x4E0E;&#x771F;&#x6B63;&#x7684;IE&#x4E5F;&#x7565;&#x6709;&#x4E0D;&#x540C;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5927;&#x6982;&#x524D;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E08;&#x90FD;&#x4F1A;&#x6DF1;&#x6709;&#x540C;&#x611F;&#x5427;&#x3002;</p>\n<h4 id=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"><a href=\"#&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\" class=\"headerlink\" title=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"></a>&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;</h4><p>&#x540C;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x4EA7;&#x751F;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x3002;name&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>SyntaxError</strong>&#x4E0E;<strong>ReferenceError</strong>&#xFF1B;message&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>can not find variable fundebug</strong>&#x4E0E;<strong>fundebug is not defined</strong>&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x7684;lineNumber&#xFF0C;columnNumber&#xFF0C;stack&#xFF0C;&#x4E0E;url&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6536;&#x96C6;&#x7684;&#x9519;&#x8BEF;&#x5229;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x4E86;&#x667A;&#x80FD;&#x805A;&#x5408;&#xFF0C;&#x5C3D;&#x91CF;&#x5C06;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x805A;&#x5408;&#x5230;&#x4E00;&#x8D77;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x62A5;&#x8B66;&#x3002;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x521D;&#x6B65;&#x4F30;&#x7B97;&#xFF0C;&#x76EE;&#x524D;&#x805A;&#x5408;&#x7B97;&#x6CD5;&#x80FD;&#x591F;&#x5C06;<strong>90%</strong>&#x7684;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#x6210;&#x529F;&#x805A;&#x5408;&#xFF0C;&#x8FD9;&#x6837;&#x6781;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x4E86;&#x7528;&#x6237;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x611F;&#x89C9;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n\n","excerpt":"<p><a href=\"https://fundebug.com\">Fundebug</a>&#x5DF2;&#x7ECF;&#x5168;&#x9762;&#x652F;&#x6301;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x5566;&#xFF01;</p>\n<p>&#x5BF9;&#x4E8E;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x75DB;&#x82E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5728;&#x641C;&#x7D22;&#x6846;&#x4E2D;&#x8F93;&#x5165;&#x5173;&#x952E;&#x5B57;<strong>JavaScript&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</strong>&#xFF0C;&#x7ED3;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>","more":"<ul>\n<li><a href=\"http://www.cnblogs.com/wiky/archive/2010/01/09/IE-and-Firefox-Javascript-compatibility.html\">IE&#x548C;Firefox&#x7684;Javascript&#x517C;&#x5BB9;&#x6027;&#x603B;&#x7ED3;</a></li>\n<li><a href=\"http://www.cnblogs.com/DF-fzh/p/5408241.html\">JavaScript&#x4E2D;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;&#x95EE;&#x9898;</a></li>\n<li><a href=\"http://www.ituring.com.cn/article/67234\">JavaScript&#x521D;&#x5B66;&#x8005;&#x5EFA;&#x8BAE;&#xFF1A;&#x4E0D;&#x8981;&#x53BB;&#x7BA1;&#x6D4F;&#x89C8;&#x5668;&#x517C;&#x5BB9;</a></li>\n<li>&#x2026;</li>\n</ul>\n<h4 id=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"><a href=\"#&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\" class=\"headerlink\" title=\"&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug\"></a>&#x6709;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x6709;Fundebug</h4><p><a href=\"https://fundebug.com\">Fundebug</a>&#x662F;&#x524D;&#x7AEF;JavaScript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;&#x7ECF;&#x8FC7;&#x5927;&#x91CF;&#x517C;&#x5BB9;&#x6027;&#x8C03;&#x8BD5;&#xFF0C;Fundebug&#x7684;JavaScript&#x76D1;&#x6D4B;&#x63D2;&#x4EF6;&#x5DF2;&#x7ECF;&#x80FD;&#x591F;&#x5728;&#x5404;&#x79CD;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x5168;&#x9762;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;Debug&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x8FD1;&#x6765;&#x4E0D;&#x600E;&#x4E48;&#x53D7;&#x5F85;&#x89C1;&#x7684;IE&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x8FDB;&#x884C;&#x4E86;&#x5168;&#x9762;&#x652F;&#x6301;&#xFF0C;<strong>&#x4ECE;IE 6&#x5230;IE 11</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser.jpg\"><br></div>\n\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#xFF1F;</h4><p>&#x6839;&#x636E;<a href=\"http://tongji.baidu.com/data/browser\">&#x767E;&#x5EA6;&#x7EDF;&#x8BA1;</a>&#x7684;&#x6700;&#x65B0;&#x6570;&#x636E;&#xFF0C;2016&#x5E74;10&#x6708;&#x4EFD;&#x5230;12&#x6708;&#x4EFD;&#x56FD;&#x5185;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x4EFD;&#x989D;&#x5982;&#x56FE;&#x6240;&#x793A;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/01/16/fundebug-support-all-browsers/browser-share.png\"><br></div>\n\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x7528;&#x6237;&#x504F;&#x597D;&#x5343;&#x5DEE;&#x4E07;&#x522B;&#xFF0C;&#x800C;&#x5404;&#x7248;&#x672C;&#x7684;IE&#x7684;&#x5E02;&#x573A;&#x4EFD;&#x989D;&#x603B;&#x8BA1;&#x4E3A;26%&#xFF0C;&#x4EC5;&#x6B21;&#x4E8E;Chrome&#x3002;<strong>&#x6211;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x8BDD;&#x53EF;&#x8BF4;&#x5462;&#xFF1F;</strong>&#x56FD;&#x5185;&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x91C7;&#x7528;&#x53CC;&#x5185;&#x6838;&#x673A;&#x5236;&#xFF0C;&#x5373;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x548C;&#x6781;&#x901F;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x6240;&#x8C13;&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;triend&#x5185;&#x6838;&#xFF0C;&#x5373;IE&#x5185;&#x6838;&#x3002;</p>\n<p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x81EA;&#x5E26;&#x4EF7;&#x503C;&#x89C2;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;Fundebug&#x5E0C;&#x671B;<strong>&#x901A;&#x8FC7;&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;</strong>&#x3002;</p>\n<h4 id=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"><a href=\"#&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\" class=\"headerlink\" title=\"&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;\"></a>&#x517C;&#x5BB9;&#x6D4F;&#x89C8;&#x5668;&#x5751;&#x5728;&#x54EA;&#x91CC;&#xFF1F;</h4><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error\">Error&#x5BF9;&#x8C61;</a>&#x7684;&#x5C5E;&#x6027;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684;Chrome&#x7684;Error&#x5BF9;&#x8C61;&#x6728;&#x6709;fileName&#xFF0C;lineNumber&#x4EE5;&#x53CA;columnNumber&#x5C5E;&#x6027;;</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror\">Onerror&#x4E8B;&#x4EF6;</a>&#x7684;&#x53C2;&#x6570;&#x5404;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;Firefox&#x6728;&#x6709;columnNumber &#x548C;error&#x53C2;&#x6570;</li>\n<li>API&#x4E0D;&#x540C;&#xFF0C;&#x4F8B;&#x5982;&#x8001;&#x7248;&#x672C;&#x7684;IE&#x6728;&#x6709;<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON\">JSON&#x5BF9;&#x8C61;</a>;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x540D;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x542B;&#x4E49;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x540C;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x540D;&#x79F0;&#x4E0D;&#x540C;&#xFF1B;</li>\n<li>&#x56FD;&#x5185;&#x6D4F;&#x89C8;&#x5668;&#x7684;IE&#x517C;&#x5BB9;&#x6A21;&#x5F0F;&#x4E0E;&#x771F;&#x6B63;&#x7684;IE&#x4E5F;&#x7565;&#x6709;&#x4E0D;&#x540C;;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5927;&#x6982;&#x524D;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E08;&#x90FD;&#x4F1A;&#x6DF1;&#x6709;&#x540C;&#x611F;&#x5427;&#x3002;</p>\n<h4 id=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"><a href=\"#&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\" class=\"headerlink\" title=\"&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;\"></a>&#x9519;&#x8BEF;&#x667A;&#x80FD;&#x805A;&#x5408;</h4><p>&#x540C;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x4EA7;&#x751F;&#x7684;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x3002;name&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>SyntaxError</strong>&#x4E0E;<strong>ReferenceError</strong>&#xFF1B;message&#x4E0D;&#x540C;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x4F8B;&#x5982;<strong>can not find variable fundebug</strong>&#x4E0E;<strong>fundebug is not defined</strong>&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x7684;lineNumber&#xFF0C;columnNumber&#xFF0C;stack&#xFF0C;&#x4E0E;url&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x540C;&#x3002;</p>\n<p>&#x5BF9;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6536;&#x96C6;&#x7684;&#x9519;&#x8BEF;&#x5229;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x4E86;&#x667A;&#x80FD;&#x805A;&#x5408;&#xFF0C;&#x5C3D;&#x91CF;&#x5C06;&#x540C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x805A;&#x5408;&#x5230;&#x4E00;&#x8D77;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x590D;&#x62A5;&#x8B66;&#x3002;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x521D;&#x6B65;&#x4F30;&#x7B97;&#xFF0C;&#x76EE;&#x524D;&#x805A;&#x5408;&#x7B97;&#x6CD5;&#x80FD;&#x591F;&#x5C06;<strong>90%</strong>&#x7684;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#x6210;&#x529F;&#x805A;&#x5408;&#xFF0C;&#x8FD9;&#x6837;&#x6781;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x4E86;&#x7528;&#x6237;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;&#x6548;&#x7387;&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x611F;&#x89C9;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"Fundebug抓到了这个Bug","date":"2016-12-06T16:00:00.000Z","_content":"\n[Fundebug](https://fundebug.com)网站使用了我们自己的[JavaScript](https://docs.fundebug.com/notifier/javascript/)错误检测插件，这样代码一旦发生错误，程序员小明就会及时收到报警邮件。\n\n<!-- more -->\n\n我们的前端代码做过严格的单元测试和端到端测试，讲(xiang)道(dang)理(ran)不会出什么错误。\n\n然而，现实是残酷的，总会有各种Bug出现：\n\n- ``this.$parent.elctrl is undefined``, \n- `Attempted to redefine property 'authenticate'.`, \n- `Cannot read property 'language' of null`\n- ...\n\n乍一看这些错误也没什么，然而事实证明它们其实是一个个大写的Bug。得益于[Fundebug](https://fundebug.com)实时监测，小明及时修复了这些问题。(此处应有掌声^*^)\n\n今天呢，我们来聊聊其中一个Bug。这个Bug是由于拼写失误造成的，它会导致网页无法正常显示，虽说刷新一下就好了，但是却会影响用户体验。然而，小明最初却忽略了Fundebug的报警。\n\n> 每一次报错都是一个潜在的Bug，不容忽视。\n\n### Bug回放\n\n11月15日早上8:56，小明收到一封报警邮件：\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"fundebug-catch-the-bug/email.png\" />\n</div>\n\nFundebug网站是基于`AngularJS`实现，这个错误与页面之间的跳转有关。由邮件可知，从`landing`状态跳转到`teamSign`状态时发生了错误。点击**查看详情**, 就能看到该错误的详细信息:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-detail.png\" />\n</div>\n\n在错误面板中，小明可以查看错误栈，请求，设备和用户信息。这些信息可以帮助小明快速定位错误。\n\n经过简单分析，小明断(xia)定(cai)网站的`landing`页面木有问题，这个错误应该是网络问题导致加载不完全而无法识别`teamSign`这个状态。如果网络好一点，加载成功了，就没问题了。然后他就将这个错误丢到一边去了。。。(Boss决定让小明跪键盘)\n\n但是，问题不是这么简单，这个错误之后一共出现了85次，累计影响了24个用户。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-count.png\" />\n</div>\n\n小明意识到问题的严重性之后，查找了`teamSign`跳转相关的代码。他发现，在登录验证的中间件里面，如果用户登录token因为超时失效，那么就会跳转到`teamSign`页面要求用户重新登录。然而，跳转到`teamSign`为什么会失败呢？为什么呢？为什么呢？原来是小明把\"teamSignin\"写成了\"teamSign\"。(Boss决定让小明滚出去)\n\n### 结论\n\n一个小小的拼写失误，却会对用户造成不小的困扰。而事实上，测试无法保证产品100%没有问题。使用[Fundebug](https://fundebug.com)进行实时错误监测，则可以第一时间发现并解决问题。\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","source":"_posts/2016/12/07/fundebug-catch-the-bug.md","raw":"---\ntitle: Fundebug抓到了这个Bug\n\ndate: 2016-12-07 00:00:00\n\ntags: [Fundebug]\n\n---\n\n[Fundebug](https://fundebug.com)网站使用了我们自己的[JavaScript](https://docs.fundebug.com/notifier/javascript/)错误检测插件，这样代码一旦发生错误，程序员小明就会及时收到报警邮件。\n\n<!-- more -->\n\n我们的前端代码做过严格的单元测试和端到端测试，讲(xiang)道(dang)理(ran)不会出什么错误。\n\n然而，现实是残酷的，总会有各种Bug出现：\n\n- ``this.$parent.elctrl is undefined``, \n- `Attempted to redefine property 'authenticate'.`, \n- `Cannot read property 'language' of null`\n- ...\n\n乍一看这些错误也没什么，然而事实证明它们其实是一个个大写的Bug。得益于[Fundebug](https://fundebug.com)实时监测，小明及时修复了这些问题。(此处应有掌声^*^)\n\n今天呢，我们来聊聊其中一个Bug。这个Bug是由于拼写失误造成的，它会导致网页无法正常显示，虽说刷新一下就好了，但是却会影响用户体验。然而，小明最初却忽略了Fundebug的报警。\n\n> 每一次报错都是一个潜在的Bug，不容忽视。\n\n### Bug回放\n\n11月15日早上8:56，小明收到一封报警邮件：\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"fundebug-catch-the-bug/email.png\" />\n</div>\n\nFundebug网站是基于`AngularJS`实现，这个错误与页面之间的跳转有关。由邮件可知，从`landing`状态跳转到`teamSign`状态时发生了错误。点击**查看详情**, 就能看到该错误的详细信息:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-detail.png\" />\n</div>\n\n在错误面板中，小明可以查看错误栈，请求，设备和用户信息。这些信息可以帮助小明快速定位错误。\n\n经过简单分析，小明断(xia)定(cai)网站的`landing`页面木有问题，这个错误应该是网络问题导致加载不完全而无法识别`teamSign`这个状态。如果网络好一点，加载成功了，就没问题了。然后他就将这个错误丢到一边去了。。。(Boss决定让小明跪键盘)\n\n但是，问题不是这么简单，这个错误之后一共出现了85次，累计影响了24个用户。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-catch-the-bug/error-count.png\" />\n</div>\n\n小明意识到问题的严重性之后，查找了`teamSign`跳转相关的代码。他发现，在登录验证的中间件里面，如果用户登录token因为超时失效，那么就会跳转到`teamSign`页面要求用户重新登录。然而，跳转到`teamSign`为什么会失败呢？为什么呢？为什么呢？原来是小明把\"teamSignin\"写成了\"teamSign\"。(Boss决定让小明滚出去)\n\n### 结论\n\n一个小小的拼写失误，却会对用户造成不小的困扰。而事实上，测试无法保证产品100%没有问题。使用[Fundebug](https://fundebug.com)进行实时错误监测，则可以第一时间发现并解决问题。\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n\n","slug":"2016/12/07/fundebug-catch-the-bug","published":1,"updated":"2016-12-07T14:35:42.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywen0000zmkfyo612xlab","content":"<p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7F51;&#x7AD9;&#x4F7F;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\" target=\"_blank\" rel=\"external\">JavaScript</a>&#x9519;&#x8BEF;&#x68C0;&#x6D4B;&#x63D2;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x4E00;&#x65E6;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x5C0F;&#x660E;&#x5C31;&#x4F1A;&#x53CA;&#x65F6;&#x6536;&#x5230;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x6211;&#x4EEC;&#x7684;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x505A;&#x8FC7;&#x4E25;&#x683C;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x548C;&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;&#xFF0C;&#x8BB2;(xiang)&#x9053;(dang)&#x7406;(ran)&#x4E0D;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x73B0;&#x5B9E;&#x662F;&#x6B8B;&#x9177;&#x7684;&#xFF0C;&#x603B;&#x4F1A;&#x6709;&#x5404;&#x79CD;Bug&#x51FA;&#x73B0;&#xFF1A;</p>\n<ul>\n<li><code>this.$parent.elctrl is undefined</code>, </li>\n<li><code>Attempted to redefine property &apos;authenticate&apos;.</code>, </li>\n<li><code>Cannot read property &apos;language&apos; of null</code></li>\n<li>&#x2026;</li>\n</ul>\n<p>&#x4E4D;&#x4E00;&#x770B;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x4E5F;&#x6CA1;&#x4EC0;&#x4E48;&#xFF0C;&#x7136;&#x800C;&#x4E8B;&#x5B9E;&#x8BC1;&#x660E;&#x5B83;&#x4EEC;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5927;&#x5199;&#x7684;Bug&#x3002;&#x5F97;&#x76CA;&#x4E8E;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#xFF0C;&#x5C0F;&#x660E;&#x53CA;&#x65F6;&#x4FEE;&#x590D;&#x4E86;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;(&#x6B64;&#x5904;&#x5E94;&#x6709;&#x638C;&#x58F0;^*^)</p>\n<p>&#x4ECA;&#x5929;&#x5462;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;Bug&#x3002;&#x8FD9;&#x4E2A;Bug&#x662F;&#x7531;&#x4E8E;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#x9020;&#x6210;&#x7684;&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x7F51;&#x9875;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A;&#xFF0C;&#x867D;&#x8BF4;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5C0F;&#x660E;&#x6700;&#x521D;&#x5374;&#x5FFD;&#x7565;&#x4E86;Fundebug&#x7684;&#x62A5;&#x8B66;&#x3002;</p>\n<blockquote>\n<p>&#x6BCF;&#x4E00;&#x6B21;&#x62A5;&#x9519;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x6F5C;&#x5728;&#x7684;Bug&#xFF0C;&#x4E0D;&#x5BB9;&#x5FFD;&#x89C6;&#x3002;</p>\n</blockquote>\n<h3 id=\"Bug&#x56DE;&#x653E;\"><a href=\"#Bug&#x56DE;&#x653E;\" class=\"headerlink\" title=\"Bug&#x56DE;&#x653E;\"></a>Bug&#x56DE;&#x653E;</h3><p>11&#x6708;15&#x65E5;&#x65E9;&#x4E0A;8:56&#xFF0C;&#x5C0F;&#x660E;&#x6536;&#x5230;&#x4E00;&#x5C01;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2016/12/07/fundebug-catch-the-bug/email.png\"><br></div>\n\n<p>Fundebug&#x7F51;&#x7AD9;&#x662F;&#x57FA;&#x4E8E;<code>AngularJS</code>&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E0E;&#x9875;&#x9762;&#x4E4B;&#x95F4;&#x7684;&#x8DF3;&#x8F6C;&#x6709;&#x5173;&#x3002;&#x7531;&#x90AE;&#x4EF6;&#x53EF;&#x77E5;&#xFF0C;&#x4ECE;<code>landing</code>&#x72B6;&#x6001;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x72B6;&#x6001;&#x65F6;&#x53D1;&#x751F;&#x4E86;&#x9519;&#x8BEF;&#x3002;&#x70B9;&#x51FB;<strong>&#x67E5;&#x770B;&#x8BE6;&#x60C5;</strong>, &#x5C31;&#x80FD;&#x770B;&#x5230;&#x8BE5;&#x9519;&#x8BEF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-detail.png\"><br></div>\n\n<p>&#x5728;&#x9519;&#x8BEF;&#x9762;&#x677F;&#x4E2D;&#xFF0C;&#x5C0F;&#x660E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x9519;&#x8BEF;&#x6808;&#xFF0C;&#x8BF7;&#x6C42;&#xFF0C;&#x8BBE;&#x5907;&#x548C;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5C0F;&#x660E;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x7B80;&#x5355;&#x5206;&#x6790;&#xFF0C;&#x5C0F;&#x660E;&#x65AD;(xia)&#x5B9A;(cai)&#x7F51;&#x7AD9;&#x7684;<code>landing</code>&#x9875;&#x9762;&#x6728;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5E94;&#x8BE5;&#x662F;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#x52A0;&#x8F7D;&#x4E0D;&#x5B8C;&#x5168;&#x800C;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;<code>teamSign</code>&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x7F51;&#x7EDC;&#x597D;&#x4E00;&#x70B9;&#xFF0C;&#x52A0;&#x8F7D;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x5C31;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x7136;&#x540E;&#x4ED6;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E22;&#x5230;&#x4E00;&#x8FB9;&#x53BB;&#x4E86;&#x3002;&#x3002;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x8DEA;&#x952E;&#x76D8;)</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x95EE;&#x9898;&#x4E0D;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E4B;&#x540E;&#x4E00;&#x5171;&#x51FA;&#x73B0;&#x4E86;85&#x6B21;&#xFF0C;&#x7D2F;&#x8BA1;&#x5F71;&#x54CD;&#x4E86;24&#x4E2A;&#x7528;&#x6237;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-count.png\"><br></div>\n\n<p>&#x5C0F;&#x660E;&#x610F;&#x8BC6;&#x5230;&#x95EE;&#x9898;&#x7684;&#x4E25;&#x91CD;&#x6027;&#x4E4B;&#x540E;&#xFF0C;&#x67E5;&#x627E;&#x4E86;<code>teamSign</code>&#x8DF3;&#x8F6C;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x4ED6;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x767B;&#x5F55;&#x9A8C;&#x8BC1;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x91CC;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x767B;&#x5F55;token&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x9875;&#x9762;&#x8981;&#x6C42;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5931;&#x8D25;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x539F;&#x6765;&#x662F;&#x5C0F;&#x660E;&#x628A;&#x201D;teamSignin&#x201D;&#x5199;&#x6210;&#x4E86;&#x201D;teamSign&#x201D;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x6EDA;&#x51FA;&#x53BB;)</p>\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#xFF0C;&#x5374;&#x4F1A;&#x5BF9;&#x7528;&#x6237;&#x9020;&#x6210;&#x4E0D;&#x5C0F;&#x7684;&#x56F0;&#x6270;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6D4B;&#x8BD5;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4EA7;&#x54C1;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F7F;&#x7528;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n\n","excerpt":"<p><a href=\"https://fundebug.com\">Fundebug</a>&#x7F51;&#x7AD9;&#x4F7F;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\">JavaScript</a>&#x9519;&#x8BEF;&#x68C0;&#x6D4B;&#x63D2;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x4E00;&#x65E6;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#x5C0F;&#x660E;&#x5C31;&#x4F1A;&#x53CA;&#x65F6;&#x6536;&#x5230;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#x3002;</p>","more":"<p>&#x6211;&#x4EEC;&#x7684;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x505A;&#x8FC7;&#x4E25;&#x683C;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x548C;&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;&#xFF0C;&#x8BB2;(xiang)&#x9053;(dang)&#x7406;(ran)&#x4E0D;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;&#x73B0;&#x5B9E;&#x662F;&#x6B8B;&#x9177;&#x7684;&#xFF0C;&#x603B;&#x4F1A;&#x6709;&#x5404;&#x79CD;Bug&#x51FA;&#x73B0;&#xFF1A;</p>\n<ul>\n<li><code>this.$parent.elctrl is undefined</code>, </li>\n<li><code>Attempted to redefine property &apos;authenticate&apos;.</code>, </li>\n<li><code>Cannot read property &apos;language&apos; of null</code></li>\n<li>&#x2026;</li>\n</ul>\n<p>&#x4E4D;&#x4E00;&#x770B;&#x8FD9;&#x4E9B;&#x9519;&#x8BEF;&#x4E5F;&#x6CA1;&#x4EC0;&#x4E48;&#xFF0C;&#x7136;&#x800C;&#x4E8B;&#x5B9E;&#x8BC1;&#x660E;&#x5B83;&#x4EEC;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5927;&#x5199;&#x7684;Bug&#x3002;&#x5F97;&#x76CA;&#x4E8E;<a href=\"https://fundebug.com\">Fundebug</a>&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#xFF0C;&#x5C0F;&#x660E;&#x53CA;&#x65F6;&#x4FEE;&#x590D;&#x4E86;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;(&#x6B64;&#x5904;&#x5E94;&#x6709;&#x638C;&#x58F0;^*^)</p>\n<p>&#x4ECA;&#x5929;&#x5462;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x804A;&#x804A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;Bug&#x3002;&#x8FD9;&#x4E2A;Bug&#x662F;&#x7531;&#x4E8E;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#x9020;&#x6210;&#x7684;&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x7F51;&#x9875;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A;&#xFF0C;&#x867D;&#x8BF4;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5C0F;&#x660E;&#x6700;&#x521D;&#x5374;&#x5FFD;&#x7565;&#x4E86;Fundebug&#x7684;&#x62A5;&#x8B66;&#x3002;</p>\n<blockquote>\n<p>&#x6BCF;&#x4E00;&#x6B21;&#x62A5;&#x9519;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x6F5C;&#x5728;&#x7684;Bug&#xFF0C;&#x4E0D;&#x5BB9;&#x5FFD;&#x89C6;&#x3002;</p>\n</blockquote>\n<h3 id=\"Bug&#x56DE;&#x653E;\"><a href=\"#Bug&#x56DE;&#x653E;\" class=\"headerlink\" title=\"Bug&#x56DE;&#x653E;\"></a>Bug&#x56DE;&#x653E;</h3><p>11&#x6708;15&#x65E5;&#x65E9;&#x4E0A;8:56&#xFF0C;&#x5C0F;&#x660E;&#x6536;&#x5230;&#x4E00;&#x5C01;&#x62A5;&#x8B66;&#x90AE;&#x4EF6;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2016/12/07/fundebug-catch-the-bug/email.png\"><br></div>\n\n<p>Fundebug&#x7F51;&#x7AD9;&#x662F;&#x57FA;&#x4E8E;<code>AngularJS</code>&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E0E;&#x9875;&#x9762;&#x4E4B;&#x95F4;&#x7684;&#x8DF3;&#x8F6C;&#x6709;&#x5173;&#x3002;&#x7531;&#x90AE;&#x4EF6;&#x53EF;&#x77E5;&#xFF0C;&#x4ECE;<code>landing</code>&#x72B6;&#x6001;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x72B6;&#x6001;&#x65F6;&#x53D1;&#x751F;&#x4E86;&#x9519;&#x8BEF;&#x3002;&#x70B9;&#x51FB;<strong>&#x67E5;&#x770B;&#x8BE6;&#x60C5;</strong>, &#x5C31;&#x80FD;&#x770B;&#x5230;&#x8BE5;&#x9519;&#x8BEF;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-detail.png\"><br></div>\n\n<p>&#x5728;&#x9519;&#x8BEF;&#x9762;&#x677F;&#x4E2D;&#xFF0C;&#x5C0F;&#x660E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x9519;&#x8BEF;&#x6808;&#xFF0C;&#x8BF7;&#x6C42;&#xFF0C;&#x8BBE;&#x5907;&#x548C;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5C0F;&#x660E;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x7ECF;&#x8FC7;&#x7B80;&#x5355;&#x5206;&#x6790;&#xFF0C;&#x5C0F;&#x660E;&#x65AD;(xia)&#x5B9A;(cai)&#x7F51;&#x7AD9;&#x7684;<code>landing</code>&#x9875;&#x9762;&#x6728;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5E94;&#x8BE5;&#x662F;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#x52A0;&#x8F7D;&#x4E0D;&#x5B8C;&#x5168;&#x800C;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;<code>teamSign</code>&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x7F51;&#x7EDC;&#x597D;&#x4E00;&#x70B9;&#xFF0C;&#x52A0;&#x8F7D;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x5C31;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x7136;&#x540E;&#x4ED6;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E22;&#x5230;&#x4E00;&#x8FB9;&#x53BB;&#x4E86;&#x3002;&#x3002;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x8DEA;&#x952E;&#x76D8;)</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x95EE;&#x9898;&#x4E0D;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x4E4B;&#x540E;&#x4E00;&#x5171;&#x51FA;&#x73B0;&#x4E86;85&#x6B21;&#xFF0C;&#x7D2F;&#x8BA1;&#x5F71;&#x54CD;&#x4E86;24&#x4E2A;&#x7528;&#x6237;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2016/12/07/fundebug-catch-the-bug/error-count.png\"><br></div>\n\n<p>&#x5C0F;&#x660E;&#x610F;&#x8BC6;&#x5230;&#x95EE;&#x9898;&#x7684;&#x4E25;&#x91CD;&#x6027;&#x4E4B;&#x540E;&#xFF0C;&#x67E5;&#x627E;&#x4E86;<code>teamSign</code>&#x8DF3;&#x8F6C;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x4ED6;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x767B;&#x5F55;&#x9A8C;&#x8BC1;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x91CC;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x7528;&#x6237;&#x767B;&#x5F55;token&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x9875;&#x9762;&#x8981;&#x6C42;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8DF3;&#x8F6C;&#x5230;<code>teamSign</code>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x5931;&#x8D25;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x539F;&#x6765;&#x662F;&#x5C0F;&#x660E;&#x628A;&#x201D;teamSignin&#x201D;&#x5199;&#x6210;&#x4E86;&#x201D;teamSign&#x201D;&#x3002;(Boss&#x51B3;&#x5B9A;&#x8BA9;&#x5C0F;&#x660E;&#x6EDA;&#x51FA;&#x53BB;)</p>\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x62FC;&#x5199;&#x5931;&#x8BEF;&#xFF0C;&#x5374;&#x4F1A;&#x5BF9;&#x7528;&#x6237;&#x9020;&#x6210;&#x4E0D;&#x5C0F;&#x7684;&#x56F0;&#x6270;&#x3002;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6D4B;&#x8BD5;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4EA7;&#x54C1;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F7F;&#x7528;<a href=\"https://fundebug.com\">Fundebug</a>&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"Fundebug专业为小程序踩坑","date":"2017-02-11T01:00:00.000Z","_content":"\n1月9日微信小程序上线，距离现在仅仅一个月，然而开发者们已经遇到了很多坑:\n\n<!-- more -->\n\n- [一名Android开发者的微信小程序填坑之路(1) - CSDN](http://blog.csdn.net/luoyanglizi/article/details/52681245)\n- [微信小程序坑集 - 博客园](http://www.cnblogs.com/dudeyouth/p/6277628.html)\n- [吐槽小程序开发踩过的坑, 以及一些解决方法 - 简书](http://www.jianshu.com/p/6359500b5576)\n- [微信小程序的坑, 你踩了么？- 知乎](https://www.zhihu.com/question/51145570?sort=created)\n- [微信小程序常见问题集合 - 微信小程序联盟](http://www.wxapp-union.com/thread-23-1-1.html)\n- ......\n\n#### 微信小程序兼容性问题\n\n小程序依托于微信，似乎天然拥有跨平台的优势。也就是说，开发者只需要开发一套代码，就可以完美运行在Android与iOS上。但是事实上，                                                                             小程序的兼容性问题往往会导致各种BUG。\n\n例1，在[微信小程序兼容性问题](http://www.jianshu.com/p/90220a55f542)中，博主有提到一个实例:\n> wx.request()返回的状态码statusCode在iOS下是Int，而在Android上却是String。如果判断statusCode的方法不当，可能就踩到坑里了。\n\n例2，在[微信小程序踩坑之wx.uploadFile](http://www.henkuai.com/thread-17813-1-1.html)中，楼主发现旧版本的微信会出错:\n> iOS可以上传文件，Android必须将微信升级到6.5.2版本以上才能上传文件。\n\n例3，在[一个有关二维码扫码的奇怪的问题](http://www.wxapp-union.com/forum.php?mod=viewthread&tid=2122&highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98)中，楼主遇到了一个ES 6的兼容性问题:\n> 开发工具和高版本的iOS支持[startsWith](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)，然而在iOS 8和Android不支持startsWith。\n\n为什么会这样呢？不妨学习一下[官方文档](https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html)吧: \n\n> - 在开发工具上， 小程序的JS代码是运行在nwjs中\n- 在iOS上，小程序的JS代码是运行在JavaScriptCore 中\n- 在Android上，小程序的JS代码是通过X5 JSCore来解析\n \n开发工具，iOS与Andriod的JavaScript脚本执行环境各不相同，所以存在兼容性问题也就不难理解了。开发工具上运行成功的代码，在iOS上未必能够运行成功，而在iOS上运行成功的代码，在Andriod上也可能会出错。\n\n另外，开发工具，iOS与Andriod上的微信本身代码也不一样，因此也会导致一些问题。\n\n#### Fundebug小程序错误监测\n\n更麻烦的是，测试并不能完全保证代码完全正确，一方面逐个测试各种手机是不现实的，另一方面，开发者很难全面考虑各种真实场景。\n\nFundebug能够实时监测小程序，捕获小程序Bug，然后反馈给开发者。这样，开发者可以及时发现并解决问题，提升用户体验。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\" />\n</div>\n\n**Fundebug的优势:**\n\n- 小程序在用户的手机上出错了，第一时间提醒开发者；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 添加两行代码，2分钟搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n\n使用方法请参考[微信小程序文档](https://docs.fundebug.com/notifier/wxjs/)。\n\n\n还等什么呢？赶紧免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n","source":"_posts/2017/02/11/weixin-miniprogram-need-fundebug.md","raw":"---\ntitle: Fundebug专业为小程序踩坑\n\ndate: 2017-02-11 09:00:00\n\ntags: [Fundebug, 小程序]\n---\n\n1月9日微信小程序上线，距离现在仅仅一个月，然而开发者们已经遇到了很多坑:\n\n<!-- more -->\n\n- [一名Android开发者的微信小程序填坑之路(1) - CSDN](http://blog.csdn.net/luoyanglizi/article/details/52681245)\n- [微信小程序坑集 - 博客园](http://www.cnblogs.com/dudeyouth/p/6277628.html)\n- [吐槽小程序开发踩过的坑, 以及一些解决方法 - 简书](http://www.jianshu.com/p/6359500b5576)\n- [微信小程序的坑, 你踩了么？- 知乎](https://www.zhihu.com/question/51145570?sort=created)\n- [微信小程序常见问题集合 - 微信小程序联盟](http://www.wxapp-union.com/thread-23-1-1.html)\n- ......\n\n#### 微信小程序兼容性问题\n\n小程序依托于微信，似乎天然拥有跨平台的优势。也就是说，开发者只需要开发一套代码，就可以完美运行在Android与iOS上。但是事实上，                                                                             小程序的兼容性问题往往会导致各种BUG。\n\n例1，在[微信小程序兼容性问题](http://www.jianshu.com/p/90220a55f542)中，博主有提到一个实例:\n> wx.request()返回的状态码statusCode在iOS下是Int，而在Android上却是String。如果判断statusCode的方法不当，可能就踩到坑里了。\n\n例2，在[微信小程序踩坑之wx.uploadFile](http://www.henkuai.com/thread-17813-1-1.html)中，楼主发现旧版本的微信会出错:\n> iOS可以上传文件，Android必须将微信升级到6.5.2版本以上才能上传文件。\n\n例3，在[一个有关二维码扫码的奇怪的问题](http://www.wxapp-union.com/forum.php?mod=viewthread&tid=2122&highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98)中，楼主遇到了一个ES 6的兼容性问题:\n> 开发工具和高版本的iOS支持[startsWith](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)，然而在iOS 8和Android不支持startsWith。\n\n为什么会这样呢？不妨学习一下[官方文档](https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html)吧: \n\n> - 在开发工具上， 小程序的JS代码是运行在nwjs中\n- 在iOS上，小程序的JS代码是运行在JavaScriptCore 中\n- 在Android上，小程序的JS代码是通过X5 JSCore来解析\n \n开发工具，iOS与Andriod的JavaScript脚本执行环境各不相同，所以存在兼容性问题也就不难理解了。开发工具上运行成功的代码，在iOS上未必能够运行成功，而在iOS上运行成功的代码，在Andriod上也可能会出错。\n\n另外，开发工具，iOS与Andriod上的微信本身代码也不一样，因此也会导致一些问题。\n\n#### Fundebug小程序错误监测\n\n更麻烦的是，测试并不能完全保证代码完全正确，一方面逐个测试各种手机是不现实的，另一方面，开发者很难全面考虑各种真实场景。\n\nFundebug能够实时监测小程序，捕获小程序Bug，然后反馈给开发者。这样，开发者可以及时发现并解决问题，提升用户体验。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\" />\n</div>\n\n**Fundebug的优势:**\n\n- 小程序在用户的手机上出错了，第一时间提醒开发者；\n- 插件仅282字节，即0.28KB，不到1MB的1/3000;\n- 添加两行代码，2分钟搞定;\n- 仅收集出错信息，保护用户隐私，收集systemInfo和userInfo需要开发者进行配置;\n\n\n使用方法请参考[微信小程序文档](https://docs.fundebug.com/notifier/wxjs/)。\n\n\n还等什么呢？赶紧免费注册[Fundebug](https://fundebug.com/team/create)吧！\n\n\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">立即注册 ➔</a></div>\n</div>\n","slug":"2017/02/11/weixin-miniprogram-need-fundebug","published":1,"updated":"2017-02-13T00:43:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywen20012mkfyr9yljqqx","content":"<p>1&#x6708;9&#x65E5;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0A;&#x7EBF;&#xFF0C;&#x8DDD;&#x79BB;&#x73B0;&#x5728;&#x4EC5;&#x4EC5;&#x4E00;&#x4E2A;&#x6708;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x4EEC;&#x5DF2;&#x7ECF;&#x9047;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5751;:</p>\n<a id=\"more\"></a>\n<ul>\n<li><a href=\"http://blog.csdn.net/luoyanglizi/article/details/52681245\" target=\"_blank\" rel=\"external\">&#x4E00;&#x540D;Android&#x5F00;&#x53D1;&#x8005;&#x7684;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x586B;&#x5751;&#x4E4B;&#x8DEF;(1) - CSDN</a></li>\n<li><a href=\"http://www.cnblogs.com/dudeyouth/p/6277628.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5751;&#x96C6; - &#x535A;&#x5BA2;&#x56ED;</a></li>\n<li><a href=\"http://www.jianshu.com/p/6359500b5576\" target=\"_blank\" rel=\"external\">&#x5410;&#x69FD;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8E29;&#x8FC7;&#x7684;&#x5751;, &#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5; - &#x7B80;&#x4E66;</a></li>\n<li><a href=\"https://www.zhihu.com/question/51145570?sort=created\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x5751;, &#x4F60;&#x8E29;&#x4E86;&#x4E48;&#xFF1F;- &#x77E5;&#x4E4E;</a></li>\n<li><a href=\"http://www.wxapp-union.com/thread-23-1-1.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x96C6;&#x5408; - &#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8054;&#x76DF;</a></li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<h4 id=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"><a href=\"#&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"></a>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</h4><p>&#x5C0F;&#x7A0B;&#x5E8F;&#x4F9D;&#x6258;&#x4E8E;&#x5FAE;&#x4FE1;&#xFF0C;&#x4F3C;&#x4E4E;&#x5929;&#x7136;&#x62E5;&#x6709;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x4F18;&#x52BF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EA;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x4E00;&#x5957;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x5728;Android&#x4E0E;iOS&#x4E0A;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;                                                                             &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x5F80;&#x5F80;&#x4F1A;&#x5BFC;&#x81F4;&#x5404;&#x79CD;BUG&#x3002;</p>\n<p>&#x4F8B;1&#xFF0C;&#x5728;<a href=\"http://www.jianshu.com/p/90220a55f542\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x535A;&#x4E3B;&#x6709;&#x63D0;&#x5230;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;:</p>\n<blockquote>\n<p>wx.request()&#x8FD4;&#x56DE;&#x7684;&#x72B6;&#x6001;&#x7801;statusCode&#x5728;iOS&#x4E0B;&#x662F;Int&#xFF0C;&#x800C;&#x5728;Android&#x4E0A;&#x5374;&#x662F;String&#x3002;&#x5982;&#x679C;&#x5224;&#x65AD;statusCode&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x5F53;&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x8E29;&#x5230;&#x5751;&#x91CC;&#x4E86;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;2&#xFF0C;&#x5728;<a href=\"http://www.henkuai.com/thread-17813-1-1.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8E29;&#x5751;&#x4E4B;wx.uploadFile</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x53D1;&#x73B0;&#x65E7;&#x7248;&#x672C;&#x7684;&#x5FAE;&#x4FE1;&#x4F1A;&#x51FA;&#x9519;:</p>\n<blockquote>\n<p>iOS&#x53EF;&#x4EE5;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#xFF0C;Android&#x5FC5;&#x987B;&#x5C06;&#x5FAE;&#x4FE1;&#x5347;&#x7EA7;&#x5230;6.5.2&#x7248;&#x672C;&#x4EE5;&#x4E0A;&#x624D;&#x80FD;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;3&#xFF0C;&#x5728;<a href=\"http://www.wxapp-union.com/forum.php?mod=viewthread&amp;tid=2122&amp;highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98\" target=\"_blank\" rel=\"external\">&#x4E00;&#x4E2A;&#x6709;&#x5173;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x7801;&#x7684;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;ES 6&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;:</p>\n<blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x548C;&#x9AD8;&#x7248;&#x672C;&#x7684;iOS&#x652F;&#x6301;<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith\" target=\"_blank\" rel=\"external\">startsWith</a>&#xFF0C;&#x7136;&#x800C;&#x5728;iOS 8&#x548C;Android&#x4E0D;&#x652F;&#x6301;startsWith&#x3002;</p>\n</blockquote>\n<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;&#xFF1F;&#x4E0D;&#x59A8;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html\" target=\"_blank\" rel=\"external\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x5427;: </p>\n<blockquote>\n<ul>\n<li>&#x5728;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#xFF0C; &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;nwjs&#x4E2D;</li>\n<li>&#x5728;iOS&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;JavaScriptCore &#x4E2D;</li>\n<li>&#x5728;Android&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x901A;&#x8FC7;X5 JSCore&#x6765;&#x89E3;&#x6790;</li>\n</ul>\n</blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x7684;JavaScript&#x811A;&#x672C;&#x6267;&#x884C;&#x73AF;&#x5883;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x5B58;&#x5728;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x4E5F;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;iOS&#x4E0A;&#x672A;&#x5FC5;&#x80FD;&#x591F;&#x8FD0;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x800C;&#x5728;iOS&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;Andriod&#x4E0A;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x4E0A;&#x7684;&#x5FAE;&#x4FE1;&#x672C;&#x8EAB;&#x4EE3;&#x7801;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>\n<h4 id=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"><a href=\"#Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\" class=\"headerlink\" title=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"></a>Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;</h4><p>&#x66F4;&#x9EBB;&#x70E6;&#x7684;&#x662F;&#xFF0C;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x4FDD;&#x8BC1;&#x4EE3;&#x7801;&#x5B8C;&#x5168;&#x6B63;&#x786E;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x9010;&#x4E2A;&#x6D4B;&#x8BD5;&#x5404;&#x79CD;&#x624B;&#x673A;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5F88;&#x96BE;&#x5168;&#x9762;&#x8003;&#x8651;&#x5404;&#x79CD;&#x771F;&#x5B9E;&#x573A;&#x666F;&#x3002;</p>\n<p>Fundebug&#x80FD;&#x591F;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6355;&#x83B7;&#x5C0F;&#x7A0B;&#x5E8F;Bug&#xFF0C;&#x7136;&#x540E;&#x53CD;&#x9988;&#x7ED9;&#x5F00;&#x53D1;&#x8005;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x53CA;&#x65F6;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\"><br></div>\n\n<p><strong>Fundebug&#x7684;&#x4F18;&#x52BF;:</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x6DFB;&#x52A0;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#xFF0C;2&#x5206;&#x949F;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<p>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://docs.fundebug.com/notifier/wxjs/\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x6587;&#x6863;</a>&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x8D76;&#x7D27;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\" target=\"_blank\" rel=\"external\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>\n","excerpt":"<p>1&#x6708;9&#x65E5;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E0A;&#x7EBF;&#xFF0C;&#x8DDD;&#x79BB;&#x73B0;&#x5728;&#x4EC5;&#x4EC5;&#x4E00;&#x4E2A;&#x6708;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x4EEC;&#x5DF2;&#x7ECF;&#x9047;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5751;:</p>","more":"<ul>\n<li><a href=\"http://blog.csdn.net/luoyanglizi/article/details/52681245\">&#x4E00;&#x540D;Android&#x5F00;&#x53D1;&#x8005;&#x7684;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x586B;&#x5751;&#x4E4B;&#x8DEF;(1) - CSDN</a></li>\n<li><a href=\"http://www.cnblogs.com/dudeyouth/p/6277628.html\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5751;&#x96C6; - &#x535A;&#x5BA2;&#x56ED;</a></li>\n<li><a href=\"http://www.jianshu.com/p/6359500b5576\">&#x5410;&#x69FD;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8E29;&#x8FC7;&#x7684;&#x5751;, &#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5; - &#x7B80;&#x4E66;</a></li>\n<li><a href=\"https://www.zhihu.com/question/51145570?sort=created\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x5751;, &#x4F60;&#x8E29;&#x4E86;&#x4E48;&#xFF1F;- &#x77E5;&#x4E4E;</a></li>\n<li><a href=\"http://www.wxapp-union.com/thread-23-1-1.html\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x96C6;&#x5408; - &#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8054;&#x76DF;</a></li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n<h4 id=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"><a href=\"#&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;\"></a>&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</h4><p>&#x5C0F;&#x7A0B;&#x5E8F;&#x4F9D;&#x6258;&#x4E8E;&#x5FAE;&#x4FE1;&#xFF0C;&#x4F3C;&#x4E4E;&#x5929;&#x7136;&#x62E5;&#x6709;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x4F18;&#x52BF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EA;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x4E00;&#x5957;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x5728;Android&#x4E0E;iOS&#x4E0A;&#x3002;&#x4F46;&#x662F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;                                                                             &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x5F80;&#x5F80;&#x4F1A;&#x5BFC;&#x81F4;&#x5404;&#x79CD;BUG&#x3002;</p>\n<p>&#x4F8B;1&#xFF0C;&#x5728;<a href=\"http://www.jianshu.com/p/90220a55f542\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x535A;&#x4E3B;&#x6709;&#x63D0;&#x5230;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;:</p>\n<blockquote>\n<p>wx.request()&#x8FD4;&#x56DE;&#x7684;&#x72B6;&#x6001;&#x7801;statusCode&#x5728;iOS&#x4E0B;&#x662F;Int&#xFF0C;&#x800C;&#x5728;Android&#x4E0A;&#x5374;&#x662F;String&#x3002;&#x5982;&#x679C;&#x5224;&#x65AD;statusCode&#x7684;&#x65B9;&#x6CD5;&#x4E0D;&#x5F53;&#xFF0C;&#x53EF;&#x80FD;&#x5C31;&#x8E29;&#x5230;&#x5751;&#x91CC;&#x4E86;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;2&#xFF0C;&#x5728;<a href=\"http://www.henkuai.com/thread-17813-1-1.html\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x8E29;&#x5751;&#x4E4B;wx.uploadFile</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x53D1;&#x73B0;&#x65E7;&#x7248;&#x672C;&#x7684;&#x5FAE;&#x4FE1;&#x4F1A;&#x51FA;&#x9519;:</p>\n<blockquote>\n<p>iOS&#x53EF;&#x4EE5;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#xFF0C;Android&#x5FC5;&#x987B;&#x5C06;&#x5FAE;&#x4FE1;&#x5347;&#x7EA7;&#x5230;6.5.2&#x7248;&#x672C;&#x4EE5;&#x4E0A;&#x624D;&#x80FD;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x3002;</p>\n</blockquote>\n<p>&#x4F8B;3&#xFF0C;&#x5728;<a href=\"http://www.wxapp-union.com/forum.php?mod=viewthread&amp;tid=2122&amp;highlight=%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3%E4%BA%8C%E7%BB%B4%E7%A0%81%E6%89%AB%E7%A0%81%E7%9A%84%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98\">&#x4E00;&#x4E2A;&#x6709;&#x5173;&#x4E8C;&#x7EF4;&#x7801;&#x626B;&#x7801;&#x7684;&#x5947;&#x602A;&#x7684;&#x95EE;&#x9898;</a>&#x4E2D;&#xFF0C;&#x697C;&#x4E3B;&#x9047;&#x5230;&#x4E86;&#x4E00;&#x4E2A;ES 6&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;:</p>\n<blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x548C;&#x9AD8;&#x7248;&#x672C;&#x7684;iOS&#x652F;&#x6301;<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith\">startsWith</a>&#xFF0C;&#x7136;&#x800C;&#x5728;iOS 8&#x548C;Android&#x4E0D;&#x652F;&#x6301;startsWith&#x3002;</p>\n</blockquote>\n<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;&#xFF1F;&#x4E0D;&#x59A8;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/details.html\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x5427;: </p>\n<blockquote>\n<ul>\n<li>&#x5728;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#xFF0C; &#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;nwjs&#x4E2D;</li>\n<li>&#x5728;iOS&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x8FD0;&#x884C;&#x5728;JavaScriptCore &#x4E2D;</li>\n<li>&#x5728;Android&#x4E0A;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;JS&#x4EE3;&#x7801;&#x662F;&#x901A;&#x8FC7;X5 JSCore&#x6765;&#x89E3;&#x6790;</li>\n</ul>\n</blockquote>\n<p>&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x7684;JavaScript&#x811A;&#x672C;&#x6267;&#x884C;&#x73AF;&#x5883;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x5B58;&#x5728;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#x4E5F;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#x3002;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;iOS&#x4E0A;&#x672A;&#x5FC5;&#x80FD;&#x591F;&#x8FD0;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x800C;&#x5728;iOS&#x4E0A;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;Andriod&#x4E0A;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;iOS&#x4E0E;Andriod&#x4E0A;&#x7684;&#x5FAE;&#x4FE1;&#x672C;&#x8EAB;&#x4EE3;&#x7801;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x3002;</p>\n<h4 id=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"><a href=\"#Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\" class=\"headerlink\" title=\"Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;\"></a>Fundebug&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;</h4><p>&#x66F4;&#x9EBB;&#x70E6;&#x7684;&#x662F;&#xFF0C;&#x6D4B;&#x8BD5;&#x5E76;&#x4E0D;&#x80FD;&#x5B8C;&#x5168;&#x4FDD;&#x8BC1;&#x4EE3;&#x7801;&#x5B8C;&#x5168;&#x6B63;&#x786E;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x9010;&#x4E2A;&#x6D4B;&#x8BD5;&#x5404;&#x79CD;&#x624B;&#x673A;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5F88;&#x96BE;&#x5168;&#x9762;&#x8003;&#x8651;&#x5404;&#x79CD;&#x771F;&#x5B9E;&#x573A;&#x666F;&#x3002;</p>\n<p>Fundebug&#x80FD;&#x591F;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x6355;&#x83B7;&#x5C0F;&#x7A0B;&#x5E8F;Bug&#xFF0C;&#x7136;&#x540E;&#x53CD;&#x9988;&#x7ED9;&#x5F00;&#x53D1;&#x8005;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x53CA;&#x65F6;&#x53D1;&#x73B0;&#x5E76;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg\"><br></div>\n\n<p><strong>Fundebug&#x7684;&#x4F18;&#x52BF;:</strong></p>\n<ul>\n<li>&#x5C0F;&#x7A0B;&#x5E8F;&#x5728;&#x7528;&#x6237;&#x7684;&#x624B;&#x673A;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x63D0;&#x9192;&#x5F00;&#x53D1;&#x8005;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;282&#x5B57;&#x8282;&#xFF0C;&#x5373;0.28KB&#xFF0C;&#x4E0D;&#x5230;1MB&#x7684;1/3000;</li>\n<li>&#x6DFB;&#x52A0;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#xFF0C;2&#x5206;&#x949F;&#x641E;&#x5B9A;;</li>\n<li>&#x4EC5;&#x6536;&#x96C6;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x4FDD;&#x62A4;&#x7528;&#x6237;&#x9690;&#x79C1;&#xFF0C;&#x6536;&#x96C6;systemInfo&#x548C;userInfo&#x9700;&#x8981;&#x5F00;&#x53D1;&#x8005;&#x8FDB;&#x884C;&#x914D;&#x7F6E;;</li>\n</ul>\n<p>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://docs.fundebug.com/notifier/wxjs/\">&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#x6587;&#x6863;</a>&#x3002;</p>\n<p>&#x8FD8;&#x7B49;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x8D76;&#x7D27;&#x514D;&#x8D39;&#x6CE8;&#x518C;<a href=\"https://fundebug.com/team/create\">Fundebug</a>&#x5427;&#xFF01;</p>\n<div style=\"background: #fff; text-align: center; height: 50px; line-height: 50px;\"><a href=\"https://fundebug.com/team/create\" style=\"padding: 10px 20px; background: #22A985; color: #FFF; border-radius: 3px;\">&#x7ACB;&#x5373;&#x6CE8;&#x518C; &#x2794;</a></div><br>"},{"title":"浅析\"WeixinJSBridge is not defined\"","date":"2017-02-18T01:00:00.000Z","_content":"\n\n[Fundebug](https://fundebug.com)并没有使用[微信JS-SDK](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html)，然而却收到了`WeixinJSBridge is not defined`的报错： \n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:60%;\" src=\"weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png\" />\n</div>\n\n我们的用户也收到了类似的错误报警，并且很多开发者都遇到类似的问题:\n\n> - 我的微信项目，没有用到微信JS-SDK，但iphone部分手机点击某些功能无效，后来加了window.onerror监控，发现有Uncaught ReferenceError: WeixinJSBridge is not defined报错;\n> - 从微信进入支付中心直接唤起微信支付时有时会抛出ReferenceError：weixinJSBridge is not defined的异常;\n> - 使用AppCan生成Web/微信App版，调用微信JSAPI支付方式，提示WeixinJSBridge内置对象undefined;\n> - ......\n\n\n由此可见，这是一个非常普遍的问题。但是如果没有在测试阶段没有遇到过，然后又没有做线上错误监控的话，就很难发现这个问题。我们在这里将这个错误进行一些分析，让大家少走弯路。\n\n### 什么是微信JS-SDK?\n\n这里引用[官方文档](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html): \n\n> 微信JS-SDK是微信公众平台面向网页开发者提供的基于微信内的网页开发工具包。通过使用微信JS-SDK，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。\n\n### Q&A\n\n\n#### **我没有使用微信JS-SDK, 为什么会报错呢？**\n\n- 微信内置浏览器会有WeixinJSBridge，但是需要一定的加载时间。\n\n#### **我使用了微信JS-SDK, 为什么会报错呢？**\n\n- 微信webview注入钩子有时序问题：在`WeixinJSBridge`还未注入之前，就已经成功注入其它依赖于`WeixinJSBridge`的其它XX模块。在XX模块中调用`WeixinJSBridge`就会失败。\n\n\n### 如何解决？\n\n如果你开发一款移动应用，必不可少要考虑分享到微信的功能；如果你开发网页，那么用户之间的分享更多的也是通过微信。那么这个问题到底有多严重，如何解决也变得至关重要。\n\n\n - 如果网页中未使用微信JS-SDK, 用户在微信中打开网站可能会触发这个错误，目前看来只有忽略。因为是微信JS-SDK自身的问题，我们也无法控制。\n\n - 关于微信支付\n   + 方法1: 监听ready事件之后再进行下一步操作 \n\n   ```js\n   if (typeof window.WeixinJSBridge == \"undefined\")\n   {\n       $(document).on('WeixinJSBridgeReady', function()\n       {\n           $('#weiXinPay').click();\n       });\n   }\n   else\n   {\n       $('#weiXinPay').click();\n   }\n   ```\n\n   + 方法2: 直接使用JS-SDK文档中的支付代码，不要使用公众号支付文档里面的代码。具体请参考[微信JS-SDK说明文档 - 微信支付](https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html#.E5.8F.91.E8.B5.B7.E4.B8.80.E4.B8.AA.E5.BE.AE.E4.BF.A1.E6.94.AF.E4.BB.98.E8.AF.B7.E6.B1.82)\n\n\nPS: 关于这个问题的帖子从2014年开始就有了，然而问题依然存在，希望微信的同学能够给出官方的解决方案。\n\n ### 参考链接\n\n   - [Uncaught ReferenceError: WeixinJSBridge is not defined](http://www.henkuai.com/forum.php?mod=viewthread&tid=7450)\n   - [Uncaught ReferenceError: WeixinJSBridge is not defined问题](http://www.henkuai.com/thread-8365-1-1.html)   \n   - [微信支付问题：Uncaught ReferenceError: WeixinJSBridge is not defined ](http://www.java-bbs.com/thread-14-1-1.html)\n   - [传说中的WeixinJSBridge和微信rest接口](http://bbs.blueidea.com/thread-3103040-1-1.html)\n   - [监听wxbridge加载后再唤起微信支付](https://github.com/whq731/mobile-problems/blob/master/%E7%9B%91%E5%90%ACwxbridge%E5%8A%A0%E8%BD%BD%E5%90%8E%E5%86%8D%E5%94%A4%E8%B5%B7%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98.md)\n","source":"_posts/2017/02/18/weixinjsbridge-is-not-defined.md","raw":"---\ntitle: 浅析\"WeixinJSBridge is not defined\"\n\ndate: 2017-02-18 09:00:00\n---\n\n\n[Fundebug](https://fundebug.com)并没有使用[微信JS-SDK](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html)，然而却收到了`WeixinJSBridge is not defined`的报错： \n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:60%;\" src=\"weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png\" />\n</div>\n\n我们的用户也收到了类似的错误报警，并且很多开发者都遇到类似的问题:\n\n> - 我的微信项目，没有用到微信JS-SDK，但iphone部分手机点击某些功能无效，后来加了window.onerror监控，发现有Uncaught ReferenceError: WeixinJSBridge is not defined报错;\n> - 从微信进入支付中心直接唤起微信支付时有时会抛出ReferenceError：weixinJSBridge is not defined的异常;\n> - 使用AppCan生成Web/微信App版，调用微信JSAPI支付方式，提示WeixinJSBridge内置对象undefined;\n> - ......\n\n\n由此可见，这是一个非常普遍的问题。但是如果没有在测试阶段没有遇到过，然后又没有做线上错误监控的话，就很难发现这个问题。我们在这里将这个错误进行一些分析，让大家少走弯路。\n\n### 什么是微信JS-SDK?\n\n这里引用[官方文档](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html): \n\n> 微信JS-SDK是微信公众平台面向网页开发者提供的基于微信内的网页开发工具包。通过使用微信JS-SDK，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。\n\n### Q&A\n\n\n#### **我没有使用微信JS-SDK, 为什么会报错呢？**\n\n- 微信内置浏览器会有WeixinJSBridge，但是需要一定的加载时间。\n\n#### **我使用了微信JS-SDK, 为什么会报错呢？**\n\n- 微信webview注入钩子有时序问题：在`WeixinJSBridge`还未注入之前，就已经成功注入其它依赖于`WeixinJSBridge`的其它XX模块。在XX模块中调用`WeixinJSBridge`就会失败。\n\n\n### 如何解决？\n\n如果你开发一款移动应用，必不可少要考虑分享到微信的功能；如果你开发网页，那么用户之间的分享更多的也是通过微信。那么这个问题到底有多严重，如何解决也变得至关重要。\n\n\n - 如果网页中未使用微信JS-SDK, 用户在微信中打开网站可能会触发这个错误，目前看来只有忽略。因为是微信JS-SDK自身的问题，我们也无法控制。\n\n - 关于微信支付\n   + 方法1: 监听ready事件之后再进行下一步操作 \n\n   ```js\n   if (typeof window.WeixinJSBridge == \"undefined\")\n   {\n       $(document).on('WeixinJSBridgeReady', function()\n       {\n           $('#weiXinPay').click();\n       });\n   }\n   else\n   {\n       $('#weiXinPay').click();\n   }\n   ```\n\n   + 方法2: 直接使用JS-SDK文档中的支付代码，不要使用公众号支付文档里面的代码。具体请参考[微信JS-SDK说明文档 - 微信支付](https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html#.E5.8F.91.E8.B5.B7.E4.B8.80.E4.B8.AA.E5.BE.AE.E4.BF.A1.E6.94.AF.E4.BB.98.E8.AF.B7.E6.B1.82)\n\n\nPS: 关于这个问题的帖子从2014年开始就有了，然而问题依然存在，希望微信的同学能够给出官方的解决方案。\n\n ### 参考链接\n\n   - [Uncaught ReferenceError: WeixinJSBridge is not defined](http://www.henkuai.com/forum.php?mod=viewthread&tid=7450)\n   - [Uncaught ReferenceError: WeixinJSBridge is not defined问题](http://www.henkuai.com/thread-8365-1-1.html)   \n   - [微信支付问题：Uncaught ReferenceError: WeixinJSBridge is not defined ](http://www.java-bbs.com/thread-14-1-1.html)\n   - [传说中的WeixinJSBridge和微信rest接口](http://bbs.blueidea.com/thread-3103040-1-1.html)\n   - [监听wxbridge加载后再唤起微信支付](https://github.com/whq731/mobile-problems/blob/master/%E7%9B%91%E5%90%ACwxbridge%E5%8A%A0%E8%BD%BD%E5%90%8E%E5%86%8D%E5%94%A4%E8%B5%B7%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98.md)\n","slug":"2017/02/18/weixinjsbridge-is-not-defined","published":1,"updated":"2017-02-24T11:49:30.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywen30014mkfy87fynfej","content":"<p><a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;<a href=\"http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;JS-SDK</a>&#xFF0C;&#x7136;&#x800C;&#x5374;&#x6536;&#x5230;&#x4E86;<code>WeixinJSBridge is not defined</code>&#x7684;&#x62A5;&#x9519;&#xFF1A; </p>\n<a id=\"more\"></a>\n<div style=\"text-align: left;\"><br><img style=\"width:60%;\" src=\"/2017/02/18/weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png\"><br></div>\n\n<p>&#x6211;&#x4EEC;&#x7684;&#x7528;&#x6237;&#x4E5F;&#x6536;&#x5230;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;&#xFF0C;&#x5E76;&#x4E14;&#x5F88;&#x591A;&#x5F00;&#x53D1;&#x8005;&#x90FD;&#x9047;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x95EE;&#x9898;:</p>\n<blockquote>\n<ul>\n<li>&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x9879;&#x76EE;&#xFF0C;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x5FAE;&#x4FE1;JS-SDK&#xFF0C;&#x4F46;iphone&#x90E8;&#x5206;&#x624B;&#x673A;&#x70B9;&#x51FB;&#x67D0;&#x4E9B;&#x529F;&#x80FD;&#x65E0;&#x6548;&#xFF0C;&#x540E;&#x6765;&#x52A0;&#x4E86;window.onerror&#x76D1;&#x63A7;&#xFF0C;&#x53D1;&#x73B0;&#x6709;Uncaught ReferenceError: WeixinJSBridge is not defined&#x62A5;&#x9519;;</li>\n<li>&#x4ECE;&#x5FAE;&#x4FE1;&#x8FDB;&#x5165;&#x652F;&#x4ED8;&#x4E2D;&#x5FC3;&#x76F4;&#x63A5;&#x5524;&#x8D77;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x65F6;&#x6709;&#x65F6;&#x4F1A;&#x629B;&#x51FA;ReferenceError&#xFF1A;weixinJSBridge is not defined&#x7684;&#x5F02;&#x5E38;;</li>\n<li>&#x4F7F;&#x7528;AppCan&#x751F;&#x6210;Web/&#x5FAE;&#x4FE1;App&#x7248;&#xFF0C;&#x8C03;&#x7528;&#x5FAE;&#x4FE1;JSAPI&#x652F;&#x4ED8;&#x65B9;&#x5F0F;&#xFF0C;&#x63D0;&#x793A;WeixinJSBridge&#x5185;&#x7F6E;&#x5BF9;&#x8C61;undefined;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n</blockquote>\n<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x666E;&#x904D;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5728;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x6CA1;&#x6709;&#x9047;&#x5230;&#x8FC7;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x6CA1;&#x6709;&#x505A;&#x7EBF;&#x4E0A;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x5F88;&#x96BE;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x5206;&#x6790;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x5C11;&#x8D70;&#x5F2F;&#x8DEF;&#x3002;</p>\n<h3 id=\"&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK?\"></a>&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK?</h3><p>&#x8FD9;&#x91CC;&#x5F15;&#x7528;<a href=\"http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\" target=\"_blank\" rel=\"external\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>: </p>\n<blockquote>\n<p>&#x5FAE;&#x4FE1;JS-SDK&#x662F;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x5E73;&#x53F0;&#x9762;&#x5411;&#x7F51;&#x9875;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x7684;&#x57FA;&#x4E8E;&#x5FAE;&#x4FE1;&#x5185;&#x7684;&#x7F51;&#x9875;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x5305;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK&#xFF0C;&#x7F51;&#x9875;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x501F;&#x52A9;&#x5FAE;&#x4FE1;&#x9AD8;&#x6548;&#x5730;&#x4F7F;&#x7528;&#x62CD;&#x7167;&#x3001;&#x9009;&#x56FE;&#x3001;&#x8BED;&#x97F3;&#x3001;&#x4F4D;&#x7F6E;&#x7B49;&#x624B;&#x673A;&#x7CFB;&#x7EDF;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;&#x5206;&#x4EAB;&#x3001;&#x626B;&#x4E00;&#x626B;&#x3001;&#x5361;&#x5238;&#x3001;&#x652F;&#x4ED8;&#x7B49;&#x5FAE;&#x4FE1;&#x7279;&#x6709;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x4E3A;&#x5FAE;&#x4FE1;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x66F4;&#x4F18;&#x8D28;&#x7684;&#x7F51;&#x9875;&#x4F53;&#x9A8C;&#x3002;</p>\n</blockquote>\n<h3 id=\"Q-amp-A\"><a href=\"#Q-amp-A\" class=\"headerlink\" title=\"Q&amp;A\"></a>Q&amp;A</h3><h4 id=\"&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"><a href=\"#&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"></a><strong>&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;</strong></h4><ul>\n<li>&#x5FAE;&#x4FE1;&#x5185;&#x7F6E;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x6709;WeixinJSBridge&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x4E00;&#x5B9A;&#x7684;&#x52A0;&#x8F7D;&#x65F6;&#x95F4;&#x3002;</li>\n</ul>\n<h4 id=\"&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"><a href=\"#&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"></a><strong>&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;</strong></h4><ul>\n<li>&#x5FAE;&#x4FE1;webview&#x6CE8;&#x5165;&#x94A9;&#x5B50;&#x6709;&#x65F6;&#x5E8F;&#x95EE;&#x9898;&#xFF1A;&#x5728;<code>WeixinJSBridge</code>&#x8FD8;&#x672A;&#x6CE8;&#x5165;&#x4E4B;&#x524D;&#xFF0C;&#x5C31;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x6CE8;&#x5165;&#x5176;&#x5B83;&#x4F9D;&#x8D56;&#x4E8E;<code>WeixinJSBridge</code>&#x7684;&#x5176;&#x5B83;XX&#x6A21;&#x5757;&#x3002;&#x5728;XX&#x6A21;&#x5757;&#x4E2D;&#x8C03;&#x7528;<code>WeixinJSBridge</code>&#x5C31;&#x4F1A;&#x5931;&#x8D25;&#x3002;</li>\n</ul>\n<h3 id=\"&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;\"><a href=\"#&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;\"></a>&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;</h3><p>&#x5982;&#x679C;&#x4F60;&#x5F00;&#x53D1;&#x4E00;&#x6B3E;&#x79FB;&#x52A8;&#x5E94;&#x7528;&#xFF0C;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x8981;&#x8003;&#x8651;&#x5206;&#x4EAB;&#x5230;&#x5FAE;&#x4FE1;&#x7684;&#x529F;&#x80FD;&#xFF1B;&#x5982;&#x679C;&#x4F60;&#x5F00;&#x53D1;&#x7F51;&#x9875;&#xFF0C;&#x90A3;&#x4E48;&#x7528;&#x6237;&#x4E4B;&#x95F4;&#x7684;&#x5206;&#x4EAB;&#x66F4;&#x591A;&#x7684;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x5FAE;&#x4FE1;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5230;&#x5E95;&#x6709;&#x591A;&#x4E25;&#x91CD;&#xFF0C;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x4E5F;&#x53D8;&#x5F97;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x3002;</p>\n<ul>\n<li><p>&#x5982;&#x679C;&#x7F51;&#x9875;&#x4E2D;&#x672A;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK, &#x7528;&#x6237;&#x5728;&#x5FAE;&#x4FE1;&#x4E2D;&#x6253;&#x5F00;&#x7F51;&#x7AD9;&#x53EF;&#x80FD;&#x4F1A;&#x89E6;&#x53D1;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x76EE;&#x524D;&#x770B;&#x6765;&#x53EA;&#x6709;&#x5FFD;&#x7565;&#x3002;&#x56E0;&#x4E3A;&#x662F;&#x5FAE;&#x4FE1;JS-SDK&#x81EA;&#x8EAB;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x3002;</p>\n</li>\n<li><p>&#x5173;&#x4E8E;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;</p>\n<ul>\n<li>&#x65B9;&#x6CD5;1: &#x76D1;&#x542C;ready&#x4E8B;&#x4EF6;&#x4E4B;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B65;&#x64CD;&#x4F5C; </li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.WeixinJSBridge == <span class=\"string\">&quot;undefined&quot;</span>)</div><div class=\"line\">{</div><div class=\"line\">    $(<span class=\"built_in\">document</span>).on(<span class=\"string\">&apos;WeixinJSBridgeReady&apos;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        $(<span class=\"string\">&apos;#weiXinPay&apos;</span>).click();</div><div class=\"line\">    });</div><div class=\"line\">}</div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">{</div><div class=\"line\">    $(<span class=\"string\">&apos;#weiXinPay&apos;</span>).click();</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x65B9;&#x6CD5;2: &#x76F4;&#x63A5;&#x4F7F;&#x7528;JS-SDK&#x6587;&#x6863;&#x4E2D;&#x7684;&#x652F;&#x4ED8;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x516C;&#x4F17;&#x53F7;&#x652F;&#x4ED8;&#x6587;&#x6863;&#x91CC;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5177;&#x4F53;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html#.E5.8F.91.E8.B5.B7.E4.B8.80.E4.B8.AA.E5.BE.AE.E4.BF.A1.E6.94.AF.E4.BB.98.E8.AF.B7.E6.B1.82\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;JS-SDK&#x8BF4;&#x660E;&#x6587;&#x6863; - &#x5FAE;&#x4FE1;&#x652F;&#x4ED8;</a></li>\n</ul>\n</li>\n</ul>\n<p>PS: &#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x5E16;&#x5B50;&#x4ECE;2014&#x5E74;&#x5F00;&#x59CB;&#x5C31;&#x6709;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x95EE;&#x9898;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x5E0C;&#x671B;&#x5FAE;&#x4FE1;&#x7684;&#x540C;&#x5B66;&#x80FD;&#x591F;&#x7ED9;&#x51FA;&#x5B98;&#x65B9;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://www.henkuai.com/forum.php?mod=viewthread&amp;tid=7450\" target=\"_blank\" rel=\"external\">Uncaught ReferenceError: WeixinJSBridge is not defined</a></li>\n<li><a href=\"http://www.henkuai.com/thread-8365-1-1.html\" target=\"_blank\" rel=\"external\">Uncaught ReferenceError: WeixinJSBridge is not defined&#x95EE;&#x9898;</a>   </li>\n<li><a href=\"http://www.java-bbs.com/thread-14-1-1.html\" target=\"_blank\" rel=\"external\">&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x95EE;&#x9898;&#xFF1A;Uncaught ReferenceError: WeixinJSBridge is not defined </a></li>\n<li><a href=\"http://bbs.blueidea.com/thread-3103040-1-1.html\" target=\"_blank\" rel=\"external\">&#x4F20;&#x8BF4;&#x4E2D;&#x7684;WeixinJSBridge&#x548C;&#x5FAE;&#x4FE1;rest&#x63A5;&#x53E3;</a></li>\n<li><a href=\"https://github.com/whq731/mobile-problems/blob/master/%E7%9B%91%E5%90%ACwxbridge%E5%8A%A0%E8%BD%BD%E5%90%8E%E5%86%8D%E5%94%A4%E8%B5%B7%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98.md\" target=\"_blank\" rel=\"external\">&#x76D1;&#x542C;wxbridge&#x52A0;&#x8F7D;&#x540E;&#x518D;&#x5524;&#x8D77;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;</a></li>\n</ul>\n","excerpt":"<p><a href=\"https://fundebug.com\">Fundebug</a>&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;<a href=\"http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\">&#x5FAE;&#x4FE1;JS-SDK</a>&#xFF0C;&#x7136;&#x800C;&#x5374;&#x6536;&#x5230;&#x4E86;<code>WeixinJSBridge is not defined</code>&#x7684;&#x62A5;&#x9519;&#xFF1A; </p>","more":"<div style=\"text-align: left;\"><br><img style=\"width:60%;\" src=\"/2017/02/18/weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png\"><br></div>\n\n<p>&#x6211;&#x4EEC;&#x7684;&#x7528;&#x6237;&#x4E5F;&#x6536;&#x5230;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;&#xFF0C;&#x5E76;&#x4E14;&#x5F88;&#x591A;&#x5F00;&#x53D1;&#x8005;&#x90FD;&#x9047;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x95EE;&#x9898;:</p>\n<blockquote>\n<ul>\n<li>&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x9879;&#x76EE;&#xFF0C;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x5FAE;&#x4FE1;JS-SDK&#xFF0C;&#x4F46;iphone&#x90E8;&#x5206;&#x624B;&#x673A;&#x70B9;&#x51FB;&#x67D0;&#x4E9B;&#x529F;&#x80FD;&#x65E0;&#x6548;&#xFF0C;&#x540E;&#x6765;&#x52A0;&#x4E86;window.onerror&#x76D1;&#x63A7;&#xFF0C;&#x53D1;&#x73B0;&#x6709;Uncaught ReferenceError: WeixinJSBridge is not defined&#x62A5;&#x9519;;</li>\n<li>&#x4ECE;&#x5FAE;&#x4FE1;&#x8FDB;&#x5165;&#x652F;&#x4ED8;&#x4E2D;&#x5FC3;&#x76F4;&#x63A5;&#x5524;&#x8D77;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x65F6;&#x6709;&#x65F6;&#x4F1A;&#x629B;&#x51FA;ReferenceError&#xFF1A;weixinJSBridge is not defined&#x7684;&#x5F02;&#x5E38;;</li>\n<li>&#x4F7F;&#x7528;AppCan&#x751F;&#x6210;Web/&#x5FAE;&#x4FE1;App&#x7248;&#xFF0C;&#x8C03;&#x7528;&#x5FAE;&#x4FE1;JSAPI&#x652F;&#x4ED8;&#x65B9;&#x5F0F;&#xFF0C;&#x63D0;&#x793A;WeixinJSBridge&#x5185;&#x7F6E;&#x5BF9;&#x8C61;undefined;</li>\n<li>&#x2026;&#x2026;</li>\n</ul>\n</blockquote>\n<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x666E;&#x904D;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5728;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x6CA1;&#x6709;&#x9047;&#x5230;&#x8FC7;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x6CA1;&#x6709;&#x505A;&#x7EBF;&#x4E0A;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x5F88;&#x96BE;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x5C06;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x5206;&#x6790;&#xFF0C;&#x8BA9;&#x5927;&#x5BB6;&#x5C11;&#x8D70;&#x5F2F;&#x8DEF;&#x3002;</p>\n<h3 id=\"&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK?\"></a>&#x4EC0;&#x4E48;&#x662F;&#x5FAE;&#x4FE1;JS-SDK?</h3><p>&#x8FD9;&#x91CC;&#x5F15;&#x7528;<a href=\"http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>: </p>\n<blockquote>\n<p>&#x5FAE;&#x4FE1;JS-SDK&#x662F;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x5E73;&#x53F0;&#x9762;&#x5411;&#x7F51;&#x9875;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x7684;&#x57FA;&#x4E8E;&#x5FAE;&#x4FE1;&#x5185;&#x7684;&#x7F51;&#x9875;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x5305;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK&#xFF0C;&#x7F51;&#x9875;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x501F;&#x52A9;&#x5FAE;&#x4FE1;&#x9AD8;&#x6548;&#x5730;&#x4F7F;&#x7528;&#x62CD;&#x7167;&#x3001;&#x9009;&#x56FE;&#x3001;&#x8BED;&#x97F3;&#x3001;&#x4F4D;&#x7F6E;&#x7B49;&#x624B;&#x673A;&#x7CFB;&#x7EDF;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;&#x5206;&#x4EAB;&#x3001;&#x626B;&#x4E00;&#x626B;&#x3001;&#x5361;&#x5238;&#x3001;&#x652F;&#x4ED8;&#x7B49;&#x5FAE;&#x4FE1;&#x7279;&#x6709;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x4E3A;&#x5FAE;&#x4FE1;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x66F4;&#x4F18;&#x8D28;&#x7684;&#x7F51;&#x9875;&#x4F53;&#x9A8C;&#x3002;</p>\n</blockquote>\n<h3 id=\"Q-amp-A\"><a href=\"#Q-amp-A\" class=\"headerlink\" title=\"Q&amp;A\"></a>Q&amp;A</h3><h4 id=\"&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"><a href=\"#&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"></a><strong>&#x6211;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;</strong></h4><ul>\n<li>&#x5FAE;&#x4FE1;&#x5185;&#x7F6E;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x6709;WeixinJSBridge&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x4E00;&#x5B9A;&#x7684;&#x52A0;&#x8F7D;&#x65F6;&#x95F4;&#x3002;</li>\n</ul>\n<h4 id=\"&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"><a href=\"#&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK-&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;\"></a><strong>&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x5FAE;&#x4FE1;JS-SDK, &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x62A5;&#x9519;&#x5462;&#xFF1F;</strong></h4><ul>\n<li>&#x5FAE;&#x4FE1;webview&#x6CE8;&#x5165;&#x94A9;&#x5B50;&#x6709;&#x65F6;&#x5E8F;&#x95EE;&#x9898;&#xFF1A;&#x5728;<code>WeixinJSBridge</code>&#x8FD8;&#x672A;&#x6CE8;&#x5165;&#x4E4B;&#x524D;&#xFF0C;&#x5C31;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x6CE8;&#x5165;&#x5176;&#x5B83;&#x4F9D;&#x8D56;&#x4E8E;<code>WeixinJSBridge</code>&#x7684;&#x5176;&#x5B83;XX&#x6A21;&#x5757;&#x3002;&#x5728;XX&#x6A21;&#x5757;&#x4E2D;&#x8C03;&#x7528;<code>WeixinJSBridge</code>&#x5C31;&#x4F1A;&#x5931;&#x8D25;&#x3002;</li>\n</ul>\n<h3 id=\"&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;\"><a href=\"#&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;\"></a>&#x5982;&#x4F55;&#x89E3;&#x51B3;&#xFF1F;</h3><p>&#x5982;&#x679C;&#x4F60;&#x5F00;&#x53D1;&#x4E00;&#x6B3E;&#x79FB;&#x52A8;&#x5E94;&#x7528;&#xFF0C;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x8981;&#x8003;&#x8651;&#x5206;&#x4EAB;&#x5230;&#x5FAE;&#x4FE1;&#x7684;&#x529F;&#x80FD;&#xFF1B;&#x5982;&#x679C;&#x4F60;&#x5F00;&#x53D1;&#x7F51;&#x9875;&#xFF0C;&#x90A3;&#x4E48;&#x7528;&#x6237;&#x4E4B;&#x95F4;&#x7684;&#x5206;&#x4EAB;&#x66F4;&#x591A;&#x7684;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x5FAE;&#x4FE1;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5230;&#x5E95;&#x6709;&#x591A;&#x4E25;&#x91CD;&#xFF0C;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x4E5F;&#x53D8;&#x5F97;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x3002;</p>\n<ul>\n<li><p>&#x5982;&#x679C;&#x7F51;&#x9875;&#x4E2D;&#x672A;&#x4F7F;&#x7528;&#x5FAE;&#x4FE1;JS-SDK, &#x7528;&#x6237;&#x5728;&#x5FAE;&#x4FE1;&#x4E2D;&#x6253;&#x5F00;&#x7F51;&#x7AD9;&#x53EF;&#x80FD;&#x4F1A;&#x89E6;&#x53D1;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#xFF0C;&#x76EE;&#x524D;&#x770B;&#x6765;&#x53EA;&#x6709;&#x5FFD;&#x7565;&#x3002;&#x56E0;&#x4E3A;&#x662F;&#x5FAE;&#x4FE1;JS-SDK&#x81EA;&#x8EAB;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x3002;</p>\n</li>\n<li><p>&#x5173;&#x4E8E;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;</p>\n<ul>\n<li>&#x65B9;&#x6CD5;1: &#x76D1;&#x542C;ready&#x4E8B;&#x4EF6;&#x4E4B;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B65;&#x64CD;&#x4F5C; </li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"built_in\">window</span>.WeixinJSBridge == <span class=\"string\">&quot;undefined&quot;</span>)</div><div class=\"line\">{</div><div class=\"line\">    $(<span class=\"built_in\">document</span>).on(<span class=\"string\">&apos;WeixinJSBridgeReady&apos;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        $(<span class=\"string\">&apos;#weiXinPay&apos;</span>).click();</div><div class=\"line\">    });</div><div class=\"line\">}</div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">{</div><div class=\"line\">    $(<span class=\"string\">&apos;#weiXinPay&apos;</span>).click();</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<ul>\n<li>&#x65B9;&#x6CD5;2: &#x76F4;&#x63A5;&#x4F7F;&#x7528;JS-SDK&#x6587;&#x6863;&#x4E2D;&#x7684;&#x652F;&#x4ED8;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x516C;&#x4F17;&#x53F7;&#x652F;&#x4ED8;&#x6587;&#x6863;&#x91CC;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5177;&#x4F53;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html#.E5.8F.91.E8.B5.B7.E4.B8.80.E4.B8.AA.E5.BE.AE.E4.BF.A1.E6.94.AF.E4.BB.98.E8.AF.B7.E6.B1.82\">&#x5FAE;&#x4FE1;JS-SDK&#x8BF4;&#x660E;&#x6587;&#x6863; - &#x5FAE;&#x4FE1;&#x652F;&#x4ED8;</a></li>\n</ul>\n</li>\n</ul>\n<p>PS: &#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x5E16;&#x5B50;&#x4ECE;2014&#x5E74;&#x5F00;&#x59CB;&#x5C31;&#x6709;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x95EE;&#x9898;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x5E0C;&#x671B;&#x5FAE;&#x4FE1;&#x7684;&#x540C;&#x5B66;&#x80FD;&#x591F;&#x7ED9;&#x51FA;&#x5B98;&#x65B9;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://www.henkuai.com/forum.php?mod=viewthread&amp;tid=7450\">Uncaught ReferenceError: WeixinJSBridge is not defined</a></li>\n<li><a href=\"http://www.henkuai.com/thread-8365-1-1.html\">Uncaught ReferenceError: WeixinJSBridge is not defined&#x95EE;&#x9898;</a>   </li>\n<li><a href=\"http://www.java-bbs.com/thread-14-1-1.html\">&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;&#x95EE;&#x9898;&#xFF1A;Uncaught ReferenceError: WeixinJSBridge is not defined </a></li>\n<li><a href=\"http://bbs.blueidea.com/thread-3103040-1-1.html\">&#x4F20;&#x8BF4;&#x4E2D;&#x7684;WeixinJSBridge&#x548C;&#x5FAE;&#x4FE1;rest&#x63A5;&#x53E3;</a></li>\n<li><a href=\"https://github.com/whq731/mobile-problems/blob/master/%E7%9B%91%E5%90%ACwxbridge%E5%8A%A0%E8%BD%BD%E5%90%8E%E5%86%8D%E5%94%A4%E8%B5%B7%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98.md\">&#x76D1;&#x542C;wxbridge&#x52A0;&#x8F7D;&#x540E;&#x518D;&#x5524;&#x8D77;&#x5FAE;&#x4FE1;&#x652F;&#x4ED8;</a></li>\n</ul>"},{"title":"聊聊\"jQuery is not defined\"","date":"2017-03-06T02:00:00.000Z","_content":"\n我的博客使用了[Fundebug](https://fundebug.com/)的[JavaScript错误监控插件](https://docs.fundebug.com/notifier/javascript/)，然后偶尔会收到**jQuery is not defined**这样的错误报警: \n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:70%;\" src=\"jquery-is-not-defined/fundebug-jquery-error.png\" />\n</div>\n\n由出错的代码块可知，博客中的『返回顶部』的功能是使用了jQuery实现，如果jQuery出错，意味着该功能失效，那么读者就不得不手动滑动到博客顶部，这样用户体验是非常糟糕的。根据统计，3个月时间内，这个错误已经累计出现了**399**次，已经相当严重了。\n\n<div id=\"timeContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_time.js\"></script>\n\n\n\n我使用了[Staticfile CDN](https://staticfile.org/)提供的的jQuery:\n\n```js\n<script src=\"https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js\"></script>\n```\n\n\n\n而根据最新统计数据显示，jQuery依然是前端用得最多的JavaScript库，因此一旦jQuery出错，必定会影响很多功能，jQuery的重要性不言而喻。另一方面，不少[Fundebug](https://fundebug.com/)的用户都收到过\"jQuery is not defined\"的错误报警，许多前端开发者应该都遇到(也许只是你没有发现)，我们通过这篇博客帮助大家解决问题。\n\n### 出错原因1: 加载CDN的jQuery失败或者超时\n\n> 当提供jQuery的CDN出问题导致jQuery加载失败，或者由于网络问题浏览器加载jQuery文件超时，会出现jQuery未定义的错误。\n\n**解决方案**: 将jQuery文件挂载在自己的网站上作为备用，如果CDN加载jQuery失败，则使用自己网站存托管的jQuery。这样的话，大部分用户依然可以通过CDN加快访问速度，而一旦CDN出问题时也可以避免出错。\n\n```js\n <script src=\"https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js\"></script>\n <script> \n window.jQuery || document.write('<script src=\"http://kiwenlau.com/js/jquery.min.js\"><\\/script>'))\n </script>\n```\n\n我的博客读者绝大部分来自国内，然而分析错误的IP地址后，我发现高达26.1%出错用户的来自国外。根据**幸存者偏差**，我们不能认定国内用户出错概率更高，而应该认定国外用户出错概率更高。那么这就不难理解了，国外用户请求国内CDN时速度太慢，导致jQuery出错。\n\n<div id=\"ipContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_ip.js\"></script>\n\n因此，我将jQuery挂载在[http://kiwenlau.com/js/jquery.min.js](http://kiwenlau.com/js/jquery.min.js)作为备用，解决了问题。\n\n### 出错原因2: 加载jQuery的顺序错误\n\n> 依赖于jQuery的其它JavaScript脚本先于jQuery加载完成并执行。这时jQuery尚未加载，因此依赖于jQuery的代码调用jQuery的话就会出错。\n\n**解决方案**: 将jQuery库放在依赖于jQuery的JavaScript脚本之前，并且将这些代码放入**document.ready**来确保DOM加载完毕。\n\n\n```js\n<script type=\"text/javascript\" src=\"path/to/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n  $(document).ready(function() {\n    //依赖于jQuery的代码\n  });\n</script>\n```\n\n#### 参考链接\n[The State of Front-End Tooling 2016 - Results](https://ashleynolan.co.uk/blog/frontend-tooling-survey-2016-results)\n[幸存者偏差是什么意思？- 知乎](https://www.zhihu.com/question/36520358)\n\n\n\n","source":"_posts/2017/03/06/jquery-is-not-defined.md","raw":"---\ntitle: 聊聊\"jQuery is not defined\"\n\ndate: 2017-03-06 10:00:00\n---\n\n我的博客使用了[Fundebug](https://fundebug.com/)的[JavaScript错误监控插件](https://docs.fundebug.com/notifier/javascript/)，然后偶尔会收到**jQuery is not defined**这样的错误报警: \n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:70%;\" src=\"jquery-is-not-defined/fundebug-jquery-error.png\" />\n</div>\n\n由出错的代码块可知，博客中的『返回顶部』的功能是使用了jQuery实现，如果jQuery出错，意味着该功能失效，那么读者就不得不手动滑动到博客顶部，这样用户体验是非常糟糕的。根据统计，3个月时间内，这个错误已经累计出现了**399**次，已经相当严重了。\n\n<div id=\"timeContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_time.js\"></script>\n\n\n\n我使用了[Staticfile CDN](https://staticfile.org/)提供的的jQuery:\n\n```js\n<script src=\"https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js\"></script>\n```\n\n\n\n而根据最新统计数据显示，jQuery依然是前端用得最多的JavaScript库，因此一旦jQuery出错，必定会影响很多功能，jQuery的重要性不言而喻。另一方面，不少[Fundebug](https://fundebug.com/)的用户都收到过\"jQuery is not defined\"的错误报警，许多前端开发者应该都遇到(也许只是你没有发现)，我们通过这篇博客帮助大家解决问题。\n\n### 出错原因1: 加载CDN的jQuery失败或者超时\n\n> 当提供jQuery的CDN出问题导致jQuery加载失败，或者由于网络问题浏览器加载jQuery文件超时，会出现jQuery未定义的错误。\n\n**解决方案**: 将jQuery文件挂载在自己的网站上作为备用，如果CDN加载jQuery失败，则使用自己网站存托管的jQuery。这样的话，大部分用户依然可以通过CDN加快访问速度，而一旦CDN出问题时也可以避免出错。\n\n```js\n <script src=\"https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js\"></script>\n <script> \n window.jQuery || document.write('<script src=\"http://kiwenlau.com/js/jquery.min.js\"><\\/script>'))\n </script>\n```\n\n我的博客读者绝大部分来自国内，然而分析错误的IP地址后，我发现高达26.1%出错用户的来自国外。根据**幸存者偏差**，我们不能认定国内用户出错概率更高，而应该认定国外用户出错概率更高。那么这就不难理解了，国外用户请求国内CDN时速度太慢，导致jQuery出错。\n\n<div id=\"ipContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_ip.js\"></script>\n\n因此，我将jQuery挂载在[http://kiwenlau.com/js/jquery.min.js](http://kiwenlau.com/js/jquery.min.js)作为备用，解决了问题。\n\n### 出错原因2: 加载jQuery的顺序错误\n\n> 依赖于jQuery的其它JavaScript脚本先于jQuery加载完成并执行。这时jQuery尚未加载，因此依赖于jQuery的代码调用jQuery的话就会出错。\n\n**解决方案**: 将jQuery库放在依赖于jQuery的JavaScript脚本之前，并且将这些代码放入**document.ready**来确保DOM加载完毕。\n\n\n```js\n<script type=\"text/javascript\" src=\"path/to/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n  $(document).ready(function() {\n    //依赖于jQuery的代码\n  });\n</script>\n```\n\n#### 参考链接\n[The State of Front-End Tooling 2016 - Results](https://ashleynolan.co.uk/blog/frontend-tooling-survey-2016-results)\n[幸存者偏差是什么意思？- 知乎](https://www.zhihu.com/question/36520358)\n\n\n\n","slug":"2017/03/06/jquery-is-not-defined","published":1,"updated":"2017-03-06T12:47:38.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywen50017mkfye2i4vuno","content":"<p>&#x6211;&#x7684;&#x535A;&#x5BA2;&#x4F7F;&#x7528;&#x4E86;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\" target=\"_blank\" rel=\"external\">JavaScript&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x63D2;&#x4EF6;</a>&#xFF0C;&#x7136;&#x540E;&#x5076;&#x5C14;&#x4F1A;&#x6536;&#x5230;<strong>jQuery is not defined</strong>&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;: </p>\n<a id=\"more\"></a>\n<div style=\"text-align: left;\"><br><img style=\"width:70%;\" src=\"/2017/03/06/jquery-is-not-defined/fundebug-jquery-error.png\"><br></div>\n\n<p>&#x7531;&#x51FA;&#x9519;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x53EF;&#x77E5;&#xFF0C;&#x535A;&#x5BA2;&#x4E2D;&#x7684;&#x300E;&#x8FD4;&#x56DE;&#x9876;&#x90E8;&#x300F;&#x7684;&#x529F;&#x80FD;&#x662F;&#x4F7F;&#x7528;&#x4E86;jQuery&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x679C;jQuery&#x51FA;&#x9519;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x529F;&#x80FD;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x8BFB;&#x8005;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x624B;&#x52A8;&#x6ED1;&#x52A8;&#x5230;&#x535A;&#x5BA2;&#x9876;&#x90E8;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x975E;&#x5E38;&#x7CDF;&#x7CD5;&#x7684;&#x3002;&#x6839;&#x636E;&#x7EDF;&#x8BA1;&#xFF0C;3&#x4E2A;&#x6708;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5DF2;&#x7ECF;&#x7D2F;&#x8BA1;&#x51FA;&#x73B0;&#x4E86;<strong>399</strong>&#x6B21;&#xFF0C;&#x5DF2;&#x7ECF;&#x76F8;&#x5F53;&#x4E25;&#x91CD;&#x4E86;&#x3002;</p>\n<p><div id=\"timeContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div></p>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_time.js\"></script>\n\n\n\n<p>&#x6211;&#x4F7F;&#x7528;&#x4E86;<a href=\"https://staticfile.org/\" target=\"_blank\" rel=\"external\">Staticfile CDN</a>&#x63D0;&#x4F9B;&#x7684;&#x7684;jQuery:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n<p>&#x800C;&#x6839;&#x636E;&#x6700;&#x65B0;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x663E;&#x793A;&#xFF0C;jQuery&#x4F9D;&#x7136;&#x662F;&#x524D;&#x7AEF;&#x7528;&#x5F97;&#x6700;&#x591A;&#x7684;JavaScript&#x5E93;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x65E6;jQuery&#x51FA;&#x9519;&#xFF0C;&#x5FC5;&#x5B9A;&#x4F1A;&#x5F71;&#x54CD;&#x5F88;&#x591A;&#x529F;&#x80FD;&#xFF0C;jQuery&#x7684;&#x91CD;&#x8981;&#x6027;&#x4E0D;&#x8A00;&#x800C;&#x55BB;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4E0D;&#x5C11;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;&#x7528;&#x6237;&#x90FD;&#x6536;&#x5230;&#x8FC7;&#x201D;jQuery is not defined&#x201D;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;&#xFF0C;&#x8BB8;&#x591A;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#x5E94;&#x8BE5;&#x90FD;&#x9047;&#x5230;(&#x4E5F;&#x8BB8;&#x53EA;&#x662F;&#x4F60;&#x6CA1;&#x6709;&#x53D1;&#x73B0;)&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>\n<h3 id=\"&#x51FA;&#x9519;&#x539F;&#x56E0;1-&#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;\"><a href=\"#&#x51FA;&#x9519;&#x539F;&#x56E0;1-&#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;\" class=\"headerlink\" title=\"&#x51FA;&#x9519;&#x539F;&#x56E0;1: &#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;\"></a>&#x51FA;&#x9519;&#x539F;&#x56E0;1: &#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;</h3><blockquote>\n<p>&#x5F53;&#x63D0;&#x4F9B;jQuery&#x7684;CDN&#x51FA;&#x95EE;&#x9898;&#x5BFC;&#x81F4;jQuery&#x52A0;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x6216;&#x8005;&#x7531;&#x4E8E;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x6D4F;&#x89C8;&#x5668;&#x52A0;&#x8F7D;jQuery&#x6587;&#x4EF6;&#x8D85;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;jQuery&#x672A;&#x5B9A;&#x4E49;&#x7684;&#x9519;&#x8BEF;&#x3002;</p>\n</blockquote>\n<p><strong>&#x89E3;&#x51B3;&#x65B9;&#x6848;</strong>: &#x5C06;jQuery&#x6587;&#x4EF6;&#x6302;&#x8F7D;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7AD9;&#x4E0A;&#x4F5C;&#x4E3A;&#x5907;&#x7528;&#xFF0C;&#x5982;&#x679C;CDN&#x52A0;&#x8F7D;jQuery&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7F51;&#x7AD9;&#x5B58;&#x6258;&#x7BA1;&#x7684;jQuery&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x7528;&#x6237;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;CDN&#x52A0;&#x5FEB;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x800C;&#x4E00;&#x65E6;CDN&#x51FA;&#x95EE;&#x9898;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x51FA;&#x9519;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script&gt; </div><div class=\"line\"><span class=\"built_in\">window</span>.jQuery || <span class=\"built_in\">document</span>.write(<span class=\"string\">&apos;&lt;script src=&quot;http://kiwenlau.com/js/jquery.min.js&quot;&gt;&lt;\\/script&gt;&apos;</span>))</div><div class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x6211;&#x7684;&#x535A;&#x5BA2;&#x8BFB;&#x8005;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x6765;&#x81EA;&#x56FD;&#x5185;&#xFF0C;&#x7136;&#x800C;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;IP&#x5730;&#x5740;&#x540E;&#xFF0C;&#x6211;&#x53D1;&#x73B0;&#x9AD8;&#x8FBE;26.1%&#x51FA;&#x9519;&#x7528;&#x6237;&#x7684;&#x6765;&#x81EA;&#x56FD;&#x5916;&#x3002;&#x6839;&#x636E;<strong>&#x5E78;&#x5B58;&#x8005;&#x504F;&#x5DEE;</strong>&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x8BA4;&#x5B9A;&#x56FD;&#x5185;&#x7528;&#x6237;&#x51FA;&#x9519;&#x6982;&#x7387;&#x66F4;&#x9AD8;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x8BA4;&#x5B9A;&#x56FD;&#x5916;&#x7528;&#x6237;&#x51FA;&#x9519;&#x6982;&#x7387;&#x66F4;&#x9AD8;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x56FD;&#x5916;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x56FD;&#x5185;CDN&#x65F6;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x5BFC;&#x81F4;jQuery&#x51FA;&#x9519;&#x3002;</p>\n<p><div id=\"ipContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div></p>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_ip.js\"></script>\n\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x5C06;jQuery&#x6302;&#x8F7D;&#x5728;<a href=\"http://kiwenlau.com/js/jquery.min.js\">http://kiwenlau.com/js/jquery.min.js</a>&#x4F5C;&#x4E3A;&#x5907;&#x7528;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x95EE;&#x9898;&#x3002;</p>\n<h3 id=\"&#x51FA;&#x9519;&#x539F;&#x56E0;2-&#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;\"><a href=\"#&#x51FA;&#x9519;&#x539F;&#x56E0;2-&#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;\" class=\"headerlink\" title=\"&#x51FA;&#x9519;&#x539F;&#x56E0;2: &#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;\"></a>&#x51FA;&#x9519;&#x539F;&#x56E0;2: &#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;</h3><blockquote>\n<p>&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;&#x5176;&#x5B83;JavaScript&#x811A;&#x672C;&#x5148;&#x4E8E;jQuery&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x5E76;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x65F6;jQuery&#x5C1A;&#x672A;&#x52A0;&#x8F7D;&#xFF0C;&#x56E0;&#x6B64;&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;&#x4EE3;&#x7801;&#x8C03;&#x7528;jQuery&#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p>\n</blockquote>\n<p><strong>&#x89E3;&#x51B3;&#x65B9;&#x6848;</strong>: &#x5C06;jQuery&#x5E93;&#x653E;&#x5728;&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;JavaScript&#x811A;&#x672C;&#x4E4B;&#x524D;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x653E;&#x5165;<strong>document.ready</strong>&#x6765;&#x786E;&#x4FDD;DOM&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;path/to/jquery.min.js&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</div><div class=\"line\">  $(<span class=\"built_in\">document</span>).ready(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</div><div class=\"line\">    <span class=\"comment\">//&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;&#x4EE3;&#x7801;</span></div><div class=\"line\">  });</div><div class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n<h4 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h4><p><a href=\"https://ashleynolan.co.uk/blog/frontend-tooling-survey-2016-results\" target=\"_blank\" rel=\"external\">The State of Front-End Tooling 2016 - Results</a><br><a href=\"https://www.zhihu.com/question/36520358\" target=\"_blank\" rel=\"external\">&#x5E78;&#x5B58;&#x8005;&#x504F;&#x5DEE;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;- &#x77E5;&#x4E4E;</a></p>\n","excerpt":"<p>&#x6211;&#x7684;&#x535A;&#x5BA2;&#x4F7F;&#x7528;&#x4E86;<a href=\"https://fundebug.com/\">Fundebug</a>&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\">JavaScript&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x63D2;&#x4EF6;</a>&#xFF0C;&#x7136;&#x540E;&#x5076;&#x5C14;&#x4F1A;&#x6536;&#x5230;<strong>jQuery is not defined</strong>&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;: </p>","more":"<div style=\"text-align: left;\"><br><img style=\"width:70%;\" src=\"/2017/03/06/jquery-is-not-defined/fundebug-jquery-error.png\"><br></div>\n\n<p>&#x7531;&#x51FA;&#x9519;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x53EF;&#x77E5;&#xFF0C;&#x535A;&#x5BA2;&#x4E2D;&#x7684;&#x300E;&#x8FD4;&#x56DE;&#x9876;&#x90E8;&#x300F;&#x7684;&#x529F;&#x80FD;&#x662F;&#x4F7F;&#x7528;&#x4E86;jQuery&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x679C;jQuery&#x51FA;&#x9519;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x529F;&#x80FD;&#x5931;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x8BFB;&#x8005;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x624B;&#x52A8;&#x6ED1;&#x52A8;&#x5230;&#x535A;&#x5BA2;&#x9876;&#x90E8;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x975E;&#x5E38;&#x7CDF;&#x7CD5;&#x7684;&#x3002;&#x6839;&#x636E;&#x7EDF;&#x8BA1;&#xFF0C;3&#x4E2A;&#x6708;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x5DF2;&#x7ECF;&#x7D2F;&#x8BA1;&#x51FA;&#x73B0;&#x4E86;<strong>399</strong>&#x6B21;&#xFF0C;&#x5DF2;&#x7ECF;&#x76F8;&#x5F53;&#x4E25;&#x91CD;&#x4E86;&#x3002;</p>\n<p><div id=\"timeContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div></p>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_time.js\"></script>\n\n\n\n<p>&#x6211;&#x4F7F;&#x7528;&#x4E86;<a href=\"https://staticfile.org/\">Staticfile CDN</a>&#x63D0;&#x4F9B;&#x7684;&#x7684;jQuery:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n<p>&#x800C;&#x6839;&#x636E;&#x6700;&#x65B0;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x663E;&#x793A;&#xFF0C;jQuery&#x4F9D;&#x7136;&#x662F;&#x524D;&#x7AEF;&#x7528;&#x5F97;&#x6700;&#x591A;&#x7684;JavaScript&#x5E93;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x65E6;jQuery&#x51FA;&#x9519;&#xFF0C;&#x5FC5;&#x5B9A;&#x4F1A;&#x5F71;&#x54CD;&#x5F88;&#x591A;&#x529F;&#x80FD;&#xFF0C;jQuery&#x7684;&#x91CD;&#x8981;&#x6027;&#x4E0D;&#x8A00;&#x800C;&#x55BB;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4E0D;&#x5C11;<a href=\"https://fundebug.com/\">Fundebug</a>&#x7684;&#x7528;&#x6237;&#x90FD;&#x6536;&#x5230;&#x8FC7;&#x201D;jQuery is not defined&#x201D;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;&#xFF0C;&#x8BB8;&#x591A;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x8005;&#x5E94;&#x8BE5;&#x90FD;&#x9047;&#x5230;(&#x4E5F;&#x8BB8;&#x53EA;&#x662F;&#x4F60;&#x6CA1;&#x6709;&#x53D1;&#x73B0;)&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>\n<h3 id=\"&#x51FA;&#x9519;&#x539F;&#x56E0;1-&#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;\"><a href=\"#&#x51FA;&#x9519;&#x539F;&#x56E0;1-&#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;\" class=\"headerlink\" title=\"&#x51FA;&#x9519;&#x539F;&#x56E0;1: &#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;\"></a>&#x51FA;&#x9519;&#x539F;&#x56E0;1: &#x52A0;&#x8F7D;CDN&#x7684;jQuery&#x5931;&#x8D25;&#x6216;&#x8005;&#x8D85;&#x65F6;</h3><blockquote>\n<p>&#x5F53;&#x63D0;&#x4F9B;jQuery&#x7684;CDN&#x51FA;&#x95EE;&#x9898;&#x5BFC;&#x81F4;jQuery&#x52A0;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x6216;&#x8005;&#x7531;&#x4E8E;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x6D4F;&#x89C8;&#x5668;&#x52A0;&#x8F7D;jQuery&#x6587;&#x4EF6;&#x8D85;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;jQuery&#x672A;&#x5B9A;&#x4E49;&#x7684;&#x9519;&#x8BEF;&#x3002;</p>\n</blockquote>\n<p><strong>&#x89E3;&#x51B3;&#x65B9;&#x6848;</strong>: &#x5C06;jQuery&#x6587;&#x4EF6;&#x6302;&#x8F7D;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x7F51;&#x7AD9;&#x4E0A;&#x4F5C;&#x4E3A;&#x5907;&#x7528;&#xFF0C;&#x5982;&#x679C;CDN&#x52A0;&#x8F7D;jQuery&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7F51;&#x7AD9;&#x5B58;&#x6258;&#x7BA1;&#x7684;jQuery&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x7528;&#x6237;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;CDN&#x52A0;&#x5FEB;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x800C;&#x4E00;&#x65E6;CDN&#x51FA;&#x95EE;&#x9898;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x51FA;&#x9519;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script&gt; </div><div class=\"line\"><span class=\"built_in\">window</span>.jQuery || <span class=\"built_in\">document</span>.write(<span class=\"string\">&apos;&lt;script src=&quot;http://kiwenlau.com/js/jquery.min.js&quot;&gt;&lt;\\/script&gt;&apos;</span>))</div><div class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x6211;&#x7684;&#x535A;&#x5BA2;&#x8BFB;&#x8005;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x6765;&#x81EA;&#x56FD;&#x5185;&#xFF0C;&#x7136;&#x800C;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;IP&#x5730;&#x5740;&#x540E;&#xFF0C;&#x6211;&#x53D1;&#x73B0;&#x9AD8;&#x8FBE;26.1%&#x51FA;&#x9519;&#x7528;&#x6237;&#x7684;&#x6765;&#x81EA;&#x56FD;&#x5916;&#x3002;&#x6839;&#x636E;<strong>&#x5E78;&#x5B58;&#x8005;&#x504F;&#x5DEE;</strong>&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x8BA4;&#x5B9A;&#x56FD;&#x5185;&#x7528;&#x6237;&#x51FA;&#x9519;&#x6982;&#x7387;&#x66F4;&#x9AD8;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x8BA4;&#x5B9A;&#x56FD;&#x5916;&#x7528;&#x6237;&#x51FA;&#x9519;&#x6982;&#x7387;&#x66F4;&#x9AD8;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x5C31;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x56FD;&#x5916;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x56FD;&#x5185;CDN&#x65F6;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x5BFC;&#x81F4;jQuery&#x51FA;&#x9519;&#x3002;</p>\n<p><div id=\"ipContainer\" style=\"width: 550px; height: 400px; margin: 0 auto!important\"></div></p>\n<script language=\"JavaScript\" src=\"/js/blog/20170306_ip.js\"></script>\n\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x5C06;jQuery&#x6302;&#x8F7D;&#x5728;<a href=\"http://kiwenlau.com/js/jquery.min.js\">http://kiwenlau.com/js/jquery.min.js</a>&#x4F5C;&#x4E3A;&#x5907;&#x7528;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x95EE;&#x9898;&#x3002;</p>\n<h3 id=\"&#x51FA;&#x9519;&#x539F;&#x56E0;2-&#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;\"><a href=\"#&#x51FA;&#x9519;&#x539F;&#x56E0;2-&#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;\" class=\"headerlink\" title=\"&#x51FA;&#x9519;&#x539F;&#x56E0;2: &#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;\"></a>&#x51FA;&#x9519;&#x539F;&#x56E0;2: &#x52A0;&#x8F7D;jQuery&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;</h3><blockquote>\n<p>&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;&#x5176;&#x5B83;JavaScript&#x811A;&#x672C;&#x5148;&#x4E8E;jQuery&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x5E76;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x65F6;jQuery&#x5C1A;&#x672A;&#x52A0;&#x8F7D;&#xFF0C;&#x56E0;&#x6B64;&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;&#x4EE3;&#x7801;&#x8C03;&#x7528;jQuery&#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x51FA;&#x9519;&#x3002;</p>\n</blockquote>\n<p><strong>&#x89E3;&#x51B3;&#x65B9;&#x6848;</strong>: &#x5C06;jQuery&#x5E93;&#x653E;&#x5728;&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;JavaScript&#x811A;&#x672C;&#x4E4B;&#x524D;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x653E;&#x5165;<strong>document.ready</strong>&#x6765;&#x786E;&#x4FDD;DOM&#x52A0;&#x8F7D;&#x5B8C;&#x6BD5;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span> src=<span class=\"string\">&quot;path/to/jquery.min.js&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script type=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</div><div class=\"line\">  $(<span class=\"built_in\">document</span>).ready(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>{</div><div class=\"line\">    <span class=\"comment\">//&#x4F9D;&#x8D56;&#x4E8E;jQuery&#x7684;&#x4EE3;&#x7801;</span></div><div class=\"line\">  });</div><div class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n<h4 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h4><p><a href=\"https://ashleynolan.co.uk/blog/frontend-tooling-survey-2016-results\">The State of Front-End Tooling 2016 - Results</a><br><a href=\"https://www.zhihu.com/question/36520358\">&#x5E78;&#x5B58;&#x8005;&#x504F;&#x5DEE;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;- &#x77E5;&#x4E4E;</a></p>"},{"title":"Source Map入门教程","date":"2017-03-13T02:00:00.000Z","_content":"\n部署前端之前，开发者通常会对代码进行打包压缩，这样可以减少代码大小，从而有效提高访问速度。然而，压缩代码的报错信息是很难Debug的，因为它的行号和列号已经失真。这时就需要Source Map来还原真实的出错位置了。\n\n<!-- more -->\n\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"sourcemap-tutorial/fundebug-sourcemap.jpg\" />\n</div>\n\n### 为啥变换代码？\n\n前端代码越来越复杂的情况下，开发者通常会使用[webpack](https://github.com/webpack/webpack)、[UglifyJS2](https://github.com/mishoo/UglifyJS2)等工具对代码进行打包变换，这样可以减少代码大小，有效提高访问速度。关于变换代码的原因，这里不妨引用一下大神[阮一峰](http://www.ruanyifeng.com/blog/)的[JavaScript Source Map 详解](http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html):\n\n> - 压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。\n> - 多个文件合并，减少HTTP请求数。\n> - 其他语言编译成JavaScript。最常见的例子就是CoffeeScript。\n\n### 如何变换代码？\n\n下面是一个简单的“hello World”程序**hello.js**\n\n```js\nfunction sayHello()\n{\n    var name = \"Fundebug\";\n    var greeting = \"Hello, \" + Name;\n    console.log(greeting);\n}\n\nsayHello();\n```\n\n使用[UglifyJS2](https://github.com/mishoo/UglifyJS2)对源代码进行压缩变换:\n\n```sh\nuglifyjs hello.js \\\n         -m toplevel=true \\\n         -c unused=true,collapse_vars=true \\\n         -o hello.min.js\n```\n\n压缩后的代码**hello.min.js**\n\n```js\nfunction o(){var o=\"Hello, \"+Name;console.log(o)}o();\n```\n\n### 为啥需要Source Map?\n\n使用Firefox执行**hello.js**的报错信息是这样:\n\n```js\nReferenceError: Name is not defined\n\tsayHello file:///Users/fundebug/sourcemap-tutorial/hello.js:4:9\n\t<匿名> file:///Users/fundebug/sourcemap-tutorial/hello.js:8:1\n```\n\n而**hello.min.js**的报错信息是这样:\n\n```js\nReferenceError: Name is not defined\n\to file:///Users/fundebug/sourcemap-tutorial/hello.min.js:1:18\n\t<匿名> file:///Users/fundebug/sourcemap-tutorial/hello.min.js:1:59\n```\n\n对比压缩前后的出错信息，我们会发现，错误行号和列号已经失真，且函数名也经过了变换。而对于真实的前端项目，开发者会将数十个源文件压缩为一个文件，这时，错误的列号可能多达数千，且出错的真实文件名也是很难确定的，这样的话，压缩代码的报错信息是很难Debug的。\n\n**而Source Map则可以用于还原真实的出错位置**，帮助开发者更快的Debug。\n\n### 什么是Source Map?\n\n使用[UglifyJS2](https://github.com/mishoo/UglifyJS2)时指定source-map选项即可生成Source Map:\n\n```sh\nuglifyjs hello.js \\\n         -m toplevel=true \\\n         -c unused=true,collapse_vars=true \\\n         --source-map hello.min.js.map \\\n         --source-map-include-sources \\\n         --source-map-root \\\n         -o hello.min.js\n```\n\n各种主流前端任务管理工具，打包工具都支持生成Source Map，具体可以查看[生成Source Map - Fundebug文档](https://docs.fundebug.com/notifier/javascript/sourcemap/generate/)。\n\n\n生成的**hello.min.js**多了sourceMappingURL，表示Source Map文件的位置。\n\n```js\nfunction o(){var o=\"Hello, \"+Name;console.log(o)}o();\n//# sourceMappingURL=hello.min.js.map\n```\n\n\n生成的Source Map为**hello.min.js.map**:\n\n```js\n{\n    \"version\": 3,\n    \"sources\": [\"hello.js\"],\n    \"names\": [\"sayHello\", \"greeting\", \"Name\", \"console\", \"log\"],\n    \"mappings\": \"AAAA,QAASA,KAEL,GACIC,GAAW,UAAYC,IAC3BC,SAAQC,IAAIH,GAGhBD\",\n    \"file\": \"hello.min.js\",\n    \"sourceRoot\": \"\",\n    \"sourcesContent\": [\"function sayHello()\\n{\\n    var name = \\\"Fundebug\\\";\\n    var greeting = \\\"Hello, \\\" + Name;\\n    console.log(greeting);\\n}\\n\\nsayHello();\\n\"]\n}\n```\n\n由**hello.min.js.map**可知，Source Map是一个JSON文件，而它**包含了代码转换前后的位置信息**。也就是说，给定一个转换之后的压缩代码的位置，就可以通过Source Map获取转换之前的代码位置，反过来也一样。Source Map各个属性的含义如下:\n\n- version：Source Map的版本号。\n- sources：转换前的文件列表。\n- names：转换前的所有变量名和属性名。\n- mappings：记录位置信息的字符串，经过编码。\n- file：(可选)转换后的文件名。\n- sourceRoot：(可选)转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。\n- sourcesContent:(可选)转换前的文件内容列表，与sources列表依次对应。\n\nSource Map真正神奇之处在于mappings属性，它记录了位置是如何对应的。[JavaScript Source Map 详解](http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html)已经有很好的解释，这里不再赘述。\n\n### 怎样使用Source Map?\n\n主流浏览器均支持Source Map功能，不过Chrome与Firefox需要一些简单的配置，具体步骤请参考[How to enable source maps](https://gist.github.com/jakebellacera/336c4982194bcb02ef8a)。下面以MacBook上的Chrome浏览器为例，介绍一下配置方法:\n\n#### 1. 开启**开发者工具**\n\n使用快捷键**option + command + i**；或者在菜单栏选择**视图->开发者->开发者工具**\n\n<div style=\"text-align: left;\">\n<img style=\"width:40%;\" src=\"sourcemap-tutorial/chrome-sourcemap1.png\" />\n</div>\n\n#### 2. 打开设置\n\n使用快捷键**fn + F1**；或者点击右上角的三个点的图标，选择Settings\n\n<div style=\"text-align: left;\">\n<img style=\"width:20%;\" src=\"sourcemap-tutorial/chrome-sourcemap2.png\" />\n</div>\n\n\n#### 3. 开启Source Map \n\n在Sources中，选中**Enable JavaScript source maps**\n\n<div style=\"text-align: left;\">\n<img style=\"width:30%;\" src=\"sourcemap-tutorial/chrome-sourcemap3.png\" />\n</div>\n\n为了测试，我写了一个简单的HTML文件**hello.min.html**\n\n```html\n<head>\n\t<script type=\"text/javascript\" src=\"hello.min.js\"></script>\n</head>\n```\n\n使用Chrome打开**hello.min.html**，在控制台看到的错误如下:\n\n```js\nUncaught ReferenceError: Name is not defined\n    at o (hello.min.js:1)\n    at hello.min.js:1\n```\n\n报错的文件仍然为**hello.min.js**，需要刷新一下Source Map才有作用:\n\n```js\nUncaught ReferenceError: Name is not defined\n    at o (hello.js:4)\n    at hello.js:8\n```\n\n注意，Chrome的报错信息没有列号，因此4为错误的行号。Chrome不仅可以通过Source Map还原真实的出错位置，还可以根据Source Map的sourcesContent还原出错的源代码。点击出错位置，即可跳转到源码，这样Debug将非常方便。\n\n\n<div style=\"text-align: left;\">\n<img style=\"width:40%;\" src=\"sourcemap-tutorial/chrome-sourcemap4.png\" />\n</div>\n\n\n#### 参考链接\n- [JavaScript Source Map 详解](http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html)\n- [Source Map Revision 3 Proposal](https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit)\n- [How to enable source maps](https://gist.github.com/jakebellacera/336c4982194bcb02ef8a)\n\n\n\n\n\n\n\n","source":"_posts/2017/03/13/sourcemap-tutorial.md","raw":"---\n\ntitle: Source Map入门教程\n\ndate: 2017-03-13 10:00:00\n\ntags: [Source Map, JavaScript]\n\n---\n\n部署前端之前，开发者通常会对代码进行打包压缩，这样可以减少代码大小，从而有效提高访问速度。然而，压缩代码的报错信息是很难Debug的，因为它的行号和列号已经失真。这时就需要Source Map来还原真实的出错位置了。\n\n<!-- more -->\n\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"sourcemap-tutorial/fundebug-sourcemap.jpg\" />\n</div>\n\n### 为啥变换代码？\n\n前端代码越来越复杂的情况下，开发者通常会使用[webpack](https://github.com/webpack/webpack)、[UglifyJS2](https://github.com/mishoo/UglifyJS2)等工具对代码进行打包变换，这样可以减少代码大小，有效提高访问速度。关于变换代码的原因，这里不妨引用一下大神[阮一峰](http://www.ruanyifeng.com/blog/)的[JavaScript Source Map 详解](http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html):\n\n> - 压缩，减小体积。比如jQuery 1.9的源码，压缩前是252KB，压缩后是32KB。\n> - 多个文件合并，减少HTTP请求数。\n> - 其他语言编译成JavaScript。最常见的例子就是CoffeeScript。\n\n### 如何变换代码？\n\n下面是一个简单的“hello World”程序**hello.js**\n\n```js\nfunction sayHello()\n{\n    var name = \"Fundebug\";\n    var greeting = \"Hello, \" + Name;\n    console.log(greeting);\n}\n\nsayHello();\n```\n\n使用[UglifyJS2](https://github.com/mishoo/UglifyJS2)对源代码进行压缩变换:\n\n```sh\nuglifyjs hello.js \\\n         -m toplevel=true \\\n         -c unused=true,collapse_vars=true \\\n         -o hello.min.js\n```\n\n压缩后的代码**hello.min.js**\n\n```js\nfunction o(){var o=\"Hello, \"+Name;console.log(o)}o();\n```\n\n### 为啥需要Source Map?\n\n使用Firefox执行**hello.js**的报错信息是这样:\n\n```js\nReferenceError: Name is not defined\n\tsayHello file:///Users/fundebug/sourcemap-tutorial/hello.js:4:9\n\t<匿名> file:///Users/fundebug/sourcemap-tutorial/hello.js:8:1\n```\n\n而**hello.min.js**的报错信息是这样:\n\n```js\nReferenceError: Name is not defined\n\to file:///Users/fundebug/sourcemap-tutorial/hello.min.js:1:18\n\t<匿名> file:///Users/fundebug/sourcemap-tutorial/hello.min.js:1:59\n```\n\n对比压缩前后的出错信息，我们会发现，错误行号和列号已经失真，且函数名也经过了变换。而对于真实的前端项目，开发者会将数十个源文件压缩为一个文件，这时，错误的列号可能多达数千，且出错的真实文件名也是很难确定的，这样的话，压缩代码的报错信息是很难Debug的。\n\n**而Source Map则可以用于还原真实的出错位置**，帮助开发者更快的Debug。\n\n### 什么是Source Map?\n\n使用[UglifyJS2](https://github.com/mishoo/UglifyJS2)时指定source-map选项即可生成Source Map:\n\n```sh\nuglifyjs hello.js \\\n         -m toplevel=true \\\n         -c unused=true,collapse_vars=true \\\n         --source-map hello.min.js.map \\\n         --source-map-include-sources \\\n         --source-map-root \\\n         -o hello.min.js\n```\n\n各种主流前端任务管理工具，打包工具都支持生成Source Map，具体可以查看[生成Source Map - Fundebug文档](https://docs.fundebug.com/notifier/javascript/sourcemap/generate/)。\n\n\n生成的**hello.min.js**多了sourceMappingURL，表示Source Map文件的位置。\n\n```js\nfunction o(){var o=\"Hello, \"+Name;console.log(o)}o();\n//# sourceMappingURL=hello.min.js.map\n```\n\n\n生成的Source Map为**hello.min.js.map**:\n\n```js\n{\n    \"version\": 3,\n    \"sources\": [\"hello.js\"],\n    \"names\": [\"sayHello\", \"greeting\", \"Name\", \"console\", \"log\"],\n    \"mappings\": \"AAAA,QAASA,KAEL,GACIC,GAAW,UAAYC,IAC3BC,SAAQC,IAAIH,GAGhBD\",\n    \"file\": \"hello.min.js\",\n    \"sourceRoot\": \"\",\n    \"sourcesContent\": [\"function sayHello()\\n{\\n    var name = \\\"Fundebug\\\";\\n    var greeting = \\\"Hello, \\\" + Name;\\n    console.log(greeting);\\n}\\n\\nsayHello();\\n\"]\n}\n```\n\n由**hello.min.js.map**可知，Source Map是一个JSON文件，而它**包含了代码转换前后的位置信息**。也就是说，给定一个转换之后的压缩代码的位置，就可以通过Source Map获取转换之前的代码位置，反过来也一样。Source Map各个属性的含义如下:\n\n- version：Source Map的版本号。\n- sources：转换前的文件列表。\n- names：转换前的所有变量名和属性名。\n- mappings：记录位置信息的字符串，经过编码。\n- file：(可选)转换后的文件名。\n- sourceRoot：(可选)转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。\n- sourcesContent:(可选)转换前的文件内容列表，与sources列表依次对应。\n\nSource Map真正神奇之处在于mappings属性，它记录了位置是如何对应的。[JavaScript Source Map 详解](http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html)已经有很好的解释，这里不再赘述。\n\n### 怎样使用Source Map?\n\n主流浏览器均支持Source Map功能，不过Chrome与Firefox需要一些简单的配置，具体步骤请参考[How to enable source maps](https://gist.github.com/jakebellacera/336c4982194bcb02ef8a)。下面以MacBook上的Chrome浏览器为例，介绍一下配置方法:\n\n#### 1. 开启**开发者工具**\n\n使用快捷键**option + command + i**；或者在菜单栏选择**视图->开发者->开发者工具**\n\n<div style=\"text-align: left;\">\n<img style=\"width:40%;\" src=\"sourcemap-tutorial/chrome-sourcemap1.png\" />\n</div>\n\n#### 2. 打开设置\n\n使用快捷键**fn + F1**；或者点击右上角的三个点的图标，选择Settings\n\n<div style=\"text-align: left;\">\n<img style=\"width:20%;\" src=\"sourcemap-tutorial/chrome-sourcemap2.png\" />\n</div>\n\n\n#### 3. 开启Source Map \n\n在Sources中，选中**Enable JavaScript source maps**\n\n<div style=\"text-align: left;\">\n<img style=\"width:30%;\" src=\"sourcemap-tutorial/chrome-sourcemap3.png\" />\n</div>\n\n为了测试，我写了一个简单的HTML文件**hello.min.html**\n\n```html\n<head>\n\t<script type=\"text/javascript\" src=\"hello.min.js\"></script>\n</head>\n```\n\n使用Chrome打开**hello.min.html**，在控制台看到的错误如下:\n\n```js\nUncaught ReferenceError: Name is not defined\n    at o (hello.min.js:1)\n    at hello.min.js:1\n```\n\n报错的文件仍然为**hello.min.js**，需要刷新一下Source Map才有作用:\n\n```js\nUncaught ReferenceError: Name is not defined\n    at o (hello.js:4)\n    at hello.js:8\n```\n\n注意，Chrome的报错信息没有列号，因此4为错误的行号。Chrome不仅可以通过Source Map还原真实的出错位置，还可以根据Source Map的sourcesContent还原出错的源代码。点击出错位置，即可跳转到源码，这样Debug将非常方便。\n\n\n<div style=\"text-align: left;\">\n<img style=\"width:40%;\" src=\"sourcemap-tutorial/chrome-sourcemap4.png\" />\n</div>\n\n\n#### 参考链接\n- [JavaScript Source Map 详解](http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html)\n- [Source Map Revision 3 Proposal](https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit)\n- [How to enable source maps](https://gist.github.com/jakebellacera/336c4982194bcb02ef8a)\n\n\n\n\n\n\n\n","slug":"2017/03/13/sourcemap-tutorial","published":1,"updated":"2017-03-16T09:09:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywen70019mkfy6b09b6mx","content":"<p>&#x90E8;&#x7F72;&#x524D;&#x7AEF;&#x4E4B;&#x524D;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x901A;&#x5E38;&#x4F1A;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6253;&#x5305;&#x538B;&#x7F29;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4EE3;&#x7801;&#x5927;&#x5C0F;&#xFF0C;&#x4ECE;&#x800C;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5F88;&#x96BE;Debug&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x884C;&#x53F7;&#x548C;&#x5217;&#x53F7;&#x5DF2;&#x7ECF;&#x5931;&#x771F;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;Source Map&#x6765;&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#x4E86;&#x3002;</p>\n<a id=\"more\"></a>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/03/13/sourcemap-tutorial/fundebug-sourcemap.jpg\"><br></div>\n\n<h3 id=\"&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;</h3><p>&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x901A;&#x5E38;&#x4F1A;&#x4F7F;&#x7528;<a href=\"https://github.com/webpack/webpack\" target=\"_blank\" rel=\"external\">webpack</a>&#x3001;<a href=\"https://github.com/mishoo/UglifyJS2\" target=\"_blank\" rel=\"external\">UglifyJS2</a>&#x7B49;&#x5DE5;&#x5177;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6253;&#x5305;&#x53D8;&#x6362;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4EE3;&#x7801;&#x5927;&#x5C0F;&#xFF0C;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;&#x5173;&#x4E8E;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x59A8;&#x5F15;&#x7528;&#x4E00;&#x4E0B;&#x5927;&#x795E;<a href=\"http://www.ruanyifeng.com/blog/\" target=\"_blank\" rel=\"external\">&#x962E;&#x4E00;&#x5CF0;</a>&#x7684;<a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\" target=\"_blank\" rel=\"external\">JavaScript Source Map &#x8BE6;&#x89E3;</a>:</p>\n<blockquote>\n<ul>\n<li>&#x538B;&#x7F29;&#xFF0C;&#x51CF;&#x5C0F;&#x4F53;&#x79EF;&#x3002;&#x6BD4;&#x5982;jQuery 1.9&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x538B;&#x7F29;&#x524D;&#x662F;252KB&#xFF0C;&#x538B;&#x7F29;&#x540E;&#x662F;32KB&#x3002;</li>\n<li>&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x5408;&#x5E76;&#xFF0C;&#x51CF;&#x5C11;HTTP&#x8BF7;&#x6C42;&#x6570;&#x3002;</li>\n<li>&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x7F16;&#x8BD1;&#x6210;JavaScript&#x3002;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;CoffeeScript&#x3002;</li>\n</ul>\n</blockquote>\n<h3 id=\"&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"><a href=\"#&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"></a>&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;</h3><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x201C;hello World&#x201D;&#x7A0B;&#x5E8F;<strong>hello.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">&quot;Fundebug&quot;</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> greeting = <span class=\"string\">&quot;Hello, &quot;</span> + Name;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(greeting);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">sayHello();</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<a href=\"https://github.com/mishoo/UglifyJS2\" target=\"_blank\" rel=\"external\">UglifyJS2</a>&#x5BF9;&#x6E90;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x53D8;&#x6362;:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">uglifyjs hello.js \\</div><div class=\"line\">         -m toplevel=<span class=\"literal\">true</span> \\</div><div class=\"line\">         -c unused=<span class=\"literal\">true</span>,collapse_vars=<span class=\"literal\">true</span> \\</div><div class=\"line\">         -o hello.min.js</div></pre></td></tr></table></figure>\n<p>&#x538B;&#x7F29;&#x540E;&#x7684;&#x4EE3;&#x7801;<strong>hello.min.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>)</span>{<span class=\"keyword\">var</span> o=<span class=\"string\">&quot;Hello, &quot;</span>+Name;<span class=\"built_in\">console</span>.log(o)}o();</div></pre></td></tr></table></figure>\n<h3 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;Source-Map\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;Source-Map\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;Source Map?\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;Source Map?</h3><p>&#x4F7F;&#x7528;Firefox&#x6267;&#x884C;<strong>hello.js</strong>&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x8FD9;&#x6837;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">\tsayHello file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.js:4:9</span></div><div class=\"line\">\t&lt;&#x533F;&#x540D;&gt; file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.js:8:1</span></div></pre></td></tr></table></figure>\n<p>&#x800C;<strong>hello.min.js</strong>&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x8FD9;&#x6837;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">\to file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.min.js:1:18</span></div><div class=\"line\">\t&lt;&#x533F;&#x540D;&gt; file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.min.js:1:59</span></div></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x6BD4;&#x538B;&#x7F29;&#x524D;&#x540E;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x9519;&#x8BEF;&#x884C;&#x53F7;&#x548C;&#x5217;&#x53F7;&#x5DF2;&#x7ECF;&#x5931;&#x771F;&#xFF0C;&#x4E14;&#x51FD;&#x6570;&#x540D;&#x4E5F;&#x7ECF;&#x8FC7;&#x4E86;&#x53D8;&#x6362;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x771F;&#x5B9E;&#x7684;&#x524D;&#x7AEF;&#x9879;&#x76EE;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4F1A;&#x5C06;&#x6570;&#x5341;&#x4E2A;&#x6E90;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x4E3A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x65F6;&#xFF0C;&#x9519;&#x8BEF;&#x7684;&#x5217;&#x53F7;&#x53EF;&#x80FD;&#x591A;&#x8FBE;&#x6570;&#x5343;&#xFF0C;&#x4E14;&#x51FA;&#x9519;&#x7684;&#x771F;&#x5B9E;&#x6587;&#x4EF6;&#x540D;&#x4E5F;&#x662F;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5F88;&#x96BE;Debug&#x7684;&#x3002;</p>\n<p><strong>&#x800C;Source Map&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;</strong>&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;Debug&#x3002;</p>\n<h3 id=\"&#x4EC0;&#x4E48;&#x662F;Source-Map\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;Source-Map\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;Source Map?\"></a>&#x4EC0;&#x4E48;&#x662F;Source Map?</h3><p>&#x4F7F;&#x7528;<a href=\"https://github.com/mishoo/UglifyJS2\" target=\"_blank\" rel=\"external\">UglifyJS2</a>&#x65F6;&#x6307;&#x5B9A;source-map&#x9009;&#x9879;&#x5373;&#x53EF;&#x751F;&#x6210;Source Map:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">uglifyjs hello.js \\</div><div class=\"line\">         -m toplevel=<span class=\"literal\">true</span> \\</div><div class=\"line\">         -c unused=<span class=\"literal\">true</span>,collapse_vars=<span class=\"literal\">true</span> \\</div><div class=\"line\">         --source-map hello.min.js.map \\</div><div class=\"line\">         --source-map-include-sources \\</div><div class=\"line\">         --source-map-root \\</div><div class=\"line\">         -o hello.min.js</div></pre></td></tr></table></figure>\n<p>&#x5404;&#x79CD;&#x4E3B;&#x6D41;&#x524D;&#x7AEF;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x6253;&#x5305;&#x5DE5;&#x5177;&#x90FD;&#x652F;&#x6301;&#x751F;&#x6210;Source Map&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/javascript/sourcemap/generate/\" target=\"_blank\" rel=\"external\">&#x751F;&#x6210;Source Map - Fundebug&#x6587;&#x6863;</a>&#x3002;</p>\n<p>&#x751F;&#x6210;&#x7684;<strong>hello.min.js</strong>&#x591A;&#x4E86;sourceMappingURL&#xFF0C;&#x8868;&#x793A;Source Map&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>)</span>{<span class=\"keyword\">var</span> o=<span class=\"string\">&quot;Hello, &quot;</span>+Name;<span class=\"built_in\">console</span>.log(o)}o();</div><div class=\"line\"><span class=\"comment\">//# sourceMappingURL=hello.min.js.map</span></div></pre></td></tr></table></figure>\n<p>&#x751F;&#x6210;&#x7684;Source Map&#x4E3A;<strong>hello.min.js.map</strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;version&quot;</span>: <span class=\"number\">3</span>,</div><div class=\"line\">    <span class=\"string\">&quot;sources&quot;</span>: [<span class=\"string\">&quot;hello.js&quot;</span>],</div><div class=\"line\">    <span class=\"string\">&quot;names&quot;</span>: [<span class=\"string\">&quot;sayHello&quot;</span>, <span class=\"string\">&quot;greeting&quot;</span>, <span class=\"string\">&quot;Name&quot;</span>, <span class=\"string\">&quot;console&quot;</span>, <span class=\"string\">&quot;log&quot;</span>],</div><div class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span>: <span class=\"string\">&quot;AAAA,QAASA,KAEL,GACIC,GAAW,UAAYC,IAC3BC,SAAQC,IAAIH,GAGhBD&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;file&quot;</span>: <span class=\"string\">&quot;hello.min.js&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;sourceRoot&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;sourcesContent&quot;</span>: [<span class=\"string\">&quot;function sayHello()\\n{\\n    var name = \\&quot;Fundebug\\&quot;;\\n    var greeting = \\&quot;Hello, \\&quot; + Name;\\n    console.log(greeting);\\n}\\n\\nsayHello();\\n&quot;</span>]</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x7531;<strong>hello.min.js.map</strong>&#x53EF;&#x77E5;&#xFF0C;Source Map&#x662F;&#x4E00;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x5B83;<strong>&#x5305;&#x542B;&#x4E86;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x524D;&#x540E;&#x7684;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;</strong>&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x8F6C;&#x6362;&#x4E4B;&#x540E;&#x7684;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Source Map&#x83B7;&#x53D6;&#x8F6C;&#x6362;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x4F4D;&#x7F6E;&#xFF0C;&#x53CD;&#x8FC7;&#x6765;&#x4E5F;&#x4E00;&#x6837;&#x3002;Source Map&#x5404;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x542B;&#x4E49;&#x5982;&#x4E0B;:</p>\n<ul>\n<li>version&#xFF1A;Source Map&#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;</li>\n<li>sources&#xFF1A;&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x3002;</li>\n<li>names&#xFF1A;&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x540D;&#x548C;&#x5C5E;&#x6027;&#x540D;&#x3002;</li>\n<li>mappings&#xFF1A;&#x8BB0;&#x5F55;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7ECF;&#x8FC7;&#x7F16;&#x7801;&#x3002;</li>\n<li>file&#xFF1A;(&#x53EF;&#x9009;)&#x8F6C;&#x6362;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;</li>\n<li>sourceRoot&#xFF1A;(&#x53EF;&#x9009;)&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x3002;&#x5982;&#x679C;&#x4E0E;&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5728;&#x540C;&#x4E00;&#x76EE;&#x5F55;&#xFF0C;&#x8BE5;&#x9879;&#x4E3A;&#x7A7A;&#x3002;</li>\n<li>sourcesContent:(&#x53EF;&#x9009;)&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5217;&#x8868;&#xFF0C;&#x4E0E;sources&#x5217;&#x8868;&#x4F9D;&#x6B21;&#x5BF9;&#x5E94;&#x3002;</li>\n</ul>\n<p>Source Map&#x771F;&#x6B63;&#x795E;&#x5947;&#x4E4B;&#x5904;&#x5728;&#x4E8E;mappings&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x8BB0;&#x5F55;&#x4E86;&#x4F4D;&#x7F6E;&#x662F;&#x5982;&#x4F55;&#x5BF9;&#x5E94;&#x7684;&#x3002;<a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\" target=\"_blank\" rel=\"external\">JavaScript Source Map &#x8BE6;&#x89E3;</a>&#x5DF2;&#x7ECF;&#x6709;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x3002;</p>\n<h3 id=\"&#x600E;&#x6837;&#x4F7F;&#x7528;Source-Map\"><a href=\"#&#x600E;&#x6837;&#x4F7F;&#x7528;Source-Map\" class=\"headerlink\" title=\"&#x600E;&#x6837;&#x4F7F;&#x7528;Source Map?\"></a>&#x600E;&#x6837;&#x4F7F;&#x7528;Source Map?</h3><p>&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x5747;&#x652F;&#x6301;Source Map&#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x8FC7;Chrome&#x4E0E;Firefox&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://gist.github.com/jakebellacera/336c4982194bcb02ef8a\" target=\"_blank\" rel=\"external\">How to enable source maps</a>&#x3002;&#x4E0B;&#x9762;&#x4EE5;MacBook&#x4E0A;&#x7684;Chrome&#x6D4F;&#x89C8;&#x5668;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;:</p>\n<h4 id=\"1-&#x5F00;&#x542F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;\"><a href=\"#1-&#x5F00;&#x542F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;\" class=\"headerlink\" title=\"1. &#x5F00;&#x542F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;\"></a>1. &#x5F00;&#x542F;<strong>&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;</strong></h4><p>&#x4F7F;&#x7528;&#x5FEB;&#x6377;&#x952E;<strong>option + command + i</strong>&#xFF1B;&#x6216;&#x8005;&#x5728;&#x83DC;&#x5355;&#x680F;&#x9009;&#x62E9;<strong>&#x89C6;&#x56FE;-&gt;&#x5F00;&#x53D1;&#x8005;-&gt;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;</strong></p>\n<div style=\"text-align: left;\"><br><img style=\"width:40%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap1.png\"><br></div>\n\n<h4 id=\"2-&#x6253;&#x5F00;&#x8BBE;&#x7F6E;\"><a href=\"#2-&#x6253;&#x5F00;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"2. &#x6253;&#x5F00;&#x8BBE;&#x7F6E;\"></a>2. &#x6253;&#x5F00;&#x8BBE;&#x7F6E;</h4><p>&#x4F7F;&#x7528;&#x5FEB;&#x6377;&#x952E;<strong>fn + F1</strong>&#xFF1B;&#x6216;&#x8005;&#x70B9;&#x51FB;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x4E09;&#x4E2A;&#x70B9;&#x7684;&#x56FE;&#x6807;&#xFF0C;&#x9009;&#x62E9;Settings</p>\n<div style=\"text-align: left;\"><br><img style=\"width:20%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap2.png\"><br></div>\n\n\n<h4 id=\"3-&#x5F00;&#x542F;Source-Map\"><a href=\"#3-&#x5F00;&#x542F;Source-Map\" class=\"headerlink\" title=\"3. &#x5F00;&#x542F;Source Map\"></a>3. &#x5F00;&#x542F;Source Map</h4><p>&#x5728;Sources&#x4E2D;&#xFF0C;&#x9009;&#x4E2D;<strong>Enable JavaScript source maps</strong></p>\n<div style=\"text-align: left;\"><br><img style=\"width:30%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap3.png\"><br></div>\n\n<p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;HTML&#x6587;&#x4EF6;<strong>hello.min.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;hello.min.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Chrome&#x6253;&#x5F00;<strong>hello.min.html</strong>&#xFF0C;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x770B;&#x5230;&#x7684;&#x9519;&#x8BEF;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Uncaught <span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">    at o (hello.min.js:<span class=\"number\">1</span>)</div><div class=\"line\">    at hello.min.js:<span class=\"number\">1</span></div></pre></td></tr></table></figure>\n<p>&#x62A5;&#x9519;&#x7684;&#x6587;&#x4EF6;&#x4ECD;&#x7136;&#x4E3A;<strong>hello.min.js</strong>&#xFF0C;&#x9700;&#x8981;&#x5237;&#x65B0;&#x4E00;&#x4E0B;Source Map&#x624D;&#x6709;&#x4F5C;&#x7528;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Uncaught <span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">    at o (hello.js:<span class=\"number\">4</span>)</div><div class=\"line\">    at hello.js:<span class=\"number\">8</span></div></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#xFF0C;Chrome&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x6CA1;&#x6709;&#x5217;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;4&#x4E3A;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x53F7;&#x3002;Chrome&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Source Map&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x6839;&#x636E;Source Map&#x7684;sourcesContent&#x8FD8;&#x539F;&#x51FA;&#x9519;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x3002;&#x70B9;&#x51FB;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x53EF;&#x8DF3;&#x8F6C;&#x5230;&#x6E90;&#x7801;&#xFF0C;&#x8FD9;&#x6837;Debug&#x5C06;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:40%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap4.png\"><br></div>\n\n\n<h4 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h4><ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\" target=\"_blank\" rel=\"external\">JavaScript Source Map &#x8BE6;&#x89E3;</a></li>\n<li><a href=\"https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit\" target=\"_blank\" rel=\"external\">Source Map Revision 3 Proposal</a></li>\n<li><a href=\"https://gist.github.com/jakebellacera/336c4982194bcb02ef8a\" target=\"_blank\" rel=\"external\">How to enable source maps</a></li>\n</ul>\n","excerpt":"<p>&#x90E8;&#x7F72;&#x524D;&#x7AEF;&#x4E4B;&#x524D;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x901A;&#x5E38;&#x4F1A;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6253;&#x5305;&#x538B;&#x7F29;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4EE3;&#x7801;&#x5927;&#x5C0F;&#xFF0C;&#x4ECE;&#x800C;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5F88;&#x96BE;Debug&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x884C;&#x53F7;&#x548C;&#x5217;&#x53F7;&#x5DF2;&#x7ECF;&#x5931;&#x771F;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;Source Map&#x6765;&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#x4E86;&#x3002;</p>","more":"<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/03/13/sourcemap-tutorial/fundebug-sourcemap.jpg\"><br></div>\n\n<h3 id=\"&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;</h3><p>&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x901A;&#x5E38;&#x4F1A;&#x4F7F;&#x7528;<a href=\"https://github.com/webpack/webpack\">webpack</a>&#x3001;<a href=\"https://github.com/mishoo/UglifyJS2\">UglifyJS2</a>&#x7B49;&#x5DE5;&#x5177;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x6253;&#x5305;&#x53D8;&#x6362;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4EE3;&#x7801;&#x5927;&#x5C0F;&#xFF0C;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;&#x5173;&#x4E8E;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x59A8;&#x5F15;&#x7528;&#x4E00;&#x4E0B;&#x5927;&#x795E;<a href=\"http://www.ruanyifeng.com/blog/\">&#x962E;&#x4E00;&#x5CF0;</a>&#x7684;<a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\">JavaScript Source Map &#x8BE6;&#x89E3;</a>:</p>\n<blockquote>\n<ul>\n<li>&#x538B;&#x7F29;&#xFF0C;&#x51CF;&#x5C0F;&#x4F53;&#x79EF;&#x3002;&#x6BD4;&#x5982;jQuery 1.9&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x538B;&#x7F29;&#x524D;&#x662F;252KB&#xFF0C;&#x538B;&#x7F29;&#x540E;&#x662F;32KB&#x3002;</li>\n<li>&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x5408;&#x5E76;&#xFF0C;&#x51CF;&#x5C11;HTTP&#x8BF7;&#x6C42;&#x6570;&#x3002;</li>\n<li>&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x7F16;&#x8BD1;&#x6210;JavaScript&#x3002;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;CoffeeScript&#x3002;</li>\n</ul>\n</blockquote>\n<h3 id=\"&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"><a href=\"#&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;\"></a>&#x5982;&#x4F55;&#x53D8;&#x6362;&#x4EE3;&#x7801;&#xFF1F;</h3><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x201C;hello World&#x201D;&#x7A0B;&#x5E8F;<strong>hello.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHello</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> name = <span class=\"string\">&quot;Fundebug&quot;</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> greeting = <span class=\"string\">&quot;Hello, &quot;</span> + Name;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(greeting);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">sayHello();</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<a href=\"https://github.com/mishoo/UglifyJS2\">UglifyJS2</a>&#x5BF9;&#x6E90;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x53D8;&#x6362;:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">uglifyjs hello.js \\</div><div class=\"line\">         -m toplevel=<span class=\"literal\">true</span> \\</div><div class=\"line\">         -c unused=<span class=\"literal\">true</span>,collapse_vars=<span class=\"literal\">true</span> \\</div><div class=\"line\">         -o hello.min.js</div></pre></td></tr></table></figure>\n<p>&#x538B;&#x7F29;&#x540E;&#x7684;&#x4EE3;&#x7801;<strong>hello.min.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>)</span>{<span class=\"keyword\">var</span> o=<span class=\"string\">&quot;Hello, &quot;</span>+Name;<span class=\"built_in\">console</span>.log(o)}o();</div></pre></td></tr></table></figure>\n<h3 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;Source-Map\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;Source-Map\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;Source Map?\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;Source Map?</h3><p>&#x4F7F;&#x7528;Firefox&#x6267;&#x884C;<strong>hello.js</strong>&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x8FD9;&#x6837;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">\tsayHello file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.js:4:9</span></div><div class=\"line\">\t&lt;&#x533F;&#x540D;&gt; file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.js:8:1</span></div></pre></td></tr></table></figure>\n<p>&#x800C;<strong>hello.min.js</strong>&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x8FD9;&#x6837;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">\to file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.min.js:1:18</span></div><div class=\"line\">\t&lt;&#x533F;&#x540D;&gt; file:<span class=\"comment\">///Users/fundebug/sourcemap-tutorial/hello.min.js:1:59</span></div></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x6BD4;&#x538B;&#x7F29;&#x524D;&#x540E;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x9519;&#x8BEF;&#x884C;&#x53F7;&#x548C;&#x5217;&#x53F7;&#x5DF2;&#x7ECF;&#x5931;&#x771F;&#xFF0C;&#x4E14;&#x51FD;&#x6570;&#x540D;&#x4E5F;&#x7ECF;&#x8FC7;&#x4E86;&#x53D8;&#x6362;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x771F;&#x5B9E;&#x7684;&#x524D;&#x7AEF;&#x9879;&#x76EE;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4F1A;&#x5C06;&#x6570;&#x5341;&#x4E2A;&#x6E90;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x4E3A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x65F6;&#xFF0C;&#x9519;&#x8BEF;&#x7684;&#x5217;&#x53F7;&#x53EF;&#x80FD;&#x591A;&#x8FBE;&#x6570;&#x5343;&#xFF0C;&#x4E14;&#x51FA;&#x9519;&#x7684;&#x771F;&#x5B9E;&#x6587;&#x4EF6;&#x540D;&#x4E5F;&#x662F;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x662F;&#x5F88;&#x96BE;Debug&#x7684;&#x3002;</p>\n<p><strong>&#x800C;Source Map&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;</strong>&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x5FEB;&#x7684;Debug&#x3002;</p>\n<h3 id=\"&#x4EC0;&#x4E48;&#x662F;Source-Map\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;Source-Map\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;Source Map?\"></a>&#x4EC0;&#x4E48;&#x662F;Source Map?</h3><p>&#x4F7F;&#x7528;<a href=\"https://github.com/mishoo/UglifyJS2\">UglifyJS2</a>&#x65F6;&#x6307;&#x5B9A;source-map&#x9009;&#x9879;&#x5373;&#x53EF;&#x751F;&#x6210;Source Map:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><div class=\"line\">uglifyjs hello.js \\</div><div class=\"line\">         -m toplevel=<span class=\"literal\">true</span> \\</div><div class=\"line\">         -c unused=<span class=\"literal\">true</span>,collapse_vars=<span class=\"literal\">true</span> \\</div><div class=\"line\">         --source-map hello.min.js.map \\</div><div class=\"line\">         --source-map-include-sources \\</div><div class=\"line\">         --source-map-root \\</div><div class=\"line\">         -o hello.min.js</div></pre></td></tr></table></figure>\n<p>&#x5404;&#x79CD;&#x4E3B;&#x6D41;&#x524D;&#x7AEF;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#xFF0C;&#x6253;&#x5305;&#x5DE5;&#x5177;&#x90FD;&#x652F;&#x6301;&#x751F;&#x6210;Source Map&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/javascript/sourcemap/generate/\">&#x751F;&#x6210;Source Map - Fundebug&#x6587;&#x6863;</a>&#x3002;</p>\n<p>&#x751F;&#x6210;&#x7684;<strong>hello.min.js</strong>&#x591A;&#x4E86;sourceMappingURL&#xFF0C;&#x8868;&#x793A;Source Map&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">o</span>(<span class=\"params\"></span>)</span>{<span class=\"keyword\">var</span> o=<span class=\"string\">&quot;Hello, &quot;</span>+Name;<span class=\"built_in\">console</span>.log(o)}o();</div><div class=\"line\"><span class=\"comment\">//# sourceMappingURL=hello.min.js.map</span></div></pre></td></tr></table></figure>\n<p>&#x751F;&#x6210;&#x7684;Source Map&#x4E3A;<strong>hello.min.js.map</strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">{</div><div class=\"line\">    <span class=\"string\">&quot;version&quot;</span>: <span class=\"number\">3</span>,</div><div class=\"line\">    <span class=\"string\">&quot;sources&quot;</span>: [<span class=\"string\">&quot;hello.js&quot;</span>],</div><div class=\"line\">    <span class=\"string\">&quot;names&quot;</span>: [<span class=\"string\">&quot;sayHello&quot;</span>, <span class=\"string\">&quot;greeting&quot;</span>, <span class=\"string\">&quot;Name&quot;</span>, <span class=\"string\">&quot;console&quot;</span>, <span class=\"string\">&quot;log&quot;</span>],</div><div class=\"line\">    <span class=\"string\">&quot;mappings&quot;</span>: <span class=\"string\">&quot;AAAA,QAASA,KAEL,GACIC,GAAW,UAAYC,IAC3BC,SAAQC,IAAIH,GAGhBD&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;file&quot;</span>: <span class=\"string\">&quot;hello.min.js&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;sourceRoot&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</div><div class=\"line\">    <span class=\"string\">&quot;sourcesContent&quot;</span>: [<span class=\"string\">&quot;function sayHello()\\n{\\n    var name = \\&quot;Fundebug\\&quot;;\\n    var greeting = \\&quot;Hello, \\&quot; + Name;\\n    console.log(greeting);\\n}\\n\\nsayHello();\\n&quot;</span>]</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x7531;<strong>hello.min.js.map</strong>&#x53EF;&#x77E5;&#xFF0C;Source Map&#x662F;&#x4E00;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x5B83;<strong>&#x5305;&#x542B;&#x4E86;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x524D;&#x540E;&#x7684;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;</strong>&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x8F6C;&#x6362;&#x4E4B;&#x540E;&#x7684;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Source Map&#x83B7;&#x53D6;&#x8F6C;&#x6362;&#x4E4B;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x4F4D;&#x7F6E;&#xFF0C;&#x53CD;&#x8FC7;&#x6765;&#x4E5F;&#x4E00;&#x6837;&#x3002;Source Map&#x5404;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x542B;&#x4E49;&#x5982;&#x4E0B;:</p>\n<ul>\n<li>version&#xFF1A;Source Map&#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;</li>\n<li>sources&#xFF1A;&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x3002;</li>\n<li>names&#xFF1A;&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x540D;&#x548C;&#x5C5E;&#x6027;&#x540D;&#x3002;</li>\n<li>mappings&#xFF1A;&#x8BB0;&#x5F55;&#x4F4D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7ECF;&#x8FC7;&#x7F16;&#x7801;&#x3002;</li>\n<li>file&#xFF1A;(&#x53EF;&#x9009;)&#x8F6C;&#x6362;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;</li>\n<li>sourceRoot&#xFF1A;(&#x53EF;&#x9009;)&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x3002;&#x5982;&#x679C;&#x4E0E;&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5728;&#x540C;&#x4E00;&#x76EE;&#x5F55;&#xFF0C;&#x8BE5;&#x9879;&#x4E3A;&#x7A7A;&#x3002;</li>\n<li>sourcesContent:(&#x53EF;&#x9009;)&#x8F6C;&#x6362;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5217;&#x8868;&#xFF0C;&#x4E0E;sources&#x5217;&#x8868;&#x4F9D;&#x6B21;&#x5BF9;&#x5E94;&#x3002;</li>\n</ul>\n<p>Source Map&#x771F;&#x6B63;&#x795E;&#x5947;&#x4E4B;&#x5904;&#x5728;&#x4E8E;mappings&#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x8BB0;&#x5F55;&#x4E86;&#x4F4D;&#x7F6E;&#x662F;&#x5982;&#x4F55;&#x5BF9;&#x5E94;&#x7684;&#x3002;<a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\">JavaScript Source Map &#x8BE6;&#x89E3;</a>&#x5DF2;&#x7ECF;&#x6709;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x3002;</p>\n<h3 id=\"&#x600E;&#x6837;&#x4F7F;&#x7528;Source-Map\"><a href=\"#&#x600E;&#x6837;&#x4F7F;&#x7528;Source-Map\" class=\"headerlink\" title=\"&#x600E;&#x6837;&#x4F7F;&#x7528;Source Map?\"></a>&#x600E;&#x6837;&#x4F7F;&#x7528;Source Map?</h3><p>&#x4E3B;&#x6D41;&#x6D4F;&#x89C8;&#x5668;&#x5747;&#x652F;&#x6301;Source Map&#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x8FC7;Chrome&#x4E0E;Firefox&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x53C2;&#x8003;<a href=\"https://gist.github.com/jakebellacera/336c4982194bcb02ef8a\">How to enable source maps</a>&#x3002;&#x4E0B;&#x9762;&#x4EE5;MacBook&#x4E0A;&#x7684;Chrome&#x6D4F;&#x89C8;&#x5668;&#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;:</p>\n<h4 id=\"1-&#x5F00;&#x542F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;\"><a href=\"#1-&#x5F00;&#x542F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;\" class=\"headerlink\" title=\"1. &#x5F00;&#x542F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;\"></a>1. &#x5F00;&#x542F;<strong>&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;</strong></h4><p>&#x4F7F;&#x7528;&#x5FEB;&#x6377;&#x952E;<strong>option + command + i</strong>&#xFF1B;&#x6216;&#x8005;&#x5728;&#x83DC;&#x5355;&#x680F;&#x9009;&#x62E9;<strong>&#x89C6;&#x56FE;-&gt;&#x5F00;&#x53D1;&#x8005;-&gt;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;</strong></p>\n<div style=\"text-align: left;\"><br><img style=\"width:40%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap1.png\"><br></div>\n\n<h4 id=\"2-&#x6253;&#x5F00;&#x8BBE;&#x7F6E;\"><a href=\"#2-&#x6253;&#x5F00;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"2. &#x6253;&#x5F00;&#x8BBE;&#x7F6E;\"></a>2. &#x6253;&#x5F00;&#x8BBE;&#x7F6E;</h4><p>&#x4F7F;&#x7528;&#x5FEB;&#x6377;&#x952E;<strong>fn + F1</strong>&#xFF1B;&#x6216;&#x8005;&#x70B9;&#x51FB;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x4E09;&#x4E2A;&#x70B9;&#x7684;&#x56FE;&#x6807;&#xFF0C;&#x9009;&#x62E9;Settings</p>\n<div style=\"text-align: left;\"><br><img style=\"width:20%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap2.png\"><br></div>\n\n\n<h4 id=\"3-&#x5F00;&#x542F;Source-Map\"><a href=\"#3-&#x5F00;&#x542F;Source-Map\" class=\"headerlink\" title=\"3. &#x5F00;&#x542F;Source Map\"></a>3. &#x5F00;&#x542F;Source Map</h4><p>&#x5728;Sources&#x4E2D;&#xFF0C;&#x9009;&#x4E2D;<strong>Enable JavaScript source maps</strong></p>\n<div style=\"text-align: left;\"><br><img style=\"width:30%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap3.png\"><br></div>\n\n<p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;HTML&#x6587;&#x4EF6;<strong>hello.min.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;hello.min.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Chrome&#x6253;&#x5F00;<strong>hello.min.html</strong>&#xFF0C;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x770B;&#x5230;&#x7684;&#x9519;&#x8BEF;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Uncaught <span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">    at o (hello.min.js:<span class=\"number\">1</span>)</div><div class=\"line\">    at hello.min.js:<span class=\"number\">1</span></div></pre></td></tr></table></figure>\n<p>&#x62A5;&#x9519;&#x7684;&#x6587;&#x4EF6;&#x4ECD;&#x7136;&#x4E3A;<strong>hello.min.js</strong>&#xFF0C;&#x9700;&#x8981;&#x5237;&#x65B0;&#x4E00;&#x4E0B;Source Map&#x624D;&#x6709;&#x4F5C;&#x7528;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Uncaught <span class=\"built_in\">ReferenceError</span>: Name is not defined</div><div class=\"line\">    at o (hello.js:<span class=\"number\">4</span>)</div><div class=\"line\">    at hello.js:<span class=\"number\">8</span></div></pre></td></tr></table></figure>\n<p>&#x6CE8;&#x610F;&#xFF0C;Chrome&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x6CA1;&#x6709;&#x5217;&#x53F7;&#xFF0C;&#x56E0;&#x6B64;4&#x4E3A;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x53F7;&#x3002;Chrome&#x4E0D;&#x4EC5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Source Map&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x6839;&#x636E;Source Map&#x7684;sourcesContent&#x8FD8;&#x539F;&#x51FA;&#x9519;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x3002;&#x70B9;&#x51FB;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x53EF;&#x8DF3;&#x8F6C;&#x5230;&#x6E90;&#x7801;&#xFF0C;&#x8FD9;&#x6837;Debug&#x5C06;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:40%;\" src=\"/2017/03/13/sourcemap-tutorial/chrome-sourcemap4.png\"><br></div>\n\n\n<h4 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h4><ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html\">JavaScript Source Map &#x8BE6;&#x89E3;</a></li>\n<li><a href=\"https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit\">Source Map Revision 3 Proposal</a></li>\n<li><a href=\"https://gist.github.com/jakebellacera/336c4982194bcb02ef8a\">How to enable source maps</a></li>\n</ul>"},{"title":"Fundebug上线Node.js错误监控啦","date":"2017-03-17T02:00:00.000Z","_content":"\n\n作为全栈JavaScript错误实时监测平台，[Fundebug](https://fundebug.com/)的**Node.js实时错误监测服务**上线啦，我们能够帮助开发者及时，高效地发现并且解决Node.js错误，从而提高开发效率，并提升用户体验。\n\n<!-- more -->\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-nodejs/fundebug-nodejs.png\" />\n</div>\n\n\n#### Fundebug为什么监测Node.js？\n\n程序员通常是比较自信的，他们坚持**自己写的代码没有问题**。然而，再追问一下自己：\n\n- 我的代码真的100%没有问题吗？\n- 我做了完整的单元测试吗？\n- 难道我要花更多的时间没完没了的写单元测试？\n\n**那么问题在哪？**\n\n- 当Node.js后台程序在服务器上出错了，然而开发者并不知道；\n- 在动辄上百MB的文本日志中分析错误，显然是非常低效的；\n- 错误日志收集的不规范也不完整，开发者无从下手；\n\n#### 为什么是Fundebug？\n\n * 两行代码搞定；\n * 插件仅4KB，且不依赖任何模块\n * 自动捕获未处理的错误；\n * 支持收集try/catch捕获的错误；\n * 兼容所有后端开发框架，例如[Express](https://docs.fundebug.com/notifier/nodejs/framework/express.html)、[Koa](https://docs.fundebug.com/notifier/nodejs/framework/koa.html)、[Hapi](https://docs.fundebug.com/notifier/nodejs/framework/hapi.html)等；\n\n#### 如何使用Fundebug?\n\n##### 1. 安装[fundebug-ndoejs](https://www.npmjs.com/package/fundebug-nodejs)模块\n\n```bash\nnpm install fundebug-nodejs\n```\n\n若国外的NPM速度太慢的话，可以使用[淘宝NPM镜像](https://npm.taobao.org/)安装:\n\n```bash\nnpm install fundebug-nodejs --registry=https://registry.npm.taobao.org\n```\n\n##### 2. 导入fundebug并配置apikey:\n\n```js\nvar fundebug=require(\"fundebug-nodejs\");\nfundebug.apikey=\"YOUR-APIKEY\"\n```\n\n- 其中，获取**apikey**需要[免费注册](https://fundebug.com/team/create)帐号并且[创建项目](https://fundebug.com/project/create)。\n\n##### 3. 后端框架个性化配置:\n\n**监测[Express](http://expressjs.com/zh-cn/)**\n\n```js\napp.use(fundebug.ExpressErrorHandler);\n```\n\n**监测[Koa](http://koajs.com/)**\n\n```js\napp.on(\"error\", fundebug.KoaErrorHandler);\n```\n\n**监测[Hapi](https://hapijs.com/)**\n\n```js\nserver.on(\"request-error\", fundebug.HapiErrorHandler);\nserver.on(\"response\", fundebug.HapiErrorHandler);\n```\n\n具体步骤请查看[Fundebug文档 - Node.js](https://docs.fundebug.com/notifier/nodejs/)\n\n\n\n\n\n\n\n","source":"_posts/2017/03/17/fundebug-support-nodejs.md","raw":"---\n\ntitle: Fundebug上线Node.js错误监控啦\n\ndate: 2017-03-17 10:00:00\n\ntags: [Node.js]\n\n---\n\n\n作为全栈JavaScript错误实时监测平台，[Fundebug](https://fundebug.com/)的**Node.js实时错误监测服务**上线啦，我们能够帮助开发者及时，高效地发现并且解决Node.js错误，从而提高开发效率，并提升用户体验。\n\n<!-- more -->\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"fundebug-support-nodejs/fundebug-nodejs.png\" />\n</div>\n\n\n#### Fundebug为什么监测Node.js？\n\n程序员通常是比较自信的，他们坚持**自己写的代码没有问题**。然而，再追问一下自己：\n\n- 我的代码真的100%没有问题吗？\n- 我做了完整的单元测试吗？\n- 难道我要花更多的时间没完没了的写单元测试？\n\n**那么问题在哪？**\n\n- 当Node.js后台程序在服务器上出错了，然而开发者并不知道；\n- 在动辄上百MB的文本日志中分析错误，显然是非常低效的；\n- 错误日志收集的不规范也不完整，开发者无从下手；\n\n#### 为什么是Fundebug？\n\n * 两行代码搞定；\n * 插件仅4KB，且不依赖任何模块\n * 自动捕获未处理的错误；\n * 支持收集try/catch捕获的错误；\n * 兼容所有后端开发框架，例如[Express](https://docs.fundebug.com/notifier/nodejs/framework/express.html)、[Koa](https://docs.fundebug.com/notifier/nodejs/framework/koa.html)、[Hapi](https://docs.fundebug.com/notifier/nodejs/framework/hapi.html)等；\n\n#### 如何使用Fundebug?\n\n##### 1. 安装[fundebug-ndoejs](https://www.npmjs.com/package/fundebug-nodejs)模块\n\n```bash\nnpm install fundebug-nodejs\n```\n\n若国外的NPM速度太慢的话，可以使用[淘宝NPM镜像](https://npm.taobao.org/)安装:\n\n```bash\nnpm install fundebug-nodejs --registry=https://registry.npm.taobao.org\n```\n\n##### 2. 导入fundebug并配置apikey:\n\n```js\nvar fundebug=require(\"fundebug-nodejs\");\nfundebug.apikey=\"YOUR-APIKEY\"\n```\n\n- 其中，获取**apikey**需要[免费注册](https://fundebug.com/team/create)帐号并且[创建项目](https://fundebug.com/project/create)。\n\n##### 3. 后端框架个性化配置:\n\n**监测[Express](http://expressjs.com/zh-cn/)**\n\n```js\napp.use(fundebug.ExpressErrorHandler);\n```\n\n**监测[Koa](http://koajs.com/)**\n\n```js\napp.on(\"error\", fundebug.KoaErrorHandler);\n```\n\n**监测[Hapi](https://hapijs.com/)**\n\n```js\nserver.on(\"request-error\", fundebug.HapiErrorHandler);\nserver.on(\"response\", fundebug.HapiErrorHandler);\n```\n\n具体步骤请查看[Fundebug文档 - Node.js](https://docs.fundebug.com/notifier/nodejs/)\n\n\n\n\n\n\n\n","slug":"2017/03/17/fundebug-support-nodejs","published":1,"updated":"2017-03-18T11:52:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywena001bmkfy2jm8umh4","content":"<p>&#x4F5C;&#x4E3A;&#x5168;&#x6808;JavaScript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;<strong>Node.js&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x670D;&#x52A1;</strong>&#x4E0A;&#x7EBF;&#x5566;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x53CA;&#x65F6;&#xFF0C;&#x9AD8;&#x6548;&#x5730;&#x53D1;&#x73B0;&#x5E76;&#x4E14;&#x89E3;&#x51B3;Node.js&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF0C;&#x5E76;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>\n<a id=\"more\"></a>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/17/fundebug-support-nodejs/fundebug-nodejs.png\"><br></div>\n\n\n<h4 id=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node-js&#xFF1F;\"><a href=\"#Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node-js&#xFF1F;\" class=\"headerlink\" title=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node.js&#xFF1F;\"></a>Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node.js&#xFF1F;</h4><p>&#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x662F;&#x6BD4;&#x8F83;&#x81EA;&#x4FE1;&#x7684;&#xFF0C;&#x4ED6;&#x4EEC;&#x575A;&#x6301;<strong>&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x95EE;&#x9898;</strong>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x518D;&#x8FFD;&#x95EE;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#xFF1A;</p>\n<ul>\n<li>&#x6211;&#x7684;&#x4EE3;&#x7801;&#x771F;&#x7684;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x5417;&#xFF1F;</li>\n<li>&#x6211;&#x505A;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x5417;&#xFF1F;</li>\n<li>&#x96BE;&#x9053;&#x6211;&#x8981;&#x82B1;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x7684;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</li>\n</ul>\n<p><strong>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5728;&#x54EA;&#xFF1F;</strong></p>\n<ul>\n<li>&#x5F53;Node.js&#x540E;&#x53F0;&#x7A0B;&#x5E8F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#xFF1B;</li>\n<li>&#x5728;&#x52A8;&#x8F84;&#x4E0A;&#x767E;MB&#x7684;&#x6587;&#x672C;&#x65E5;&#x5FD7;&#x4E2D;&#x5206;&#x6790;&#x9519;&#x8BEF;&#xFF0C;&#x663E;&#x7136;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x6548;&#x7684;&#xFF1B;</li>\n<li>&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7684;&#x4E0D;&#x89C4;&#x8303;&#x4E5F;&#x4E0D;&#x5B8C;&#x6574;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;</h4><ul>\n<li>&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x641E;&#x5B9A;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;4KB&#xFF0C;&#x4E14;&#x4E0D;&#x4F9D;&#x8D56;&#x4EFB;&#x4F55;&#x6A21;&#x5757;</li>\n<li>&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x672A;&#x5904;&#x7406;&#x7684;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x652F;&#x6301;&#x6536;&#x96C6;try/catch&#x6355;&#x83B7;&#x7684;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x517C;&#x5BB9;&#x6240;&#x6709;&#x540E;&#x7AEF;&#x5F00;&#x53D1;&#x6846;&#x67B6;&#xFF0C;&#x4F8B;&#x5982;<a href=\"https://docs.fundebug.com/notifier/nodejs/framework/express.html\" target=\"_blank\" rel=\"external\">Express</a>&#x3001;<a href=\"https://docs.fundebug.com/notifier/nodejs/framework/koa.html\" target=\"_blank\" rel=\"external\">Koa</a>&#x3001;<a href=\"https://docs.fundebug.com/notifier/nodejs/framework/hapi.html\" target=\"_blank\" rel=\"external\">Hapi</a>&#x7B49;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\"><a href=\"#&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?\"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?</h4><h5 id=\"1-&#x5B89;&#x88C5;fundebug-ndoejs&#x6A21;&#x5757;\"><a href=\"#1-&#x5B89;&#x88C5;fundebug-ndoejs&#x6A21;&#x5757;\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;fundebug-ndoejs&#x6A21;&#x5757;\"></a>1. &#x5B89;&#x88C5;<a href=\"https://www.npmjs.com/package/fundebug-nodejs\" target=\"_blank\" rel=\"external\">fundebug-ndoejs</a>&#x6A21;&#x5757;</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">npm install fundebug-nodejs</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x56FD;&#x5916;&#x7684;NPM&#x901F;&#x5EA6;&#x592A;&#x6162;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://npm.taobao.org/\" target=\"_blank\" rel=\"external\">&#x6DD8;&#x5B9D;NPM&#x955C;&#x50CF;</a>&#x5B89;&#x88C5;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">npm install fundebug-nodejs --registry=https://registry.npm.taobao.org</div></pre></td></tr></table></figure>\n<h5 id=\"2-&#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\"><a href=\"#2-&#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\" class=\"headerlink\" title=\"2. &#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:\"></a>2. &#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fundebug=<span class=\"built_in\">require</span>(<span class=\"string\">&quot;fundebug-nodejs&quot;</span>);</div><div class=\"line\">fundebug.apikey=<span class=\"string\">&quot;YOUR-APIKEY&quot;</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x5176;&#x4E2D;&#xFF0C;&#x83B7;&#x53D6;<strong>apikey</strong>&#x9700;&#x8981;<a href=\"https://fundebug.com/team/create\" target=\"_blank\" rel=\"external\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5E10;&#x53F7;&#x5E76;&#x4E14;<a href=\"https://fundebug.com/project/create\" target=\"_blank\" rel=\"external\">&#x521B;&#x5EFA;&#x9879;&#x76EE;</a>&#x3002;</li>\n</ul>\n<h5 id=\"3-&#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;\"><a href=\"#3-&#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"3. &#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;:\"></a>3. &#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;:</h5><p><strong>&#x76D1;&#x6D4B;<a href=\"http://expressjs.com/zh-cn/\" target=\"_blank\" rel=\"external\">Express</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">app.use(fundebug.ExpressErrorHandler);</div></pre></td></tr></table></figure>\n<p><strong>&#x76D1;&#x6D4B;<a href=\"http://koajs.com/\" target=\"_blank\" rel=\"external\">Koa</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">app.on(<span class=\"string\">&quot;error&quot;</span>, fundebug.KoaErrorHandler);</div></pre></td></tr></table></figure>\n<p><strong>&#x76D1;&#x6D4B;<a href=\"https://hapijs.com/\" target=\"_blank\" rel=\"external\">Hapi</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">server.on(<span class=\"string\">&quot;request-error&quot;</span>, fundebug.HapiErrorHandler);</div><div class=\"line\">server.on(<span class=\"string\">&quot;response&quot;</span>, fundebug.HapiErrorHandler);</div></pre></td></tr></table></figure>\n<p>&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/nodejs/\" target=\"_blank\" rel=\"external\">Fundebug&#x6587;&#x6863; - Node.js</a></p>\n","excerpt":"<p>&#x4F5C;&#x4E3A;&#x5168;&#x6808;JavaScript&#x9519;&#x8BEF;&#x5B9E;&#x65F6;&#x76D1;&#x6D4B;&#x5E73;&#x53F0;&#xFF0C;<a href=\"https://fundebug.com/\">Fundebug</a>&#x7684;<strong>Node.js&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x670D;&#x52A1;</strong>&#x4E0A;&#x7EBF;&#x5566;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x53CA;&#x65F6;&#xFF0C;&#x9AD8;&#x6548;&#x5730;&#x53D1;&#x73B0;&#x5E76;&#x4E14;&#x89E3;&#x51B3;Node.js&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF0C;&#x5E76;&#x63D0;&#x5347;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>","more":"<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/17/fundebug-support-nodejs/fundebug-nodejs.png\"><br></div>\n\n\n<h4 id=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node-js&#xFF1F;\"><a href=\"#Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node-js&#xFF1F;\" class=\"headerlink\" title=\"Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node.js&#xFF1F;\"></a>Fundebug&#x4E3A;&#x4EC0;&#x4E48;&#x76D1;&#x6D4B;Node.js&#xFF1F;</h4><p>&#x7A0B;&#x5E8F;&#x5458;&#x901A;&#x5E38;&#x662F;&#x6BD4;&#x8F83;&#x81EA;&#x4FE1;&#x7684;&#xFF0C;&#x4ED6;&#x4EEC;&#x575A;&#x6301;<strong>&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x95EE;&#x9898;</strong>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x518D;&#x8FFD;&#x95EE;&#x4E00;&#x4E0B;&#x81EA;&#x5DF1;&#xFF1A;</p>\n<ul>\n<li>&#x6211;&#x7684;&#x4EE3;&#x7801;&#x771F;&#x7684;100%&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x5417;&#xFF1F;</li>\n<li>&#x6211;&#x505A;&#x4E86;&#x5B8C;&#x6574;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x5417;&#xFF1F;</li>\n<li>&#x96BE;&#x9053;&#x6211;&#x8981;&#x82B1;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x7684;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</li>\n</ul>\n<p><strong>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x5728;&#x54EA;&#xFF1F;</strong></p>\n<ul>\n<li>&#x5F53;Node.js&#x540E;&#x53F0;&#x7A0B;&#x5E8F;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x51FA;&#x9519;&#x4E86;&#xFF0C;&#x7136;&#x800C;&#x5F00;&#x53D1;&#x8005;&#x5E76;&#x4E0D;&#x77E5;&#x9053;&#xFF1B;</li>\n<li>&#x5728;&#x52A8;&#x8F84;&#x4E0A;&#x767E;MB&#x7684;&#x6587;&#x672C;&#x65E5;&#x5FD7;&#x4E2D;&#x5206;&#x6790;&#x9519;&#x8BEF;&#xFF0C;&#x663E;&#x7136;&#x662F;&#x975E;&#x5E38;&#x4F4E;&#x6548;&#x7684;&#xFF1B;</li>\n<li>&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7684;&#x4E0D;&#x89C4;&#x8303;&#x4E5F;&#x4E0D;&#x5B8C;&#x6574;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x65E0;&#x4ECE;&#x4E0B;&#x624B;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x662F;Fundebug&#xFF1F;</h4><ul>\n<li>&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x641E;&#x5B9A;&#xFF1B;</li>\n<li>&#x63D2;&#x4EF6;&#x4EC5;4KB&#xFF0C;&#x4E14;&#x4E0D;&#x4F9D;&#x8D56;&#x4EFB;&#x4F55;&#x6A21;&#x5757;</li>\n<li>&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x672A;&#x5904;&#x7406;&#x7684;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x652F;&#x6301;&#x6536;&#x96C6;try/catch&#x6355;&#x83B7;&#x7684;&#x9519;&#x8BEF;&#xFF1B;</li>\n<li>&#x517C;&#x5BB9;&#x6240;&#x6709;&#x540E;&#x7AEF;&#x5F00;&#x53D1;&#x6846;&#x67B6;&#xFF0C;&#x4F8B;&#x5982;<a href=\"https://docs.fundebug.com/notifier/nodejs/framework/express.html\">Express</a>&#x3001;<a href=\"https://docs.fundebug.com/notifier/nodejs/framework/koa.html\">Koa</a>&#x3001;<a href=\"https://docs.fundebug.com/notifier/nodejs/framework/hapi.html\">Hapi</a>&#x7B49;&#xFF1B;</li>\n</ul>\n<h4 id=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\"><a href=\"#&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?\"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Fundebug?</h4><h5 id=\"1-&#x5B89;&#x88C5;fundebug-ndoejs&#x6A21;&#x5757;\"><a href=\"#1-&#x5B89;&#x88C5;fundebug-ndoejs&#x6A21;&#x5757;\" class=\"headerlink\" title=\"1. &#x5B89;&#x88C5;fundebug-ndoejs&#x6A21;&#x5757;\"></a>1. &#x5B89;&#x88C5;<a href=\"https://www.npmjs.com/package/fundebug-nodejs\">fundebug-ndoejs</a>&#x6A21;&#x5757;</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">npm install fundebug-nodejs</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x56FD;&#x5916;&#x7684;NPM&#x901F;&#x5EA6;&#x592A;&#x6162;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://npm.taobao.org/\">&#x6DD8;&#x5B9D;NPM&#x955C;&#x50CF;</a>&#x5B89;&#x88C5;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">npm install fundebug-nodejs --registry=https://registry.npm.taobao.org</div></pre></td></tr></table></figure>\n<h5 id=\"2-&#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\"><a href=\"#2-&#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey\" class=\"headerlink\" title=\"2. &#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:\"></a>2. &#x5BFC;&#x5165;fundebug&#x5E76;&#x914D;&#x7F6E;apikey:</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fundebug=<span class=\"built_in\">require</span>(<span class=\"string\">&quot;fundebug-nodejs&quot;</span>);</div><div class=\"line\">fundebug.apikey=<span class=\"string\">&quot;YOUR-APIKEY&quot;</span></div></pre></td></tr></table></figure>\n<ul>\n<li>&#x5176;&#x4E2D;&#xFF0C;&#x83B7;&#x53D6;<strong>apikey</strong>&#x9700;&#x8981;<a href=\"https://fundebug.com/team/create\">&#x514D;&#x8D39;&#x6CE8;&#x518C;</a>&#x5E10;&#x53F7;&#x5E76;&#x4E14;<a href=\"https://fundebug.com/project/create\">&#x521B;&#x5EFA;&#x9879;&#x76EE;</a>&#x3002;</li>\n</ul>\n<h5 id=\"3-&#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;\"><a href=\"#3-&#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"3. &#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;:\"></a>3. &#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E2A;&#x6027;&#x5316;&#x914D;&#x7F6E;:</h5><p><strong>&#x76D1;&#x6D4B;<a href=\"http://expressjs.com/zh-cn/\">Express</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">app.use(fundebug.ExpressErrorHandler);</div></pre></td></tr></table></figure>\n<p><strong>&#x76D1;&#x6D4B;<a href=\"http://koajs.com/\">Koa</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">app.on(<span class=\"string\">&quot;error&quot;</span>, fundebug.KoaErrorHandler);</div></pre></td></tr></table></figure>\n<p><strong>&#x76D1;&#x6D4B;<a href=\"https://hapijs.com/\">Hapi</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">server.on(<span class=\"string\">&quot;request-error&quot;</span>, fundebug.HapiErrorHandler);</div><div class=\"line\">server.on(<span class=\"string\">&quot;response&quot;</span>, fundebug.HapiErrorHandler);</div></pre></td></tr></table></figure>\n<p>&#x5177;&#x4F53;&#x6B65;&#x9AA4;&#x8BF7;&#x67E5;&#x770B;<a href=\"https://docs.fundebug.com/notifier/nodejs/\">Fundebug&#x6587;&#x6863; - Node.js</a></p>"},{"title":"Fundebug支持用户行为回溯","date":"2017-03-29T13:00:00.000Z","_content":"\n对于前端JavaScript的错误，Fundebug可以记录出错前的用户行为，比如**点击**、**页面跳转**、**网络请求**等，这些行为信息可以帮助您回溯错误出现的场景，从而更快地定位错误。\n\n<!-- more -->\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"user-behavior-track/fundebug-track-behavior.png\" />\n</div>\n\n### 为什么记录用户行为？\n\n一直以来，我们是从错误本身来帮助用户定位和分析错误的:\n\n- 抓取详细的错误信息，包括文件名，行列号，错误栈...\n- 兼容各种浏览器和框架\n- 使用机器学习算法对错误进行智能聚合\n- 通过Source Map还原真实的出错位置和出错代码\n\n一般来讲，这些也足够了，因为开发者对错误信息以及自己的代码通常比较熟悉。\n\n但是，错误本身的信息是不能直接给提供开发者一个**出错场景**，也就是说，开发者有时并不清楚**这个错误是什么情况下出现的**：\n\n- 用户点击了哪些按钮？\n- 用户访问哪些页面？\n- 用户发起了哪些网络请求?\n\n这些简单的行为信息往往可以帮助开发者从业务逻辑的角度理解出错的场景，从而快速定位错误。\n\n\n### 如何记录用户行为？\n\nFundebug专注与应用错误监控，因此**只会记录出错前的用户行为**，我们无意于监控所有用户行为。\n\n目前，Fundebug会记录这些用户行为:\n\n- 点击\n- 页面跳转\n- 网络请求\n\n我们收到的某个报错信息的**用户行为**如下:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"user-behavior-track/user-behavior-track.png\" />\n</div>\n\n可知，用户从主页跳转到控制台的时候出现了错误。\n\n如果需要记录其他行为的话，欢迎与我们联系。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/03/29/user-behavior-track.md","raw":"---\n\ntitle: Fundebug支持用户行为回溯\n\ndate: 2017-03-29 21:00:00\n\ntags: [Fundebug, JavaScript]\n\n---\n\n对于前端JavaScript的错误，Fundebug可以记录出错前的用户行为，比如**点击**、**页面跳转**、**网络请求**等，这些行为信息可以帮助您回溯错误出现的场景，从而更快地定位错误。\n\n<!-- more -->\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"user-behavior-track/fundebug-track-behavior.png\" />\n</div>\n\n### 为什么记录用户行为？\n\n一直以来，我们是从错误本身来帮助用户定位和分析错误的:\n\n- 抓取详细的错误信息，包括文件名，行列号，错误栈...\n- 兼容各种浏览器和框架\n- 使用机器学习算法对错误进行智能聚合\n- 通过Source Map还原真实的出错位置和出错代码\n\n一般来讲，这些也足够了，因为开发者对错误信息以及自己的代码通常比较熟悉。\n\n但是，错误本身的信息是不能直接给提供开发者一个**出错场景**，也就是说，开发者有时并不清楚**这个错误是什么情况下出现的**：\n\n- 用户点击了哪些按钮？\n- 用户访问哪些页面？\n- 用户发起了哪些网络请求?\n\n这些简单的行为信息往往可以帮助开发者从业务逻辑的角度理解出错的场景，从而快速定位错误。\n\n\n### 如何记录用户行为？\n\nFundebug专注与应用错误监控，因此**只会记录出错前的用户行为**，我们无意于监控所有用户行为。\n\n目前，Fundebug会记录这些用户行为:\n\n- 点击\n- 页面跳转\n- 网络请求\n\n我们收到的某个报错信息的**用户行为**如下:\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"user-behavior-track/user-behavior-track.png\" />\n</div>\n\n可知，用户从主页跳转到控制台的时候出现了错误。\n\n如果需要记录其他行为的话，欢迎与我们联系。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"2017/03/29/user-behavior-track","published":1,"updated":"2017-04-10T02:12:25.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywenc001dmkfykmpmcbk6","content":"<p>&#x5BF9;&#x4E8E;&#x524D;&#x7AEF;JavaScript&#x7684;&#x9519;&#x8BEF;&#xFF0C;Fundebug&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x51FA;&#x9519;&#x524D;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982;<strong>&#x70B9;&#x51FB;</strong>&#x3001;<strong>&#x9875;&#x9762;&#x8DF3;&#x8F6C;</strong>&#x3001;<strong>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</strong>&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x884C;&#x4E3A;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x56DE;&#x6EAF;&#x9519;&#x8BEF;&#x51FA;&#x73B0;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x5FEB;&#x5730;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<a id=\"more\"></a>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/03/29/user-behavior-track/fundebug-track-behavior.png\"><br></div>\n\n<h3 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;</h3><p>&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x4ECE;&#x9519;&#x8BEF;&#x672C;&#x8EAB;&#x6765;&#x5E2E;&#x52A9;&#x7528;&#x6237;&#x5B9A;&#x4F4D;&#x548C;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;:</p>\n<ul>\n<li>&#x6293;&#x53D6;&#x8BE6;&#x7EC6;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x884C;&#x5217;&#x53F7;&#xFF0C;&#x9519;&#x8BEF;&#x6808;&#x2026;</li>\n<li>&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x6846;&#x67B6;</li>\n<li>&#x4F7F;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x5BF9;&#x9519;&#x8BEF;&#x8FDB;&#x884C;&#x667A;&#x80FD;&#x805A;&#x5408;</li>\n<li>&#x901A;&#x8FC7;Source Map&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#x548C;&#x51FA;&#x9519;&#x4EE3;&#x7801;</li>\n</ul>\n<p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E5F;&#x8DB3;&#x591F;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x5BF9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x901A;&#x5E38;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x9519;&#x8BEF;&#x672C;&#x8EAB;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x7ED9;&#x63D0;&#x4F9B;&#x5F00;&#x53D1;&#x8005;&#x4E00;&#x4E2A;<strong>&#x51FA;&#x9519;&#x573A;&#x666F;</strong>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x6709;&#x65F6;&#x5E76;&#x4E0D;&#x6E05;&#x695A;<strong>&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x662F;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x51FA;&#x73B0;&#x7684;</strong>&#xFF1A;</p>\n<ul>\n<li>&#x7528;&#x6237;&#x70B9;&#x51FB;&#x4E86;&#x54EA;&#x4E9B;&#x6309;&#x94AE;&#xFF1F;</li>\n<li>&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x54EA;&#x4E9B;&#x9875;&#x9762;&#xFF1F;</li>\n<li>&#x7528;&#x6237;&#x53D1;&#x8D77;&#x4E86;&#x54EA;&#x4E9B;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;?</li>\n</ul>\n<p>&#x8FD9;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x884C;&#x4E3A;&#x4FE1;&#x606F;&#x5F80;&#x5F80;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x4ECE;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;&#x51FA;&#x9519;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4ECE;&#x800C;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<h3 id=\"&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"><a href=\"#&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"></a>&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;</h3><p>Fundebug&#x4E13;&#x6CE8;&#x4E0E;&#x5E94;&#x7528;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#xFF0C;&#x56E0;&#x6B64;<strong>&#x53EA;&#x4F1A;&#x8BB0;&#x5F55;&#x51FA;&#x9519;&#x524D;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;</strong>&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x610F;&#x4E8E;&#x76D1;&#x63A7;&#x6240;&#x6709;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#xFF0C;Fundebug&#x4F1A;&#x8BB0;&#x5F55;&#x8FD9;&#x4E9B;&#x7528;&#x6237;&#x884C;&#x4E3A;:</p>\n<ul>\n<li>&#x70B9;&#x51FB;</li>\n<li>&#x9875;&#x9762;&#x8DF3;&#x8F6C;</li>\n<li>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</li>\n</ul>\n<p>&#x6211;&#x4EEC;&#x6536;&#x5230;&#x7684;&#x67D0;&#x4E2A;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x7684;<strong>&#x7528;&#x6237;&#x884C;&#x4E3A;</strong>&#x5982;&#x4E0B;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/29/user-behavior-track/user-behavior-track.png\"><br></div>\n\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x7528;&#x6237;&#x4ECE;&#x4E3B;&#x9875;&#x8DF3;&#x8F6C;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x65F6;&#x5019;&#x51FA;&#x73B0;&#x4E86;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x8BB0;&#x5F55;&#x5176;&#x4ED6;&#x884C;&#x4E3A;&#x7684;&#x8BDD;&#xFF0C;&#x6B22;&#x8FCE;&#x4E0E;&#x6211;&#x4EEC;&#x8054;&#x7CFB;&#x3002;</p>\n","excerpt":"<p>&#x5BF9;&#x4E8E;&#x524D;&#x7AEF;JavaScript&#x7684;&#x9519;&#x8BEF;&#xFF0C;Fundebug&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x51FA;&#x9519;&#x524D;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982;<strong>&#x70B9;&#x51FB;</strong>&#x3001;<strong>&#x9875;&#x9762;&#x8DF3;&#x8F6C;</strong>&#x3001;<strong>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</strong>&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x884C;&#x4E3A;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x56DE;&#x6EAF;&#x9519;&#x8BEF;&#x51FA;&#x73B0;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x5FEB;&#x5730;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>","more":"<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/03/29/user-behavior-track/fundebug-track-behavior.png\"><br></div>\n\n<h3 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;</h3><p>&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x4ECE;&#x9519;&#x8BEF;&#x672C;&#x8EAB;&#x6765;&#x5E2E;&#x52A9;&#x7528;&#x6237;&#x5B9A;&#x4F4D;&#x548C;&#x5206;&#x6790;&#x9519;&#x8BEF;&#x7684;:</p>\n<ul>\n<li>&#x6293;&#x53D6;&#x8BE6;&#x7EC6;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x884C;&#x5217;&#x53F7;&#xFF0C;&#x9519;&#x8BEF;&#x6808;&#x2026;</li>\n<li>&#x517C;&#x5BB9;&#x5404;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x6846;&#x67B6;</li>\n<li>&#x4F7F;&#x7528;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x5BF9;&#x9519;&#x8BEF;&#x8FDB;&#x884C;&#x667A;&#x80FD;&#x805A;&#x5408;</li>\n<li>&#x901A;&#x8FC7;Source Map&#x8FD8;&#x539F;&#x771F;&#x5B9E;&#x7684;&#x51FA;&#x9519;&#x4F4D;&#x7F6E;&#x548C;&#x51FA;&#x9519;&#x4EE3;&#x7801;</li>\n</ul>\n<p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E5F;&#x8DB3;&#x591F;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x5BF9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x901A;&#x5E38;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;</p>\n<p>&#x4F46;&#x662F;&#xFF0C;&#x9519;&#x8BEF;&#x672C;&#x8EAB;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x7ED9;&#x63D0;&#x4F9B;&#x5F00;&#x53D1;&#x8005;&#x4E00;&#x4E2A;<strong>&#x51FA;&#x9519;&#x573A;&#x666F;</strong>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x6709;&#x65F6;&#x5E76;&#x4E0D;&#x6E05;&#x695A;<strong>&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x662F;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x51FA;&#x73B0;&#x7684;</strong>&#xFF1A;</p>\n<ul>\n<li>&#x7528;&#x6237;&#x70B9;&#x51FB;&#x4E86;&#x54EA;&#x4E9B;&#x6309;&#x94AE;&#xFF1F;</li>\n<li>&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x54EA;&#x4E9B;&#x9875;&#x9762;&#xFF1F;</li>\n<li>&#x7528;&#x6237;&#x53D1;&#x8D77;&#x4E86;&#x54EA;&#x4E9B;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;?</li>\n</ul>\n<p>&#x8FD9;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x884C;&#x4E3A;&#x4FE1;&#x606F;&#x5F80;&#x5F80;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x4ECE;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;&#x51FA;&#x9519;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4ECE;&#x800C;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x9519;&#x8BEF;&#x3002;</p>\n<h3 id=\"&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"><a href=\"#&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;\"></a>&#x5982;&#x4F55;&#x8BB0;&#x5F55;&#x7528;&#x6237;&#x884C;&#x4E3A;&#xFF1F;</h3><p>Fundebug&#x4E13;&#x6CE8;&#x4E0E;&#x5E94;&#x7528;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#xFF0C;&#x56E0;&#x6B64;<strong>&#x53EA;&#x4F1A;&#x8BB0;&#x5F55;&#x51FA;&#x9519;&#x524D;&#x7684;&#x7528;&#x6237;&#x884C;&#x4E3A;</strong>&#xFF0C;&#x6211;&#x4EEC;&#x65E0;&#x610F;&#x4E8E;&#x76D1;&#x63A7;&#x6240;&#x6709;&#x7528;&#x6237;&#x884C;&#x4E3A;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#xFF0C;Fundebug&#x4F1A;&#x8BB0;&#x5F55;&#x8FD9;&#x4E9B;&#x7528;&#x6237;&#x884C;&#x4E3A;:</p>\n<ul>\n<li>&#x70B9;&#x51FB;</li>\n<li>&#x9875;&#x9762;&#x8DF3;&#x8F6C;</li>\n<li>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</li>\n</ul>\n<p>&#x6211;&#x4EEC;&#x6536;&#x5230;&#x7684;&#x67D0;&#x4E2A;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#x7684;<strong>&#x7528;&#x6237;&#x884C;&#x4E3A;</strong>&#x5982;&#x4E0B;:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/29/user-behavior-track/user-behavior-track.png\"><br></div>\n\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x7528;&#x6237;&#x4ECE;&#x4E3B;&#x9875;&#x8DF3;&#x8F6C;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x65F6;&#x5019;&#x51FA;&#x73B0;&#x4E86;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x8BB0;&#x5F55;&#x5176;&#x4ED6;&#x884C;&#x4E3A;&#x7684;&#x8BDD;&#xFF0C;&#x6B22;&#x8FCE;&#x4E0E;&#x6211;&#x4EEC;&#x8054;&#x7CFB;&#x3002;</p>"},{"title":"玩转Node.js单元测试","date":"2017-03-20T13:00:00.000Z","_content":"\n\n代码部署之前，进行一定的单元测试是十分必要的，这样能够有效并且持续保证代码质量。而实践表明，高质量的单元测试还可以帮助我们完善自己的代码。这篇博客将通过一些简单的测试案例，介绍几款Node.js测试模块: [Mocha](https://mochajs.org/)和[Should](https://shouldjs.github.io/)，[SuperTest](https://github.com/visionmedia/supertest)。本文侧重于解释**原理**，各个模块的详细使用案例以后单独再聊。\n\n<!-- more -->\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-unit-test/nodejs-unit-test.jpg\" />\n</div>\n\n\n### 为啥需要单元测试？\n\n所谓单元测试，就是对某个函数或者API进行正确性验证。来看个简单的例子**[add1.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js)**:\n\n```js\nfunction add(a, b)\n{\n    return a + b;\n}\n```\n\n没错，我写了一个加法函数。**这有啥好测的呢？**不妨用node执行一下:\n\n```js\n> add = function(a, b){return a + b}\n[Function: add]\n> add(4)\nNaN\n```\n\n当add函数仅给定一个参数4的时候，a为4，b为undefined，两者相加为NaN。\n\n- 你考虑过只有一个参数的场景吗？\n- 给定一个参数时，NaN是你想要的结果吗？\n- 如果参数不是整数怎么办？ \n\n这时，就需要单元测试来验证各种可能的场景了。\n\n如果我把add函数定义为**两个整数相加**，而其他输入则返回undefined，那么正确的代码**[add2.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js)**应该是这样的:\n\n```js\nfunction add(a, b)\n{\n    if (typeof a === \"number\" && typeof b === \"number\")\n    {\n        return a + b;\n    }\n    else\n    {\n        return undefined;\n    }\n\n}\n```\n\n发现一个有趣的现象，我们写代码的时候很容易陷入思维漏洞，而写测试的时候往往会考虑各种情况，这就是所谓的TDD（Test-Driven-Development: 测试驱动开发）的神奇之处。因此，**进行一定的单元测试是十分必要的**:\n\n- 验证代码的正确性\n- 避免修改代码时出错\n- 避免其他团队成员修改代码时出错\n- 便于自动化测试与部署\n\n### 测试框架 - [Mocha](https://mochajs.org/)\n\n下面的测试代码**[test2.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test2.js)**用于测试**[add2.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js)**。这里使用了测试框架[Mocha](https://mochajs.org/)以及Node.js自带的断言库[Assert](https://nodejs.org/api/assert.html)。\n\n```js\nvar add = require(\"../add2.js\");\nvar assert  = require(\"assert\");\n\n\n// 当2个参数均为整数时\nit(\"should return 3\", function()\n{\n    var sum = add(1, 2);\n    assert.equal(sum, 3);\n});\n\n// 当第2个参数为String时\nit(\"should return undefined\", function()\n{\n    var sum = add(1, \"2\");\n    assert.equal(sum, undefined);\n});\n\n// 当只有1个参数时\nit(\"should return undefined\", function()\n{\n    var sum = add(1);\n    assert.equal(sum, undefined);\n});\n```\n\n测试代码中使用了测试框架[Mocha](https://mochajs.org/)提供的it函数，3个it函数分别测试了3种不同的案例(test case)。it函数的第1个参数为字符串，用于描述测试，一般会写期望得到的结果，例如\"should return 3\"; 而第2个参数为函数，用于编写测试代码，一般是先调用被测试的函数或者API，获取结果之后，使用断言库判断执行结果是否正确。\n\n测试代码中使用了Node.js自带的断言库[Assert](https://nodejs.org/api/assert.html)的[assert.equal](https://nodejs.org/api/assert.html#assert_assert_equal_actual_expected_message)函数，用于判定add函数返回的结果是否正确。assert.equal成功时不会发生什么，而失败时会抛出一个AssertionError。不妨使用node测试一下:\n\n```bash\n> assert  = require(\"assert\");\n> assert.equal(1, 1);\nundefined\n> assert.equal(1, 2);\nAssertionError: 1 == 2\n    at repl:1:8\n    at sigintHandlersWrap (vm.js:22:35)\n    at sigintHandlersWrap (vm.js:96:12)\n    at ContextifyScript.Script.runInThisContext (vm.js:21:12)\n    at REPLServer.defaultEval (repl.js:313:29)\n    at bound (domain.js:280:14)\n    at REPLServer.runBound [as eval] (domain.js:293:12)\n    at REPLServer.<anonymous> (repl.js:513:10)\n    at emitOne (events.js:101:20)\n    at REPLServer.emit (events.js:188:7)\n```\n\n#### 原理: \n\n> 我们按照Mocha的it函数编写一个个测试案例，然后Mocha负责执行这些案例；当assert.equal断言成功时，则测试案例通过；当assert.equal断言失败时，抛出AssertionError，Mocha能够捕获到这些异常，然后对应的测试案例失败。\n\n\n使用mocha执行test2.js:\n\n```bash\nmocha test/test2.js\n```\n\n下面为输出，表示测试案例全部通过\n\n```bash\n✓ should return 3\n✓ should return undefined\n✓ should return undefined\n\n3 passing\n```\n\n而当我们使用**[test1.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test1.js)**测试**[add1.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js)**时，则后面2个测试案例失败:\n\n```bash\n✓ should return 3\n  1) should return undefined\n  2) should return undefined\n\n  1 passing (14ms)\n  2 failing\n\n  1)  should return undefined:\n     AssertionError: '12' == undefined\n      at Context.<anonymous> (test/test1.js:18:12)\n\n  2)  should return undefined:\n     AssertionError: NaN == undefined\n      at Context.<anonymous> (test/test1.js:25:12)\n```\n\n### 断言库 - [Should](https://shouldjs.github.io/)\n\nNode.js自带的断言库[Assert](https://nodejs.org/api/assert.html)提供的函数有限，在实际工作中，[Should](https://shouldjs.github.io/)等第三方断言库则更加强大和实用。\n\n我写了一个merge函数**[merge.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/merge.js)**，实现了类似于[_.extend()](http://underscorejs.org/#extend)与[Object.assign()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)的功能，用于合并两个Object的属性。\n\n```js\nfunction merge(a, b)\n{\n    if (typeof a === \"object\" && typeof b === \"object\")\n    {\n        for (var property in b)\n        {\n            a[property] = b[property];\n        }\n        return a;\n    }\n    else\n    {\n        return undefined;\n    }\n}\n```\n\n然后我使用[Should](https://shouldjs.github.io/)写了对应的测试代码**[test3.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test3.js)**:\n\n```js\nrequire(\"should\");\nvar merge = require(\"../merge.js\");\n\n\n// 当2个参数均为对象时\nit(\"should success\", function()\n{\n    var a = {\n        name: \"Fundebug\",\n        type: \"SaaS\"\n    };\n\n    var b = {\n        service: \"Real time bug monitoring\",\n        product:\n        {\n            frontend: \"JavaScript\",\n            backend: \"Node.js\",\n            mobile: \"微信小程序\"\n        }\n    };\n\n    var c = merge(a, b);\n\n    c.should.have.property(\"name\", \"Fundebug\");\n    c.should.have.propertyByPath(\"product\", \"frontend\").equal(\"JavaScript\");\n});\n\n// 当只有1个参数时\nit(\"should return undefined\", function()\n{\n    var a = {\n        name: \"Fundebug\",\n        type: \"SaaS\"\n    };\n\n    var c = merge(a);\n\n    (typeof c).should.equal(\"undefined\");\n});\n```\n\n测试代码稍微有点长，但是使用Should的只有三处:\n\n```js\nc.should.have.property(\"name\", \"Fundebug\");\nc.should.have.propertyByPath(\"product\", \"frontend\").equal(\"JavaScript\");\n(typeof c).should.equal(\"undefined\");\n```\n\n可知Should能够:\n\n- 验证对象是否存在某属性，并验证其取值\n- 验证对象是否存在某个嵌套属性，并使用链式方式验证其取值\n\n那么Should为什么不能直接验证c的取值为undefined呢？比如这样写:\n\n```js\nc.should.equal(undefined); // 这样写是错误的\n```\n\n#### 原理: \n\n> Should会为每个对象添加should属性，然后通过该属性提供各种断言函数，我们可以使用这些函数验证对象的取值。对于undefined，Should无法为其添加属性，因此失败。\n\n通过node验证发现，导入Should之后，空对象a增加了一个should属性。\n\n```bash\n> a = {}\n> typeof a.should\n'undefined'\n> require(\"should\")\n> typeof a.should\n'object'\n```\n\n### 测试HTTP接口 - [SuperTest](https://github.com/visionmedia/supertest)\n\nNode.js是用于后端开发的语言，而后端开发其实很大程度上等价于编写HTTP接口，为前端提供服务。那么，Node.js单元测试则少不了对HTTP接口进行测试。\n\n我用Node.js自带的[HTTP](https://nodejs.org/api/http.html)模块写了一个简单的HTTP接口**[server.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/server.js)**\n\n```js\nvar http = require(\"http\");\n\nvar server = http.createServer((req, res) =>\n{\n    res.writeHead(200,\n    {\n        \"Content-Type\": \"text/plain\"\n    });\n\n    res.end(\"Hello Fundebug\");\n});\n\n\nserver.listen(8000);\n```\n\n按照Mocha的原理，测试HTTP接口并不难: 访问接口; 获取返回数据; 验证返回结果。使用Node.js原生的http与assert模块就可以了**[test4.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test4.js)**:\n\n```js\nrequire(\"../server.js\");\nvar http = require(\"http\");\nvar assert = require(\"assert\");\n\n\nit(\"should return hello fundebug\", function(done)\n{\n    http.get(\"http://localhost:8000\", function(res)\n    {\n        res.setEncoding(\"utf8\");\n        res.on(\"data\", function(text)\n        {\n            assert.equal(res.statusCode, 200);\n            assert.equal(text, \"Hello Fundebug\");\n            done();\n        });\n    });\n});\n```\n\n值得稍微注意的一点是，http.get访问HTTP接口是一个异步操作。**Mocha在测试异步代码是需要为it函数添加回调函数done**，在断言结束的地方调用done，这样Mocha才能知道什么时候结束这个测试。\n\n既然Node.js自带的模块就能够测试HTTP接口了，为什么还需要[SuperTest](https://github.com/visionmedia/supertest)呢？不妨先看一下测试代码**[test5.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test5.js)**:\n\n```js\nvar request = require(\"supertest\");\nvar server = require(\"../server.js\");\nvar assert = require(\"assert\");\n\n\nit(\"should return hello fundebug\", function(done)\n{\n    request(server)\n        .get(\"/\")\n        .expect(200)\n        .expect(function(res)\n        {\n            assert.equal(res.text, \"Hello Fundebug\");\n        })\n        .end(done);\n});\n```\n\n对比两个测试代码，会发现后者简洁很多。\n\n#### 原理\n\n> SuperTest封装了发送HTTP请求的接口，并且提供了简单的expect断言来判定接口返回结果。对于POST接口，使用SuperTest的优势将更加明显，因为使用Node.js的http模块发送POST请求是很麻烦的。\n\n### 要做多少单元测试？\n\n本文所写的单元测试案例，都很简单。然而，在实际工作中，单元测试是一个很头痛的事情。修改了代码有时意味着必须修改单元测试，写了新的函数或者API就得写新的单元测试。如果较真起来，单元测试可以没完没了地写，但这是没有意义的。而根据二八原理，20%的测试可以解决80%的问题。剩下的20%问题，事实上我们是力不从心的。换句话说，想通过测试消除所有BUG，是不现实的。\n\n因此，对生产代码进行实时错误监测是非常有必要的，这也是我们[Fundebug](https://fundebug.com/)努力在做的事情:) 欢迎大家加入我们的**Node.js技术交流群**:\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-unit-test/nodejs-qq-group.jpeg\" />\n</div>\n\n### 参考链接\n\n- [测试框架 Mocha 实例教程 - 阮一峰](http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html)\n- [单元测试要做多细 - 酷壳](http://coolshell.cn/articles/8209.html)\n- [测试的道理 -王垠](http://www.yinwang.org/blog-cn/2016/09/14/tests)\n- [Pareto principle](https://en.wikipedia.org/wiki/Pareto_principle)\n","source":"_posts/2017/03/20/nodejs-unit-test.md","raw":"---\n\ntitle: 玩转Node.js单元测试\n\ndate: 2017-03-20 21:00:00\n\ntags: [Node.js]\n\n---\n\n\n代码部署之前，进行一定的单元测试是十分必要的，这样能够有效并且持续保证代码质量。而实践表明，高质量的单元测试还可以帮助我们完善自己的代码。这篇博客将通过一些简单的测试案例，介绍几款Node.js测试模块: [Mocha](https://mochajs.org/)和[Should](https://shouldjs.github.io/)，[SuperTest](https://github.com/visionmedia/supertest)。本文侧重于解释**原理**，各个模块的详细使用案例以后单独再聊。\n\n<!-- more -->\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-unit-test/nodejs-unit-test.jpg\" />\n</div>\n\n\n### 为啥需要单元测试？\n\n所谓单元测试，就是对某个函数或者API进行正确性验证。来看个简单的例子**[add1.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js)**:\n\n```js\nfunction add(a, b)\n{\n    return a + b;\n}\n```\n\n没错，我写了一个加法函数。**这有啥好测的呢？**不妨用node执行一下:\n\n```js\n> add = function(a, b){return a + b}\n[Function: add]\n> add(4)\nNaN\n```\n\n当add函数仅给定一个参数4的时候，a为4，b为undefined，两者相加为NaN。\n\n- 你考虑过只有一个参数的场景吗？\n- 给定一个参数时，NaN是你想要的结果吗？\n- 如果参数不是整数怎么办？ \n\n这时，就需要单元测试来验证各种可能的场景了。\n\n如果我把add函数定义为**两个整数相加**，而其他输入则返回undefined，那么正确的代码**[add2.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js)**应该是这样的:\n\n```js\nfunction add(a, b)\n{\n    if (typeof a === \"number\" && typeof b === \"number\")\n    {\n        return a + b;\n    }\n    else\n    {\n        return undefined;\n    }\n\n}\n```\n\n发现一个有趣的现象，我们写代码的时候很容易陷入思维漏洞，而写测试的时候往往会考虑各种情况，这就是所谓的TDD（Test-Driven-Development: 测试驱动开发）的神奇之处。因此，**进行一定的单元测试是十分必要的**:\n\n- 验证代码的正确性\n- 避免修改代码时出错\n- 避免其他团队成员修改代码时出错\n- 便于自动化测试与部署\n\n### 测试框架 - [Mocha](https://mochajs.org/)\n\n下面的测试代码**[test2.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test2.js)**用于测试**[add2.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js)**。这里使用了测试框架[Mocha](https://mochajs.org/)以及Node.js自带的断言库[Assert](https://nodejs.org/api/assert.html)。\n\n```js\nvar add = require(\"../add2.js\");\nvar assert  = require(\"assert\");\n\n\n// 当2个参数均为整数时\nit(\"should return 3\", function()\n{\n    var sum = add(1, 2);\n    assert.equal(sum, 3);\n});\n\n// 当第2个参数为String时\nit(\"should return undefined\", function()\n{\n    var sum = add(1, \"2\");\n    assert.equal(sum, undefined);\n});\n\n// 当只有1个参数时\nit(\"should return undefined\", function()\n{\n    var sum = add(1);\n    assert.equal(sum, undefined);\n});\n```\n\n测试代码中使用了测试框架[Mocha](https://mochajs.org/)提供的it函数，3个it函数分别测试了3种不同的案例(test case)。it函数的第1个参数为字符串，用于描述测试，一般会写期望得到的结果，例如\"should return 3\"; 而第2个参数为函数，用于编写测试代码，一般是先调用被测试的函数或者API，获取结果之后，使用断言库判断执行结果是否正确。\n\n测试代码中使用了Node.js自带的断言库[Assert](https://nodejs.org/api/assert.html)的[assert.equal](https://nodejs.org/api/assert.html#assert_assert_equal_actual_expected_message)函数，用于判定add函数返回的结果是否正确。assert.equal成功时不会发生什么，而失败时会抛出一个AssertionError。不妨使用node测试一下:\n\n```bash\n> assert  = require(\"assert\");\n> assert.equal(1, 1);\nundefined\n> assert.equal(1, 2);\nAssertionError: 1 == 2\n    at repl:1:8\n    at sigintHandlersWrap (vm.js:22:35)\n    at sigintHandlersWrap (vm.js:96:12)\n    at ContextifyScript.Script.runInThisContext (vm.js:21:12)\n    at REPLServer.defaultEval (repl.js:313:29)\n    at bound (domain.js:280:14)\n    at REPLServer.runBound [as eval] (domain.js:293:12)\n    at REPLServer.<anonymous> (repl.js:513:10)\n    at emitOne (events.js:101:20)\n    at REPLServer.emit (events.js:188:7)\n```\n\n#### 原理: \n\n> 我们按照Mocha的it函数编写一个个测试案例，然后Mocha负责执行这些案例；当assert.equal断言成功时，则测试案例通过；当assert.equal断言失败时，抛出AssertionError，Mocha能够捕获到这些异常，然后对应的测试案例失败。\n\n\n使用mocha执行test2.js:\n\n```bash\nmocha test/test2.js\n```\n\n下面为输出，表示测试案例全部通过\n\n```bash\n✓ should return 3\n✓ should return undefined\n✓ should return undefined\n\n3 passing\n```\n\n而当我们使用**[test1.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test1.js)**测试**[add1.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js)**时，则后面2个测试案例失败:\n\n```bash\n✓ should return 3\n  1) should return undefined\n  2) should return undefined\n\n  1 passing (14ms)\n  2 failing\n\n  1)  should return undefined:\n     AssertionError: '12' == undefined\n      at Context.<anonymous> (test/test1.js:18:12)\n\n  2)  should return undefined:\n     AssertionError: NaN == undefined\n      at Context.<anonymous> (test/test1.js:25:12)\n```\n\n### 断言库 - [Should](https://shouldjs.github.io/)\n\nNode.js自带的断言库[Assert](https://nodejs.org/api/assert.html)提供的函数有限，在实际工作中，[Should](https://shouldjs.github.io/)等第三方断言库则更加强大和实用。\n\n我写了一个merge函数**[merge.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/merge.js)**，实现了类似于[_.extend()](http://underscorejs.org/#extend)与[Object.assign()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)的功能，用于合并两个Object的属性。\n\n```js\nfunction merge(a, b)\n{\n    if (typeof a === \"object\" && typeof b === \"object\")\n    {\n        for (var property in b)\n        {\n            a[property] = b[property];\n        }\n        return a;\n    }\n    else\n    {\n        return undefined;\n    }\n}\n```\n\n然后我使用[Should](https://shouldjs.github.io/)写了对应的测试代码**[test3.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test3.js)**:\n\n```js\nrequire(\"should\");\nvar merge = require(\"../merge.js\");\n\n\n// 当2个参数均为对象时\nit(\"should success\", function()\n{\n    var a = {\n        name: \"Fundebug\",\n        type: \"SaaS\"\n    };\n\n    var b = {\n        service: \"Real time bug monitoring\",\n        product:\n        {\n            frontend: \"JavaScript\",\n            backend: \"Node.js\",\n            mobile: \"微信小程序\"\n        }\n    };\n\n    var c = merge(a, b);\n\n    c.should.have.property(\"name\", \"Fundebug\");\n    c.should.have.propertyByPath(\"product\", \"frontend\").equal(\"JavaScript\");\n});\n\n// 当只有1个参数时\nit(\"should return undefined\", function()\n{\n    var a = {\n        name: \"Fundebug\",\n        type: \"SaaS\"\n    };\n\n    var c = merge(a);\n\n    (typeof c).should.equal(\"undefined\");\n});\n```\n\n测试代码稍微有点长，但是使用Should的只有三处:\n\n```js\nc.should.have.property(\"name\", \"Fundebug\");\nc.should.have.propertyByPath(\"product\", \"frontend\").equal(\"JavaScript\");\n(typeof c).should.equal(\"undefined\");\n```\n\n可知Should能够:\n\n- 验证对象是否存在某属性，并验证其取值\n- 验证对象是否存在某个嵌套属性，并使用链式方式验证其取值\n\n那么Should为什么不能直接验证c的取值为undefined呢？比如这样写:\n\n```js\nc.should.equal(undefined); // 这样写是错误的\n```\n\n#### 原理: \n\n> Should会为每个对象添加should属性，然后通过该属性提供各种断言函数，我们可以使用这些函数验证对象的取值。对于undefined，Should无法为其添加属性，因此失败。\n\n通过node验证发现，导入Should之后，空对象a增加了一个should属性。\n\n```bash\n> a = {}\n> typeof a.should\n'undefined'\n> require(\"should\")\n> typeof a.should\n'object'\n```\n\n### 测试HTTP接口 - [SuperTest](https://github.com/visionmedia/supertest)\n\nNode.js是用于后端开发的语言，而后端开发其实很大程度上等价于编写HTTP接口，为前端提供服务。那么，Node.js单元测试则少不了对HTTP接口进行测试。\n\n我用Node.js自带的[HTTP](https://nodejs.org/api/http.html)模块写了一个简单的HTTP接口**[server.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/server.js)**\n\n```js\nvar http = require(\"http\");\n\nvar server = http.createServer((req, res) =>\n{\n    res.writeHead(200,\n    {\n        \"Content-Type\": \"text/plain\"\n    });\n\n    res.end(\"Hello Fundebug\");\n});\n\n\nserver.listen(8000);\n```\n\n按照Mocha的原理，测试HTTP接口并不难: 访问接口; 获取返回数据; 验证返回结果。使用Node.js原生的http与assert模块就可以了**[test4.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test4.js)**:\n\n```js\nrequire(\"../server.js\");\nvar http = require(\"http\");\nvar assert = require(\"assert\");\n\n\nit(\"should return hello fundebug\", function(done)\n{\n    http.get(\"http://localhost:8000\", function(res)\n    {\n        res.setEncoding(\"utf8\");\n        res.on(\"data\", function(text)\n        {\n            assert.equal(res.statusCode, 200);\n            assert.equal(text, \"Hello Fundebug\");\n            done();\n        });\n    });\n});\n```\n\n值得稍微注意的一点是，http.get访问HTTP接口是一个异步操作。**Mocha在测试异步代码是需要为it函数添加回调函数done**，在断言结束的地方调用done，这样Mocha才能知道什么时候结束这个测试。\n\n既然Node.js自带的模块就能够测试HTTP接口了，为什么还需要[SuperTest](https://github.com/visionmedia/supertest)呢？不妨先看一下测试代码**[test5.js](https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test5.js)**:\n\n```js\nvar request = require(\"supertest\");\nvar server = require(\"../server.js\");\nvar assert = require(\"assert\");\n\n\nit(\"should return hello fundebug\", function(done)\n{\n    request(server)\n        .get(\"/\")\n        .expect(200)\n        .expect(function(res)\n        {\n            assert.equal(res.text, \"Hello Fundebug\");\n        })\n        .end(done);\n});\n```\n\n对比两个测试代码，会发现后者简洁很多。\n\n#### 原理\n\n> SuperTest封装了发送HTTP请求的接口，并且提供了简单的expect断言来判定接口返回结果。对于POST接口，使用SuperTest的优势将更加明显，因为使用Node.js的http模块发送POST请求是很麻烦的。\n\n### 要做多少单元测试？\n\n本文所写的单元测试案例，都很简单。然而，在实际工作中，单元测试是一个很头痛的事情。修改了代码有时意味着必须修改单元测试，写了新的函数或者API就得写新的单元测试。如果较真起来，单元测试可以没完没了地写，但这是没有意义的。而根据二八原理，20%的测试可以解决80%的问题。剩下的20%问题，事实上我们是力不从心的。换句话说，想通过测试消除所有BUG，是不现实的。\n\n因此，对生产代码进行实时错误监测是非常有必要的，这也是我们[Fundebug](https://fundebug.com/)努力在做的事情:) 欢迎大家加入我们的**Node.js技术交流群**:\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-unit-test/nodejs-qq-group.jpeg\" />\n</div>\n\n### 参考链接\n\n- [测试框架 Mocha 实例教程 - 阮一峰](http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html)\n- [单元测试要做多细 - 酷壳](http://coolshell.cn/articles/8209.html)\n- [测试的道理 -王垠](http://www.yinwang.org/blog-cn/2016/09/14/tests)\n- [Pareto principle](https://en.wikipedia.org/wiki/Pareto_principle)\n","slug":"2017/03/20/nodejs-unit-test","published":1,"updated":"2017-03-20T09:40:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywend001emkfyibbqf925","content":"<p>&#x4EE3;&#x7801;&#x90E8;&#x7F72;&#x4E4B;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x662F;&#x5341;&#x5206;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x591F;&#x6709;&#x6548;&#x5E76;&#x4E14;&#x6301;&#x7EED;&#x4FDD;&#x8BC1;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x3002;&#x800C;&#x5B9E;&#x8DF5;&#x8868;&#x660E;&#xFF0C;&#x9AD8;&#x8D28;&#x91CF;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x8FD8;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B8C;&#x5584;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x6B3E;Node.js&#x6D4B;&#x8BD5;&#x6A21;&#x5757;: <a href=\"https://mochajs.org/\" target=\"_blank\" rel=\"external\">Mocha</a>&#x548C;<a href=\"https://shouldjs.github.io/\" target=\"_blank\" rel=\"external\">Should</a>&#xFF0C;<a href=\"https://github.com/visionmedia/supertest\" target=\"_blank\" rel=\"external\">SuperTest</a>&#x3002;&#x672C;&#x6587;&#x4FA7;&#x91CD;&#x4E8E;&#x89E3;&#x91CA;<strong>&#x539F;&#x7406;</strong>&#xFF0C;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x8BE6;&#x7EC6;&#x4F7F;&#x7528;&#x6848;&#x4F8B;&#x4EE5;&#x540E;&#x5355;&#x72EC;&#x518D;&#x804A;&#x3002;</p>\n<a id=\"more\"></a>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/20/nodejs-unit-test/nodejs-unit-test.jpg\"><br></div>\n\n\n<h3 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</h3><p>&#x6240;&#x8C13;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x6216;&#x8005;API&#x8FDB;&#x884C;&#x6B63;&#x786E;&#x6027;&#x9A8C;&#x8BC1;&#x3002;&#x6765;&#x770B;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js\" target=\"_blank\" rel=\"external\">add1.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">return</span> a + b;</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x6CA1;&#x9519;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x52A0;&#x6CD5;&#x51FD;&#x6570;&#x3002;<strong>&#x8FD9;&#x6709;&#x5565;&#x597D;&#x6D4B;&#x7684;&#x5462;&#xFF1F;</strong>&#x4E0D;&#x59A8;&#x7528;node&#x6267;&#x884C;&#x4E00;&#x4E0B;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&gt; add = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span>{<span class=\"keyword\">return</span> a + b}</div><div class=\"line\">[<span class=\"built_in\">Function</span>: add]</div><div class=\"line\">&gt; add(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"literal\">NaN</span></div></pre></td></tr></table></figure>\n<p>&#x5F53;add&#x51FD;&#x6570;&#x4EC5;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x53C2;&#x6570;4&#x7684;&#x65F6;&#x5019;&#xFF0C;a&#x4E3A;4&#xFF0C;b&#x4E3A;undefined&#xFF0C;&#x4E24;&#x8005;&#x76F8;&#x52A0;&#x4E3A;NaN&#x3002;</p>\n<ul>\n<li>&#x4F60;&#x8003;&#x8651;&#x8FC7;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x573A;&#x666F;&#x5417;&#xFF1F;</li>\n<li>&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x65F6;&#xFF0C;NaN&#x662F;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x5417;&#xFF1F;</li>\n<li>&#x5982;&#x679C;&#x53C2;&#x6570;&#x4E0D;&#x662F;&#x6574;&#x6570;&#x600E;&#x4E48;&#x529E;&#xFF1F; </li>\n</ul>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6765;&#x9A8C;&#x8BC1;&#x5404;&#x79CD;&#x53EF;&#x80FD;&#x7684;&#x573A;&#x666F;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x6211;&#x628A;add&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x4E3A;<strong>&#x4E24;&#x4E2A;&#x6574;&#x6570;&#x76F8;&#x52A0;</strong>&#xFF0C;&#x800C;&#x5176;&#x4ED6;&#x8F93;&#x5165;&#x5219;&#x8FD4;&#x56DE;undefined&#xFF0C;&#x90A3;&#x4E48;&#x6B63;&#x786E;&#x7684;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js\" target=\"_blank\" rel=\"external\">add2.js</a></strong>&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> a === <span class=\"string\">&quot;number&quot;</span> &amp;&amp; <span class=\"keyword\">typeof</span> b === <span class=\"string\">&quot;number&quot;</span>)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> a + b;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span>;</div><div class=\"line\">    }</div><div class=\"line\"></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x4E00;&#x4E2A;&#x6709;&#x8DA3;&#x7684;&#x73B0;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x5F88;&#x5BB9;&#x6613;&#x9677;&#x5165;&#x601D;&#x7EF4;&#x6F0F;&#x6D1E;&#xFF0C;&#x800C;&#x5199;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x5F80;&#x5F80;&#x4F1A;&#x8003;&#x8651;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;TDD&#xFF08;Test-Driven-Development: &#x6D4B;&#x8BD5;&#x9A71;&#x52A8;&#x5F00;&#x53D1;&#xFF09;&#x7684;&#x795E;&#x5947;&#x4E4B;&#x5904;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x662F;&#x5341;&#x5206;&#x5FC5;&#x8981;&#x7684;</strong>:</p>\n<ul>\n<li>&#x9A8C;&#x8BC1;&#x4EE3;&#x7801;&#x7684;&#x6B63;&#x786E;&#x6027;</li>\n<li>&#x907F;&#x514D;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#x51FA;&#x9519;</li>\n<li>&#x907F;&#x514D;&#x5176;&#x4ED6;&#x56E2;&#x961F;&#x6210;&#x5458;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#x51FA;&#x9519;</li>\n<li>&#x4FBF;&#x4E8E;&#x81EA;&#x52A8;&#x5316;&#x6D4B;&#x8BD5;&#x4E0E;&#x90E8;&#x7F72;</li>\n</ul>\n<h3 id=\"&#x6D4B;&#x8BD5;&#x6846;&#x67B6;-Mocha\"><a href=\"#&#x6D4B;&#x8BD5;&#x6846;&#x67B6;-Mocha\" class=\"headerlink\" title=\"&#x6D4B;&#x8BD5;&#x6846;&#x67B6; - Mocha\"></a>&#x6D4B;&#x8BD5;&#x6846;&#x67B6; - <a href=\"https://mochajs.org/\" target=\"_blank\" rel=\"external\">Mocha</a></h3><p>&#x4E0B;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test2.js\" target=\"_blank\" rel=\"external\">test2.js</a></strong>&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js\" target=\"_blank\" rel=\"external\">add2.js</a></strong>&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;<a href=\"https://mochajs.org/\" target=\"_blank\" rel=\"external\">Mocha</a>&#x4EE5;&#x53CA;Node.js&#x81EA;&#x5E26;&#x7684;&#x65AD;&#x8A00;&#x5E93;<a href=\"https://nodejs.org/api/assert.html\" target=\"_blank\" rel=\"external\">Assert</a>&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> add = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../add2.js&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> assert  = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;2&#x4E2A;&#x53C2;&#x6570;&#x5747;&#x4E3A;&#x6574;&#x6570;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return 3&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> sum = add(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</div><div class=\"line\">    assert.equal(sum, <span class=\"number\">3</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;&#x7B2C;2&#x4E2A;&#x53C2;&#x6570;&#x4E3A;String&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return undefined&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> sum = add(<span class=\"number\">1</span>, <span class=\"string\">&quot;2&quot;</span>);</div><div class=\"line\">    assert.equal(sum, <span class=\"literal\">undefined</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;&#x53EA;&#x6709;1&#x4E2A;&#x53C2;&#x6570;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return undefined&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> sum = add(<span class=\"number\">1</span>);</div><div class=\"line\">    assert.equal(sum, <span class=\"literal\">undefined</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;<a href=\"https://mochajs.org/\" target=\"_blank\" rel=\"external\">Mocha</a>&#x63D0;&#x4F9B;&#x7684;it&#x51FD;&#x6570;&#xFF0C;3&#x4E2A;it&#x51FD;&#x6570;&#x5206;&#x522B;&#x6D4B;&#x8BD5;&#x4E86;3&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x6848;&#x4F8B;(test case)&#x3002;it&#x51FD;&#x6570;&#x7684;&#x7B2C;1&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5199;&#x671F;&#x671B;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4F8B;&#x5982;&#x201D;should return 3&#x201D;; &#x800C;&#x7B2C;2&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x5148;&#x8C03;&#x7528;&#x88AB;&#x6D4B;&#x8BD5;&#x7684;&#x51FD;&#x6570;&#x6216;&#x8005;API&#xFF0C;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x65AD;&#x8A00;&#x5E93;&#x5224;&#x65AD;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;</p>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Node.js&#x81EA;&#x5E26;&#x7684;&#x65AD;&#x8A00;&#x5E93;<a href=\"https://nodejs.org/api/assert.html\" target=\"_blank\" rel=\"external\">Assert</a>&#x7684;<a href=\"https://nodejs.org/api/assert.html#assert_assert_equal_actual_expected_message\" target=\"_blank\" rel=\"external\">assert.equal</a>&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x5224;&#x5B9A;add&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;assert.equal&#x6210;&#x529F;&#x65F6;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#xFF0C;&#x800C;&#x5931;&#x8D25;&#x65F6;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;AssertionError&#x3002;&#x4E0D;&#x59A8;&#x4F7F;&#x7528;node&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&gt; assert  = require(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\">&gt; assert.equal(1, 1);</div><div class=\"line\">undefined</div><div class=\"line\">&gt; assert.equal(1, 2);</div><div class=\"line\">AssertionError: 1 == 2</div><div class=\"line\">    at repl:1:8</div><div class=\"line\">    at sigintHandlersWrap (vm.js:22:35)</div><div class=\"line\">    at sigintHandlersWrap (vm.js:96:12)</div><div class=\"line\">    at ContextifyScript.Script.runInThisContext (vm.js:21:12)</div><div class=\"line\">    at REPLServer.defaultEval (repl.js:313:29)</div><div class=\"line\">    at bound (domain.js:280:14)</div><div class=\"line\">    at REPLServer.runBound [as <span class=\"built_in\">eval</span>] (domain.js:293:12)</div><div class=\"line\">    at REPLServer.&lt;anonymous&gt; (repl.js:513:10)</div><div class=\"line\">    at emitOne (events.js:101:20)</div><div class=\"line\">    at REPLServer.emit (events.js:188:7)</div></pre></td></tr></table></figure>\n<h4 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;:\"></a>&#x539F;&#x7406;:</h4><blockquote>\n<p>&#x6211;&#x4EEC;&#x6309;&#x7167;Mocha&#x7684;it&#x51FD;&#x6570;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x7136;&#x540E;Mocha&#x8D1F;&#x8D23;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x6848;&#x4F8B;&#xFF1B;&#x5F53;assert.equal&#x65AD;&#x8A00;&#x6210;&#x529F;&#x65F6;&#xFF0C;&#x5219;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x901A;&#x8FC7;&#xFF1B;&#x5F53;assert.equal&#x65AD;&#x8A00;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x629B;&#x51FA;AssertionError&#xFF0C;Mocha&#x80FD;&#x591F;&#x6355;&#x83B7;&#x5230;&#x8FD9;&#x4E9B;&#x5F02;&#x5E38;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x5E94;&#x7684;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x5931;&#x8D25;&#x3002;</p>\n</blockquote>\n<p>&#x4F7F;&#x7528;mocha&#x6267;&#x884C;test2.js:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">mocha <span class=\"built_in\">test</span>/<span class=\"built_in\">test</span>2.js</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x4E3A;&#x8F93;&#x51FA;&#xFF0C;&#x8868;&#x793A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x5168;&#x90E8;&#x901A;&#x8FC7;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> 3</div><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> undefined</div><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> undefined</div><div class=\"line\"></div><div class=\"line\">3 passing</div></pre></td></tr></table></figure>\n<p>&#x800C;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test1.js\" target=\"_blank\" rel=\"external\">test1.js</a></strong>&#x6D4B;&#x8BD5;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js\" target=\"_blank\" rel=\"external\">add1.js</a></strong>&#x65F6;&#xFF0C;&#x5219;&#x540E;&#x9762;2&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x5931;&#x8D25;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> 3</div><div class=\"line\">  1) should <span class=\"built_in\">return</span> undefined</div><div class=\"line\">  2) should <span class=\"built_in\">return</span> undefined</div><div class=\"line\"></div><div class=\"line\">  1 passing (14ms)</div><div class=\"line\">  2 failing</div><div class=\"line\"></div><div class=\"line\">  1)  should <span class=\"built_in\">return</span> undefined:</div><div class=\"line\">     AssertionError: <span class=\"string\">&apos;12&apos;</span> == undefined</div><div class=\"line\">      at Context.&lt;anonymous&gt; (<span class=\"built_in\">test</span>/<span class=\"built_in\">test</span>1.js:18:12)</div><div class=\"line\"></div><div class=\"line\">  2)  should <span class=\"built_in\">return</span> undefined:</div><div class=\"line\">     AssertionError: NaN == undefined</div><div class=\"line\">      at Context.&lt;anonymous&gt; (<span class=\"built_in\">test</span>/<span class=\"built_in\">test</span>1.js:25:12)</div></pre></td></tr></table></figure>\n<h3 id=\"&#x65AD;&#x8A00;&#x5E93;-Should\"><a href=\"#&#x65AD;&#x8A00;&#x5E93;-Should\" class=\"headerlink\" title=\"&#x65AD;&#x8A00;&#x5E93; - Should\"></a>&#x65AD;&#x8A00;&#x5E93; - <a href=\"https://shouldjs.github.io/\" target=\"_blank\" rel=\"external\">Should</a></h3><p>Node.js&#x81EA;&#x5E26;&#x7684;&#x65AD;&#x8A00;&#x5E93;<a href=\"https://nodejs.org/api/assert.html\" target=\"_blank\" rel=\"external\">Assert</a>&#x63D0;&#x4F9B;&#x7684;&#x51FD;&#x6570;&#x6709;&#x9650;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;<a href=\"https://shouldjs.github.io/\" target=\"_blank\" rel=\"external\">Should</a>&#x7B49;&#x7B2C;&#x4E09;&#x65B9;&#x65AD;&#x8A00;&#x5E93;&#x5219;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x548C;&#x5B9E;&#x7528;&#x3002;</p>\n<p>&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;merge&#x51FD;&#x6570;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/merge.js\" target=\"_blank\" rel=\"external\">merge.js</a></strong>&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E;<a href=\"http://underscorejs.org/#extend\" target=\"_blank\" rel=\"external\">_.extend()</a>&#x4E0E;<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\" target=\"_blank\" rel=\"external\">Object.assign()</a>&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x7528;&#x4E8E;&#x5408;&#x5E76;&#x4E24;&#x4E2A;Object&#x7684;&#x5C5E;&#x6027;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">merge</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> a === <span class=\"string\">&quot;object&quot;</span> &amp;&amp; <span class=\"keyword\">typeof</span> b === <span class=\"string\">&quot;object&quot;</span>)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> property <span class=\"keyword\">in</span> b)</div><div class=\"line\">        {</div><div class=\"line\">            a[property] = b[property];</div><div class=\"line\">        }</div><div class=\"line\">        <span class=\"keyword\">return</span> a;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span>;</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x6211;&#x4F7F;&#x7528;<a href=\"https://shouldjs.github.io/\" target=\"_blank\" rel=\"external\">Should</a>&#x5199;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test3.js\" target=\"_blank\" rel=\"external\">test3.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;should&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../merge.js&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;2&#x4E2A;&#x53C2;&#x6570;&#x5747;&#x4E3A;&#x5BF9;&#x8C61;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should success&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> a = {</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&quot;Fundebug&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">type</span>: <span class=\"string\">&quot;SaaS&quot;</span></div><div class=\"line\">    };</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> b = {</div><div class=\"line\">        <span class=\"attr\">service</span>: <span class=\"string\">&quot;Real time bug monitoring&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">product</span>:</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"attr\">frontend</span>: <span class=\"string\">&quot;JavaScript&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">backend</span>: <span class=\"string\">&quot;Node.js&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">mobile</span>: <span class=\"string\">&quot;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&quot;</span></div><div class=\"line\">        }</div><div class=\"line\">    };</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> c = merge(a, b);</div><div class=\"line\"></div><div class=\"line\">    c.should.have.property(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Fundebug&quot;</span>);</div><div class=\"line\">    c.should.have.propertyByPath(<span class=\"string\">&quot;product&quot;</span>, <span class=\"string\">&quot;frontend&quot;</span>).equal(<span class=\"string\">&quot;JavaScript&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;&#x53EA;&#x6709;1&#x4E2A;&#x53C2;&#x6570;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return undefined&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> a = {</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&quot;Fundebug&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">type</span>: <span class=\"string\">&quot;SaaS&quot;</span></div><div class=\"line\">    };</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> c = merge(a);</div><div class=\"line\"></div><div class=\"line\">    (<span class=\"keyword\">typeof</span> c).should.equal(<span class=\"string\">&quot;undefined&quot;</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x7A0D;&#x5FAE;&#x6709;&#x70B9;&#x957F;&#xFF0C;&#x4F46;&#x662F;&#x4F7F;&#x7528;Should&#x7684;&#x53EA;&#x6709;&#x4E09;&#x5904;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">c.should.have.property(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Fundebug&quot;</span>);</div><div class=\"line\">c.should.have.propertyByPath(<span class=\"string\">&quot;product&quot;</span>, <span class=\"string\">&quot;frontend&quot;</span>).equal(<span class=\"string\">&quot;JavaScript&quot;</span>);</div><div class=\"line\">(<span class=\"keyword\">typeof</span> c).should.equal(<span class=\"string\">&quot;undefined&quot;</span>);</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Should&#x80FD;&#x591F;:</p>\n<ul>\n<li>&#x9A8C;&#x8BC1;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5B58;&#x5728;&#x67D0;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x5176;&#x53D6;&#x503C;</li>\n<li>&#x9A8C;&#x8BC1;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5B58;&#x5728;&#x67D0;&#x4E2A;&#x5D4C;&#x5957;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x94FE;&#x5F0F;&#x65B9;&#x5F0F;&#x9A8C;&#x8BC1;&#x5176;&#x53D6;&#x503C;</li>\n</ul>\n<p>&#x90A3;&#x4E48;Should&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x9A8C;&#x8BC1;c&#x7684;&#x53D6;&#x503C;&#x4E3A;undefined&#x5462;&#xFF1F;&#x6BD4;&#x5982;&#x8FD9;&#x6837;&#x5199;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">c.should.equal(<span class=\"literal\">undefined</span>); <span class=\"comment\">// &#x8FD9;&#x6837;&#x5199;&#x662F;&#x9519;&#x8BEF;&#x7684;</span></div></pre></td></tr></table></figure>\n<h4 id=\"&#x539F;&#x7406;-1\"><a href=\"#&#x539F;&#x7406;-1\" class=\"headerlink\" title=\"&#x539F;&#x7406;:\"></a>&#x539F;&#x7406;:</h4><blockquote>\n<p>Should&#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;should&#x5C5E;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x8BE5;&#x5C5E;&#x6027;&#x63D0;&#x4F9B;&#x5404;&#x79CD;&#x65AD;&#x8A00;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x9A8C;&#x8BC1;&#x5BF9;&#x8C61;&#x7684;&#x53D6;&#x503C;&#x3002;&#x5BF9;&#x4E8E;undefined&#xFF0C;Should&#x65E0;&#x6CD5;&#x4E3A;&#x5176;&#x6DFB;&#x52A0;&#x5C5E;&#x6027;&#xFF0C;&#x56E0;&#x6B64;&#x5931;&#x8D25;&#x3002;</p>\n</blockquote>\n<p>&#x901A;&#x8FC7;node&#x9A8C;&#x8BC1;&#x53D1;&#x73B0;&#xFF0C;&#x5BFC;&#x5165;Should&#x4E4B;&#x540E;&#xFF0C;&#x7A7A;&#x5BF9;&#x8C61;a&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;should&#x5C5E;&#x6027;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&gt; a = {}</div><div class=\"line\">&gt; typeof a.should</div><div class=\"line\"><span class=\"string\">&apos;undefined&apos;</span></div><div class=\"line\">&gt; require(<span class=\"string\">&quot;should&quot;</span>)</div><div class=\"line\">&gt; typeof a.should</div><div class=\"line\"><span class=\"string\">&apos;object&apos;</span></div></pre></td></tr></table></figure>\n<h3 id=\"&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;-SuperTest\"><a href=\"#&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;-SuperTest\" class=\"headerlink\" title=\"&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3; - SuperTest\"></a>&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3; - <a href=\"https://github.com/visionmedia/supertest\" target=\"_blank\" rel=\"external\">SuperTest</a></h3><p>Node.js&#x662F;&#x7528;&#x4E8E;&#x540E;&#x7AEF;&#x5F00;&#x53D1;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x800C;&#x540E;&#x7AEF;&#x5F00;&#x53D1;&#x5176;&#x5B9E;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x7B49;&#x4EF7;&#x4E8E;&#x7F16;&#x5199;HTTP&#x63A5;&#x53E3;&#xFF0C;&#x4E3A;&#x524D;&#x7AEF;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;&#x90A3;&#x4E48;&#xFF0C;Node.js&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x5219;&#x5C11;&#x4E0D;&#x4E86;&#x5BF9;HTTP&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p>&#x6211;&#x7528;Node.js&#x81EA;&#x5E26;&#x7684;<a href=\"https://nodejs.org/api/http.html\" target=\"_blank\" rel=\"external\">HTTP</a>&#x6A21;&#x5757;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;HTTP&#x63A5;&#x53E3;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/server.js\" target=\"_blank\" rel=\"external\">server.js</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span></div><div class=\"line\">{</div><div class=\"line\">    res.writeHead(<span class=\"number\">200</span>,</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/plain&quot;</span></div><div class=\"line\">    });</div><div class=\"line\"></div><div class=\"line\">    res.end(<span class=\"string\">&quot;Hello Fundebug&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">server.listen(<span class=\"number\">8000</span>);</div></pre></td></tr></table></figure>\n<p>&#x6309;&#x7167;Mocha&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;&#x5E76;&#x4E0D;&#x96BE;: &#x8BBF;&#x95EE;&#x63A5;&#x53E3;; &#x83B7;&#x53D6;&#x8FD4;&#x56DE;&#x6570;&#x636E;; &#x9A8C;&#x8BC1;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x4F7F;&#x7528;Node.js&#x539F;&#x751F;&#x7684;http&#x4E0E;assert&#x6A21;&#x5757;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test4.js\" target=\"_blank\" rel=\"external\">test4.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;../server.js&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> assert = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">it(<span class=\"string\">&quot;should return hello fundebug&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">done</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    http.get(<span class=\"string\">&quot;http://localhost:8000&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        res.setEncoding(<span class=\"string\">&quot;utf8&quot;</span>);</div><div class=\"line\">        res.on(<span class=\"string\">&quot;data&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">text</span>)</span></div><div class=\"line\">        {</div><div class=\"line\">            assert.equal(res.statusCode, <span class=\"number\">200</span>);</div><div class=\"line\">            assert.equal(text, <span class=\"string\">&quot;Hello Fundebug&quot;</span>);</div><div class=\"line\">            done();</div><div class=\"line\">        });</div><div class=\"line\">    });</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x503C;&#x5F97;&#x7A0D;&#x5FAE;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;http.get&#x8BBF;&#x95EE;HTTP&#x63A5;&#x53E3;&#x662F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x3002;<strong>Mocha&#x5728;&#x6D4B;&#x8BD5;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x662F;&#x9700;&#x8981;&#x4E3A;it&#x51FD;&#x6570;&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x51FD;&#x6570;done</strong>&#xFF0C;&#x5728;&#x65AD;&#x8A00;&#x7ED3;&#x675F;&#x7684;&#x5730;&#x65B9;&#x8C03;&#x7528;done&#xFF0C;&#x8FD9;&#x6837;Mocha&#x624D;&#x80FD;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7ED3;&#x675F;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p>&#x65E2;&#x7136;Node.js&#x81EA;&#x5E26;&#x7684;&#x6A21;&#x5757;&#x5C31;&#x80FD;&#x591F;&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x8981;<a href=\"https://github.com/visionmedia/supertest\" target=\"_blank\" rel=\"external\">SuperTest</a>&#x5462;&#xFF1F;&#x4E0D;&#x59A8;&#x5148;&#x770B;&#x4E00;&#x4E0B;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test5.js\" target=\"_blank\" rel=\"external\">test5.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;supertest&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> server = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../server.js&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> assert = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">it(<span class=\"string\">&quot;should return hello fundebug&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">done</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    request(server)</div><div class=\"line\">        .get(<span class=\"string\">&quot;/&quot;</span>)</div><div class=\"line\">        .expect(<span class=\"number\">200</span>)</div><div class=\"line\">        .expect(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span></div><div class=\"line\">        {</div><div class=\"line\">            assert.equal(res.text, <span class=\"string\">&quot;Hello Fundebug&quot;</span>);</div><div class=\"line\">        })</div><div class=\"line\">        .end(done);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x6BD4;&#x4E24;&#x4E2A;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x540E;&#x8005;&#x7B80;&#x6D01;&#x5F88;&#x591A;&#x3002;</p>\n<h4 id=\"&#x539F;&#x7406;-2\"><a href=\"#&#x539F;&#x7406;-2\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h4><blockquote>\n<p>SuperTest&#x5C01;&#x88C5;&#x4E86;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x7B80;&#x5355;&#x7684;expect&#x65AD;&#x8A00;&#x6765;&#x5224;&#x5B9A;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x5BF9;&#x4E8E;POST&#x63A5;&#x53E3;&#xFF0C;&#x4F7F;&#x7528;SuperTest&#x7684;&#x4F18;&#x52BF;&#x5C06;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;Node.js&#x7684;http&#x6A21;&#x5757;&#x53D1;&#x9001;POST&#x8BF7;&#x6C42;&#x662F;&#x5F88;&#x9EBB;&#x70E6;&#x7684;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"><a href=\"#&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\" class=\"headerlink\" title=\"&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"></a>&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</h3><p>&#x672C;&#x6587;&#x6240;&#x5199;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5934;&#x75DB;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x4FEE;&#x6539;&#x4E86;&#x4EE3;&#x7801;&#x6709;&#x65F6;&#x610F;&#x5473;&#x7740;&#x5FC5;&#x987B;&#x4FEE;&#x6539;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x5199;&#x4E86;&#x65B0;&#x7684;&#x51FD;&#x6570;&#x6216;&#x8005;API&#x5C31;&#x5F97;&#x5199;&#x65B0;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;&#x5982;&#x679C;&#x8F83;&#x771F;&#x8D77;&#x6765;&#xFF0C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x5730;&#x5199;&#xFF0C;&#x4F46;&#x8FD9;&#x662F;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;&#x800C;&#x6839;&#x636E;&#x4E8C;&#x516B;&#x539F;&#x7406;&#xFF0C;20%&#x7684;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;80%&#x7684;&#x95EE;&#x9898;&#x3002;&#x5269;&#x4E0B;&#x7684;20%&#x95EE;&#x9898;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x6211;&#x4EEC;&#x662F;&#x529B;&#x4E0D;&#x4ECE;&#x5FC3;&#x7684;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x60F3;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x6D88;&#x9664;&#x6240;&#x6709;BUG&#xFF0C;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x751F;&#x4EA7;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x662F;&#x975E;&#x5E38;&#x6709;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x6211;&#x4EEC;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x52AA;&#x529B;&#x5728;&#x505A;&#x7684;&#x4E8B;&#x60C5;:) &#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x52A0;&#x5165;&#x6211;&#x4EEC;&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;</strong>:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/03/20/nodejs-unit-test/nodejs-qq-group.jpeg\"><br></div>\n\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html\" target=\"_blank\" rel=\"external\">&#x6D4B;&#x8BD5;&#x6846;&#x67B6; Mocha &#x5B9E;&#x4F8B;&#x6559;&#x7A0B; - &#x962E;&#x4E00;&#x5CF0;</a></li>\n<li><a href=\"http://coolshell.cn/articles/8209.html\" target=\"_blank\" rel=\"external\">&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x8981;&#x505A;&#x591A;&#x7EC6; - &#x9177;&#x58F3;</a></li>\n<li><a href=\"http://www.yinwang.org/blog-cn/2016/09/14/tests\" target=\"_blank\" rel=\"external\">&#x6D4B;&#x8BD5;&#x7684;&#x9053;&#x7406; -&#x738B;&#x57A0;</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Pareto_principle\" target=\"_blank\" rel=\"external\">Pareto principle</a></li>\n</ul>\n","excerpt":"<p>&#x4EE3;&#x7801;&#x90E8;&#x7F72;&#x4E4B;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x662F;&#x5341;&#x5206;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x591F;&#x6709;&#x6548;&#x5E76;&#x4E14;&#x6301;&#x7EED;&#x4FDD;&#x8BC1;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x3002;&#x800C;&#x5B9E;&#x8DF5;&#x8868;&#x660E;&#xFF0C;&#x9AD8;&#x8D28;&#x91CF;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x8FD8;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5B8C;&#x5584;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x6B3E;Node.js&#x6D4B;&#x8BD5;&#x6A21;&#x5757;: <a href=\"https://mochajs.org/\">Mocha</a>&#x548C;<a href=\"https://shouldjs.github.io/\">Should</a>&#xFF0C;<a href=\"https://github.com/visionmedia/supertest\">SuperTest</a>&#x3002;&#x672C;&#x6587;&#x4FA7;&#x91CD;&#x4E8E;&#x89E3;&#x91CA;<strong>&#x539F;&#x7406;</strong>&#xFF0C;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x8BE6;&#x7EC6;&#x4F7F;&#x7528;&#x6848;&#x4F8B;&#x4EE5;&#x540E;&#x5355;&#x72EC;&#x518D;&#x804A;&#x3002;</p>","more":"<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/20/nodejs-unit-test/nodejs-unit-test.jpg\"><br></div>\n\n\n<h3 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</h3><p>&#x6240;&#x8C13;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x6216;&#x8005;API&#x8FDB;&#x884C;&#x6B63;&#x786E;&#x6027;&#x9A8C;&#x8BC1;&#x3002;&#x6765;&#x770B;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js\">add1.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">return</span> a + b;</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x6CA1;&#x9519;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x52A0;&#x6CD5;&#x51FD;&#x6570;&#x3002;<strong>&#x8FD9;&#x6709;&#x5565;&#x597D;&#x6D4B;&#x7684;&#x5462;&#xFF1F;</strong>&#x4E0D;&#x59A8;&#x7528;node&#x6267;&#x884C;&#x4E00;&#x4E0B;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&gt; add = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>)</span>{<span class=\"keyword\">return</span> a + b}</div><div class=\"line\">[<span class=\"built_in\">Function</span>: add]</div><div class=\"line\">&gt; add(<span class=\"number\">4</span>)</div><div class=\"line\"><span class=\"literal\">NaN</span></div></pre></td></tr></table></figure>\n<p>&#x5F53;add&#x51FD;&#x6570;&#x4EC5;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x53C2;&#x6570;4&#x7684;&#x65F6;&#x5019;&#xFF0C;a&#x4E3A;4&#xFF0C;b&#x4E3A;undefined&#xFF0C;&#x4E24;&#x8005;&#x76F8;&#x52A0;&#x4E3A;NaN&#x3002;</p>\n<ul>\n<li>&#x4F60;&#x8003;&#x8651;&#x8FC7;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x573A;&#x666F;&#x5417;&#xFF1F;</li>\n<li>&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x65F6;&#xFF0C;NaN&#x662F;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x5417;&#xFF1F;</li>\n<li>&#x5982;&#x679C;&#x53C2;&#x6570;&#x4E0D;&#x662F;&#x6574;&#x6570;&#x600E;&#x4E48;&#x529E;&#xFF1F; </li>\n</ul>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6765;&#x9A8C;&#x8BC1;&#x5404;&#x79CD;&#x53EF;&#x80FD;&#x7684;&#x573A;&#x666F;&#x4E86;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x6211;&#x628A;add&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x4E3A;<strong>&#x4E24;&#x4E2A;&#x6574;&#x6570;&#x76F8;&#x52A0;</strong>&#xFF0C;&#x800C;&#x5176;&#x4ED6;&#x8F93;&#x5165;&#x5219;&#x8FD4;&#x56DE;undefined&#xFF0C;&#x90A3;&#x4E48;&#x6B63;&#x786E;&#x7684;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js\">add2.js</a></strong>&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> a === <span class=\"string\">&quot;number&quot;</span> &amp;&amp; <span class=\"keyword\">typeof</span> b === <span class=\"string\">&quot;number&quot;</span>)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> a + b;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span>;</div><div class=\"line\">    }</div><div class=\"line\"></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x53D1;&#x73B0;&#x4E00;&#x4E2A;&#x6709;&#x8DA3;&#x7684;&#x73B0;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x5F88;&#x5BB9;&#x6613;&#x9677;&#x5165;&#x601D;&#x7EF4;&#x6F0F;&#x6D1E;&#xFF0C;&#x800C;&#x5199;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x5F80;&#x5F80;&#x4F1A;&#x8003;&#x8651;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;TDD&#xFF08;Test-Driven-Development: &#x6D4B;&#x8BD5;&#x9A71;&#x52A8;&#x5F00;&#x53D1;&#xFF09;&#x7684;&#x795E;&#x5947;&#x4E4B;&#x5904;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x662F;&#x5341;&#x5206;&#x5FC5;&#x8981;&#x7684;</strong>:</p>\n<ul>\n<li>&#x9A8C;&#x8BC1;&#x4EE3;&#x7801;&#x7684;&#x6B63;&#x786E;&#x6027;</li>\n<li>&#x907F;&#x514D;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#x51FA;&#x9519;</li>\n<li>&#x907F;&#x514D;&#x5176;&#x4ED6;&#x56E2;&#x961F;&#x6210;&#x5458;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#x51FA;&#x9519;</li>\n<li>&#x4FBF;&#x4E8E;&#x81EA;&#x52A8;&#x5316;&#x6D4B;&#x8BD5;&#x4E0E;&#x90E8;&#x7F72;</li>\n</ul>\n<h3 id=\"&#x6D4B;&#x8BD5;&#x6846;&#x67B6;-Mocha\"><a href=\"#&#x6D4B;&#x8BD5;&#x6846;&#x67B6;-Mocha\" class=\"headerlink\" title=\"&#x6D4B;&#x8BD5;&#x6846;&#x67B6; - Mocha\"></a>&#x6D4B;&#x8BD5;&#x6846;&#x67B6; - <a href=\"https://mochajs.org/\">Mocha</a></h3><p>&#x4E0B;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test2.js\">test2.js</a></strong>&#x7528;&#x4E8E;&#x6D4B;&#x8BD5;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add2.js\">add2.js</a></strong>&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;<a href=\"https://mochajs.org/\">Mocha</a>&#x4EE5;&#x53CA;Node.js&#x81EA;&#x5E26;&#x7684;&#x65AD;&#x8A00;&#x5E93;<a href=\"https://nodejs.org/api/assert.html\">Assert</a>&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> add = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../add2.js&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> assert  = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;2&#x4E2A;&#x53C2;&#x6570;&#x5747;&#x4E3A;&#x6574;&#x6570;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return 3&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> sum = add(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</div><div class=\"line\">    assert.equal(sum, <span class=\"number\">3</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;&#x7B2C;2&#x4E2A;&#x53C2;&#x6570;&#x4E3A;String&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return undefined&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> sum = add(<span class=\"number\">1</span>, <span class=\"string\">&quot;2&quot;</span>);</div><div class=\"line\">    assert.equal(sum, <span class=\"literal\">undefined</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;&#x53EA;&#x6709;1&#x4E2A;&#x53C2;&#x6570;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return undefined&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> sum = add(<span class=\"number\">1</span>);</div><div class=\"line\">    assert.equal(sum, <span class=\"literal\">undefined</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x6D4B;&#x8BD5;&#x6846;&#x67B6;<a href=\"https://mochajs.org/\">Mocha</a>&#x63D0;&#x4F9B;&#x7684;it&#x51FD;&#x6570;&#xFF0C;3&#x4E2A;it&#x51FD;&#x6570;&#x5206;&#x522B;&#x6D4B;&#x8BD5;&#x4E86;3&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x6848;&#x4F8B;(test case)&#x3002;it&#x51FD;&#x6570;&#x7684;&#x7B2C;1&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5199;&#x671F;&#x671B;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4F8B;&#x5982;&#x201D;should return 3&#x201D;; &#x800C;&#x7B2C;2&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x7F16;&#x5199;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x5148;&#x8C03;&#x7528;&#x88AB;&#x6D4B;&#x8BD5;&#x7684;&#x51FD;&#x6570;&#x6216;&#x8005;API&#xFF0C;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;&#x65AD;&#x8A00;&#x5E93;&#x5224;&#x65AD;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;</p>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;Node.js&#x81EA;&#x5E26;&#x7684;&#x65AD;&#x8A00;&#x5E93;<a href=\"https://nodejs.org/api/assert.html\">Assert</a>&#x7684;<a href=\"https://nodejs.org/api/assert.html#assert_assert_equal_actual_expected_message\">assert.equal</a>&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x5224;&#x5B9A;add&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;assert.equal&#x6210;&#x529F;&#x65F6;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#xFF0C;&#x800C;&#x5931;&#x8D25;&#x65F6;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;AssertionError&#x3002;&#x4E0D;&#x59A8;&#x4F7F;&#x7528;node&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&gt; assert  = require(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\">&gt; assert.equal(1, 1);</div><div class=\"line\">undefined</div><div class=\"line\">&gt; assert.equal(1, 2);</div><div class=\"line\">AssertionError: 1 == 2</div><div class=\"line\">    at repl:1:8</div><div class=\"line\">    at sigintHandlersWrap (vm.js:22:35)</div><div class=\"line\">    at sigintHandlersWrap (vm.js:96:12)</div><div class=\"line\">    at ContextifyScript.Script.runInThisContext (vm.js:21:12)</div><div class=\"line\">    at REPLServer.defaultEval (repl.js:313:29)</div><div class=\"line\">    at bound (domain.js:280:14)</div><div class=\"line\">    at REPLServer.runBound [as <span class=\"built_in\">eval</span>] (domain.js:293:12)</div><div class=\"line\">    at REPLServer.&lt;anonymous&gt; (repl.js:513:10)</div><div class=\"line\">    at emitOne (events.js:101:20)</div><div class=\"line\">    at REPLServer.emit (events.js:188:7)</div></pre></td></tr></table></figure>\n<h4 id=\"&#x539F;&#x7406;\"><a href=\"#&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x539F;&#x7406;:\"></a>&#x539F;&#x7406;:</h4><blockquote>\n<p>&#x6211;&#x4EEC;&#x6309;&#x7167;Mocha&#x7684;it&#x51FD;&#x6570;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x7136;&#x540E;Mocha&#x8D1F;&#x8D23;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x6848;&#x4F8B;&#xFF1B;&#x5F53;assert.equal&#x65AD;&#x8A00;&#x6210;&#x529F;&#x65F6;&#xFF0C;&#x5219;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x901A;&#x8FC7;&#xFF1B;&#x5F53;assert.equal&#x65AD;&#x8A00;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x629B;&#x51FA;AssertionError&#xFF0C;Mocha&#x80FD;&#x591F;&#x6355;&#x83B7;&#x5230;&#x8FD9;&#x4E9B;&#x5F02;&#x5E38;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x5E94;&#x7684;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x5931;&#x8D25;&#x3002;</p>\n</blockquote>\n<p>&#x4F7F;&#x7528;mocha&#x6267;&#x884C;test2.js:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">mocha <span class=\"built_in\">test</span>/<span class=\"built_in\">test</span>2.js</div></pre></td></tr></table></figure>\n<p>&#x4E0B;&#x9762;&#x4E3A;&#x8F93;&#x51FA;&#xFF0C;&#x8868;&#x793A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x5168;&#x90E8;&#x901A;&#x8FC7;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> 3</div><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> undefined</div><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> undefined</div><div class=\"line\"></div><div class=\"line\">3 passing</div></pre></td></tr></table></figure>\n<p>&#x800C;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test1.js\">test1.js</a></strong>&#x6D4B;&#x8BD5;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/add1.js\">add1.js</a></strong>&#x65F6;&#xFF0C;&#x5219;&#x540E;&#x9762;2&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#x5931;&#x8D25;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&#x2713; should <span class=\"built_in\">return</span> 3</div><div class=\"line\">  1) should <span class=\"built_in\">return</span> undefined</div><div class=\"line\">  2) should <span class=\"built_in\">return</span> undefined</div><div class=\"line\"></div><div class=\"line\">  1 passing (14ms)</div><div class=\"line\">  2 failing</div><div class=\"line\"></div><div class=\"line\">  1)  should <span class=\"built_in\">return</span> undefined:</div><div class=\"line\">     AssertionError: <span class=\"string\">&apos;12&apos;</span> == undefined</div><div class=\"line\">      at Context.&lt;anonymous&gt; (<span class=\"built_in\">test</span>/<span class=\"built_in\">test</span>1.js:18:12)</div><div class=\"line\"></div><div class=\"line\">  2)  should <span class=\"built_in\">return</span> undefined:</div><div class=\"line\">     AssertionError: NaN == undefined</div><div class=\"line\">      at Context.&lt;anonymous&gt; (<span class=\"built_in\">test</span>/<span class=\"built_in\">test</span>1.js:25:12)</div></pre></td></tr></table></figure>\n<h3 id=\"&#x65AD;&#x8A00;&#x5E93;-Should\"><a href=\"#&#x65AD;&#x8A00;&#x5E93;-Should\" class=\"headerlink\" title=\"&#x65AD;&#x8A00;&#x5E93; - Should\"></a>&#x65AD;&#x8A00;&#x5E93; - <a href=\"https://shouldjs.github.io/\">Should</a></h3><p>Node.js&#x81EA;&#x5E26;&#x7684;&#x65AD;&#x8A00;&#x5E93;<a href=\"https://nodejs.org/api/assert.html\">Assert</a>&#x63D0;&#x4F9B;&#x7684;&#x51FD;&#x6570;&#x6709;&#x9650;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;<a href=\"https://shouldjs.github.io/\">Should</a>&#x7B49;&#x7B2C;&#x4E09;&#x65B9;&#x65AD;&#x8A00;&#x5E93;&#x5219;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x548C;&#x5B9E;&#x7528;&#x3002;</p>\n<p>&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;merge&#x51FD;&#x6570;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/merge.js\">merge.js</a></strong>&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E;<a href=\"http://underscorejs.org/#extend\">_.extend()</a>&#x4E0E;<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\">Object.assign()</a>&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x7528;&#x4E8E;&#x5408;&#x5E76;&#x4E24;&#x4E2A;Object&#x7684;&#x5C5E;&#x6027;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">merge</span>(<span class=\"params\">a, b</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> a === <span class=\"string\">&quot;object&quot;</span> &amp;&amp; <span class=\"keyword\">typeof</span> b === <span class=\"string\">&quot;object&quot;</span>)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> property <span class=\"keyword\">in</span> b)</div><div class=\"line\">        {</div><div class=\"line\">            a[property] = b[property];</div><div class=\"line\">        }</div><div class=\"line\">        <span class=\"keyword\">return</span> a;</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span>;</div><div class=\"line\">    }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x7136;&#x540E;&#x6211;&#x4F7F;&#x7528;<a href=\"https://shouldjs.github.io/\">Should</a>&#x5199;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test3.js\">test3.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;should&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../merge.js&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;2&#x4E2A;&#x53C2;&#x6570;&#x5747;&#x4E3A;&#x5BF9;&#x8C61;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should success&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> a = {</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&quot;Fundebug&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">type</span>: <span class=\"string\">&quot;SaaS&quot;</span></div><div class=\"line\">    };</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> b = {</div><div class=\"line\">        <span class=\"attr\">service</span>: <span class=\"string\">&quot;Real time bug monitoring&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">product</span>:</div><div class=\"line\">        {</div><div class=\"line\">            <span class=\"attr\">frontend</span>: <span class=\"string\">&quot;JavaScript&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">backend</span>: <span class=\"string\">&quot;Node.js&quot;</span>,</div><div class=\"line\">            <span class=\"attr\">mobile</span>: <span class=\"string\">&quot;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&quot;</span></div><div class=\"line\">        }</div><div class=\"line\">    };</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> c = merge(a, b);</div><div class=\"line\"></div><div class=\"line\">    c.should.have.property(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Fundebug&quot;</span>);</div><div class=\"line\">    c.should.have.propertyByPath(<span class=\"string\">&quot;product&quot;</span>, <span class=\"string\">&quot;frontend&quot;</span>).equal(<span class=\"string\">&quot;JavaScript&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x5F53;&#x53EA;&#x6709;1&#x4E2A;&#x53C2;&#x6570;&#x65F6;</span></div><div class=\"line\">it(<span class=\"string\">&quot;should return undefined&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">var</span> a = {</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&quot;Fundebug&quot;</span>,</div><div class=\"line\">        <span class=\"attr\">type</span>: <span class=\"string\">&quot;SaaS&quot;</span></div><div class=\"line\">    };</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> c = merge(a);</div><div class=\"line\"></div><div class=\"line\">    (<span class=\"keyword\">typeof</span> c).should.equal(<span class=\"string\">&quot;undefined&quot;</span>);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x7A0D;&#x5FAE;&#x6709;&#x70B9;&#x957F;&#xFF0C;&#x4F46;&#x662F;&#x4F7F;&#x7528;Should&#x7684;&#x53EA;&#x6709;&#x4E09;&#x5904;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">c.should.have.property(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Fundebug&quot;</span>);</div><div class=\"line\">c.should.have.propertyByPath(<span class=\"string\">&quot;product&quot;</span>, <span class=\"string\">&quot;frontend&quot;</span>).equal(<span class=\"string\">&quot;JavaScript&quot;</span>);</div><div class=\"line\">(<span class=\"keyword\">typeof</span> c).should.equal(<span class=\"string\">&quot;undefined&quot;</span>);</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;Should&#x80FD;&#x591F;:</p>\n<ul>\n<li>&#x9A8C;&#x8BC1;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5B58;&#x5728;&#x67D0;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x9A8C;&#x8BC1;&#x5176;&#x53D6;&#x503C;</li>\n<li>&#x9A8C;&#x8BC1;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5B58;&#x5728;&#x67D0;&#x4E2A;&#x5D4C;&#x5957;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x94FE;&#x5F0F;&#x65B9;&#x5F0F;&#x9A8C;&#x8BC1;&#x5176;&#x53D6;&#x503C;</li>\n</ul>\n<p>&#x90A3;&#x4E48;Should&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x9A8C;&#x8BC1;c&#x7684;&#x53D6;&#x503C;&#x4E3A;undefined&#x5462;&#xFF1F;&#x6BD4;&#x5982;&#x8FD9;&#x6837;&#x5199;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">c.should.equal(<span class=\"literal\">undefined</span>); <span class=\"comment\">// &#x8FD9;&#x6837;&#x5199;&#x662F;&#x9519;&#x8BEF;&#x7684;</span></div></pre></td></tr></table></figure>\n<h4 id=\"&#x539F;&#x7406;-1\"><a href=\"#&#x539F;&#x7406;-1\" class=\"headerlink\" title=\"&#x539F;&#x7406;:\"></a>&#x539F;&#x7406;:</h4><blockquote>\n<p>Should&#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;should&#x5C5E;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x8BE5;&#x5C5E;&#x6027;&#x63D0;&#x4F9B;&#x5404;&#x79CD;&#x65AD;&#x8A00;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x9A8C;&#x8BC1;&#x5BF9;&#x8C61;&#x7684;&#x53D6;&#x503C;&#x3002;&#x5BF9;&#x4E8E;undefined&#xFF0C;Should&#x65E0;&#x6CD5;&#x4E3A;&#x5176;&#x6DFB;&#x52A0;&#x5C5E;&#x6027;&#xFF0C;&#x56E0;&#x6B64;&#x5931;&#x8D25;&#x3002;</p>\n</blockquote>\n<p>&#x901A;&#x8FC7;node&#x9A8C;&#x8BC1;&#x53D1;&#x73B0;&#xFF0C;&#x5BFC;&#x5165;Should&#x4E4B;&#x540E;&#xFF0C;&#x7A7A;&#x5BF9;&#x8C61;a&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;should&#x5C5E;&#x6027;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">&gt; a = {}</div><div class=\"line\">&gt; typeof a.should</div><div class=\"line\"><span class=\"string\">&apos;undefined&apos;</span></div><div class=\"line\">&gt; require(<span class=\"string\">&quot;should&quot;</span>)</div><div class=\"line\">&gt; typeof a.should</div><div class=\"line\"><span class=\"string\">&apos;object&apos;</span></div></pre></td></tr></table></figure>\n<h3 id=\"&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;-SuperTest\"><a href=\"#&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;-SuperTest\" class=\"headerlink\" title=\"&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3; - SuperTest\"></a>&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3; - <a href=\"https://github.com/visionmedia/supertest\">SuperTest</a></h3><p>Node.js&#x662F;&#x7528;&#x4E8E;&#x540E;&#x7AEF;&#x5F00;&#x53D1;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x800C;&#x540E;&#x7AEF;&#x5F00;&#x53D1;&#x5176;&#x5B9E;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x7B49;&#x4EF7;&#x4E8E;&#x7F16;&#x5199;HTTP&#x63A5;&#x53E3;&#xFF0C;&#x4E3A;&#x524D;&#x7AEF;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;&#x90A3;&#x4E48;&#xFF0C;Node.js&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x5219;&#x5C11;&#x4E0D;&#x4E86;&#x5BF9;HTTP&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p>&#x6211;&#x7528;Node.js&#x81EA;&#x5E26;&#x7684;<a href=\"https://nodejs.org/api/http.html\">HTTP</a>&#x6A21;&#x5757;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;HTTP&#x63A5;&#x53E3;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/server.js\">server.js</a></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\">(<span class=\"params\">req, res</span>) =&gt;</span></div><div class=\"line\">{</div><div class=\"line\">    res.writeHead(<span class=\"number\">200</span>,</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/plain&quot;</span></div><div class=\"line\">    });</div><div class=\"line\"></div><div class=\"line\">    res.end(<span class=\"string\">&quot;Hello Fundebug&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">server.listen(<span class=\"number\">8000</span>);</div></pre></td></tr></table></figure>\n<p>&#x6309;&#x7167;Mocha&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;&#x5E76;&#x4E0D;&#x96BE;: &#x8BBF;&#x95EE;&#x63A5;&#x53E3;; &#x83B7;&#x53D6;&#x8FD4;&#x56DE;&#x6570;&#x636E;; &#x9A8C;&#x8BC1;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x4F7F;&#x7528;Node.js&#x539F;&#x751F;&#x7684;http&#x4E0E;assert&#x6A21;&#x5757;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test4.js\">test4.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;../server.js&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;http&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> assert = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">it(<span class=\"string\">&quot;should return hello fundebug&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">done</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    http.get(<span class=\"string\">&quot;http://localhost:8000&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span></div><div class=\"line\">    {</div><div class=\"line\">        res.setEncoding(<span class=\"string\">&quot;utf8&quot;</span>);</div><div class=\"line\">        res.on(<span class=\"string\">&quot;data&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">text</span>)</span></div><div class=\"line\">        {</div><div class=\"line\">            assert.equal(res.statusCode, <span class=\"number\">200</span>);</div><div class=\"line\">            assert.equal(text, <span class=\"string\">&quot;Hello Fundebug&quot;</span>);</div><div class=\"line\">            done();</div><div class=\"line\">        });</div><div class=\"line\">    });</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x503C;&#x5F97;&#x7A0D;&#x5FAE;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;http.get&#x8BBF;&#x95EE;HTTP&#x63A5;&#x53E3;&#x662F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x3002;<strong>Mocha&#x5728;&#x6D4B;&#x8BD5;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x662F;&#x9700;&#x8981;&#x4E3A;it&#x51FD;&#x6570;&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x51FD;&#x6570;done</strong>&#xFF0C;&#x5728;&#x65AD;&#x8A00;&#x7ED3;&#x675F;&#x7684;&#x5730;&#x65B9;&#x8C03;&#x7528;done&#xFF0C;&#x8FD9;&#x6837;Mocha&#x624D;&#x80FD;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7ED3;&#x675F;&#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x3002;</p>\n<p>&#x65E2;&#x7136;Node.js&#x81EA;&#x5E26;&#x7684;&#x6A21;&#x5757;&#x5C31;&#x80FD;&#x591F;&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x8981;<a href=\"https://github.com/visionmedia/supertest\">SuperTest</a>&#x5462;&#xFF1F;&#x4E0D;&#x59A8;&#x5148;&#x770B;&#x4E00;&#x4E0B;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;<strong><a href=\"https://github.com/Fundebug/nodejs-unit-test/blob/master/test/test5.js\">test5.js</a></strong>:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;supertest&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> server = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;../server.js&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> assert = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;assert&quot;</span>);</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">it(<span class=\"string\">&quot;should return hello fundebug&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">done</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    request(server)</div><div class=\"line\">        .get(<span class=\"string\">&quot;/&quot;</span>)</div><div class=\"line\">        .expect(<span class=\"number\">200</span>)</div><div class=\"line\">        .expect(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span></div><div class=\"line\">        {</div><div class=\"line\">            assert.equal(res.text, <span class=\"string\">&quot;Hello Fundebug&quot;</span>);</div><div class=\"line\">        })</div><div class=\"line\">        .end(done);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x5BF9;&#x6BD4;&#x4E24;&#x4E2A;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x540E;&#x8005;&#x7B80;&#x6D01;&#x5F88;&#x591A;&#x3002;</p>\n<h4 id=\"&#x539F;&#x7406;-2\"><a href=\"#&#x539F;&#x7406;-2\" class=\"headerlink\" title=\"&#x539F;&#x7406;\"></a>&#x539F;&#x7406;</h4><blockquote>\n<p>SuperTest&#x5C01;&#x88C5;&#x4E86;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x7B80;&#x5355;&#x7684;expect&#x65AD;&#x8A00;&#x6765;&#x5224;&#x5B9A;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x5BF9;&#x4E8E;POST&#x63A5;&#x53E3;&#xFF0C;&#x4F7F;&#x7528;SuperTest&#x7684;&#x4F18;&#x52BF;&#x5C06;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;Node.js&#x7684;http&#x6A21;&#x5757;&#x53D1;&#x9001;POST&#x8BF7;&#x6C42;&#x662F;&#x5F88;&#x9EBB;&#x70E6;&#x7684;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"><a href=\"#&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\" class=\"headerlink\" title=\"&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;\"></a>&#x8981;&#x505A;&#x591A;&#x5C11;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF1F;</h3><p>&#x672C;&#x6587;&#x6240;&#x5199;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5934;&#x75DB;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x4FEE;&#x6539;&#x4E86;&#x4EE3;&#x7801;&#x6709;&#x65F6;&#x610F;&#x5473;&#x7740;&#x5FC5;&#x987B;&#x4FEE;&#x6539;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x5199;&#x4E86;&#x65B0;&#x7684;&#x51FD;&#x6570;&#x6216;&#x8005;API&#x5C31;&#x5F97;&#x5199;&#x65B0;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;&#x5982;&#x679C;&#x8F83;&#x771F;&#x8D77;&#x6765;&#xFF0C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x6CA1;&#x5B8C;&#x6CA1;&#x4E86;&#x5730;&#x5199;&#xFF0C;&#x4F46;&#x8FD9;&#x662F;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;&#x800C;&#x6839;&#x636E;&#x4E8C;&#x516B;&#x539F;&#x7406;&#xFF0C;20%&#x7684;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;80%&#x7684;&#x95EE;&#x9898;&#x3002;&#x5269;&#x4E0B;&#x7684;20%&#x95EE;&#x9898;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x6211;&#x4EEC;&#x662F;&#x529B;&#x4E0D;&#x4ECE;&#x5FC3;&#x7684;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x60F3;&#x901A;&#x8FC7;&#x6D4B;&#x8BD5;&#x6D88;&#x9664;&#x6240;&#x6709;BUG&#xFF0C;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x751F;&#x4EA7;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x5B9E;&#x65F6;&#x9519;&#x8BEF;&#x76D1;&#x6D4B;&#x662F;&#x975E;&#x5E38;&#x6709;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x6211;&#x4EEC;<a href=\"https://fundebug.com/\">Fundebug</a>&#x52AA;&#x529B;&#x5728;&#x505A;&#x7684;&#x4E8B;&#x60C5;:) &#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x52A0;&#x5165;&#x6211;&#x4EEC;&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;</strong>:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/03/20/nodejs-unit-test/nodejs-qq-group.jpeg\"><br></div>\n\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html\">&#x6D4B;&#x8BD5;&#x6846;&#x67B6; Mocha &#x5B9E;&#x4F8B;&#x6559;&#x7A0B; - &#x962E;&#x4E00;&#x5CF0;</a></li>\n<li><a href=\"http://coolshell.cn/articles/8209.html\">&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x8981;&#x505A;&#x591A;&#x7EC6; - &#x9177;&#x58F3;</a></li>\n<li><a href=\"http://www.yinwang.org/blog-cn/2016/09/14/tests\">&#x6D4B;&#x8BD5;&#x7684;&#x9053;&#x7406; -&#x738B;&#x57A0;</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Pareto_principle\">Pareto principle</a></li>\n</ul>"},{"title":"当Node.js遇见Docker","date":"2017-03-26T13:00:00.000Z","_content":"\n\n[Node.js Best Practices - How to Become a Better Developer in 2017](https://blog.risingstack.com/node-js-best-practices-2017/)提到的几点，[我们Fundebug](https://fundebug.com/)深有同感:\n\n- 使用ES6\n- 使用Promise\n- 使用LTS\n- 使用[Docker](https://www.docker.com/)\n- ...\n\n<!-- more -->\n\n想必大家都知道ES6，Promise以及LTS，那[Docker](https://www.docker.com/)是啥玩意啊？翻遍[Node文档](https://nodejs.org/api/)也没见踪迹啊!\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-docker/nodejs-docker.png\" />\n</div>\n\n**GitHub仓库:** [Fundebug/nodejs-docker](https://github.com/Fundebug/nodejs-docker)\n\n### 什么是Docker?\n\nDocker是最流行的的容器工具，**没有之一**。本文并不打算深入介绍Docker，不过可以从几个简单的角度来理解Docker。\n\n##### 从进程的角度理解Docker\n\n在Linux中，所有的进程构成了一棵树。可以使用[pstree](http://man7.org/linux/man-pages/man1/pstree.1.html)命令进行查看:\n\n```bash\npstree\ninit─┬─VBoxService───7*[{VBoxService}]\n     ├─acpid\n     ├─atd\n     ├─cron\n     ├─dbus-daemon\n     ├─dhclient\n     ├─dockerd─┬─docker-containe─┬─docker-containe─┬─redis-server───2*[{redis-server}]\n     │         │                 │                 └─8*[{docker-containe}]\n     │         │                 ├─docker-containe─┬─mongod───16*[{mongod}]\n     │         │                 │                 └─8*[{docker-containe}]\n     │         │                 └─11*[{docker-containe}]\n     │         └─13*[{dockerd}]\n     ├─6*[getty]\n     ├─influxd───9*[{influxd}]\n     ├─irqbalance\n     ├─puppet───{puppet}\n     ├─rpc.idmapd\n     ├─rpc.statd\n     ├─rpcbind\n     ├─rsyslogd───3*[{rsyslogd}]\n     ├─ruby───{ruby}\n     ├─sshd─┬─sshd───sshd───zsh───pstree\n     │      ├─sshd───sshd───zsh\n     │      └─sshd───sshd───zsh───mongo───2*[{mongo}]\n     ├─systemd-logind\n     ├─systemd-udevd\n     ├─upstart-file-br\n     ├─upstart-socket-\n     └─upstart-udev-br\n```\n\n可知，init进程为所有进程的根(root)，其PID为1。\n\nDocker将不同应用的进程隔离了起来，这些被隔离的进程就是一个个容器。隔离是基于两个Linux内核机制实现的，Namesapce和Cgroups。\n\nNamespace可以从UTD、IPC、PID、Mount，User和Network的角度隔离进程。比如，不同的进程将拥有不同PID空间，这样容器中的进程将看不到主机上的进程，也看不到其他容器中的进程。这与Node.js中模块化以隔离变量的命名空间的思想是异曲同工的。\n\n通过Cgroups，可以限制进程对CPU，内存等资源的使用。简单地说，我们可以通过Cgroups指定容器只能使用1G内存。\n\n从进程角度理解Docker，那**每一个Docker容器就是被隔离的进程及其子进程**。上文pstree的输出中可以分辨出2个容器: mongodb和redis。\n\n\n##### 从文件的角度理解Docker\n\n基于Namespace与Cgroups的容器工具其实早已存在，例如[Linux-VServer](http://linux-vserver.org/Welcome_to_Linux-VServer.org)，[OpenVZ](https://openvz.org/Main_Page)，[LXC](https://linuxcontainers.org/)。然而，真正引爆容器技术的却是后来者Docker。为什么呢？个人觉得是因为**Docker镜像**以及**Dockerfile**。\n\n在Linux中，一切皆文件，进程的运行离不开各种各样的文件。跑一个简单的Node.js程序，传统的做法是手动安装各种依赖然后运行；而Docker则是将所有依赖（包括操作系统，Node，NPM模块，源代码）打包到一个**Docker镜像**中，然后基于这个镜像运行容器。\n\n**Docker镜像**可以通过**Docker仓库**共享给其他人，这样他们只需要下载镜像即可运行程序。想象一下，当我们需要在另一台主机(比如生产服务器，新同事的机器)上运行一个Node.js应用，仅仅需要下载对应的Docker镜像就可以了，是不是很方便呢？\n\n**Docker镜像**可以通过文本文件，即**Dockerfile**进行定义。不妨看一个简单的例子(由于不可抗力，这个Dockerfile构建大概会失败，仅作为参考):\n\n```\n# 基于Ubuntu\nFROM ubuntu\n\n# 安装Node.js与NPM\nRUN apt-get update && apt-get -y install nodejs npm\n\n# 安装NPM模块:Express\nRUN npm install express\n\n# 添加源代码\nADD app.js /\n```\n\n其中，**FROM**，**RUN**与**ADD**为Dockerfile命令。结合注释，该Dockerfile的含义非常直白。基于这个Dockerfile，使用**docker build**命令就可以构建对应的Docker镜像。基于这个Docker镜像，就可以运行Docker容器来执行app.js:\n\n```js\nvar express = require(\"express\");\nvar app = express();\n\napp.get(\"/\", function(req, res)\n{\n    res.send(\"Hello Fundebug!\\n\");\n});\n\napp.listen(3000);\n```\n\nDockerfile实际上是将**Docker镜像代码化**了，另一方面也是将**安装依赖的过程代码化**了，于是我们就可以像管理源码一样使用git对Dockerfile进行版本管理。\n\n### 为啥用Docker?\n\n当你的系统越来越复杂的时候，你会发现Docker的价值。\n\n##### 从应用架构角度理解Docker\n\n刚开始，你只需要写一个Node.js程序，挂载一个静态网站；然后，你做了一个用户账号系统，这时需要数据库了，比如说MySQL; 后来，为了提升性能，你引入了Memcached缓存；终于有一天，你决定把前后端分离，这样可以提高开发效率；当用户越来越多，你又不得不使用Nginx做反向代理; 对了，随着功能越来越多，你的应用依赖也会越来越多...总之，你的应用架构只会越来越复杂。不同的组件的安装，配置与运行步骤各不相同，于是你不得不写一个很长的文档给新同事，只为了让他搭建一个**开发环境**。\n\n使用Docker的话，你可以为不同的组件逐一编写Dockerfile，分别构建镜像，然后运行在各个容器中。这样做，将复杂的架构统一了，所有组件的安装和运行步骤统一为几个简单的命令: \n\n- 构建Docker镜像: docker build\n- 上传Docker镜像: docker push\n- 下载Docker镜像: docker pull\n- 运行Docker容器: docker run\n\n##### 从应用部署角度理解Docker\n\n通常，你会有**开发**，**测试**和**生产**服务器，对于某些应用，还会需要进行**构建**。不同步骤的依赖会有一些不同，并且在不同的服务器上执行。如果手动地在不同的服务器上安装依赖，是件很麻烦的事情。比如说，当你需要为Node.js应用添加一个新的npm模块，或者升级一下Node.js，是不是得重复操作很多次？友情提示一下，手动敲命令是极易出错的，有些失误会导致致命的后果（参考最近Gitlab误删数据库与AWS的S3故障）。\n\n如果使用Docker的话，**开发**、**构建**、**测试**、**生产**将全部在Docker容器中执行，你需要为不同步骤编写不同的Dockerfile。当依赖变化时，仅需要稍微修改Dockerfile即可。结合构建工具[Jenkins](https://jenkins.io/)，就可以将整个部署流程自动化。\n\n另一方面，Dockerfile将Docker镜像描述得非常精准，能够保证很强的一致性。比如，操作系统的版本，Node.js的版本，NPM模块的版本等。这就意味着，在本地开发环境运行成功的镜像，在**构建**、**测试**、**生产**环境中也没有问题。还有，不同的Docker容器是依赖于不同的Docker镜像，这样他们互不干扰。比如，两个Node.js应用可以分别使用不同版本的Node.js。\n\n##### 从集群管理角度理解Docker\n\n架构规模越来越大的时候，你有必要引入集群了。这就意味着，服务器由1台变成了多台，同一个应用需要运行多个备份来分担负载。当然，你可以手动对集群的功能进行划分: Nginx服务器，Node.js服务器，MySQL服务器，测试服务器，生产服务器...这样做的好处是简单粗暴；也可以说财大气粗，因为资源闲置会非常严重。还有一点，每次新增节点的时候，你就不得不花大量时间进行安装与配置，这其实是一种低效的重复劳动。\n\n下载Docker镜像之后，Docker容器可以运行在集群的任何一个节点。一方面，各个组件可以共享主机，且互不干扰；另一方面，也不需要在集群的节点上安装和配置任何组件。至于整个Docker集群的管理，业界有很多成熟的解决方案，例如[Mesos](http://mesos.apache.org/)，[Kubernetes](https://kubernetes.io/)与[Docker Swarm](https://github.com/docker/swarm)。这些集群系统提供了**调度**，**服务发现**，**负载均衡**等功能，让整个集群变成一个整体。\n\n### 如何用Docker?\n\n##### 编写Dockerfile\n\n正确的[Dockerfile](https://github.com/Fundebug/nodejs-docker/blob/master/Dockerfile)是这样的:\n\n```\n# 使用DaoCloud的Ubuntu镜像\nFROM daocloud.io/library/ubuntu:14.04\n\n# 设置镜像作者\nMAINTAINER Fundebug <help@fundebug.com>\n\n# 设置时区\nRUN sudo sh -c \"echo 'Asia/Shanghai' > /etc/timezone\" && \\\n    sudo dpkg-reconfigure -f noninteractive tzdata\n\n# 使用阿里云的Ubuntu镜像\nRUN echo '\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n'\\\n> /etc/apt/sources.list\n\n# 安装node v6.10.1\nRUN sudo apt-get update && sudo apt-get install -y wget\n\n# 使用淘宝镜像安装Node.js v6.10.1\nRUN wget https://npm.taobao.org/mirrors/node/v6.10.1/node-v6.10.1-linux-x64.tar.gz && \\\n    tar -C /usr/local --strip-components 1 -xzf node-v6.10.1-linux-x64.tar.gz && \\\n    rm node-v6.10.1-linux-x64.tar.gz \n\nWORKDIR /app\n\n# 安装npm模块\nADD package.json /app/package.json\n\n# 使用淘宝的npm镜像\nRUN npm install --production -d --registry=https://registry.npm.taobao.org\n\n# 添加源代码\nADD . /app\n\n# 运行app.js\nCMD [\"node\", \"/app/app.js\"]\n```\n\n有几点值得注意的地方：\n\n- 使用国内[DaoCloud](https://www.daocloud.io/)的Docker仓库，阿里云的ubuntu镜像以及淘宝的npm镜像，否则会出事情的;\n- 将时区设为Asia/Shanghai，否则日志的时间会不大对劲;\n- 使用.dockerignore忽略不需要添加到Docker镜像的文件和目录，其语法与.gitigore一致;\n\n更重要的一点是，**package.json需要单独添加**。Docker在构建镜像的时候，是一层一层构建的，仅当这一层有变化时，重新构建对应的层。如果package.json和源代码一起添加到镜像，则每次修改源码都需要重新安装npm模块，这样木有必要。所以，正确的顺序是: 添加package.json；安装npm模块；添加源代码。\n\n##### 构建Docker镜像\n\n使用**docker build**命令构建Docker镜像\n\n```bash\nsudo docker build -t fundebug/nodejs .\n```\n\n其中，-t选项用于指定镜像的名称。\n\n使用**docker images**命令查看Docker镜像\n\n```bash\nsudo docker images\nREPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE\nfundebug/nodejs               latest              64530ce811a1        32 minutes ago      266.4 MB\ndaocloud.io/library/ubuntu    14.04               b969ab9f929b        9 weeks ago         188 MB\n```\n\n可知，fundebug/nodejs镜像的大小为266.4MB，在ubuntu镜像的基础上增加了80MB左右。\n\n##### 运行Docker容器\n\n使用**docker run**命令运行Docker容器\n\n```bash\nsudo docker run -d --net=host --name=hello-fundebug fundebug/nodejs\n```\n\n其中，-d选项表示容器在后台运行；--net选项指定容器的网络模式，host表示与主机共享网络；--name指定了容器的名称。\n\n使用**docker ps**命令查看Docker容器\n\n```bash\nsudo docker ps\nCONTAINER ID        IMAGE                             COMMAND                  CREATED             STATUS              PORTS               NAMES\ne8eb5473970c        fundebug/nodejs                   \"node /app/app.js\"       37 minutes ago      Up 37 minutes                           hello-\n```\n\n可知，COMMAND为\"node /app/app.js\"，表示容器中运行的命令。这是我们再Dockerfile中使用CMD指定的。不妨使用**docker exec**命令在容器内执行ps命令**查看容器内的进程**：\n\n```bash\nsudo docker exec hello-fundebug ps -f\nUID        PID  PPID  C STIME TTY          TIME CMD\nroot         1     0  0 15:14 ?        00:00:00 node /app/app.js\n```\n\n可知，容器内的1号进程即为node进程**node /app/app.js**。在Linux中，PID为1进程按说是唯一的，即init进程。但是，容器使用了内核的Namespace机制，为容器创建了独立的PID空间，因此容器中也有1号进程。\n\n##### 测试\n\n使用curl命令访问:\n\n```bash\ncurl localhost:3000\nHello Fundebug!\n```\n\n### 是否用Docker？\n\n一方面，使用Docker能够带来很大益处；另一方面，引入Docker必然会有很多挑战，需要熟悉Docker才能应对自如。**想必这是一个艰难的决定**。如果从长远的角度来看，Docker正在成为应用开发，部署，发布的标准技术，也许我们不得不用开放的心态对待它。\n\n作为Node.js开发者，真正理解Docker可能需要一些时间，但是它可以给你带来很多便利。欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群**，老司机带你玩转酷炫的Docker技术。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-docker/nodejs-qq-group.jpeg\" />\n</div>\n\n\n### 参考链接\n\n- [DOCKER基础技术：LINUX NAMESPACE（上）](http://coolshell.cn/articles/17010.html)\n- [DOCKER基础技术：LINUX NAMESPACE（下）](http://coolshell.cn/articles/17029.html)\n- [DOCKER基础技术：LINUX CGROUP](http://coolshell.cn/articles/17049.html)\n- [从GITLAB误删除数据库想到的](http://coolshell.cn/articles/17680.html)\n- [AWS 的 S3 故障回顾和思考](http://coolshell.cn/articles/17737.html)\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/03/26/nodejs-docker.md","raw":"---\n\ntitle: 当Node.js遇见Docker\n\ndate: 2017-03-26 21:00:00\n\ntags: [Node.js, Docker]\n\n---\n\n\n[Node.js Best Practices - How to Become a Better Developer in 2017](https://blog.risingstack.com/node-js-best-practices-2017/)提到的几点，[我们Fundebug](https://fundebug.com/)深有同感:\n\n- 使用ES6\n- 使用Promise\n- 使用LTS\n- 使用[Docker](https://www.docker.com/)\n- ...\n\n<!-- more -->\n\n想必大家都知道ES6，Promise以及LTS，那[Docker](https://www.docker.com/)是啥玩意啊？翻遍[Node文档](https://nodejs.org/api/)也没见踪迹啊!\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-docker/nodejs-docker.png\" />\n</div>\n\n**GitHub仓库:** [Fundebug/nodejs-docker](https://github.com/Fundebug/nodejs-docker)\n\n### 什么是Docker?\n\nDocker是最流行的的容器工具，**没有之一**。本文并不打算深入介绍Docker，不过可以从几个简单的角度来理解Docker。\n\n##### 从进程的角度理解Docker\n\n在Linux中，所有的进程构成了一棵树。可以使用[pstree](http://man7.org/linux/man-pages/man1/pstree.1.html)命令进行查看:\n\n```bash\npstree\ninit─┬─VBoxService───7*[{VBoxService}]\n     ├─acpid\n     ├─atd\n     ├─cron\n     ├─dbus-daemon\n     ├─dhclient\n     ├─dockerd─┬─docker-containe─┬─docker-containe─┬─redis-server───2*[{redis-server}]\n     │         │                 │                 └─8*[{docker-containe}]\n     │         │                 ├─docker-containe─┬─mongod───16*[{mongod}]\n     │         │                 │                 └─8*[{docker-containe}]\n     │         │                 └─11*[{docker-containe}]\n     │         └─13*[{dockerd}]\n     ├─6*[getty]\n     ├─influxd───9*[{influxd}]\n     ├─irqbalance\n     ├─puppet───{puppet}\n     ├─rpc.idmapd\n     ├─rpc.statd\n     ├─rpcbind\n     ├─rsyslogd───3*[{rsyslogd}]\n     ├─ruby───{ruby}\n     ├─sshd─┬─sshd───sshd───zsh───pstree\n     │      ├─sshd───sshd───zsh\n     │      └─sshd───sshd───zsh───mongo───2*[{mongo}]\n     ├─systemd-logind\n     ├─systemd-udevd\n     ├─upstart-file-br\n     ├─upstart-socket-\n     └─upstart-udev-br\n```\n\n可知，init进程为所有进程的根(root)，其PID为1。\n\nDocker将不同应用的进程隔离了起来，这些被隔离的进程就是一个个容器。隔离是基于两个Linux内核机制实现的，Namesapce和Cgroups。\n\nNamespace可以从UTD、IPC、PID、Mount，User和Network的角度隔离进程。比如，不同的进程将拥有不同PID空间，这样容器中的进程将看不到主机上的进程，也看不到其他容器中的进程。这与Node.js中模块化以隔离变量的命名空间的思想是异曲同工的。\n\n通过Cgroups，可以限制进程对CPU，内存等资源的使用。简单地说，我们可以通过Cgroups指定容器只能使用1G内存。\n\n从进程角度理解Docker，那**每一个Docker容器就是被隔离的进程及其子进程**。上文pstree的输出中可以分辨出2个容器: mongodb和redis。\n\n\n##### 从文件的角度理解Docker\n\n基于Namespace与Cgroups的容器工具其实早已存在，例如[Linux-VServer](http://linux-vserver.org/Welcome_to_Linux-VServer.org)，[OpenVZ](https://openvz.org/Main_Page)，[LXC](https://linuxcontainers.org/)。然而，真正引爆容器技术的却是后来者Docker。为什么呢？个人觉得是因为**Docker镜像**以及**Dockerfile**。\n\n在Linux中，一切皆文件，进程的运行离不开各种各样的文件。跑一个简单的Node.js程序，传统的做法是手动安装各种依赖然后运行；而Docker则是将所有依赖（包括操作系统，Node，NPM模块，源代码）打包到一个**Docker镜像**中，然后基于这个镜像运行容器。\n\n**Docker镜像**可以通过**Docker仓库**共享给其他人，这样他们只需要下载镜像即可运行程序。想象一下，当我们需要在另一台主机(比如生产服务器，新同事的机器)上运行一个Node.js应用，仅仅需要下载对应的Docker镜像就可以了，是不是很方便呢？\n\n**Docker镜像**可以通过文本文件，即**Dockerfile**进行定义。不妨看一个简单的例子(由于不可抗力，这个Dockerfile构建大概会失败，仅作为参考):\n\n```\n# 基于Ubuntu\nFROM ubuntu\n\n# 安装Node.js与NPM\nRUN apt-get update && apt-get -y install nodejs npm\n\n# 安装NPM模块:Express\nRUN npm install express\n\n# 添加源代码\nADD app.js /\n```\n\n其中，**FROM**，**RUN**与**ADD**为Dockerfile命令。结合注释，该Dockerfile的含义非常直白。基于这个Dockerfile，使用**docker build**命令就可以构建对应的Docker镜像。基于这个Docker镜像，就可以运行Docker容器来执行app.js:\n\n```js\nvar express = require(\"express\");\nvar app = express();\n\napp.get(\"/\", function(req, res)\n{\n    res.send(\"Hello Fundebug!\\n\");\n});\n\napp.listen(3000);\n```\n\nDockerfile实际上是将**Docker镜像代码化**了，另一方面也是将**安装依赖的过程代码化**了，于是我们就可以像管理源码一样使用git对Dockerfile进行版本管理。\n\n### 为啥用Docker?\n\n当你的系统越来越复杂的时候，你会发现Docker的价值。\n\n##### 从应用架构角度理解Docker\n\n刚开始，你只需要写一个Node.js程序，挂载一个静态网站；然后，你做了一个用户账号系统，这时需要数据库了，比如说MySQL; 后来，为了提升性能，你引入了Memcached缓存；终于有一天，你决定把前后端分离，这样可以提高开发效率；当用户越来越多，你又不得不使用Nginx做反向代理; 对了，随着功能越来越多，你的应用依赖也会越来越多...总之，你的应用架构只会越来越复杂。不同的组件的安装，配置与运行步骤各不相同，于是你不得不写一个很长的文档给新同事，只为了让他搭建一个**开发环境**。\n\n使用Docker的话，你可以为不同的组件逐一编写Dockerfile，分别构建镜像，然后运行在各个容器中。这样做，将复杂的架构统一了，所有组件的安装和运行步骤统一为几个简单的命令: \n\n- 构建Docker镜像: docker build\n- 上传Docker镜像: docker push\n- 下载Docker镜像: docker pull\n- 运行Docker容器: docker run\n\n##### 从应用部署角度理解Docker\n\n通常，你会有**开发**，**测试**和**生产**服务器，对于某些应用，还会需要进行**构建**。不同步骤的依赖会有一些不同，并且在不同的服务器上执行。如果手动地在不同的服务器上安装依赖，是件很麻烦的事情。比如说，当你需要为Node.js应用添加一个新的npm模块，或者升级一下Node.js，是不是得重复操作很多次？友情提示一下，手动敲命令是极易出错的，有些失误会导致致命的后果（参考最近Gitlab误删数据库与AWS的S3故障）。\n\n如果使用Docker的话，**开发**、**构建**、**测试**、**生产**将全部在Docker容器中执行，你需要为不同步骤编写不同的Dockerfile。当依赖变化时，仅需要稍微修改Dockerfile即可。结合构建工具[Jenkins](https://jenkins.io/)，就可以将整个部署流程自动化。\n\n另一方面，Dockerfile将Docker镜像描述得非常精准，能够保证很强的一致性。比如，操作系统的版本，Node.js的版本，NPM模块的版本等。这就意味着，在本地开发环境运行成功的镜像，在**构建**、**测试**、**生产**环境中也没有问题。还有，不同的Docker容器是依赖于不同的Docker镜像，这样他们互不干扰。比如，两个Node.js应用可以分别使用不同版本的Node.js。\n\n##### 从集群管理角度理解Docker\n\n架构规模越来越大的时候，你有必要引入集群了。这就意味着，服务器由1台变成了多台，同一个应用需要运行多个备份来分担负载。当然，你可以手动对集群的功能进行划分: Nginx服务器，Node.js服务器，MySQL服务器，测试服务器，生产服务器...这样做的好处是简单粗暴；也可以说财大气粗，因为资源闲置会非常严重。还有一点，每次新增节点的时候，你就不得不花大量时间进行安装与配置，这其实是一种低效的重复劳动。\n\n下载Docker镜像之后，Docker容器可以运行在集群的任何一个节点。一方面，各个组件可以共享主机，且互不干扰；另一方面，也不需要在集群的节点上安装和配置任何组件。至于整个Docker集群的管理，业界有很多成熟的解决方案，例如[Mesos](http://mesos.apache.org/)，[Kubernetes](https://kubernetes.io/)与[Docker Swarm](https://github.com/docker/swarm)。这些集群系统提供了**调度**，**服务发现**，**负载均衡**等功能，让整个集群变成一个整体。\n\n### 如何用Docker?\n\n##### 编写Dockerfile\n\n正确的[Dockerfile](https://github.com/Fundebug/nodejs-docker/blob/master/Dockerfile)是这样的:\n\n```\n# 使用DaoCloud的Ubuntu镜像\nFROM daocloud.io/library/ubuntu:14.04\n\n# 设置镜像作者\nMAINTAINER Fundebug <help@fundebug.com>\n\n# 设置时区\nRUN sudo sh -c \"echo 'Asia/Shanghai' > /etc/timezone\" && \\\n    sudo dpkg-reconfigure -f noninteractive tzdata\n\n# 使用阿里云的Ubuntu镜像\nRUN echo '\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n'\\\n> /etc/apt/sources.list\n\n# 安装node v6.10.1\nRUN sudo apt-get update && sudo apt-get install -y wget\n\n# 使用淘宝镜像安装Node.js v6.10.1\nRUN wget https://npm.taobao.org/mirrors/node/v6.10.1/node-v6.10.1-linux-x64.tar.gz && \\\n    tar -C /usr/local --strip-components 1 -xzf node-v6.10.1-linux-x64.tar.gz && \\\n    rm node-v6.10.1-linux-x64.tar.gz \n\nWORKDIR /app\n\n# 安装npm模块\nADD package.json /app/package.json\n\n# 使用淘宝的npm镜像\nRUN npm install --production -d --registry=https://registry.npm.taobao.org\n\n# 添加源代码\nADD . /app\n\n# 运行app.js\nCMD [\"node\", \"/app/app.js\"]\n```\n\n有几点值得注意的地方：\n\n- 使用国内[DaoCloud](https://www.daocloud.io/)的Docker仓库，阿里云的ubuntu镜像以及淘宝的npm镜像，否则会出事情的;\n- 将时区设为Asia/Shanghai，否则日志的时间会不大对劲;\n- 使用.dockerignore忽略不需要添加到Docker镜像的文件和目录，其语法与.gitigore一致;\n\n更重要的一点是，**package.json需要单独添加**。Docker在构建镜像的时候，是一层一层构建的，仅当这一层有变化时，重新构建对应的层。如果package.json和源代码一起添加到镜像，则每次修改源码都需要重新安装npm模块，这样木有必要。所以，正确的顺序是: 添加package.json；安装npm模块；添加源代码。\n\n##### 构建Docker镜像\n\n使用**docker build**命令构建Docker镜像\n\n```bash\nsudo docker build -t fundebug/nodejs .\n```\n\n其中，-t选项用于指定镜像的名称。\n\n使用**docker images**命令查看Docker镜像\n\n```bash\nsudo docker images\nREPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE\nfundebug/nodejs               latest              64530ce811a1        32 minutes ago      266.4 MB\ndaocloud.io/library/ubuntu    14.04               b969ab9f929b        9 weeks ago         188 MB\n```\n\n可知，fundebug/nodejs镜像的大小为266.4MB，在ubuntu镜像的基础上增加了80MB左右。\n\n##### 运行Docker容器\n\n使用**docker run**命令运行Docker容器\n\n```bash\nsudo docker run -d --net=host --name=hello-fundebug fundebug/nodejs\n```\n\n其中，-d选项表示容器在后台运行；--net选项指定容器的网络模式，host表示与主机共享网络；--name指定了容器的名称。\n\n使用**docker ps**命令查看Docker容器\n\n```bash\nsudo docker ps\nCONTAINER ID        IMAGE                             COMMAND                  CREATED             STATUS              PORTS               NAMES\ne8eb5473970c        fundebug/nodejs                   \"node /app/app.js\"       37 minutes ago      Up 37 minutes                           hello-\n```\n\n可知，COMMAND为\"node /app/app.js\"，表示容器中运行的命令。这是我们再Dockerfile中使用CMD指定的。不妨使用**docker exec**命令在容器内执行ps命令**查看容器内的进程**：\n\n```bash\nsudo docker exec hello-fundebug ps -f\nUID        PID  PPID  C STIME TTY          TIME CMD\nroot         1     0  0 15:14 ?        00:00:00 node /app/app.js\n```\n\n可知，容器内的1号进程即为node进程**node /app/app.js**。在Linux中，PID为1进程按说是唯一的，即init进程。但是，容器使用了内核的Namespace机制，为容器创建了独立的PID空间，因此容器中也有1号进程。\n\n##### 测试\n\n使用curl命令访问:\n\n```bash\ncurl localhost:3000\nHello Fundebug!\n```\n\n### 是否用Docker？\n\n一方面，使用Docker能够带来很大益处；另一方面，引入Docker必然会有很多挑战，需要熟悉Docker才能应对自如。**想必这是一个艰难的决定**。如果从长远的角度来看，Docker正在成为应用开发，部署，发布的标准技术，也许我们不得不用开放的心态对待它。\n\n作为Node.js开发者，真正理解Docker可能需要一些时间，但是它可以给你带来很多便利。欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群**，老司机带你玩转酷炫的Docker技术。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-docker/nodejs-qq-group.jpeg\" />\n</div>\n\n\n### 参考链接\n\n- [DOCKER基础技术：LINUX NAMESPACE（上）](http://coolshell.cn/articles/17010.html)\n- [DOCKER基础技术：LINUX NAMESPACE（下）](http://coolshell.cn/articles/17029.html)\n- [DOCKER基础技术：LINUX CGROUP](http://coolshell.cn/articles/17049.html)\n- [从GITLAB误删除数据库想到的](http://coolshell.cn/articles/17680.html)\n- [AWS 的 S3 故障回顾和思考](http://coolshell.cn/articles/17737.html)\n\n\n\n\n\n\n\n\n\n","slug":"2017/03/26/nodejs-docker","published":1,"updated":"2017-03-26T12:18:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywend001gmkfyqxxfzzyg","content":"<p><a href=\"https://blog.risingstack.com/node-js-best-practices-2017/\" target=\"_blank\" rel=\"external\">Node.js Best Practices - How to Become a Better Developer in 2017</a>&#x63D0;&#x5230;&#x7684;&#x51E0;&#x70B9;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x6DF1;&#x6709;&#x540C;&#x611F;:</p>\n<ul>\n<li>&#x4F7F;&#x7528;ES6</li>\n<li>&#x4F7F;&#x7528;Promise</li>\n<li>&#x4F7F;&#x7528;LTS</li>\n<li>&#x4F7F;&#x7528;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a></li>\n<li>&#x2026;</li>\n</ul>\n<a id=\"more\"></a>\n<p>&#x60F3;&#x5FC5;&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;ES6&#xFF0C;Promise&#x4EE5;&#x53CA;LTS&#xFF0C;&#x90A3;<a href=\"https://www.docker.com/\" target=\"_blank\" rel=\"external\">Docker</a>&#x662F;&#x5565;&#x73A9;&#x610F;&#x554A;&#xFF1F;&#x7FFB;&#x904D;<a href=\"https://nodejs.org/api/\" target=\"_blank\" rel=\"external\">Node&#x6587;&#x6863;</a>&#x4E5F;&#x6CA1;&#x89C1;&#x8E2A;&#x8FF9;&#x554A;!</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/26/nodejs-docker/nodejs-docker.png\"><br></div>\n\n<p><strong>GitHub&#x4ED3;&#x5E93;:</strong> <a href=\"https://github.com/Fundebug/nodejs-docker\" target=\"_blank\" rel=\"external\">Fundebug/nodejs-docker</a></p>\n<h3 id=\"&#x4EC0;&#x4E48;&#x662F;Docker\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;Docker\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;Docker?\"></a>&#x4EC0;&#x4E48;&#x662F;Docker?</h3><p>Docker&#x662F;&#x6700;&#x6D41;&#x884C;&#x7684;&#x7684;&#x5BB9;&#x5668;&#x5DE5;&#x5177;&#xFF0C;<strong>&#x6CA1;&#x6709;&#x4E4B;&#x4E00;</strong>&#x3002;&#x672C;&#x6587;&#x5E76;&#x4E0D;&#x6253;&#x7B97;&#x6DF1;&#x5165;&#x4ECB;&#x7ECD;Docker&#xFF0C;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x4ECE;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x7406;&#x89E3;Docker&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x5728;Linux&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8FDB;&#x7A0B;&#x6784;&#x6210;&#x4E86;&#x4E00;&#x68F5;&#x6811;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"http://man7.org/linux/man-pages/man1/pstree.1.html\" target=\"_blank\" rel=\"external\">pstree</a>&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">pstree</div><div class=\"line\">init&#x2500;&#x252C;&#x2500;VBoxService&#x2500;&#x2500;&#x2500;7*[{VBoxService}]</div><div class=\"line\">     &#x251C;&#x2500;acpid</div><div class=\"line\">     &#x251C;&#x2500;atd</div><div class=\"line\">     &#x251C;&#x2500;cron</div><div class=\"line\">     &#x251C;&#x2500;dbus-daemon</div><div class=\"line\">     &#x251C;&#x2500;dhclient</div><div class=\"line\">     &#x251C;&#x2500;dockerd&#x2500;&#x252C;&#x2500;docker-containe&#x2500;&#x252C;&#x2500;docker-containe&#x2500;&#x252C;&#x2500;redis-server&#x2500;&#x2500;&#x2500;2*[{redis-server}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x2502;                 &#x2514;&#x2500;8*[{docker-containe}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x251C;&#x2500;docker-containe&#x2500;&#x252C;&#x2500;mongod&#x2500;&#x2500;&#x2500;16*[{mongod}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x2502;                 &#x2514;&#x2500;8*[{docker-containe}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x2514;&#x2500;11*[{docker-containe}]</div><div class=\"line\">     &#x2502;         &#x2514;&#x2500;13*[{dockerd}]</div><div class=\"line\">     &#x251C;&#x2500;6*[getty]</div><div class=\"line\">     &#x251C;&#x2500;influxd&#x2500;&#x2500;&#x2500;9*[{influxd}]</div><div class=\"line\">     &#x251C;&#x2500;irqbalance</div><div class=\"line\">     &#x251C;&#x2500;puppet&#x2500;&#x2500;&#x2500;{puppet}</div><div class=\"line\">     &#x251C;&#x2500;rpc.idmapd</div><div class=\"line\">     &#x251C;&#x2500;rpc.statd</div><div class=\"line\">     &#x251C;&#x2500;rpcbind</div><div class=\"line\">     &#x251C;&#x2500;rsyslogd&#x2500;&#x2500;&#x2500;3*[{rsyslogd}]</div><div class=\"line\">     &#x251C;&#x2500;ruby&#x2500;&#x2500;&#x2500;{ruby}</div><div class=\"line\">     &#x251C;&#x2500;sshd&#x2500;&#x252C;&#x2500;sshd&#x2500;&#x2500;&#x2500;sshd&#x2500;&#x2500;&#x2500;zsh&#x2500;&#x2500;&#x2500;pstree</div><div class=\"line\">     &#x2502;      &#x251C;&#x2500;sshd&#x2500;&#x2500;&#x2500;sshd&#x2500;&#x2500;&#x2500;zsh</div><div class=\"line\">     &#x2502;      &#x2514;&#x2500;sshd&#x2500;&#x2500;&#x2500;sshd&#x2500;&#x2500;&#x2500;zsh&#x2500;&#x2500;&#x2500;mongo&#x2500;&#x2500;&#x2500;2*[{mongo}]</div><div class=\"line\">     &#x251C;&#x2500;systemd-logind</div><div class=\"line\">     &#x251C;&#x2500;systemd-udevd</div><div class=\"line\">     &#x251C;&#x2500;upstart-file-br</div><div class=\"line\">     &#x251C;&#x2500;upstart-socket-</div><div class=\"line\">     &#x2514;&#x2500;upstart-udev-br</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;init&#x8FDB;&#x7A0B;&#x4E3A;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x7684;&#x6839;(root)&#xFF0C;&#x5176;PID&#x4E3A;1&#x3002;</p>\n<p>Docker&#x5C06;&#x4E0D;&#x540C;&#x5E94;&#x7528;&#x7684;&#x8FDB;&#x7A0B;&#x9694;&#x79BB;&#x4E86;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x4E9B;&#x88AB;&#x9694;&#x79BB;&#x7684;&#x8FDB;&#x7A0B;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x9694;&#x79BB;&#x662F;&#x57FA;&#x4E8E;&#x4E24;&#x4E2A;Linux&#x5185;&#x6838;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;Namesapce&#x548C;Cgroups&#x3002;</p>\n<p>Namespace&#x53EF;&#x4EE5;&#x4ECE;UTD&#x3001;IPC&#x3001;PID&#x3001;Mount&#xFF0C;User&#x548C;Network&#x7684;&#x89D2;&#x5EA6;&#x9694;&#x79BB;&#x8FDB;&#x7A0B;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x62E5;&#x6709;&#x4E0D;&#x540C;PID&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x770B;&#x4E0D;&#x5230;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x770B;&#x4E0D;&#x5230;&#x5176;&#x4ED6;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x4E0E;Node.js&#x4E2D;&#x6A21;&#x5757;&#x5316;&#x4EE5;&#x9694;&#x79BB;&#x53D8;&#x91CF;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x601D;&#x60F3;&#x662F;&#x5F02;&#x66F2;&#x540C;&#x5DE5;&#x7684;&#x3002;</p>\n<p>&#x901A;&#x8FC7;Cgroups&#xFF0C;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x8FDB;&#x7A0B;&#x5BF9;CPU&#xFF0C;&#x5185;&#x5B58;&#x7B49;&#x8D44;&#x6E90;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Cgroups&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x53EA;&#x80FD;&#x4F7F;&#x7528;1G&#x5185;&#x5B58;&#x3002;</p>\n<p>&#x4ECE;&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker&#xFF0C;&#x90A3;<strong>&#x6BCF;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x5C31;&#x662F;&#x88AB;&#x9694;&#x79BB;&#x7684;&#x8FDB;&#x7A0B;&#x53CA;&#x5176;&#x5B50;&#x8FDB;&#x7A0B;</strong>&#x3002;&#x4E0A;&#x6587;pstree&#x7684;&#x8F93;&#x51FA;&#x4E2D;&#x53EF;&#x4EE5;&#x5206;&#x8FA8;&#x51FA;2&#x4E2A;&#x5BB9;&#x5668;: mongodb&#x548C;redis&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x57FA;&#x4E8E;Namespace&#x4E0E;Cgroups&#x7684;&#x5BB9;&#x5668;&#x5DE5;&#x5177;&#x5176;&#x5B9E;&#x65E9;&#x5DF2;&#x5B58;&#x5728;&#xFF0C;&#x4F8B;&#x5982;<a href=\"http://linux-vserver.org/Welcome_to_Linux-VServer.org\" target=\"_blank\" rel=\"external\">Linux-VServer</a>&#xFF0C;<a href=\"https://openvz.org/Main_Page\" target=\"_blank\" rel=\"external\">OpenVZ</a>&#xFF0C;<a href=\"https://linuxcontainers.org/\" target=\"_blank\" rel=\"external\">LXC</a>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x771F;&#x6B63;&#x5F15;&#x7206;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x5374;&#x662F;&#x540E;&#x6765;&#x8005;Docker&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x662F;&#x56E0;&#x4E3A;<strong>Docker&#x955C;&#x50CF;</strong>&#x4EE5;&#x53CA;<strong>Dockerfile</strong>&#x3002;</p>\n<p>&#x5728;Linux&#x4E2D;&#xFF0C;&#x4E00;&#x5207;&#x7686;&#x6587;&#x4EF6;&#xFF0C;&#x8FDB;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x79BB;&#x4E0D;&#x5F00;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x8DD1;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;Node.js&#x7A0B;&#x5E8F;&#xFF0C;&#x4F20;&#x7EDF;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x624B;&#x52A8;&#x5B89;&#x88C5;&#x5404;&#x79CD;&#x4F9D;&#x8D56;&#x7136;&#x540E;&#x8FD0;&#x884C;&#xFF1B;&#x800C;Docker&#x5219;&#x662F;&#x5C06;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#xFF08;&#x5305;&#x62EC;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;Node&#xFF0C;NPM&#x6A21;&#x5757;&#xFF0C;&#x6E90;&#x4EE3;&#x7801;&#xFF09;&#x6253;&#x5305;&#x5230;&#x4E00;&#x4E2A;<strong>Docker&#x955C;&#x50CF;</strong>&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;</p>\n<p><strong>Docker&#x955C;&#x50CF;</strong>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>Docker&#x4ED3;&#x5E93;</strong>&#x5171;&#x4EAB;&#x7ED9;&#x5176;&#x4ED6;&#x4EBA;&#xFF0C;&#x8FD9;&#x6837;&#x4ED6;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x5373;&#x53EF;&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x3002;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x53E6;&#x4E00;&#x53F0;&#x4E3B;&#x673A;(&#x6BD4;&#x5982;&#x751F;&#x4EA7;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x65B0;&#x540C;&#x4E8B;&#x7684;&#x673A;&#x5668;)&#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;Node.js&#x5E94;&#x7528;&#xFF0C;&#x4EC5;&#x4EC5;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x5BF9;&#x5E94;&#x7684;Docker&#x955C;&#x50CF;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x65B9;&#x4FBF;&#x5462;&#xFF1F;</p>\n<p><strong>Docker&#x955C;&#x50CF;</strong>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6587;&#x672C;&#x6587;&#x4EF6;&#xFF0C;&#x5373;<strong>Dockerfile</strong>&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x3002;&#x4E0D;&#x59A8;&#x770B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;(&#x7531;&#x4E8E;&#x4E0D;&#x53EF;&#x6297;&#x529B;&#xFF0C;&#x8FD9;&#x4E2A;Dockerfile&#x6784;&#x5EFA;&#x5927;&#x6982;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x4EC5;&#x4F5C;&#x4E3A;&#x53C2;&#x8003;):</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x57FA;&#x4E8E;Ubuntu</span></div><div class=\"line\"><span class=\"keyword\">FROM</span> ubuntu</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;Node.js&#x4E0E;NPM</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> apt-get update &amp;&amp; apt-get -y install nodejs npm</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;NPM&#x6A21;&#x5757;:Express</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm install express</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x6DFB;&#x52A0;&#x6E90;&#x4EE3;&#x7801;</span></div><div class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> app.js /</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>FROM</strong>&#xFF0C;<strong>RUN</strong>&#x4E0E;<strong>ADD</strong>&#x4E3A;Dockerfile&#x547D;&#x4EE4;&#x3002;&#x7ED3;&#x5408;&#x6CE8;&#x91CA;&#xFF0C;&#x8BE5;Dockerfile&#x7684;&#x542B;&#x4E49;&#x975E;&#x5E38;&#x76F4;&#x767D;&#x3002;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;Dockerfile&#xFF0C;&#x4F7F;&#x7528;<strong>docker build</strong>&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;Docker&#x955C;&#x50CF;&#x3002;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;Docker&#x955C;&#x50CF;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x6765;&#x6267;&#x884C;app.js:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> app = express();</div><div class=\"line\"></div><div class=\"line\">app.get(<span class=\"string\">&quot;/&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    res.send(<span class=\"string\">&quot;Hello Fundebug!\\n&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\">app.listen(<span class=\"number\">3000</span>);</div></pre></td></tr></table></figure>\n<p>Dockerfile&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;<strong>Docker&#x955C;&#x50CF;&#x4EE3;&#x7801;&#x5316;</strong>&#x4E86;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E5F;&#x662F;&#x5C06;<strong>&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x7684;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#x5316;</strong>&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x50CF;&#x7BA1;&#x7406;&#x6E90;&#x7801;&#x4E00;&#x6837;&#x4F7F;&#x7528;git&#x5BF9;Dockerfile&#x8FDB;&#x884C;&#x7248;&#x672C;&#x7BA1;&#x7406;&#x3002;</p>\n<h3 id=\"&#x4E3A;&#x5565;&#x7528;Docker\"><a href=\"#&#x4E3A;&#x5565;&#x7528;Docker\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x7528;Docker?\"></a>&#x4E3A;&#x5565;&#x7528;Docker?</h3><p>&#x5F53;&#x4F60;&#x7684;&#x7CFB;&#x7EDF;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;Docker&#x7684;&#x4EF7;&#x503C;&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x521A;&#x5F00;&#x59CB;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x5199;&#x4E00;&#x4E2A;Node.js&#x7A0B;&#x5E8F;&#xFF0C;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x7F51;&#x7AD9;&#xFF1B;&#x7136;&#x540E;&#xFF0C;&#x4F60;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x8D26;&#x53F7;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x6570;&#x636E;&#x5E93;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;MySQL; &#x540E;&#x6765;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x6027;&#x80FD;&#xFF0C;&#x4F60;&#x5F15;&#x5165;&#x4E86;Memcached&#x7F13;&#x5B58;&#xFF1B;&#x7EC8;&#x4E8E;&#x6709;&#x4E00;&#x5929;&#xFF0C;&#x4F60;&#x51B3;&#x5B9A;&#x628A;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF1B;&#x5F53;&#x7528;&#x6237;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x4F60;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x4F7F;&#x7528;Nginx&#x505A;&#x53CD;&#x5411;&#x4EE3;&#x7406;; &#x5BF9;&#x4E86;&#xFF0C;&#x968F;&#x7740;&#x529F;&#x80FD;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x4F9D;&#x8D56;&#x4E5F;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x2026;&#x603B;&#x4E4B;&#xFF0C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x53EA;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x914D;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x6B65;&#x9AA4;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x4E8E;&#x662F;&#x4F60;&#x4E0D;&#x5F97;&#x4E0D;&#x5199;&#x4E00;&#x4E2A;&#x5F88;&#x957F;&#x7684;&#x6587;&#x6863;&#x7ED9;&#x65B0;&#x540C;&#x4E8B;&#xFF0C;&#x53EA;&#x4E3A;&#x4E86;&#x8BA9;&#x4ED6;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;<strong>&#x5F00;&#x53D1;&#x73AF;&#x5883;</strong>&#x3002;</p>\n<p>&#x4F7F;&#x7528;Docker&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#x9010;&#x4E00;&#x7F16;&#x5199;Dockerfile&#xFF0C;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x5C06;&#x590D;&#x6742;&#x7684;&#x67B6;&#x6784;&#x7EDF;&#x4E00;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x8FD0;&#x884C;&#x6B65;&#x9AA4;&#x7EDF;&#x4E00;&#x4E3A;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;: </p>\n<ul>\n<li>&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;: docker build</li>\n<li>&#x4E0A;&#x4F20;Docker&#x955C;&#x50CF;: docker push</li>\n<li>&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;: docker pull</li>\n<li>&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;: docker run</li>\n</ul>\n<h5 id=\"&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x901A;&#x5E38;&#xFF0C;&#x4F60;&#x4F1A;&#x6709;<strong>&#x5F00;&#x53D1;</strong>&#xFF0C;<strong>&#x6D4B;&#x8BD5;</strong>&#x548C;<strong>&#x751F;&#x4EA7;</strong>&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#xFF0C;&#x8FD8;&#x4F1A;&#x9700;&#x8981;&#x8FDB;&#x884C;<strong>&#x6784;&#x5EFA;</strong>&#x3002;&#x4E0D;&#x540C;&#x6B65;&#x9AA4;&#x7684;&#x4F9D;&#x8D56;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x4E0D;&#x540C;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6267;&#x884C;&#x3002;&#x5982;&#x679C;&#x624B;&#x52A8;&#x5730;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#xFF0C;&#x662F;&#x4EF6;&#x5F88;&#x9EBB;&#x70E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x4E3A;Node.js&#x5E94;&#x7528;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x7684;npm&#x6A21;&#x5757;&#xFF0C;&#x6216;&#x8005;&#x5347;&#x7EA7;&#x4E00;&#x4E0B;Node.js&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F97;&#x91CD;&#x590D;&#x64CD;&#x4F5C;&#x5F88;&#x591A;&#x6B21;&#xFF1F;&#x53CB;&#x60C5;&#x63D0;&#x793A;&#x4E00;&#x4E0B;&#xFF0C;&#x624B;&#x52A8;&#x6572;&#x547D;&#x4EE4;&#x662F;&#x6781;&#x6613;&#x51FA;&#x9519;&#x7684;&#xFF0C;&#x6709;&#x4E9B;&#x5931;&#x8BEF;&#x4F1A;&#x5BFC;&#x81F4;&#x81F4;&#x547D;&#x7684;&#x540E;&#x679C;&#xFF08;&#x53C2;&#x8003;&#x6700;&#x8FD1;Gitlab&#x8BEF;&#x5220;&#x6570;&#x636E;&#x5E93;&#x4E0E;AWS&#x7684;S3&#x6545;&#x969C;&#xFF09;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F7F;&#x7528;Docker&#x7684;&#x8BDD;&#xFF0C;<strong>&#x5F00;&#x53D1;</strong>&#x3001;<strong>&#x6784;&#x5EFA;</strong>&#x3001;<strong>&#x6D4B;&#x8BD5;</strong>&#x3001;<strong>&#x751F;&#x4EA7;</strong>&#x5C06;&#x5168;&#x90E8;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x4E3A;&#x4E0D;&#x540C;&#x6B65;&#x9AA4;&#x7F16;&#x5199;&#x4E0D;&#x540C;&#x7684;Dockerfile&#x3002;&#x5F53;&#x4F9D;&#x8D56;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x4EC5;&#x9700;&#x8981;&#x7A0D;&#x5FAE;&#x4FEE;&#x6539;Dockerfile&#x5373;&#x53EF;&#x3002;&#x7ED3;&#x5408;&#x6784;&#x5EFA;&#x5DE5;&#x5177;<a href=\"https://jenkins.io/\" target=\"_blank\" rel=\"external\">Jenkins</a>&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x6574;&#x4E2A;&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#x81EA;&#x52A8;&#x5316;&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;Dockerfile&#x5C06;Docker&#x955C;&#x50CF;&#x63CF;&#x8FF0;&#x5F97;&#x975E;&#x5E38;&#x7CBE;&#x51C6;&#xFF0C;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x5F88;&#x5F3A;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x7248;&#x672C;&#xFF0C;Node.js&#x7684;&#x7248;&#x672C;&#xFF0C;NPM&#x6A21;&#x5757;&#x7684;&#x7248;&#x672C;&#x7B49;&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5728;<strong>&#x6784;&#x5EFA;</strong>&#x3001;<strong>&#x6D4B;&#x8BD5;</strong>&#x3001;<strong>&#x751F;&#x4EA7;</strong>&#x73AF;&#x5883;&#x4E2D;&#x4E5F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x8FD8;&#x6709;&#xFF0C;&#x4E0D;&#x540C;&#x7684;Docker&#x5BB9;&#x5668;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x4E0D;&#x540C;&#x7684;Docker&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x4ED6;&#x4EEC;&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4E24;&#x4E2A;Node.js&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;Node.js&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x67B6;&#x6784;&#x89C4;&#x6A21;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x6709;&#x5FC5;&#x8981;&#x5F15;&#x5165;&#x96C6;&#x7FA4;&#x4E86;&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7531;1&#x53F0;&#x53D8;&#x6210;&#x4E86;&#x591A;&#x53F0;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x5907;&#x4EFD;&#x6765;&#x5206;&#x62C5;&#x8D1F;&#x8F7D;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x5BF9;&#x96C6;&#x7FA4;&#x7684;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x5212;&#x5206;: Nginx&#x670D;&#x52A1;&#x5668;&#xFF0C;Node.js&#x670D;&#x52A1;&#x5668;&#xFF0C;MySQL&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6D4B;&#x8BD5;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x751F;&#x4EA7;&#x670D;&#x52A1;&#x5668;&#x2026;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#x7B80;&#x5355;&#x7C97;&#x66B4;&#xFF1B;&#x4E5F;&#x53EF;&#x4EE5;&#x8BF4;&#x8D22;&#x5927;&#x6C14;&#x7C97;&#xFF0C;&#x56E0;&#x4E3A;&#x8D44;&#x6E90;&#x95F2;&#x7F6E;&#x4F1A;&#x975E;&#x5E38;&#x4E25;&#x91CD;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#xFF0C;&#x6BCF;&#x6B21;&#x65B0;&#x589E;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x82B1;&#x5927;&#x91CF;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x79CD;&#x4F4E;&#x6548;&#x7684;&#x91CD;&#x590D;&#x52B3;&#x52A8;&#x3002;</p>\n<p>&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;&#x4E4B;&#x540E;&#xFF0C;Docker&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x5728;&#x96C6;&#x7FA4;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x4E3B;&#x673A;&#xFF0C;&#x4E14;&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x96C6;&#x7FA4;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#x4EFB;&#x4F55;&#x7EC4;&#x4EF6;&#x3002;&#x81F3;&#x4E8E;&#x6574;&#x4E2A;Docker&#x96C6;&#x7FA4;&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x4E1A;&#x754C;&#x6709;&#x5F88;&#x591A;&#x6210;&#x719F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4F8B;&#x5982;<a href=\"http://mesos.apache.org/\" target=\"_blank\" rel=\"external\">Mesos</a>&#xFF0C;<a href=\"https://kubernetes.io/\" target=\"_blank\" rel=\"external\">Kubernetes</a>&#x4E0E;<a href=\"https://github.com/docker/swarm\" target=\"_blank\" rel=\"external\">Docker Swarm</a>&#x3002;&#x8FD9;&#x4E9B;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x4E86;<strong>&#x8C03;&#x5EA6;</strong>&#xFF0C;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#xFF0C;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7B49;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x3002;</p>\n<h3 id=\"&#x5982;&#x4F55;&#x7528;Docker\"><a href=\"#&#x5982;&#x4F55;&#x7528;Docker\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x7528;Docker?\"></a>&#x5982;&#x4F55;&#x7528;Docker?</h3><h5 id=\"&#x7F16;&#x5199;Dockerfile\"><a href=\"#&#x7F16;&#x5199;Dockerfile\" class=\"headerlink\" title=\"&#x7F16;&#x5199;Dockerfile\"></a>&#x7F16;&#x5199;Dockerfile</h5><p>&#x6B63;&#x786E;&#x7684;<a href=\"https://github.com/Fundebug/nodejs-docker/blob/master/Dockerfile\" target=\"_blank\" rel=\"external\">Dockerfile</a>&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;DaoCloud&#x7684;Ubuntu&#x955C;&#x50CF;</span></div><div class=\"line\"><span class=\"keyword\">FROM</span> daocloud.io/library/ubuntu:<span class=\"number\">14.04</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x8BBE;&#x7F6E;&#x955C;&#x50CF;&#x4F5C;&#x8005;</span></div><div class=\"line\"><span class=\"keyword\">MAINTAINER</span> Fundebug &lt;help@fundebug.com&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x8BBE;&#x7F6E;&#x65F6;&#x533A;</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> sudo sh -c <span class=\"string\">&quot;echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone&quot;</span> &amp;&amp; \\</span></div><div class=\"line\">    sudo dpkg-reconfigure <span class=\"_\">-f</span> noninteractive tzdata</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;&#x963F;&#x91CC;&#x4E91;&#x7684;Ubuntu&#x955C;&#x50CF;</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&apos;\\n\\</span></span></div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n&apos;\\</div><div class=\"line\">&gt; /etc/apt/sources.list</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;node v6.10.1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> sudo apt-get update &amp;&amp; sudo apt-get install -y wget</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;&#x6DD8;&#x5B9D;&#x955C;&#x50CF;&#x5B89;&#x88C5;Node.js v6.10.1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> wget https://npm.taobao.org/mirrors/node/v6.10.1/node-v6.10.1-linux-x64.tar.gz &amp;&amp; \\</span></div><div class=\"line\">    tar -C /usr/<span class=\"built_in\">local</span> --strip-components 1 -xzf node-v6.10.1-linux-x64.tar.gz &amp;&amp; \\</div><div class=\"line\">    rm node-v6.10.1-linux-x64.tar.gz </div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /app</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;npm&#x6A21;&#x5757;</span></div><div class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> package.json /app/package.json</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;&#x6DD8;&#x5B9D;&#x7684;npm&#x955C;&#x50CF;</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm install --production <span class=\"_\">-d</span> --registry=https://registry.npm.taobao.org</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x6DFB;&#x52A0;&#x6E90;&#x4EE3;&#x7801;</span></div><div class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> . /app</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x8FD0;&#x884C;app.js</span></div><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;node&quot;</span>, <span class=\"string\">&quot;/app/app.js&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p>&#x6709;&#x51E0;&#x70B9;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#xFF1A;</p>\n<ul>\n<li>&#x4F7F;&#x7528;&#x56FD;&#x5185;<a href=\"https://www.daocloud.io/\" target=\"_blank\" rel=\"external\">DaoCloud</a>&#x7684;Docker&#x4ED3;&#x5E93;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x7684;ubuntu&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x6DD8;&#x5B9D;&#x7684;npm&#x955C;&#x50CF;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x4E8B;&#x60C5;&#x7684;;</li>\n<li>&#x5C06;&#x65F6;&#x533A;&#x8BBE;&#x4E3A;Asia/Shanghai&#xFF0C;&#x5426;&#x5219;&#x65E5;&#x5FD7;&#x7684;&#x65F6;&#x95F4;&#x4F1A;&#x4E0D;&#x5927;&#x5BF9;&#x52B2;;</li>\n<li>&#x4F7F;&#x7528;.dockerignore&#x5FFD;&#x7565;&#x4E0D;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5230;Docker&#x955C;&#x50CF;&#x7684;&#x6587;&#x4EF6;&#x548C;&#x76EE;&#x5F55;&#xFF0C;&#x5176;&#x8BED;&#x6CD5;&#x4E0E;.gitigore&#x4E00;&#x81F4;;</li>\n</ul>\n<p>&#x66F4;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;<strong>package.json&#x9700;&#x8981;&#x5355;&#x72EC;&#x6DFB;&#x52A0;</strong>&#x3002;Docker&#x5728;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x4E00;&#x5C42;&#x4E00;&#x5C42;&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x4EC5;&#x5F53;&#x8FD9;&#x4E00;&#x5C42;&#x6709;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x5C42;&#x3002;&#x5982;&#x679C;package.json&#x548C;&#x6E90;&#x4EE3;&#x7801;&#x4E00;&#x8D77;&#x6DFB;&#x52A0;&#x5230;&#x955C;&#x50CF;&#xFF0C;&#x5219;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x6E90;&#x7801;&#x90FD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B89;&#x88C5;npm&#x6A21;&#x5757;&#xFF0C;&#x8FD9;&#x6837;&#x6728;&#x6709;&#x5FC5;&#x8981;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x6B63;&#x786E;&#x7684;&#x987A;&#x5E8F;&#x662F;: &#x6DFB;&#x52A0;package.json&#xFF1B;&#x5B89;&#x88C5;npm&#x6A21;&#x5757;&#xFF1B;&#x6DFB;&#x52A0;&#x6E90;&#x4EE3;&#x7801;&#x3002;</p>\n<h5 id=\"&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"><a href=\"#&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"></a>&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</h5><p>&#x4F7F;&#x7528;<strong>docker build</strong>&#x547D;&#x4EE4;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker build -t fundebug/nodejs .</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;-t&#x9009;&#x9879;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x955C;&#x50CF;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<p>&#x4F7F;&#x7528;<strong>docker images</strong>&#x547D;&#x4EE4;&#x67E5;&#x770B;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div><div class=\"line\">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</div><div class=\"line\">fundebug/nodejs               latest              64530ce811a1        32 minutes ago      266.4 MB</div><div class=\"line\">daocloud.io/library/ubuntu    14.04               b969ab9f929b        9 weeks ago         188 MB</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;fundebug/nodejs&#x955C;&#x50CF;&#x7684;&#x5927;&#x5C0F;&#x4E3A;266.4MB&#xFF0C;&#x5728;ubuntu&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;80MB&#x5DE6;&#x53F3;&#x3002;</p>\n<h5 id=\"&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"></a>&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</h5><p>&#x4F7F;&#x7528;<strong>docker run</strong>&#x547D;&#x4EE4;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run <span class=\"_\">-d</span> --net=host --name=hello-fundebug fundebug/nodejs</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;-d&#x9009;&#x9879;&#x8868;&#x793A;&#x5BB9;&#x5668;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF1B;&#x2013;net&#x9009;&#x9879;&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x7F51;&#x7EDC;&#x6A21;&#x5F0F;&#xFF0C;host&#x8868;&#x793A;&#x4E0E;&#x4E3B;&#x673A;&#x5171;&#x4EAB;&#x7F51;&#x7EDC;&#xFF1B;&#x2013;name&#x6307;&#x5B9A;&#x4E86;&#x5BB9;&#x5668;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<p>&#x4F7F;&#x7528;<strong>docker ps</strong>&#x547D;&#x4EE4;&#x67E5;&#x770B;Docker&#x5BB9;&#x5668;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker ps</div><div class=\"line\">CONTAINER ID        IMAGE                             COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class=\"line\">e8eb5473970c        fundebug/nodejs                   <span class=\"string\">&quot;node /app/app.js&quot;</span>       37 minutes ago      Up 37 minutes                           hello-</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;COMMAND&#x4E3A;&#x201D;node /app/app.js&#x201D;&#xFF0C;&#x8868;&#x793A;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x518D;Dockerfile&#x4E2D;&#x4F7F;&#x7528;CMD&#x6307;&#x5B9A;&#x7684;&#x3002;&#x4E0D;&#x59A8;&#x4F7F;&#x7528;<strong>docker exec</strong>&#x547D;&#x4EE4;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x6267;&#x884C;ps&#x547D;&#x4EE4;<strong>&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;</strong>&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"built_in\">exec</span> hello-fundebug ps <span class=\"_\">-f</span></div><div class=\"line\">UID        PID  PPID  C STIME TTY          TIME CMD</div><div class=\"line\">root         1     0  0 15:14 ?        00:00:00 node /app/app.js</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x5373;&#x4E3A;node&#x8FDB;&#x7A0B;<strong>node /app/app.js</strong>&#x3002;&#x5728;Linux&#x4E2D;&#xFF0C;PID&#x4E3A;1&#x8FDB;&#x7A0B;&#x6309;&#x8BF4;&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x5373;init&#x8FDB;&#x7A0B;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x4E86;&#x5185;&#x6838;&#x7684;Namespace&#x673A;&#x5236;&#xFF0C;&#x4E3A;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x4E86;&#x72EC;&#x7ACB;&#x7684;PID&#x7A7A;&#x95F4;&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x4E2D;&#x4E5F;&#x6709;1&#x53F7;&#x8FDB;&#x7A0B;&#x3002;</p>\n<h5 id=\"&#x6D4B;&#x8BD5;\"><a href=\"#&#x6D4B;&#x8BD5;\" class=\"headerlink\" title=\"&#x6D4B;&#x8BD5;\"></a>&#x6D4B;&#x8BD5;</h5><p>&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl localhost:3000</div><div class=\"line\">Hello Fundebug!</div></pre></td></tr></table></figure>\n<h3 id=\"&#x662F;&#x5426;&#x7528;Docker&#xFF1F;\"><a href=\"#&#x662F;&#x5426;&#x7528;Docker&#xFF1F;\" class=\"headerlink\" title=\"&#x662F;&#x5426;&#x7528;Docker&#xFF1F;\"></a>&#x662F;&#x5426;&#x7528;Docker&#xFF1F;</h3><p>&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4F7F;&#x7528;Docker&#x80FD;&#x591F;&#x5E26;&#x6765;&#x5F88;&#x5927;&#x76CA;&#x5904;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5F15;&#x5165;Docker&#x5FC5;&#x7136;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x6311;&#x6218;&#xFF0C;&#x9700;&#x8981;&#x719F;&#x6089;Docker&#x624D;&#x80FD;&#x5E94;&#x5BF9;&#x81EA;&#x5982;&#x3002;<strong>&#x60F3;&#x5FC5;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x8270;&#x96BE;&#x7684;&#x51B3;&#x5B9A;</strong>&#x3002;&#x5982;&#x679C;&#x4ECE;&#x957F;&#x8FDC;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;Docker&#x6B63;&#x5728;&#x6210;&#x4E3A;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#xFF0C;&#x90E8;&#x7F72;&#xFF0C;&#x53D1;&#x5E03;&#x7684;&#x6807;&#x51C6;&#x6280;&#x672F;&#xFF0C;&#x4E5F;&#x8BB8;&#x6211;&#x4EEC;&#x4E0D;&#x5F97;&#x4E0D;&#x7528;&#x5F00;&#x653E;&#x7684;&#x5FC3;&#x6001;&#x5BF9;&#x5F85;&#x5B83;&#x3002;</p>\n<p>&#x4F5C;&#x4E3A;Node.js&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x771F;&#x6B63;&#x7406;&#x89E3;Docker&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x65F6;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x7ED9;&#x4F60;&#x5E26;&#x6765;&#x5F88;&#x591A;&#x4FBF;&#x5229;&#x3002;&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;</strong>&#xFF0C;&#x8001;&#x53F8;&#x673A;&#x5E26;&#x4F60;&#x73A9;&#x8F6C;&#x9177;&#x70AB;&#x7684;Docker&#x6280;&#x672F;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/03/26/nodejs-docker/nodejs-qq-group.jpeg\"><br></div>\n\n\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://coolshell.cn/articles/17010.html\" target=\"_blank\" rel=\"external\">DOCKER&#x57FA;&#x7840;&#x6280;&#x672F;&#xFF1A;LINUX NAMESPACE&#xFF08;&#x4E0A;&#xFF09;</a></li>\n<li><a href=\"http://coolshell.cn/articles/17029.html\" target=\"_blank\" rel=\"external\">DOCKER&#x57FA;&#x7840;&#x6280;&#x672F;&#xFF1A;LINUX NAMESPACE&#xFF08;&#x4E0B;&#xFF09;</a></li>\n<li><a href=\"http://coolshell.cn/articles/17049.html\" target=\"_blank\" rel=\"external\">DOCKER&#x57FA;&#x7840;&#x6280;&#x672F;&#xFF1A;LINUX CGROUP</a></li>\n<li><a href=\"http://coolshell.cn/articles/17680.html\" target=\"_blank\" rel=\"external\">&#x4ECE;GITLAB&#x8BEF;&#x5220;&#x9664;&#x6570;&#x636E;&#x5E93;&#x60F3;&#x5230;&#x7684;</a></li>\n<li><a href=\"http://coolshell.cn/articles/17737.html\" target=\"_blank\" rel=\"external\">AWS &#x7684; S3 &#x6545;&#x969C;&#x56DE;&#x987E;&#x548C;&#x601D;&#x8003;</a></li>\n</ul>\n","excerpt":"<p><a href=\"https://blog.risingstack.com/node-js-best-practices-2017/\">Node.js Best Practices - How to Become a Better Developer in 2017</a>&#x63D0;&#x5230;&#x7684;&#x51E0;&#x70B9;&#xFF0C;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x6DF1;&#x6709;&#x540C;&#x611F;:</p>\n<ul>\n<li>&#x4F7F;&#x7528;ES6</li>\n<li>&#x4F7F;&#x7528;Promise</li>\n<li>&#x4F7F;&#x7528;LTS</li>\n<li>&#x4F7F;&#x7528;<a href=\"https://www.docker.com/\">Docker</a></li>\n<li>&#x2026;</li>\n</ul>","more":"<p>&#x60F3;&#x5FC5;&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;ES6&#xFF0C;Promise&#x4EE5;&#x53CA;LTS&#xFF0C;&#x90A3;<a href=\"https://www.docker.com/\">Docker</a>&#x662F;&#x5565;&#x73A9;&#x610F;&#x554A;&#xFF1F;&#x7FFB;&#x904D;<a href=\"https://nodejs.org/api/\">Node&#x6587;&#x6863;</a>&#x4E5F;&#x6CA1;&#x89C1;&#x8E2A;&#x8FF9;&#x554A;!</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/03/26/nodejs-docker/nodejs-docker.png\"><br></div>\n\n<p><strong>GitHub&#x4ED3;&#x5E93;:</strong> <a href=\"https://github.com/Fundebug/nodejs-docker\">Fundebug/nodejs-docker</a></p>\n<h3 id=\"&#x4EC0;&#x4E48;&#x662F;Docker\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;Docker\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;Docker?\"></a>&#x4EC0;&#x4E48;&#x662F;Docker?</h3><p>Docker&#x662F;&#x6700;&#x6D41;&#x884C;&#x7684;&#x7684;&#x5BB9;&#x5668;&#x5DE5;&#x5177;&#xFF0C;<strong>&#x6CA1;&#x6709;&#x4E4B;&#x4E00;</strong>&#x3002;&#x672C;&#x6587;&#x5E76;&#x4E0D;&#x6253;&#x7B97;&#x6DF1;&#x5165;&#x4ECB;&#x7ECD;Docker&#xFF0C;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x4ECE;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x7406;&#x89E3;Docker&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x8FDB;&#x7A0B;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x5728;Linux&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8FDB;&#x7A0B;&#x6784;&#x6210;&#x4E86;&#x4E00;&#x68F5;&#x6811;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"http://man7.org/linux/man-pages/man1/pstree.1.html\">pstree</a>&#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">pstree</div><div class=\"line\">init&#x2500;&#x252C;&#x2500;VBoxService&#x2500;&#x2500;&#x2500;7*[{VBoxService}]</div><div class=\"line\">     &#x251C;&#x2500;acpid</div><div class=\"line\">     &#x251C;&#x2500;atd</div><div class=\"line\">     &#x251C;&#x2500;cron</div><div class=\"line\">     &#x251C;&#x2500;dbus-daemon</div><div class=\"line\">     &#x251C;&#x2500;dhclient</div><div class=\"line\">     &#x251C;&#x2500;dockerd&#x2500;&#x252C;&#x2500;docker-containe&#x2500;&#x252C;&#x2500;docker-containe&#x2500;&#x252C;&#x2500;redis-server&#x2500;&#x2500;&#x2500;2*[{redis-server}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x2502;                 &#x2514;&#x2500;8*[{docker-containe}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x251C;&#x2500;docker-containe&#x2500;&#x252C;&#x2500;mongod&#x2500;&#x2500;&#x2500;16*[{mongod}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x2502;                 &#x2514;&#x2500;8*[{docker-containe}]</div><div class=\"line\">     &#x2502;         &#x2502;                 &#x2514;&#x2500;11*[{docker-containe}]</div><div class=\"line\">     &#x2502;         &#x2514;&#x2500;13*[{dockerd}]</div><div class=\"line\">     &#x251C;&#x2500;6*[getty]</div><div class=\"line\">     &#x251C;&#x2500;influxd&#x2500;&#x2500;&#x2500;9*[{influxd}]</div><div class=\"line\">     &#x251C;&#x2500;irqbalance</div><div class=\"line\">     &#x251C;&#x2500;puppet&#x2500;&#x2500;&#x2500;{puppet}</div><div class=\"line\">     &#x251C;&#x2500;rpc.idmapd</div><div class=\"line\">     &#x251C;&#x2500;rpc.statd</div><div class=\"line\">     &#x251C;&#x2500;rpcbind</div><div class=\"line\">     &#x251C;&#x2500;rsyslogd&#x2500;&#x2500;&#x2500;3*[{rsyslogd}]</div><div class=\"line\">     &#x251C;&#x2500;ruby&#x2500;&#x2500;&#x2500;{ruby}</div><div class=\"line\">     &#x251C;&#x2500;sshd&#x2500;&#x252C;&#x2500;sshd&#x2500;&#x2500;&#x2500;sshd&#x2500;&#x2500;&#x2500;zsh&#x2500;&#x2500;&#x2500;pstree</div><div class=\"line\">     &#x2502;      &#x251C;&#x2500;sshd&#x2500;&#x2500;&#x2500;sshd&#x2500;&#x2500;&#x2500;zsh</div><div class=\"line\">     &#x2502;      &#x2514;&#x2500;sshd&#x2500;&#x2500;&#x2500;sshd&#x2500;&#x2500;&#x2500;zsh&#x2500;&#x2500;&#x2500;mongo&#x2500;&#x2500;&#x2500;2*[{mongo}]</div><div class=\"line\">     &#x251C;&#x2500;systemd-logind</div><div class=\"line\">     &#x251C;&#x2500;systemd-udevd</div><div class=\"line\">     &#x251C;&#x2500;upstart-file-br</div><div class=\"line\">     &#x251C;&#x2500;upstart-socket-</div><div class=\"line\">     &#x2514;&#x2500;upstart-udev-br</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;init&#x8FDB;&#x7A0B;&#x4E3A;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x7684;&#x6839;(root)&#xFF0C;&#x5176;PID&#x4E3A;1&#x3002;</p>\n<p>Docker&#x5C06;&#x4E0D;&#x540C;&#x5E94;&#x7528;&#x7684;&#x8FDB;&#x7A0B;&#x9694;&#x79BB;&#x4E86;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x4E9B;&#x88AB;&#x9694;&#x79BB;&#x7684;&#x8FDB;&#x7A0B;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x9694;&#x79BB;&#x662F;&#x57FA;&#x4E8E;&#x4E24;&#x4E2A;Linux&#x5185;&#x6838;&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;Namesapce&#x548C;Cgroups&#x3002;</p>\n<p>Namespace&#x53EF;&#x4EE5;&#x4ECE;UTD&#x3001;IPC&#x3001;PID&#x3001;Mount&#xFF0C;User&#x548C;Network&#x7684;&#x89D2;&#x5EA6;&#x9694;&#x79BB;&#x8FDB;&#x7A0B;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x62E5;&#x6709;&#x4E0D;&#x540C;PID&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x5C06;&#x770B;&#x4E0D;&#x5230;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x770B;&#x4E0D;&#x5230;&#x5176;&#x4ED6;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x4E0E;Node.js&#x4E2D;&#x6A21;&#x5757;&#x5316;&#x4EE5;&#x9694;&#x79BB;&#x53D8;&#x91CF;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x601D;&#x60F3;&#x662F;&#x5F02;&#x66F2;&#x540C;&#x5DE5;&#x7684;&#x3002;</p>\n<p>&#x901A;&#x8FC7;Cgroups&#xFF0C;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x8FDB;&#x7A0B;&#x5BF9;CPU&#xFF0C;&#x5185;&#x5B58;&#x7B49;&#x8D44;&#x6E90;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Cgroups&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x53EA;&#x80FD;&#x4F7F;&#x7528;1G&#x5185;&#x5B58;&#x3002;</p>\n<p>&#x4ECE;&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker&#xFF0C;&#x90A3;<strong>&#x6BCF;&#x4E00;&#x4E2A;Docker&#x5BB9;&#x5668;&#x5C31;&#x662F;&#x88AB;&#x9694;&#x79BB;&#x7684;&#x8FDB;&#x7A0B;&#x53CA;&#x5176;&#x5B50;&#x8FDB;&#x7A0B;</strong>&#x3002;&#x4E0A;&#x6587;pstree&#x7684;&#x8F93;&#x51FA;&#x4E2D;&#x53EF;&#x4EE5;&#x5206;&#x8FA8;&#x51FA;2&#x4E2A;&#x5BB9;&#x5668;: mongodb&#x548C;redis&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x6587;&#x4EF6;&#x7684;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x57FA;&#x4E8E;Namespace&#x4E0E;Cgroups&#x7684;&#x5BB9;&#x5668;&#x5DE5;&#x5177;&#x5176;&#x5B9E;&#x65E9;&#x5DF2;&#x5B58;&#x5728;&#xFF0C;&#x4F8B;&#x5982;<a href=\"http://linux-vserver.org/Welcome_to_Linux-VServer.org\">Linux-VServer</a>&#xFF0C;<a href=\"https://openvz.org/Main_Page\">OpenVZ</a>&#xFF0C;<a href=\"https://linuxcontainers.org/\">LXC</a>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x771F;&#x6B63;&#x5F15;&#x7206;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x7684;&#x5374;&#x662F;&#x540E;&#x6765;&#x8005;Docker&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x662F;&#x56E0;&#x4E3A;<strong>Docker&#x955C;&#x50CF;</strong>&#x4EE5;&#x53CA;<strong>Dockerfile</strong>&#x3002;</p>\n<p>&#x5728;Linux&#x4E2D;&#xFF0C;&#x4E00;&#x5207;&#x7686;&#x6587;&#x4EF6;&#xFF0C;&#x8FDB;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x79BB;&#x4E0D;&#x5F00;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x8DD1;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;Node.js&#x7A0B;&#x5E8F;&#xFF0C;&#x4F20;&#x7EDF;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x624B;&#x52A8;&#x5B89;&#x88C5;&#x5404;&#x79CD;&#x4F9D;&#x8D56;&#x7136;&#x540E;&#x8FD0;&#x884C;&#xFF1B;&#x800C;Docker&#x5219;&#x662F;&#x5C06;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#xFF08;&#x5305;&#x62EC;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;Node&#xFF0C;NPM&#x6A21;&#x5757;&#xFF0C;&#x6E90;&#x4EE3;&#x7801;&#xFF09;&#x6253;&#x5305;&#x5230;&#x4E00;&#x4E2A;<strong>Docker&#x955C;&#x50CF;</strong>&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;</p>\n<p><strong>Docker&#x955C;&#x50CF;</strong>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<strong>Docker&#x4ED3;&#x5E93;</strong>&#x5171;&#x4EAB;&#x7ED9;&#x5176;&#x4ED6;&#x4EBA;&#xFF0C;&#x8FD9;&#x6837;&#x4ED6;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x5373;&#x53EF;&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x3002;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x53E6;&#x4E00;&#x53F0;&#x4E3B;&#x673A;(&#x6BD4;&#x5982;&#x751F;&#x4EA7;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x65B0;&#x540C;&#x4E8B;&#x7684;&#x673A;&#x5668;)&#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;Node.js&#x5E94;&#x7528;&#xFF0C;&#x4EC5;&#x4EC5;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x5BF9;&#x5E94;&#x7684;Docker&#x955C;&#x50CF;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x65B9;&#x4FBF;&#x5462;&#xFF1F;</p>\n<p><strong>Docker&#x955C;&#x50CF;</strong>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6587;&#x672C;&#x6587;&#x4EF6;&#xFF0C;&#x5373;<strong>Dockerfile</strong>&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x3002;&#x4E0D;&#x59A8;&#x770B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;(&#x7531;&#x4E8E;&#x4E0D;&#x53EF;&#x6297;&#x529B;&#xFF0C;&#x8FD9;&#x4E2A;Dockerfile&#x6784;&#x5EFA;&#x5927;&#x6982;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x4EC5;&#x4F5C;&#x4E3A;&#x53C2;&#x8003;):</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x57FA;&#x4E8E;Ubuntu</span></div><div class=\"line\"><span class=\"keyword\">FROM</span> ubuntu</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;Node.js&#x4E0E;NPM</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> apt-get update &amp;&amp; apt-get -y install nodejs npm</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;NPM&#x6A21;&#x5757;:Express</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm install express</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x6DFB;&#x52A0;&#x6E90;&#x4EE3;&#x7801;</span></div><div class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> app.js /</span></div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;<strong>FROM</strong>&#xFF0C;<strong>RUN</strong>&#x4E0E;<strong>ADD</strong>&#x4E3A;Dockerfile&#x547D;&#x4EE4;&#x3002;&#x7ED3;&#x5408;&#x6CE8;&#x91CA;&#xFF0C;&#x8BE5;Dockerfile&#x7684;&#x542B;&#x4E49;&#x975E;&#x5E38;&#x76F4;&#x767D;&#x3002;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;Dockerfile&#xFF0C;&#x4F7F;&#x7528;<strong>docker build</strong>&#x547D;&#x4EE4;&#x5C31;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;Docker&#x955C;&#x50CF;&#x3002;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;Docker&#x955C;&#x50CF;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;&#x6765;&#x6267;&#x884C;app.js:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;express&quot;</span>);</div><div class=\"line\"><span class=\"keyword\">var</span> app = express();</div><div class=\"line\"></div><div class=\"line\">app.get(<span class=\"string\">&quot;/&quot;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    res.send(<span class=\"string\">&quot;Hello Fundebug!\\n&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\">app.listen(<span class=\"number\">3000</span>);</div></pre></td></tr></table></figure>\n<p>Dockerfile&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;<strong>Docker&#x955C;&#x50CF;&#x4EE3;&#x7801;&#x5316;</strong>&#x4E86;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E5F;&#x662F;&#x5C06;<strong>&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x7684;&#x8FC7;&#x7A0B;&#x4EE3;&#x7801;&#x5316;</strong>&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x50CF;&#x7BA1;&#x7406;&#x6E90;&#x7801;&#x4E00;&#x6837;&#x4F7F;&#x7528;git&#x5BF9;Dockerfile&#x8FDB;&#x884C;&#x7248;&#x672C;&#x7BA1;&#x7406;&#x3002;</p>\n<h3 id=\"&#x4E3A;&#x5565;&#x7528;Docker\"><a href=\"#&#x4E3A;&#x5565;&#x7528;Docker\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x7528;Docker?\"></a>&#x4E3A;&#x5565;&#x7528;Docker?</h3><p>&#x5F53;&#x4F60;&#x7684;&#x7CFB;&#x7EDF;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;Docker&#x7684;&#x4EF7;&#x503C;&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x521A;&#x5F00;&#x59CB;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x5199;&#x4E00;&#x4E2A;Node.js&#x7A0B;&#x5E8F;&#xFF0C;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x7F51;&#x7AD9;&#xFF1B;&#x7136;&#x540E;&#xFF0C;&#x4F60;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x8D26;&#x53F7;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x6570;&#x636E;&#x5E93;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;MySQL; &#x540E;&#x6765;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x6027;&#x80FD;&#xFF0C;&#x4F60;&#x5F15;&#x5165;&#x4E86;Memcached&#x7F13;&#x5B58;&#xFF1B;&#x7EC8;&#x4E8E;&#x6709;&#x4E00;&#x5929;&#xFF0C;&#x4F60;&#x51B3;&#x5B9A;&#x628A;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF1B;&#x5F53;&#x7528;&#x6237;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x4F60;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x4F7F;&#x7528;Nginx&#x505A;&#x53CD;&#x5411;&#x4EE3;&#x7406;; &#x5BF9;&#x4E86;&#xFF0C;&#x968F;&#x7740;&#x529F;&#x80FD;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x4F9D;&#x8D56;&#x4E5F;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x2026;&#x603B;&#x4E4B;&#xFF0C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x53EA;&#x4F1A;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x914D;&#x7F6E;&#x4E0E;&#x8FD0;&#x884C;&#x6B65;&#x9AA4;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x4E8E;&#x662F;&#x4F60;&#x4E0D;&#x5F97;&#x4E0D;&#x5199;&#x4E00;&#x4E2A;&#x5F88;&#x957F;&#x7684;&#x6587;&#x6863;&#x7ED9;&#x65B0;&#x540C;&#x4E8B;&#xFF0C;&#x53EA;&#x4E3A;&#x4E86;&#x8BA9;&#x4ED6;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;<strong>&#x5F00;&#x53D1;&#x73AF;&#x5883;</strong>&#x3002;</p>\n<p>&#x4F7F;&#x7528;Docker&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#x9010;&#x4E00;&#x7F16;&#x5199;Dockerfile&#xFF0C;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x5728;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x5C06;&#x590D;&#x6742;&#x7684;&#x67B6;&#x6784;&#x7EDF;&#x4E00;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x8FD0;&#x884C;&#x6B65;&#x9AA4;&#x7EDF;&#x4E00;&#x4E3A;&#x51E0;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;: </p>\n<ul>\n<li>&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;: docker build</li>\n<li>&#x4E0A;&#x4F20;Docker&#x955C;&#x50CF;: docker push</li>\n<li>&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;: docker pull</li>\n<li>&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;: docker run</li>\n</ul>\n<h5 id=\"&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x5E94;&#x7528;&#x90E8;&#x7F72;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x901A;&#x5E38;&#xFF0C;&#x4F60;&#x4F1A;&#x6709;<strong>&#x5F00;&#x53D1;</strong>&#xFF0C;<strong>&#x6D4B;&#x8BD5;</strong>&#x548C;<strong>&#x751F;&#x4EA7;</strong>&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#xFF0C;&#x8FD8;&#x4F1A;&#x9700;&#x8981;&#x8FDB;&#x884C;<strong>&#x6784;&#x5EFA;</strong>&#x3002;&#x4E0D;&#x540C;&#x6B65;&#x9AA4;&#x7684;&#x4F9D;&#x8D56;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x4E0D;&#x540C;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6267;&#x884C;&#x3002;&#x5982;&#x679C;&#x624B;&#x52A8;&#x5730;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#xFF0C;&#x662F;&#x4EF6;&#x5F88;&#x9EBB;&#x70E6;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x4E3A;Node.js&#x5E94;&#x7528;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x7684;npm&#x6A21;&#x5757;&#xFF0C;&#x6216;&#x8005;&#x5347;&#x7EA7;&#x4E00;&#x4E0B;Node.js&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F97;&#x91CD;&#x590D;&#x64CD;&#x4F5C;&#x5F88;&#x591A;&#x6B21;&#xFF1F;&#x53CB;&#x60C5;&#x63D0;&#x793A;&#x4E00;&#x4E0B;&#xFF0C;&#x624B;&#x52A8;&#x6572;&#x547D;&#x4EE4;&#x662F;&#x6781;&#x6613;&#x51FA;&#x9519;&#x7684;&#xFF0C;&#x6709;&#x4E9B;&#x5931;&#x8BEF;&#x4F1A;&#x5BFC;&#x81F4;&#x81F4;&#x547D;&#x7684;&#x540E;&#x679C;&#xFF08;&#x53C2;&#x8003;&#x6700;&#x8FD1;Gitlab&#x8BEF;&#x5220;&#x6570;&#x636E;&#x5E93;&#x4E0E;AWS&#x7684;S3&#x6545;&#x969C;&#xFF09;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x4F7F;&#x7528;Docker&#x7684;&#x8BDD;&#xFF0C;<strong>&#x5F00;&#x53D1;</strong>&#x3001;<strong>&#x6784;&#x5EFA;</strong>&#x3001;<strong>&#x6D4B;&#x8BD5;</strong>&#x3001;<strong>&#x751F;&#x4EA7;</strong>&#x5C06;&#x5168;&#x90E8;&#x5728;Docker&#x5BB9;&#x5668;&#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x4E3A;&#x4E0D;&#x540C;&#x6B65;&#x9AA4;&#x7F16;&#x5199;&#x4E0D;&#x540C;&#x7684;Dockerfile&#x3002;&#x5F53;&#x4F9D;&#x8D56;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x4EC5;&#x9700;&#x8981;&#x7A0D;&#x5FAE;&#x4FEE;&#x6539;Dockerfile&#x5373;&#x53EF;&#x3002;&#x7ED3;&#x5408;&#x6784;&#x5EFA;&#x5DE5;&#x5177;<a href=\"https://jenkins.io/\">Jenkins</a>&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x6574;&#x4E2A;&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#x81EA;&#x52A8;&#x5316;&#x3002;</p>\n<p>&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;Dockerfile&#x5C06;Docker&#x955C;&#x50CF;&#x63CF;&#x8FF0;&#x5F97;&#x975E;&#x5E38;&#x7CBE;&#x51C6;&#xFF0C;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x5F88;&#x5F3A;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x7248;&#x672C;&#xFF0C;Node.js&#x7684;&#x7248;&#x672C;&#xFF0C;NPM&#x6A21;&#x5757;&#x7684;&#x7248;&#x672C;&#x7B49;&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x8FD0;&#x884C;&#x6210;&#x529F;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5728;<strong>&#x6784;&#x5EFA;</strong>&#x3001;<strong>&#x6D4B;&#x8BD5;</strong>&#x3001;<strong>&#x751F;&#x4EA7;</strong>&#x73AF;&#x5883;&#x4E2D;&#x4E5F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x8FD8;&#x6709;&#xFF0C;&#x4E0D;&#x540C;&#x7684;Docker&#x5BB9;&#x5668;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x4E0D;&#x540C;&#x7684;Docker&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x4ED6;&#x4EEC;&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4E24;&#x4E2A;Node.js&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;Node.js&#x3002;</p>\n<h5 id=\"&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"><a href=\"#&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\" class=\"headerlink\" title=\"&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker\"></a>&#x4ECE;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x89D2;&#x5EA6;&#x7406;&#x89E3;Docker</h5><p>&#x67B6;&#x6784;&#x89C4;&#x6A21;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x6709;&#x5FC5;&#x8981;&#x5F15;&#x5165;&#x96C6;&#x7FA4;&#x4E86;&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7531;1&#x53F0;&#x53D8;&#x6210;&#x4E86;&#x591A;&#x53F0;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x5907;&#x4EFD;&#x6765;&#x5206;&#x62C5;&#x8D1F;&#x8F7D;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x5BF9;&#x96C6;&#x7FA4;&#x7684;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x5212;&#x5206;: Nginx&#x670D;&#x52A1;&#x5668;&#xFF0C;Node.js&#x670D;&#x52A1;&#x5668;&#xFF0C;MySQL&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6D4B;&#x8BD5;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x751F;&#x4EA7;&#x670D;&#x52A1;&#x5668;&#x2026;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#x7B80;&#x5355;&#x7C97;&#x66B4;&#xFF1B;&#x4E5F;&#x53EF;&#x4EE5;&#x8BF4;&#x8D22;&#x5927;&#x6C14;&#x7C97;&#xFF0C;&#x56E0;&#x4E3A;&#x8D44;&#x6E90;&#x95F2;&#x7F6E;&#x4F1A;&#x975E;&#x5E38;&#x4E25;&#x91CD;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#xFF0C;&#x6BCF;&#x6B21;&#x65B0;&#x589E;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x82B1;&#x5927;&#x91CF;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x4E0E;&#x914D;&#x7F6E;&#xFF0C;&#x8FD9;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x79CD;&#x4F4E;&#x6548;&#x7684;&#x91CD;&#x590D;&#x52B3;&#x52A8;&#x3002;</p>\n<p>&#x4E0B;&#x8F7D;Docker&#x955C;&#x50CF;&#x4E4B;&#x540E;&#xFF0C;Docker&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x5728;&#x96C6;&#x7FA4;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5404;&#x4E2A;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x4E3B;&#x673A;&#xFF0C;&#x4E14;&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x96C6;&#x7FA4;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#x4EFB;&#x4F55;&#x7EC4;&#x4EF6;&#x3002;&#x81F3;&#x4E8E;&#x6574;&#x4E2A;Docker&#x96C6;&#x7FA4;&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x4E1A;&#x754C;&#x6709;&#x5F88;&#x591A;&#x6210;&#x719F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4F8B;&#x5982;<a href=\"http://mesos.apache.org/\">Mesos</a>&#xFF0C;<a href=\"https://kubernetes.io/\">Kubernetes</a>&#x4E0E;<a href=\"https://github.com/docker/swarm\">Docker Swarm</a>&#x3002;&#x8FD9;&#x4E9B;&#x96C6;&#x7FA4;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x4E86;<strong>&#x8C03;&#x5EA6;</strong>&#xFF0C;<strong>&#x670D;&#x52A1;&#x53D1;&#x73B0;</strong>&#xFF0C;<strong>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</strong>&#x7B49;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x3002;</p>\n<h3 id=\"&#x5982;&#x4F55;&#x7528;Docker\"><a href=\"#&#x5982;&#x4F55;&#x7528;Docker\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x7528;Docker?\"></a>&#x5982;&#x4F55;&#x7528;Docker?</h3><h5 id=\"&#x7F16;&#x5199;Dockerfile\"><a href=\"#&#x7F16;&#x5199;Dockerfile\" class=\"headerlink\" title=\"&#x7F16;&#x5199;Dockerfile\"></a>&#x7F16;&#x5199;Dockerfile</h5><p>&#x6B63;&#x786E;&#x7684;<a href=\"https://github.com/Fundebug/nodejs-docker/blob/master/Dockerfile\">Dockerfile</a>&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;DaoCloud&#x7684;Ubuntu&#x955C;&#x50CF;</span></div><div class=\"line\"><span class=\"keyword\">FROM</span> daocloud.io/library/ubuntu:<span class=\"number\">14.04</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x8BBE;&#x7F6E;&#x955C;&#x50CF;&#x4F5C;&#x8005;</span></div><div class=\"line\"><span class=\"keyword\">MAINTAINER</span> Fundebug &lt;help@fundebug.com&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x8BBE;&#x7F6E;&#x65F6;&#x533A;</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> sudo sh -c <span class=\"string\">&quot;echo &apos;Asia/Shanghai&apos; &gt; /etc/timezone&quot;</span> &amp;&amp; \\</span></div><div class=\"line\">    sudo dpkg-reconfigure <span class=\"_\">-f</span> noninteractive tzdata</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;&#x963F;&#x91CC;&#x4E91;&#x7684;Ubuntu&#x955C;&#x50CF;</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&apos;\\n\\</span></span></div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\</div><div class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\\n\\</div><div class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\\n&apos;\\</div><div class=\"line\">&gt; /etc/apt/sources.list</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;node v6.10.1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> sudo apt-get update &amp;&amp; sudo apt-get install -y wget</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;&#x6DD8;&#x5B9D;&#x955C;&#x50CF;&#x5B89;&#x88C5;Node.js v6.10.1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> wget https://npm.taobao.org/mirrors/node/v6.10.1/node-v6.10.1-linux-x64.tar.gz &amp;&amp; \\</span></div><div class=\"line\">    tar -C /usr/<span class=\"built_in\">local</span> --strip-components 1 -xzf node-v6.10.1-linux-x64.tar.gz &amp;&amp; \\</div><div class=\"line\">    rm node-v6.10.1-linux-x64.tar.gz </div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /app</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x5B89;&#x88C5;npm&#x6A21;&#x5757;</span></div><div class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> package.json /app/package.json</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x4F7F;&#x7528;&#x6DD8;&#x5B9D;&#x7684;npm&#x955C;&#x50CF;</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm install --production <span class=\"_\">-d</span> --registry=https://registry.npm.taobao.org</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x6DFB;&#x52A0;&#x6E90;&#x4EE3;&#x7801;</span></div><div class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> . /app</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\"># &#x8FD0;&#x884C;app.js</span></div><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">&quot;node&quot;</span>, <span class=\"string\">&quot;/app/app.js&quot;</span>]</span></div></pre></td></tr></table></figure>\n<p>&#x6709;&#x51E0;&#x70B9;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#xFF1A;</p>\n<ul>\n<li>&#x4F7F;&#x7528;&#x56FD;&#x5185;<a href=\"https://www.daocloud.io/\">DaoCloud</a>&#x7684;Docker&#x4ED3;&#x5E93;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x7684;ubuntu&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x6DD8;&#x5B9D;&#x7684;npm&#x955C;&#x50CF;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x4E8B;&#x60C5;&#x7684;;</li>\n<li>&#x5C06;&#x65F6;&#x533A;&#x8BBE;&#x4E3A;Asia/Shanghai&#xFF0C;&#x5426;&#x5219;&#x65E5;&#x5FD7;&#x7684;&#x65F6;&#x95F4;&#x4F1A;&#x4E0D;&#x5927;&#x5BF9;&#x52B2;;</li>\n<li>&#x4F7F;&#x7528;.dockerignore&#x5FFD;&#x7565;&#x4E0D;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5230;Docker&#x955C;&#x50CF;&#x7684;&#x6587;&#x4EF6;&#x548C;&#x76EE;&#x5F55;&#xFF0C;&#x5176;&#x8BED;&#x6CD5;&#x4E0E;.gitigore&#x4E00;&#x81F4;;</li>\n</ul>\n<p>&#x66F4;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;<strong>package.json&#x9700;&#x8981;&#x5355;&#x72EC;&#x6DFB;&#x52A0;</strong>&#x3002;Docker&#x5728;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x4E00;&#x5C42;&#x4E00;&#x5C42;&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x4EC5;&#x5F53;&#x8FD9;&#x4E00;&#x5C42;&#x6709;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x7684;&#x5C42;&#x3002;&#x5982;&#x679C;package.json&#x548C;&#x6E90;&#x4EE3;&#x7801;&#x4E00;&#x8D77;&#x6DFB;&#x52A0;&#x5230;&#x955C;&#x50CF;&#xFF0C;&#x5219;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x6E90;&#x7801;&#x90FD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B89;&#x88C5;npm&#x6A21;&#x5757;&#xFF0C;&#x8FD9;&#x6837;&#x6728;&#x6709;&#x5FC5;&#x8981;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x6B63;&#x786E;&#x7684;&#x987A;&#x5E8F;&#x662F;: &#x6DFB;&#x52A0;package.json&#xFF1B;&#x5B89;&#x88C5;npm&#x6A21;&#x5757;&#xFF1B;&#x6DFB;&#x52A0;&#x6E90;&#x4EE3;&#x7801;&#x3002;</p>\n<h5 id=\"&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"><a href=\"#&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;\"></a>&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</h5><p>&#x4F7F;&#x7528;<strong>docker build</strong>&#x547D;&#x4EE4;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker build -t fundebug/nodejs .</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;-t&#x9009;&#x9879;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x955C;&#x50CF;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<p>&#x4F7F;&#x7528;<strong>docker images</strong>&#x547D;&#x4EE4;&#x67E5;&#x770B;Docker&#x955C;&#x50CF;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker images</div><div class=\"line\">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</div><div class=\"line\">fundebug/nodejs               latest              64530ce811a1        32 minutes ago      266.4 MB</div><div class=\"line\">daocloud.io/library/ubuntu    14.04               b969ab9f929b        9 weeks ago         188 MB</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;fundebug/nodejs&#x955C;&#x50CF;&#x7684;&#x5927;&#x5C0F;&#x4E3A;266.4MB&#xFF0C;&#x5728;ubuntu&#x955C;&#x50CF;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;80MB&#x5DE6;&#x53F3;&#x3002;</p>\n<h5 id=\"&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"><a href=\"#&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;\"></a>&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</h5><p>&#x4F7F;&#x7528;<strong>docker run</strong>&#x547D;&#x4EE4;&#x8FD0;&#x884C;Docker&#x5BB9;&#x5668;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker run <span class=\"_\">-d</span> --net=host --name=hello-fundebug fundebug/nodejs</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x4E2D;&#xFF0C;-d&#x9009;&#x9879;&#x8868;&#x793A;&#x5BB9;&#x5668;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#xFF1B;&#x2013;net&#x9009;&#x9879;&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x7F51;&#x7EDC;&#x6A21;&#x5F0F;&#xFF0C;host&#x8868;&#x793A;&#x4E0E;&#x4E3B;&#x673A;&#x5171;&#x4EAB;&#x7F51;&#x7EDC;&#xFF1B;&#x2013;name&#x6307;&#x5B9A;&#x4E86;&#x5BB9;&#x5668;&#x7684;&#x540D;&#x79F0;&#x3002;</p>\n<p>&#x4F7F;&#x7528;<strong>docker ps</strong>&#x547D;&#x4EE4;&#x67E5;&#x770B;Docker&#x5BB9;&#x5668;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker ps</div><div class=\"line\">CONTAINER ID        IMAGE                             COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class=\"line\">e8eb5473970c        fundebug/nodejs                   <span class=\"string\">&quot;node /app/app.js&quot;</span>       37 minutes ago      Up 37 minutes                           hello-</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;COMMAND&#x4E3A;&#x201D;node /app/app.js&#x201D;&#xFF0C;&#x8868;&#x793A;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x547D;&#x4EE4;&#x3002;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x518D;Dockerfile&#x4E2D;&#x4F7F;&#x7528;CMD&#x6307;&#x5B9A;&#x7684;&#x3002;&#x4E0D;&#x59A8;&#x4F7F;&#x7528;<strong>docker exec</strong>&#x547D;&#x4EE4;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x6267;&#x884C;ps&#x547D;&#x4EE4;<strong>&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;</strong>&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo docker <span class=\"built_in\">exec</span> hello-fundebug ps <span class=\"_\">-f</span></div><div class=\"line\">UID        PID  PPID  C STIME TTY          TIME CMD</div><div class=\"line\">root         1     0  0 15:14 ?        00:00:00 node /app/app.js</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x7684;1&#x53F7;&#x8FDB;&#x7A0B;&#x5373;&#x4E3A;node&#x8FDB;&#x7A0B;<strong>node /app/app.js</strong>&#x3002;&#x5728;Linux&#x4E2D;&#xFF0C;PID&#x4E3A;1&#x8FDB;&#x7A0B;&#x6309;&#x8BF4;&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x5373;init&#x8FDB;&#x7A0B;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x4E86;&#x5185;&#x6838;&#x7684;Namespace&#x673A;&#x5236;&#xFF0C;&#x4E3A;&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x4E86;&#x72EC;&#x7ACB;&#x7684;PID&#x7A7A;&#x95F4;&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x4E2D;&#x4E5F;&#x6709;1&#x53F7;&#x8FDB;&#x7A0B;&#x3002;</p>\n<h5 id=\"&#x6D4B;&#x8BD5;\"><a href=\"#&#x6D4B;&#x8BD5;\" class=\"headerlink\" title=\"&#x6D4B;&#x8BD5;\"></a>&#x6D4B;&#x8BD5;</h5><p>&#x4F7F;&#x7528;curl&#x547D;&#x4EE4;&#x8BBF;&#x95EE;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl localhost:3000</div><div class=\"line\">Hello Fundebug!</div></pre></td></tr></table></figure>\n<h3 id=\"&#x662F;&#x5426;&#x7528;Docker&#xFF1F;\"><a href=\"#&#x662F;&#x5426;&#x7528;Docker&#xFF1F;\" class=\"headerlink\" title=\"&#x662F;&#x5426;&#x7528;Docker&#xFF1F;\"></a>&#x662F;&#x5426;&#x7528;Docker&#xFF1F;</h3><p>&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4F7F;&#x7528;Docker&#x80FD;&#x591F;&#x5E26;&#x6765;&#x5F88;&#x5927;&#x76CA;&#x5904;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5F15;&#x5165;Docker&#x5FC5;&#x7136;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x6311;&#x6218;&#xFF0C;&#x9700;&#x8981;&#x719F;&#x6089;Docker&#x624D;&#x80FD;&#x5E94;&#x5BF9;&#x81EA;&#x5982;&#x3002;<strong>&#x60F3;&#x5FC5;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x8270;&#x96BE;&#x7684;&#x51B3;&#x5B9A;</strong>&#x3002;&#x5982;&#x679C;&#x4ECE;&#x957F;&#x8FDC;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;Docker&#x6B63;&#x5728;&#x6210;&#x4E3A;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#xFF0C;&#x90E8;&#x7F72;&#xFF0C;&#x53D1;&#x5E03;&#x7684;&#x6807;&#x51C6;&#x6280;&#x672F;&#xFF0C;&#x4E5F;&#x8BB8;&#x6211;&#x4EEC;&#x4E0D;&#x5F97;&#x4E0D;&#x7528;&#x5F00;&#x653E;&#x7684;&#x5FC3;&#x6001;&#x5BF9;&#x5F85;&#x5B83;&#x3002;</p>\n<p>&#x4F5C;&#x4E3A;Node.js&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x771F;&#x6B63;&#x7406;&#x89E3;Docker&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x65F6;&#x95F4;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EF;&#x4EE5;&#x7ED9;&#x4F60;&#x5E26;&#x6765;&#x5F88;&#x591A;&#x4FBF;&#x5229;&#x3002;&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;</strong>&#xFF0C;&#x8001;&#x53F8;&#x673A;&#x5E26;&#x4F60;&#x73A9;&#x8F6C;&#x9177;&#x70AB;&#x7684;Docker&#x6280;&#x672F;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/03/26/nodejs-docker/nodejs-qq-group.jpeg\"><br></div>\n\n\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://coolshell.cn/articles/17010.html\">DOCKER&#x57FA;&#x7840;&#x6280;&#x672F;&#xFF1A;LINUX NAMESPACE&#xFF08;&#x4E0A;&#xFF09;</a></li>\n<li><a href=\"http://coolshell.cn/articles/17029.html\">DOCKER&#x57FA;&#x7840;&#x6280;&#x672F;&#xFF1A;LINUX NAMESPACE&#xFF08;&#x4E0B;&#xFF09;</a></li>\n<li><a href=\"http://coolshell.cn/articles/17049.html\">DOCKER&#x57FA;&#x7840;&#x6280;&#x672F;&#xFF1A;LINUX CGROUP</a></li>\n<li><a href=\"http://coolshell.cn/articles/17680.html\">&#x4ECE;GITLAB&#x8BEF;&#x5220;&#x9664;&#x6570;&#x636E;&#x5E93;&#x60F3;&#x5230;&#x7684;</a></li>\n<li><a href=\"http://coolshell.cn/articles/17737.html\">AWS &#x7684; S3 &#x6545;&#x969C;&#x56DE;&#x987E;&#x548C;&#x601D;&#x8003;</a></li>\n</ul>"},{"title":"Async/Await替代Promise的6个理由","date":"2017-04-01T13:00:00.000Z","_content":"\n\n**译者按:** Node.js的异步编程方式有效提高了应用性能；然而回调地狱却让人望而生畏，Promise让我们告别回调函数，写出更优雅的异步代码；在实践过程中，却发现Promise并不完美；技术进步是无止境的，这时，我们有了Async/Await。\n\n<!-- more -->\n\n原文: [6 Reasons Why JavaScript’s Async/Await Blows Promises Away](https://hackernoon.com/6-reasons-why-javascripts-async-await-blows-promises-away-tutorial-c7ec10518dd9)\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\nNode.js 7.6已经支持async/await了，如果你还没有试过，这篇博客将告诉你为什么要用它。\n\n### Async/Await简介\n\n对于从未听说过async/await的朋友，下面是简介:\n\n- async/await是写异步代码的新方式，以前的方法有**回调函数**和**Promise**。\n- async/await是基于Promise实现的，它不能用于普通的回调函数。\n- async/await与Promise一样，是非阻塞的。\n- async/await使得异步代码看起来像同步代码，这正是它的魔力所在。\n\n\n\n### Async/Await语法\n\n示例中，getJSON函数返回一个promise，这个promise成功resolve时会返回一个json对象。我们只是调用这个函数，打印返回的JSON对象，然后返回\"done\"。\n\n使用Promise是这样的:\n\n```js\nconst makeRequest = () =>\n  getJSON()\n    .then(data => {\n      console.log(data)\n      return \"done\"\n    })\n\nmakeRequest()\n```\n\n使用Async/Await是这样的:\n\n```js\nconst makeRequest = async () => {\n  console.log(await getJSON())\n  return \"done\"\n}\n\nmakeRequest()\n```\n\n它们有一些细微不同:\n\n- 函数前面多了一个aync关键字。await关键字只能用在aync定义的函数内。async函数会隐式地返回一个promise，该promise的reosolve值就是函数return的值。(示例中reosolve值就是字符串\"done\")\n\n- 第1点暗示我们不能在最外层代码中使用await，因为不在async函数内。\n\n```js\n// 不能在最外层代码中使用await\nawait makeRequest()\n\n// 这是会出事情的 \nmakeRequest().then((result) => {\n  // 代码\n})\n```\n\nawait getJSON()表示console.log会等到getJSON的promise成功reosolve之后再执行。\n\n\n### 为什么Async/Await更好？\n\n#### 1. 简洁\n\n由示例可知，使用Async/Await明显节约了不少代码。我们不需要写.then，不需要写匿名函数处理Promise的resolve值，也不需要定义多余的data变量，还避免了嵌套代码。这些小的优点会迅速累计起来，这在之后的代码示例中会更加明显。\n\n#### 2. 错误处理\n\nAsync/Await让try/catch可以同时处理同步和异步错误。在下面的promise示例中，try/catch不能处理JSON.parse的错误，因为它在Promise中。我们需要使用.catch，这样错误处理代码非常冗余。并且，在我们的实际生产代码会更加复杂。\n\n```js\nconst makeRequest = () => {\n  try {\n    getJSON()\n      .then(result => {\n        // JSON.parse可能会出错\n        const data = JSON.parse(result)\n        console.log(data)\n      })\n      // 取消注释，处理异步代码的错误\n      // .catch((err) => {\n      //   console.log(err)\n      // })\n  } catch (err) {\n    console.log(err)\n  }\n}\n```\n\n使用aync/await的话，catch能处理JSON.parse错误:\n\n```js\nconst makeRequest = async () => {\n  try {\n    // this parse may fail\n    const data = JSON.parse(await getJSON())\n    console.log(data)\n  } catch (err) {\n    console.log(err)\n  }\n}\n```\n\n#### 3. 条件语句\n\n下面示例中，需要获取数据，然后根据返回数据决定是直接返回，还是继续获取更多的数据。\n\n```js\nconst makeRequest = () => {\n  return getJSON()\n    .then(data => {\n      if (data.needsAnotherRequest) {\n        return makeAnotherRequest(data)\n          .then(moreData => {\n            console.log(moreData)\n            return moreData\n          })\n      } else {\n        console.log(data)\n        return data\n      }\n    })\n}\n```\n\n这些代码看着就头痛。嵌套（6层），括号，return语句很容易让人感到迷茫，而它们只是需要将最终结果传递到最外层的Promise。\n\n上面的代码使用async/await编写可以大大地提高可读性:\n\n```js\nconst makeRequest = async () => {\n  const data = await getJSON()\n  if (data.needsAnotherRequest) {\n    const moreData = await makeAnotherRequest(data);\n    console.log(moreData)\n    return moreData\n  } else {\n    console.log(data)\n    return data    \n  }\n}\n```\n\n\n#### 4. 中间值\n\n你很可能遇到过这样的场景，调用promise1，使用promise1返回的结果去调用promise2，然后使用两者的结果去调用promise3。你的代码很可能是这样的:\n\n```js\nconst makeRequest = () => {\n  return promise1()\n    .then(value1 => {\n      return promise2(value1)\n        .then(value2 => {        \n          return promise3(value1, value2)\n        })\n    })\n}\n```\n\n如果promise3不需要value1，可以很简单地将promise嵌套铺平。如果你忍受不了嵌套，你可以将value 1 & 2 放进Promise.all来避免深层嵌套：\n\n```js\nconst makeRequest = () => {\n  return promise1()\n    .then(value1 => {\n      return Promise.all([value1, promise2(value1)])\n    })\n    .then(([value1, value2]) => {      \n      return promise3(value1, value2)\n    })\n}\n```\n\n这种方法为了可读性牺牲了语义。除了避免嵌套，并没有其他理由将value1和value2放在一个数组中。\n\n使用async/await的话，代码会变得异常简单和直观。\n\n```js\nconst makeRequest = async () => {\n  const value1 = await promise1()\n  const value2 = await promise2(value1)\n  return promise3(value1, value2)\n}\n```\n\n#### 5. 错误栈\n\n下面示例中调用了多个Promise，假设Promise链中某个地方抛出了一个错误:\n\n```js\nconst makeRequest = () => {\n  return callAPromise()\n    .then(() => callAPromise())\n    .then(() => callAPromise())\n    .then(() => callAPromise())\n    .then(() => callAPromise())\n    .then(() => {\n      throw new Error(\"oops\");\n    })\n}\n\nmakeRequest()\n  .catch(err => {\n    console.log(err);\n    // output\n    // Error: oops at callAPromise.then.then.then.then.then (index.js:8:13)\n  })\n```\n\nPromise链中返回的错误栈没有给出错误发生位置的线索。更糟糕的是，它会误导我们；错误栈中唯一的函数名为callAPromise，然而它和错误没有关系。(文件名和行号还是有用的)。\n\n然而，async/await中的错误栈会指向错误所在的函数:\n\n```js\nconst makeRequest = async () => {\n  await callAPromise()\n  await callAPromise()\n  await callAPromise()\n  await callAPromise()\n  await callAPromise()\n  throw new Error(\"oops\");\n}\n\nmakeRequest()\n  .catch(err => {\n    console.log(err);\n    // output\n    // Error: oops at makeRequest (index.js:7:9)\n  })\n```\n\n在开发环境中，这一点优势并不大。但是，当你分析生产环境的错误日志时，它将非常有用。这时，知道错误发生在makeRequest比知道错误发生在then链中要好。\n\n\n#### 6. 调试\n\n最后一点，也是非常重要的一点在于，async/await能够使得代码调试更简单。2个理由使得调试Promise变得非常痛苦:\n\n- 不能在返回表达式的箭头函数中设置断点\n\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-async-await/debug-promise.png\" />\n</div>\n\n- 如果你在.then代码块中设置断点，使用Step Over快捷键，调试器不会跳到下一个.then，因为它只会跳过异步代码。\n\n使用await/async时，你不再需要那么多箭头函数，这样你就可以像调试同步代码一样跳过await语句。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-async-await/debug-async-await.png\" />\n</div>\n\n### 结论\n\nAsync/Await是近年来JavaScript添加的最革命性的的特性之一。它会让你发现Promise的语法有多糟糕，而且提供了一个直观的替代方法。\n\n\n### 忧虑\n\n\n对于Async/Await，也许你有一些合理的怀疑：\n\n- 它使得异步代码不在明显: 我们已经习惯了用回调函数或者.then来识别异步代码，我们可能需要花数个星期去习惯新的标志。但是，C#拥有这个特性已经很多年了，熟悉它的朋友应该知道暂时的稍微不方便是值得的。\n- Node 7不是LTS（长期支持版本）: 但是，Node 8下个月就会发布，将代码迁移到新版本会非常简单。\n\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群: 177654062**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-async-await/nodejs-qq-group.jpeg\" />\n</div>\n\n\n\n","source":"_posts/2017/04/01/nodejs-async-await.md","raw":"---\ntitle: Async/Await替代Promise的6个理由\n\ndate: 2017-04-01 21:00:00\n\ntags: [Node.js, 翻译]\n\n---\n\n\n**译者按:** Node.js的异步编程方式有效提高了应用性能；然而回调地狱却让人望而生畏，Promise让我们告别回调函数，写出更优雅的异步代码；在实践过程中，却发现Promise并不完美；技术进步是无止境的，这时，我们有了Async/Await。\n\n<!-- more -->\n\n原文: [6 Reasons Why JavaScript’s Async/Await Blows Promises Away](https://hackernoon.com/6-reasons-why-javascripts-async-await-blows-promises-away-tutorial-c7ec10518dd9)\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\nNode.js 7.6已经支持async/await了，如果你还没有试过，这篇博客将告诉你为什么要用它。\n\n### Async/Await简介\n\n对于从未听说过async/await的朋友，下面是简介:\n\n- async/await是写异步代码的新方式，以前的方法有**回调函数**和**Promise**。\n- async/await是基于Promise实现的，它不能用于普通的回调函数。\n- async/await与Promise一样，是非阻塞的。\n- async/await使得异步代码看起来像同步代码，这正是它的魔力所在。\n\n\n\n### Async/Await语法\n\n示例中，getJSON函数返回一个promise，这个promise成功resolve时会返回一个json对象。我们只是调用这个函数，打印返回的JSON对象，然后返回\"done\"。\n\n使用Promise是这样的:\n\n```js\nconst makeRequest = () =>\n  getJSON()\n    .then(data => {\n      console.log(data)\n      return \"done\"\n    })\n\nmakeRequest()\n```\n\n使用Async/Await是这样的:\n\n```js\nconst makeRequest = async () => {\n  console.log(await getJSON())\n  return \"done\"\n}\n\nmakeRequest()\n```\n\n它们有一些细微不同:\n\n- 函数前面多了一个aync关键字。await关键字只能用在aync定义的函数内。async函数会隐式地返回一个promise，该promise的reosolve值就是函数return的值。(示例中reosolve值就是字符串\"done\")\n\n- 第1点暗示我们不能在最外层代码中使用await，因为不在async函数内。\n\n```js\n// 不能在最外层代码中使用await\nawait makeRequest()\n\n// 这是会出事情的 \nmakeRequest().then((result) => {\n  // 代码\n})\n```\n\nawait getJSON()表示console.log会等到getJSON的promise成功reosolve之后再执行。\n\n\n### 为什么Async/Await更好？\n\n#### 1. 简洁\n\n由示例可知，使用Async/Await明显节约了不少代码。我们不需要写.then，不需要写匿名函数处理Promise的resolve值，也不需要定义多余的data变量，还避免了嵌套代码。这些小的优点会迅速累计起来，这在之后的代码示例中会更加明显。\n\n#### 2. 错误处理\n\nAsync/Await让try/catch可以同时处理同步和异步错误。在下面的promise示例中，try/catch不能处理JSON.parse的错误，因为它在Promise中。我们需要使用.catch，这样错误处理代码非常冗余。并且，在我们的实际生产代码会更加复杂。\n\n```js\nconst makeRequest = () => {\n  try {\n    getJSON()\n      .then(result => {\n        // JSON.parse可能会出错\n        const data = JSON.parse(result)\n        console.log(data)\n      })\n      // 取消注释，处理异步代码的错误\n      // .catch((err) => {\n      //   console.log(err)\n      // })\n  } catch (err) {\n    console.log(err)\n  }\n}\n```\n\n使用aync/await的话，catch能处理JSON.parse错误:\n\n```js\nconst makeRequest = async () => {\n  try {\n    // this parse may fail\n    const data = JSON.parse(await getJSON())\n    console.log(data)\n  } catch (err) {\n    console.log(err)\n  }\n}\n```\n\n#### 3. 条件语句\n\n下面示例中，需要获取数据，然后根据返回数据决定是直接返回，还是继续获取更多的数据。\n\n```js\nconst makeRequest = () => {\n  return getJSON()\n    .then(data => {\n      if (data.needsAnotherRequest) {\n        return makeAnotherRequest(data)\n          .then(moreData => {\n            console.log(moreData)\n            return moreData\n          })\n      } else {\n        console.log(data)\n        return data\n      }\n    })\n}\n```\n\n这些代码看着就头痛。嵌套（6层），括号，return语句很容易让人感到迷茫，而它们只是需要将最终结果传递到最外层的Promise。\n\n上面的代码使用async/await编写可以大大地提高可读性:\n\n```js\nconst makeRequest = async () => {\n  const data = await getJSON()\n  if (data.needsAnotherRequest) {\n    const moreData = await makeAnotherRequest(data);\n    console.log(moreData)\n    return moreData\n  } else {\n    console.log(data)\n    return data    \n  }\n}\n```\n\n\n#### 4. 中间值\n\n你很可能遇到过这样的场景，调用promise1，使用promise1返回的结果去调用promise2，然后使用两者的结果去调用promise3。你的代码很可能是这样的:\n\n```js\nconst makeRequest = () => {\n  return promise1()\n    .then(value1 => {\n      return promise2(value1)\n        .then(value2 => {        \n          return promise3(value1, value2)\n        })\n    })\n}\n```\n\n如果promise3不需要value1，可以很简单地将promise嵌套铺平。如果你忍受不了嵌套，你可以将value 1 & 2 放进Promise.all来避免深层嵌套：\n\n```js\nconst makeRequest = () => {\n  return promise1()\n    .then(value1 => {\n      return Promise.all([value1, promise2(value1)])\n    })\n    .then(([value1, value2]) => {      \n      return promise3(value1, value2)\n    })\n}\n```\n\n这种方法为了可读性牺牲了语义。除了避免嵌套，并没有其他理由将value1和value2放在一个数组中。\n\n使用async/await的话，代码会变得异常简单和直观。\n\n```js\nconst makeRequest = async () => {\n  const value1 = await promise1()\n  const value2 = await promise2(value1)\n  return promise3(value1, value2)\n}\n```\n\n#### 5. 错误栈\n\n下面示例中调用了多个Promise，假设Promise链中某个地方抛出了一个错误:\n\n```js\nconst makeRequest = () => {\n  return callAPromise()\n    .then(() => callAPromise())\n    .then(() => callAPromise())\n    .then(() => callAPromise())\n    .then(() => callAPromise())\n    .then(() => {\n      throw new Error(\"oops\");\n    })\n}\n\nmakeRequest()\n  .catch(err => {\n    console.log(err);\n    // output\n    // Error: oops at callAPromise.then.then.then.then.then (index.js:8:13)\n  })\n```\n\nPromise链中返回的错误栈没有给出错误发生位置的线索。更糟糕的是，它会误导我们；错误栈中唯一的函数名为callAPromise，然而它和错误没有关系。(文件名和行号还是有用的)。\n\n然而，async/await中的错误栈会指向错误所在的函数:\n\n```js\nconst makeRequest = async () => {\n  await callAPromise()\n  await callAPromise()\n  await callAPromise()\n  await callAPromise()\n  await callAPromise()\n  throw new Error(\"oops\");\n}\n\nmakeRequest()\n  .catch(err => {\n    console.log(err);\n    // output\n    // Error: oops at makeRequest (index.js:7:9)\n  })\n```\n\n在开发环境中，这一点优势并不大。但是，当你分析生产环境的错误日志时，它将非常有用。这时，知道错误发生在makeRequest比知道错误发生在then链中要好。\n\n\n#### 6. 调试\n\n最后一点，也是非常重要的一点在于，async/await能够使得代码调试更简单。2个理由使得调试Promise变得非常痛苦:\n\n- 不能在返回表达式的箭头函数中设置断点\n\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-async-await/debug-promise.png\" />\n</div>\n\n- 如果你在.then代码块中设置断点，使用Step Over快捷键，调试器不会跳到下一个.then，因为它只会跳过异步代码。\n\n使用await/async时，你不再需要那么多箭头函数，这样你就可以像调试同步代码一样跳过await语句。\n\n<div style=\"text-align: center;\">\n<img style=\"width:80%;\" src=\"nodejs-async-await/debug-async-await.png\" />\n</div>\n\n### 结论\n\nAsync/Await是近年来JavaScript添加的最革命性的的特性之一。它会让你发现Promise的语法有多糟糕，而且提供了一个直观的替代方法。\n\n\n### 忧虑\n\n\n对于Async/Await，也许你有一些合理的怀疑：\n\n- 它使得异步代码不在明显: 我们已经习惯了用回调函数或者.then来识别异步代码，我们可能需要花数个星期去习惯新的标志。但是，C#拥有这个特性已经很多年了，熟悉它的朋友应该知道暂时的稍微不方便是值得的。\n- Node 7不是LTS（长期支持版本）: 但是，Node 8下个月就会发布，将代码迁移到新版本会非常简单。\n\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群: 177654062**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-async-await/nodejs-qq-group.jpeg\" />\n</div>\n\n\n\n","slug":"2017/04/01/nodejs-async-await","published":1,"updated":"2017-04-16T14:46:59.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywenf001imkfyfmgwz6uu","content":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> Node.js&#x7684;&#x5F02;&#x6B65;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x4E86;&#x5E94;&#x7528;&#x6027;&#x80FD;&#xFF1B;&#x7136;&#x800C;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#x5374;&#x8BA9;&#x4EBA;&#x671B;&#x800C;&#x751F;&#x754F;&#xFF0C;Promise&#x8BA9;&#x6211;&#x4EEC;&#x544A;&#x522B;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5199;&#x51FA;&#x66F4;&#x4F18;&#x96C5;&#x7684;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#xFF1B;&#x5728;&#x5B9E;&#x8DF5;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5374;&#x53D1;&#x73B0;Promise&#x5E76;&#x4E0D;&#x5B8C;&#x7F8E;&#xFF1B;&#x6280;&#x672F;&#x8FDB;&#x6B65;&#x662F;&#x65E0;&#x6B62;&#x5883;&#x7684;&#xFF0C;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E86;Async/Await&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x539F;&#x6587;: <a href=\"https://hackernoon.com/6-reasons-why-javascripts-async-await-blows-promises-away-tutorial-c7ec10518dd9\" target=\"_blank\" rel=\"external\">6 Reasons Why JavaScript&#x2019;s Async/Await Blows Promises Away</a><br>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>Node.js 7.6&#x5DF2;&#x7ECF;&#x652F;&#x6301;async/await&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x8BD5;&#x8FC7;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;&#x5B83;&#x3002;</p>\n<h3 id=\"Async-Await&#x7B80;&#x4ECB;\"><a href=\"#Async-Await&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"Async/Await&#x7B80;&#x4ECB;\"></a>Async/Await&#x7B80;&#x4ECB;</h3><p>&#x5BF9;&#x4E8E;&#x4ECE;&#x672A;&#x542C;&#x8BF4;&#x8FC7;async/await&#x7684;&#x670B;&#x53CB;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x7B80;&#x4ECB;:</p>\n<ul>\n<li>async/await&#x662F;&#x5199;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x7684;&#x65B0;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x6709;<strong>&#x56DE;&#x8C03;&#x51FD;&#x6570;</strong>&#x548C;<strong>Promise</strong>&#x3002;</li>\n<li>async/await&#x662F;&#x57FA;&#x4E8E;Promise&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</li>\n<li>async/await&#x4E0E;Promise&#x4E00;&#x6837;&#xFF0C;&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#x3002;</li>\n<li>async/await&#x4F7F;&#x5F97;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x6B63;&#x662F;&#x5B83;&#x7684;&#x9B54;&#x529B;&#x6240;&#x5728;&#x3002;</li>\n</ul>\n<h3 id=\"Async-Await&#x8BED;&#x6CD5;\"><a href=\"#Async-Await&#x8BED;&#x6CD5;\" class=\"headerlink\" title=\"Async/Await&#x8BED;&#x6CD5;\"></a>Async/Await&#x8BED;&#x6CD5;</h3><p>&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;getJSON&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;promise&#xFF0C;&#x8FD9;&#x4E2A;promise&#x6210;&#x529F;resolve&#x65F6;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;json&#x5BF9;&#x8C61;&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6253;&#x5370;&#x8FD4;&#x56DE;&#x7684;JSON&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x201D;done&#x201D;&#x3002;</p>\n<p>&#x4F7F;&#x7528;Promise&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span></div><div class=\"line\">  getJSON()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;done&quot;</span></div><div class=\"line\">    })</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Async/Await&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">await</span> getJSON())</div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;done&quot;</span></div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4EEC;&#x6709;&#x4E00;&#x4E9B;&#x7EC6;&#x5FAE;&#x4E0D;&#x540C;:</p>\n<ul>\n<li><p>&#x51FD;&#x6570;&#x524D;&#x9762;&#x591A;&#x4E86;&#x4E00;&#x4E2A;aync&#x5173;&#x952E;&#x5B57;&#x3002;await&#x5173;&#x952E;&#x5B57;&#x53EA;&#x80FD;&#x7528;&#x5728;aync&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x5185;&#x3002;async&#x51FD;&#x6570;&#x4F1A;&#x9690;&#x5F0F;&#x5730;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;promise&#xFF0C;&#x8BE5;promise&#x7684;reosolve&#x503C;&#x5C31;&#x662F;&#x51FD;&#x6570;return&#x7684;&#x503C;&#x3002;(&#x793A;&#x4F8B;&#x4E2D;reosolve&#x503C;&#x5C31;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x201D;done&#x201D;)</p>\n</li>\n<li><p>&#x7B2C;1&#x70B9;&#x6697;&#x793A;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5728;&#x6700;&#x5916;&#x5C42;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;await&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x5728;async&#x51FD;&#x6570;&#x5185;&#x3002;</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// &#x4E0D;&#x80FD;&#x5728;&#x6700;&#x5916;&#x5C42;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;await</span></div><div class=\"line\"><span class=\"keyword\">await</span> makeRequest()</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x8FD9;&#x662F;&#x4F1A;&#x51FA;&#x4E8B;&#x60C5;&#x7684; </span></div><div class=\"line\">makeRequest().then(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> {</div><div class=\"line\">  <span class=\"comment\">// &#x4EE3;&#x7801;</span></div><div class=\"line\">})</div></pre></td></tr></table></figure>\n<p>await getJSON()&#x8868;&#x793A;console.log&#x4F1A;&#x7B49;&#x5230;getJSON&#x7684;promise&#x6210;&#x529F;reosolve&#x4E4B;&#x540E;&#x518D;&#x6267;&#x884C;&#x3002;</p>\n<h3 id=\"&#x4E3A;&#x4EC0;&#x4E48;Async-Await&#x66F4;&#x597D;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;Async-Await&#x66F4;&#x597D;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;Async/Await&#x66F4;&#x597D;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;Async/Await&#x66F4;&#x597D;&#xFF1F;</h3><h4 id=\"1-&#x7B80;&#x6D01;\"><a href=\"#1-&#x7B80;&#x6D01;\" class=\"headerlink\" title=\"1. &#x7B80;&#x6D01;\"></a>1. &#x7B80;&#x6D01;</h4><p>&#x7531;&#x793A;&#x4F8B;&#x53EF;&#x77E5;&#xFF0C;&#x4F7F;&#x7528;Async/Await&#x660E;&#x663E;&#x8282;&#x7EA6;&#x4E86;&#x4E0D;&#x5C11;&#x4EE3;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x5199;.then&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x533F;&#x540D;&#x51FD;&#x6570;&#x5904;&#x7406;Promise&#x7684;resolve&#x503C;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x591A;&#x4F59;&#x7684;data&#x53D8;&#x91CF;&#xFF0C;&#x8FD8;&#x907F;&#x514D;&#x4E86;&#x5D4C;&#x5957;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E9B;&#x5C0F;&#x7684;&#x4F18;&#x70B9;&#x4F1A;&#x8FC5;&#x901F;&#x7D2F;&#x8BA1;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x5728;&#x4E4B;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#x4E2D;&#x4F1A;&#x66F4;&#x52A0;&#x660E;&#x663E;&#x3002;</p>\n<h4 id=\"2-&#x9519;&#x8BEF;&#x5904;&#x7406;\"><a href=\"#2-&#x9519;&#x8BEF;&#x5904;&#x7406;\" class=\"headerlink\" title=\"2. &#x9519;&#x8BEF;&#x5904;&#x7406;\"></a>2. &#x9519;&#x8BEF;&#x5904;&#x7406;</h4><p>Async/Await&#x8BA9;try/catch&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x5904;&#x7406;&#x540C;&#x6B65;&#x548C;&#x5F02;&#x6B65;&#x9519;&#x8BEF;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;promise&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;try/catch&#x4E0D;&#x80FD;&#x5904;&#x7406;JSON.parse&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5728;Promise&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;.catch&#xFF0C;&#x8FD9;&#x6837;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x4EE3;&#x7801;&#x975E;&#x5E38;&#x5197;&#x4F59;&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x4EE3;&#x7801;&#x4F1A;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">try</span> {</div><div class=\"line\">    getJSON()</div><div class=\"line\">      .then(<span class=\"function\"><span class=\"params\">result</span> =&gt;</span> {</div><div class=\"line\">        <span class=\"comment\">// JSON.parse&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x9519;</span></div><div class=\"line\">        <span class=\"keyword\">const</span> data = <span class=\"built_in\">JSON</span>.parse(result)</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">      })</div><div class=\"line\">      <span class=\"comment\">// &#x53D6;&#x6D88;&#x6CE8;&#x91CA;&#xFF0C;&#x5904;&#x7406;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x7684;&#x9519;&#x8BEF;</span></div><div class=\"line\">      <span class=\"comment\">// .catch((err) =&gt; {</span></div><div class=\"line\">      <span class=\"comment\">//   console.log(err)</span></div><div class=\"line\">      <span class=\"comment\">// })</span></div><div class=\"line\">  } <span class=\"keyword\">catch</span> (err) {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err)</div><div class=\"line\">  }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;aync/await&#x7684;&#x8BDD;&#xFF0C;catch&#x80FD;&#x5904;&#x7406;JSON.parse&#x9519;&#x8BEF;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">try</span> {</div><div class=\"line\">    <span class=\"comment\">// this parse may fail</span></div><div class=\"line\">    <span class=\"keyword\">const</span> data = <span class=\"built_in\">JSON</span>.parse(<span class=\"keyword\">await</span> getJSON())</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">  } <span class=\"keyword\">catch</span> (err) {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err)</div><div class=\"line\">  }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x6761;&#x4EF6;&#x8BED;&#x53E5;\"><a href=\"#3-&#x6761;&#x4EF6;&#x8BED;&#x53E5;\" class=\"headerlink\" title=\"3. &#x6761;&#x4EF6;&#x8BED;&#x53E5;\"></a>3. &#x6761;&#x4EF6;&#x8BED;&#x53E5;</h4><p>&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x51B3;&#x5B9A;&#x662F;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF0C;&#x8FD8;&#x662F;&#x7EE7;&#x7EED;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> getJSON()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">if</span> (data.needsAnotherRequest) {</div><div class=\"line\">        <span class=\"keyword\">return</span> makeAnotherRequest(data)</div><div class=\"line\">          .then(<span class=\"function\"><span class=\"params\">moreData</span> =&gt;</span> {</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(moreData)</div><div class=\"line\">            <span class=\"keyword\">return</span> moreData</div><div class=\"line\">          })</div><div class=\"line\">      } <span class=\"keyword\">else</span> {</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">        <span class=\"keyword\">return</span> data</div><div class=\"line\">      }</div><div class=\"line\">    })</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x770B;&#x7740;&#x5C31;&#x5934;&#x75DB;&#x3002;&#x5D4C;&#x5957;&#xFF08;6&#x5C42;&#xFF09;&#xFF0C;&#x62EC;&#x53F7;&#xFF0C;return&#x8BED;&#x53E5;&#x5F88;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x611F;&#x5230;&#x8FF7;&#x832B;&#xFF0C;&#x800C;&#x5B83;&#x4EEC;&#x53EA;&#x662F;&#x9700;&#x8981;&#x5C06;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x4F20;&#x9012;&#x5230;&#x6700;&#x5916;&#x5C42;&#x7684;Promise&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F7F;&#x7528;async/await&#x7F16;&#x5199;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x53EF;&#x8BFB;&#x6027;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">const</span> data = <span class=\"keyword\">await</span> getJSON()</div><div class=\"line\">  <span class=\"keyword\">if</span> (data.needsAnotherRequest) {</div><div class=\"line\">    <span class=\"keyword\">const</span> moreData = <span class=\"keyword\">await</span> makeAnotherRequest(data);</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(moreData)</div><div class=\"line\">    <span class=\"keyword\">return</span> moreData</div><div class=\"line\">  } <span class=\"keyword\">else</span> {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">    <span class=\"keyword\">return</span> data    </div><div class=\"line\">  }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x4E2D;&#x95F4;&#x503C;\"><a href=\"#4-&#x4E2D;&#x95F4;&#x503C;\" class=\"headerlink\" title=\"4. &#x4E2D;&#x95F4;&#x503C;\"></a>4. &#x4E2D;&#x95F4;&#x503C;</h4><p>&#x4F60;&#x5F88;&#x53EF;&#x80FD;&#x9047;&#x5230;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x8C03;&#x7528;promise1&#xFF0C;&#x4F7F;&#x7528;promise1&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x53BB;&#x8C03;&#x7528;promise2&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4E24;&#x8005;&#x7684;&#x7ED3;&#x679C;&#x53BB;&#x8C03;&#x7528;promise3&#x3002;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> promise1()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">value1</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">return</span> promise2(value1)</div><div class=\"line\">        .then(<span class=\"function\"><span class=\"params\">value2</span> =&gt;</span> {        </div><div class=\"line\">          <span class=\"keyword\">return</span> promise3(value1, value2)</div><div class=\"line\">        })</div><div class=\"line\">    })</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;promise3&#x4E0D;&#x9700;&#x8981;value1&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x7B80;&#x5355;&#x5730;&#x5C06;promise&#x5D4C;&#x5957;&#x94FA;&#x5E73;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5FCD;&#x53D7;&#x4E0D;&#x4E86;&#x5D4C;&#x5957;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;value 1 &amp; 2 &#x653E;&#x8FDB;Promise.all&#x6765;&#x907F;&#x514D;&#x6DF1;&#x5C42;&#x5D4C;&#x5957;&#xFF1A;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> promise1()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">value1</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all([value1, promise2(value1)])</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">[value1, value2]</span>) =&gt;</span> {      </div><div class=\"line\">      <span class=\"keyword\">return</span> promise3(value1, value2)</div><div class=\"line\">    })</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x4E3A;&#x4E86;&#x53EF;&#x8BFB;&#x6027;&#x727A;&#x7272;&#x4E86;&#x8BED;&#x4E49;&#x3002;&#x9664;&#x4E86;&#x907F;&#x514D;&#x5D4C;&#x5957;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x7406;&#x7531;&#x5C06;value1&#x548C;value2&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x4E2D;&#x3002;</p>\n<p>&#x4F7F;&#x7528;async/await&#x7684;&#x8BDD;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x53D8;&#x5F97;&#x5F02;&#x5E38;&#x7B80;&#x5355;&#x548C;&#x76F4;&#x89C2;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">const</span> value1 = <span class=\"keyword\">await</span> promise1()</div><div class=\"line\">  <span class=\"keyword\">const</span> value2 = <span class=\"keyword\">await</span> promise2(value1)</div><div class=\"line\">  <span class=\"keyword\">return</span> promise3(value1, value2)</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h4 id=\"5-&#x9519;&#x8BEF;&#x6808;\"><a href=\"#5-&#x9519;&#x8BEF;&#x6808;\" class=\"headerlink\" title=\"5. &#x9519;&#x8BEF;&#x6808;\"></a>5. &#x9519;&#x8BEF;&#x6808;</h4><p>&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x8C03;&#x7528;&#x4E86;&#x591A;&#x4E2A;Promise&#xFF0C;&#x5047;&#x8BBE;Promise&#x94FE;&#x4E2D;&#x67D0;&#x4E2A;&#x5730;&#x65B9;&#x629B;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> callAPromise()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&quot;oops&quot;</span>);</div><div class=\"line\">    })</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div><div class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">    <span class=\"comment\">// output</span></div><div class=\"line\">    <span class=\"comment\">// Error: oops at callAPromise.then.then.then.then.then (index.js:8:13)</span></div><div class=\"line\">  })</div></pre></td></tr></table></figure>\n<p>Promise&#x94FE;&#x4E2D;&#x8FD4;&#x56DE;&#x7684;&#x9519;&#x8BEF;&#x6808;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x4F4D;&#x7F6E;&#x7684;&#x7EBF;&#x7D22;&#x3002;&#x66F4;&#x7CDF;&#x7CD5;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x4F1A;&#x8BEF;&#x5BFC;&#x6211;&#x4EEC;&#xFF1B;&#x9519;&#x8BEF;&#x6808;&#x4E2D;&#x552F;&#x4E00;&#x7684;&#x51FD;&#x6570;&#x540D;&#x4E3A;callAPromise&#xFF0C;&#x7136;&#x800C;&#x5B83;&#x548C;&#x9519;&#x8BEF;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#x3002;(&#x6587;&#x4EF6;&#x540D;&#x548C;&#x884C;&#x53F7;&#x8FD8;&#x662F;&#x6709;&#x7528;&#x7684;)&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;async/await&#x4E2D;&#x7684;&#x9519;&#x8BEF;&#x6808;&#x4F1A;&#x6307;&#x5411;&#x9519;&#x8BEF;&#x6240;&#x5728;&#x7684;&#x51FD;&#x6570;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&quot;oops&quot;</span>);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div><div class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">    <span class=\"comment\">// output</span></div><div class=\"line\">    <span class=\"comment\">// Error: oops at makeRequest (index.js:7:9)</span></div><div class=\"line\">  })</div></pre></td></tr></table></figure>\n<p>&#x5728;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4F18;&#x52BF;&#x5E76;&#x4E0D;&#x5927;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x4F60;&#x5206;&#x6790;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x77E5;&#x9053;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x5728;makeRequest&#x6BD4;&#x77E5;&#x9053;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x5728;then&#x94FE;&#x4E2D;&#x8981;&#x597D;&#x3002;</p>\n<h4 id=\"6-&#x8C03;&#x8BD5;\"><a href=\"#6-&#x8C03;&#x8BD5;\" class=\"headerlink\" title=\"6. &#x8C03;&#x8BD5;\"></a>6. &#x8C03;&#x8BD5;</h4><p>&#x6700;&#x540E;&#x4E00;&#x70B9;&#xFF0C;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;async/await&#x80FD;&#x591F;&#x4F7F;&#x5F97;&#x4EE3;&#x7801;&#x8C03;&#x8BD5;&#x66F4;&#x7B80;&#x5355;&#x3002;2&#x4E2A;&#x7406;&#x7531;&#x4F7F;&#x5F97;&#x8C03;&#x8BD5;Promise&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x75DB;&#x82E6;:</p>\n<ul>\n<li>&#x4E0D;&#x80FD;&#x5728;&#x8FD4;&#x56DE;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#x4E2D;&#x8BBE;&#x7F6E;&#x65AD;&#x70B9;</li>\n</ul>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/04/01/nodejs-async-await/debug-promise.png\"><br></div>\n\n<ul>\n<li>&#x5982;&#x679C;&#x4F60;&#x5728;.then&#x4EE3;&#x7801;&#x5757;&#x4E2D;&#x8BBE;&#x7F6E;&#x65AD;&#x70B9;&#xFF0C;&#x4F7F;&#x7528;Step Over&#x5FEB;&#x6377;&#x952E;&#xFF0C;&#x8C03;&#x8BD5;&#x5668;&#x4E0D;&#x4F1A;&#x8DF3;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;.then&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x4F1A;&#x8DF3;&#x8FC7;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x3002;</li>\n</ul>\n<p>&#x4F7F;&#x7528;await/async&#x65F6;&#xFF0C;&#x4F60;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x90A3;&#x4E48;&#x591A;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x50CF;&#x8C03;&#x8BD5;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#x8DF3;&#x8FC7;await&#x8BED;&#x53E5;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/04/01/nodejs-async-await/debug-async-await.png\"><br></div>\n\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>Async/Await&#x662F;&#x8FD1;&#x5E74;&#x6765;JavaScript&#x6DFB;&#x52A0;&#x7684;&#x6700;&#x9769;&#x547D;&#x6027;&#x7684;&#x7684;&#x7279;&#x6027;&#x4E4B;&#x4E00;&#x3002;&#x5B83;&#x4F1A;&#x8BA9;&#x4F60;&#x53D1;&#x73B0;Promise&#x7684;&#x8BED;&#x6CD5;&#x6709;&#x591A;&#x7CDF;&#x7CD5;&#xFF0C;&#x800C;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x76F4;&#x89C2;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"&#x5FE7;&#x8651;\"><a href=\"#&#x5FE7;&#x8651;\" class=\"headerlink\" title=\"&#x5FE7;&#x8651;\"></a>&#x5FE7;&#x8651;</h3><p>&#x5BF9;&#x4E8E;Async/Await&#xFF0C;&#x4E5F;&#x8BB8;&#x4F60;&#x6709;&#x4E00;&#x4E9B;&#x5408;&#x7406;&#x7684;&#x6000;&#x7591;&#xFF1A;</p>\n<ul>\n<li>&#x5B83;&#x4F7F;&#x5F97;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x4E0D;&#x5728;&#x660E;&#x663E;: &#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x4E86;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6216;&#x8005;.then&#x6765;&#x8BC6;&#x522B;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x82B1;&#x6570;&#x4E2A;&#x661F;&#x671F;&#x53BB;&#x4E60;&#x60EF;&#x65B0;&#x7684;&#x6807;&#x5FD7;&#x3002;&#x4F46;&#x662F;&#xFF0C;C#&#x62E5;&#x6709;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x5DF2;&#x7ECF;&#x5F88;&#x591A;&#x5E74;&#x4E86;&#xFF0C;&#x719F;&#x6089;&#x5B83;&#x7684;&#x670B;&#x53CB;&#x5E94;&#x8BE5;&#x77E5;&#x9053;&#x6682;&#x65F6;&#x7684;&#x7A0D;&#x5FAE;&#x4E0D;&#x65B9;&#x4FBF;&#x662F;&#x503C;&#x5F97;&#x7684;&#x3002;</li>\n<li>Node 7&#x4E0D;&#x662F;LTS&#xFF08;&#x957F;&#x671F;&#x652F;&#x6301;&#x7248;&#x672C;&#xFF09;: &#x4F46;&#x662F;&#xFF0C;Node 8&#x4E0B;&#x4E2A;&#x6708;&#x5C31;&#x4F1A;&#x53D1;&#x5E03;&#xFF0C;&#x5C06;&#x4EE3;&#x7801;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7248;&#x672C;&#x4F1A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;</li>\n</ul>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 177654062</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/01/nodejs-async-await/nodejs-qq-group.jpeg\"><br></div>\n\n\n\n","excerpt":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> Node.js&#x7684;&#x5F02;&#x6B65;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x4E86;&#x5E94;&#x7528;&#x6027;&#x80FD;&#xFF1B;&#x7136;&#x800C;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#x5374;&#x8BA9;&#x4EBA;&#x671B;&#x800C;&#x751F;&#x754F;&#xFF0C;Promise&#x8BA9;&#x6211;&#x4EEC;&#x544A;&#x522B;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5199;&#x51FA;&#x66F4;&#x4F18;&#x96C5;&#x7684;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#xFF1B;&#x5728;&#x5B9E;&#x8DF5;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5374;&#x53D1;&#x73B0;Promise&#x5E76;&#x4E0D;&#x5B8C;&#x7F8E;&#xFF1B;&#x6280;&#x672F;&#x8FDB;&#x6B65;&#x662F;&#x65E0;&#x6B62;&#x5883;&#x7684;&#xFF0C;&#x8FD9;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E86;Async/Await&#x3002;</p>","more":"<p>&#x539F;&#x6587;: <a href=\"https://hackernoon.com/6-reasons-why-javascripts-async-await-blows-promises-away-tutorial-c7ec10518dd9\">6 Reasons Why JavaScript&#x2019;s Async/Await Blows Promises Away</a><br>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>Node.js 7.6&#x5DF2;&#x7ECF;&#x652F;&#x6301;async/await&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x6709;&#x8BD5;&#x8FC7;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;&#x5B83;&#x3002;</p>\n<h3 id=\"Async-Await&#x7B80;&#x4ECB;\"><a href=\"#Async-Await&#x7B80;&#x4ECB;\" class=\"headerlink\" title=\"Async/Await&#x7B80;&#x4ECB;\"></a>Async/Await&#x7B80;&#x4ECB;</h3><p>&#x5BF9;&#x4E8E;&#x4ECE;&#x672A;&#x542C;&#x8BF4;&#x8FC7;async/await&#x7684;&#x670B;&#x53CB;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x7B80;&#x4ECB;:</p>\n<ul>\n<li>async/await&#x662F;&#x5199;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x7684;&#x65B0;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x6709;<strong>&#x56DE;&#x8C03;&#x51FD;&#x6570;</strong>&#x548C;<strong>Promise</strong>&#x3002;</li>\n<li>async/await&#x662F;&#x57FA;&#x4E8E;Promise&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x80FD;&#x7528;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</li>\n<li>async/await&#x4E0E;Promise&#x4E00;&#x6837;&#xFF0C;&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#x3002;</li>\n<li>async/await&#x4F7F;&#x5F97;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x6B63;&#x662F;&#x5B83;&#x7684;&#x9B54;&#x529B;&#x6240;&#x5728;&#x3002;</li>\n</ul>\n<h3 id=\"Async-Await&#x8BED;&#x6CD5;\"><a href=\"#Async-Await&#x8BED;&#x6CD5;\" class=\"headerlink\" title=\"Async/Await&#x8BED;&#x6CD5;\"></a>Async/Await&#x8BED;&#x6CD5;</h3><p>&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;getJSON&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;promise&#xFF0C;&#x8FD9;&#x4E2A;promise&#x6210;&#x529F;resolve&#x65F6;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;json&#x5BF9;&#x8C61;&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6253;&#x5370;&#x8FD4;&#x56DE;&#x7684;JSON&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x201D;done&#x201D;&#x3002;</p>\n<p>&#x4F7F;&#x7528;Promise&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span></div><div class=\"line\">  getJSON()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;done&quot;</span></div><div class=\"line\">    })</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;Async/Await&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">await</span> getJSON())</div><div class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;done&quot;</span></div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div></pre></td></tr></table></figure>\n<p>&#x5B83;&#x4EEC;&#x6709;&#x4E00;&#x4E9B;&#x7EC6;&#x5FAE;&#x4E0D;&#x540C;:</p>\n<ul>\n<li><p>&#x51FD;&#x6570;&#x524D;&#x9762;&#x591A;&#x4E86;&#x4E00;&#x4E2A;aync&#x5173;&#x952E;&#x5B57;&#x3002;await&#x5173;&#x952E;&#x5B57;&#x53EA;&#x80FD;&#x7528;&#x5728;aync&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x5185;&#x3002;async&#x51FD;&#x6570;&#x4F1A;&#x9690;&#x5F0F;&#x5730;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;promise&#xFF0C;&#x8BE5;promise&#x7684;reosolve&#x503C;&#x5C31;&#x662F;&#x51FD;&#x6570;return&#x7684;&#x503C;&#x3002;(&#x793A;&#x4F8B;&#x4E2D;reosolve&#x503C;&#x5C31;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x201D;done&#x201D;)</p>\n</li>\n<li><p>&#x7B2C;1&#x70B9;&#x6697;&#x793A;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5728;&#x6700;&#x5916;&#x5C42;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;await&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x5728;async&#x51FD;&#x6570;&#x5185;&#x3002;</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">// &#x4E0D;&#x80FD;&#x5728;&#x6700;&#x5916;&#x5C42;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;await</span></div><div class=\"line\"><span class=\"keyword\">await</span> makeRequest()</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// &#x8FD9;&#x662F;&#x4F1A;&#x51FA;&#x4E8B;&#x60C5;&#x7684; </span></div><div class=\"line\">makeRequest().then(<span class=\"function\">(<span class=\"params\">result</span>) =&gt;</span> {</div><div class=\"line\">  <span class=\"comment\">// &#x4EE3;&#x7801;</span></div><div class=\"line\">})</div></pre></td></tr></table></figure>\n<p>await getJSON()&#x8868;&#x793A;console.log&#x4F1A;&#x7B49;&#x5230;getJSON&#x7684;promise&#x6210;&#x529F;reosolve&#x4E4B;&#x540E;&#x518D;&#x6267;&#x884C;&#x3002;</p>\n<h3 id=\"&#x4E3A;&#x4EC0;&#x4E48;Async-Await&#x66F4;&#x597D;&#xFF1F;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;Async-Await&#x66F4;&#x597D;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;Async/Await&#x66F4;&#x597D;&#xFF1F;\"></a>&#x4E3A;&#x4EC0;&#x4E48;Async/Await&#x66F4;&#x597D;&#xFF1F;</h3><h4 id=\"1-&#x7B80;&#x6D01;\"><a href=\"#1-&#x7B80;&#x6D01;\" class=\"headerlink\" title=\"1. &#x7B80;&#x6D01;\"></a>1. &#x7B80;&#x6D01;</h4><p>&#x7531;&#x793A;&#x4F8B;&#x53EF;&#x77E5;&#xFF0C;&#x4F7F;&#x7528;Async/Await&#x660E;&#x663E;&#x8282;&#x7EA6;&#x4E86;&#x4E0D;&#x5C11;&#x4EE3;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x5199;.then&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x533F;&#x540D;&#x51FD;&#x6570;&#x5904;&#x7406;Promise&#x7684;resolve&#x503C;&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x591A;&#x4F59;&#x7684;data&#x53D8;&#x91CF;&#xFF0C;&#x8FD8;&#x907F;&#x514D;&#x4E86;&#x5D4C;&#x5957;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E9B;&#x5C0F;&#x7684;&#x4F18;&#x70B9;&#x4F1A;&#x8FC5;&#x901F;&#x7D2F;&#x8BA1;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x5728;&#x4E4B;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#x4E2D;&#x4F1A;&#x66F4;&#x52A0;&#x660E;&#x663E;&#x3002;</p>\n<h4 id=\"2-&#x9519;&#x8BEF;&#x5904;&#x7406;\"><a href=\"#2-&#x9519;&#x8BEF;&#x5904;&#x7406;\" class=\"headerlink\" title=\"2. &#x9519;&#x8BEF;&#x5904;&#x7406;\"></a>2. &#x9519;&#x8BEF;&#x5904;&#x7406;</h4><p>Async/Await&#x8BA9;try/catch&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x5904;&#x7406;&#x540C;&#x6B65;&#x548C;&#x5F02;&#x6B65;&#x9519;&#x8BEF;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;promise&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;try/catch&#x4E0D;&#x80FD;&#x5904;&#x7406;JSON.parse&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5728;Promise&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;.catch&#xFF0C;&#x8FD9;&#x6837;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x4EE3;&#x7801;&#x975E;&#x5E38;&#x5197;&#x4F59;&#x3002;&#x5E76;&#x4E14;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x4EE3;&#x7801;&#x4F1A;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">try</span> {</div><div class=\"line\">    getJSON()</div><div class=\"line\">      .then(<span class=\"function\"><span class=\"params\">result</span> =&gt;</span> {</div><div class=\"line\">        <span class=\"comment\">// JSON.parse&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x9519;</span></div><div class=\"line\">        <span class=\"keyword\">const</span> data = <span class=\"built_in\">JSON</span>.parse(result)</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">      })</div><div class=\"line\">      <span class=\"comment\">// &#x53D6;&#x6D88;&#x6CE8;&#x91CA;&#xFF0C;&#x5904;&#x7406;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x7684;&#x9519;&#x8BEF;</span></div><div class=\"line\">      <span class=\"comment\">// .catch((err) =&gt; {</span></div><div class=\"line\">      <span class=\"comment\">//   console.log(err)</span></div><div class=\"line\">      <span class=\"comment\">// })</span></div><div class=\"line\">  } <span class=\"keyword\">catch</span> (err) {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err)</div><div class=\"line\">  }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;aync/await&#x7684;&#x8BDD;&#xFF0C;catch&#x80FD;&#x5904;&#x7406;JSON.parse&#x9519;&#x8BEF;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">try</span> {</div><div class=\"line\">    <span class=\"comment\">// this parse may fail</span></div><div class=\"line\">    <span class=\"keyword\">const</span> data = <span class=\"built_in\">JSON</span>.parse(<span class=\"keyword\">await</span> getJSON())</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">  } <span class=\"keyword\">catch</span> (err) {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err)</div><div class=\"line\">  }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x6761;&#x4EF6;&#x8BED;&#x53E5;\"><a href=\"#3-&#x6761;&#x4EF6;&#x8BED;&#x53E5;\" class=\"headerlink\" title=\"3. &#x6761;&#x4EF6;&#x8BED;&#x53E5;\"></a>3. &#x6761;&#x4EF6;&#x8BED;&#x53E5;</h4><p>&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x51B3;&#x5B9A;&#x662F;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF0C;&#x8FD8;&#x662F;&#x7EE7;&#x7EED;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> getJSON()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">if</span> (data.needsAnotherRequest) {</div><div class=\"line\">        <span class=\"keyword\">return</span> makeAnotherRequest(data)</div><div class=\"line\">          .then(<span class=\"function\"><span class=\"params\">moreData</span> =&gt;</span> {</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(moreData)</div><div class=\"line\">            <span class=\"keyword\">return</span> moreData</div><div class=\"line\">          })</div><div class=\"line\">      } <span class=\"keyword\">else</span> {</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">        <span class=\"keyword\">return</span> data</div><div class=\"line\">      }</div><div class=\"line\">    })</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x770B;&#x7740;&#x5C31;&#x5934;&#x75DB;&#x3002;&#x5D4C;&#x5957;&#xFF08;6&#x5C42;&#xFF09;&#xFF0C;&#x62EC;&#x53F7;&#xFF0C;return&#x8BED;&#x53E5;&#x5F88;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x611F;&#x5230;&#x8FF7;&#x832B;&#xFF0C;&#x800C;&#x5B83;&#x4EEC;&#x53EA;&#x662F;&#x9700;&#x8981;&#x5C06;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x4F20;&#x9012;&#x5230;&#x6700;&#x5916;&#x5C42;&#x7684;Promise&#x3002;</p>\n<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F7F;&#x7528;async/await&#x7F16;&#x5199;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x53EF;&#x8BFB;&#x6027;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">const</span> data = <span class=\"keyword\">await</span> getJSON()</div><div class=\"line\">  <span class=\"keyword\">if</span> (data.needsAnotherRequest) {</div><div class=\"line\">    <span class=\"keyword\">const</span> moreData = <span class=\"keyword\">await</span> makeAnotherRequest(data);</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(moreData)</div><div class=\"line\">    <span class=\"keyword\">return</span> moreData</div><div class=\"line\">  } <span class=\"keyword\">else</span> {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(data)</div><div class=\"line\">    <span class=\"keyword\">return</span> data    </div><div class=\"line\">  }</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x4E2D;&#x95F4;&#x503C;\"><a href=\"#4-&#x4E2D;&#x95F4;&#x503C;\" class=\"headerlink\" title=\"4. &#x4E2D;&#x95F4;&#x503C;\"></a>4. &#x4E2D;&#x95F4;&#x503C;</h4><p>&#x4F60;&#x5F88;&#x53EF;&#x80FD;&#x9047;&#x5230;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x8C03;&#x7528;promise1&#xFF0C;&#x4F7F;&#x7528;promise1&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x53BB;&#x8C03;&#x7528;promise2&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4E24;&#x8005;&#x7684;&#x7ED3;&#x679C;&#x53BB;&#x8C03;&#x7528;promise3&#x3002;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> promise1()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">value1</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">return</span> promise2(value1)</div><div class=\"line\">        .then(<span class=\"function\"><span class=\"params\">value2</span> =&gt;</span> {        </div><div class=\"line\">          <span class=\"keyword\">return</span> promise3(value1, value2)</div><div class=\"line\">        })</div><div class=\"line\">    })</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x5982;&#x679C;promise3&#x4E0D;&#x9700;&#x8981;value1&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x7B80;&#x5355;&#x5730;&#x5C06;promise&#x5D4C;&#x5957;&#x94FA;&#x5E73;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5FCD;&#x53D7;&#x4E0D;&#x4E86;&#x5D4C;&#x5957;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;value 1 &amp; 2 &#x653E;&#x8FDB;Promise.all&#x6765;&#x907F;&#x514D;&#x6DF1;&#x5C42;&#x5D4C;&#x5957;&#xFF1A;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> promise1()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">value1</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all([value1, promise2(value1)])</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">[value1, value2]</span>) =&gt;</span> {      </div><div class=\"line\">      <span class=\"keyword\">return</span> promise3(value1, value2)</div><div class=\"line\">    })</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x4E3A;&#x4E86;&#x53EF;&#x8BFB;&#x6027;&#x727A;&#x7272;&#x4E86;&#x8BED;&#x4E49;&#x3002;&#x9664;&#x4E86;&#x907F;&#x514D;&#x5D4C;&#x5957;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x7406;&#x7531;&#x5C06;value1&#x548C;value2&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x4E2D;&#x3002;</p>\n<p>&#x4F7F;&#x7528;async/await&#x7684;&#x8BDD;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x53D8;&#x5F97;&#x5F02;&#x5E38;&#x7B80;&#x5355;&#x548C;&#x76F4;&#x89C2;&#x3002;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">const</span> value1 = <span class=\"keyword\">await</span> promise1()</div><div class=\"line\">  <span class=\"keyword\">const</span> value2 = <span class=\"keyword\">await</span> promise2(value1)</div><div class=\"line\">  <span class=\"keyword\">return</span> promise3(value1, value2)</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h4 id=\"5-&#x9519;&#x8BEF;&#x6808;\"><a href=\"#5-&#x9519;&#x8BEF;&#x6808;\" class=\"headerlink\" title=\"5. &#x9519;&#x8BEF;&#x6808;\"></a>5. &#x9519;&#x8BEF;&#x6808;</h4><p>&#x4E0B;&#x9762;&#x793A;&#x4F8B;&#x4E2D;&#x8C03;&#x7528;&#x4E86;&#x591A;&#x4E2A;Promise&#xFF0C;&#x5047;&#x8BBE;Promise&#x94FE;&#x4E2D;&#x67D0;&#x4E2A;&#x5730;&#x65B9;&#x629B;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">  <span class=\"keyword\">return</span> callAPromise()</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> callAPromise())</div><div class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> {</div><div class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&quot;oops&quot;</span>);</div><div class=\"line\">    })</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div><div class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">    <span class=\"comment\">// output</span></div><div class=\"line\">    <span class=\"comment\">// Error: oops at callAPromise.then.then.then.then.then (index.js:8:13)</span></div><div class=\"line\">  })</div></pre></td></tr></table></figure>\n<p>Promise&#x94FE;&#x4E2D;&#x8FD4;&#x56DE;&#x7684;&#x9519;&#x8BEF;&#x6808;&#x6CA1;&#x6709;&#x7ED9;&#x51FA;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x4F4D;&#x7F6E;&#x7684;&#x7EBF;&#x7D22;&#x3002;&#x66F4;&#x7CDF;&#x7CD5;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x4F1A;&#x8BEF;&#x5BFC;&#x6211;&#x4EEC;&#xFF1B;&#x9519;&#x8BEF;&#x6808;&#x4E2D;&#x552F;&#x4E00;&#x7684;&#x51FD;&#x6570;&#x540D;&#x4E3A;callAPromise&#xFF0C;&#x7136;&#x800C;&#x5B83;&#x548C;&#x9519;&#x8BEF;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#x3002;(&#x6587;&#x4EF6;&#x540D;&#x548C;&#x884C;&#x53F7;&#x8FD8;&#x662F;&#x6709;&#x7528;&#x7684;)&#x3002;</p>\n<p>&#x7136;&#x800C;&#xFF0C;async/await&#x4E2D;&#x7684;&#x9519;&#x8BEF;&#x6808;&#x4F1A;&#x6307;&#x5411;&#x9519;&#x8BEF;&#x6240;&#x5728;&#x7684;&#x51FD;&#x6570;:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> makeRequest = <span class=\"keyword\">async</span> () =&gt; {</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">await</span> callAPromise()</div><div class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&quot;oops&quot;</span>);</div><div class=\"line\">}</div><div class=\"line\"></div><div class=\"line\">makeRequest()</div><div class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> {</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">    <span class=\"comment\">// output</span></div><div class=\"line\">    <span class=\"comment\">// Error: oops at makeRequest (index.js:7:9)</span></div><div class=\"line\">  })</div></pre></td></tr></table></figure>\n<p>&#x5728;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4F18;&#x52BF;&#x5E76;&#x4E0D;&#x5927;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x4F60;&#x5206;&#x6790;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x77E5;&#x9053;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x5728;makeRequest&#x6BD4;&#x77E5;&#x9053;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x5728;then&#x94FE;&#x4E2D;&#x8981;&#x597D;&#x3002;</p>\n<h4 id=\"6-&#x8C03;&#x8BD5;\"><a href=\"#6-&#x8C03;&#x8BD5;\" class=\"headerlink\" title=\"6. &#x8C03;&#x8BD5;\"></a>6. &#x8C03;&#x8BD5;</h4><p>&#x6700;&#x540E;&#x4E00;&#x70B9;&#xFF0C;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;async/await&#x80FD;&#x591F;&#x4F7F;&#x5F97;&#x4EE3;&#x7801;&#x8C03;&#x8BD5;&#x66F4;&#x7B80;&#x5355;&#x3002;2&#x4E2A;&#x7406;&#x7531;&#x4F7F;&#x5F97;&#x8C03;&#x8BD5;Promise&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x75DB;&#x82E6;:</p>\n<ul>\n<li>&#x4E0D;&#x80FD;&#x5728;&#x8FD4;&#x56DE;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#x4E2D;&#x8BBE;&#x7F6E;&#x65AD;&#x70B9;</li>\n</ul>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/04/01/nodejs-async-await/debug-promise.png\"><br></div>\n\n<ul>\n<li>&#x5982;&#x679C;&#x4F60;&#x5728;.then&#x4EE3;&#x7801;&#x5757;&#x4E2D;&#x8BBE;&#x7F6E;&#x65AD;&#x70B9;&#xFF0C;&#x4F7F;&#x7528;Step Over&#x5FEB;&#x6377;&#x952E;&#xFF0C;&#x8C03;&#x8BD5;&#x5668;&#x4E0D;&#x4F1A;&#x8DF3;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;.then&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x4F1A;&#x8DF3;&#x8FC7;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x3002;</li>\n</ul>\n<p>&#x4F7F;&#x7528;await/async&#x65F6;&#xFF0C;&#x4F60;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x90A3;&#x4E48;&#x591A;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x50CF;&#x8C03;&#x8BD5;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#x8DF3;&#x8FC7;await&#x8BED;&#x53E5;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:80%;\" src=\"/2017/04/01/nodejs-async-await/debug-async-await.png\"><br></div>\n\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>Async/Await&#x662F;&#x8FD1;&#x5E74;&#x6765;JavaScript&#x6DFB;&#x52A0;&#x7684;&#x6700;&#x9769;&#x547D;&#x6027;&#x7684;&#x7684;&#x7279;&#x6027;&#x4E4B;&#x4E00;&#x3002;&#x5B83;&#x4F1A;&#x8BA9;&#x4F60;&#x53D1;&#x73B0;Promise&#x7684;&#x8BED;&#x6CD5;&#x6709;&#x591A;&#x7CDF;&#x7CD5;&#xFF0C;&#x800C;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x76F4;&#x89C2;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"&#x5FE7;&#x8651;\"><a href=\"#&#x5FE7;&#x8651;\" class=\"headerlink\" title=\"&#x5FE7;&#x8651;\"></a>&#x5FE7;&#x8651;</h3><p>&#x5BF9;&#x4E8E;Async/Await&#xFF0C;&#x4E5F;&#x8BB8;&#x4F60;&#x6709;&#x4E00;&#x4E9B;&#x5408;&#x7406;&#x7684;&#x6000;&#x7591;&#xFF1A;</p>\n<ul>\n<li>&#x5B83;&#x4F7F;&#x5F97;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x4E0D;&#x5728;&#x660E;&#x663E;: &#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x4E86;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6216;&#x8005;.then&#x6765;&#x8BC6;&#x522B;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x82B1;&#x6570;&#x4E2A;&#x661F;&#x671F;&#x53BB;&#x4E60;&#x60EF;&#x65B0;&#x7684;&#x6807;&#x5FD7;&#x3002;&#x4F46;&#x662F;&#xFF0C;C#&#x62E5;&#x6709;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x5DF2;&#x7ECF;&#x5F88;&#x591A;&#x5E74;&#x4E86;&#xFF0C;&#x719F;&#x6089;&#x5B83;&#x7684;&#x670B;&#x53CB;&#x5E94;&#x8BE5;&#x77E5;&#x9053;&#x6682;&#x65F6;&#x7684;&#x7A0D;&#x5FAE;&#x4E0D;&#x65B9;&#x4FBF;&#x662F;&#x503C;&#x5F97;&#x7684;&#x3002;</li>\n<li>Node 7&#x4E0D;&#x662F;LTS&#xFF08;&#x957F;&#x671F;&#x652F;&#x6301;&#x7248;&#x672C;&#xFF09;: &#x4F46;&#x662F;&#xFF0C;Node 8&#x4E0B;&#x4E2A;&#x6708;&#x5C31;&#x4F1A;&#x53D1;&#x5E03;&#xFF0C;&#x5C06;&#x4EE3;&#x7801;&#x8FC1;&#x79FB;&#x5230;&#x65B0;&#x7248;&#x672C;&#x4F1A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;</li>\n</ul>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 177654062</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/01/nodejs-async-await/nodejs-qq-group.jpeg\"><br></div>"},{"title":"Script error.解决方法","date":"2017-04-07T02:00:00.000Z","_content":"\n为了加快网站访问速度，我们不可避免要将静态资源放到第三方CDN上。然而，我们又需要在出错以后能够知道详细的报错信息，这篇博客将介绍如何避免出现`Script error.`\n\n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:80%;\" src=\"solve-script-error/script-error.png\" />\n</div>\n\n\n### 1. 添加 `crossorigin=\"anonymous\"` 到script标签\n\n ```js\n <script src=\"https://xxx.com/xxx.js\" crossorigin=\"anonymous\"></script>\n ```\n \n `crossorigin`可以取枚举值`anonymous`或则`use-credentials`。\n \n> The \"anonymous\" keyword means that there will be no exchange of user credentials via cookies, client-side SSL certificates or HTTP authentication\n\nanonymous即不发送Cookie和HTTP认证信息，对于静态资源，我们使用`anonymous`就已经足够。 关于crossorigin详情可以参考: [CORS settings attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes)\n\n### 2. 添加支持跨域访问的设置\n\n ```js\n Access-Control-Allow-Origin: *\n ```\n\n> Access-Control-Allow-Origin是HTML5中定义的一种解决资源跨域的策略。他是通过服务器端返回带有Access-Control-Allow-Origin标识的Response header，用来解决资源的跨域权限问题。\n\n\nCDN服务商比如七牛默认已经配置好了Access-Control-Allow-Origin，使用`curl`命令获取头部：\n\n```shell\ncurl --head https://og6593g2z.qnssl.com/fundebug.0.0.4.min.js | grep \"Access-Control-Allow-Origin\"\n```\n结果如下:\n\n<div style=\"text-align: left;\">\n<img style=\"width:59.2%;\" src=\"solve-script-error/qiniu.png\" />\n</div>\n\n\n如果您有单独的子域名(子域名也会被认定为不同源)用来分发静态资源，那么需要在服务端做一点配置。针对不同语言和框架的配置方法我们不一一列出，Nodejs的Express框架下是这样配置的：\n\n```\napp.use(function(req, res, next)\n{\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, DELETE\");\n    next();\n});\n```\n\n其它设置Access-Control-Allow-Origin请参考\n\n- PHP: [ajax 设置Access-Control-Allow-Origin实现跨域访问](http://blog.csdn.net/fdipzone/article/details/46390573/)\n- Java: [Java 无法跨域问题（No 'Access-Control-Allow-Origin'..）](http://blog.csdn.net/caixiajia/article/details/53648145)\n- Nginx: [nginx Access-Control-Allow-Origin css跨域](http://www.cnblogs.com/wei-lai/p/6269639.html)\n\n\n如果有任何疑问，可以联系我们，欢迎加入[Fundebug](https://fundebug.com)的QQ交流群：\n \n<div style=\"text-align: center;\">\n<img style=\"width:15%;\" src=\"solve-script-error/QRCode.png\" />\n</div>\n","source":"_posts/2017/04/07/solve-script-error.md","raw":"---\ntitle: Script error.解决方法\n\ndate: 2017-04-07 10:00:00\n\ntags: [JavaScript, BUG]\n---\n\n为了加快网站访问速度，我们不可避免要将静态资源放到第三方CDN上。然而，我们又需要在出错以后能够知道详细的报错信息，这篇博客将介绍如何避免出现`Script error.`\n\n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:80%;\" src=\"solve-script-error/script-error.png\" />\n</div>\n\n\n### 1. 添加 `crossorigin=\"anonymous\"` 到script标签\n\n ```js\n <script src=\"https://xxx.com/xxx.js\" crossorigin=\"anonymous\"></script>\n ```\n \n `crossorigin`可以取枚举值`anonymous`或则`use-credentials`。\n \n> The \"anonymous\" keyword means that there will be no exchange of user credentials via cookies, client-side SSL certificates or HTTP authentication\n\nanonymous即不发送Cookie和HTTP认证信息，对于静态资源，我们使用`anonymous`就已经足够。 关于crossorigin详情可以参考: [CORS settings attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes)\n\n### 2. 添加支持跨域访问的设置\n\n ```js\n Access-Control-Allow-Origin: *\n ```\n\n> Access-Control-Allow-Origin是HTML5中定义的一种解决资源跨域的策略。他是通过服务器端返回带有Access-Control-Allow-Origin标识的Response header，用来解决资源的跨域权限问题。\n\n\nCDN服务商比如七牛默认已经配置好了Access-Control-Allow-Origin，使用`curl`命令获取头部：\n\n```shell\ncurl --head https://og6593g2z.qnssl.com/fundebug.0.0.4.min.js | grep \"Access-Control-Allow-Origin\"\n```\n结果如下:\n\n<div style=\"text-align: left;\">\n<img style=\"width:59.2%;\" src=\"solve-script-error/qiniu.png\" />\n</div>\n\n\n如果您有单独的子域名(子域名也会被认定为不同源)用来分发静态资源，那么需要在服务端做一点配置。针对不同语言和框架的配置方法我们不一一列出，Nodejs的Express框架下是这样配置的：\n\n```\napp.use(function(req, res, next)\n{\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, DELETE\");\n    next();\n});\n```\n\n其它设置Access-Control-Allow-Origin请参考\n\n- PHP: [ajax 设置Access-Control-Allow-Origin实现跨域访问](http://blog.csdn.net/fdipzone/article/details/46390573/)\n- Java: [Java 无法跨域问题（No 'Access-Control-Allow-Origin'..）](http://blog.csdn.net/caixiajia/article/details/53648145)\n- Nginx: [nginx Access-Control-Allow-Origin css跨域](http://www.cnblogs.com/wei-lai/p/6269639.html)\n\n\n如果有任何疑问，可以联系我们，欢迎加入[Fundebug](https://fundebug.com)的QQ交流群：\n \n<div style=\"text-align: center;\">\n<img style=\"width:15%;\" src=\"solve-script-error/QRCode.png\" />\n</div>\n","slug":"2017/04/07/solve-script-error","published":1,"updated":"2017-04-07T01:31:22.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywenj001lmkfyqfk9vi5n","content":"<p>&#x4E3A;&#x4E86;&#x52A0;&#x5FEB;&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x53EF;&#x907F;&#x514D;&#x8981;&#x5C06;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x653E;&#x5230;&#x7B2C;&#x4E09;&#x65B9;CDN&#x4E0A;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x9700;&#x8981;&#x5728;&#x51FA;&#x9519;&#x4EE5;&#x540E;&#x80FD;&#x591F;&#x77E5;&#x9053;&#x8BE6;&#x7EC6;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x907F;&#x514D;&#x51FA;&#x73B0;<code>Script error.</code></p>\n<a id=\"more\"></a>\n<div style=\"text-align: left;\"><br><img style=\"width:80%;\" src=\"/2017/04/07/solve-script-error/script-error.png\"><br></div>\n\n\n<h3 id=\"1-&#x6DFB;&#x52A0;-crossorigin-quot-anonymous-quot-&#x5230;script&#x6807;&#x7B7E;\"><a href=\"#1-&#x6DFB;&#x52A0;-crossorigin-quot-anonymous-quot-&#x5230;script&#x6807;&#x7B7E;\" class=\"headerlink\" title=\"1. &#x6DFB;&#x52A0; crossorigin=&quot;anonymous&quot; &#x5230;script&#x6807;&#x7B7E;\"></a>1. &#x6DFB;&#x52A0; <code>crossorigin=&quot;anonymous&quot;</code> &#x5230;script&#x6807;&#x7B7E;</h3> <figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">&quot;https://xxx.com/xxx.js&quot;</span> crossorigin=<span class=\"string\">&quot;anonymous&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n<p> <code>crossorigin</code>&#x53EF;&#x4EE5;&#x53D6;&#x679A;&#x4E3E;&#x503C;<code>anonymous</code>&#x6216;&#x5219;<code>use-credentials</code>&#x3002;</p>\n<blockquote>\n<p>The &#x201C;anonymous&#x201D; keyword means that there will be no exchange of user credentials via cookies, client-side SSL certificates or HTTP authentication</p>\n</blockquote>\n<p>anonymous&#x5373;&#x4E0D;&#x53D1;&#x9001;Cookie&#x548C;HTTP&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#xFF0C;&#x5BF9;&#x4E8E;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>anonymous</code>&#x5C31;&#x5DF2;&#x7ECF;&#x8DB3;&#x591F;&#x3002; &#x5173;&#x4E8E;crossorigin&#x8BE6;&#x60C5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;: <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes\" target=\"_blank\" rel=\"external\">CORS settings attributes</a></p>\n<h3 id=\"2-&#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;\"><a href=\"#2-&#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"2. &#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;\"></a>2. &#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;</h3> <figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Access-Control-Allow-Origin: *</div></pre></td></tr></table></figure>\n<blockquote>\n<p>Access-Control-Allow-Origin&#x662F;HTML5&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x8D44;&#x6E90;&#x8DE8;&#x57DF;&#x7684;&#x7B56;&#x7565;&#x3002;&#x4ED6;&#x662F;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FD4;&#x56DE;&#x5E26;&#x6709;Access-Control-Allow-Origin&#x6807;&#x8BC6;&#x7684;Response header&#xFF0C;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x8D44;&#x6E90;&#x7684;&#x8DE8;&#x57DF;&#x6743;&#x9650;&#x95EE;&#x9898;&#x3002;</p>\n</blockquote>\n<p>CDN&#x670D;&#x52A1;&#x5546;&#x6BD4;&#x5982;&#x4E03;&#x725B;&#x9ED8;&#x8BA4;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x597D;&#x4E86;Access-Control-Allow-Origin&#xFF0C;&#x4F7F;&#x7528;<code>curl</code>&#x547D;&#x4EE4;&#x83B7;&#x53D6;&#x5934;&#x90E8;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl --head https://og6593g2z.qnssl.com/fundebug.0.0.4.min.js | grep &quot;Access-Control-Allow-Origin&quot;</div></pre></td></tr></table></figure>\n<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:59.2%;\" src=\"/2017/04/07/solve-script-error/qiniu.png\"><br></div>\n\n\n<p>&#x5982;&#x679C;&#x60A8;&#x6709;&#x5355;&#x72EC;&#x7684;&#x5B50;&#x57DF;&#x540D;(&#x5B50;&#x57DF;&#x540D;&#x4E5F;&#x4F1A;&#x88AB;&#x8BA4;&#x5B9A;&#x4E3A;&#x4E0D;&#x540C;&#x6E90;)&#x7528;&#x6765;&#x5206;&#x53D1;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x505A;&#x4E00;&#x70B9;&#x914D;&#x7F6E;&#x3002;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x8BED;&#x8A00;&#x548C;&#x6846;&#x67B6;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x51FA;&#xFF0C;Nodejs&#x7684;Express&#x6846;&#x67B6;&#x4E0B;&#x662F;&#x8FD9;&#x6837;&#x914D;&#x7F6E;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">app.use(function(req, res, next)</div><div class=\"line\">{</div><div class=\"line\">    res.header(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</div><div class=\"line\">    res.header(<span class=\"string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"string\">&quot;<span class=\"keyword\">GET</span>, <span class=\"keyword\">POST</span>, <span class=\"keyword\">PUT</span>, <span class=\"keyword\">DELETE</span>&quot;</span>);</div><div class=\"line\">    next();</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B83;&#x8BBE;&#x7F6E;Access-Control-Allow-Origin&#x8BF7;&#x53C2;&#x8003;</p>\n<ul>\n<li>PHP: <a href=\"http://blog.csdn.net/fdipzone/article/details/46390573/\" target=\"_blank\" rel=\"external\">ajax &#x8BBE;&#x7F6E;Access-Control-Allow-Origin&#x5B9E;&#x73B0;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;</a></li>\n<li>Java: <a href=\"http://blog.csdn.net/caixiajia/article/details/53648145\" target=\"_blank\" rel=\"external\">Java &#x65E0;&#x6CD5;&#x8DE8;&#x57DF;&#x95EE;&#x9898;&#xFF08;No &#x2018;Access-Control-Allow-Origin&#x2019;..&#xFF09;</a></li>\n<li>Nginx: <a href=\"http://www.cnblogs.com/wei-lai/p/6269639.html\" target=\"_blank\" rel=\"external\">nginx Access-Control-Allow-Origin css&#x8DE8;&#x57DF;</a></li>\n</ul>\n<p>&#x5982;&#x679C;&#x6709;&#x4EFB;&#x4F55;&#x7591;&#x95EE;&#xFF0C;&#x53EF;&#x4EE5;&#x8054;&#x7CFB;&#x6211;&#x4EEC;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;QQ&#x4EA4;&#x6D41;&#x7FA4;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:15%;\" src=\"/2017/04/07/solve-script-error/QRCode.png\"><br></div>\n","excerpt":"<p>&#x4E3A;&#x4E86;&#x52A0;&#x5FEB;&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x53EF;&#x907F;&#x514D;&#x8981;&#x5C06;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x653E;&#x5230;&#x7B2C;&#x4E09;&#x65B9;CDN&#x4E0A;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x9700;&#x8981;&#x5728;&#x51FA;&#x9519;&#x4EE5;&#x540E;&#x80FD;&#x591F;&#x77E5;&#x9053;&#x8BE6;&#x7EC6;&#x7684;&#x62A5;&#x9519;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x907F;&#x514D;&#x51FA;&#x73B0;<code>Script error.</code></p>","more":"<div style=\"text-align: left;\"><br><img style=\"width:80%;\" src=\"/2017/04/07/solve-script-error/script-error.png\"><br></div>\n\n\n<h3 id=\"1-&#x6DFB;&#x52A0;-crossorigin-quot-anonymous-quot-&#x5230;script&#x6807;&#x7B7E;\"><a href=\"#1-&#x6DFB;&#x52A0;-crossorigin-quot-anonymous-quot-&#x5230;script&#x6807;&#x7B7E;\" class=\"headerlink\" title=\"1. &#x6DFB;&#x52A0; crossorigin=&quot;anonymous&quot; &#x5230;script&#x6807;&#x7B7E;\"></a>1. &#x6DFB;&#x52A0; <code>crossorigin=&quot;anonymous&quot;</code> &#x5230;script&#x6807;&#x7B7E;</h3> <figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;script src=<span class=\"string\">&quot;https://xxx.com/xxx.js&quot;</span> crossorigin=<span class=\"string\">&quot;anonymous&quot;</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n<p> <code>crossorigin</code>&#x53EF;&#x4EE5;&#x53D6;&#x679A;&#x4E3E;&#x503C;<code>anonymous</code>&#x6216;&#x5219;<code>use-credentials</code>&#x3002;</p>\n<blockquote>\n<p>The &#x201C;anonymous&#x201D; keyword means that there will be no exchange of user credentials via cookies, client-side SSL certificates or HTTP authentication</p>\n</blockquote>\n<p>anonymous&#x5373;&#x4E0D;&#x53D1;&#x9001;Cookie&#x548C;HTTP&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#xFF0C;&#x5BF9;&#x4E8E;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>anonymous</code>&#x5C31;&#x5DF2;&#x7ECF;&#x8DB3;&#x591F;&#x3002; &#x5173;&#x4E8E;crossorigin&#x8BE6;&#x60C5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;: <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes\">CORS settings attributes</a></p>\n<h3 id=\"2-&#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;\"><a href=\"#2-&#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"2. &#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;\"></a>2. &#x6DFB;&#x52A0;&#x652F;&#x6301;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;&#x7684;&#x8BBE;&#x7F6E;</h3> <figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Access-Control-Allow-Origin: *</div></pre></td></tr></table></figure>\n<blockquote>\n<p>Access-Control-Allow-Origin&#x662F;HTML5&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x8D44;&#x6E90;&#x8DE8;&#x57DF;&#x7684;&#x7B56;&#x7565;&#x3002;&#x4ED6;&#x662F;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FD4;&#x56DE;&#x5E26;&#x6709;Access-Control-Allow-Origin&#x6807;&#x8BC6;&#x7684;Response header&#xFF0C;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x8D44;&#x6E90;&#x7684;&#x8DE8;&#x57DF;&#x6743;&#x9650;&#x95EE;&#x9898;&#x3002;</p>\n</blockquote>\n<p>CDN&#x670D;&#x52A1;&#x5546;&#x6BD4;&#x5982;&#x4E03;&#x725B;&#x9ED8;&#x8BA4;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;&#x597D;&#x4E86;Access-Control-Allow-Origin&#xFF0C;&#x4F7F;&#x7528;<code>curl</code>&#x547D;&#x4EE4;&#x83B7;&#x53D6;&#x5934;&#x90E8;&#xFF1A;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl --head https://og6593g2z.qnssl.com/fundebug.0.0.4.min.js | grep &quot;Access-Control-Allow-Origin&quot;</div></pre></td></tr></table></figure>\n<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:59.2%;\" src=\"/2017/04/07/solve-script-error/qiniu.png\"><br></div>\n\n\n<p>&#x5982;&#x679C;&#x60A8;&#x6709;&#x5355;&#x72EC;&#x7684;&#x5B50;&#x57DF;&#x540D;(&#x5B50;&#x57DF;&#x540D;&#x4E5F;&#x4F1A;&#x88AB;&#x8BA4;&#x5B9A;&#x4E3A;&#x4E0D;&#x540C;&#x6E90;)&#x7528;&#x6765;&#x5206;&#x53D1;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x505A;&#x4E00;&#x70B9;&#x914D;&#x7F6E;&#x3002;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x8BED;&#x8A00;&#x548C;&#x6846;&#x67B6;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x51FA;&#xFF0C;Nodejs&#x7684;Express&#x6846;&#x67B6;&#x4E0B;&#x662F;&#x8FD9;&#x6837;&#x914D;&#x7F6E;&#x7684;&#xFF1A;</p>\n<figure class=\"highlight accesslog\"><table><tr><td class=\"code\"><pre><div class=\"line\">app.use(function(req, res, next)</div><div class=\"line\">{</div><div class=\"line\">    res.header(<span class=\"string\">&quot;Access-Control-Allow-Origin&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</div><div class=\"line\">    res.header(<span class=\"string\">&quot;Access-Control-Allow-Methods&quot;</span>, <span class=\"string\">&quot;<span class=\"keyword\">GET</span>, <span class=\"keyword\">POST</span>, <span class=\"keyword\">PUT</span>, <span class=\"keyword\">DELETE</span>&quot;</span>);</div><div class=\"line\">    next();</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<p>&#x5176;&#x5B83;&#x8BBE;&#x7F6E;Access-Control-Allow-Origin&#x8BF7;&#x53C2;&#x8003;</p>\n<ul>\n<li>PHP: <a href=\"http://blog.csdn.net/fdipzone/article/details/46390573/\">ajax &#x8BBE;&#x7F6E;Access-Control-Allow-Origin&#x5B9E;&#x73B0;&#x8DE8;&#x57DF;&#x8BBF;&#x95EE;</a></li>\n<li>Java: <a href=\"http://blog.csdn.net/caixiajia/article/details/53648145\">Java &#x65E0;&#x6CD5;&#x8DE8;&#x57DF;&#x95EE;&#x9898;&#xFF08;No &#x2018;Access-Control-Allow-Origin&#x2019;..&#xFF09;</a></li>\n<li>Nginx: <a href=\"http://www.cnblogs.com/wei-lai/p/6269639.html\">nginx Access-Control-Allow-Origin css&#x8DE8;&#x57DF;</a></li>\n</ul>\n<p>&#x5982;&#x679C;&#x6709;&#x4EFB;&#x4F55;&#x7591;&#x95EE;&#xFF0C;&#x53EF;&#x4EE5;&#x8054;&#x7CFB;&#x6211;&#x4EEC;&#xFF0C;&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com\">Fundebug</a>&#x7684;QQ&#x4EA4;&#x6D41;&#x7FA4;&#xFF1A;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:15%;\" src=\"/2017/04/07/solve-script-error/QRCode.png\"><br></div>"},{"title":"Script error.全面解析","date":"2017-04-05T02:00:00.000Z","_content":"\n\n一些用户向我们反馈，[Fundebug](https://fundebug.com/)的[JavaScript](https://docs.fundebug.com/notifier/javascript/)监控插件抓到了很多**Script error.**，然后行号和列号都是0...这就很尴尬了。\n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:80%;\" src=\"understand-script-error/script-error.png\" />\n</div>\n\n今天，我们来详细地解析一下`Script error.`，后续我们还会深度测试并且提供解决方法。\n\n### 同源策略 (Same origin policy)\n\n解释`Script error.`之前，我们先简单聊聊同源策略。摘自[MDN - Same-origin policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy):\n> Two pages have the same origin if the protocol, port (if one is specified), and host are the same for both pages. \n\n所谓同源，就是指两个页面具有相同的协议、端口和主机(域名)。通过第三方加载的JavaScript脚本是不同源的。下面的表格简单列出了和`https://fundebug.com/app.js`是否同源的文件:\n\n<style type=\"text/css\">\n\tcode {\n\t\ttext-overflow:clip;/*文本裁切*/\n            white-space:nowrap;/*强制不换行*/\n            overflow:hidden;/*溢出隐藏*/\n\t}\n</style>\n\n| 网址                                  | 是否同源   |  原因  |\n| ----------------------------------   | --------: | :----: |\n| `https://fundebug.com/vendor.js`   | 是        |         |\n| `http://fundebug.com/vendor.js`    | 否        | 协议不同  |\n| `https://fundebug.com:8001/app.js` | 否        | 端口不同  |\n| `https://docs.fundebug.com/nav.js`  | 否        | 子域名不同  |\n| `https://kiwenlau.com/totop.js`     | 否        | 域名不同  |\n\n没有同源策略的话，将会怎样？摘自[同源策略详解及绕过 - FreeBuf](http://www.freebuf.com/articles/web/65468.html)：\n\n> 假设你已经成功登录Gmail服务器，同时在同一个浏览器访问恶意站点（另一个浏览器选项卡）。没有同源策略，攻击者可以通过JavaScript获取你的邮件以及其他敏感信息，比如说阅读你的私密邮件，发送虚假邮件，看你的聊天记录等等。 如果将Gmail替换为你的银行帐户，问题就大条了。\n\n### 为啥出现Script error. ?\n\n为了提升网站的访问速度，我们通常都会将静态资源文件(css, image, javascript)放在第三方CDN。当这些从第三方加载的JavaScript脚本执行出错，因为违背了**同源策略**, 为了保证用户信息不被泄露，错误信息不会显示出来，取而代之只会返回一个`Script error.`。\n\n暴露错误信息会怎样呢？摘自([Cryptic “Script Error.” reported in Javascript in Chrome and Firefox](http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox))：\n\n> 假想你不小心访问了一个恶意网站，网页里面偷偷放入了一段JavaScript脚本 `<script src=\"cbcc.com/index.html\">`，这段脚本指向你使用的某银行网站首页。虽然脚本会执行失败，但是错误信息却有可能泄露你的信息。如果你已经登录过该银行网站并且处于登录状态，那么错误信息可能为`'欢迎你 ....' is undefined`；如果你没有登录，那么错误信息可能是`'请登录...' is undefined`。 然后黑客就可以根据这些信息确定你使用的银行网站，并且伪造一个钓鱼网站来骗取钱财。\n\n\n### 源码\n\n[webkit源码](http://trac.webkit.org/browser/branches/chromium/648/Source/WebCore/dom/ScriptExecutionContext.cpp)如下：\n\n```c++\nbool ScriptExecutionContext::dispatchErrorEvent(const String& errorMessage, \n    int lineNumber, \n    const String& sourceURL)\n{\n    EventTarget* target = errorEventTarget();\n    if (!target)\n        return false;\n    ...\n    if (securityOrigin()->canRequest(targetUrl)) {\n        message = errorMessage;\n        line = lineNumber;\n        sourceName = sourceURL;\n    } else {\n        message = \"Script error.\";\n        sourceName = String();\n        line = 0;\n    }\n    ...\n}\n```\n\n可知，浏览器会判断所加载的资源url是否同源(`securityOrigin()->canRequest(targetUrl)`)，如果不同源，则将错误消息隐藏，赋值为`Script error.`, 并且将行号设为0.\n\n因此，如果我们从第三方CDN服务加载资源，如果出错的话，那么我们将只能看到`Script error.`。\n\n### 错误复现\n\n我们用一个简单的例子测试一下。下面是**index.html**，我们使用onerror来捕获错误。\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Test Script error</title>\n    <script type=\"text/javascript\">\n      window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, error){\n        console.log(errorMessage);\n        console.log(scriptURI);\n        console.log(lineNumber);\n        console.log(columnNumber);\n        console.log(error);\n      }\n    </script>\n    <script type=\"text/javascript\" src=\"./scripterror.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n\n在**scripterror.js**中抛出一个Error对象：\n\n```js\nthrow new Error('Hello, Fundebug');\n```\n\n使用的[`http-server`](https://www.npmjs.com/package/http-server)挂载文件，打开[http://localhost:8080/index.html](http://localhost:8080/index.html)，\n\n在Chrome浏览器控制台下，可以看到详细的出错信息:\n\n<div style=\"text-align: left;\">\n<img style=\"width:35.8%;\" src=\"understand-script-error/script-error-ok.png\" />\n</div>\n\n\n为了复现`Scrpt error.`， 将`scripterror.js`放到我在`coding.net`的个人项目下面:\n\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Test Script error</title>\n    <script type=\"text/javascript\">\n      window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, error){\n        console.log(errorMessage);\n        console.log(scriptURI);\n        console.log(lineNumber);\n        console.log(columnNumber);\n        console.log(error);\n      }\n    </script>\n    <script type=\"text/javascript\" src=\"http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n运行`http-server`, 结果如下：\n\n<div style=\"text-align: left;\">\n<img style=\"width:35.8%;\" src=\"understand-script-error/script-error-not-ok-chrome.png\" />\n</div>\n\n因为违背同源策略，这时只能拿到`Script error.`。\n\n### 总结\n\n本文介绍了`Script error.`的由来，并提供了一个简单的实例来演示什么情况下出现`Script error.`。接下来，我们将对**Script error**进行[深度测试](http://blog.fundebug.com/2017/04/06/test-script-error/)并提出[解决方法](http://blog.fundebug.com/2017/04/07/solve-script-error/)\n","source":"_posts/2017/04/05/understand-script-error.md","raw":"---\ntitle: Script error.全面解析\n\ndate: 2017-04-05 10:00:00\n\ntags: [JavaScript, BUG]\n\n---\n\n\n一些用户向我们反馈，[Fundebug](https://fundebug.com/)的[JavaScript](https://docs.fundebug.com/notifier/javascript/)监控插件抓到了很多**Script error.**，然后行号和列号都是0...这就很尴尬了。\n\n<!-- more -->\n\n<div style=\"text-align: left;\">\n<img style=\"width:80%;\" src=\"understand-script-error/script-error.png\" />\n</div>\n\n今天，我们来详细地解析一下`Script error.`，后续我们还会深度测试并且提供解决方法。\n\n### 同源策略 (Same origin policy)\n\n解释`Script error.`之前，我们先简单聊聊同源策略。摘自[MDN - Same-origin policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy):\n> Two pages have the same origin if the protocol, port (if one is specified), and host are the same for both pages. \n\n所谓同源，就是指两个页面具有相同的协议、端口和主机(域名)。通过第三方加载的JavaScript脚本是不同源的。下面的表格简单列出了和`https://fundebug.com/app.js`是否同源的文件:\n\n<style type=\"text/css\">\n\tcode {\n\t\ttext-overflow:clip;/*文本裁切*/\n            white-space:nowrap;/*强制不换行*/\n            overflow:hidden;/*溢出隐藏*/\n\t}\n</style>\n\n| 网址                                  | 是否同源   |  原因  |\n| ----------------------------------   | --------: | :----: |\n| `https://fundebug.com/vendor.js`   | 是        |         |\n| `http://fundebug.com/vendor.js`    | 否        | 协议不同  |\n| `https://fundebug.com:8001/app.js` | 否        | 端口不同  |\n| `https://docs.fundebug.com/nav.js`  | 否        | 子域名不同  |\n| `https://kiwenlau.com/totop.js`     | 否        | 域名不同  |\n\n没有同源策略的话，将会怎样？摘自[同源策略详解及绕过 - FreeBuf](http://www.freebuf.com/articles/web/65468.html)：\n\n> 假设你已经成功登录Gmail服务器，同时在同一个浏览器访问恶意站点（另一个浏览器选项卡）。没有同源策略，攻击者可以通过JavaScript获取你的邮件以及其他敏感信息，比如说阅读你的私密邮件，发送虚假邮件，看你的聊天记录等等。 如果将Gmail替换为你的银行帐户，问题就大条了。\n\n### 为啥出现Script error. ?\n\n为了提升网站的访问速度，我们通常都会将静态资源文件(css, image, javascript)放在第三方CDN。当这些从第三方加载的JavaScript脚本执行出错，因为违背了**同源策略**, 为了保证用户信息不被泄露，错误信息不会显示出来，取而代之只会返回一个`Script error.`。\n\n暴露错误信息会怎样呢？摘自([Cryptic “Script Error.” reported in Javascript in Chrome and Firefox](http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox))：\n\n> 假想你不小心访问了一个恶意网站，网页里面偷偷放入了一段JavaScript脚本 `<script src=\"cbcc.com/index.html\">`，这段脚本指向你使用的某银行网站首页。虽然脚本会执行失败，但是错误信息却有可能泄露你的信息。如果你已经登录过该银行网站并且处于登录状态，那么错误信息可能为`'欢迎你 ....' is undefined`；如果你没有登录，那么错误信息可能是`'请登录...' is undefined`。 然后黑客就可以根据这些信息确定你使用的银行网站，并且伪造一个钓鱼网站来骗取钱财。\n\n\n### 源码\n\n[webkit源码](http://trac.webkit.org/browser/branches/chromium/648/Source/WebCore/dom/ScriptExecutionContext.cpp)如下：\n\n```c++\nbool ScriptExecutionContext::dispatchErrorEvent(const String& errorMessage, \n    int lineNumber, \n    const String& sourceURL)\n{\n    EventTarget* target = errorEventTarget();\n    if (!target)\n        return false;\n    ...\n    if (securityOrigin()->canRequest(targetUrl)) {\n        message = errorMessage;\n        line = lineNumber;\n        sourceName = sourceURL;\n    } else {\n        message = \"Script error.\";\n        sourceName = String();\n        line = 0;\n    }\n    ...\n}\n```\n\n可知，浏览器会判断所加载的资源url是否同源(`securityOrigin()->canRequest(targetUrl)`)，如果不同源，则将错误消息隐藏，赋值为`Script error.`, 并且将行号设为0.\n\n因此，如果我们从第三方CDN服务加载资源，如果出错的话，那么我们将只能看到`Script error.`。\n\n### 错误复现\n\n我们用一个简单的例子测试一下。下面是**index.html**，我们使用onerror来捕获错误。\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Test Script error</title>\n    <script type=\"text/javascript\">\n      window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, error){\n        console.log(errorMessage);\n        console.log(scriptURI);\n        console.log(lineNumber);\n        console.log(columnNumber);\n        console.log(error);\n      }\n    </script>\n    <script type=\"text/javascript\" src=\"./scripterror.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n\n在**scripterror.js**中抛出一个Error对象：\n\n```js\nthrow new Error('Hello, Fundebug');\n```\n\n使用的[`http-server`](https://www.npmjs.com/package/http-server)挂载文件，打开[http://localhost:8080/index.html](http://localhost:8080/index.html)，\n\n在Chrome浏览器控制台下，可以看到详细的出错信息:\n\n<div style=\"text-align: left;\">\n<img style=\"width:35.8%;\" src=\"understand-script-error/script-error-ok.png\" />\n</div>\n\n\n为了复现`Scrpt error.`， 将`scripterror.js`放到我在`coding.net`的个人项目下面:\n\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Test Script error</title>\n    <script type=\"text/javascript\">\n      window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, error){\n        console.log(errorMessage);\n        console.log(scriptURI);\n        console.log(lineNumber);\n        console.log(columnNumber);\n        console.log(error);\n      }\n    </script>\n    <script type=\"text/javascript\" src=\"http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n运行`http-server`, 结果如下：\n\n<div style=\"text-align: left;\">\n<img style=\"width:35.8%;\" src=\"understand-script-error/script-error-not-ok-chrome.png\" />\n</div>\n\n因为违背同源策略，这时只能拿到`Script error.`。\n\n### 总结\n\n本文介绍了`Script error.`的由来，并提供了一个简单的实例来演示什么情况下出现`Script error.`。接下来，我们将对**Script error**进行[深度测试](http://blog.fundebug.com/2017/04/06/test-script-error/)并提出[解决方法](http://blog.fundebug.com/2017/04/07/solve-script-error/)\n","slug":"2017/04/05/understand-script-error","published":1,"updated":"2017-04-07T11:53:07.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywenk001nmkfyz6o8az96","content":"<p>&#x4E00;&#x4E9B;&#x7528;&#x6237;&#x5411;&#x6211;&#x4EEC;&#x53CD;&#x9988;&#xFF0C;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a>&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\" target=\"_blank\" rel=\"external\">JavaScript</a>&#x76D1;&#x63A7;&#x63D2;&#x4EF6;&#x6293;&#x5230;&#x4E86;&#x5F88;&#x591A;<strong>Script error.</strong>&#xFF0C;&#x7136;&#x540E;&#x884C;&#x53F7;&#x548C;&#x5217;&#x53F7;&#x90FD;&#x662F;0&#x2026;&#x8FD9;&#x5C31;&#x5F88;&#x5C34;&#x5C2C;&#x4E86;&#x3002;</p>\n<a id=\"more\"></a>\n<div style=\"text-align: left;\"><br><img style=\"width:80%;\" src=\"/2017/04/05/understand-script-error/script-error.png\"><br></div>\n\n<p>&#x4ECA;&#x5929;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x8BE6;&#x7EC6;&#x5730;&#x89E3;&#x6790;&#x4E00;&#x4E0B;<code>Script error.</code>&#xFF0C;&#x540E;&#x7EED;&#x6211;&#x4EEC;&#x8FD8;&#x4F1A;&#x6DF1;&#x5EA6;&#x6D4B;&#x8BD5;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"&#x540C;&#x6E90;&#x7B56;&#x7565;-Same-origin-policy\"><a href=\"#&#x540C;&#x6E90;&#x7B56;&#x7565;-Same-origin-policy\" class=\"headerlink\" title=\"&#x540C;&#x6E90;&#x7B56;&#x7565; (Same origin policy)\"></a>&#x540C;&#x6E90;&#x7B56;&#x7565; (Same origin policy)</h3><p>&#x89E3;&#x91CA;<code>Script error.</code>&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x7B80;&#x5355;&#x804A;&#x804A;&#x540C;&#x6E90;&#x7B56;&#x7565;&#x3002;&#x6458;&#x81EA;<a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\" target=\"_blank\" rel=\"external\">MDN - Same-origin policy</a>:</p>\n<blockquote>\n<p>Two pages have the same origin if the protocol, port (if one is specified), and host are the same for both pages. </p>\n</blockquote>\n<p>&#x6240;&#x8C13;&#x540C;&#x6E90;&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x4E24;&#x4E2A;&#x9875;&#x9762;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;&#x534F;&#x8BAE;&#x3001;&#x7AEF;&#x53E3;&#x548C;&#x4E3B;&#x673A;(&#x57DF;&#x540D;)&#x3002;&#x901A;&#x8FC7;&#x7B2C;&#x4E09;&#x65B9;&#x52A0;&#x8F7D;&#x7684;JavaScript&#x811A;&#x672C;&#x662F;&#x4E0D;&#x540C;&#x6E90;&#x7684;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x8868;&#x683C;&#x7B80;&#x5355;&#x5217;&#x51FA;&#x4E86;&#x548C;<code>https://fundebug.com/app.js</code>&#x662F;&#x5426;&#x540C;&#x6E90;&#x7684;&#x6587;&#x4EF6;:</p>\n<style type=\"text/css\">\n    code {\n        text-overflow:clip;/*文本裁切*/\n            white-space:nowrap;/*强制不换行*/\n            overflow:hidden;/*溢出隐藏*/\n    }\n</style>\n\n<table>\n<thead>\n<tr>\n<th>&#x7F51;&#x5740;</th>\n<th style=\"text-align:right\">&#x662F;&#x5426;&#x540C;&#x6E90;</th>\n<th style=\"text-align:center\">&#x539F;&#x56E0;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>https://fundebug.com/vendor.js</code></td>\n<td style=\"text-align:right\">&#x662F;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td><code>http://fundebug.com/vendor.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x534F;&#x8BAE;&#x4E0D;&#x540C;</td>\n</tr>\n<tr>\n<td><code>https://fundebug.com:8001/app.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x7AEF;&#x53E3;&#x4E0D;&#x540C;</td>\n</tr>\n<tr>\n<td><code>https://docs.fundebug.com/nav.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x5B50;&#x57DF;&#x540D;&#x4E0D;&#x540C;</td>\n</tr>\n<tr>\n<td><code>https://kiwenlau.com/totop.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x57DF;&#x540D;&#x4E0D;&#x540C;</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6CA1;&#x6709;&#x540C;&#x6E90;&#x7B56;&#x7565;&#x7684;&#x8BDD;&#xFF0C;&#x5C06;&#x4F1A;&#x600E;&#x6837;&#xFF1F;&#x6458;&#x81EA;<a href=\"http://www.freebuf.com/articles/web/65468.html\" target=\"_blank\" rel=\"external\">&#x540C;&#x6E90;&#x7B56;&#x7565;&#x8BE6;&#x89E3;&#x53CA;&#x7ED5;&#x8FC7; - FreeBuf</a>&#xFF1A;</p>\n<blockquote>\n<p>&#x5047;&#x8BBE;&#x4F60;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x767B;&#x5F55;Gmail&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x6076;&#x610F;&#x7AD9;&#x70B9;&#xFF08;&#x53E6;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x9009;&#x9879;&#x5361;&#xFF09;&#x3002;&#x6CA1;&#x6709;&#x540C;&#x6E90;&#x7B56;&#x7565;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;JavaScript&#x83B7;&#x53D6;&#x4F60;&#x7684;&#x90AE;&#x4EF6;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x654F;&#x611F;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#x9605;&#x8BFB;&#x4F60;&#x7684;&#x79C1;&#x5BC6;&#x90AE;&#x4EF6;&#xFF0C;&#x53D1;&#x9001;&#x865A;&#x5047;&#x90AE;&#x4EF6;&#xFF0C;&#x770B;&#x4F60;&#x7684;&#x804A;&#x5929;&#x8BB0;&#x5F55;&#x7B49;&#x7B49;&#x3002; &#x5982;&#x679C;&#x5C06;Gmail&#x66FF;&#x6362;&#x4E3A;&#x4F60;&#x7684;&#x94F6;&#x884C;&#x5E10;&#x6237;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x5927;&#x6761;&#x4E86;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script-error\"><a href=\"#&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script-error\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script error. ?\"></a>&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script error. ?</h3><p>&#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x7F51;&#x7AD9;&#x7684;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x90FD;&#x4F1A;&#x5C06;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x6587;&#x4EF6;(css, image, javascript)&#x653E;&#x5728;&#x7B2C;&#x4E09;&#x65B9;CDN&#x3002;&#x5F53;&#x8FD9;&#x4E9B;&#x4ECE;&#x7B2C;&#x4E09;&#x65B9;&#x52A0;&#x8F7D;&#x7684;JavaScript&#x811A;&#x672C;&#x6267;&#x884C;&#x51FA;&#x9519;&#xFF0C;&#x56E0;&#x4E3A;&#x8FDD;&#x80CC;&#x4E86;<strong>&#x540C;&#x6E90;&#x7B56;&#x7565;</strong>, &#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x4E0D;&#x88AB;&#x6CC4;&#x9732;&#xFF0C;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4E0D;&#x4F1A;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x53EA;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>Script error.</code>&#x3002;</p>\n<p>&#x66B4;&#x9732;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4F1A;&#x600E;&#x6837;&#x5462;&#xFF1F;&#x6458;&#x81EA;(<a href=\"http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox\" target=\"_blank\" rel=\"external\">Cryptic &#x201C;Script Error.&#x201D; reported in Javascript in Chrome and Firefox</a>)&#xFF1A;</p>\n<blockquote>\n<p>&#x5047;&#x60F3;&#x4F60;&#x4E0D;&#x5C0F;&#x5FC3;&#x8BBF;&#x95EE;&#x4E86;&#x4E00;&#x4E2A;&#x6076;&#x610F;&#x7F51;&#x7AD9;&#xFF0C;&#x7F51;&#x9875;&#x91CC;&#x9762;&#x5077;&#x5077;&#x653E;&#x5165;&#x4E86;&#x4E00;&#x6BB5;JavaScript&#x811A;&#x672C; <code>&lt;script src=&quot;cbcc.com/index.html&quot;&gt;</code>&#xFF0C;&#x8FD9;&#x6BB5;&#x811A;&#x672C;&#x6307;&#x5411;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x67D0;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#x9996;&#x9875;&#x3002;&#x867D;&#x7136;&#x811A;&#x672C;&#x4F1A;&#x6267;&#x884C;&#x5931;&#x8D25;&#xFF0C;&#x4F46;&#x662F;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5374;&#x6709;&#x53EF;&#x80FD;&#x6CC4;&#x9732;&#x4F60;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x767B;&#x5F55;&#x8FC7;&#x8BE5;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#x5E76;&#x4E14;&#x5904;&#x4E8E;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4E48;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x53EF;&#x80FD;&#x4E3A;<code>&apos;&#x6B22;&#x8FCE;&#x4F60; ....&apos; is undefined</code>&#xFF1B;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x767B;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x53EF;&#x80FD;&#x662F;<code>&apos;&#x8BF7;&#x767B;&#x5F55;...&apos; is undefined</code>&#x3002; &#x7136;&#x540E;&#x9ED1;&#x5BA2;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x786E;&#x5B9A;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#xFF0C;&#x5E76;&#x4E14;&#x4F2A;&#x9020;&#x4E00;&#x4E2A;&#x9493;&#x9C7C;&#x7F51;&#x7AD9;&#x6765;&#x9A97;&#x53D6;&#x94B1;&#x8D22;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x6E90;&#x7801;\"><a href=\"#&#x6E90;&#x7801;\" class=\"headerlink\" title=\"&#x6E90;&#x7801;\"></a>&#x6E90;&#x7801;</h3><p><a href=\"http://trac.webkit.org/browser/branches/chromium/648/Source/WebCore/dom/ScriptExecutionContext.cpp\" target=\"_blank\" rel=\"external\">webkit&#x6E90;&#x7801;</a>&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">bool</span> ScriptExecutionContext::dispatchErrorEvent(<span class=\"keyword\">const</span> String&amp; errorMessage, </div><div class=\"line\">    <span class=\"keyword\">int</span> lineNumber, </div><div class=\"line\">    <span class=\"keyword\">const</span> String&amp; sourceURL)</div><div class=\"line\">{</div><div class=\"line\">    EventTarget* target = errorEventTarget();</div><div class=\"line\">    <span class=\"keyword\">if</span> (!target)</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">    ...</div><div class=\"line\">    <span class=\"keyword\">if</span> (securityOrigin()-&gt;canRequest(targetUrl)) {</div><div class=\"line\">        message = errorMessage;</div><div class=\"line\">        line = lineNumber;</div><div class=\"line\">        sourceName = sourceURL;</div><div class=\"line\">    } <span class=\"keyword\">else</span> {</div><div class=\"line\">        message = <span class=\"string\">&quot;Script error.&quot;</span>;</div><div class=\"line\">        sourceName = String();</div><div class=\"line\">        line = <span class=\"number\">0</span>;</div><div class=\"line\">    }</div><div class=\"line\">    ...</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5224;&#x65AD;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x8D44;&#x6E90;url&#x662F;&#x5426;&#x540C;&#x6E90;(<code>securityOrigin()-&gt;canRequest(targetUrl)</code>)&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x540C;&#x6E90;&#xFF0C;&#x5219;&#x5C06;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x9690;&#x85CF;&#xFF0C;&#x8D4B;&#x503C;&#x4E3A;<code>Script error.</code>, &#x5E76;&#x4E14;&#x5C06;&#x884C;&#x53F7;&#x8BBE;&#x4E3A;0.</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4ECE;&#x7B2C;&#x4E09;&#x65B9;CDN&#x670D;&#x52A1;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x9519;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C06;&#x53EA;&#x80FD;&#x770B;&#x5230;<code>Script error.</code>&#x3002;</p>\n<h3 id=\"&#x9519;&#x8BEF;&#x590D;&#x73B0;\"><a href=\"#&#x9519;&#x8BEF;&#x590D;&#x73B0;\" class=\"headerlink\" title=\"&#x9519;&#x8BEF;&#x590D;&#x73B0;\"></a>&#x9519;&#x8BEF;&#x590D;&#x73B0;</h3><p>&#x6211;&#x4EEC;&#x7528;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x3002;&#x4E0B;&#x9762;&#x662F;<strong>index.html</strong>&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;onerror&#x6765;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#x3002;</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Test Script error<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">      <span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">errorMessage, scriptURI, lineNumber, columnNumber, error</span>)</span>{</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(errorMessage);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(scriptURI);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(lineNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(columnNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(error);</div><div class=\"line\">      }</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x5728;<strong>scripterror.js</strong>&#x4E2D;&#x629B;&#x51FA;&#x4E00;&#x4E2A;Error&#x5BF9;&#x8C61;&#xFF1A;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;Hello, Fundebug&apos;</span>);</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;&#x7684;<a href=\"https://www.npmjs.com/package/http-server\" target=\"_blank\" rel=\"external\"><code>http-server</code></a>&#x6302;&#x8F7D;&#x6587;&#x4EF6;&#xFF0C;&#x6253;&#x5F00;<a href=\"http://localhost:8080/index.html\" target=\"_blank\" rel=\"external\">http://localhost:8080/index.html</a>&#xFF0C;</p>\n<p>&#x5728;Chrome&#x6D4F;&#x89C8;&#x5668;&#x63A7;&#x5236;&#x53F0;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:35.8%;\" src=\"/2017/04/05/understand-script-error/script-error-ok.png\"><br></div>\n\n\n<p>&#x4E3A;&#x4E86;&#x590D;&#x73B0;<code>Scrpt error.</code>&#xFF0C; &#x5C06;<code>scripterror.js</code>&#x653E;&#x5230;&#x6211;&#x5728;<code>coding.net</code>&#x7684;&#x4E2A;&#x4EBA;&#x9879;&#x76EE;&#x4E0B;&#x9762;:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Test Script error<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">      <span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">errorMessage, scriptURI, lineNumber, columnNumber, error</span>)</span>{</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(errorMessage);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(scriptURI);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(lineNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(columnNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(error);</div><div class=\"line\">      }</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;<code>http-server</code>, &#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:35.8%;\" src=\"/2017/04/05/understand-script-error/script-error-not-ok-chrome.png\"><br></div>\n\n<p>&#x56E0;&#x4E3A;&#x8FDD;&#x80CC;&#x540C;&#x6E90;&#x7B56;&#x7565;&#xFF0C;&#x8FD9;&#x65F6;&#x53EA;&#x80FD;&#x62FF;&#x5230;<code>Script error.</code>&#x3002;</p>\n<h3 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h3><p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;<code>Script error.</code>&#x7684;&#x7531;&#x6765;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#x6765;&#x6F14;&#x793A;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x51FA;&#x73B0;<code>Script error.</code>&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5BF9;<strong>Script error</strong>&#x8FDB;&#x884C;<a href=\"http://blog.fundebug.com/2017/04/06/test-script-error/\" target=\"_blank\" rel=\"external\">&#x6DF1;&#x5EA6;&#x6D4B;&#x8BD5;</a>&#x5E76;&#x63D0;&#x51FA;<a href=\"http://blog.fundebug.com/2017/04/07/solve-script-error/\" target=\"_blank\" rel=\"external\">&#x89E3;&#x51B3;&#x65B9;&#x6CD5;</a></p>\n","excerpt":"<p>&#x4E00;&#x4E9B;&#x7528;&#x6237;&#x5411;&#x6211;&#x4EEC;&#x53CD;&#x9988;&#xFF0C;<a href=\"https://fundebug.com/\">Fundebug</a>&#x7684;<a href=\"https://docs.fundebug.com/notifier/javascript/\">JavaScript</a>&#x76D1;&#x63A7;&#x63D2;&#x4EF6;&#x6293;&#x5230;&#x4E86;&#x5F88;&#x591A;<strong>Script error.</strong>&#xFF0C;&#x7136;&#x540E;&#x884C;&#x53F7;&#x548C;&#x5217;&#x53F7;&#x90FD;&#x662F;0&#x2026;&#x8FD9;&#x5C31;&#x5F88;&#x5C34;&#x5C2C;&#x4E86;&#x3002;</p>","more":"<div style=\"text-align: left;\"><br><img style=\"width:80%;\" src=\"/2017/04/05/understand-script-error/script-error.png\"><br></div>\n\n<p>&#x4ECA;&#x5929;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x8BE6;&#x7EC6;&#x5730;&#x89E3;&#x6790;&#x4E00;&#x4E0B;<code>Script error.</code>&#xFF0C;&#x540E;&#x7EED;&#x6211;&#x4EEC;&#x8FD8;&#x4F1A;&#x6DF1;&#x5EA6;&#x6D4B;&#x8BD5;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"&#x540C;&#x6E90;&#x7B56;&#x7565;-Same-origin-policy\"><a href=\"#&#x540C;&#x6E90;&#x7B56;&#x7565;-Same-origin-policy\" class=\"headerlink\" title=\"&#x540C;&#x6E90;&#x7B56;&#x7565; (Same origin policy)\"></a>&#x540C;&#x6E90;&#x7B56;&#x7565; (Same origin policy)</h3><p>&#x89E3;&#x91CA;<code>Script error.</code>&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x7B80;&#x5355;&#x804A;&#x804A;&#x540C;&#x6E90;&#x7B56;&#x7565;&#x3002;&#x6458;&#x81EA;<a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">MDN - Same-origin policy</a>:</p>\n<blockquote>\n<p>Two pages have the same origin if the protocol, port (if one is specified), and host are the same for both pages. </p>\n</blockquote>\n<p>&#x6240;&#x8C13;&#x540C;&#x6E90;&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x4E24;&#x4E2A;&#x9875;&#x9762;&#x5177;&#x6709;&#x76F8;&#x540C;&#x7684;&#x534F;&#x8BAE;&#x3001;&#x7AEF;&#x53E3;&#x548C;&#x4E3B;&#x673A;(&#x57DF;&#x540D;)&#x3002;&#x901A;&#x8FC7;&#x7B2C;&#x4E09;&#x65B9;&#x52A0;&#x8F7D;&#x7684;JavaScript&#x811A;&#x672C;&#x662F;&#x4E0D;&#x540C;&#x6E90;&#x7684;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x8868;&#x683C;&#x7B80;&#x5355;&#x5217;&#x51FA;&#x4E86;&#x548C;<code>https://fundebug.com/app.js</code>&#x662F;&#x5426;&#x540C;&#x6E90;&#x7684;&#x6587;&#x4EF6;:</p>\n<style type=\"text/css\">\n    code {\n        text-overflow:clip;/*文本裁切*/\n            white-space:nowrap;/*强制不换行*/\n            overflow:hidden;/*溢出隐藏*/\n    }\n</style>\n\n<table>\n<thead>\n<tr>\n<th>&#x7F51;&#x5740;</th>\n<th style=\"text-align:right\">&#x662F;&#x5426;&#x540C;&#x6E90;</th>\n<th style=\"text-align:center\">&#x539F;&#x56E0;</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>https://fundebug.com/vendor.js</code></td>\n<td style=\"text-align:right\">&#x662F;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td><code>http://fundebug.com/vendor.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x534F;&#x8BAE;&#x4E0D;&#x540C;</td>\n</tr>\n<tr>\n<td><code>https://fundebug.com:8001/app.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x7AEF;&#x53E3;&#x4E0D;&#x540C;</td>\n</tr>\n<tr>\n<td><code>https://docs.fundebug.com/nav.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x5B50;&#x57DF;&#x540D;&#x4E0D;&#x540C;</td>\n</tr>\n<tr>\n<td><code>https://kiwenlau.com/totop.js</code></td>\n<td style=\"text-align:right\">&#x5426;</td>\n<td style=\"text-align:center\">&#x57DF;&#x540D;&#x4E0D;&#x540C;</td>\n</tr>\n</tbody>\n</table>\n<p>&#x6CA1;&#x6709;&#x540C;&#x6E90;&#x7B56;&#x7565;&#x7684;&#x8BDD;&#xFF0C;&#x5C06;&#x4F1A;&#x600E;&#x6837;&#xFF1F;&#x6458;&#x81EA;<a href=\"http://www.freebuf.com/articles/web/65468.html\">&#x540C;&#x6E90;&#x7B56;&#x7565;&#x8BE6;&#x89E3;&#x53CA;&#x7ED5;&#x8FC7; - FreeBuf</a>&#xFF1A;</p>\n<blockquote>\n<p>&#x5047;&#x8BBE;&#x4F60;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x767B;&#x5F55;Gmail&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x6076;&#x610F;&#x7AD9;&#x70B9;&#xFF08;&#x53E6;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x9009;&#x9879;&#x5361;&#xFF09;&#x3002;&#x6CA1;&#x6709;&#x540C;&#x6E90;&#x7B56;&#x7565;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;JavaScript&#x83B7;&#x53D6;&#x4F60;&#x7684;&#x90AE;&#x4EF6;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x654F;&#x611F;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#x9605;&#x8BFB;&#x4F60;&#x7684;&#x79C1;&#x5BC6;&#x90AE;&#x4EF6;&#xFF0C;&#x53D1;&#x9001;&#x865A;&#x5047;&#x90AE;&#x4EF6;&#xFF0C;&#x770B;&#x4F60;&#x7684;&#x804A;&#x5929;&#x8BB0;&#x5F55;&#x7B49;&#x7B49;&#x3002; &#x5982;&#x679C;&#x5C06;Gmail&#x66FF;&#x6362;&#x4E3A;&#x4F60;&#x7684;&#x94F6;&#x884C;&#x5E10;&#x6237;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x5927;&#x6761;&#x4E86;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script-error\"><a href=\"#&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script-error\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script error. ?\"></a>&#x4E3A;&#x5565;&#x51FA;&#x73B0;Script error. ?</h3><p>&#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x7F51;&#x7AD9;&#x7684;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x90FD;&#x4F1A;&#x5C06;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x6587;&#x4EF6;(css, image, javascript)&#x653E;&#x5728;&#x7B2C;&#x4E09;&#x65B9;CDN&#x3002;&#x5F53;&#x8FD9;&#x4E9B;&#x4ECE;&#x7B2C;&#x4E09;&#x65B9;&#x52A0;&#x8F7D;&#x7684;JavaScript&#x811A;&#x672C;&#x6267;&#x884C;&#x51FA;&#x9519;&#xFF0C;&#x56E0;&#x4E3A;&#x8FDD;&#x80CC;&#x4E86;<strong>&#x540C;&#x6E90;&#x7B56;&#x7565;</strong>, &#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x4E0D;&#x88AB;&#x6CC4;&#x9732;&#xFF0C;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4E0D;&#x4F1A;&#x663E;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x53EA;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>Script error.</code>&#x3002;</p>\n<p>&#x66B4;&#x9732;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4F1A;&#x600E;&#x6837;&#x5462;&#xFF1F;&#x6458;&#x81EA;(<a href=\"http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox\">Cryptic &#x201C;Script Error.&#x201D; reported in Javascript in Chrome and Firefox</a>)&#xFF1A;</p>\n<blockquote>\n<p>&#x5047;&#x60F3;&#x4F60;&#x4E0D;&#x5C0F;&#x5FC3;&#x8BBF;&#x95EE;&#x4E86;&#x4E00;&#x4E2A;&#x6076;&#x610F;&#x7F51;&#x7AD9;&#xFF0C;&#x7F51;&#x9875;&#x91CC;&#x9762;&#x5077;&#x5077;&#x653E;&#x5165;&#x4E86;&#x4E00;&#x6BB5;JavaScript&#x811A;&#x672C; <code>&lt;script src=&quot;cbcc.com/index.html&quot;&gt;</code>&#xFF0C;&#x8FD9;&#x6BB5;&#x811A;&#x672C;&#x6307;&#x5411;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x67D0;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#x9996;&#x9875;&#x3002;&#x867D;&#x7136;&#x811A;&#x672C;&#x4F1A;&#x6267;&#x884C;&#x5931;&#x8D25;&#xFF0C;&#x4F46;&#x662F;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5374;&#x6709;&#x53EF;&#x80FD;&#x6CC4;&#x9732;&#x4F60;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x767B;&#x5F55;&#x8FC7;&#x8BE5;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#x5E76;&#x4E14;&#x5904;&#x4E8E;&#x767B;&#x5F55;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4E48;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x53EF;&#x80FD;&#x4E3A;<code>&apos;&#x6B22;&#x8FCE;&#x4F60; ....&apos; is undefined</code>&#xFF1B;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x767B;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x53EF;&#x80FD;&#x662F;<code>&apos;&#x8BF7;&#x767B;&#x5F55;...&apos; is undefined</code>&#x3002; &#x7136;&#x540E;&#x9ED1;&#x5BA2;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x786E;&#x5B9A;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#xFF0C;&#x5E76;&#x4E14;&#x4F2A;&#x9020;&#x4E00;&#x4E2A;&#x9493;&#x9C7C;&#x7F51;&#x7AD9;&#x6765;&#x9A97;&#x53D6;&#x94B1;&#x8D22;&#x3002;</p>\n</blockquote>\n<h3 id=\"&#x6E90;&#x7801;\"><a href=\"#&#x6E90;&#x7801;\" class=\"headerlink\" title=\"&#x6E90;&#x7801;\"></a>&#x6E90;&#x7801;</h3><p><a href=\"http://trac.webkit.org/browser/branches/chromium/648/Source/WebCore/dom/ScriptExecutionContext.cpp\">webkit&#x6E90;&#x7801;</a>&#x5982;&#x4E0B;&#xFF1A;</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">bool</span> ScriptExecutionContext::dispatchErrorEvent(<span class=\"keyword\">const</span> String&amp; errorMessage, </div><div class=\"line\">    <span class=\"keyword\">int</span> lineNumber, </div><div class=\"line\">    <span class=\"keyword\">const</span> String&amp; sourceURL)</div><div class=\"line\">{</div><div class=\"line\">    EventTarget* target = errorEventTarget();</div><div class=\"line\">    <span class=\"keyword\">if</span> (!target)</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">    ...</div><div class=\"line\">    <span class=\"keyword\">if</span> (securityOrigin()-&gt;canRequest(targetUrl)) {</div><div class=\"line\">        message = errorMessage;</div><div class=\"line\">        line = lineNumber;</div><div class=\"line\">        sourceName = sourceURL;</div><div class=\"line\">    } <span class=\"keyword\">else</span> {</div><div class=\"line\">        message = <span class=\"string\">&quot;Script error.&quot;</span>;</div><div class=\"line\">        sourceName = String();</div><div class=\"line\">        line = <span class=\"number\">0</span>;</div><div class=\"line\">    }</div><div class=\"line\">    ...</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x5224;&#x65AD;&#x6240;&#x52A0;&#x8F7D;&#x7684;&#x8D44;&#x6E90;url&#x662F;&#x5426;&#x540C;&#x6E90;(<code>securityOrigin()-&gt;canRequest(targetUrl)</code>)&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x540C;&#x6E90;&#xFF0C;&#x5219;&#x5C06;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x9690;&#x85CF;&#xFF0C;&#x8D4B;&#x503C;&#x4E3A;<code>Script error.</code>, &#x5E76;&#x4E14;&#x5C06;&#x884C;&#x53F7;&#x8BBE;&#x4E3A;0.</p>\n<p>&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4ECE;&#x7B2C;&#x4E09;&#x65B9;CDN&#x670D;&#x52A1;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x9519;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C06;&#x53EA;&#x80FD;&#x770B;&#x5230;<code>Script error.</code>&#x3002;</p>\n<h3 id=\"&#x9519;&#x8BEF;&#x590D;&#x73B0;\"><a href=\"#&#x9519;&#x8BEF;&#x590D;&#x73B0;\" class=\"headerlink\" title=\"&#x9519;&#x8BEF;&#x590D;&#x73B0;\"></a>&#x9519;&#x8BEF;&#x590D;&#x73B0;</h3><p>&#x6211;&#x4EEC;&#x7528;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x3002;&#x4E0B;&#x9762;&#x662F;<strong>index.html</strong>&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;onerror&#x6765;&#x6355;&#x83B7;&#x9519;&#x8BEF;&#x3002;</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Test Script error<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">      <span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">errorMessage, scriptURI, lineNumber, columnNumber, error</span>)</span>{</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(errorMessage);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(scriptURI);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(lineNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(columnNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(error);</div><div class=\"line\">      }</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x5728;<strong>scripterror.js</strong>&#x4E2D;&#x629B;&#x51FA;&#x4E00;&#x4E2A;Error&#x5BF9;&#x8C61;&#xFF1A;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;Hello, Fundebug&apos;</span>);</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;&#x7684;<a href=\"https://www.npmjs.com/package/http-server\"><code>http-server</code></a>&#x6302;&#x8F7D;&#x6587;&#x4EF6;&#xFF0C;&#x6253;&#x5F00;<a href=\"http://localhost:8080/index.html\">http://localhost:8080/index.html</a>&#xFF0C;</p>\n<p>&#x5728;Chrome&#x6D4F;&#x89C8;&#x5668;&#x63A7;&#x5236;&#x53F0;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:35.8%;\" src=\"/2017/04/05/understand-script-error/script-error-ok.png\"><br></div>\n\n\n<p>&#x4E3A;&#x4E86;&#x590D;&#x73B0;<code>Scrpt error.</code>&#xFF0C; &#x5C06;<code>scripterror.js</code>&#x653E;&#x5230;&#x6211;&#x5728;<code>coding.net</code>&#x7684;&#x4E2A;&#x4EBA;&#x9879;&#x76EE;&#x4E0B;&#x9762;:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Test Script error<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">      <span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">errorMessage, scriptURI, lineNumber, columnNumber, error</span>)</span>{</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(errorMessage);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(scriptURI);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(lineNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(columnNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(error);</div><div class=\"line\">      }</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;<code>http-server</code>, &#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:35.8%;\" src=\"/2017/04/05/understand-script-error/script-error-not-ok-chrome.png\"><br></div>\n\n<p>&#x56E0;&#x4E3A;&#x8FDD;&#x80CC;&#x540C;&#x6E90;&#x7B56;&#x7565;&#xFF0C;&#x8FD9;&#x65F6;&#x53EA;&#x80FD;&#x62FF;&#x5230;<code>Script error.</code>&#x3002;</p>\n<h3 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h3><p>&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;<code>Script error.</code>&#x7684;&#x7531;&#x6765;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#x6765;&#x6F14;&#x793A;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x51FA;&#x73B0;<code>Script error.</code>&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5BF9;<strong>Script error</strong>&#x8FDB;&#x884C;<a href=\"http://blog.fundebug.com/2017/04/06/test-script-error/\">&#x6DF1;&#x5EA6;&#x6D4B;&#x8BD5;</a>&#x5E76;&#x63D0;&#x51FA;<a href=\"http://blog.fundebug.com/2017/04/07/solve-script-error/\">&#x89E3;&#x51B3;&#x65B9;&#x6CD5;</a></p>"},{"title":"Script error.深度测试","date":"2017-04-06T02:00:00.000Z","_content":"\n[Script error.全面解析](https://blog.fundebug.com/2017/04/05/understand-script-error/)中我们介绍了`Script error.`的由来。这篇博客，我们将各种情况（不同浏览器、本地远程托管JS文件）考虑进去，进行一个深度的测试，为读者带来一个全面的了解。\n\n<!-- more -->\n\n**GitHub仓库:** [Fundebug/script-error](https://github.com/Fundebug/script-error)\n\n<div style=\"text-align: left;\">\n<img style=\"width:80%;\" src=\"test-script-error/script-error.png\" />\n</div>\n\n### 基本准备\n\n**index.html**中使用onerror监控错误。\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Test Script error</title>\n    <script type=\"text/javascript\">\n      window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, error){\n        console.log(errorMessage);\n        console.log(scriptURI);\n        console.log(lineNumber);\n        console.log(columnNumber);\n        console.log(error);\n      }\n    </script>\n    <script type=\"text/javascript\" src=\"./scripterror.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n\n**scripterror.js**中抛出一个Error对象：\n\n```js\nthrow new Error('Hello, Fundebug');\n```\n\n该Error对象会被`window.onerror`捕获。\n\n\n### 本地直接打开\n\n如果我们直接在本地打开`index.html`, 可以看到Safari, Firefox, IE浏览器都能正确打印出错误信息。\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/1.png\" />\n</div>\n\n唯独Chrome只显示`Script error.`\n\n<div style=\"text-align: left;\">\n<img style=\"width:30%;\" src=\"test-script-error/1chrome.png\" />\n</div>\n\n这是因为[Chrome浏览器默认不允许访问本地文件](http://stackoverflow.com/questions/20748630/load-local-javascript-file-in-chrome-for-testing)：\n\n> To load local resources in Chrome when just using your local computer and not using a webserver you need to add the --allow-file-access-from-files flag.\n\n如果一定要使用，需要开启访问本地文件的候选项，可以参考[chrome 等浏览器不支持本地ajax请求的问题](http://blog.csdn.net/u010874036/article/details/51728622)。\n\n### 使用服务器挂载静态资源\n\n我们将使用[`http-server`](https://www.npmjs.com/package/http-server)。\n\n安装http-server:\n\n```shell\nnpm install http-server -g\n```\n\n运行http-server:\n\n```\nhttp-server\nStarting up http-server, serving ./\nAvailable on:\n  http://127.0.0.1:8080\n  http://172.20.1.86:8080\n  http://192.168.59.100:8080\nHit CTRL-C to stop the server\n```\n\n访问[http://localhost:8080/index.html](http://localhost:8080/index.html)\n\n<div style=\"text-align: left;\">\n<img style=\"width:38.2%;\" src=\"test-script-error/chrome_error.png\" />\n</div>\n\n\n### 情况三：将`scripterror.js`托管\n\n为了测试`Script error.`, 我将`scripterror.js`分别托管在了[Coding](https://coding.net)和[七牛](https://www.qiniu.com/)。\n\n#### Coding\n\n**index.html**\n\n```html\n<script type=\"text/javascript\" src=\"http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js\"></script>\n```\n\nChrome, Safari和IE浏览器都将错误信息隐藏，返回`Script error.`。\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/2.png\" />\n</div>\n\n不过Firefox比较特别，依然将错误信息完整的打印出来，大概是为了方便开发者排错。\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/2firefox.png\" />\n</div>\n\n\n#### 七牛云\n\n**index.html**\n\n```html\n<script type=\"text/javascript\" src=\"https://og6593g2z.qnssl.com/scripterror.js\"></script>\n```\n\n结果和托管在Coding上是一样的。\n\n将引入脚本修改一下，加入`crossorigin=\"anaonymous\"`:\n\n```html\n<script type=\"text/javascript\" src=\"https://og6593g2z.qnssl.com/scripterror.js\" crossorigin=\"anonymous\"></script>\n```\n\n再次执行运行，在不同浏览器的表现如下：\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/4.png\" />\n</div>\n\nChrome, Safari可以获取详细的出错信息了，但是IE浏览器依然是Script error. 。这一点比较奇怪, 根据[MDN - CORS settings attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes)，IE11应该是没有问题的。\n\n在这里我将Coding和七牛对于`scripterror.js`的**Response Headers**对一下:\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/5.png\" />\n</div>\n\n七牛的`Access-Control-Allow-Origin`允许来自所有域名的请求，而Coding没有。七牛是一个资源托管分发平台，因此特意配置了不同的返回头，方便开发者将脚本放在七牛云同时又可以拿到出错信息。\n\n下一篇博客中，我们将提出**Script error**的[解决方法](http://blog.fundebug.com/2017/04/07/solve-script-error/)。\n","source":"_posts/2017/04/06/test-script-error.md","raw":"---\ntitle: Script error.深度测试\n\ndate: 2017-04-06 10:00:00\n\ntags: [JavaScript, BUG]\n---\n\n[Script error.全面解析](https://blog.fundebug.com/2017/04/05/understand-script-error/)中我们介绍了`Script error.`的由来。这篇博客，我们将各种情况（不同浏览器、本地远程托管JS文件）考虑进去，进行一个深度的测试，为读者带来一个全面的了解。\n\n<!-- more -->\n\n**GitHub仓库:** [Fundebug/script-error](https://github.com/Fundebug/script-error)\n\n<div style=\"text-align: left;\">\n<img style=\"width:80%;\" src=\"test-script-error/script-error.png\" />\n</div>\n\n### 基本准备\n\n**index.html**中使用onerror监控错误。\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Test Script error</title>\n    <script type=\"text/javascript\">\n      window.onerror = function(errorMessage, scriptURI, lineNumber, columnNumber, error){\n        console.log(errorMessage);\n        console.log(scriptURI);\n        console.log(lineNumber);\n        console.log(columnNumber);\n        console.log(error);\n      }\n    </script>\n    <script type=\"text/javascript\" src=\"./scripterror.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n\n**scripterror.js**中抛出一个Error对象：\n\n```js\nthrow new Error('Hello, Fundebug');\n```\n\n该Error对象会被`window.onerror`捕获。\n\n\n### 本地直接打开\n\n如果我们直接在本地打开`index.html`, 可以看到Safari, Firefox, IE浏览器都能正确打印出错误信息。\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/1.png\" />\n</div>\n\n唯独Chrome只显示`Script error.`\n\n<div style=\"text-align: left;\">\n<img style=\"width:30%;\" src=\"test-script-error/1chrome.png\" />\n</div>\n\n这是因为[Chrome浏览器默认不允许访问本地文件](http://stackoverflow.com/questions/20748630/load-local-javascript-file-in-chrome-for-testing)：\n\n> To load local resources in Chrome when just using your local computer and not using a webserver you need to add the --allow-file-access-from-files flag.\n\n如果一定要使用，需要开启访问本地文件的候选项，可以参考[chrome 等浏览器不支持本地ajax请求的问题](http://blog.csdn.net/u010874036/article/details/51728622)。\n\n### 使用服务器挂载静态资源\n\n我们将使用[`http-server`](https://www.npmjs.com/package/http-server)。\n\n安装http-server:\n\n```shell\nnpm install http-server -g\n```\n\n运行http-server:\n\n```\nhttp-server\nStarting up http-server, serving ./\nAvailable on:\n  http://127.0.0.1:8080\n  http://172.20.1.86:8080\n  http://192.168.59.100:8080\nHit CTRL-C to stop the server\n```\n\n访问[http://localhost:8080/index.html](http://localhost:8080/index.html)\n\n<div style=\"text-align: left;\">\n<img style=\"width:38.2%;\" src=\"test-script-error/chrome_error.png\" />\n</div>\n\n\n### 情况三：将`scripterror.js`托管\n\n为了测试`Script error.`, 我将`scripterror.js`分别托管在了[Coding](https://coding.net)和[七牛](https://www.qiniu.com/)。\n\n#### Coding\n\n**index.html**\n\n```html\n<script type=\"text/javascript\" src=\"http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js\"></script>\n```\n\nChrome, Safari和IE浏览器都将错误信息隐藏，返回`Script error.`。\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/2.png\" />\n</div>\n\n不过Firefox比较特别，依然将错误信息完整的打印出来，大概是为了方便开发者排错。\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/2firefox.png\" />\n</div>\n\n\n#### 七牛云\n\n**index.html**\n\n```html\n<script type=\"text/javascript\" src=\"https://og6593g2z.qnssl.com/scripterror.js\"></script>\n```\n\n结果和托管在Coding上是一样的。\n\n将引入脚本修改一下，加入`crossorigin=\"anaonymous\"`:\n\n```html\n<script type=\"text/javascript\" src=\"https://og6593g2z.qnssl.com/scripterror.js\" crossorigin=\"anonymous\"></script>\n```\n\n再次执行运行，在不同浏览器的表现如下：\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/4.png\" />\n</div>\n\nChrome, Safari可以获取详细的出错信息了，但是IE浏览器依然是Script error. 。这一点比较奇怪, 根据[MDN - CORS settings attributes](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes)，IE11应该是没有问题的。\n\n在这里我将Coding和七牛对于`scripterror.js`的**Response Headers**对一下:\n\n<div style=\"text-align: left;\">\n<img style=\"width:90%;\" src=\"test-script-error/5.png\" />\n</div>\n\n七牛的`Access-Control-Allow-Origin`允许来自所有域名的请求，而Coding没有。七牛是一个资源托管分发平台，因此特意配置了不同的返回头，方便开发者将脚本放在七牛云同时又可以拿到出错信息。\n\n下一篇博客中，我们将提出**Script error**的[解决方法](http://blog.fundebug.com/2017/04/07/solve-script-error/)。\n","slug":"2017/04/06/test-script-error","published":1,"updated":"2017-04-07T11:55:13.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweoa002zmkfyilej1u2s","content":"<p><a href=\"https://blog.fundebug.com/2017/04/05/understand-script-error/\" target=\"_blank\" rel=\"external\">Script error.&#x5168;&#x9762;&#x89E3;&#x6790;</a>&#x4E2D;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;<code>Script error.</code>&#x7684;&#x7531;&#x6765;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#xFF08;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x3001;&#x672C;&#x5730;&#x8FDC;&#x7A0B;&#x6258;&#x7BA1;JS&#x6587;&#x4EF6;&#xFF09;&#x8003;&#x8651;&#x8FDB;&#x53BB;&#xFF0C;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x6DF1;&#x5EA6;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E3A;&#x8BFB;&#x8005;&#x5E26;&#x6765;&#x4E00;&#x4E2A;&#x5168;&#x9762;&#x7684;&#x4E86;&#x89E3;&#x3002;</p>\n<a id=\"more\"></a>\n<p><strong>GitHub&#x4ED3;&#x5E93;:</strong> <a href=\"https://github.com/Fundebug/script-error\" target=\"_blank\" rel=\"external\">Fundebug/script-error</a></p>\n<div style=\"text-align: left;\"><br><img style=\"width:80%;\" src=\"/2017/04/06/test-script-error/script-error.png\"><br></div>\n\n<h3 id=\"&#x57FA;&#x672C;&#x51C6;&#x5907;\"><a href=\"#&#x57FA;&#x672C;&#x51C6;&#x5907;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x51C6;&#x5907;\"></a>&#x57FA;&#x672C;&#x51C6;&#x5907;</h3><p><strong>index.html</strong>&#x4E2D;&#x4F7F;&#x7528;onerror&#x76D1;&#x63A7;&#x9519;&#x8BEF;&#x3002;</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Test Script error<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">      <span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">errorMessage, scriptURI, lineNumber, columnNumber, error</span>)</span>{</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(errorMessage);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(scriptURI);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(lineNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(columnNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(error);</div><div class=\"line\">      }</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p><strong>scripterror.js</strong>&#x4E2D;&#x629B;&#x51FA;&#x4E00;&#x4E2A;Error&#x5BF9;&#x8C61;&#xFF1A;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;Hello, Fundebug&apos;</span>);</div></pre></td></tr></table></figure>\n<p>&#x8BE5;Error&#x5BF9;&#x8C61;&#x4F1A;&#x88AB;<code>window.onerror</code>&#x6355;&#x83B7;&#x3002;</p>\n<h3 id=\"&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;\"><a href=\"#&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;\"></a>&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;</h3><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5728;&#x672C;&#x5730;&#x6253;&#x5F00;<code>index.html</code>, &#x53EF;&#x4EE5;&#x770B;&#x5230;Safari, Firefox, IE&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x80FD;&#x6B63;&#x786E;&#x6253;&#x5370;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/1.png\"><br></div>\n\n<p>&#x552F;&#x72EC;Chrome&#x53EA;&#x663E;&#x793A;<code>Script error.</code></p>\n<div style=\"text-align: left;\"><br><img style=\"width:30%;\" src=\"/2017/04/06/test-script-error/1chrome.png\"><br></div>\n\n<p>&#x8FD9;&#x662F;&#x56E0;&#x4E3A;<a href=\"http://stackoverflow.com/questions/20748630/load-local-javascript-file-in-chrome-for-testing\" target=\"_blank\" rel=\"external\">Chrome&#x6D4F;&#x89C8;&#x5668;&#x9ED8;&#x8BA4;&#x4E0D;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x6587;&#x4EF6;</a>&#xFF1A;</p>\n<blockquote>\n<p>To load local resources in Chrome when just using your local computer and not using a webserver you need to add the &#x2013;allow-file-access-from-files flag.</p>\n</blockquote>\n<p>&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x8981;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x542F;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x7684;&#x5019;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href=\"http://blog.csdn.net/u010874036/article/details/51728622\" target=\"_blank\" rel=\"external\">chrome &#x7B49;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x672C;&#x5730;ajax&#x8BF7;&#x6C42;&#x7684;&#x95EE;&#x9898;</a>&#x3002;</p>\n<h3 id=\"&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;\"><a href=\"#&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;\"></a>&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;</h3><p>&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;<a href=\"https://www.npmjs.com/package/http-server\" target=\"_blank\" rel=\"external\"><code>http-server</code></a>&#x3002;</p>\n<p>&#x5B89;&#x88C5;http-server:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">npm install http-server -g</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;http-server:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">http</span>-server</div><div class=\"line\">Starting up <span class=\"keyword\">http</span>-server, serving ./</div><div class=\"line\">Available <span class=\"keyword\">on</span>:</div><div class=\"line\">  <span class=\"keyword\">http</span>://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8080</span></div><div class=\"line\">  <span class=\"keyword\">http</span>://<span class=\"number\">172.20</span><span class=\"number\">.1</span><span class=\"number\">.86</span>:<span class=\"number\">8080</span></div><div class=\"line\">  <span class=\"keyword\">http</span>://<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.100</span>:<span class=\"number\">8080</span></div><div class=\"line\">Hit CTRL-C <span class=\"built_in\">to</span> <span class=\"built_in\">stop</span> <span class=\"keyword\">the</span> server</div></pre></td></tr></table></figure>\n<p>&#x8BBF;&#x95EE;<a href=\"http://localhost:8080/index.html\" target=\"_blank\" rel=\"external\">http://localhost:8080/index.html</a></p>\n<div style=\"text-align: left;\"><br><img style=\"width:38.2%;\" src=\"/2017/04/06/test-script-error/chrome_error.png\"><br></div>\n\n\n<h3 id=\"&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;scripterror-js&#x6258;&#x7BA1;\"><a href=\"#&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;scripterror-js&#x6258;&#x7BA1;\" class=\"headerlink\" title=\"&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;scripterror.js&#x6258;&#x7BA1;\"></a>&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;<code>scripterror.js</code>&#x6258;&#x7BA1;</h3><p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;<code>Script error.</code>, &#x6211;&#x5C06;<code>scripterror.js</code>&#x5206;&#x522B;&#x6258;&#x7BA1;&#x5728;&#x4E86;<a href=\"https://coding.net\" target=\"_blank\" rel=\"external\">Coding</a>&#x548C;<a href=\"https://www.qiniu.com/\" target=\"_blank\" rel=\"external\">&#x4E03;&#x725B;</a>&#x3002;</p>\n<h4 id=\"Coding\"><a href=\"#Coding\" class=\"headerlink\" title=\"Coding\"></a>Coding</h4><p><strong>index.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Chrome, Safari&#x548C;IE&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x9690;&#x85CF;&#xFF0C;&#x8FD4;&#x56DE;<code>Script error.</code>&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/2.png\"><br></div>\n\n<p>&#x4E0D;&#x8FC7;Firefox&#x6BD4;&#x8F83;&#x7279;&#x522B;&#xFF0C;&#x4F9D;&#x7136;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5B8C;&#x6574;&#x7684;&#x6253;&#x5370;&#x51FA;&#x6765;&#xFF0C;&#x5927;&#x6982;&#x662F;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x6392;&#x9519;&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/2firefox.png\"><br></div>\n\n\n<h4 id=\"&#x4E03;&#x725B;&#x4E91;\"><a href=\"#&#x4E03;&#x725B;&#x4E91;\" class=\"headerlink\" title=\"&#x4E03;&#x725B;&#x4E91;\"></a>&#x4E03;&#x725B;&#x4E91;</h4><p><strong>index.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x7ED3;&#x679C;&#x548C;&#x6258;&#x7BA1;&#x5728;Coding&#x4E0A;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<p>&#x5C06;&#x5F15;&#x5165;&#x811A;&#x672C;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x52A0;&#x5165;<code>crossorigin=&quot;anaonymous&quot;</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/scripterror.js&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x518D;&#x6B21;&#x6267;&#x884C;&#x8FD0;&#x884C;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8868;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/4.png\"><br></div>\n\n<p>Chrome, Safari&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x4E86;&#xFF0C;&#x4F46;&#x662F;IE&#x6D4F;&#x89C8;&#x5668;&#x4F9D;&#x7136;&#x662F;Script error. &#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x5947;&#x602A;, &#x6839;&#x636E;<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes\" target=\"_blank\" rel=\"external\">MDN - CORS settings attributes</a>&#xFF0C;IE11&#x5E94;&#x8BE5;&#x662F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x7684;&#x3002;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x5C06;Coding&#x548C;&#x4E03;&#x725B;&#x5BF9;&#x4E8E;<code>scripterror.js</code>&#x7684;<strong>Response Headers</strong>&#x5BF9;&#x4E00;&#x4E0B;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/5.png\"><br></div>\n\n<p>&#x4E03;&#x725B;&#x7684;<code>Access-Control-Allow-Origin</code>&#x5141;&#x8BB8;&#x6765;&#x81EA;&#x6240;&#x6709;&#x57DF;&#x540D;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;Coding&#x6CA1;&#x6709;&#x3002;&#x4E03;&#x725B;&#x662F;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x6258;&#x7BA1;&#x5206;&#x53D1;&#x5E73;&#x53F0;&#xFF0C;&#x56E0;&#x6B64;&#x7279;&#x610F;&#x914D;&#x7F6E;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x8FD4;&#x56DE;&#x5934;&#xFF0C;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x5C06;&#x811A;&#x672C;&#x653E;&#x5728;&#x4E03;&#x725B;&#x4E91;&#x540C;&#x65F6;&#x53C8;&#x53EF;&#x4EE5;&#x62FF;&#x5230;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x3002;</p>\n<p>&#x4E0B;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x63D0;&#x51FA;<strong>Script error</strong>&#x7684;<a href=\"http://blog.fundebug.com/2017/04/07/solve-script-error/\" target=\"_blank\" rel=\"external\">&#x89E3;&#x51B3;&#x65B9;&#x6CD5;</a>&#x3002;</p>\n","excerpt":"<p><a href=\"https://blog.fundebug.com/2017/04/05/understand-script-error/\">Script error.&#x5168;&#x9762;&#x89E3;&#x6790;</a>&#x4E2D;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;<code>Script error.</code>&#x7684;&#x7531;&#x6765;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#xFF08;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x3001;&#x672C;&#x5730;&#x8FDC;&#x7A0B;&#x6258;&#x7BA1;JS&#x6587;&#x4EF6;&#xFF09;&#x8003;&#x8651;&#x8FDB;&#x53BB;&#xFF0C;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x6DF1;&#x5EA6;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E3A;&#x8BFB;&#x8005;&#x5E26;&#x6765;&#x4E00;&#x4E2A;&#x5168;&#x9762;&#x7684;&#x4E86;&#x89E3;&#x3002;</p>","more":"<p><strong>GitHub&#x4ED3;&#x5E93;:</strong> <a href=\"https://github.com/Fundebug/script-error\">Fundebug/script-error</a></p>\n<div style=\"text-align: left;\"><br><img style=\"width:80%;\" src=\"/2017/04/06/test-script-error/script-error.png\"><br></div>\n\n<h3 id=\"&#x57FA;&#x672C;&#x51C6;&#x5907;\"><a href=\"#&#x57FA;&#x672C;&#x51C6;&#x5907;\" class=\"headerlink\" title=\"&#x57FA;&#x672C;&#x51C6;&#x5907;\"></a>&#x57FA;&#x672C;&#x51C6;&#x5907;</h3><p><strong>index.html</strong>&#x4E2D;&#x4F7F;&#x7528;onerror&#x76D1;&#x63A7;&#x9519;&#x8BEF;&#x3002;</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Test Script error<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">      <span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">errorMessage, scriptURI, lineNumber, columnNumber, error</span>)</span>{</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(errorMessage);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(scriptURI);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(lineNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(columnNumber);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(error);</div><div class=\"line\">      }</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p><strong>scripterror.js</strong>&#x4E2D;&#x629B;&#x51FA;&#x4E00;&#x4E2A;Error&#x5BF9;&#x8C61;&#xFF1A;</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;Hello, Fundebug&apos;</span>);</div></pre></td></tr></table></figure>\n<p>&#x8BE5;Error&#x5BF9;&#x8C61;&#x4F1A;&#x88AB;<code>window.onerror</code>&#x6355;&#x83B7;&#x3002;</p>\n<h3 id=\"&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;\"><a href=\"#&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;\"></a>&#x672C;&#x5730;&#x76F4;&#x63A5;&#x6253;&#x5F00;</h3><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5728;&#x672C;&#x5730;&#x6253;&#x5F00;<code>index.html</code>, &#x53EF;&#x4EE5;&#x770B;&#x5230;Safari, Firefox, IE&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x80FD;&#x6B63;&#x786E;&#x6253;&#x5370;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/1.png\"><br></div>\n\n<p>&#x552F;&#x72EC;Chrome&#x53EA;&#x663E;&#x793A;<code>Script error.</code></p>\n<div style=\"text-align: left;\"><br><img style=\"width:30%;\" src=\"/2017/04/06/test-script-error/1chrome.png\"><br></div>\n\n<p>&#x8FD9;&#x662F;&#x56E0;&#x4E3A;<a href=\"http://stackoverflow.com/questions/20748630/load-local-javascript-file-in-chrome-for-testing\">Chrome&#x6D4F;&#x89C8;&#x5668;&#x9ED8;&#x8BA4;&#x4E0D;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x6587;&#x4EF6;</a>&#xFF1A;</p>\n<blockquote>\n<p>To load local resources in Chrome when just using your local computer and not using a webserver you need to add the &#x2013;allow-file-access-from-files flag.</p>\n</blockquote>\n<p>&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x8981;&#x4F7F;&#x7528;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x542F;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x7684;&#x5019;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href=\"http://blog.csdn.net/u010874036/article/details/51728622\">chrome &#x7B49;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x672C;&#x5730;ajax&#x8BF7;&#x6C42;&#x7684;&#x95EE;&#x9898;</a>&#x3002;</p>\n<h3 id=\"&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;\"><a href=\"#&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;\"></a>&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6302;&#x8F7D;&#x9759;&#x6001;&#x8D44;&#x6E90;</h3><p>&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;<a href=\"https://www.npmjs.com/package/http-server\"><code>http-server</code></a>&#x3002;</p>\n<p>&#x5B89;&#x88C5;http-server:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">npm install http-server -g</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;http-server:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">http</span>-server</div><div class=\"line\">Starting up <span class=\"keyword\">http</span>-server, serving ./</div><div class=\"line\">Available <span class=\"keyword\">on</span>:</div><div class=\"line\">  <span class=\"keyword\">http</span>://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8080</span></div><div class=\"line\">  <span class=\"keyword\">http</span>://<span class=\"number\">172.20</span><span class=\"number\">.1</span><span class=\"number\">.86</span>:<span class=\"number\">8080</span></div><div class=\"line\">  <span class=\"keyword\">http</span>://<span class=\"number\">192.168</span><span class=\"number\">.59</span><span class=\"number\">.100</span>:<span class=\"number\">8080</span></div><div class=\"line\">Hit CTRL-C <span class=\"built_in\">to</span> <span class=\"built_in\">stop</span> <span class=\"keyword\">the</span> server</div></pre></td></tr></table></figure>\n<p>&#x8BBF;&#x95EE;<a href=\"http://localhost:8080/index.html\">http://localhost:8080/index.html</a></p>\n<div style=\"text-align: left;\"><br><img style=\"width:38.2%;\" src=\"/2017/04/06/test-script-error/chrome_error.png\"><br></div>\n\n\n<h3 id=\"&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;scripterror-js&#x6258;&#x7BA1;\"><a href=\"#&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;scripterror-js&#x6258;&#x7BA1;\" class=\"headerlink\" title=\"&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;scripterror.js&#x6258;&#x7BA1;\"></a>&#x60C5;&#x51B5;&#x4E09;&#xFF1A;&#x5C06;<code>scripterror.js</code>&#x6258;&#x7BA1;</h3><p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;<code>Script error.</code>, &#x6211;&#x5C06;<code>scripterror.js</code>&#x5206;&#x522B;&#x6258;&#x7BA1;&#x5728;&#x4E86;<a href=\"https://coding.net\">Coding</a>&#x548C;<a href=\"https://www.qiniu.com/\">&#x4E03;&#x725B;</a>&#x3002;</p>\n<h4 id=\"Coding\"><a href=\"#Coding\" class=\"headerlink\" title=\"Coding\"></a>Coding</h4><p><strong>index.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;http://coding.net/u/stefanzan/p/stefanzan/git/raw/coding-pages/public/js/src/scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Chrome, Safari&#x548C;IE&#x6D4F;&#x89C8;&#x5668;&#x90FD;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x9690;&#x85CF;&#xFF0C;&#x8FD4;&#x56DE;<code>Script error.</code>&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/2.png\"><br></div>\n\n<p>&#x4E0D;&#x8FC7;Firefox&#x6BD4;&#x8F83;&#x7279;&#x522B;&#xFF0C;&#x4F9D;&#x7136;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5B8C;&#x6574;&#x7684;&#x6253;&#x5370;&#x51FA;&#x6765;&#xFF0C;&#x5927;&#x6982;&#x662F;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x6392;&#x9519;&#x3002;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/2firefox.png\"><br></div>\n\n\n<h4 id=\"&#x4E03;&#x725B;&#x4E91;\"><a href=\"#&#x4E03;&#x725B;&#x4E91;\" class=\"headerlink\" title=\"&#x4E03;&#x725B;&#x4E91;\"></a>&#x4E03;&#x725B;&#x4E91;</h4><p><strong>index.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/scripterror.js&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x7ED3;&#x679C;&#x548C;&#x6258;&#x7BA1;&#x5728;Coding&#x4E0A;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<p>&#x5C06;&#x5F15;&#x5165;&#x811A;&#x672C;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x52A0;&#x5165;<code>crossorigin=&quot;anaonymous&quot;</code>:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text/javascript&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://og6593g2z.qnssl.com/scripterror.js&quot;</span> <span class=\"attr\">crossorigin</span>=<span class=\"string\">&quot;anonymous&quot;</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>&#x518D;&#x6B21;&#x6267;&#x884C;&#x8FD0;&#x884C;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8868;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/4.png\"><br></div>\n\n<p>Chrome, Safari&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x8BE6;&#x7EC6;&#x7684;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x4E86;&#xFF0C;&#x4F46;&#x662F;IE&#x6D4F;&#x89C8;&#x5668;&#x4F9D;&#x7136;&#x662F;Script error. &#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x6BD4;&#x8F83;&#x5947;&#x602A;, &#x6839;&#x636E;<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes\">MDN - CORS settings attributes</a>&#xFF0C;IE11&#x5E94;&#x8BE5;&#x662F;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x7684;&#x3002;</p>\n<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x5C06;Coding&#x548C;&#x4E03;&#x725B;&#x5BF9;&#x4E8E;<code>scripterror.js</code>&#x7684;<strong>Response Headers</strong>&#x5BF9;&#x4E00;&#x4E0B;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:90%;\" src=\"/2017/04/06/test-script-error/5.png\"><br></div>\n\n<p>&#x4E03;&#x725B;&#x7684;<code>Access-Control-Allow-Origin</code>&#x5141;&#x8BB8;&#x6765;&#x81EA;&#x6240;&#x6709;&#x57DF;&#x540D;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x800C;Coding&#x6CA1;&#x6709;&#x3002;&#x4E03;&#x725B;&#x662F;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x6258;&#x7BA1;&#x5206;&#x53D1;&#x5E73;&#x53F0;&#xFF0C;&#x56E0;&#x6B64;&#x7279;&#x610F;&#x914D;&#x7F6E;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x8FD4;&#x56DE;&#x5934;&#xFF0C;&#x65B9;&#x4FBF;&#x5F00;&#x53D1;&#x8005;&#x5C06;&#x811A;&#x672C;&#x653E;&#x5728;&#x4E03;&#x725B;&#x4E91;&#x540C;&#x65F6;&#x53C8;&#x53EF;&#x4EE5;&#x62FF;&#x5230;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x3002;</p>\n<p>&#x4E0B;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x63D0;&#x51FA;<strong>Script error</strong>&#x7684;<a href=\"http://blog.fundebug.com/2017/04/07/solve-script-error/\">&#x89E3;&#x51B3;&#x65B9;&#x6CD5;</a>&#x3002;</p>"},{"title":"关于/var/run/docker.sock","date":"2017-04-17T04:00:00.000Z","_content":"\n**译者按:** 这篇博客介绍了什么是**/var/run/docker.sock**，以及如何使用**/var/run/docker.sock**与Docker守护进程通信，并且提供了两个简单的示例。理解这些，我们就可以运行一些**能够管理Docker的Docker容器**，比如Portainer、Kubernetes，是不是很神奇呢？\n\n<!-- more -->\n\n原文: [About /var/run/docker.sock](https://medium.com/lucjuggery/about-var-run-docker-sock-3bfd276e12fd)\n\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\n运行过Docker Hub的Docker镜像的话，会发现其中一些容器时需要挂载**/var/run/docker.sock**文件。**这个文件是什么呢？为什么有些容器需要使用它？**简单地说，它是**Docker守护进程(Docker daemon)**默认监听的**Unix域套接字(Unix domain socket)**，容器中的进程可以通过它与Docker守护进程进行通信。\n\n<div style=\"text-align: center;\">\n<img style=\"width:70%;\" src=\"about-docker-sock/01.png\" />\n</div>\n\n图片来源: [http://blog.honeybadger.io](http://blog.honeybadger.io/how-unicorn-talks-to-nginx-an-introduction-to-unix-sockets-in-ruby/)\n\n### 举例\n\n不妨看一下 [Portainer](http://portainer.io/)，它提供了图形化界面用于管理Docker主机和Swarm集群。如果使用Portainer管理本地Docker主机的话，需要绑定**/var/run/docker.sock**:\n\n```bash\ndocker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer\n```\n\n访问9000端口可以查看图形化界面，可以管理容器(container)，镜像(image)，数据卷(volume)...\n\n<div style=\"text-align: center;\">\n<img style=\"width:70%;\" src=\"about-docker-sock/02.png\" />\n</div>\n\nPortainer通过绑定的**/var/run/docker.sock**文件与**Docker守护进程**通信，执行各种管理操作。\n\n### Docker守护进程的API\n\n安装Docker之后，Docker守护进程会监听Unix域套接字：/var/run/docker.sock。这一点可以通过Docker daemon的配置选项看出来(在ubuntu上执行cat /etc/default/docker )：\n\n```bash\n-H unix:///var/run/docker.sock\n```\n\n注: 监听网络TCP套接字或者其他套接字需要配置相应的**-H**选项。\n\n[Docker engine API v1.27](https://docs.docker.com/engine/api/v1.27) (最新版)定义的所有HTTP接口都可以通过/var/run/docker.sock调用。\n\n### 运行容器\n\n使用Portainer的UI，可以轻松创建容器。实际上，HTTP请求是通过docker.sock发送给Docker守护进程的。可以通过[*curl*](https://curl.haxx.se/)创建容器来说明这一点。使用HTTP接口运行容器需要两个步骤，先创建容器，然后启动容器。\n\n#### 1. 创建nginx容器\n\ncurl命令通过Unix套接字发送**{“Image”:”nginx”}**到Docker守护进程的**/containers/create**接口，这个将会基于Nginx镜像创建容器并返回容器的ID。\n\n```bash\ncurl -XPOST --unix-socket /var/run/docker.sock -d ‘{“Image”:”nginx”}’ -H ‘Content-Type: application/json’ http://localhost/containers/create\n```\n\n输出返回了容器ID:\n\n```javascript\n{“Id”:”fcb65c6147efb862d5ea3a2ef20e793c52f0fafa3eb04e4292cb4784c5777d65\",”Warnings”:null}\n```\n\n#### 2. 启动nginx容器\n\n使用返回的容器ID，调用**/containers/<ID>/start**接口，即可启动新创建的容器。\n\n```bash\ncurl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/fcb6...7d65/start\n```\n\n查看已启动的容器:\n\n```\ndocker ls\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\nfcb65c6147ef nginx “nginx -g ‘daemon …” 5 minutes ago Up 5 seconds 80/tcp, 443/tcp ecstatic_kirch\n...\n```\n\n可知，使用docker.sock运行容器其实非常简单。\n\n### Docker守护进程的事件流\n\nDocker的API提供了**/events**接口，可以用于获取Docker守护进程产生的所有事件流。负载均衡组件(load balancer)组件可以通过它获取容器的创建/删除事件，从而动态地更新配置。通过创建一个简单的容器，我们可以了解如何利用Docker守护进程的事件。\n\n#### 1. 运行alpine容器\n\n下面的命令用于运行容器，并采用交互模式(interactive mode，该模式下会直接进入容器内)，同时绑定docker.sock。\n\n```bash\ndocker run -v /var/run/docker.sock:/var/run/docker.sock -ti alpine sh\n```\n\n#### 2. 监听Docker守护进程的事件流\n\n在alpine容器内，可以通过Docker套接字发送HTTP请求到**/events**接口。这个命令会一直等待Docker daemon的事件。当新的事件发生时(例如创建了新的容器)，会看到输出信息。\n\n```bash\ncurl --unix-socket /var/run/docker.sock http://localhost/events\n```\n\n#### 3. 观察事件\n\n基于Nginx镜像运行容器之后，通过aplpine容器的标准输出可以观察到Docker daemon生成的事件。\n\n```bash\ndocker run -p 8080:80 -d nginx\n```\n\n可以观察到3个事件：\n\n- 创建容器\n- 连接默认的桥接网络(bridge network)\n- 启动容器\n\n### 结论\n\n希望这些简单的解释可以帮助大家理解**/var/run/docker.sock**文件，并且明白它绑定到容器时有何作用。显然，真正的应用会使用代码而不是curl命令给Docker守护进程发送HTTP请求。\n\n注意: 绑定Docker套接字之后，容器的权限会很高，可以控制Docker守护进程。因此，这一点必须谨慎使用，只能用于足够信任的容器。\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Docker技术交流群: 305097057**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"about-docker-sock/docker.JPG\" />\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/04/17/about-docker-sock.md","raw":"---\ntitle: 关于/var/run/docker.sock\n\ndate: 2017-04-17 12:00:00\n\ntags: [Docker, 翻译]\n\n---\n\n**译者按:** 这篇博客介绍了什么是**/var/run/docker.sock**，以及如何使用**/var/run/docker.sock**与Docker守护进程通信，并且提供了两个简单的示例。理解这些，我们就可以运行一些**能够管理Docker的Docker容器**，比如Portainer、Kubernetes，是不是很神奇呢？\n\n<!-- more -->\n\n原文: [About /var/run/docker.sock](https://medium.com/lucjuggery/about-var-run-docker-sock-3bfd276e12fd)\n\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\n运行过Docker Hub的Docker镜像的话，会发现其中一些容器时需要挂载**/var/run/docker.sock**文件。**这个文件是什么呢？为什么有些容器需要使用它？**简单地说，它是**Docker守护进程(Docker daemon)**默认监听的**Unix域套接字(Unix domain socket)**，容器中的进程可以通过它与Docker守护进程进行通信。\n\n<div style=\"text-align: center;\">\n<img style=\"width:70%;\" src=\"about-docker-sock/01.png\" />\n</div>\n\n图片来源: [http://blog.honeybadger.io](http://blog.honeybadger.io/how-unicorn-talks-to-nginx-an-introduction-to-unix-sockets-in-ruby/)\n\n### 举例\n\n不妨看一下 [Portainer](http://portainer.io/)，它提供了图形化界面用于管理Docker主机和Swarm集群。如果使用Portainer管理本地Docker主机的话，需要绑定**/var/run/docker.sock**:\n\n```bash\ndocker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer\n```\n\n访问9000端口可以查看图形化界面，可以管理容器(container)，镜像(image)，数据卷(volume)...\n\n<div style=\"text-align: center;\">\n<img style=\"width:70%;\" src=\"about-docker-sock/02.png\" />\n</div>\n\nPortainer通过绑定的**/var/run/docker.sock**文件与**Docker守护进程**通信，执行各种管理操作。\n\n### Docker守护进程的API\n\n安装Docker之后，Docker守护进程会监听Unix域套接字：/var/run/docker.sock。这一点可以通过Docker daemon的配置选项看出来(在ubuntu上执行cat /etc/default/docker )：\n\n```bash\n-H unix:///var/run/docker.sock\n```\n\n注: 监听网络TCP套接字或者其他套接字需要配置相应的**-H**选项。\n\n[Docker engine API v1.27](https://docs.docker.com/engine/api/v1.27) (最新版)定义的所有HTTP接口都可以通过/var/run/docker.sock调用。\n\n### 运行容器\n\n使用Portainer的UI，可以轻松创建容器。实际上，HTTP请求是通过docker.sock发送给Docker守护进程的。可以通过[*curl*](https://curl.haxx.se/)创建容器来说明这一点。使用HTTP接口运行容器需要两个步骤，先创建容器，然后启动容器。\n\n#### 1. 创建nginx容器\n\ncurl命令通过Unix套接字发送**{“Image”:”nginx”}**到Docker守护进程的**/containers/create**接口，这个将会基于Nginx镜像创建容器并返回容器的ID。\n\n```bash\ncurl -XPOST --unix-socket /var/run/docker.sock -d ‘{“Image”:”nginx”}’ -H ‘Content-Type: application/json’ http://localhost/containers/create\n```\n\n输出返回了容器ID:\n\n```javascript\n{“Id”:”fcb65c6147efb862d5ea3a2ef20e793c52f0fafa3eb04e4292cb4784c5777d65\",”Warnings”:null}\n```\n\n#### 2. 启动nginx容器\n\n使用返回的容器ID，调用**/containers/<ID>/start**接口，即可启动新创建的容器。\n\n```bash\ncurl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/fcb6...7d65/start\n```\n\n查看已启动的容器:\n\n```\ndocker ls\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\nfcb65c6147ef nginx “nginx -g ‘daemon …” 5 minutes ago Up 5 seconds 80/tcp, 443/tcp ecstatic_kirch\n...\n```\n\n可知，使用docker.sock运行容器其实非常简单。\n\n### Docker守护进程的事件流\n\nDocker的API提供了**/events**接口，可以用于获取Docker守护进程产生的所有事件流。负载均衡组件(load balancer)组件可以通过它获取容器的创建/删除事件，从而动态地更新配置。通过创建一个简单的容器，我们可以了解如何利用Docker守护进程的事件。\n\n#### 1. 运行alpine容器\n\n下面的命令用于运行容器，并采用交互模式(interactive mode，该模式下会直接进入容器内)，同时绑定docker.sock。\n\n```bash\ndocker run -v /var/run/docker.sock:/var/run/docker.sock -ti alpine sh\n```\n\n#### 2. 监听Docker守护进程的事件流\n\n在alpine容器内，可以通过Docker套接字发送HTTP请求到**/events**接口。这个命令会一直等待Docker daemon的事件。当新的事件发生时(例如创建了新的容器)，会看到输出信息。\n\n```bash\ncurl --unix-socket /var/run/docker.sock http://localhost/events\n```\n\n#### 3. 观察事件\n\n基于Nginx镜像运行容器之后，通过aplpine容器的标准输出可以观察到Docker daemon生成的事件。\n\n```bash\ndocker run -p 8080:80 -d nginx\n```\n\n可以观察到3个事件：\n\n- 创建容器\n- 连接默认的桥接网络(bridge network)\n- 启动容器\n\n### 结论\n\n希望这些简单的解释可以帮助大家理解**/var/run/docker.sock**文件，并且明白它绑定到容器时有何作用。显然，真正的应用会使用代码而不是curl命令给Docker守护进程发送HTTP请求。\n\n注意: 绑定Docker套接字之后，容器的权限会很高，可以控制Docker守护进程。因此，这一点必须谨慎使用，只能用于足够信任的容器。\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Docker技术交流群: 305097057**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"about-docker-sock/docker.JPG\" />\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"2017/04/17/about-docker-sock","published":1,"updated":"2017-04-16T14:12:11.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweob0030mkfyc4f1r68p","content":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> &#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4ECB;&#x7ECD;&#x4E86;&#x4EC0;&#x4E48;&#x662F;<strong>/var/run/docker.sock</strong>&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4F7F;&#x7528;<strong>/var/run/docker.sock</strong>&#x4E0E;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x3002;&#x7406;&#x89E3;&#x8FD9;&#x4E9B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4E00;&#x4E9B;<strong>&#x80FD;&#x591F;&#x7BA1;&#x7406;Docker&#x7684;Docker&#x5BB9;&#x5668;</strong>&#xFF0C;&#x6BD4;&#x5982;Portainer&#x3001;Kubernetes&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x795E;&#x5947;&#x5462;&#xFF1F;</p>\n<a id=\"more\"></a>\n<p>&#x539F;&#x6587;: <a href=\"https://medium.com/lucjuggery/about-var-run-docker-sock-3bfd276e12fd\" target=\"_blank\" rel=\"external\">About /var/run/docker.sock</a></p>\n<p>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>&#x8FD0;&#x884C;&#x8FC7;Docker Hub&#x7684;Docker&#x955C;&#x50CF;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x5BB9;&#x5668;&#x65F6;&#x9700;&#x8981;&#x6302;&#x8F7D;<strong>/var/run/docker.sock</strong>&#x6587;&#x4EF6;&#x3002;<strong>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x4E9B;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#xFF1F;</strong>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;&#x5B83;&#x662F;<strong>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;(Docker daemon)</strong>&#x9ED8;&#x8BA4;&#x76D1;&#x542C;&#x7684;<strong>Unix&#x57DF;&#x5957;&#x63A5;&#x5B57;(Unix domain socket)</strong>&#xFF0C;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x4E0E;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:70%;\" src=\"/2017/04/17/about-docker-sock/01.png\"><br></div>\n\n<p>&#x56FE;&#x7247;&#x6765;&#x6E90;: <a href=\"http://blog.honeybadger.io/how-unicorn-talks-to-nginx-an-introduction-to-unix-sockets-in-ruby/\" target=\"_blank\" rel=\"external\">http://blog.honeybadger.io</a></p>\n<h3 id=\"&#x4E3E;&#x4F8B;\"><a href=\"#&#x4E3E;&#x4F8B;\" class=\"headerlink\" title=\"&#x4E3E;&#x4F8B;\"></a>&#x4E3E;&#x4F8B;</h3><p>&#x4E0D;&#x59A8;&#x770B;&#x4E00;&#x4E0B; <a href=\"http://portainer.io/\" target=\"_blank\" rel=\"external\">Portainer</a>&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x56FE;&#x5F62;&#x5316;&#x754C;&#x9762;&#x7528;&#x4E8E;&#x7BA1;&#x7406;Docker&#x4E3B;&#x673A;&#x548C;Swarm&#x96C6;&#x7FA4;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;Portainer&#x7BA1;&#x7406;&#x672C;&#x5730;Docker&#x4E3B;&#x673A;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x7ED1;&#x5B9A;<strong>/var/run/docker.sock</strong>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker run <span class=\"_\">-d</span> -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</div></pre></td></tr></table></figure>\n<p>&#x8BBF;&#x95EE;9000&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x56FE;&#x5F62;&#x5316;&#x754C;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x7BA1;&#x7406;&#x5BB9;&#x5668;(container)&#xFF0C;&#x955C;&#x50CF;(image)&#xFF0C;&#x6570;&#x636E;&#x5377;(volume)&#x2026;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:70%;\" src=\"/2017/04/17/about-docker-sock/02.png\"><br></div>\n\n<p>Portainer&#x901A;&#x8FC7;&#x7ED1;&#x5B9A;&#x7684;<strong>/var/run/docker.sock</strong>&#x6587;&#x4EF6;&#x4E0E;<strong>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;</strong>&#x901A;&#x4FE1;&#xFF0C;&#x6267;&#x884C;&#x5404;&#x79CD;&#x7BA1;&#x7406;&#x64CD;&#x4F5C;&#x3002;</p>\n<h3 id=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API\"><a href=\"#Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API\" class=\"headerlink\" title=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API\"></a>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API</h3><p>&#x5B89;&#x88C5;Docker&#x4E4B;&#x540E;&#xFF0C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4F1A;&#x76D1;&#x542C;Unix&#x57DF;&#x5957;&#x63A5;&#x5B57;&#xFF1A;/var/run/docker.sock&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Docker daemon&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x770B;&#x51FA;&#x6765;(&#x5728;ubuntu&#x4E0A;&#x6267;&#x884C;cat /etc/default/docker )&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">-H unix:///var/run/docker.sock</div></pre></td></tr></table></figure>\n<p>&#x6CE8;: &#x76D1;&#x542C;&#x7F51;&#x7EDC;TCP&#x5957;&#x63A5;&#x5B57;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x5957;&#x63A5;&#x5B57;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x76F8;&#x5E94;&#x7684;<strong>-H</strong>&#x9009;&#x9879;&#x3002;</p>\n<p><a href=\"https://docs.docker.com/engine/api/v1.27\" target=\"_blank\" rel=\"external\">Docker engine API v1.27</a> (&#x6700;&#x65B0;&#x7248;)&#x5B9A;&#x4E49;&#x7684;&#x6240;&#x6709;HTTP&#x63A5;&#x53E3;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;/var/run/docker.sock&#x8C03;&#x7528;&#x3002;</p>\n<h3 id=\"&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a>&#x8FD0;&#x884C;&#x5BB9;&#x5668;</h3><p>&#x4F7F;&#x7528;Portainer&#x7684;UI&#xFF0C;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;HTTP&#x8BF7;&#x6C42;&#x662F;&#x901A;&#x8FC7;docker.sock&#x53D1;&#x9001;&#x7ED9;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"https://curl.haxx.se/\" target=\"_blank\" rel=\"external\"><em>curl</em></a>&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x6765;&#x8BF4;&#x660E;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x4F7F;&#x7528;HTTP&#x63A5;&#x53E3;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#xFF0C;&#x5148;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x3002;</p>\n<h4 id=\"1-&#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;\"><a href=\"#1-&#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"1. &#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;\"></a>1. &#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;</h4><p>curl&#x547D;&#x4EE4;&#x901A;&#x8FC7;Unix&#x5957;&#x63A5;&#x5B57;&#x53D1;&#x9001;<strong>{&#x201C;Image&#x201D;:&#x201D;nginx&#x201D;}</strong>&#x5230;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;<strong>/containers/create</strong>&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C06;&#x4F1A;&#x57FA;&#x4E8E;Nginx&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x5E76;&#x8FD4;&#x56DE;&#x5BB9;&#x5668;&#x7684;ID&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -XPOST --unix-socket /var/run/docker.sock <span class=\"_\">-d</span> &#x2018;{&#x201C;Image&#x201D;:&#x201D;nginx&#x201D;}&#x2019; -H &#x2018;Content-Type: application/json&#x2019; http://localhost/containers/create</div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;&#x8FD4;&#x56DE;&#x4E86;&#x5BB9;&#x5668;ID:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\">{&#x201C;Id&#x201D;:&#x201D;fcb65c6147efb862d5ea3a2ef20e793c52f0fafa3eb04e4292cb4784c5777d65<span class=\"string\">&quot;,&#x201D;Warnings&#x201D;:null}</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x542F;&#x52A8;nginx&#x5BB9;&#x5668;\"><a href=\"#2-&#x542F;&#x52A8;nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x542F;&#x52A8;nginx&#x5BB9;&#x5668;\"></a>2. &#x542F;&#x52A8;nginx&#x5BB9;&#x5668;</h4><p>&#x4F7F;&#x7528;&#x8FD4;&#x56DE;&#x7684;&#x5BB9;&#x5668;ID&#xFF0C;&#x8C03;&#x7528;<strong>/containers/<id>/start</id></strong>&#x63A5;&#x53E3;&#xFF0C;&#x5373;&#x53EF;&#x542F;&#x52A8;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/fcb6...7d65/start</div></pre></td></tr></table></figure>\n<p>&#x67E5;&#x770B;&#x5DF2;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;:</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker ls</div><div class=\"line\">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</div><div class=\"line\">fcb65c6147ef nginx &#x201C;nginx -g &#x2018;daemon &#x2026;&#x201D; <span class=\"number\">5</span> minutes ago Up <span class=\"number\">5</span> seconds <span class=\"number\">80</span>/tcp, <span class=\"number\">443</span>/tcp ecstatic_kirch</div><div class=\"line\">...</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4F7F;&#x7528;docker.sock&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;</p>\n<h3 id=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"><a href=\"#Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\" class=\"headerlink\" title=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"></a>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;</h3><p>Docker&#x7684;API&#x63D0;&#x4F9B;&#x4E86;<strong>/events</strong>&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x83B7;&#x53D6;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4EA7;&#x751F;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x6D41;&#x3002;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7EC4;&#x4EF6;(load balancer)&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x7684;&#x521B;&#x5EFA;/&#x5220;&#x9664;&#x4E8B;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x52A8;&#x6001;&#x5730;&#x66F4;&#x65B0;&#x914D;&#x7F6E;&#x3002;&#x901A;&#x8FC7;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5982;&#x4F55;&#x5229;&#x7528;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x3002;</p>\n<h4 id=\"1-&#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;\"><a href=\"#1-&#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"1. &#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;\"></a>1. &#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;</h4><p>&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x7528;&#x4E8E;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x91C7;&#x7528;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;(interactive mode&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;&#x4F1A;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x5185;)&#xFF0C;&#x540C;&#x65F6;&#x7ED1;&#x5B9A;docker.sock&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker run -v /var/run/docker.sock:/var/run/docker.sock -ti alpine sh</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"><a href=\"#2-&#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\" class=\"headerlink\" title=\"2. &#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"></a>2. &#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;</h4><p>&#x5728;alpine&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Docker&#x5957;&#x63A5;&#x5B57;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x5230;<strong>/events</strong>&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;Docker daemon&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x5F53;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x65F6;(&#x4F8B;&#x5982;&#x521B;&#x5EFA;&#x4E86;&#x65B0;&#x7684;&#x5BB9;&#x5668;)&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8F93;&#x51FA;&#x4FE1;&#x606F;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl --unix-socket /var/run/docker.sock http://localhost/events</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;\"><a href=\"#3-&#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;\"></a>3. &#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;</h4><p>&#x57FA;&#x4E8E;Nginx&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x4E4B;&#x540E;&#xFF0C;&#x901A;&#x8FC7;aplpine&#x5BB9;&#x5668;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;Docker daemon&#x751F;&#x6210;&#x7684;&#x4E8B;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker run -p 8080:80 <span class=\"_\">-d</span> nginx</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;3&#x4E2A;&#x4E8B;&#x4EF6;&#xFF1A;</p>\n<ul>\n<li>&#x521B;&#x5EFA;&#x5BB9;&#x5668;</li>\n<li>&#x8FDE;&#x63A5;&#x9ED8;&#x8BA4;&#x7684;&#x6865;&#x63A5;&#x7F51;&#x7EDC;(bridge network)</li>\n<li>&#x542F;&#x52A8;&#x5BB9;&#x5668;</li>\n</ul>\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>&#x5E0C;&#x671B;&#x8FD9;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x91CA;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x7406;&#x89E3;<strong>/var/run/docker.sock</strong>&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x660E;&#x767D;&#x5B83;&#x7ED1;&#x5B9A;&#x5230;&#x5BB9;&#x5668;&#x65F6;&#x6709;&#x4F55;&#x4F5C;&#x7528;&#x3002;&#x663E;&#x7136;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5E94;&#x7528;&#x4F1A;&#x4F7F;&#x7528;&#x4EE3;&#x7801;&#x800C;&#x4E0D;&#x662F;curl&#x547D;&#x4EE4;&#x7ED9;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x3002;</p>\n<p>&#x6CE8;&#x610F;: &#x7ED1;&#x5B9A;Docker&#x5957;&#x63A5;&#x5B57;&#x4E4B;&#x540E;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x6743;&#x9650;&#x4F1A;&#x5F88;&#x9AD8;&#xFF0C;&#x53EF;&#x4EE5;&#x63A7;&#x5236;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x5FC5;&#x987B;&#x8C28;&#x614E;&#x4F7F;&#x7528;&#xFF0C;&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x8DB3;&#x591F;&#x4FE1;&#x4EFB;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Docker&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 305097057</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/17/about-docker-sock/docker.JPG\"><br></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","excerpt":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> &#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4ECB;&#x7ECD;&#x4E86;&#x4EC0;&#x4E48;&#x662F;<strong>/var/run/docker.sock</strong>&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4F7F;&#x7528;<strong>/var/run/docker.sock</strong>&#x4E0E;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#xFF0C;&#x5E76;&#x4E14;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x3002;&#x7406;&#x89E3;&#x8FD9;&#x4E9B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4E00;&#x4E9B;<strong>&#x80FD;&#x591F;&#x7BA1;&#x7406;Docker&#x7684;Docker&#x5BB9;&#x5668;</strong>&#xFF0C;&#x6BD4;&#x5982;Portainer&#x3001;Kubernetes&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x795E;&#x5947;&#x5462;&#xFF1F;</p>","more":"<p>&#x539F;&#x6587;: <a href=\"https://medium.com/lucjuggery/about-var-run-docker-sock-3bfd276e12fd\">About /var/run/docker.sock</a></p>\n<p>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>&#x8FD0;&#x884C;&#x8FC7;Docker Hub&#x7684;Docker&#x955C;&#x50CF;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x5BB9;&#x5668;&#x65F6;&#x9700;&#x8981;&#x6302;&#x8F7D;<strong>/var/run/docker.sock</strong>&#x6587;&#x4EF6;&#x3002;<strong>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x4E9B;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#xFF1F;</strong>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;&#x5B83;&#x662F;<strong>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;(Docker daemon)</strong>&#x9ED8;&#x8BA4;&#x76D1;&#x542C;&#x7684;<strong>Unix&#x57DF;&#x5957;&#x63A5;&#x5B57;(Unix domain socket)</strong>&#xFF0C;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x4E0E;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:70%;\" src=\"/2017/04/17/about-docker-sock/01.png\"><br></div>\n\n<p>&#x56FE;&#x7247;&#x6765;&#x6E90;: <a href=\"http://blog.honeybadger.io/how-unicorn-talks-to-nginx-an-introduction-to-unix-sockets-in-ruby/\">http://blog.honeybadger.io</a></p>\n<h3 id=\"&#x4E3E;&#x4F8B;\"><a href=\"#&#x4E3E;&#x4F8B;\" class=\"headerlink\" title=\"&#x4E3E;&#x4F8B;\"></a>&#x4E3E;&#x4F8B;</h3><p>&#x4E0D;&#x59A8;&#x770B;&#x4E00;&#x4E0B; <a href=\"http://portainer.io/\">Portainer</a>&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x56FE;&#x5F62;&#x5316;&#x754C;&#x9762;&#x7528;&#x4E8E;&#x7BA1;&#x7406;Docker&#x4E3B;&#x673A;&#x548C;Swarm&#x96C6;&#x7FA4;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;Portainer&#x7BA1;&#x7406;&#x672C;&#x5730;Docker&#x4E3B;&#x673A;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x7ED1;&#x5B9A;<strong>/var/run/docker.sock</strong>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker run <span class=\"_\">-d</span> -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</div></pre></td></tr></table></figure>\n<p>&#x8BBF;&#x95EE;9000&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x56FE;&#x5F62;&#x5316;&#x754C;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x7BA1;&#x7406;&#x5BB9;&#x5668;(container)&#xFF0C;&#x955C;&#x50CF;(image)&#xFF0C;&#x6570;&#x636E;&#x5377;(volume)&#x2026;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:70%;\" src=\"/2017/04/17/about-docker-sock/02.png\"><br></div>\n\n<p>Portainer&#x901A;&#x8FC7;&#x7ED1;&#x5B9A;&#x7684;<strong>/var/run/docker.sock</strong>&#x6587;&#x4EF6;&#x4E0E;<strong>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;</strong>&#x901A;&#x4FE1;&#xFF0C;&#x6267;&#x884C;&#x5404;&#x79CD;&#x7BA1;&#x7406;&#x64CD;&#x4F5C;&#x3002;</p>\n<h3 id=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API\"><a href=\"#Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API\" class=\"headerlink\" title=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API\"></a>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;API</h3><p>&#x5B89;&#x88C5;Docker&#x4E4B;&#x540E;&#xFF0C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4F1A;&#x76D1;&#x542C;Unix&#x57DF;&#x5957;&#x63A5;&#x5B57;&#xFF1A;/var/run/docker.sock&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Docker daemon&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#x770B;&#x51FA;&#x6765;(&#x5728;ubuntu&#x4E0A;&#x6267;&#x884C;cat /etc/default/docker )&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">-H unix:///var/run/docker.sock</div></pre></td></tr></table></figure>\n<p>&#x6CE8;: &#x76D1;&#x542C;&#x7F51;&#x7EDC;TCP&#x5957;&#x63A5;&#x5B57;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x5957;&#x63A5;&#x5B57;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x76F8;&#x5E94;&#x7684;<strong>-H</strong>&#x9009;&#x9879;&#x3002;</p>\n<p><a href=\"https://docs.docker.com/engine/api/v1.27\">Docker engine API v1.27</a> (&#x6700;&#x65B0;&#x7248;)&#x5B9A;&#x4E49;&#x7684;&#x6240;&#x6709;HTTP&#x63A5;&#x53E3;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;/var/run/docker.sock&#x8C03;&#x7528;&#x3002;</p>\n<h3 id=\"&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"><a href=\"#&#x8FD0;&#x884C;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x5BB9;&#x5668;\"></a>&#x8FD0;&#x884C;&#x5BB9;&#x5668;</h3><p>&#x4F7F;&#x7528;Portainer&#x7684;UI&#xFF0C;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;HTTP&#x8BF7;&#x6C42;&#x662F;&#x901A;&#x8FC7;docker.sock&#x53D1;&#x9001;&#x7ED9;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"https://curl.haxx.se/\"><em>curl</em></a>&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x6765;&#x8BF4;&#x660E;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x4F7F;&#x7528;HTTP&#x63A5;&#x53E3;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#xFF0C;&#x5148;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x3002;</p>\n<h4 id=\"1-&#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;\"><a href=\"#1-&#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"1. &#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;\"></a>1. &#x521B;&#x5EFA;nginx&#x5BB9;&#x5668;</h4><p>curl&#x547D;&#x4EE4;&#x901A;&#x8FC7;Unix&#x5957;&#x63A5;&#x5B57;&#x53D1;&#x9001;<strong>{&#x201C;Image&#x201D;:&#x201D;nginx&#x201D;}</strong>&#x5230;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;<strong>/containers/create</strong>&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C06;&#x4F1A;&#x57FA;&#x4E8E;Nginx&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x5E76;&#x8FD4;&#x56DE;&#x5BB9;&#x5668;&#x7684;ID&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -XPOST --unix-socket /var/run/docker.sock <span class=\"_\">-d</span> &#x2018;{&#x201C;Image&#x201D;:&#x201D;nginx&#x201D;}&#x2019; -H &#x2018;Content-Type: application/json&#x2019; http://localhost/containers/create</div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;&#x8FD4;&#x56DE;&#x4E86;&#x5BB9;&#x5668;ID:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\">{&#x201C;Id&#x201D;:&#x201D;fcb65c6147efb862d5ea3a2ef20e793c52f0fafa3eb04e4292cb4784c5777d65<span class=\"string\">&quot;,&#x201D;Warnings&#x201D;:null}</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x542F;&#x52A8;nginx&#x5BB9;&#x5668;\"><a href=\"#2-&#x542F;&#x52A8;nginx&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"2. &#x542F;&#x52A8;nginx&#x5BB9;&#x5668;\"></a>2. &#x542F;&#x52A8;nginx&#x5BB9;&#x5668;</h4><p>&#x4F7F;&#x7528;&#x8FD4;&#x56DE;&#x7684;&#x5BB9;&#x5668;ID&#xFF0C;&#x8C03;&#x7528;<strong>/containers/<ID>/start</ID></strong>&#x63A5;&#x53E3;&#xFF0C;&#x5373;&#x53EF;&#x542F;&#x52A8;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/fcb6...7d65/start</div></pre></td></tr></table></figure>\n<p>&#x67E5;&#x770B;&#x5DF2;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;:</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker ls</div><div class=\"line\">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</div><div class=\"line\">fcb65c6147ef nginx &#x201C;nginx -g &#x2018;daemon &#x2026;&#x201D; <span class=\"number\">5</span> minutes ago Up <span class=\"number\">5</span> seconds <span class=\"number\">80</span>/tcp, <span class=\"number\">443</span>/tcp ecstatic_kirch</div><div class=\"line\">...</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4F7F;&#x7528;docker.sock&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;</p>\n<h3 id=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"><a href=\"#Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\" class=\"headerlink\" title=\"Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"></a>Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;</h3><p>Docker&#x7684;API&#x63D0;&#x4F9B;&#x4E86;<strong>/events</strong>&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x83B7;&#x53D6;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4EA7;&#x751F;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x6D41;&#x3002;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7EC4;&#x4EF6;(load balancer)&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B83;&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x7684;&#x521B;&#x5EFA;/&#x5220;&#x9664;&#x4E8B;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x52A8;&#x6001;&#x5730;&#x66F4;&#x65B0;&#x914D;&#x7F6E;&#x3002;&#x901A;&#x8FC7;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5982;&#x4F55;&#x5229;&#x7528;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x3002;</p>\n<h4 id=\"1-&#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;\"><a href=\"#1-&#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"1. &#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;\"></a>1. &#x8FD0;&#x884C;alpine&#x5BB9;&#x5668;</h4><p>&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x7528;&#x4E8E;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x91C7;&#x7528;&#x4EA4;&#x4E92;&#x6A21;&#x5F0F;(interactive mode&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;&#x4F1A;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x5185;)&#xFF0C;&#x540C;&#x65F6;&#x7ED1;&#x5B9A;docker.sock&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker run -v /var/run/docker.sock:/var/run/docker.sock -ti alpine sh</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"><a href=\"#2-&#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\" class=\"headerlink\" title=\"2. &#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;\"></a>2. &#x76D1;&#x542C;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x4E8B;&#x4EF6;&#x6D41;</h4><p>&#x5728;alpine&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Docker&#x5957;&#x63A5;&#x5B57;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x5230;<strong>/events</strong>&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;Docker daemon&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x5F53;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x65F6;(&#x4F8B;&#x5982;&#x521B;&#x5EFA;&#x4E86;&#x65B0;&#x7684;&#x5BB9;&#x5668;)&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8F93;&#x51FA;&#x4FE1;&#x606F;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">curl --unix-socket /var/run/docker.sock http://localhost/events</div></pre></td></tr></table></figure>\n<h4 id=\"3-&#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;\"><a href=\"#3-&#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;\" class=\"headerlink\" title=\"3. &#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;\"></a>3. &#x89C2;&#x5BDF;&#x4E8B;&#x4EF6;</h4><p>&#x57FA;&#x4E8E;Nginx&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x4E4B;&#x540E;&#xFF0C;&#x901A;&#x8FC7;aplpine&#x5BB9;&#x5668;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;Docker daemon&#x751F;&#x6210;&#x7684;&#x4E8B;&#x4EF6;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">docker run -p 8080:80 <span class=\"_\">-d</span> nginx</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;3&#x4E2A;&#x4E8B;&#x4EF6;&#xFF1A;</p>\n<ul>\n<li>&#x521B;&#x5EFA;&#x5BB9;&#x5668;</li>\n<li>&#x8FDE;&#x63A5;&#x9ED8;&#x8BA4;&#x7684;&#x6865;&#x63A5;&#x7F51;&#x7EDC;(bridge network)</li>\n<li>&#x542F;&#x52A8;&#x5BB9;&#x5668;</li>\n</ul>\n<h3 id=\"&#x7ED3;&#x8BBA;\"><a href=\"#&#x7ED3;&#x8BBA;\" class=\"headerlink\" title=\"&#x7ED3;&#x8BBA;\"></a>&#x7ED3;&#x8BBA;</h3><p>&#x5E0C;&#x671B;&#x8FD9;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x91CA;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x7406;&#x89E3;<strong>/var/run/docker.sock</strong>&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x660E;&#x767D;&#x5B83;&#x7ED1;&#x5B9A;&#x5230;&#x5BB9;&#x5668;&#x65F6;&#x6709;&#x4F55;&#x4F5C;&#x7528;&#x3002;&#x663E;&#x7136;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5E94;&#x7528;&#x4F1A;&#x4F7F;&#x7528;&#x4EE3;&#x7801;&#x800C;&#x4E0D;&#x662F;curl&#x547D;&#x4EE4;&#x7ED9;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x3002;</p>\n<p>&#x6CE8;&#x610F;: &#x7ED1;&#x5B9A;Docker&#x5957;&#x63A5;&#x5B57;&#x4E4B;&#x540E;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x6743;&#x9650;&#x4F1A;&#x5F88;&#x9AD8;&#xFF0C;&#x53EF;&#x4EE5;&#x63A7;&#x5236;Docker&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x5FC5;&#x987B;&#x8C28;&#x614E;&#x4F7F;&#x7528;&#xFF0C;&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x8DB3;&#x591F;&#x4FE1;&#x4EFB;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Docker&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 305097057</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/17/about-docker-sock/docker.JPG\"><br></div>"},{"title":"Node.js面试题之2017","date":"2017-04-10T04:00:00.000Z","_content":"\n**译者按:** 从**ECMAScript标准**，**Node.js语法**以及**NPM模块**角度来看，Node.js的发展让人目不暇接，那么面试题也得与时俱进。\n\n\n<!-- more -->\n\n原文: [Node.js Interview Questions and Answers (2017 Edition)](https://blog.risingstack.com/node-js-interview-questions-and-answers-2017/)\n\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\n### 问题\n\n- 什么是错误优先的回调函数？\n- 如何避免回调地狱？\n- 什么是Promise?\n- 用什么工具保证一致的代码风格？为什么要这样？\n- 什么是Stub?举例说明\n- 什么是测试金字塔？举例说明\n- 最喜欢哪个HTTP框架？为什么？\n- Cookies如何防范XSS攻击？\n- 如何保证依赖的安全性？\n\n### 答案\n\n#### 1. 什么是错误优先的回调函数？\n\n错误优先的回调函数(Error-First Callback)用于同时返回错误和数据。第一个参数返回错误，并且验证它是否出错；其他参数用于返回数据。\n\n```javascript\nfs.readFile(filePath, function(err, data)\n{\n    if (err)\n    {\n        // 处理错误\n        return console.log(err);\n    }\n    console.log(data);\n});\n```\n\n#### 2. 如何避免回调地狱？\n\n以下方式可以避免回调地狱:\n\n- 模块化: 将回调函数转换为独立的函数\n- 使用流程控制库，例如[aync](https://www.npmjs.com/package/async)\n- 使用Promise\n- 使用aync/await(参考[Async/Await替代Promise的6个理由](https://blog.fundebug.com/2017/04/04/nodejs-async-await/))\n\n#### 3. 什么是Promise?\n\nPromise可以帮助我们更好地处理异步操作。下面的示例中，100ms后会打印result字符串。**catch**用于错误处理。多个Promise可以链接起来。\n\n```javascript\nnew Promise((resolve, reject) =>\n    {\n        setTimeout(() =>\n        {\n            resolve('result');\n        }, 100)\n    })\n    .then(console.log)\n    .catch(console.error);\n```\n\n#### 4. 用什么工具保证一致的代码风格？为什么要这样？\n\n团队协作时，保证一致的代码风格是非常重要的，这样团队成员才可以更快地修改代码，而不需要每次去适应新的风格。这些工具可以帮助我们:\n\n- [ESLint](http://eslint.org/)\n- [Standard](https://standardjs.com/)\n\n感兴趣的话，可以参考[JavaScript Clean Coding](https://blog.risingstack.com/javascript-clean-coding-best-practices-node-js-at-scale/)\n\n#### 5. 什么是Stub?举例说明\n\nStub用于模拟模块的行为。测试时，Stub可以为函数调用返回模拟的结果。比如说，当我们写文件时，实际上并不需要真正去写。\n\n```javascript\nvar fs = require('fs');\n\nvar writeFileStub = sinon.stub(fs, 'writeFile', function(path, data, cb)\n{\n    return cb(null);\n});\n\nexpect(writeFileStub).to.be.called;\nwriteFileStub.restore();\n```\n\n#### 6. 什么是测试金字塔？举例说明\n\n测试金字塔反映了需要写的**单元测试**、**集成测试**以及**端到端测试**的比例:\n\n<div style=\"text-align: left;\">\n<img style=\"width:30%;\" src=\"nodejs-interview-2017/test_pyramid.png\" />\n</div>\n\n测试HTTP接口时应该是这样的:\n\n- 很多单元测试，分别测试各个模块(依赖需要stub)\n- 较少的集成测试，测试各个模块之间的交互(依赖不能stub)\n- 少量端到端测试，去调用真正地接口(依赖不能stub)\n\n#### 7. 最喜欢哪个HTTP框架？为什么？\n\n这个问题标准答案。需要描述框架的优缺点，这样可以反映开发者对框架的熟悉程度。\n\n#### 8. Cookies如何防范XSS攻击？\n\nXSS(Cross-Site Scripting，跨站脚本攻击)是指攻击者在返回的HTML中插入JavaScript脚本。为了减轻这些攻击，需要在HTTP头部配置**set-cookie**:\n\n- HttpOnly - 这个属性可以防止**cross-site scripting**，因为它会禁止Javascript脚本访问cookie。\n- secure - 这个属性告诉浏览器仅在请求为HTTPS时发送cookie。\n\n结果应该是这样的: **Set-Cookie: sid=<cookie-value>; HttpOnly**. 使用Express的话，[cookie-session](https://github.com/expressjs/cookie-session#cookie-options)默认配置好了。\n\n#### 9. 如何保证依赖的安全性？\n\n编写Node.js应用时，很可能依赖成百上千的模块。例如，使用了Express的话，会直接依赖[27个模块](https://github.com/expressjs/express/blob/master/package.json#L29)。因此，手动检查所有依赖是不现实的。唯一的办法是对依赖进行自动化的安全检查，有这些工具可供选择:\n\n- npm outdated\n- [Trace by RisingStack](https://trace.risingstack.com/)\n- [NSP](https://nodesecurity.io/)\n- [GreenKeeper](https://greenkeeper.io/)\n- [Snyk](https://snyk.io/)\n\n### 附加题\n\n#### 1. 这段代码有什么问题？\n\n```javascript\nnew Promise((resolve, reject) =>\n    {\n        throw new Error('error')\n    })\n    .then(console.log)\n```\n\n\n\n**then**之后没有**catch**。这样的话，错误会被忽略。可以这样解决问题:\n\n```javascript\nnew Promise((resolve, reject) =>\n    {\n        throw new Error('error')\n    })\n    .then(console.log).catch(console.error)\n```\n\n\n\n调试一个大型的项目时，可以使用监控**unhandledRejection**事件来捕获所有未处理的Promise错误:\n\n```javascript\nprocess.on('unhandledRejection', (err) =>\n{\n    console.log(err)\n})\n```\n\n------\n\n### 2. 这段代码有什么问题？\n\n```javascript\nfunction checkApiKey(apiKeyFromDb, apiKeyReceived)\n{\n    if (apiKeyFromDb === apiKeyReceived)\n    {\n        return true\n    }\n    return false\n}\n```\n\n比较密码时，不能泄露任何信息，因此比较必须在固定时间完成。否则，可以使用[timing attacks](https://en.wikipedia.org/wiki/Timing_attack)来攻击你的应用。**为什么会这样呢**?Node.js使用V8引擎，它会从性能角度优化代码。它会逐个比较字符串的字母，一旦发现不匹配时就停止比较。当攻击者的密码更准确时，比较的时间越长。因此，攻击者可以通过比较的时间长短来判断密码的正确性。使用[cryptiles](https://www.npmjs.com/package/cryptiles)可以解决这个问题:\n\n```javascript\nfunction checkApiKey(apiKeyFromDb, apiKeyReceived)\n{\n    return cryptiles.fixedTimeComparison(apiKeyFromDb, apiKeyReceived)\n}\n```\n\n### 3. 这段代码的输出是什么？\n\n```javascript\nPromise.resolve(1)  \n  .then((x) => x + 1)\n  .then((x) => { throw new Error('My Error') })\n  .catch(() => 1)\n  .then((x) => x + 1)\n  .then((x) => console.log(x))\n  .catch(console.error)\n```\n\n答案是2，逐行解释如下:\n\n1. 创建新的Promise，resolve值为1。\n2. x为1，加1之后返回2。\n3. x为2，但是没有用到。抛出一个错误。\n4. 捕获错误，但是没有处理。返回1。\n5. x为1，加1之后返回2。\n6. x为2，打印2。\n7. 不会执行，因为没有错误抛出。\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群: 177654062**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-interview-2017/nodejs-qq-group.jpeg\" />\n</div>\n\n### 参考链接\n\n- [10个常见的Node.js面试题](http://wwsun.github.io/posts/nodejs-interview-questions.html)\n- [XSS - Stealing Cookies 101](http://jehiah.cz/a/xss-stealing-cookies-101)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/04/10/nodejs-interview-2017.md","raw":"---\ntitle: Node.js面试题之2017\n\ndate: 2017-04-10 12:00:00\n\ntags: [Node.js, 翻译]\n---\n\n**译者按:** 从**ECMAScript标准**，**Node.js语法**以及**NPM模块**角度来看，Node.js的发展让人目不暇接，那么面试题也得与时俱进。\n\n\n<!-- more -->\n\n原文: [Node.js Interview Questions and Answers (2017 Edition)](https://blog.risingstack.com/node-js-interview-questions-and-answers-2017/)\n\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\n### 问题\n\n- 什么是错误优先的回调函数？\n- 如何避免回调地狱？\n- 什么是Promise?\n- 用什么工具保证一致的代码风格？为什么要这样？\n- 什么是Stub?举例说明\n- 什么是测试金字塔？举例说明\n- 最喜欢哪个HTTP框架？为什么？\n- Cookies如何防范XSS攻击？\n- 如何保证依赖的安全性？\n\n### 答案\n\n#### 1. 什么是错误优先的回调函数？\n\n错误优先的回调函数(Error-First Callback)用于同时返回错误和数据。第一个参数返回错误，并且验证它是否出错；其他参数用于返回数据。\n\n```javascript\nfs.readFile(filePath, function(err, data)\n{\n    if (err)\n    {\n        // 处理错误\n        return console.log(err);\n    }\n    console.log(data);\n});\n```\n\n#### 2. 如何避免回调地狱？\n\n以下方式可以避免回调地狱:\n\n- 模块化: 将回调函数转换为独立的函数\n- 使用流程控制库，例如[aync](https://www.npmjs.com/package/async)\n- 使用Promise\n- 使用aync/await(参考[Async/Await替代Promise的6个理由](https://blog.fundebug.com/2017/04/04/nodejs-async-await/))\n\n#### 3. 什么是Promise?\n\nPromise可以帮助我们更好地处理异步操作。下面的示例中，100ms后会打印result字符串。**catch**用于错误处理。多个Promise可以链接起来。\n\n```javascript\nnew Promise((resolve, reject) =>\n    {\n        setTimeout(() =>\n        {\n            resolve('result');\n        }, 100)\n    })\n    .then(console.log)\n    .catch(console.error);\n```\n\n#### 4. 用什么工具保证一致的代码风格？为什么要这样？\n\n团队协作时，保证一致的代码风格是非常重要的，这样团队成员才可以更快地修改代码，而不需要每次去适应新的风格。这些工具可以帮助我们:\n\n- [ESLint](http://eslint.org/)\n- [Standard](https://standardjs.com/)\n\n感兴趣的话，可以参考[JavaScript Clean Coding](https://blog.risingstack.com/javascript-clean-coding-best-practices-node-js-at-scale/)\n\n#### 5. 什么是Stub?举例说明\n\nStub用于模拟模块的行为。测试时，Stub可以为函数调用返回模拟的结果。比如说，当我们写文件时，实际上并不需要真正去写。\n\n```javascript\nvar fs = require('fs');\n\nvar writeFileStub = sinon.stub(fs, 'writeFile', function(path, data, cb)\n{\n    return cb(null);\n});\n\nexpect(writeFileStub).to.be.called;\nwriteFileStub.restore();\n```\n\n#### 6. 什么是测试金字塔？举例说明\n\n测试金字塔反映了需要写的**单元测试**、**集成测试**以及**端到端测试**的比例:\n\n<div style=\"text-align: left;\">\n<img style=\"width:30%;\" src=\"nodejs-interview-2017/test_pyramid.png\" />\n</div>\n\n测试HTTP接口时应该是这样的:\n\n- 很多单元测试，分别测试各个模块(依赖需要stub)\n- 较少的集成测试，测试各个模块之间的交互(依赖不能stub)\n- 少量端到端测试，去调用真正地接口(依赖不能stub)\n\n#### 7. 最喜欢哪个HTTP框架？为什么？\n\n这个问题标准答案。需要描述框架的优缺点，这样可以反映开发者对框架的熟悉程度。\n\n#### 8. Cookies如何防范XSS攻击？\n\nXSS(Cross-Site Scripting，跨站脚本攻击)是指攻击者在返回的HTML中插入JavaScript脚本。为了减轻这些攻击，需要在HTTP头部配置**set-cookie**:\n\n- HttpOnly - 这个属性可以防止**cross-site scripting**，因为它会禁止Javascript脚本访问cookie。\n- secure - 这个属性告诉浏览器仅在请求为HTTPS时发送cookie。\n\n结果应该是这样的: **Set-Cookie: sid=<cookie-value>; HttpOnly**. 使用Express的话，[cookie-session](https://github.com/expressjs/cookie-session#cookie-options)默认配置好了。\n\n#### 9. 如何保证依赖的安全性？\n\n编写Node.js应用时，很可能依赖成百上千的模块。例如，使用了Express的话，会直接依赖[27个模块](https://github.com/expressjs/express/blob/master/package.json#L29)。因此，手动检查所有依赖是不现实的。唯一的办法是对依赖进行自动化的安全检查，有这些工具可供选择:\n\n- npm outdated\n- [Trace by RisingStack](https://trace.risingstack.com/)\n- [NSP](https://nodesecurity.io/)\n- [GreenKeeper](https://greenkeeper.io/)\n- [Snyk](https://snyk.io/)\n\n### 附加题\n\n#### 1. 这段代码有什么问题？\n\n```javascript\nnew Promise((resolve, reject) =>\n    {\n        throw new Error('error')\n    })\n    .then(console.log)\n```\n\n\n\n**then**之后没有**catch**。这样的话，错误会被忽略。可以这样解决问题:\n\n```javascript\nnew Promise((resolve, reject) =>\n    {\n        throw new Error('error')\n    })\n    .then(console.log).catch(console.error)\n```\n\n\n\n调试一个大型的项目时，可以使用监控**unhandledRejection**事件来捕获所有未处理的Promise错误:\n\n```javascript\nprocess.on('unhandledRejection', (err) =>\n{\n    console.log(err)\n})\n```\n\n------\n\n### 2. 这段代码有什么问题？\n\n```javascript\nfunction checkApiKey(apiKeyFromDb, apiKeyReceived)\n{\n    if (apiKeyFromDb === apiKeyReceived)\n    {\n        return true\n    }\n    return false\n}\n```\n\n比较密码时，不能泄露任何信息，因此比较必须在固定时间完成。否则，可以使用[timing attacks](https://en.wikipedia.org/wiki/Timing_attack)来攻击你的应用。**为什么会这样呢**?Node.js使用V8引擎，它会从性能角度优化代码。它会逐个比较字符串的字母，一旦发现不匹配时就停止比较。当攻击者的密码更准确时，比较的时间越长。因此，攻击者可以通过比较的时间长短来判断密码的正确性。使用[cryptiles](https://www.npmjs.com/package/cryptiles)可以解决这个问题:\n\n```javascript\nfunction checkApiKey(apiKeyFromDb, apiKeyReceived)\n{\n    return cryptiles.fixedTimeComparison(apiKeyFromDb, apiKeyReceived)\n}\n```\n\n### 3. 这段代码的输出是什么？\n\n```javascript\nPromise.resolve(1)  \n  .then((x) => x + 1)\n  .then((x) => { throw new Error('My Error') })\n  .catch(() => 1)\n  .then((x) => x + 1)\n  .then((x) => console.log(x))\n  .catch(console.error)\n```\n\n答案是2，逐行解释如下:\n\n1. 创建新的Promise，resolve值为1。\n2. x为1，加1之后返回2。\n3. x为2，但是没有用到。抛出一个错误。\n4. 捕获错误，但是没有处理。返回1。\n5. x为1，加1之后返回2。\n6. x为2，打印2。\n7. 不会执行，因为没有错误抛出。\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群: 177654062**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"nodejs-interview-2017/nodejs-qq-group.jpeg\" />\n</div>\n\n### 参考链接\n\n- [10个常见的Node.js面试题](http://wwsun.github.io/posts/nodejs-interview-questions.html)\n- [XSS - Stealing Cookies 101](http://jehiah.cz/a/xss-stealing-cookies-101)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"2017/04/10/nodejs-interview-2017","published":1,"updated":"2017-04-16T14:46:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweoc0032mkfy88st0vf2","content":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> &#x4ECE;<strong>ECMAScript&#x6807;&#x51C6;</strong>&#xFF0C;<strong>Node.js&#x8BED;&#x6CD5;</strong>&#x4EE5;&#x53CA;<strong>NPM&#x6A21;&#x5757;</strong>&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;Node.js&#x7684;&#x53D1;&#x5C55;&#x8BA9;&#x4EBA;&#x76EE;&#x4E0D;&#x6687;&#x63A5;&#xFF0C;&#x90A3;&#x4E48;&#x9762;&#x8BD5;&#x9898;&#x4E5F;&#x5F97;&#x4E0E;&#x65F6;&#x4FF1;&#x8FDB;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x539F;&#x6587;: <a href=\"https://blog.risingstack.com/node-js-interview-questions-and-answers-2017/\" target=\"_blank\" rel=\"external\">Node.js Interview Questions and Answers (2017 Edition)</a></p>\n<p>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<h3 id=\"&#x95EE;&#x9898;\"><a href=\"#&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x95EE;&#x9898;\"></a>&#x95EE;&#x9898;</h3><ul>\n<li>&#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;</li>\n<li>&#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;</li>\n<li>&#x4EC0;&#x4E48;&#x662F;Promise?</li>\n<li>&#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;</li>\n<li>&#x4EC0;&#x4E48;&#x662F;Stub?&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</li>\n<li>&#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</li>\n<li>&#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;</li>\n<li>&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;</li>\n</ul>\n<h3 id=\"&#x7B54;&#x6848;\"><a href=\"#&#x7B54;&#x6848;\" class=\"headerlink\" title=\"&#x7B54;&#x6848;\"></a>&#x7B54;&#x6848;</h3><h4 id=\"1-&#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;\"><a href=\"#1-&#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;\" class=\"headerlink\" title=\"1. &#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;\"></a>1. &#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;</h4><p>&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;(Error-First Callback)&#x7528;&#x4E8E;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x548C;&#x6570;&#x636E;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x4E14;&#x9A8C;&#x8BC1;&#x5B83;&#x662F;&#x5426;&#x51FA;&#x9519;&#xFF1B;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x7528;&#x4E8E;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\">fs.readFile(filePath, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"comment\">// &#x5904;&#x7406;&#x9519;&#x8BEF;</span></div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(data);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;\"><a href=\"#2-&#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;\" class=\"headerlink\" title=\"2. &#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;\"></a>2. &#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;</h4><p>&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;:</p>\n<ul>\n<li>&#x6A21;&#x5757;&#x5316;: &#x5C06;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x8F6C;&#x6362;&#x4E3A;&#x72EC;&#x7ACB;&#x7684;&#x51FD;&#x6570;</li>\n<li>&#x4F7F;&#x7528;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#x5E93;&#xFF0C;&#x4F8B;&#x5982;<a href=\"https://www.npmjs.com/package/async\" target=\"_blank\" rel=\"external\">aync</a></li>\n<li>&#x4F7F;&#x7528;Promise</li>\n<li>&#x4F7F;&#x7528;aync/await(&#x53C2;&#x8003;<a href=\"https://blog.fundebug.com/2017/04/04/nodejs-async-await/\" target=\"_blank\" rel=\"external\">Async/Await&#x66FF;&#x4EE3;Promise&#x7684;6&#x4E2A;&#x7406;&#x7531;</a>)</li>\n</ul>\n<h4 id=\"3-&#x4EC0;&#x4E48;&#x662F;Promise\"><a href=\"#3-&#x4EC0;&#x4E48;&#x662F;Promise\" class=\"headerlink\" title=\"3. &#x4EC0;&#x4E48;&#x662F;Promise?\"></a>3. &#x4EC0;&#x4E48;&#x662F;Promise?</h4><p>Promise&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x66F4;&#x597D;&#x5730;&#x5904;&#x7406;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;100ms&#x540E;&#x4F1A;&#x6253;&#x5370;result&#x5B57;&#x7B26;&#x4E32;&#x3002;<strong>catch</strong>&#x7528;&#x4E8E;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x3002;&#x591A;&#x4E2A;Promise&#x53EF;&#x4EE5;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x3002;</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></div><div class=\"line\">    {</div><div class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span></div><div class=\"line\">        {</div><div class=\"line\">            resolve(<span class=\"string\">&apos;result&apos;</span>);</div><div class=\"line\">        }, <span class=\"number\">100</span>)</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"built_in\">console</span>.log)</div><div class=\"line\">    .catch(<span class=\"built_in\">console</span>.error);</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;\"><a href=\"#4-&#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;\" class=\"headerlink\" title=\"4. &#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;\"></a>4. &#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;</h4><p>&#x56E2;&#x961F;&#x534F;&#x4F5C;&#x65F6;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x56E2;&#x961F;&#x6210;&#x5458;&#x624D;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x6BCF;&#x6B21;&#x53BB;&#x9002;&#x5E94;&#x65B0;&#x7684;&#x98CE;&#x683C;&#x3002;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;:</p>\n<ul>\n<li><a href=\"http://eslint.org/\" target=\"_blank\" rel=\"external\">ESLint</a></li>\n<li><a href=\"https://standardjs.com/\" target=\"_blank\" rel=\"external\">Standard</a></li>\n</ul>\n<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href=\"https://blog.risingstack.com/javascript-clean-coding-best-practices-node-js-at-scale/\" target=\"_blank\" rel=\"external\">JavaScript Clean Coding</a></p>\n<h4 id=\"5-&#x4EC0;&#x4E48;&#x662F;Stub-&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"><a href=\"#5-&#x4EC0;&#x4E48;&#x662F;Stub-&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\" class=\"headerlink\" title=\"5. &#x4EC0;&#x4E48;&#x662F;Stub?&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"></a>5. &#x4EC0;&#x4E48;&#x662F;Stub?&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</h4><p>Stub&#x7528;&#x4E8E;&#x6A21;&#x62DF;&#x6A21;&#x5757;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;Stub&#x53EF;&#x4EE5;&#x4E3A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x6A21;&#x62DF;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5199;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x771F;&#x6B63;&#x53BB;&#x5199;&#x3002;</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;fs&apos;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> writeFileStub = sinon.stub(fs, <span class=\"string\">&apos;writeFile&apos;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path, data, cb</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">return</span> cb(<span class=\"literal\">null</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\">expect(writeFileStub).to.be.called;</div><div class=\"line\">writeFileStub.restore();</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"><a href=\"#6-&#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\" class=\"headerlink\" title=\"6. &#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"></a>6. &#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</h4><p>&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#x53CD;&#x6620;&#x4E86;&#x9700;&#x8981;&#x5199;&#x7684;<strong>&#x5355;&#x5143;&#x6D4B;&#x8BD5;</strong>&#x3001;<strong>&#x96C6;&#x6210;&#x6D4B;&#x8BD5;</strong>&#x4EE5;&#x53CA;<strong>&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;</strong>&#x7684;&#x6BD4;&#x4F8B;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:30%;\" src=\"/2017/04/10/nodejs-interview-2017/test_pyramid.png\"><br></div>\n\n<p>&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;&#x65F6;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<ul>\n<li>&#x5F88;&#x591A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x5206;&#x522B;&#x6D4B;&#x8BD5;&#x5404;&#x4E2A;&#x6A21;&#x5757;(&#x4F9D;&#x8D56;&#x9700;&#x8981;stub)</li>\n<li>&#x8F83;&#x5C11;&#x7684;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#xFF0C;&#x6D4B;&#x8BD5;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;(&#x4F9D;&#x8D56;&#x4E0D;&#x80FD;stub)</li>\n<li>&#x5C11;&#x91CF;&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;&#xFF0C;&#x53BB;&#x8C03;&#x7528;&#x771F;&#x6B63;&#x5730;&#x63A5;&#x53E3;(&#x4F9D;&#x8D56;&#x4E0D;&#x80FD;stub)</li>\n</ul>\n<h4 id=\"7-&#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;\"><a href=\"#7-&#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;\" class=\"headerlink\" title=\"7. &#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;\"></a>7. &#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</h4><p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6807;&#x51C6;&#x7B54;&#x6848;&#x3002;&#x9700;&#x8981;&#x63CF;&#x8FF0;&#x6846;&#x67B6;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x53CD;&#x6620;&#x5F00;&#x53D1;&#x8005;&#x5BF9;&#x6846;&#x67B6;&#x7684;&#x719F;&#x6089;&#x7A0B;&#x5EA6;&#x3002;</p>\n<h4 id=\"8-Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;\"><a href=\"#8-Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;\" class=\"headerlink\" title=\"8. Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;\"></a>8. Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;</h4><p>XSS(Cross-Site Scripting&#xFF0C;&#x8DE8;&#x7AD9;&#x811A;&#x672C;&#x653B;&#x51FB;)&#x662F;&#x6307;&#x653B;&#x51FB;&#x8005;&#x5728;&#x8FD4;&#x56DE;&#x7684;HTML&#x4E2D;&#x63D2;&#x5165;JavaScript&#x811A;&#x672C;&#x3002;&#x4E3A;&#x4E86;&#x51CF;&#x8F7B;&#x8FD9;&#x4E9B;&#x653B;&#x51FB;&#xFF0C;&#x9700;&#x8981;&#x5728;HTTP&#x5934;&#x90E8;&#x914D;&#x7F6E;<strong>set-cookie</strong>:</p>\n<ul>\n<li>HttpOnly - &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x9632;&#x6B62;<strong>cross-site scripting</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x7981;&#x6B62;Javascript&#x811A;&#x672C;&#x8BBF;&#x95EE;cookie&#x3002;</li>\n<li>secure - &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x544A;&#x8BC9;&#x6D4F;&#x89C8;&#x5668;&#x4EC5;&#x5728;&#x8BF7;&#x6C42;&#x4E3A;HTTPS&#x65F6;&#x53D1;&#x9001;cookie&#x3002;</li>\n</ul>\n<p>&#x7ED3;&#x679C;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;: <strong>Set-Cookie: sid=<cookie-value>; HttpOnly</cookie-value></strong>. &#x4F7F;&#x7528;Express&#x7684;&#x8BDD;&#xFF0C;<a href=\"https://github.com/expressjs/cookie-session#cookie-options\" target=\"_blank\" rel=\"external\">cookie-session</a>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x597D;&#x4E86;&#x3002;</p>\n<h4 id=\"9-&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;\"><a href=\"#9-&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;\" class=\"headerlink\" title=\"9. &#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;\"></a>9. &#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;</h4><p>&#x7F16;&#x5199;Node.js&#x5E94;&#x7528;&#x65F6;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x6210;&#x767E;&#x4E0A;&#x5343;&#x7684;&#x6A21;&#x5757;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;Express&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x4F9D;&#x8D56;<a href=\"https://github.com/expressjs/express/blob/master/package.json#L29\" target=\"_blank\" rel=\"external\">27&#x4E2A;&#x6A21;&#x5757;</a>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x624B;&#x52A8;&#x68C0;&#x67E5;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#x3002;&#x552F;&#x4E00;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x5BF9;&#x4F9D;&#x8D56;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x5B89;&#x5168;&#x68C0;&#x67E5;&#xFF0C;&#x6709;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4F9B;&#x9009;&#x62E9;:</p>\n<ul>\n<li>npm outdated</li>\n<li><a href=\"https://trace.risingstack.com/\" target=\"_blank\" rel=\"external\">Trace by RisingStack</a></li>\n<li><a href=\"https://nodesecurity.io/\" target=\"_blank\" rel=\"external\">NSP</a></li>\n<li><a href=\"https://greenkeeper.io/\" target=\"_blank\" rel=\"external\">GreenKeeper</a></li>\n<li><a href=\"https://snyk.io/\" target=\"_blank\" rel=\"external\">Snyk</a></li>\n</ul>\n<h3 id=\"&#x9644;&#x52A0;&#x9898;\"><a href=\"#&#x9644;&#x52A0;&#x9898;\" class=\"headerlink\" title=\"&#x9644;&#x52A0;&#x9898;\"></a>&#x9644;&#x52A0;&#x9898;</h3><h4 id=\"1-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"><a href=\"#1-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\" class=\"headerlink\" title=\"1. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"></a>1. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;error&apos;</span>)</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"built_in\">console</span>.log)</div></pre></td></tr></table></figure>\n<p><strong>then</strong>&#x4E4B;&#x540E;&#x6CA1;&#x6709;<strong>catch</strong>&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x9519;&#x8BEF;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x3002;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x89E3;&#x51B3;&#x95EE;&#x9898;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;error&apos;</span>)</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"built_in\">console</span>.log).catch(<span class=\"built_in\">console</span>.error)</div></pre></td></tr></table></figure>\n<p>&#x8C03;&#x8BD5;&#x4E00;&#x4E2A;&#x5927;&#x578B;&#x7684;&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x76D1;&#x63A7;<strong>unhandledRejection</strong>&#x4E8B;&#x4EF6;&#x6765;&#x6355;&#x83B7;&#x6240;&#x6709;&#x672A;&#x5904;&#x7406;&#x7684;Promise&#x9519;&#x8BEF;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\">process.on(<span class=\"string\">&apos;unhandledRejection&apos;</span>, (err) =&gt;</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err)</div><div class=\"line\">})</div></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"2-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"><a href=\"#2-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\" class=\"headerlink\" title=\"2. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"></a>2. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</h3><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkApiKey</span>(<span class=\"params\">apiKeyFromDb, apiKeyReceived</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (apiKeyFromDb === apiKeyReceived)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x6BD4;&#x8F83;&#x5BC6;&#x7801;&#x65F6;&#xFF0C;&#x4E0D;&#x80FD;&#x6CC4;&#x9732;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x6B64;&#x6BD4;&#x8F83;&#x5FC5;&#x987B;&#x5728;&#x56FA;&#x5B9A;&#x65F6;&#x95F4;&#x5B8C;&#x6210;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://en.wikipedia.org/wiki/Timing_attack\" target=\"_blank\" rel=\"external\">timing attacks</a>&#x6765;&#x653B;&#x51FB;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x3002;<strong>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;</strong>?Node.js&#x4F7F;&#x7528;V8&#x5F15;&#x64CE;&#xFF0C;&#x5B83;&#x4F1A;&#x4ECE;&#x6027;&#x80FD;&#x89D2;&#x5EA6;&#x4F18;&#x5316;&#x4EE3;&#x7801;&#x3002;&#x5B83;&#x4F1A;&#x9010;&#x4E2A;&#x6BD4;&#x8F83;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5B57;&#x6BCD;&#xFF0C;&#x4E00;&#x65E6;&#x53D1;&#x73B0;&#x4E0D;&#x5339;&#x914D;&#x65F6;&#x5C31;&#x505C;&#x6B62;&#x6BD4;&#x8F83;&#x3002;&#x5F53;&#x653B;&#x51FB;&#x8005;&#x7684;&#x5BC6;&#x7801;&#x66F4;&#x51C6;&#x786E;&#x65F6;&#xFF0C;&#x6BD4;&#x8F83;&#x7684;&#x65F6;&#x95F4;&#x8D8A;&#x957F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x7684;&#x65F6;&#x95F4;&#x957F;&#x77ED;&#x6765;&#x5224;&#x65AD;&#x5BC6;&#x7801;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;&#x4F7F;&#x7528;<a href=\"https://www.npmjs.com/package/cryptiles\" target=\"_blank\" rel=\"external\">cryptiles</a>&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkApiKey</span>(<span class=\"params\">apiKeyFromDb, apiKeyReceived</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">return</span> cryptiles.fixedTimeComparison(apiKeyFromDb, apiKeyReceived)</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h3 id=\"3-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;\"><a href=\"#3-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;\" class=\"headerlink\" title=\"3. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;\"></a>3. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h3><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>)  </div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> x + <span class=\"number\">1</span>)</div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> { <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;My Error&apos;</span>) })</div><div class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"number\">1</span>)</div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> x + <span class=\"number\">1</span>)</div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> <span class=\"built_in\">console</span>.log(x))</div><div class=\"line\">  .catch(<span class=\"built_in\">console</span>.error)</div></pre></td></tr></table></figure>\n<p>&#x7B54;&#x6848;&#x662F;2&#xFF0C;&#x9010;&#x884C;&#x89E3;&#x91CA;&#x5982;&#x4E0B;:</p>\n<ol>\n<li>&#x521B;&#x5EFA;&#x65B0;&#x7684;Promise&#xFF0C;resolve&#x503C;&#x4E3A;1&#x3002;</li>\n<li>x&#x4E3A;1&#xFF0C;&#x52A0;1&#x4E4B;&#x540E;&#x8FD4;&#x56DE;2&#x3002;</li>\n<li>x&#x4E3A;2&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x3002;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x3002;</li>\n<li>&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x3002;&#x8FD4;&#x56DE;1&#x3002;</li>\n<li>x&#x4E3A;1&#xFF0C;&#x52A0;1&#x4E4B;&#x540E;&#x8FD4;&#x56DE;2&#x3002;</li>\n<li>x&#x4E3A;2&#xFF0C;&#x6253;&#x5370;2&#x3002;</li>\n<li>&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x9519;&#x8BEF;&#x629B;&#x51FA;&#x3002;</li>\n</ol>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 177654062</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/10/nodejs-interview-2017/nodejs-qq-group.jpeg\"><br></div>\n\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://wwsun.github.io/posts/nodejs-interview-questions.html\" target=\"_blank\" rel=\"external\">10&#x4E2A;&#x5E38;&#x89C1;&#x7684;Node.js&#x9762;&#x8BD5;&#x9898;</a></li>\n<li><a href=\"http://jehiah.cz/a/xss-stealing-cookies-101\" target=\"_blank\" rel=\"external\">XSS - Stealing Cookies 101</a></li>\n</ul>\n","excerpt":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> &#x4ECE;<strong>ECMAScript&#x6807;&#x51C6;</strong>&#xFF0C;<strong>Node.js&#x8BED;&#x6CD5;</strong>&#x4EE5;&#x53CA;<strong>NPM&#x6A21;&#x5757;</strong>&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;Node.js&#x7684;&#x53D1;&#x5C55;&#x8BA9;&#x4EBA;&#x76EE;&#x4E0D;&#x6687;&#x63A5;&#xFF0C;&#x90A3;&#x4E48;&#x9762;&#x8BD5;&#x9898;&#x4E5F;&#x5F97;&#x4E0E;&#x65F6;&#x4FF1;&#x8FDB;&#x3002;</p>","more":"<p>&#x539F;&#x6587;: <a href=\"https://blog.risingstack.com/node-js-interview-questions-and-answers-2017/\">Node.js Interview Questions and Answers (2017 Edition)</a></p>\n<p>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<h3 id=\"&#x95EE;&#x9898;\"><a href=\"#&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x95EE;&#x9898;\"></a>&#x95EE;&#x9898;</h3><ul>\n<li>&#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;</li>\n<li>&#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;</li>\n<li>&#x4EC0;&#x4E48;&#x662F;Promise?</li>\n<li>&#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;</li>\n<li>&#x4EC0;&#x4E48;&#x662F;Stub?&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</li>\n<li>&#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</li>\n<li>&#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;</li>\n<li>&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;</li>\n</ul>\n<h3 id=\"&#x7B54;&#x6848;\"><a href=\"#&#x7B54;&#x6848;\" class=\"headerlink\" title=\"&#x7B54;&#x6848;\"></a>&#x7B54;&#x6848;</h3><h4 id=\"1-&#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;\"><a href=\"#1-&#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;\" class=\"headerlink\" title=\"1. &#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;\"></a>1. &#x4EC0;&#x4E48;&#x662F;&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF1F;</h4><p>&#x9519;&#x8BEF;&#x4F18;&#x5148;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;(Error-First Callback)&#x7528;&#x4E8E;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x548C;&#x6570;&#x636E;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#xFF0C;&#x5E76;&#x4E14;&#x9A8C;&#x8BC1;&#x5B83;&#x662F;&#x5426;&#x51FA;&#x9519;&#xFF1B;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x7528;&#x4E8E;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x3002;</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\">fs.readFile(filePath, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (err)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"comment\">// &#x5904;&#x7406;&#x9519;&#x8BEF;</span></div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(err);</div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(data);</div><div class=\"line\">});</div></pre></td></tr></table></figure>\n<h4 id=\"2-&#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;\"><a href=\"#2-&#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;\" class=\"headerlink\" title=\"2. &#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;\"></a>2. &#x5982;&#x4F55;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF1F;</h4><p>&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x56DE;&#x8C03;&#x5730;&#x72F1;:</p>\n<ul>\n<li>&#x6A21;&#x5757;&#x5316;: &#x5C06;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x8F6C;&#x6362;&#x4E3A;&#x72EC;&#x7ACB;&#x7684;&#x51FD;&#x6570;</li>\n<li>&#x4F7F;&#x7528;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#x5E93;&#xFF0C;&#x4F8B;&#x5982;<a href=\"https://www.npmjs.com/package/async\">aync</a></li>\n<li>&#x4F7F;&#x7528;Promise</li>\n<li>&#x4F7F;&#x7528;aync/await(&#x53C2;&#x8003;<a href=\"https://blog.fundebug.com/2017/04/04/nodejs-async-await/\">Async/Await&#x66FF;&#x4EE3;Promise&#x7684;6&#x4E2A;&#x7406;&#x7531;</a>)</li>\n</ul>\n<h4 id=\"3-&#x4EC0;&#x4E48;&#x662F;Promise\"><a href=\"#3-&#x4EC0;&#x4E48;&#x662F;Promise\" class=\"headerlink\" title=\"3. &#x4EC0;&#x4E48;&#x662F;Promise?\"></a>3. &#x4EC0;&#x4E48;&#x662F;Promise?</h4><p>Promise&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x66F4;&#x597D;&#x5730;&#x5904;&#x7406;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;100ms&#x540E;&#x4F1A;&#x6253;&#x5370;result&#x5B57;&#x7B26;&#x4E32;&#x3002;<strong>catch</strong>&#x7528;&#x4E8E;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x3002;&#x591A;&#x4E2A;Promise&#x53EF;&#x4EE5;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x3002;</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></div><div class=\"line\">    {</div><div class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span></div><div class=\"line\">        {</div><div class=\"line\">            resolve(<span class=\"string\">&apos;result&apos;</span>);</div><div class=\"line\">        }, <span class=\"number\">100</span>)</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"built_in\">console</span>.log)</div><div class=\"line\">    .catch(<span class=\"built_in\">console</span>.error);</div></pre></td></tr></table></figure>\n<h4 id=\"4-&#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;\"><a href=\"#4-&#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;\" class=\"headerlink\" title=\"4. &#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;\"></a>4. &#x7528;&#x4EC0;&#x4E48;&#x5DE5;&#x5177;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#xFF1F;</h4><p>&#x56E2;&#x961F;&#x534F;&#x4F5C;&#x65F6;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E00;&#x81F4;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x56E2;&#x961F;&#x6210;&#x5458;&#x624D;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x6BCF;&#x6B21;&#x53BB;&#x9002;&#x5E94;&#x65B0;&#x7684;&#x98CE;&#x683C;&#x3002;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;:</p>\n<ul>\n<li><a href=\"http://eslint.org/\">ESLint</a></li>\n<li><a href=\"https://standardjs.com/\">Standard</a></li>\n</ul>\n<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href=\"https://blog.risingstack.com/javascript-clean-coding-best-practices-node-js-at-scale/\">JavaScript Clean Coding</a></p>\n<h4 id=\"5-&#x4EC0;&#x4E48;&#x662F;Stub-&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"><a href=\"#5-&#x4EC0;&#x4E48;&#x662F;Stub-&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\" class=\"headerlink\" title=\"5. &#x4EC0;&#x4E48;&#x662F;Stub?&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"></a>5. &#x4EC0;&#x4E48;&#x662F;Stub?&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</h4><p>Stub&#x7528;&#x4E8E;&#x6A21;&#x62DF;&#x6A21;&#x5757;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x6D4B;&#x8BD5;&#x65F6;&#xFF0C;Stub&#x53EF;&#x4EE5;&#x4E3A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x6A21;&#x62DF;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5199;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x771F;&#x6B63;&#x53BB;&#x5199;&#x3002;</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;fs&apos;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> writeFileStub = sinon.stub(fs, <span class=\"string\">&apos;writeFile&apos;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path, data, cb</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">return</span> cb(<span class=\"literal\">null</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\">expect(writeFileStub).to.be.called;</div><div class=\"line\">writeFileStub.restore();</div></pre></td></tr></table></figure>\n<h4 id=\"6-&#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"><a href=\"#6-&#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\" class=\"headerlink\" title=\"6. &#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;\"></a>6. &#x4EC0;&#x4E48;&#x662F;&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#xFF1F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;</h4><p>&#x6D4B;&#x8BD5;&#x91D1;&#x5B57;&#x5854;&#x53CD;&#x6620;&#x4E86;&#x9700;&#x8981;&#x5199;&#x7684;<strong>&#x5355;&#x5143;&#x6D4B;&#x8BD5;</strong>&#x3001;<strong>&#x96C6;&#x6210;&#x6D4B;&#x8BD5;</strong>&#x4EE5;&#x53CA;<strong>&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;</strong>&#x7684;&#x6BD4;&#x4F8B;:</p>\n<div style=\"text-align: left;\"><br><img style=\"width:30%;\" src=\"/2017/04/10/nodejs-interview-2017/test_pyramid.png\"><br></div>\n\n<p>&#x6D4B;&#x8BD5;HTTP&#x63A5;&#x53E3;&#x65F6;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<ul>\n<li>&#x5F88;&#x591A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x5206;&#x522B;&#x6D4B;&#x8BD5;&#x5404;&#x4E2A;&#x6A21;&#x5757;(&#x4F9D;&#x8D56;&#x9700;&#x8981;stub)</li>\n<li>&#x8F83;&#x5C11;&#x7684;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#xFF0C;&#x6D4B;&#x8BD5;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;(&#x4F9D;&#x8D56;&#x4E0D;&#x80FD;stub)</li>\n<li>&#x5C11;&#x91CF;&#x7AEF;&#x5230;&#x7AEF;&#x6D4B;&#x8BD5;&#xFF0C;&#x53BB;&#x8C03;&#x7528;&#x771F;&#x6B63;&#x5730;&#x63A5;&#x53E3;(&#x4F9D;&#x8D56;&#x4E0D;&#x80FD;stub)</li>\n</ul>\n<h4 id=\"7-&#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;\"><a href=\"#7-&#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;\" class=\"headerlink\" title=\"7. &#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;\"></a>7. &#x6700;&#x559C;&#x6B22;&#x54EA;&#x4E2A;HTTP&#x6846;&#x67B6;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</h4><p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6807;&#x51C6;&#x7B54;&#x6848;&#x3002;&#x9700;&#x8981;&#x63CF;&#x8FF0;&#x6846;&#x67B6;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x53CD;&#x6620;&#x5F00;&#x53D1;&#x8005;&#x5BF9;&#x6846;&#x67B6;&#x7684;&#x719F;&#x6089;&#x7A0B;&#x5EA6;&#x3002;</p>\n<h4 id=\"8-Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;\"><a href=\"#8-Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;\" class=\"headerlink\" title=\"8. Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;\"></a>8. Cookies&#x5982;&#x4F55;&#x9632;&#x8303;XSS&#x653B;&#x51FB;&#xFF1F;</h4><p>XSS(Cross-Site Scripting&#xFF0C;&#x8DE8;&#x7AD9;&#x811A;&#x672C;&#x653B;&#x51FB;)&#x662F;&#x6307;&#x653B;&#x51FB;&#x8005;&#x5728;&#x8FD4;&#x56DE;&#x7684;HTML&#x4E2D;&#x63D2;&#x5165;JavaScript&#x811A;&#x672C;&#x3002;&#x4E3A;&#x4E86;&#x51CF;&#x8F7B;&#x8FD9;&#x4E9B;&#x653B;&#x51FB;&#xFF0C;&#x9700;&#x8981;&#x5728;HTTP&#x5934;&#x90E8;&#x914D;&#x7F6E;<strong>set-cookie</strong>:</p>\n<ul>\n<li>HttpOnly - &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x53EF;&#x4EE5;&#x9632;&#x6B62;<strong>cross-site scripting</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x7981;&#x6B62;Javascript&#x811A;&#x672C;&#x8BBF;&#x95EE;cookie&#x3002;</li>\n<li>secure - &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x544A;&#x8BC9;&#x6D4F;&#x89C8;&#x5668;&#x4EC5;&#x5728;&#x8BF7;&#x6C42;&#x4E3A;HTTPS&#x65F6;&#x53D1;&#x9001;cookie&#x3002;</li>\n</ul>\n<p>&#x7ED3;&#x679C;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;: <strong>Set-Cookie: sid=<cookie-value>; HttpOnly</cookie-value></strong>. &#x4F7F;&#x7528;Express&#x7684;&#x8BDD;&#xFF0C;<a href=\"https://github.com/expressjs/cookie-session#cookie-options\">cookie-session</a>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x597D;&#x4E86;&#x3002;</p>\n<h4 id=\"9-&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;\"><a href=\"#9-&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;\" class=\"headerlink\" title=\"9. &#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;\"></a>9. &#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF1F;</h4><p>&#x7F16;&#x5199;Node.js&#x5E94;&#x7528;&#x65F6;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F9D;&#x8D56;&#x6210;&#x767E;&#x4E0A;&#x5343;&#x7684;&#x6A21;&#x5757;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;Express&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x4F9D;&#x8D56;<a href=\"https://github.com/expressjs/express/blob/master/package.json#L29\">27&#x4E2A;&#x6A21;&#x5757;</a>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x624B;&#x52A8;&#x68C0;&#x67E5;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x662F;&#x4E0D;&#x73B0;&#x5B9E;&#x7684;&#x3002;&#x552F;&#x4E00;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x5BF9;&#x4F9D;&#x8D56;&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x5316;&#x7684;&#x5B89;&#x5168;&#x68C0;&#x67E5;&#xFF0C;&#x6709;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4F9B;&#x9009;&#x62E9;:</p>\n<ul>\n<li>npm outdated</li>\n<li><a href=\"https://trace.risingstack.com/\">Trace by RisingStack</a></li>\n<li><a href=\"https://nodesecurity.io/\">NSP</a></li>\n<li><a href=\"https://greenkeeper.io/\">GreenKeeper</a></li>\n<li><a href=\"https://snyk.io/\">Snyk</a></li>\n</ul>\n<h3 id=\"&#x9644;&#x52A0;&#x9898;\"><a href=\"#&#x9644;&#x52A0;&#x9898;\" class=\"headerlink\" title=\"&#x9644;&#x52A0;&#x9898;\"></a>&#x9644;&#x52A0;&#x9898;</h3><h4 id=\"1-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"><a href=\"#1-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\" class=\"headerlink\" title=\"1. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"></a>1. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</h4><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;error&apos;</span>)</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"built_in\">console</span>.log)</div></pre></td></tr></table></figure>\n<p><strong>then</strong>&#x4E4B;&#x540E;&#x6CA1;&#x6709;<strong>catch</strong>&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x9519;&#x8BEF;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x3002;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x89E3;&#x51B3;&#x95EE;&#x9898;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span></div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;error&apos;</span>)</div><div class=\"line\">    })</div><div class=\"line\">    .then(<span class=\"built_in\">console</span>.log).catch(<span class=\"built_in\">console</span>.error)</div></pre></td></tr></table></figure>\n<p>&#x8C03;&#x8BD5;&#x4E00;&#x4E2A;&#x5927;&#x578B;&#x7684;&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x76D1;&#x63A7;<strong>unhandledRejection</strong>&#x4E8B;&#x4EF6;&#x6765;&#x6355;&#x83B7;&#x6240;&#x6709;&#x672A;&#x5904;&#x7406;&#x7684;Promise&#x9519;&#x8BEF;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\">process.on(<span class=\"string\">&apos;unhandledRejection&apos;</span>, (err) =&gt;</div><div class=\"line\">{</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(err)</div><div class=\"line\">})</div></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"2-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"><a href=\"#2-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\" class=\"headerlink\" title=\"2. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;\"></a>2. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;</h3><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkApiKey</span>(<span class=\"params\">apiKeyFromDb, apiKeyReceived</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">if</span> (apiKeyFromDb === apiKeyReceived)</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></div><div class=\"line\">    }</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<p>&#x6BD4;&#x8F83;&#x5BC6;&#x7801;&#x65F6;&#xFF0C;&#x4E0D;&#x80FD;&#x6CC4;&#x9732;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x6B64;&#x6BD4;&#x8F83;&#x5FC5;&#x987B;&#x5728;&#x56FA;&#x5B9A;&#x65F6;&#x95F4;&#x5B8C;&#x6210;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<a href=\"https://en.wikipedia.org/wiki/Timing_attack\">timing attacks</a>&#x6765;&#x653B;&#x51FB;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x3002;<strong>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;</strong>?Node.js&#x4F7F;&#x7528;V8&#x5F15;&#x64CE;&#xFF0C;&#x5B83;&#x4F1A;&#x4ECE;&#x6027;&#x80FD;&#x89D2;&#x5EA6;&#x4F18;&#x5316;&#x4EE3;&#x7801;&#x3002;&#x5B83;&#x4F1A;&#x9010;&#x4E2A;&#x6BD4;&#x8F83;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5B57;&#x6BCD;&#xFF0C;&#x4E00;&#x65E6;&#x53D1;&#x73B0;&#x4E0D;&#x5339;&#x914D;&#x65F6;&#x5C31;&#x505C;&#x6B62;&#x6BD4;&#x8F83;&#x3002;&#x5F53;&#x653B;&#x51FB;&#x8005;&#x7684;&#x5BC6;&#x7801;&#x66F4;&#x51C6;&#x786E;&#x65F6;&#xFF0C;&#x6BD4;&#x8F83;&#x7684;&#x65F6;&#x95F4;&#x8D8A;&#x957F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x7684;&#x65F6;&#x95F4;&#x957F;&#x77ED;&#x6765;&#x5224;&#x65AD;&#x5BC6;&#x7801;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;&#x4F7F;&#x7528;<a href=\"https://www.npmjs.com/package/cryptiles\">cryptiles</a>&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkApiKey</span>(<span class=\"params\">apiKeyFromDb, apiKeyReceived</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    <span class=\"keyword\">return</span> cryptiles.fixedTimeComparison(apiKeyFromDb, apiKeyReceived)</div><div class=\"line\">}</div></pre></td></tr></table></figure>\n<h3 id=\"3-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;\"><a href=\"#3-&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;\" class=\"headerlink\" title=\"3. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;\"></a>3. &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h3><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">Promise</span>.resolve(<span class=\"number\">1</span>)  </div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> x + <span class=\"number\">1</span>)</div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> { <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&apos;My Error&apos;</span>) })</div><div class=\"line\">  .catch(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"number\">1</span>)</div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> x + <span class=\"number\">1</span>)</div><div class=\"line\">  .then(<span class=\"function\">(<span class=\"params\">x</span>) =&gt;</span> <span class=\"built_in\">console</span>.log(x))</div><div class=\"line\">  .catch(<span class=\"built_in\">console</span>.error)</div></pre></td></tr></table></figure>\n<p>&#x7B54;&#x6848;&#x662F;2&#xFF0C;&#x9010;&#x884C;&#x89E3;&#x91CA;&#x5982;&#x4E0B;:</p>\n<ol>\n<li>&#x521B;&#x5EFA;&#x65B0;&#x7684;Promise&#xFF0C;resolve&#x503C;&#x4E3A;1&#x3002;</li>\n<li>x&#x4E3A;1&#xFF0C;&#x52A0;1&#x4E4B;&#x540E;&#x8FD4;&#x56DE;2&#x3002;</li>\n<li>x&#x4E3A;2&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x3002;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x3002;</li>\n<li>&#x6355;&#x83B7;&#x9519;&#x8BEF;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x3002;&#x8FD4;&#x56DE;1&#x3002;</li>\n<li>x&#x4E3A;1&#xFF0C;&#x52A0;1&#x4E4B;&#x540E;&#x8FD4;&#x56DE;2&#x3002;</li>\n<li>x&#x4E3A;2&#xFF0C;&#x6253;&#x5370;2&#x3002;</li>\n<li>&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x9519;&#x8BEF;&#x629B;&#x51FA;&#x3002;</li>\n</ol>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 177654062</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/10/nodejs-interview-2017/nodejs-qq-group.jpeg\"><br></div>\n\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"http://wwsun.github.io/posts/nodejs-interview-questions.html\">10&#x4E2A;&#x5E38;&#x89C1;&#x7684;Node.js&#x9762;&#x8BD5;&#x9898;</a></li>\n<li><a href=\"http://jehiah.cz/a/xss-stealing-cookies-101\">XSS - Stealing Cookies 101</a></li>\n</ul>"},{"title":"谁用光了磁盘？Docker System命令详解","date":"2017-04-18T13:00:00.000Z","_content":"\n**译者按:** Docker镜像，容器，数据卷以及网络都会占用主机的磁盘空间，这样的话，磁盘很容易就会被用完。这篇博客介绍了一个简单的解决方案 - **Docker System命令**。\n\n<!-- more -->\n\n原文: [What’s eating my disk? Docker System Commands explained](https://cntnr.io/whats-eating-my-disk-docker-system-commands-explained-d778178f96f1)\n\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\n用了一段时间Docker后，会发现它占用了不少硬盘空间。还好[Docker 1.13](https://blog.docker.com/2017/01/whats-new-in-docker-1-13/)引入了解决方法，它提供了简单的命令来查看/清理Docker使用的磁盘空间。\n\n本文通过一个简单的示例，可以证明Docker能够很快地将磁盘占满。该示例通过[play-with-docker.com](https://cntnr.io/building-a-0-docker-swarm-in-seconds-80bf13a4d0a7)运行。点击**Add new instance**即可创建新的实例，该实例安装了最新版的Docker 17.03。这篇博客主要讨论磁盘空间，那么不妨使用df命令查看磁盘的初始状态:\n\n```bash\n$ df -h\nFilesystem           Size       Used Available Use% Mounted on\n/dev/mapper/...      10.0G    443.3M      9.6G   4% /\ntmpfs                60.0G         0     60.0G   0% /dev\ntmpfs                60.0G         0     60.0G   0% /sys/fs/cgroup\n/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/resolv.conf\n/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hostname\n/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hosts\nshm                  64.0M         0     64.0M   0% /dev/shm\n/dev/mapper/...      10.0G    443.3M      9.6G   4% /graph/overlay2\n```\n\n可知，在新创建的[play-with-docker.com](http://labs.play-with-docker.com/)实例，一共有10GB磁盘空间，其中接近500MB已被占用。\n\n接下来编写Dockerfile来创建一个镜像。这个镜像基于**Alpine镜像**；镜像将写入3个随机的文件，每个文件1GB，文件由**dd**命令生成；因为这个镜像并没有实际作用，因此**CMD**设为**/bin/true**。\n\n```dockerfile\nFROM alpine\nRUN dd if=/dev/zero of=1g1.img bs=1G count=1\nRUN dd if=/dev/zero of=1g2.img bs=1G count=1\nRUN dd if=/dev/zero of=1g3.img bs=1G count=1\nCMD /bin/true\n```\n\n运行**docker build -t test .**即可创建镜像，执行完成后将生成一个3GB的镜像。\n\n```bash\n$ docker image ls\nREPOSITORY          TAG                CREATED             SIZE\ntest                latest             38 seconds ago      3.23GB\nalpine              latest             5 weeks ago         3.99MB\n```\n\n不难理解，该镜像占用了相应大小的磁盘空间。\n\n```bash\n$ df -h\nFilesystem        Size       Used Available Use% Mounted on\n/dev/mapper/...   10.0G      3.4G      6.5G  34% /\n```\n\n若只写入2个随机文件，则需要修改Dockerfile，删掉一行。为了避免[构建镜像时使用缓存](https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/#build-cache)，我在dd命令之前添加了一行echo命令。\n\n```bash\nFROM alpine\nRUN echo foo\nRUN dd if=/dev/zero of=1g1.img bs=1G count=1\nRUN dd if=/dev/zero of=1g2.img bs=1G count=1\n# RUN dd if=/dev/zero of=1g3.img bs=1G count=1\nCMD /bin/true\n```\n\n本来以为这样可以节省1GB磁盘空间，然而实际情况更加糟糕！\n\n```bash\n$ df -h\nFilesystem        Size       Used Available Use% Mounted on\n/dev/mapper/...   10.0G      5.4G      4.5G  54% /\n```\n\n旧的Docker镜像一直存在，最终磁盘空间会很快被用完。Docker 1.13引入了**docker system df**命令，类似于Linux上的df命令，用于查看Docker的磁盘使用情况。\n\n```bash\n$ docker system df\nTYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE\nImages              3         0         5.373GB       5.373GB (100%)\nContainers          0         0         0B            0B\nLocal Volumes       0         0         0B            0B\n```\n\n可知，实例上一共有3个Docker镜像: apline镜像，包含3个1GB随机文件的镜像以及包含2个1GB随机文件的镜像。这些镜像占用了超过5GB磁盘空间。由于我们并没有基于这些镜像运行容器，所以它们都可以被删除，所以可回收的(RECLAIMABLE)磁盘空间为100%。使用**docker run test**运行test镜像再查看:\n\n```bash\n$ docker system df\nTYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE\nImages              3         1         5.373GB       3.225GB (60%)\nContainers          1         0         0B            0B\nLocal Volumes       0         0         0B            0B\n```\n\n现在情况就不同了，我运行了一个容器，它执行**/bin/true**之后就很快退出了。这个容器绑定了test镜像，test镜像被标记为活跃(active)因而不能被删除，这导致可回收的磁盘空间变少了。\n\n现在来清理一下磁盘空间。Docker提供了**docker system prune**，可以用于清理dangling镜像(参考[What are Docker <none>:<none> images?](http://www.projectatomic.io/blog/2015/07/what-are-docker-none-none-images/))和容器，以及失效的数据卷和网络。\n\n```bash\n$ docker system prune\nWARNING! This will remove:\n        - all stopped containers\n        - all volumes not used by at least one container\n        - all networks not used by at least one container\n        - all dangling images\nAre you sure you want to continue? [y/N] y\nDeleted Containers:\n1cdf866157b4a97e151125af3c2a7f186a59b6f63807e2014ce1a00d68f44e1d\nDeleted Images:\ndeleted: sha256:f59bb277...\ndeleted: sha256:695b8e70...\ndeleted: sha256:93b1cceb...\ndeleted: sha256:c74d6bcd...\ndeleted: sha256:df8b9bb1...\ndeleted: sha256:dfe8340f...\ndeleted: sha256:ce1ee654...\nTotal reclaimed space: 3.221GB\n```\n\n根据警告信息可知，这个命令会删除所有关闭的容器以及dangling镜像。示例中，含有3个1GB随机文件的镜像的名称被占用了，名称为<none>:<none>，为dangling镜像，因此会被删除。同时，所有的中间镜像也会被删除。这样的话，一共3GB的磁盘空间被回收了! \n\n更进一步，使用**-a**选项可以做深度清理。这时我们会看到更加严重的WARNING信息:\n\n```bash\n$ docker system prune -a\nWARNING! This will remove:\n        - all stopped containers\n        - all volumes not used by at least one container\n        - all networks not used by at least one container\n        - all images without at least one container associated to them\nAre you sure you want to continue? [y/N] y\nDeleted Images:\nuntagged: test:latest\ndeleted: sha256:c515ebfa2...\ndeleted: sha256:07302c011...\ndeleted: sha256:37c0c6474...\ndeleted: sha256:5cc2b6bc4...\ndeleted: sha256:b283b9c35...\ndeleted: sha256:8a8b9bd8b...\nuntagged: alpine:latest\nuntagged: alpine@sha256:58e1a1bb75db1...\ndeleted: sha256:4a415e366...\ndeleted: sha256:23b9c7b43...\nTotal reclaimed space: 2.151GB\n```\n\n这个命令将清理整个系统，并且只会保留真正在使用的镜像，容器，数据卷以及网络，因此需要格外谨慎。比如，我们不能在生产环境中运行**prune -a**命令，因为一些备用镜像(用于备份，回滚等)有时候需要用到，如果这些镜像被删除了，则运行容器时需要重新下载。\n\n此时，所有未绑定容器的镜像将会被删除。由于第一次**prune**命令删除了所有容器，因此所有镜像(它们没有绑定任何容器)都会被删除。\n\n```bash\n$ df -h\nFilesystem          Size      Used Available Use% Mounted on\n/dev/mapper/...    10.0G    442.5M      9.6G   4% /\n```\n\n现在，已使用的磁盘空间又变成了4%。本文的示例只是冰山一角，因为一旦我们运行了真正的容器，并且使用了Docker数据卷和Docker网络，则磁盘空间将会更快用完。感兴趣的话，可以查看博客最后的视频(不要忘了订阅！)。在视频中，我介绍一个简单的WordPress应用，它由数个容器，数据卷以及网络构成。这个应用可以很快地消耗掉磁盘空间，我将介绍如何处理这个问题。\n\n视频: [What's eating my disk?!Clean up your Docker System](https://youtu.be/G308610YNU4)\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Docker技术交流群: 305097057**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"docker-system-explain/docker.JPG\" />\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/04/18/docker-system-explain.md","raw":"---\ntitle: 谁用光了磁盘？Docker System命令详解\n\ndate: 2017-04-18 21:00:00\n\ntags: [Docker, 翻译]\n\n---\n\n**译者按:** Docker镜像，容器，数据卷以及网络都会占用主机的磁盘空间，这样的话，磁盘很容易就会被用完。这篇博客介绍了一个简单的解决方案 - **Docker System命令**。\n\n<!-- more -->\n\n原文: [What’s eating my disk? Docker System Commands explained](https://cntnr.io/whats-eating-my-disk-docker-system-commands-explained-d778178f96f1)\n\n译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\n用了一段时间Docker后，会发现它占用了不少硬盘空间。还好[Docker 1.13](https://blog.docker.com/2017/01/whats-new-in-docker-1-13/)引入了解决方法，它提供了简单的命令来查看/清理Docker使用的磁盘空间。\n\n本文通过一个简单的示例，可以证明Docker能够很快地将磁盘占满。该示例通过[play-with-docker.com](https://cntnr.io/building-a-0-docker-swarm-in-seconds-80bf13a4d0a7)运行。点击**Add new instance**即可创建新的实例，该实例安装了最新版的Docker 17.03。这篇博客主要讨论磁盘空间，那么不妨使用df命令查看磁盘的初始状态:\n\n```bash\n$ df -h\nFilesystem           Size       Used Available Use% Mounted on\n/dev/mapper/...      10.0G    443.3M      9.6G   4% /\ntmpfs                60.0G         0     60.0G   0% /dev\ntmpfs                60.0G         0     60.0G   0% /sys/fs/cgroup\n/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/resolv.conf\n/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hostname\n/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hosts\nshm                  64.0M         0     64.0M   0% /dev/shm\n/dev/mapper/...      10.0G    443.3M      9.6G   4% /graph/overlay2\n```\n\n可知，在新创建的[play-with-docker.com](http://labs.play-with-docker.com/)实例，一共有10GB磁盘空间，其中接近500MB已被占用。\n\n接下来编写Dockerfile来创建一个镜像。这个镜像基于**Alpine镜像**；镜像将写入3个随机的文件，每个文件1GB，文件由**dd**命令生成；因为这个镜像并没有实际作用，因此**CMD**设为**/bin/true**。\n\n```dockerfile\nFROM alpine\nRUN dd if=/dev/zero of=1g1.img bs=1G count=1\nRUN dd if=/dev/zero of=1g2.img bs=1G count=1\nRUN dd if=/dev/zero of=1g3.img bs=1G count=1\nCMD /bin/true\n```\n\n运行**docker build -t test .**即可创建镜像，执行完成后将生成一个3GB的镜像。\n\n```bash\n$ docker image ls\nREPOSITORY          TAG                CREATED             SIZE\ntest                latest             38 seconds ago      3.23GB\nalpine              latest             5 weeks ago         3.99MB\n```\n\n不难理解，该镜像占用了相应大小的磁盘空间。\n\n```bash\n$ df -h\nFilesystem        Size       Used Available Use% Mounted on\n/dev/mapper/...   10.0G      3.4G      6.5G  34% /\n```\n\n若只写入2个随机文件，则需要修改Dockerfile，删掉一行。为了避免[构建镜像时使用缓存](https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/#build-cache)，我在dd命令之前添加了一行echo命令。\n\n```bash\nFROM alpine\nRUN echo foo\nRUN dd if=/dev/zero of=1g1.img bs=1G count=1\nRUN dd if=/dev/zero of=1g2.img bs=1G count=1\n# RUN dd if=/dev/zero of=1g3.img bs=1G count=1\nCMD /bin/true\n```\n\n本来以为这样可以节省1GB磁盘空间，然而实际情况更加糟糕！\n\n```bash\n$ df -h\nFilesystem        Size       Used Available Use% Mounted on\n/dev/mapper/...   10.0G      5.4G      4.5G  54% /\n```\n\n旧的Docker镜像一直存在，最终磁盘空间会很快被用完。Docker 1.13引入了**docker system df**命令，类似于Linux上的df命令，用于查看Docker的磁盘使用情况。\n\n```bash\n$ docker system df\nTYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE\nImages              3         0         5.373GB       5.373GB (100%)\nContainers          0         0         0B            0B\nLocal Volumes       0         0         0B            0B\n```\n\n可知，实例上一共有3个Docker镜像: apline镜像，包含3个1GB随机文件的镜像以及包含2个1GB随机文件的镜像。这些镜像占用了超过5GB磁盘空间。由于我们并没有基于这些镜像运行容器，所以它们都可以被删除，所以可回收的(RECLAIMABLE)磁盘空间为100%。使用**docker run test**运行test镜像再查看:\n\n```bash\n$ docker system df\nTYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE\nImages              3         1         5.373GB       3.225GB (60%)\nContainers          1         0         0B            0B\nLocal Volumes       0         0         0B            0B\n```\n\n现在情况就不同了，我运行了一个容器，它执行**/bin/true**之后就很快退出了。这个容器绑定了test镜像，test镜像被标记为活跃(active)因而不能被删除，这导致可回收的磁盘空间变少了。\n\n现在来清理一下磁盘空间。Docker提供了**docker system prune**，可以用于清理dangling镜像(参考[What are Docker <none>:<none> images?](http://www.projectatomic.io/blog/2015/07/what-are-docker-none-none-images/))和容器，以及失效的数据卷和网络。\n\n```bash\n$ docker system prune\nWARNING! This will remove:\n        - all stopped containers\n        - all volumes not used by at least one container\n        - all networks not used by at least one container\n        - all dangling images\nAre you sure you want to continue? [y/N] y\nDeleted Containers:\n1cdf866157b4a97e151125af3c2a7f186a59b6f63807e2014ce1a00d68f44e1d\nDeleted Images:\ndeleted: sha256:f59bb277...\ndeleted: sha256:695b8e70...\ndeleted: sha256:93b1cceb...\ndeleted: sha256:c74d6bcd...\ndeleted: sha256:df8b9bb1...\ndeleted: sha256:dfe8340f...\ndeleted: sha256:ce1ee654...\nTotal reclaimed space: 3.221GB\n```\n\n根据警告信息可知，这个命令会删除所有关闭的容器以及dangling镜像。示例中，含有3个1GB随机文件的镜像的名称被占用了，名称为<none>:<none>，为dangling镜像，因此会被删除。同时，所有的中间镜像也会被删除。这样的话，一共3GB的磁盘空间被回收了! \n\n更进一步，使用**-a**选项可以做深度清理。这时我们会看到更加严重的WARNING信息:\n\n```bash\n$ docker system prune -a\nWARNING! This will remove:\n        - all stopped containers\n        - all volumes not used by at least one container\n        - all networks not used by at least one container\n        - all images without at least one container associated to them\nAre you sure you want to continue? [y/N] y\nDeleted Images:\nuntagged: test:latest\ndeleted: sha256:c515ebfa2...\ndeleted: sha256:07302c011...\ndeleted: sha256:37c0c6474...\ndeleted: sha256:5cc2b6bc4...\ndeleted: sha256:b283b9c35...\ndeleted: sha256:8a8b9bd8b...\nuntagged: alpine:latest\nuntagged: alpine@sha256:58e1a1bb75db1...\ndeleted: sha256:4a415e366...\ndeleted: sha256:23b9c7b43...\nTotal reclaimed space: 2.151GB\n```\n\n这个命令将清理整个系统，并且只会保留真正在使用的镜像，容器，数据卷以及网络，因此需要格外谨慎。比如，我们不能在生产环境中运行**prune -a**命令，因为一些备用镜像(用于备份，回滚等)有时候需要用到，如果这些镜像被删除了，则运行容器时需要重新下载。\n\n此时，所有未绑定容器的镜像将会被删除。由于第一次**prune**命令删除了所有容器，因此所有镜像(它们没有绑定任何容器)都会被删除。\n\n```bash\n$ df -h\nFilesystem          Size      Used Available Use% Mounted on\n/dev/mapper/...    10.0G    442.5M      9.6G   4% /\n```\n\n现在，已使用的磁盘空间又变成了4%。本文的示例只是冰山一角，因为一旦我们运行了真正的容器，并且使用了Docker数据卷和Docker网络，则磁盘空间将会更快用完。感兴趣的话，可以查看博客最后的视频(不要忘了订阅！)。在视频中，我介绍一个简单的WordPress应用，它由数个容器，数据卷以及网络构成。这个应用可以很快地消耗掉磁盘空间，我将介绍如何处理这个问题。\n\n视频: [What's eating my disk?!Clean up your Docker System](https://youtu.be/G308610YNU4)\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Docker技术交流群: 305097057**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"docker-system-explain/docker.JPG\" />\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"2017/04/18/docker-system-explain","published":1,"updated":"2017-04-18T11:55:32.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweom0034mkfy1rtkkgmo","content":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> Docker&#x955C;&#x50CF;&#xFF0C;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x636E;&#x5377;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x90FD;&#x4F1A;&#x5360;&#x7528;&#x4E3B;&#x673A;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x78C1;&#x76D8;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x4F1A;&#x88AB;&#x7528;&#x5B8C;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4ECB;&#x7ECD;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848; - <strong>Docker System&#x547D;&#x4EE4;</strong>&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x539F;&#x6587;: <a href=\"https://cntnr.io/whats-eating-my-disk-docker-system-commands-explained-d778178f96f1\" target=\"_blank\" rel=\"external\">What&#x2019;s eating my disk? Docker System Commands explained</a></p>\n<p>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>&#x7528;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;Docker&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x5360;&#x7528;&#x4E86;&#x4E0D;&#x5C11;&#x786C;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x8FD8;&#x597D;<a href=\"https://blog.docker.com/2017/01/whats-new-in-docker-1-13/\" target=\"_blank\" rel=\"external\">Docker 1.13</a>&#x5F15;&#x5165;&#x4E86;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x67E5;&#x770B;/&#x6E05;&#x7406;Docker&#x4F7F;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x672C;&#x6587;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x53EF;&#x4EE5;&#x8BC1;&#x660E;Docker&#x80FD;&#x591F;&#x5F88;&#x5FEB;&#x5730;&#x5C06;&#x78C1;&#x76D8;&#x5360;&#x6EE1;&#x3002;&#x8BE5;&#x793A;&#x4F8B;&#x901A;&#x8FC7;<a href=\"https://cntnr.io/building-a-0-docker-swarm-in-seconds-80bf13a4d0a7\" target=\"_blank\" rel=\"external\">play-with-docker.com</a>&#x8FD0;&#x884C;&#x3002;&#x70B9;&#x51FB;<strong>Add new instance</strong>&#x5373;&#x53EF;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8BE5;&#x5B9E;&#x4F8B;&#x5B89;&#x88C5;&#x4E86;&#x6700;&#x65B0;&#x7248;&#x7684;Docker 17.03&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4E3B;&#x8981;&#x8BA8;&#x8BBA;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x59A8;&#x4F7F;&#x7528;df&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem           Size       Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...      10.0G    443.3M      9.6G   4% /</div><div class=\"line\">tmpfs                60.0G         0     60.0G   0% /dev</div><div class=\"line\">tmpfs                60.0G         0     60.0G   0% /sys/fs/cgroup</div><div class=\"line\">/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/resolv.conf</div><div class=\"line\">/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hostname</div><div class=\"line\">/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hosts</div><div class=\"line\">shm                  64.0M         0     64.0M   0% /dev/shm</div><div class=\"line\">/dev/mapper/...      10.0G    443.3M      9.6G   4% /graph/overlay2</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5728;&#x65B0;&#x521B;&#x5EFA;&#x7684;<a href=\"http://labs.play-with-docker.com/\" target=\"_blank\" rel=\"external\">play-with-docker.com</a>&#x5B9E;&#x4F8B;&#xFF0C;&#x4E00;&#x5171;&#x6709;10GB&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x5176;&#x4E2D;&#x63A5;&#x8FD1;500MB&#x5DF2;&#x88AB;&#x5360;&#x7528;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x7F16;&#x5199;Dockerfile&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x57FA;&#x4E8E;<strong>Alpine&#x955C;&#x50CF;</strong>&#xFF1B;&#x955C;&#x50CF;&#x5C06;&#x5199;&#x5165;3&#x4E2A;&#x968F;&#x673A;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;1GB&#xFF0C;&#x6587;&#x4EF6;&#x7531;<strong>dd</strong>&#x547D;&#x4EE4;&#x751F;&#x6210;&#xFF1B;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x6B64;<strong>CMD</strong>&#x8BBE;&#x4E3A;<strong>/bin/true</strong>&#x3002;</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">FROM</span> alpine</div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> dd <span class=\"keyword\">if</span>=/dev/zero of=1g1.img bs=1G count=1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> dd <span class=\"keyword\">if</span>=/dev/zero of=1g2.img bs=1G count=1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> dd <span class=\"keyword\">if</span>=/dev/zero of=1g3.img bs=1G count=1</span></div><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> /bin/<span class=\"literal\">true</span></span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;<strong>docker build -t test .</strong>&#x5373;&#x53EF;&#x521B;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x5C06;&#x751F;&#x6210;&#x4E00;&#x4E2A;3GB&#x7684;&#x955C;&#x50CF;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker image ls</div><div class=\"line\">REPOSITORY          TAG                CREATED             SIZE</div><div class=\"line\"><span class=\"built_in\">test</span>                latest             38 seconds ago      3.23GB</div><div class=\"line\">alpine              latest             5 weeks ago         3.99MB</div></pre></td></tr></table></figure>\n<p>&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x8BE5;&#x955C;&#x50CF;&#x5360;&#x7528;&#x4E86;&#x76F8;&#x5E94;&#x5927;&#x5C0F;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem        Size       Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...   10.0G      3.4G      6.5G  34% /</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x53EA;&#x5199;&#x5165;2&#x4E2A;&#x968F;&#x673A;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4FEE;&#x6539;Dockerfile&#xFF0C;&#x5220;&#x6389;&#x4E00;&#x884C;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;<a href=\"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/#build-cache\" target=\"_blank\" rel=\"external\">&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</a>&#xFF0C;&#x6211;&#x5728;dd&#x547D;&#x4EE4;&#x4E4B;&#x524D;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x884C;echo&#x547D;&#x4EE4;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">FROM alpine</div><div class=\"line\">RUN <span class=\"built_in\">echo</span> foo</div><div class=\"line\">RUN dd <span class=\"keyword\">if</span>=/dev/zero of=1g1.img bs=1G count=1</div><div class=\"line\">RUN dd <span class=\"keyword\">if</span>=/dev/zero of=1g2.img bs=1G count=1</div><div class=\"line\"><span class=\"comment\"># RUN dd if=/dev/zero of=1g3.img bs=1G count=1</span></div><div class=\"line\">CMD /bin/<span class=\"literal\">true</span></div></pre></td></tr></table></figure>\n<p>&#x672C;&#x6765;&#x4EE5;&#x4E3A;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x8282;&#x7701;1GB&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x800C;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x66F4;&#x52A0;&#x7CDF;&#x7CD5;&#xFF01;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem        Size       Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...   10.0G      5.4G      4.5G  54% /</div></pre></td></tr></table></figure>\n<p>&#x65E7;&#x7684;Docker&#x955C;&#x50CF;&#x4E00;&#x76F4;&#x5B58;&#x5728;&#xFF0C;&#x6700;&#x7EC8;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x4F1A;&#x5F88;&#x5FEB;&#x88AB;&#x7528;&#x5B8C;&#x3002;Docker 1.13&#x5F15;&#x5165;&#x4E86;<strong>docker system df</strong>&#x547D;&#x4EE4;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E0A;&#x7684;df&#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x4E8E;&#x67E5;&#x770B;Docker&#x7684;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system df</div><div class=\"line\">TYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE</div><div class=\"line\">Images              3         0         5.373GB       5.373GB (100%)</div><div class=\"line\">Containers          0         0         0B            0B</div><div class=\"line\">Local Volumes       0         0         0B            0B</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5B9E;&#x4F8B;&#x4E0A;&#x4E00;&#x5171;&#x6709;3&#x4E2A;Docker&#x955C;&#x50CF;: apline&#x955C;&#x50CF;&#xFF0C;&#x5305;&#x542B;3&#x4E2A;1GB&#x968F;&#x673A;&#x6587;&#x4EF6;&#x7684;&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x5305;&#x542B;2&#x4E2A;1GB&#x968F;&#x673A;&#x6587;&#x4EF6;&#x7684;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x5360;&#x7528;&#x4E86;&#x8D85;&#x8FC7;5GB&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x57FA;&#x4E8E;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x56DE;&#x6536;&#x7684;(RECLAIMABLE)&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x4E3A;100%&#x3002;&#x4F7F;&#x7528;<strong>docker run test</strong>&#x8FD0;&#x884C;test&#x955C;&#x50CF;&#x518D;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system df</div><div class=\"line\">TYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE</div><div class=\"line\">Images              3         1         5.373GB       3.225GB (60%)</div><div class=\"line\">Containers          1         0         0B            0B</div><div class=\"line\">Local Volumes       0         0         0B            0B</div></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x60C5;&#x51B5;&#x5C31;&#x4E0D;&#x540C;&#x4E86;&#xFF0C;&#x6211;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x6267;&#x884C;<strong>/bin/true</strong>&#x4E4B;&#x540E;&#x5C31;&#x5F88;&#x5FEB;&#x9000;&#x51FA;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x4E86;test&#x955C;&#x50CF;&#xFF0C;test&#x955C;&#x50CF;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x6D3B;&#x8DC3;(active)&#x56E0;&#x800C;&#x4E0D;&#x80FD;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x8FD9;&#x5BFC;&#x81F4;&#x53EF;&#x56DE;&#x6536;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x53D8;&#x5C11;&#x4E86;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6765;&#x6E05;&#x7406;&#x4E00;&#x4E0B;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;Docker&#x63D0;&#x4F9B;&#x4E86;<strong>docker system prune</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6E05;&#x7406;dangling&#x955C;&#x50CF;(&#x53C2;&#x8003;<a href=\"http://www.projectatomic.io/blog/2015/07/what-are-docker-none-none-images/\" target=\"_blank\" rel=\"external\">What are Docker <none>:<none> images?</none></none></a>)&#x548C;&#x5BB9;&#x5668;&#xFF0C;&#x4EE5;&#x53CA;&#x5931;&#x6548;&#x7684;&#x6570;&#x636E;&#x5377;&#x548C;&#x7F51;&#x7EDC;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system prune</div><div class=\"line\">WARNING! This will remove:</div><div class=\"line\">        - all stopped containers</div><div class=\"line\">        - all volumes not used by at least one container</div><div class=\"line\">        - all networks not used by at least one container</div><div class=\"line\">        - all dangling images</div><div class=\"line\">Are you sure you want to <span class=\"built_in\">continue</span>? [y/N] y</div><div class=\"line\">Deleted Containers:</div><div class=\"line\">1cdf866157b4a97e151125af3c2a7f186a59b6f63807e2014ce1a00d68f44e1d</div><div class=\"line\">Deleted Images:</div><div class=\"line\">deleted: sha256:f59bb277...</div><div class=\"line\">deleted: sha256:695b8e70...</div><div class=\"line\">deleted: sha256:93b1cceb...</div><div class=\"line\">deleted: sha256:c74d6bcd...</div><div class=\"line\">deleted: sha256:df8b9bb1...</div><div class=\"line\">deleted: sha256:dfe8340f...</div><div class=\"line\">deleted: sha256:ce1ee654...</div><div class=\"line\">Total reclaimed space: 3.221GB</div></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x5220;&#x9664;&#x6240;&#x6709;&#x5173;&#x95ED;&#x7684;&#x5BB9;&#x5668;&#x4EE5;&#x53CA;dangling&#x955C;&#x50CF;&#x3002;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x542B;&#x6709;3&#x4E2A;1GB&#x968F;&#x673A;&#x6587;&#x4EF6;&#x7684;&#x955C;&#x50CF;&#x7684;&#x540D;&#x79F0;&#x88AB;&#x5360;&#x7528;&#x4E86;&#xFF0C;&#x540D;&#x79F0;&#x4E3A;<none>:<none>&#xFF0C;&#x4E3A;dangling&#x955C;&#x50CF;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x4E2D;&#x95F4;&#x955C;&#x50CF;&#x4E5F;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x4E00;&#x5171;3GB&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x88AB;&#x56DE;&#x6536;&#x4E86;! </none></none></p>\n<p>&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#xFF0C;&#x4F7F;&#x7528;<strong>-a</strong>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x505A;&#x6DF1;&#x5EA6;&#x6E05;&#x7406;&#x3002;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x66F4;&#x52A0;&#x4E25;&#x91CD;&#x7684;WARNING&#x4FE1;&#x606F;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system prune <span class=\"_\">-a</span></div><div class=\"line\">WARNING! This will remove:</div><div class=\"line\">        - all stopped containers</div><div class=\"line\">        - all volumes not used by at least one container</div><div class=\"line\">        - all networks not used by at least one container</div><div class=\"line\">        - all images without at least one container associated to them</div><div class=\"line\">Are you sure you want to <span class=\"built_in\">continue</span>? [y/N] y</div><div class=\"line\">Deleted Images:</div><div class=\"line\">untagged: <span class=\"built_in\">test</span>:latest</div><div class=\"line\">deleted: sha256:c515ebfa2...</div><div class=\"line\">deleted: sha256:07302c011...</div><div class=\"line\">deleted: sha256:37c0c6474...</div><div class=\"line\">deleted: sha256:5cc2b6bc4...</div><div class=\"line\">deleted: sha256:b283b9c35...</div><div class=\"line\">deleted: sha256:8a8b9bd8b...</div><div class=\"line\">untagged: alpine:latest</div><div class=\"line\">untagged: alpine@sha256:58e1a1bb75db1...</div><div class=\"line\">deleted: sha256:4a415e366...</div><div class=\"line\">deleted: sha256:23b9c7b43...</div><div class=\"line\">Total reclaimed space: 2.151GB</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C06;&#x6E05;&#x7406;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x4F1A;&#x4FDD;&#x7559;&#x771F;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x636E;&#x5377;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x683C;&#x5916;&#x8C28;&#x614E;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x8FD0;&#x884C;<strong>prune -a</strong>&#x547D;&#x4EE4;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E9B;&#x5907;&#x7528;&#x955C;&#x50CF;(&#x7528;&#x4E8E;&#x5907;&#x4EFD;&#xFF0C;&#x56DE;&#x6EDA;&#x7B49;)&#x6709;&#x65F6;&#x5019;&#x9700;&#x8981;&#x7528;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x88AB;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x5219;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x65F6;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#x3002;</p>\n<p>&#x6B64;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x672A;&#x7ED1;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x955C;&#x50CF;&#x5C06;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x7531;&#x4E8E;&#x7B2C;&#x4E00;&#x6B21;<strong>prune</strong>&#x547D;&#x4EE4;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x5BB9;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x955C;&#x50CF;(&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x7ED1;&#x5B9A;&#x4EFB;&#x4F55;&#x5BB9;&#x5668;)&#x90FD;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem          Size      Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...    10.0G    442.5M      9.6G   4% /</div></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#xFF0C;&#x5DF2;&#x4F7F;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x53C8;&#x53D8;&#x6210;&#x4E86;4%&#x3002;&#x672C;&#x6587;&#x7684;&#x793A;&#x4F8B;&#x53EA;&#x662F;&#x51B0;&#x5C71;&#x4E00;&#x89D2;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E86;&#x771F;&#x6B63;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x4E86;Docker&#x6570;&#x636E;&#x5377;&#x548C;Docker&#x7F51;&#x7EDC;&#xFF0C;&#x5219;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x5C06;&#x4F1A;&#x66F4;&#x5FEB;&#x7528;&#x5B8C;&#x3002;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x535A;&#x5BA2;&#x6700;&#x540E;&#x7684;&#x89C6;&#x9891;(&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x8BA2;&#x9605;&#xFF01;)&#x3002;&#x5728;&#x89C6;&#x9891;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;WordPress&#x5E94;&#x7528;&#xFF0C;&#x5B83;&#x7531;&#x6570;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x636E;&#x5377;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x6784;&#x6210;&#x3002;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5730;&#x6D88;&#x8017;&#x6389;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x6211;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x89C6;&#x9891;: <a href=\"https://youtu.be/G308610YNU4\" target=\"_blank\" rel=\"external\">What&#x2019;s eating my disk?!Clean up your Docker System</a></p>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Docker&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 305097057</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/18/docker-system-explain/docker.JPG\"><br></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","excerpt":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> Docker&#x955C;&#x50CF;&#xFF0C;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x636E;&#x5377;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x90FD;&#x4F1A;&#x5360;&#x7528;&#x4E3B;&#x673A;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x78C1;&#x76D8;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x4F1A;&#x88AB;&#x7528;&#x5B8C;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4ECB;&#x7ECD;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848; - <strong>Docker System&#x547D;&#x4EE4;</strong>&#x3002;</p>","more":"<p>&#x539F;&#x6587;: <a href=\"https://cntnr.io/whats-eating-my-disk-docker-system-commands-explained-d778178f96f1\">What&#x2019;s eating my disk? Docker System Commands explained</a></p>\n<p>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\">Fundebug</a></p>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>&#x7528;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;Docker&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x5360;&#x7528;&#x4E86;&#x4E0D;&#x5C11;&#x786C;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x8FD8;&#x597D;<a href=\"https://blog.docker.com/2017/01/whats-new-in-docker-1-13/\">Docker 1.13</a>&#x5F15;&#x5165;&#x4E86;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x67E5;&#x770B;/&#x6E05;&#x7406;Docker&#x4F7F;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;</p>\n<p>&#x672C;&#x6587;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x53EF;&#x4EE5;&#x8BC1;&#x660E;Docker&#x80FD;&#x591F;&#x5F88;&#x5FEB;&#x5730;&#x5C06;&#x78C1;&#x76D8;&#x5360;&#x6EE1;&#x3002;&#x8BE5;&#x793A;&#x4F8B;&#x901A;&#x8FC7;<a href=\"https://cntnr.io/building-a-0-docker-swarm-in-seconds-80bf13a4d0a7\">play-with-docker.com</a>&#x8FD0;&#x884C;&#x3002;&#x70B9;&#x51FB;<strong>Add new instance</strong>&#x5373;&#x53EF;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x8BE5;&#x5B9E;&#x4F8B;&#x5B89;&#x88C5;&#x4E86;&#x6700;&#x65B0;&#x7248;&#x7684;Docker 17.03&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x4E3B;&#x8981;&#x8BA8;&#x8BBA;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x59A8;&#x4F7F;&#x7528;df&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem           Size       Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...      10.0G    443.3M      9.6G   4% /</div><div class=\"line\">tmpfs                60.0G         0     60.0G   0% /dev</div><div class=\"line\">tmpfs                60.0G         0     60.0G   0% /sys/fs/cgroup</div><div class=\"line\">/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/resolv.conf</div><div class=\"line\">/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hostname</div><div class=\"line\">/dev/xvda1           49.1G      3.7G     43.3G   8% /etc/hosts</div><div class=\"line\">shm                  64.0M         0     64.0M   0% /dev/shm</div><div class=\"line\">/dev/mapper/...      10.0G    443.3M      9.6G   4% /graph/overlay2</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5728;&#x65B0;&#x521B;&#x5EFA;&#x7684;<a href=\"http://labs.play-with-docker.com/\">play-with-docker.com</a>&#x5B9E;&#x4F8B;&#xFF0C;&#x4E00;&#x5171;&#x6709;10GB&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x5176;&#x4E2D;&#x63A5;&#x8FD1;500MB&#x5DF2;&#x88AB;&#x5360;&#x7528;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x7F16;&#x5199;Dockerfile&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x57FA;&#x4E8E;<strong>Alpine&#x955C;&#x50CF;</strong>&#xFF1B;&#x955C;&#x50CF;&#x5C06;&#x5199;&#x5165;3&#x4E2A;&#x968F;&#x673A;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;1GB&#xFF0C;&#x6587;&#x4EF6;&#x7531;<strong>dd</strong>&#x547D;&#x4EE4;&#x751F;&#x6210;&#xFF1B;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x6B64;<strong>CMD</strong>&#x8BBE;&#x4E3A;<strong>/bin/true</strong>&#x3002;</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">FROM</span> alpine</div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> dd <span class=\"keyword\">if</span>=/dev/zero of=1g1.img bs=1G count=1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> dd <span class=\"keyword\">if</span>=/dev/zero of=1g2.img bs=1G count=1</span></div><div class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> dd <span class=\"keyword\">if</span>=/dev/zero of=1g3.img bs=1G count=1</span></div><div class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> /bin/<span class=\"literal\">true</span></span></div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;<strong>docker build -t test .</strong>&#x5373;&#x53EF;&#x521B;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x5C06;&#x751F;&#x6210;&#x4E00;&#x4E2A;3GB&#x7684;&#x955C;&#x50CF;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker image ls</div><div class=\"line\">REPOSITORY          TAG                CREATED             SIZE</div><div class=\"line\"><span class=\"built_in\">test</span>                latest             38 seconds ago      3.23GB</div><div class=\"line\">alpine              latest             5 weeks ago         3.99MB</div></pre></td></tr></table></figure>\n<p>&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x8BE5;&#x955C;&#x50CF;&#x5360;&#x7528;&#x4E86;&#x76F8;&#x5E94;&#x5927;&#x5C0F;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem        Size       Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...   10.0G      3.4G      6.5G  34% /</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x53EA;&#x5199;&#x5165;2&#x4E2A;&#x968F;&#x673A;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4FEE;&#x6539;Dockerfile&#xFF0C;&#x5220;&#x6389;&#x4E00;&#x884C;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;<a href=\"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/#build-cache\">&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</a>&#xFF0C;&#x6211;&#x5728;dd&#x547D;&#x4EE4;&#x4E4B;&#x524D;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x884C;echo&#x547D;&#x4EE4;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">FROM alpine</div><div class=\"line\">RUN <span class=\"built_in\">echo</span> foo</div><div class=\"line\">RUN dd <span class=\"keyword\">if</span>=/dev/zero of=1g1.img bs=1G count=1</div><div class=\"line\">RUN dd <span class=\"keyword\">if</span>=/dev/zero of=1g2.img bs=1G count=1</div><div class=\"line\"><span class=\"comment\"># RUN dd if=/dev/zero of=1g3.img bs=1G count=1</span></div><div class=\"line\">CMD /bin/<span class=\"literal\">true</span></div></pre></td></tr></table></figure>\n<p>&#x672C;&#x6765;&#x4EE5;&#x4E3A;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x8282;&#x7701;1GB&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x800C;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x66F4;&#x52A0;&#x7CDF;&#x7CD5;&#xFF01;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem        Size       Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...   10.0G      5.4G      4.5G  54% /</div></pre></td></tr></table></figure>\n<p>&#x65E7;&#x7684;Docker&#x955C;&#x50CF;&#x4E00;&#x76F4;&#x5B58;&#x5728;&#xFF0C;&#x6700;&#x7EC8;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x4F1A;&#x5F88;&#x5FEB;&#x88AB;&#x7528;&#x5B8C;&#x3002;Docker 1.13&#x5F15;&#x5165;&#x4E86;<strong>docker system df</strong>&#x547D;&#x4EE4;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Linux&#x4E0A;&#x7684;df&#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x4E8E;&#x67E5;&#x770B;Docker&#x7684;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system df</div><div class=\"line\">TYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE</div><div class=\"line\">Images              3         0         5.373GB       5.373GB (100%)</div><div class=\"line\">Containers          0         0         0B            0B</div><div class=\"line\">Local Volumes       0         0         0B            0B</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x5B9E;&#x4F8B;&#x4E0A;&#x4E00;&#x5171;&#x6709;3&#x4E2A;Docker&#x955C;&#x50CF;: apline&#x955C;&#x50CF;&#xFF0C;&#x5305;&#x542B;3&#x4E2A;1GB&#x968F;&#x673A;&#x6587;&#x4EF6;&#x7684;&#x955C;&#x50CF;&#x4EE5;&#x53CA;&#x5305;&#x542B;2&#x4E2A;1GB&#x968F;&#x673A;&#x6587;&#x4EF6;&#x7684;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x5360;&#x7528;&#x4E86;&#x8D85;&#x8FC7;5GB&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x57FA;&#x4E8E;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x56DE;&#x6536;&#x7684;(RECLAIMABLE)&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x4E3A;100%&#x3002;&#x4F7F;&#x7528;<strong>docker run test</strong>&#x8FD0;&#x884C;test&#x955C;&#x50CF;&#x518D;&#x67E5;&#x770B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system df</div><div class=\"line\">TYPE                TOTAL     ACTIVE    SIZE          RECLAIMABLE</div><div class=\"line\">Images              3         1         5.373GB       3.225GB (60%)</div><div class=\"line\">Containers          1         0         0B            0B</div><div class=\"line\">Local Volumes       0         0         0B            0B</div></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#x60C5;&#x51B5;&#x5C31;&#x4E0D;&#x540C;&#x4E86;&#xFF0C;&#x6211;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x6267;&#x884C;<strong>/bin/true</strong>&#x4E4B;&#x540E;&#x5C31;&#x5F88;&#x5FEB;&#x9000;&#x51FA;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x7ED1;&#x5B9A;&#x4E86;test&#x955C;&#x50CF;&#xFF0C;test&#x955C;&#x50CF;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;&#x6D3B;&#x8DC3;(active)&#x56E0;&#x800C;&#x4E0D;&#x80FD;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x8FD9;&#x5BFC;&#x81F4;&#x53EF;&#x56DE;&#x6536;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x53D8;&#x5C11;&#x4E86;&#x3002;</p>\n<p>&#x73B0;&#x5728;&#x6765;&#x6E05;&#x7406;&#x4E00;&#x4E0B;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;Docker&#x63D0;&#x4F9B;&#x4E86;<strong>docker system prune</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6E05;&#x7406;dangling&#x955C;&#x50CF;(&#x53C2;&#x8003;<a href=\"http://www.projectatomic.io/blog/2015/07/what-are-docker-none-none-images/\">What are Docker <none>:<none> images?</none></none></a>)&#x548C;&#x5BB9;&#x5668;&#xFF0C;&#x4EE5;&#x53CA;&#x5931;&#x6548;&#x7684;&#x6570;&#x636E;&#x5377;&#x548C;&#x7F51;&#x7EDC;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system prune</div><div class=\"line\">WARNING! This will remove:</div><div class=\"line\">        - all stopped containers</div><div class=\"line\">        - all volumes not used by at least one container</div><div class=\"line\">        - all networks not used by at least one container</div><div class=\"line\">        - all dangling images</div><div class=\"line\">Are you sure you want to <span class=\"built_in\">continue</span>? [y/N] y</div><div class=\"line\">Deleted Containers:</div><div class=\"line\">1cdf866157b4a97e151125af3c2a7f186a59b6f63807e2014ce1a00d68f44e1d</div><div class=\"line\">Deleted Images:</div><div class=\"line\">deleted: sha256:f59bb277...</div><div class=\"line\">deleted: sha256:695b8e70...</div><div class=\"line\">deleted: sha256:93b1cceb...</div><div class=\"line\">deleted: sha256:c74d6bcd...</div><div class=\"line\">deleted: sha256:df8b9bb1...</div><div class=\"line\">deleted: sha256:dfe8340f...</div><div class=\"line\">deleted: sha256:ce1ee654...</div><div class=\"line\">Total reclaimed space: 3.221GB</div></pre></td></tr></table></figure>\n<p>&#x6839;&#x636E;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x53EF;&#x77E5;&#xFF0C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4F1A;&#x5220;&#x9664;&#x6240;&#x6709;&#x5173;&#x95ED;&#x7684;&#x5BB9;&#x5668;&#x4EE5;&#x53CA;dangling&#x955C;&#x50CF;&#x3002;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x542B;&#x6709;3&#x4E2A;1GB&#x968F;&#x673A;&#x6587;&#x4EF6;&#x7684;&#x955C;&#x50CF;&#x7684;&#x540D;&#x79F0;&#x88AB;&#x5360;&#x7528;&#x4E86;&#xFF0C;&#x540D;&#x79F0;&#x4E3A;<none>:<none>&#xFF0C;&#x4E3A;dangling&#x955C;&#x50CF;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x4E2D;&#x95F4;&#x955C;&#x50CF;&#x4E5F;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x4E00;&#x5171;3GB&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x88AB;&#x56DE;&#x6536;&#x4E86;! </none></none></p>\n<p>&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#xFF0C;&#x4F7F;&#x7528;<strong>-a</strong>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x505A;&#x6DF1;&#x5EA6;&#x6E05;&#x7406;&#x3002;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x66F4;&#x52A0;&#x4E25;&#x91CD;&#x7684;WARNING&#x4FE1;&#x606F;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ docker system prune <span class=\"_\">-a</span></div><div class=\"line\">WARNING! This will remove:</div><div class=\"line\">        - all stopped containers</div><div class=\"line\">        - all volumes not used by at least one container</div><div class=\"line\">        - all networks not used by at least one container</div><div class=\"line\">        - all images without at least one container associated to them</div><div class=\"line\">Are you sure you want to <span class=\"built_in\">continue</span>? [y/N] y</div><div class=\"line\">Deleted Images:</div><div class=\"line\">untagged: <span class=\"built_in\">test</span>:latest</div><div class=\"line\">deleted: sha256:c515ebfa2...</div><div class=\"line\">deleted: sha256:07302c011...</div><div class=\"line\">deleted: sha256:37c0c6474...</div><div class=\"line\">deleted: sha256:5cc2b6bc4...</div><div class=\"line\">deleted: sha256:b283b9c35...</div><div class=\"line\">deleted: sha256:8a8b9bd8b...</div><div class=\"line\">untagged: alpine:latest</div><div class=\"line\">untagged: alpine@sha256:58e1a1bb75db1...</div><div class=\"line\">deleted: sha256:4a415e366...</div><div class=\"line\">deleted: sha256:23b9c7b43...</div><div class=\"line\">Total reclaimed space: 2.151GB</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5C06;&#x6E05;&#x7406;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x4F1A;&#x4FDD;&#x7559;&#x771F;&#x6B63;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x636E;&#x5377;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x683C;&#x5916;&#x8C28;&#x614E;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x8FD0;&#x884C;<strong>prune -a</strong>&#x547D;&#x4EE4;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E9B;&#x5907;&#x7528;&#x955C;&#x50CF;(&#x7528;&#x4E8E;&#x5907;&#x4EFD;&#xFF0C;&#x56DE;&#x6EDA;&#x7B49;)&#x6709;&#x65F6;&#x5019;&#x9700;&#x8981;&#x7528;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x88AB;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x5219;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x65F6;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#x3002;</p>\n<p>&#x6B64;&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x672A;&#x7ED1;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x955C;&#x50CF;&#x5C06;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;&#x7531;&#x4E8E;&#x7B2C;&#x4E00;&#x6B21;<strong>prune</strong>&#x547D;&#x4EE4;&#x5220;&#x9664;&#x4E86;&#x6240;&#x6709;&#x5BB9;&#x5668;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x955C;&#x50CF;(&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x7ED1;&#x5B9A;&#x4EFB;&#x4F55;&#x5BB9;&#x5668;)&#x90FD;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ df -h</div><div class=\"line\">Filesystem          Size      Used Available Use% Mounted on</div><div class=\"line\">/dev/mapper/...    10.0G    442.5M      9.6G   4% /</div></pre></td></tr></table></figure>\n<p>&#x73B0;&#x5728;&#xFF0C;&#x5DF2;&#x4F7F;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x53C8;&#x53D8;&#x6210;&#x4E86;4%&#x3002;&#x672C;&#x6587;&#x7684;&#x793A;&#x4F8B;&#x53EA;&#x662F;&#x51B0;&#x5C71;&#x4E00;&#x89D2;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E86;&#x771F;&#x6B63;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x4E86;Docker&#x6570;&#x636E;&#x5377;&#x548C;Docker&#x7F51;&#x7EDC;&#xFF0C;&#x5219;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x5C06;&#x4F1A;&#x66F4;&#x5FEB;&#x7528;&#x5B8C;&#x3002;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x535A;&#x5BA2;&#x6700;&#x540E;&#x7684;&#x89C6;&#x9891;(&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x8BA2;&#x9605;&#xFF01;)&#x3002;&#x5728;&#x89C6;&#x9891;&#x4E2D;&#xFF0C;&#x6211;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;WordPress&#x5E94;&#x7528;&#xFF0C;&#x5B83;&#x7531;&#x6570;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x6570;&#x636E;&#x5377;&#x4EE5;&#x53CA;&#x7F51;&#x7EDC;&#x6784;&#x6210;&#x3002;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x5730;&#x6D88;&#x8017;&#x6389;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x6211;&#x5C06;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>\n<p>&#x89C6;&#x9891;: <a href=\"https://youtu.be/G308610YNU4\">What&#x2019;s eating my disk?!Clean up your Docker System</a></p>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Docker&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 305097057</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/18/docker-system-explain/docker.JPG\"><br></div>"},{"title":"玩转SSH端口转发","date":"2017-04-24T03:00:00.000Z","_content":"\nSSH有三种端口转发模式，**本地端口转发(Local Port Forwarding)**，**远程端口转发(Local Port Forwarding)**以及**动态端口转发(Dynamic Port Forwarding)**。对于本地/远程端口转发，两者的方向恰好相反。**动态端口转发**则可以用于科学上网。\n\n<!-- more -->\n\nSSH端口转发也被称作SSH隧道([SSH Tunnel](http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html))，因为它们都是通过SSH登陆之后，在**SSH客户端**与**SSH服务端**之间建立了一个隧道，从而进行通信。SSH隧道是非常安全的，因为SSH是通过加密传输数据的(SSH全称为Secure Shell)。\n\n在本文所有示例中，本地主机A1为SSH客户端，远程云主机B1为SSH服务端。从A1主机通过SSH登陆B1主机，指定不同的端口转发选项(**-L、-R和-D**)，即可在A1与B1之间建立SSH隧道，从而进行不同的端口转发。\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"ssh-port-forwarding/ssh_tunnel.jpeg\" />\n</div>\n\n### 本地端口转发\n\n#### 应用场景:\n\n> 远程云主机B1运行了一个服务，端口为3000，本地主机A1需要访问这个服务。\n\n示例为一个简单的Node.js服务:\n\n```javascript\nvar http = require('http');\n\nvar server = http.createServer(function(request, response)\n{\n    response.writeHead(200,\n    {\n        \"Content-Type\": \"text/plain\"\n    });\n    response.end(\"Hello Fundebug\\n\");\n});\n\nserver.listen(3000);\n```\n\n假设云主机B1的IP为**103.59.22.17**，则该服务的访问地址为:[http://103.59.22.17:3000](http://103.59.22.17:3000)\n\n#### 为啥需要本地端口转发呢？\n\n> 一般来讲，云主机的防火墙默认只打开了22端口，如果需要访问3000端口的话，需要修改防火墙。为了保证安全，防火墙需要配置允许访问的IP地址。但是，本地公忘IP通常是网络提供商动态分配的，是不断变化的。这样的话，防火墙配置需要经常修改，就会很麻烦。\n\n#### 什么是本地端口转发？\n\n所谓本地端口转发，就是**将发送到本地端口的请求，转发到目标端口**。这样，就可以通过访问本地端口，来访问目标端口的服务。使用**-L**属性，就可以指定需要转发的端口，语法是这样的:\n\n```shell\n-L 本地网卡地址:本地端口:目标地址:目标端口 \n```\n\n通过**本地端口转发**，可以将发送到本地主机A1端口2000的请求，转发到远程云主机B1的3000端口。\n\n```shell\n# 在本地主机A1登陆远程云主机B1，并进行本地端口转发\nssh -L localhost:2000:localhost:3000 root@103.59.22.17\n```\n\n这样，在本地主机A1上可以通过访问[http://localhost:2000](http://localhost:2000)来访问远程云主机B1上的Node.js服务。\n\n```shell\n# 在本地主机A1访问远程云主机B1上的Node.js服务\ncurl http://localhost:2000\nHello Fundebug\n```\n\n实际上，**-L选项**中的**本地网卡地址**是可以省略的，这时表示2000端口绑定了本地主机A1的所有网卡：\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行本地端口转发。2000端口绑定本地所有网卡\nssh -L 2000:localhost:3000 root@103.59.22.17\n```\n\n若本地主机A2能够访问A1，则A2也可以通过A1访问远程远程云主机B1上的Node.js服务。\n\n另外，**-L选项**中的**目标地址**也可以是其他主机的地址。假设远程云主机B2的局域网IP地址为192.168.59.100，则可以这样进行端口转发:\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行本地端口转发。请求被转发到远程云主机B2上\nssh -L 2000:192.168.59.100:3000 root@103.59.22.17\n```\n\n若将Node.js服务运行在远程云主机B2上，则发送到A1主机2000端口的请求，都会被转发到B2主机上。\n\n### 远程端口转发\n\n#### 应用场景:\n\n> 本地主机A1运行了一个服务，端口为3000，远程云主机B1需要访问这个服务。\n\n将前文的Node.js服务运行在本地，在本地就可以通过[http://localhost:3000](http://localhost:3000)访问该服务。\n\n#### 为啥需要远程端口转发呢？\n\n> 通常，本地主机是没有独立的公网IP的，它与同一网络中的主机共享一个IP。没有公网IP，云主机是无法访问本地主机上的服务的。\n\n#### 什么是远程端口转发？\n\n所谓远程端口转发，就是**将发送到远程端口的请求，转发到目标端口**。这样，就可以通过访问远程端口，来访问目标端口的服务。使用**-R**属性，就可以指定需要转发的端口，语法是这样的:\n\n```shell\n-R 远程网卡地址:远程端口:目标地址:目标端口 \n```\n\n这时，通过**远程端口转发**，可以将发送到远程云主机B1端口2000的请求，转发到本地主机A1端口3000。\n\n```shell\n# 在本地主机A1登陆远程云主机B1，并进行远程端口转发\nssh -R localhost:2000:localhost:3000 root@103.59.22.17\n```\n\n这样，在远程云主机A1可以通过访问[http://localhost:2000](http://localhost:2000)来访问本地主机的服务。\n\n```shell\n# 在远程云主机B1访问本地主机A1上的Node.js服务\ncurl http://localhost:2000\nHello Fundebug\n```\n\n同理，**远程网卡地址**可以省略，**目标地址**也可以是其他主机地址。假设本地主机A2的局域网IP地址为192.168.0.100。\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行远程端口转发\nssh -R 2000:192.168.0.100:3000 root@103.59.22.17\n```\n\n若将Node.js服务运行在本地主机A2上，则发送到远程云主机A1端口2000的请求，都会被转发到A2主机上。\n\n### 动态端口转发\n\n#### 应用场景:\n\n> 远程云主机B1运行了多个服务，分别使用了不同端口，本地主机A1需要访问这些服务。\n\n#### 为啥需要动态端口转发呢？\n\n> 一方面，由于防火墙限制，本地主机A1并不能直接访问远程云主机B1上的服务，因此需要进行端口转发；另一方面，为每个端口分别创建本地端口转发非常麻烦。\n\n#### 什么是动态端口转发？\n\n对于**本地端口转发**和**远程端口转发**，都存在两个一一对应的端口，分别位于SSH的客户端和服务端，而**动态端口转发**则只是绑定了一个**本地端口**，而**目标地址:目标端口**则是不固定的。**目标地址:目标端口**是由发起的请求决定的，比如，请求地址为**192.168.1.100:3000**，则通过SSH转发的请求地址也是**192.168.1.100:3000**。\n\n```\n-D 本地网卡地址:本地端口\n```\n\n这时，通过**动态端口转发**，可以将在本地主机A1发起的请求，转发到远程主机B1，而由B1去真正地发起请求。\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行动态端口转发\nssh -D localhost:2000 root@103.59.22.17\n```\n\n而在本地发起的请求，需要由Socket代理([Socket Proxy](https://en.wikipedia.org/wiki/SOCKS))转发到SSH绑定的2000端口。以Firefox浏览器为例，配置Socket代理需要找到**首选项**>**高级**>**网络**>**连接**->**设置**:\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"ssh-port-forwarding/socket_proxy.png\" />\n</div>\n\n这样的话，Firefox浏览器发起的请求都会转发到2000端口，然后通过SSH转发到真正地请求地址。若Node.js服务运行在远程云主机B1上，则在Firefox中访问[localhost:3000](localhost:3000)即可以访问。如果主机B1能够访问外网的话，则可以科学上网…...\n\n### 链式端口转发\n\n**本地端口转发**与**远程端口转发**结合起来使用，可以进行链式转发。假设A主机在公司，B主机在家，C主机为远程云主机。A主机上运行了前文的Node.js服务，需要在B主机上访问该服务。由于A和B不在同一个网络，且A主机没有独立公共IP地址，所以无法直接访问服务。\n\n通过本地端口转发，将发送到B主机3000端口的请求，转发到远程云主机C的2000端口。\n\n```bash\n# 在B主机登陆远程云主机C，并进行本地端口转发\nssh -R localhost:3000:localhost:2000 root@103.59.22.17\n```\n\n通过远程端口转发，将发送到远程云主机C端口2000的请求，转发到A主机的3000端口。\n\n```bash\n# 在A主机登陆远程云主机C，并进行远程端口转发\nssh -R localhost:2000:localhost:3000 root@103.59.22.17\n```\n\n这样，在主机B可以通过访问[http://localhost:3000](http://localhost:3000)来访问主机A上的服务。\n\n```shell\n# 在主机B访问主机A上的服务\ncurl http://localhost:3000\nHello Fundebug\n```\n\n\n\n### 参考链接\n\n- [SSH PortForwarding](https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding?action=fullsearch&value=linkto%3A%22SSH%2FOpenSSH%2FPortForwarding%22&context=180)\n- [SSH隧道的原理和实现](http://www.pchou.info/linux/2015/11/01/ssh-tunnel.html)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/04/24/ssh-port-forwarding.md","raw":"---\ntitle: 玩转SSH端口转发\n\ndate: 2017-04-24 11:00:00\n\ntags: [Linux]\n\n---\n\nSSH有三种端口转发模式，**本地端口转发(Local Port Forwarding)**，**远程端口转发(Local Port Forwarding)**以及**动态端口转发(Dynamic Port Forwarding)**。对于本地/远程端口转发，两者的方向恰好相反。**动态端口转发**则可以用于科学上网。\n\n<!-- more -->\n\nSSH端口转发也被称作SSH隧道([SSH Tunnel](http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html))，因为它们都是通过SSH登陆之后，在**SSH客户端**与**SSH服务端**之间建立了一个隧道，从而进行通信。SSH隧道是非常安全的，因为SSH是通过加密传输数据的(SSH全称为Secure Shell)。\n\n在本文所有示例中，本地主机A1为SSH客户端，远程云主机B1为SSH服务端。从A1主机通过SSH登陆B1主机，指定不同的端口转发选项(**-L、-R和-D**)，即可在A1与B1之间建立SSH隧道，从而进行不同的端口转发。\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"ssh-port-forwarding/ssh_tunnel.jpeg\" />\n</div>\n\n### 本地端口转发\n\n#### 应用场景:\n\n> 远程云主机B1运行了一个服务，端口为3000，本地主机A1需要访问这个服务。\n\n示例为一个简单的Node.js服务:\n\n```javascript\nvar http = require('http');\n\nvar server = http.createServer(function(request, response)\n{\n    response.writeHead(200,\n    {\n        \"Content-Type\": \"text/plain\"\n    });\n    response.end(\"Hello Fundebug\\n\");\n});\n\nserver.listen(3000);\n```\n\n假设云主机B1的IP为**103.59.22.17**，则该服务的访问地址为:[http://103.59.22.17:3000](http://103.59.22.17:3000)\n\n#### 为啥需要本地端口转发呢？\n\n> 一般来讲，云主机的防火墙默认只打开了22端口，如果需要访问3000端口的话，需要修改防火墙。为了保证安全，防火墙需要配置允许访问的IP地址。但是，本地公忘IP通常是网络提供商动态分配的，是不断变化的。这样的话，防火墙配置需要经常修改，就会很麻烦。\n\n#### 什么是本地端口转发？\n\n所谓本地端口转发，就是**将发送到本地端口的请求，转发到目标端口**。这样，就可以通过访问本地端口，来访问目标端口的服务。使用**-L**属性，就可以指定需要转发的端口，语法是这样的:\n\n```shell\n-L 本地网卡地址:本地端口:目标地址:目标端口 \n```\n\n通过**本地端口转发**，可以将发送到本地主机A1端口2000的请求，转发到远程云主机B1的3000端口。\n\n```shell\n# 在本地主机A1登陆远程云主机B1，并进行本地端口转发\nssh -L localhost:2000:localhost:3000 root@103.59.22.17\n```\n\n这样，在本地主机A1上可以通过访问[http://localhost:2000](http://localhost:2000)来访问远程云主机B1上的Node.js服务。\n\n```shell\n# 在本地主机A1访问远程云主机B1上的Node.js服务\ncurl http://localhost:2000\nHello Fundebug\n```\n\n实际上，**-L选项**中的**本地网卡地址**是可以省略的，这时表示2000端口绑定了本地主机A1的所有网卡：\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行本地端口转发。2000端口绑定本地所有网卡\nssh -L 2000:localhost:3000 root@103.59.22.17\n```\n\n若本地主机A2能够访问A1，则A2也可以通过A1访问远程远程云主机B1上的Node.js服务。\n\n另外，**-L选项**中的**目标地址**也可以是其他主机的地址。假设远程云主机B2的局域网IP地址为192.168.59.100，则可以这样进行端口转发:\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行本地端口转发。请求被转发到远程云主机B2上\nssh -L 2000:192.168.59.100:3000 root@103.59.22.17\n```\n\n若将Node.js服务运行在远程云主机B2上，则发送到A1主机2000端口的请求，都会被转发到B2主机上。\n\n### 远程端口转发\n\n#### 应用场景:\n\n> 本地主机A1运行了一个服务，端口为3000，远程云主机B1需要访问这个服务。\n\n将前文的Node.js服务运行在本地，在本地就可以通过[http://localhost:3000](http://localhost:3000)访问该服务。\n\n#### 为啥需要远程端口转发呢？\n\n> 通常，本地主机是没有独立的公网IP的，它与同一网络中的主机共享一个IP。没有公网IP，云主机是无法访问本地主机上的服务的。\n\n#### 什么是远程端口转发？\n\n所谓远程端口转发，就是**将发送到远程端口的请求，转发到目标端口**。这样，就可以通过访问远程端口，来访问目标端口的服务。使用**-R**属性，就可以指定需要转发的端口，语法是这样的:\n\n```shell\n-R 远程网卡地址:远程端口:目标地址:目标端口 \n```\n\n这时，通过**远程端口转发**，可以将发送到远程云主机B1端口2000的请求，转发到本地主机A1端口3000。\n\n```shell\n# 在本地主机A1登陆远程云主机B1，并进行远程端口转发\nssh -R localhost:2000:localhost:3000 root@103.59.22.17\n```\n\n这样，在远程云主机A1可以通过访问[http://localhost:2000](http://localhost:2000)来访问本地主机的服务。\n\n```shell\n# 在远程云主机B1访问本地主机A1上的Node.js服务\ncurl http://localhost:2000\nHello Fundebug\n```\n\n同理，**远程网卡地址**可以省略，**目标地址**也可以是其他主机地址。假设本地主机A2的局域网IP地址为192.168.0.100。\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行远程端口转发\nssh -R 2000:192.168.0.100:3000 root@103.59.22.17\n```\n\n若将Node.js服务运行在本地主机A2上，则发送到远程云主机A1端口2000的请求，都会被转发到A2主机上。\n\n### 动态端口转发\n\n#### 应用场景:\n\n> 远程云主机B1运行了多个服务，分别使用了不同端口，本地主机A1需要访问这些服务。\n\n#### 为啥需要动态端口转发呢？\n\n> 一方面，由于防火墙限制，本地主机A1并不能直接访问远程云主机B1上的服务，因此需要进行端口转发；另一方面，为每个端口分别创建本地端口转发非常麻烦。\n\n#### 什么是动态端口转发？\n\n对于**本地端口转发**和**远程端口转发**，都存在两个一一对应的端口，分别位于SSH的客户端和服务端，而**动态端口转发**则只是绑定了一个**本地端口**，而**目标地址:目标端口**则是不固定的。**目标地址:目标端口**是由发起的请求决定的，比如，请求地址为**192.168.1.100:3000**，则通过SSH转发的请求地址也是**192.168.1.100:3000**。\n\n```\n-D 本地网卡地址:本地端口\n```\n\n这时，通过**动态端口转发**，可以将在本地主机A1发起的请求，转发到远程主机B1，而由B1去真正地发起请求。\n\n```bash\n# 在本地主机A1登陆远程云主机B1，并进行动态端口转发\nssh -D localhost:2000 root@103.59.22.17\n```\n\n而在本地发起的请求，需要由Socket代理([Socket Proxy](https://en.wikipedia.org/wiki/SOCKS))转发到SSH绑定的2000端口。以Firefox浏览器为例，配置Socket代理需要找到**首选项**>**高级**>**网络**>**连接**->**设置**:\n\n<div style=\"text-align: center;\">\n<img style=\"width:60%;\" src=\"ssh-port-forwarding/socket_proxy.png\" />\n</div>\n\n这样的话，Firefox浏览器发起的请求都会转发到2000端口，然后通过SSH转发到真正地请求地址。若Node.js服务运行在远程云主机B1上，则在Firefox中访问[localhost:3000](localhost:3000)即可以访问。如果主机B1能够访问外网的话，则可以科学上网…...\n\n### 链式端口转发\n\n**本地端口转发**与**远程端口转发**结合起来使用，可以进行链式转发。假设A主机在公司，B主机在家，C主机为远程云主机。A主机上运行了前文的Node.js服务，需要在B主机上访问该服务。由于A和B不在同一个网络，且A主机没有独立公共IP地址，所以无法直接访问服务。\n\n通过本地端口转发，将发送到B主机3000端口的请求，转发到远程云主机C的2000端口。\n\n```bash\n# 在B主机登陆远程云主机C，并进行本地端口转发\nssh -R localhost:3000:localhost:2000 root@103.59.22.17\n```\n\n通过远程端口转发，将发送到远程云主机C端口2000的请求，转发到A主机的3000端口。\n\n```bash\n# 在A主机登陆远程云主机C，并进行远程端口转发\nssh -R localhost:2000:localhost:3000 root@103.59.22.17\n```\n\n这样，在主机B可以通过访问[http://localhost:3000](http://localhost:3000)来访问主机A上的服务。\n\n```shell\n# 在主机B访问主机A上的服务\ncurl http://localhost:3000\nHello Fundebug\n```\n\n\n\n### 参考链接\n\n- [SSH PortForwarding](https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding?action=fullsearch&value=linkto%3A%22SSH%2FOpenSSH%2FPortForwarding%22&context=180)\n- [SSH隧道的原理和实现](http://www.pchou.info/linux/2015/11/01/ssh-tunnel.html)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"2017/04/24/ssh-port-forwarding","published":1,"updated":"2017-04-24T02:10:56.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yyweov0036mkfybxbt8toj","content":"<p>SSH&#x6709;&#x4E09;&#x79CD;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x6A21;&#x5F0F;&#xFF0C;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;(Local Port Forwarding)</strong>&#xFF0C;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;(Local Port Forwarding)</strong>&#x4EE5;&#x53CA;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;(Dynamic Port Forwarding)</strong>&#x3002;&#x5BF9;&#x4E8E;&#x672C;&#x5730;/&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x4E24;&#x8005;&#x7684;&#x65B9;&#x5411;&#x6070;&#x597D;&#x76F8;&#x53CD;&#x3002;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x79D1;&#x5B66;&#x4E0A;&#x7F51;&#x3002;</p>\n<a id=\"more\"></a>\n<p>SSH&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x4E5F;&#x88AB;&#x79F0;&#x4F5C;SSH&#x96A7;&#x9053;(<a href=\"http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html\" target=\"_blank\" rel=\"external\">SSH Tunnel</a>)&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x901A;&#x8FC7;SSH&#x767B;&#x9646;&#x4E4B;&#x540E;&#xFF0C;&#x5728;<strong>SSH&#x5BA2;&#x6237;&#x7AEF;</strong>&#x4E0E;<strong>SSH&#x670D;&#x52A1;&#x7AEF;</strong>&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x96A7;&#x9053;&#xFF0C;&#x4ECE;&#x800C;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;SSH&#x96A7;&#x9053;&#x662F;&#x975E;&#x5E38;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;SSH&#x662F;&#x901A;&#x8FC7;&#x52A0;&#x5BC6;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x7684;(SSH&#x5168;&#x79F0;&#x4E3A;Secure Shell)&#x3002;</p>\n<p>&#x5728;&#x672C;&#x6587;&#x6240;&#x6709;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x4E3A;SSH&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E3A;SSH&#x670D;&#x52A1;&#x7AEF;&#x3002;&#x4ECE;A1&#x4E3B;&#x673A;&#x901A;&#x8FC7;SSH&#x767B;&#x9646;B1&#x4E3B;&#x673A;&#xFF0C;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x9009;&#x9879;(<strong>-L&#x3001;-R&#x548C;-D</strong>)&#xFF0C;&#x5373;&#x53EF;&#x5728;A1&#x4E0E;B1&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;SSH&#x96A7;&#x9053;&#xFF0C;&#x4ECE;&#x800C;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/04/24/ssh-port-forwarding/ssh_tunnel.jpeg\"><br></div>\n\n<h3 id=\"&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><h4 id=\"&#x5E94;&#x7528;&#x573A;&#x666F;\"><a href=\"#&#x5E94;&#x7528;&#x573A;&#x666F;\" class=\"headerlink\" title=\"&#x5E94;&#x7528;&#x573A;&#x666F;:\"></a>&#x5E94;&#x7528;&#x573A;&#x666F;:</h4><blockquote>\n<p>&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x7AEF;&#x53E3;&#x4E3A;3000&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>\n</blockquote>\n<p>&#x793A;&#x4F8B;&#x4E3A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;Node.js&#x670D;&#x52A1;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;http&apos;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">request, response</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    response.writeHead(<span class=\"number\">200</span>,</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/plain&quot;</span></div><div class=\"line\">    });</div><div class=\"line\">    response.end(<span class=\"string\">&quot;Hello Fundebug\\n&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\">server.listen(<span class=\"number\">3000</span>);</div></pre></td></tr></table></figure>\n<p>&#x5047;&#x8BBE;&#x4E91;&#x4E3B;&#x673A;B1&#x7684;IP&#x4E3A;<strong>103.59.22.17</strong>&#xFF0C;&#x5219;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#x4E3A;:<a href=\"http://103.59.22.17:3000\" target=\"_blank\" rel=\"external\">http://103.59.22.17:3000</a></p>\n<h4 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;</h4><blockquote>\n<p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x4E91;&#x4E3B;&#x673A;&#x7684;&#x9632;&#x706B;&#x5899;&#x9ED8;&#x8BA4;&#x53EA;&#x6253;&#x5F00;&#x4E86;22&#x7AEF;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x8BBF;&#x95EE;3000&#x7AEF;&#x53E3;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x9632;&#x706B;&#x5899;&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5B89;&#x5168;&#xFF0C;&#x9632;&#x706B;&#x5899;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x7684;IP&#x5730;&#x5740;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x672C;&#x5730;&#x516C;&#x5FD8;IP&#x901A;&#x5E38;&#x662F;&#x7F51;&#x7EDC;&#x63D0;&#x4F9B;&#x5546;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x662F;&#x4E0D;&#x65AD;&#x53D8;&#x5316;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x9700;&#x8981;&#x7ECF;&#x5E38;&#x4FEE;&#x6539;&#xFF0C;&#x5C31;&#x4F1A;&#x5F88;&#x9EBB;&#x70E6;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;</h4><p>&#x6240;&#x8C13;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C31;&#x662F;<strong>&#x5C06;&#x53D1;&#x9001;&#x5230;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#xFF0C;&#x6765;&#x8BBF;&#x95EE;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x7684;&#x670D;&#x52A1;&#x3002;&#x4F7F;&#x7528;<strong>-L</strong>&#x5C5E;&#x6027;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x8F6C;&#x53D1;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8BED;&#x6CD5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">-L &#x672C;&#x5730;&#x7F51;&#x5361;&#x5730;&#x5740;:&#x672C;&#x5730;&#x7AEF;&#x53E3;:&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</div></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x53D1;&#x9001;&#x5230;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x7684;3000&#x7AEF;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</div><div class=\"line\">ssh -L localhost:2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x4E0A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<a href=\"http://localhost:2000\" target=\"_blank\" rel=\"external\">http://localhost:2000</a>&#x6765;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;</div><div class=\"line\">curl http://localhost:2000</div><div class=\"line\">Hello Fundebug</div></pre></td></tr></table></figure>\n<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<strong>-L&#x9009;&#x9879;</strong>&#x4E2D;&#x7684;<strong>&#x672C;&#x5730;&#x7F51;&#x5361;&#x5730;&#x5740;</strong>&#x662F;&#x53EF;&#x4EE5;&#x7701;&#x7565;&#x7684;&#xFF0C;&#x8FD9;&#x65F6;&#x8868;&#x793A;2000&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;&#x4E86;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x7684;&#x6240;&#x6709;&#x7F51;&#x5361;&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x3002;2000&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;&#x672C;&#x5730;&#x6240;&#x6709;&#x7F51;&#x5361;</span></div><div class=\"line\">ssh -L 2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x672C;&#x5730;&#x4E3B;&#x673A;A2&#x80FD;&#x591F;&#x8BBF;&#x95EE;A1&#xFF0C;&#x5219;A2&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;A1&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;<strong>-L&#x9009;&#x9879;</strong>&#x4E2D;&#x7684;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;</strong>&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5176;&#x4ED6;&#x4E3B;&#x673A;&#x7684;&#x5730;&#x5740;&#x3002;&#x5047;&#x8BBE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B2&#x7684;&#x5C40;&#x57DF;&#x7F51;IP&#x5730;&#x5740;&#x4E3A;192.168.59.100&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8FDB;&#x884C;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x3002;&#x8BF7;&#x6C42;&#x88AB;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B2&#x4E0A;</span></div><div class=\"line\">ssh -L 2000:192.168.59.100:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x5C06;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B2&#x4E0A;&#xFF0C;&#x5219;&#x53D1;&#x9001;&#x5230;A1&#x4E3B;&#x673A;2000&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x8F6C;&#x53D1;&#x5230;B2&#x4E3B;&#x673A;&#x4E0A;&#x3002;</p>\n<h3 id=\"&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><h4 id=\"&#x5E94;&#x7528;&#x573A;&#x666F;-1\"><a href=\"#&#x5E94;&#x7528;&#x573A;&#x666F;-1\" class=\"headerlink\" title=\"&#x5E94;&#x7528;&#x573A;&#x666F;:\"></a>&#x5E94;&#x7528;&#x573A;&#x666F;:</h4><blockquote>\n<p>&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x7AEF;&#x53E3;&#x4E3A;3000&#xFF0C;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>\n</blockquote>\n<p>&#x5C06;&#x524D;&#x6587;&#x7684;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x5730;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://localhost:3000\" target=\"_blank\" rel=\"external\">http://localhost:3000</a>&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;</p>\n<h4 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;</h4><blockquote>\n<p>&#x901A;&#x5E38;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x662F;&#x6CA1;&#x6709;&#x72EC;&#x7ACB;&#x7684;&#x516C;&#x7F51;IP&#x7684;&#xFF0C;&#x5B83;&#x4E0E;&#x540C;&#x4E00;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x4E3B;&#x673A;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;IP&#x3002;&#x6CA1;&#x6709;&#x516C;&#x7F51;IP&#xFF0C;&#x4E91;&#x4E3B;&#x673A;&#x662F;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x670D;&#x52A1;&#x7684;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;</h4><p>&#x6240;&#x8C13;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C31;&#x662F;<strong>&#x5C06;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#xFF0C;&#x6765;&#x8BBF;&#x95EE;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x7684;&#x670D;&#x52A1;&#x3002;&#x4F7F;&#x7528;<strong>-R</strong>&#x5C5E;&#x6027;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x8F6C;&#x53D1;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8BED;&#x6CD5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">-R &#x8FDC;&#x7A0B;&#x7F51;&#x5361;&#x5730;&#x5740;:&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;:&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x7AEF;&#x53E3;3000&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</div><div class=\"line\">ssh -R localhost:2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;A1&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<a href=\"http://localhost:2000\" target=\"_blank\" rel=\"external\">http://localhost:2000</a>&#x6765;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;</div><div class=\"line\">curl http://localhost:2000</div><div class=\"line\">Hello Fundebug</div></pre></td></tr></table></figure>\n<p>&#x540C;&#x7406;&#xFF0C;<strong>&#x8FDC;&#x7A0B;&#x7F51;&#x5361;&#x5730;&#x5740;</strong>&#x53EF;&#x4EE5;&#x7701;&#x7565;&#xFF0C;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;</strong>&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5176;&#x4ED6;&#x4E3B;&#x673A;&#x5730;&#x5740;&#x3002;&#x5047;&#x8BBE;&#x672C;&#x5730;&#x4E3B;&#x673A;A2&#x7684;&#x5C40;&#x57DF;&#x7F51;IP&#x5730;&#x5740;&#x4E3A;192.168.0.100&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -R 2000:192.168.0.100:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x5C06;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A2&#x4E0A;&#xFF0C;&#x5219;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;A1&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x8F6C;&#x53D1;&#x5230;A2&#x4E3B;&#x673A;&#x4E0A;&#x3002;</p>\n<h3 id=\"&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><h4 id=\"&#x5E94;&#x7528;&#x573A;&#x666F;-2\"><a href=\"#&#x5E94;&#x7528;&#x573A;&#x666F;-2\" class=\"headerlink\" title=\"&#x5E94;&#x7528;&#x573A;&#x666F;:\"></a>&#x5E94;&#x7528;&#x573A;&#x666F;:</h4><blockquote>\n<p>&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x8FD0;&#x884C;&#x4E86;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E86;&#x4E0D;&#x540C;&#x7AEF;&#x53E3;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;</h4><blockquote>\n<p>&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x7531;&#x4E8E;&#x9632;&#x706B;&#x5899;&#x9650;&#x5236;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x5E76;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x7AEF;&#x53E3;&#x5206;&#x522B;&#x521B;&#x5EFA;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x975E;&#x5E38;&#x9EBB;&#x70E6;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;</h4><p>&#x5BF9;&#x4E8E;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x548C;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x90FD;&#x5B58;&#x5728;&#x4E24;&#x4E2A;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5206;&#x522B;&#x4F4D;&#x4E8E;SSH&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x800C;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x5219;&#x53EA;&#x662F;&#x7ED1;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;</strong>&#xFF0C;&#x800C;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x5219;&#x662F;&#x4E0D;&#x56FA;&#x5B9A;&#x7684;&#x3002;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x662F;&#x7531;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E3A;<strong>192.168.1.100:3000</strong>&#xFF0C;&#x5219;&#x901A;&#x8FC7;SSH&#x8F6C;&#x53D1;&#x7684;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E5F;&#x662F;<strong>192.168.1.100:3000</strong>&#x3002;</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"deletion\">-D &#x672C;&#x5730;&#x7F51;&#x5361;&#x5730;&#x5740;:&#x672C;&#x5730;&#x7AEF;&#x53E3;</span></div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E3B;&#x673A;B1&#xFF0C;&#x800C;&#x7531;B1&#x53BB;&#x771F;&#x6B63;&#x5730;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -D localhost:2000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x800C;&#x5728;&#x672C;&#x5730;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x7531;Socket&#x4EE3;&#x7406;(<a href=\"https://en.wikipedia.org/wiki/SOCKS\" target=\"_blank\" rel=\"external\">Socket Proxy</a>)&#x8F6C;&#x53D1;&#x5230;SSH&#x7ED1;&#x5B9A;&#x7684;2000&#x7AEF;&#x53E3;&#x3002;&#x4EE5;Firefox&#x6D4F;&#x89C8;&#x5668;&#x4E3A;&#x4F8B;&#xFF0C;&#x914D;&#x7F6E;Socket&#x4EE3;&#x7406;&#x9700;&#x8981;&#x627E;&#x5230;<strong>&#x9996;&#x9009;&#x9879;</strong>&gt;<strong>&#x9AD8;&#x7EA7;</strong>&gt;<strong>&#x7F51;&#x7EDC;</strong>&gt;<strong>&#x8FDE;&#x63A5;</strong>-&gt;<strong>&#x8BBE;&#x7F6E;</strong>:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/04/24/ssh-port-forwarding/socket_proxy.png\"><br></div>\n\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;Firefox&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x8F6C;&#x53D1;&#x5230;2000&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;SSH&#x8F6C;&#x53D1;&#x5230;&#x771F;&#x6B63;&#x5730;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x3002;&#x82E5;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#xFF0C;&#x5219;&#x5728;Firefox&#x4E2D;&#x8BBF;&#x95EE;<a href=\"localhost:3000\" target=\"_blank\" rel=\"external\">localhost:3000</a>&#x5373;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;&#x5982;&#x679C;&#x4E3B;&#x673A;B1&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x5916;&#x7F51;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x79D1;&#x5B66;&#x4E0A;&#x7F51;&#x2026;&#x2026;</p>\n<h3 id=\"&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><p><strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x4E0E;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x94FE;&#x5F0F;&#x8F6C;&#x53D1;&#x3002;&#x5047;&#x8BBE;A&#x4E3B;&#x673A;&#x5728;&#x516C;&#x53F8;&#xFF0C;B&#x4E3B;&#x673A;&#x5728;&#x5BB6;&#xFF0C;C&#x4E3B;&#x673A;&#x4E3A;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;&#x3002;A&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x4E86;&#x524D;&#x6587;&#x7684;Node.js&#x670D;&#x52A1;&#xFF0C;&#x9700;&#x8981;&#x5728;B&#x4E3B;&#x673A;&#x4E0A;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;&#x7531;&#x4E8E;A&#x548C;B&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x4E14;A&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x72EC;&#x7ACB;&#x516C;&#x5171;IP&#x5730;&#x5740;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C06;&#x53D1;&#x9001;&#x5230;B&#x4E3B;&#x673A;3000&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#x7684;2000&#x7AEF;&#x53E3;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;B&#x4E3B;&#x673A;&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -R localhost:3000:localhost:2000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C06;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;A&#x4E3B;&#x673A;&#x7684;3000&#x7AEF;&#x53E3;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;A&#x4E3B;&#x673A;&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -R localhost:2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x4E3B;&#x673A;B&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<a href=\"http://localhost:3000\" target=\"_blank\" rel=\"external\">http://localhost:3000</a>&#x6765;&#x8BBF;&#x95EE;&#x4E3B;&#x673A;A&#x4E0A;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x4E3B;&#x673A;B&#x8BBF;&#x95EE;&#x4E3B;&#x673A;A&#x4E0A;&#x7684;&#x670D;&#x52A1;</div><div class=\"line\">curl http://localhost:3000</div><div class=\"line\">Hello Fundebug</div></pre></td></tr></table></figure>\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding?action=fullsearch&amp;value=linkto%3A%22SSH%2FOpenSSH%2FPortForwarding%22&amp;context=180\" target=\"_blank\" rel=\"external\">SSH PortForwarding</a></li>\n<li><a href=\"http://www.pchou.info/linux/2015/11/01/ssh-tunnel.html\" target=\"_blank\" rel=\"external\">SSH&#x96A7;&#x9053;&#x7684;&#x539F;&#x7406;&#x548C;&#x5B9E;&#x73B0;</a></li>\n</ul>\n","excerpt":"<p>SSH&#x6709;&#x4E09;&#x79CD;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x6A21;&#x5F0F;&#xFF0C;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;(Local Port Forwarding)</strong>&#xFF0C;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;(Local Port Forwarding)</strong>&#x4EE5;&#x53CA;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;(Dynamic Port Forwarding)</strong>&#x3002;&#x5BF9;&#x4E8E;&#x672C;&#x5730;/&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x4E24;&#x8005;&#x7684;&#x65B9;&#x5411;&#x6070;&#x597D;&#x76F8;&#x53CD;&#x3002;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x5219;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x79D1;&#x5B66;&#x4E0A;&#x7F51;&#x3002;</p>","more":"<p>SSH&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x4E5F;&#x88AB;&#x79F0;&#x4F5C;SSH&#x96A7;&#x9053;(<a href=\"http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html\">SSH Tunnel</a>)&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x901A;&#x8FC7;SSH&#x767B;&#x9646;&#x4E4B;&#x540E;&#xFF0C;&#x5728;<strong>SSH&#x5BA2;&#x6237;&#x7AEF;</strong>&#x4E0E;<strong>SSH&#x670D;&#x52A1;&#x7AEF;</strong>&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A;&#x96A7;&#x9053;&#xFF0C;&#x4ECE;&#x800C;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x3002;SSH&#x96A7;&#x9053;&#x662F;&#x975E;&#x5E38;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;SSH&#x662F;&#x901A;&#x8FC7;&#x52A0;&#x5BC6;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x7684;(SSH&#x5168;&#x79F0;&#x4E3A;Secure Shell)&#x3002;</p>\n<p>&#x5728;&#x672C;&#x6587;&#x6240;&#x6709;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x4E3A;SSH&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E3A;SSH&#x670D;&#x52A1;&#x7AEF;&#x3002;&#x4ECE;A1&#x4E3B;&#x673A;&#x901A;&#x8FC7;SSH&#x767B;&#x9646;B1&#x4E3B;&#x673A;&#xFF0C;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x9009;&#x9879;(<strong>-L&#x3001;-R&#x548C;-D</strong>)&#xFF0C;&#x5373;&#x53EF;&#x5728;A1&#x4E0E;B1&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;SSH&#x96A7;&#x9053;&#xFF0C;&#x4ECE;&#x800C;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/04/24/ssh-port-forwarding/ssh_tunnel.jpeg\"><br></div>\n\n<h3 id=\"&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><h4 id=\"&#x5E94;&#x7528;&#x573A;&#x666F;\"><a href=\"#&#x5E94;&#x7528;&#x573A;&#x666F;\" class=\"headerlink\" title=\"&#x5E94;&#x7528;&#x573A;&#x666F;:\"></a>&#x5E94;&#x7528;&#x573A;&#x666F;:</h4><blockquote>\n<p>&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x7AEF;&#x53E3;&#x4E3A;3000&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>\n</blockquote>\n<p>&#x793A;&#x4F8B;&#x4E3A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;Node.js&#x670D;&#x52A1;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">&apos;http&apos;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">request, response</span>)</span></div><div class=\"line\">{</div><div class=\"line\">    response.writeHead(<span class=\"number\">200</span>,</div><div class=\"line\">    {</div><div class=\"line\">        <span class=\"string\">&quot;Content-Type&quot;</span>: <span class=\"string\">&quot;text/plain&quot;</span></div><div class=\"line\">    });</div><div class=\"line\">    response.end(<span class=\"string\">&quot;Hello Fundebug\\n&quot;</span>);</div><div class=\"line\">});</div><div class=\"line\"></div><div class=\"line\">server.listen(<span class=\"number\">3000</span>);</div></pre></td></tr></table></figure>\n<p>&#x5047;&#x8BBE;&#x4E91;&#x4E3B;&#x673A;B1&#x7684;IP&#x4E3A;<strong>103.59.22.17</strong>&#xFF0C;&#x5219;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x8BBF;&#x95EE;&#x5730;&#x5740;&#x4E3A;:<a href=\"http://103.59.22.17:3000\">http://103.59.22.17:3000</a></p>\n<h4 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;</h4><blockquote>\n<p>&#x4E00;&#x822C;&#x6765;&#x8BB2;&#xFF0C;&#x4E91;&#x4E3B;&#x673A;&#x7684;&#x9632;&#x706B;&#x5899;&#x9ED8;&#x8BA4;&#x53EA;&#x6253;&#x5F00;&#x4E86;22&#x7AEF;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x8BBF;&#x95EE;3000&#x7AEF;&#x53E3;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x9632;&#x706B;&#x5899;&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5B89;&#x5168;&#xFF0C;&#x9632;&#x706B;&#x5899;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x7684;IP&#x5730;&#x5740;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x672C;&#x5730;&#x516C;&#x5FD8;IP&#x901A;&#x5E38;&#x662F;&#x7F51;&#x7EDC;&#x63D0;&#x4F9B;&#x5546;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x662F;&#x4E0D;&#x65AD;&#x53D8;&#x5316;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;&#x9700;&#x8981;&#x7ECF;&#x5E38;&#x4FEE;&#x6539;&#xFF0C;&#x5C31;&#x4F1A;&#x5F88;&#x9EBB;&#x70E6;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;</h4><p>&#x6240;&#x8C13;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C31;&#x662F;<strong>&#x5C06;&#x53D1;&#x9001;&#x5230;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#xFF0C;&#x6765;&#x8BBF;&#x95EE;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x7684;&#x670D;&#x52A1;&#x3002;&#x4F7F;&#x7528;<strong>-L</strong>&#x5C5E;&#x6027;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x8F6C;&#x53D1;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8BED;&#x6CD5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">-L &#x672C;&#x5730;&#x7F51;&#x5361;&#x5730;&#x5740;:&#x672C;&#x5730;&#x7AEF;&#x53E3;:&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</div></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x53D1;&#x9001;&#x5230;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x7684;3000&#x7AEF;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</div><div class=\"line\">ssh -L localhost:2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x4E0A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<a href=\"http://localhost:2000\">http://localhost:2000</a>&#x6765;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;</div><div class=\"line\">curl http://localhost:2000</div><div class=\"line\">Hello Fundebug</div></pre></td></tr></table></figure>\n<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<strong>-L&#x9009;&#x9879;</strong>&#x4E2D;&#x7684;<strong>&#x672C;&#x5730;&#x7F51;&#x5361;&#x5730;&#x5740;</strong>&#x662F;&#x53EF;&#x4EE5;&#x7701;&#x7565;&#x7684;&#xFF0C;&#x8FD9;&#x65F6;&#x8868;&#x793A;2000&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;&#x4E86;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x7684;&#x6240;&#x6709;&#x7F51;&#x5361;&#xFF1A;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x3002;2000&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;&#x672C;&#x5730;&#x6240;&#x6709;&#x7F51;&#x5361;</span></div><div class=\"line\">ssh -L 2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x672C;&#x5730;&#x4E3B;&#x673A;A2&#x80FD;&#x591F;&#x8BBF;&#x95EE;A1&#xFF0C;&#x5219;A2&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;A1&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x53E6;&#x5916;&#xFF0C;<strong>-L&#x9009;&#x9879;</strong>&#x4E2D;&#x7684;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;</strong>&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5176;&#x4ED6;&#x4E3B;&#x673A;&#x7684;&#x5730;&#x5740;&#x3002;&#x5047;&#x8BBE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B2&#x7684;&#x5C40;&#x57DF;&#x7F51;IP&#x5730;&#x5740;&#x4E3A;192.168.59.100&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8FDB;&#x884C;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x3002;&#x8BF7;&#x6C42;&#x88AB;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B2&#x4E0A;</span></div><div class=\"line\">ssh -L 2000:192.168.59.100:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x5C06;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B2&#x4E0A;&#xFF0C;&#x5219;&#x53D1;&#x9001;&#x5230;A1&#x4E3B;&#x673A;2000&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x8F6C;&#x53D1;&#x5230;B2&#x4E3B;&#x673A;&#x4E0A;&#x3002;</p>\n<h3 id=\"&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><h4 id=\"&#x5E94;&#x7528;&#x573A;&#x666F;-1\"><a href=\"#&#x5E94;&#x7528;&#x573A;&#x666F;-1\" class=\"headerlink\" title=\"&#x5E94;&#x7528;&#x573A;&#x666F;:\"></a>&#x5E94;&#x7528;&#x573A;&#x666F;:</h4><blockquote>\n<p>&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x7AEF;&#x53E3;&#x4E3A;3000&#xFF0C;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>\n</blockquote>\n<p>&#x5C06;&#x524D;&#x6587;&#x7684;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x5730;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href=\"http://localhost:3000\">http://localhost:3000</a>&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;</p>\n<h4 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;</h4><blockquote>\n<p>&#x901A;&#x5E38;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x662F;&#x6CA1;&#x6709;&#x72EC;&#x7ACB;&#x7684;&#x516C;&#x7F51;IP&#x7684;&#xFF0C;&#x5B83;&#x4E0E;&#x540C;&#x4E00;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x4E3B;&#x673A;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;IP&#x3002;&#x6CA1;&#x6709;&#x516C;&#x7F51;IP&#xFF0C;&#x4E91;&#x4E3B;&#x673A;&#x662F;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x670D;&#x52A1;&#x7684;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;</h4><p>&#x6240;&#x8C13;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C31;&#x662F;<strong>&#x5C06;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#xFF0C;&#x6765;&#x8BBF;&#x95EE;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x7684;&#x670D;&#x52A1;&#x3002;&#x4F7F;&#x7528;<strong>-R</strong>&#x5C5E;&#x6027;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x8F6C;&#x53D1;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8BED;&#x6CD5;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">-R &#x8FDC;&#x7A0B;&#x7F51;&#x5361;&#x5730;&#x5740;:&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;:&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x7AEF;&#x53E3;3000&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</div><div class=\"line\">ssh -R localhost:2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;A1&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<a href=\"http://localhost:2000\">http://localhost:2000</a>&#x6765;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x4E3B;&#x673A;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x4E0A;&#x7684;Node.js&#x670D;&#x52A1;</div><div class=\"line\">curl http://localhost:2000</div><div class=\"line\">Hello Fundebug</div></pre></td></tr></table></figure>\n<p>&#x540C;&#x7406;&#xFF0C;<strong>&#x8FDC;&#x7A0B;&#x7F51;&#x5361;&#x5730;&#x5740;</strong>&#x53EF;&#x4EE5;&#x7701;&#x7565;&#xFF0C;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;</strong>&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x5176;&#x4ED6;&#x4E3B;&#x673A;&#x5730;&#x5740;&#x3002;&#x5047;&#x8BBE;&#x672C;&#x5730;&#x4E3B;&#x673A;A2&#x7684;&#x5C40;&#x57DF;&#x7F51;IP&#x5730;&#x5740;&#x4E3A;192.168.0.100&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -R 2000:192.168.0.100:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x82E5;&#x5C06;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A2&#x4E0A;&#xFF0C;&#x5219;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;A1&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x8F6C;&#x53D1;&#x5230;A2&#x4E3B;&#x673A;&#x4E0A;&#x3002;</p>\n<h3 id=\"&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><h4 id=\"&#x5E94;&#x7528;&#x573A;&#x666F;-2\"><a href=\"#&#x5E94;&#x7528;&#x573A;&#x666F;-2\" class=\"headerlink\" title=\"&#x5E94;&#x7528;&#x573A;&#x666F;:\"></a>&#x5E94;&#x7528;&#x573A;&#x666F;:</h4><blockquote>\n<p>&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x8FD0;&#x884C;&#x4E86;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E86;&#x4E0D;&#x540C;&#x7AEF;&#x53E3;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"><a href=\"#&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\" class=\"headerlink\" title=\"&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;\"></a>&#x4E3A;&#x5565;&#x9700;&#x8981;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5462;&#xFF1F;</h4><blockquote>\n<p>&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x7531;&#x4E8E;&#x9632;&#x706B;&#x5899;&#x9650;&#x5236;&#xFF0C;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x5E76;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x7AEF;&#x53E3;&#x5206;&#x522B;&#x521B;&#x5EFA;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x975E;&#x5E38;&#x9EBB;&#x70E6;&#x3002;</p>\n</blockquote>\n<h4 id=\"&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF1F;</h4><p>&#x5BF9;&#x4E8E;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x548C;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x90FD;&#x5B58;&#x5728;&#x4E24;&#x4E2A;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5206;&#x522B;&#x4F4D;&#x4E8E;SSH&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x800C;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x5219;&#x53EA;&#x662F;&#x7ED1;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;<strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;</strong>&#xFF0C;&#x800C;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x5219;&#x662F;&#x4E0D;&#x56FA;&#x5B9A;&#x7684;&#x3002;<strong>&#x76EE;&#x6807;&#x5730;&#x5740;:&#x76EE;&#x6807;&#x7AEF;&#x53E3;</strong>&#x662F;&#x7531;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E3A;<strong>192.168.1.100:3000</strong>&#xFF0C;&#x5219;&#x901A;&#x8FC7;SSH&#x8F6C;&#x53D1;&#x7684;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E5F;&#x662F;<strong>192.168.1.100:3000</strong>&#x3002;</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"deletion\">-D &#x672C;&#x5730;&#x7F51;&#x5361;&#x5730;&#x5740;:&#x672C;&#x5730;&#x7AEF;&#x53E3;</span></div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;<strong>&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E3B;&#x673A;B1&#xFF0C;&#x800C;&#x7531;B1&#x53BB;&#x771F;&#x6B63;&#x5730;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;&#x672C;&#x5730;&#x4E3B;&#x673A;A1&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -D localhost:2000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x800C;&#x5728;&#x672C;&#x5730;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x7531;Socket&#x4EE3;&#x7406;(<a href=\"https://en.wikipedia.org/wiki/SOCKS\">Socket Proxy</a>)&#x8F6C;&#x53D1;&#x5230;SSH&#x7ED1;&#x5B9A;&#x7684;2000&#x7AEF;&#x53E3;&#x3002;&#x4EE5;Firefox&#x6D4F;&#x89C8;&#x5668;&#x4E3A;&#x4F8B;&#xFF0C;&#x914D;&#x7F6E;Socket&#x4EE3;&#x7406;&#x9700;&#x8981;&#x627E;&#x5230;<strong>&#x9996;&#x9009;&#x9879;</strong>&gt;<strong>&#x9AD8;&#x7EA7;</strong>&gt;<strong>&#x7F51;&#x7EDC;</strong>&gt;<strong>&#x8FDE;&#x63A5;</strong>-&gt;<strong>&#x8BBE;&#x7F6E;</strong>:</p>\n<div style=\"text-align: center;\"><br><img style=\"width:60%;\" src=\"/2017/04/24/ssh-port-forwarding/socket_proxy.png\"><br></div>\n\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;Firefox&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x8F6C;&#x53D1;&#x5230;2000&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;SSH&#x8F6C;&#x53D1;&#x5230;&#x771F;&#x6B63;&#x5730;&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x3002;&#x82E5;Node.js&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x5728;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;B1&#x4E0A;&#xFF0C;&#x5219;&#x5728;Firefox&#x4E2D;&#x8BBF;&#x95EE;<a href=\"localhost:3000\">localhost:3000</a>&#x5373;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;&#x5982;&#x679C;&#x4E3B;&#x673A;B1&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x5916;&#x7F51;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x79D1;&#x5B66;&#x4E0A;&#x7F51;&#x2026;&#x2026;</p>\n<h3 id=\"&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"><a href=\"#&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\" class=\"headerlink\" title=\"&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;\"></a>&#x94FE;&#x5F0F;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h3><p><strong>&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x4E0E;<strong>&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</strong>&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x94FE;&#x5F0F;&#x8F6C;&#x53D1;&#x3002;&#x5047;&#x8BBE;A&#x4E3B;&#x673A;&#x5728;&#x516C;&#x53F8;&#xFF0C;B&#x4E3B;&#x673A;&#x5728;&#x5BB6;&#xFF0C;C&#x4E3B;&#x673A;&#x4E3A;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;&#x3002;A&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x4E86;&#x524D;&#x6587;&#x7684;Node.js&#x670D;&#x52A1;&#xFF0C;&#x9700;&#x8981;&#x5728;B&#x4E3B;&#x673A;&#x4E0A;&#x8BBF;&#x95EE;&#x8BE5;&#x670D;&#x52A1;&#x3002;&#x7531;&#x4E8E;A&#x548C;B&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x4E14;A&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x72EC;&#x7ACB;&#x516C;&#x5171;IP&#x5730;&#x5740;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C06;&#x53D1;&#x9001;&#x5230;B&#x4E3B;&#x673A;3000&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#x7684;2000&#x7AEF;&#x53E3;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;B&#x4E3B;&#x673A;&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -R localhost:3000:localhost:2000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x901A;&#x8FC7;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C06;&#x53D1;&#x9001;&#x5230;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#x7AEF;&#x53E3;2000&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;A&#x4E3B;&#x673A;&#x7684;3000&#x7AEF;&#x53E3;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># &#x5728;A&#x4E3B;&#x673A;&#x767B;&#x9646;&#x8FDC;&#x7A0B;&#x4E91;&#x4E3B;&#x673A;C&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</span></div><div class=\"line\">ssh -R localhost:2000:localhost:3000 root@103.59.22.17</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#xFF0C;&#x5728;&#x4E3B;&#x673A;B&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<a href=\"http://localhost:3000\">http://localhost:3000</a>&#x6765;&#x8BBF;&#x95EE;&#x4E3B;&#x673A;A&#x4E0A;&#x7684;&#x670D;&#x52A1;&#x3002;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\"># &#x5728;&#x4E3B;&#x673A;B&#x8BBF;&#x95EE;&#x4E3B;&#x673A;A&#x4E0A;&#x7684;&#x670D;&#x52A1;</div><div class=\"line\">curl http://localhost:3000</div><div class=\"line\">Hello Fundebug</div></pre></td></tr></table></figure>\n<h3 id=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"><a href=\"#&#x53C2;&#x8003;&#x94FE;&#x63A5;\" class=\"headerlink\" title=\"&#x53C2;&#x8003;&#x94FE;&#x63A5;\"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h3><ul>\n<li><a href=\"https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding?action=fullsearch&amp;value=linkto%3A%22SSH%2FOpenSSH%2FPortForwarding%22&amp;context=180\">SSH PortForwarding</a></li>\n<li><a href=\"http://www.pchou.info/linux/2015/11/01/ssh-tunnel.html\">SSH&#x96A7;&#x9053;&#x7684;&#x539F;&#x7406;&#x548C;&#x5B9E;&#x73B0;</a></li>\n</ul>"},{"title":"全面掌握Node命令选项","date":"2017-04-25T13:00:00.000Z","_content":"\n**译者按:** 作为Node.js开发者，有必要全面了解一下Node命令的所有选项，这样在关键时刻才能得心应手。\n\n\n<!-- more -->\n\n- 原文: [Mastering the Node.js CLI & Command Line Options](https://blog.risingstack.com/mastering-the-node-js-cli-command-line-options/)\n- 译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\nNode命令有很多选项，可以用于调试代码。这篇博客全面介绍了Node命令，可以提高大家的工作效率。\n\n### 查看Node命令选项\n\n使用**man**命令可以获取Node命令的所有选项:\n\n```bash\n$ man node\n\nUsage: node [options] [ -e script | script.js ] [arguments]  \n       node debug script.js [arguments] \n\nOptions:  \n  -v, --version         print Node.js version\n  -e, --eval script     evaluate script\n  -p, --print           evaluate script and print result\n  -c, --check           syntax check script without executing\n...\n```\n\n有Usage信息可知，所有选项都是可选的，且需要放在脚本之前。\n\n**index.js**如下:\n\n```javascript\nconsole.log(new Buffer(100))  \n```\n\n`--zero-fill-buffers`选项将所有新创建Buffer初始化为0:\n\n```bash\n--zero-fill-buffers\n              Automatically zero-fills all newly allocated Buffer and SlowBuffer instances.\n```\n\n使用`--zero-fill-buffers`选项的命令如下\n\n```bash\n$ node --zero-fill-buffers index.js\n```\n\n这样的话，输出结果全部为0，而不是随机的序列:\n\n```tex\n<Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ... >  \n```\n\n### Node命令常用选项\n\n#### `--version` 或 `-v`\n\n执行 `node --version`或者 `node -v`，可以查看Node版本信息。`-v`为`--version`的缩写，其他选项也有对应的缩写。\n\n```bash\n$ node -v\nv6.10.0  \n```\n\n#### `--eval` 或 `-e`\n\n使用`--eval` 选项，可以直接在终端执行Node.js代码。REPL中定义的模块，例如`http` 、 `fs`等都可以直接使用，不需要require。\n\n```bash\n$ node -e 'console.log(3 + 2)'\n5  \n```\n\n#### `--print` 或 `-p`\n\n`--print`选项与`--eval`选项的功能类似，但是`--print`选项可以打印表达式的结果。`--eval`选项使用`console.log`的话可以达到相同的效果。\n\n```bash\n$ node -p '3 + 2'\n5  \n```\n\n#### `--check` 或`-c`\n\n**Node v4.2.0之后才有**\n\n使用`--check`，则会检查代码的语法(并不会执行代码)。\n\n**index.js**如下:\n\n```javascript\nconsole.log(new Buffer(100)  \n```\n\n可知，代码中缺少了一个`)`，如果使用`node index.js`执行的话则会出错:\n\n```bash\n/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1\n(function (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)\n                                                                                        ^\nSyntaxError: missing ) after argument list  \n    at Object.exports.runInThisContext (vm.js:76:16)\n    at Module._compile (module.js:542:28)\n    at Object.Module._extensions..js (module.js:579:10)\n    at Module.load (module.js:487:32)\n    at tryModuleLoad (module.js:446:12)\n    at Function.Module._load (module.js:438:3)\n    at Module.runMain (module.js:604:10)\n    at run (bootstrap_node.js:394:7)\n```\n\n使用`node --check index.js`命令，可以在不执行代码的情况下检查到同样的错误。两者输出结果非常相似，但是**使用`--check`选项时没有执行代码，因此没有错误栈(stack trace)**:\n\n```bash\n/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1\n(function (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)\n                                                                                        ^\nSyntaxError: missing ) after argument list  \n    at startup (bootstrap_node.js:144:11)\n    at bootstrap_node.js:509:3\n```\n\n#### `--inspect[=host:port]`\n\n**node v6.3.0之后才有**\n\n使用`node --inspect`选项可以在指定的地址(host)和端口(port)开启监控器。如果没有指定地址和端口，则默认为`127.0.0.1:9229`。Chrome调试工具([Chrome Debugging Protocol](https://chromedevtools.github.io/debugger-protocol-viewer/))通过该端口绑定Node.js进程。\n\n#### `--inspect-brk[=host:port]`\n\n**node v7.6.0之后才有**\n\n`--inspect-brk`选项与`--inspect`选项的功能相同，只是它会在代码第一行就暂停。\n\n```bash\n$ node --inspect-brk index.js \nDebugger listening on port 9229.  \nWarning: This is an experimental feature and could change at any time.  \nTo start debugging, open the following URL in Chrome:  \n    chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813\n```\n\n运行命令之后，使用Chrome浏览器访问输出中提示的URL地址[chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813](chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813)就可以调试Node.js代码了。\n\n#### `--zero-fill-buffers`\n\n**node v6.0.0之后才有**\n\n使用`--zero-fill-buffers`选项可以使所有新创建的Buffer初始化为0。 这样做可以防止内存中的敏感信息泄露。\n\n注意，仅当需要防止内存敏感信息泄露时才使用该选项，因为它会严重影响代码性能。\n\n> 另外，下面这些Buffer构造器在node v6.0.0已经弃用了。\n>\n> Also note, that some Buffer constructors got deprecated in `v6.0.0`:\n>\n> - `new Buffer(array)`\n> - `new Buffer(arrayBuffer[, byteOffset [, length]])`\n> - `new Buffer(buffer)`\n> - `new Buffer(size)`\n> - `new Buffer(string[, encoding])`\n>\n> 所以，应该使用 `Buffer.alloc(size[, fill[, encoding]])`, `Buffer.from(array)`, `Buffer.from(buffer)`, `Buffer.from(arrayBuffer[, byteOffset[, length]])` 和 `Buffer.from(string[, encoding])`.\n\n关于Node.js的内存安全问题，可以查看博客[Exploiting Buffer](https://snyk.io/blog/exploiting-buffer/)\n\n#### `--prof-process`\n\n使用 `--prof-process`选项，Node.js进程将输出V8引擎的性能记录信息(profiler)\n\n首先，使用`--prof`选项执行代码:\n\n```bash\nnode --prof index.js  \n```\n\n运行之后，工作目录中将生成一个新文件，前缀为`isolate-`。\n\n然后，使用`--prof-process`选项执行代码:\n\n```bash\nnode --prof-process isolate-0x102001600-v8.log > output.txt  \n```\n\n**output.txt**文件中有V8引擎的性能记录信息，比如: C++代码花了多少时间，JavaScript代码花了多少时间，那个函数调用花了最多时间。如下:\n\n```bash\n[C++]:\n   ticks  total  nonlib   name\n     16   18.4%   18.4%  node::ContextifyScript::New(v8::FunctionCallbackInfo<v8::Value> const&)\n      4    4.6%    4.6%  ___mkdir_extended\n      2    2.3%    2.3%  void v8::internal::String::WriteToFlat<unsigned short>(v8::internal::String*, unsigned short*, int, int)\n      2    2.3%    2.3%  void v8::internal::ScavengingVisitor<(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0>::ObjectEvacuationStrategy<(v8::internal::ScavengingVisitor<(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0>::ObjectContents)1>::VisitSpecialized<24>(v8::internal::Map*, v8::internal::HeapObject**, v8::internal::HeapObject*)\n\n[Summary]:\n   ticks  total  nonlib   name\n      1    1.1%    1.1%  JavaScript\n     70   80.5%   80.5%  C++\n      5    5.7%    5.7%  GC\n      0    0.0%          Shared libraries\n     16   18.4%          Unaccounted\n```\n\n访问[官方文档](https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_command_line_options)，可以查看Node命令的所有选项。\n\n------\n\n### V8引擎选项\n\n使用`--v8-options`选项可以打印所有的V8引擎选项。\n\n> 目前，V8引擎提供了上百个选项，这篇博客只是介绍了其中几个。这些选项可以大大地改变V8引擎的行为，因此需要慎重使用。\n\n#### `--harmony`\n\n使用`--harmony`选项，则在代码中可以使用所有harmony特性(即正在开发的特性，例如在低版本的Node中使用ES6特性)。\n\n#### `--max_old_space_size`\n\n使用`--max_old_space_size`选项，可以调整老生代内存空间(old space，用于储存存活时间较长或常驻内存的对象)的最大值，这个将直接影响Node.js进程可以使用的内存大小。在内存较小的情况下，这个选项将非常方便，因为我们可以限制Node.js进程对内存的使用。\n\n#### `--optimize_for_size`\n\n使用`--optimize_for_size`选项，V8引擎会优化内存空间的使用，这样很可能会降低应用的执行速度。同样，在内存较小的情况下，这个选项将非常方便。\n\n### 环境变量\n\n#### `NODE_DEBUG=module[,…]`\n\n设置**NODE_DEBUG**环境变量可以打印Node.js核心模块的调试信息。例如，下面的命令可以查看**module**模块的调试信息(你也可以查看其它模块，例如http, fs等):\n\n```bash\n$ NODE_DEBUG=module node index.js\n```\n\n输出如下(可知，module模块负责加载代码调用的各个模块):\n\n```\nMODULE 7595: looking for \"/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js\" in [\"/Users/gergelyke/.node_modules\",\"/Users/gergelyke/.node_libraries\",\"/Users/gergelyke/.nvm/versions/node/v6.10.0/lib/node\"]  \nMODULE 7595: load \"/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js\" for module \".\"  \n```\n\n#### `NODE_PATH=path`\n\n使用**NODE_PATH**，可以指定Node.js进程搜索模块的额外目录。\n\n#### `OPENSSL_CONF=file`\n\n使用**OPENSSL_CONF**，可以指定OpenSSL的配置文件。\n\n访问[官方文档](https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_environment_variables)，可以查看Node命令的所有选项。\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群: 177654062**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"node-command-option/nodejs-qq-group.jpeg\" />\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/2017/04/25/node-command-option.md","raw":"---\ntitle: 全面掌握Node命令选项\n\ndate: 2017-04-25 21:00:00\n\ntags: [Node.js, 翻译]\n---\n\n**译者按:** 作为Node.js开发者，有必要全面了解一下Node命令的所有选项，这样在关键时刻才能得心应手。\n\n\n<!-- more -->\n\n- 原文: [Mastering the Node.js CLI & Command Line Options](https://blog.risingstack.com/mastering-the-node-js-cli-command-line-options/)\n- 译者: [Fundebug](https://fundebug.com/)\n\n**为了保证可读性，本文采用意译而非直译。**\n\nNode命令有很多选项，可以用于调试代码。这篇博客全面介绍了Node命令，可以提高大家的工作效率。\n\n### 查看Node命令选项\n\n使用**man**命令可以获取Node命令的所有选项:\n\n```bash\n$ man node\n\nUsage: node [options] [ -e script | script.js ] [arguments]  \n       node debug script.js [arguments] \n\nOptions:  \n  -v, --version         print Node.js version\n  -e, --eval script     evaluate script\n  -p, --print           evaluate script and print result\n  -c, --check           syntax check script without executing\n...\n```\n\n有Usage信息可知，所有选项都是可选的，且需要放在脚本之前。\n\n**index.js**如下:\n\n```javascript\nconsole.log(new Buffer(100))  \n```\n\n`--zero-fill-buffers`选项将所有新创建Buffer初始化为0:\n\n```bash\n--zero-fill-buffers\n              Automatically zero-fills all newly allocated Buffer and SlowBuffer instances.\n```\n\n使用`--zero-fill-buffers`选项的命令如下\n\n```bash\n$ node --zero-fill-buffers index.js\n```\n\n这样的话，输出结果全部为0，而不是随机的序列:\n\n```tex\n<Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ... >  \n```\n\n### Node命令常用选项\n\n#### `--version` 或 `-v`\n\n执行 `node --version`或者 `node -v`，可以查看Node版本信息。`-v`为`--version`的缩写，其他选项也有对应的缩写。\n\n```bash\n$ node -v\nv6.10.0  \n```\n\n#### `--eval` 或 `-e`\n\n使用`--eval` 选项，可以直接在终端执行Node.js代码。REPL中定义的模块，例如`http` 、 `fs`等都可以直接使用，不需要require。\n\n```bash\n$ node -e 'console.log(3 + 2)'\n5  \n```\n\n#### `--print` 或 `-p`\n\n`--print`选项与`--eval`选项的功能类似，但是`--print`选项可以打印表达式的结果。`--eval`选项使用`console.log`的话可以达到相同的效果。\n\n```bash\n$ node -p '3 + 2'\n5  \n```\n\n#### `--check` 或`-c`\n\n**Node v4.2.0之后才有**\n\n使用`--check`，则会检查代码的语法(并不会执行代码)。\n\n**index.js**如下:\n\n```javascript\nconsole.log(new Buffer(100)  \n```\n\n可知，代码中缺少了一个`)`，如果使用`node index.js`执行的话则会出错:\n\n```bash\n/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1\n(function (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)\n                                                                                        ^\nSyntaxError: missing ) after argument list  \n    at Object.exports.runInThisContext (vm.js:76:16)\n    at Module._compile (module.js:542:28)\n    at Object.Module._extensions..js (module.js:579:10)\n    at Module.load (module.js:487:32)\n    at tryModuleLoad (module.js:446:12)\n    at Function.Module._load (module.js:438:3)\n    at Module.runMain (module.js:604:10)\n    at run (bootstrap_node.js:394:7)\n```\n\n使用`node --check index.js`命令，可以在不执行代码的情况下检查到同样的错误。两者输出结果非常相似，但是**使用`--check`选项时没有执行代码，因此没有错误栈(stack trace)**:\n\n```bash\n/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1\n(function (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)\n                                                                                        ^\nSyntaxError: missing ) after argument list  \n    at startup (bootstrap_node.js:144:11)\n    at bootstrap_node.js:509:3\n```\n\n#### `--inspect[=host:port]`\n\n**node v6.3.0之后才有**\n\n使用`node --inspect`选项可以在指定的地址(host)和端口(port)开启监控器。如果没有指定地址和端口，则默认为`127.0.0.1:9229`。Chrome调试工具([Chrome Debugging Protocol](https://chromedevtools.github.io/debugger-protocol-viewer/))通过该端口绑定Node.js进程。\n\n#### `--inspect-brk[=host:port]`\n\n**node v7.6.0之后才有**\n\n`--inspect-brk`选项与`--inspect`选项的功能相同，只是它会在代码第一行就暂停。\n\n```bash\n$ node --inspect-brk index.js \nDebugger listening on port 9229.  \nWarning: This is an experimental feature and could change at any time.  \nTo start debugging, open the following URL in Chrome:  \n    chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813\n```\n\n运行命令之后，使用Chrome浏览器访问输出中提示的URL地址[chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813](chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813)就可以调试Node.js代码了。\n\n#### `--zero-fill-buffers`\n\n**node v6.0.0之后才有**\n\n使用`--zero-fill-buffers`选项可以使所有新创建的Buffer初始化为0。 这样做可以防止内存中的敏感信息泄露。\n\n注意，仅当需要防止内存敏感信息泄露时才使用该选项，因为它会严重影响代码性能。\n\n> 另外，下面这些Buffer构造器在node v6.0.0已经弃用了。\n>\n> Also note, that some Buffer constructors got deprecated in `v6.0.0`:\n>\n> - `new Buffer(array)`\n> - `new Buffer(arrayBuffer[, byteOffset [, length]])`\n> - `new Buffer(buffer)`\n> - `new Buffer(size)`\n> - `new Buffer(string[, encoding])`\n>\n> 所以，应该使用 `Buffer.alloc(size[, fill[, encoding]])`, `Buffer.from(array)`, `Buffer.from(buffer)`, `Buffer.from(arrayBuffer[, byteOffset[, length]])` 和 `Buffer.from(string[, encoding])`.\n\n关于Node.js的内存安全问题，可以查看博客[Exploiting Buffer](https://snyk.io/blog/exploiting-buffer/)\n\n#### `--prof-process`\n\n使用 `--prof-process`选项，Node.js进程将输出V8引擎的性能记录信息(profiler)\n\n首先，使用`--prof`选项执行代码:\n\n```bash\nnode --prof index.js  \n```\n\n运行之后，工作目录中将生成一个新文件，前缀为`isolate-`。\n\n然后，使用`--prof-process`选项执行代码:\n\n```bash\nnode --prof-process isolate-0x102001600-v8.log > output.txt  \n```\n\n**output.txt**文件中有V8引擎的性能记录信息，比如: C++代码花了多少时间，JavaScript代码花了多少时间，那个函数调用花了最多时间。如下:\n\n```bash\n[C++]:\n   ticks  total  nonlib   name\n     16   18.4%   18.4%  node::ContextifyScript::New(v8::FunctionCallbackInfo<v8::Value> const&)\n      4    4.6%    4.6%  ___mkdir_extended\n      2    2.3%    2.3%  void v8::internal::String::WriteToFlat<unsigned short>(v8::internal::String*, unsigned short*, int, int)\n      2    2.3%    2.3%  void v8::internal::ScavengingVisitor<(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0>::ObjectEvacuationStrategy<(v8::internal::ScavengingVisitor<(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0>::ObjectContents)1>::VisitSpecialized<24>(v8::internal::Map*, v8::internal::HeapObject**, v8::internal::HeapObject*)\n\n[Summary]:\n   ticks  total  nonlib   name\n      1    1.1%    1.1%  JavaScript\n     70   80.5%   80.5%  C++\n      5    5.7%    5.7%  GC\n      0    0.0%          Shared libraries\n     16   18.4%          Unaccounted\n```\n\n访问[官方文档](https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_command_line_options)，可以查看Node命令的所有选项。\n\n------\n\n### V8引擎选项\n\n使用`--v8-options`选项可以打印所有的V8引擎选项。\n\n> 目前，V8引擎提供了上百个选项，这篇博客只是介绍了其中几个。这些选项可以大大地改变V8引擎的行为，因此需要慎重使用。\n\n#### `--harmony`\n\n使用`--harmony`选项，则在代码中可以使用所有harmony特性(即正在开发的特性，例如在低版本的Node中使用ES6特性)。\n\n#### `--max_old_space_size`\n\n使用`--max_old_space_size`选项，可以调整老生代内存空间(old space，用于储存存活时间较长或常驻内存的对象)的最大值，这个将直接影响Node.js进程可以使用的内存大小。在内存较小的情况下，这个选项将非常方便，因为我们可以限制Node.js进程对内存的使用。\n\n#### `--optimize_for_size`\n\n使用`--optimize_for_size`选项，V8引擎会优化内存空间的使用，这样很可能会降低应用的执行速度。同样，在内存较小的情况下，这个选项将非常方便。\n\n### 环境变量\n\n#### `NODE_DEBUG=module[,…]`\n\n设置**NODE_DEBUG**环境变量可以打印Node.js核心模块的调试信息。例如，下面的命令可以查看**module**模块的调试信息(你也可以查看其它模块，例如http, fs等):\n\n```bash\n$ NODE_DEBUG=module node index.js\n```\n\n输出如下(可知，module模块负责加载代码调用的各个模块):\n\n```\nMODULE 7595: looking for \"/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js\" in [\"/Users/gergelyke/.node_modules\",\"/Users/gergelyke/.node_libraries\",\"/Users/gergelyke/.nvm/versions/node/v6.10.0/lib/node\"]  \nMODULE 7595: load \"/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js\" for module \".\"  \n```\n\n#### `NODE_PATH=path`\n\n使用**NODE_PATH**，可以指定Node.js进程搜索模块的额外目录。\n\n#### `OPENSSL_CONF=file`\n\n使用**OPENSSL_CONF**，可以指定OpenSSL的配置文件。\n\n访问[官方文档](https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_environment_variables)，可以查看Node命令的所有选项。\n\n欢迎加入[我们Fundebug](https://fundebug.com/)的**Node.js技术交流群: 177654062**。\n\n<div style=\"text-align: center;\">\n<img style=\"width:20%;\" src=\"node-command-option/nodejs-qq-group.jpeg\" />\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"2017/04/25/node-command-option","published":1,"updated":"2017-04-25T12:34:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1yywep40038mkfyqtkmo4o8","content":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> &#x4F5C;&#x4E3A;Node.js&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x6709;&#x5FC5;&#x8981;&#x5168;&#x9762;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x5173;&#x952E;&#x65F6;&#x523B;&#x624D;&#x80FD;&#x5F97;&#x5FC3;&#x5E94;&#x624B;&#x3002;</p>\n<a id=\"more\"></a>\n<ul>\n<li>&#x539F;&#x6587;: <a href=\"https://blog.risingstack.com/mastering-the-node-js-cli-command-line-options/\" target=\"_blank\" rel=\"external\">Mastering the Node.js CLI &amp; Command Line Options</a></li>\n<li>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">Fundebug</a></li>\n</ul>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>Node&#x547D;&#x4EE4;&#x6709;&#x5F88;&#x591A;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5168;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;Node&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5927;&#x5BB6;&#x7684;&#x5DE5;&#x4F5C;&#x6548;&#x7387;&#x3002;</p>\n<h3 id=\"&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;\"><a href=\"#&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;\" class=\"headerlink\" title=\"&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;\"></a>&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;</h3><p>&#x4F7F;&#x7528;<strong>man</strong>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ man node</div><div class=\"line\"></div><div class=\"line\">Usage: node [options] [ <span class=\"_\">-e</span> script | script.js ] [arguments]  </div><div class=\"line\">       node debug script.js [arguments] </div><div class=\"line\"></div><div class=\"line\">Options:  </div><div class=\"line\">  -v, --version         <span class=\"built_in\">print</span> Node.js version</div><div class=\"line\">  <span class=\"_\">-e</span>, --eval script     evaluate script</div><div class=\"line\">  -p, --print           evaluate script and <span class=\"built_in\">print</span> result</div><div class=\"line\">  -c, --check           syntax check script without executing</div><div class=\"line\">...</div></pre></td></tr></table></figure>\n<p>&#x6709;Usage&#x4FE1;&#x606F;&#x53EF;&#x77E5;&#xFF0C;&#x6240;&#x6709;&#x9009;&#x9879;&#x90FD;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x4E14;&#x9700;&#x8981;&#x653E;&#x5728;&#x811A;&#x672C;&#x4E4B;&#x524D;&#x3002;</p>\n<p><strong>index.js</strong>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">new</span> Buffer(<span class=\"number\">100</span>))</div></pre></td></tr></table></figure>\n<p><code>--zero-fill-buffers</code>&#x9009;&#x9879;&#x5C06;&#x6240;&#x6709;&#x65B0;&#x521B;&#x5EFA;Buffer&#x521D;&#x59CB;&#x5316;&#x4E3A;0:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">--zero-fill-buffers</div><div class=\"line\">              Automatically zero-fills all newly allocated Buffer and SlowBuffer instances.</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<code>--zero-fill-buffers</code>&#x9009;&#x9879;&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node --zero-fill-buffers index.js</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5168;&#x90E8;&#x4E3A;0&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x968F;&#x673A;&#x7684;&#x5E8F;&#x5217;:</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ... &gt;</div></pre></td></tr></table></figure>\n<h3 id=\"Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;\"><a href=\"#Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;\" class=\"headerlink\" title=\"Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;\"></a>Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;</h3><h4 id=\"version-&#x6216;-v\"><a href=\"#version-&#x6216;-v\" class=\"headerlink\" title=\"--version &#x6216; -v\"></a><code>--version</code> &#x6216; <code>-v</code></h4><p>&#x6267;&#x884C; <code>node --version</code>&#x6216;&#x8005; <code>node -v</code>&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Node&#x7248;&#x672C;&#x4FE1;&#x606F;&#x3002;<code>-v</code>&#x4E3A;<code>--version</code>&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x5176;&#x4ED6;&#x9009;&#x9879;&#x4E5F;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x7F29;&#x5199;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node -v</div><div class=\"line\">v6.10.0</div></pre></td></tr></table></figure>\n<h4 id=\"eval-&#x6216;-e\"><a href=\"#eval-&#x6216;-e\" class=\"headerlink\" title=\"--eval &#x6216; -e\"></a><code>--eval</code> &#x6216; <code>-e</code></h4><p>&#x4F7F;&#x7528;<code>--eval</code> &#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x7EC8;&#x7AEF;&#x6267;&#x884C;Node.js&#x4EE3;&#x7801;&#x3002;REPL&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x4F8B;&#x5982;<code>http</code> &#x3001; <code>fs</code>&#x7B49;&#x90FD;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x9700;&#x8981;require&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node <span class=\"_\">-e</span> <span class=\"string\">&apos;console.log(3 + 2)&apos;</span></div><div class=\"line\">5</div></pre></td></tr></table></figure>\n<h4 id=\"print-&#x6216;-p\"><a href=\"#print-&#x6216;-p\" class=\"headerlink\" title=\"--print &#x6216; -p\"></a><code>--print</code> &#x6216; <code>-p</code></h4><p><code>--print</code>&#x9009;&#x9879;&#x4E0E;<code>--eval</code>&#x9009;&#x9879;&#x7684;&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;<code>--print</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7ED3;&#x679C;&#x3002;<code>--eval</code>&#x9009;&#x9879;&#x4F7F;&#x7528;<code>console.log</code>&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x76F8;&#x540C;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node -p <span class=\"string\">&apos;3 + 2&apos;</span></div><div class=\"line\">5</div></pre></td></tr></table></figure>\n<h4 id=\"check-&#x6216;-c\"><a href=\"#check-&#x6216;-c\" class=\"headerlink\" title=\"--check &#x6216;-c\"></a><code>--check</code> &#x6216;<code>-c</code></h4><p><strong>Node v4.2.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p>&#x4F7F;&#x7528;<code>--check</code>&#xFF0C;&#x5219;&#x4F1A;&#x68C0;&#x67E5;&#x4EE3;&#x7801;&#x7684;&#x8BED;&#x6CD5;(&#x5E76;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x4EE3;&#x7801;)&#x3002;</p>\n<p><strong>index.js</strong>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">new</span> Buffer(<span class=\"number\">100</span>)</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4EE3;&#x7801;&#x4E2D;&#x7F3A;&#x5C11;&#x4E86;&#x4E00;&#x4E2A;<code>)</code>&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;<code>node index.js</code>&#x6267;&#x884C;&#x7684;&#x8BDD;&#x5219;&#x4F1A;&#x51FA;&#x9519;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1</div><div class=\"line\">(<span class=\"keyword\">function</span> (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)</div><div class=\"line\">                                                                                        ^</div><div class=\"line\">SyntaxError: missing ) after argument list  </div><div class=\"line\">    at Object.exports.runInThisContext (vm.js:76:16)</div><div class=\"line\">    at Module._compile (module.js:542:28)</div><div class=\"line\">    at Object.Module._extensions..js (module.js:579:10)</div><div class=\"line\">    at Module.load (module.js:487:32)</div><div class=\"line\">    at tryModuleLoad (module.js:446:12)</div><div class=\"line\">    at Function.Module._load (module.js:438:3)</div><div class=\"line\">    at Module.runMain (module.js:604:10)</div><div class=\"line\">    at run (bootstrap_node.js:394:7)</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<code>node --check index.js</code>&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x68C0;&#x67E5;&#x5230;&#x540C;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x4E24;&#x8005;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;<strong>&#x4F7F;&#x7528;<code>--check</code>&#x9009;&#x9879;&#x65F6;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x6CA1;&#x6709;&#x9519;&#x8BEF;&#x6808;(stack trace)</strong>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1</div><div class=\"line\">(<span class=\"keyword\">function</span> (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)</div><div class=\"line\">                                                                                        ^</div><div class=\"line\">SyntaxError: missing ) after argument list  </div><div class=\"line\">    at startup (bootstrap_node.js:144:11)</div><div class=\"line\">    at bootstrap_node.js:509:3</div></pre></td></tr></table></figure>\n<h4 id=\"inspect-host-port\"><a href=\"#inspect-host-port\" class=\"headerlink\" title=\"--inspect[=host:port]\"></a><code>--inspect[=host:port]</code></h4><p><strong>node v6.3.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p>&#x4F7F;&#x7528;<code>node --inspect</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5730;&#x5740;(host)&#x548C;&#x7AEF;&#x53E3;(port)&#x5F00;&#x542F;&#x76D1;&#x63A7;&#x5668;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;<code>127.0.0.1:9229</code>&#x3002;Chrome&#x8C03;&#x8BD5;&#x5DE5;&#x5177;(<a href=\"https://chromedevtools.github.io/debugger-protocol-viewer/\" target=\"_blank\" rel=\"external\">Chrome Debugging Protocol</a>)&#x901A;&#x8FC7;&#x8BE5;&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;Node.js&#x8FDB;&#x7A0B;&#x3002;</p>\n<h4 id=\"inspect-brk-host-port\"><a href=\"#inspect-brk-host-port\" class=\"headerlink\" title=\"--inspect-brk[=host:port]\"></a><code>--inspect-brk[=host:port]</code></h4><p><strong>node v7.6.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p><code>--inspect-brk</code>&#x9009;&#x9879;&#x4E0E;<code>--inspect</code>&#x9009;&#x9879;&#x7684;&#x529F;&#x80FD;&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x5B83;&#x4F1A;&#x5728;&#x4EE3;&#x7801;&#x7B2C;&#x4E00;&#x884C;&#x5C31;&#x6682;&#x505C;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node --inspect-brk index.js </div><div class=\"line\">Debugger listening on port 9229.  </div><div class=\"line\">Warning: This is an experimental feature and could change at any time.  </div><div class=\"line\">To start debugging, open the following URL <span class=\"keyword\">in</span> Chrome:  </div><div class=\"line\">    chrome-devtools://devtools/bundled/inspector.html?experiments=<span class=\"literal\">true</span>&amp;v8only=<span class=\"literal\">true</span>&amp;ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;Chrome&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x8F93;&#x51FA;&#x4E2D;&#x63D0;&#x793A;&#x7684;URL&#x5730;&#x5740;<a href=\"chrome-devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813\" target=\"_blank\" rel=\"external\">chrome-devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813</a>&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x8BD5;Node.js&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>\n<h4 id=\"zero-fill-buffers\"><a href=\"#zero-fill-buffers\" class=\"headerlink\" title=\"--zero-fill-buffers\"></a><code>--zero-fill-buffers</code></h4><p><strong>node v6.0.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p>&#x4F7F;&#x7528;<code>--zero-fill-buffers</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x4F7F;&#x6240;&#x6709;&#x65B0;&#x521B;&#x5EFA;&#x7684;Buffer&#x521D;&#x59CB;&#x5316;&#x4E3A;0&#x3002; &#x8FD9;&#x6837;&#x505A;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x6CC4;&#x9732;&#x3002;</p>\n<p>&#x6CE8;&#x610F;&#xFF0C;&#x4EC5;&#x5F53;&#x9700;&#x8981;&#x9632;&#x6B62;&#x5185;&#x5B58;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x6CC4;&#x9732;&#x65F6;&#x624D;&#x4F7F;&#x7528;&#x8BE5;&#x9009;&#x9879;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x4E25;&#x91CD;&#x5F71;&#x54CD;&#x4EE3;&#x7801;&#x6027;&#x80FD;&#x3002;</p>\n<blockquote>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;Buffer&#x6784;&#x9020;&#x5668;&#x5728;node v6.0.0&#x5DF2;&#x7ECF;&#x5F03;&#x7528;&#x4E86;&#x3002;</p>\n<p>Also note, that some Buffer constructors got deprecated in <code>v6.0.0</code>:</p>\n<ul>\n<li><code>new Buffer(array)</code></li>\n<li><code>new Buffer(arrayBuffer[, byteOffset [, length]])</code></li>\n<li><code>new Buffer(buffer)</code></li>\n<li><code>new Buffer(size)</code></li>\n<li><code>new Buffer(string[, encoding])</code></li>\n</ul>\n<p>&#x6240;&#x4EE5;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>Buffer.alloc(size[, fill[, encoding]])</code>, <code>Buffer.from(array)</code>, <code>Buffer.from(buffer)</code>, <code>Buffer.from(arrayBuffer[, byteOffset[, length]])</code> &#x548C; <code>Buffer.from(string[, encoding])</code>.</p>\n</blockquote>\n<p>&#x5173;&#x4E8E;Node.js&#x7684;&#x5185;&#x5B58;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x535A;&#x5BA2;<a href=\"https://snyk.io/blog/exploiting-buffer/\" target=\"_blank\" rel=\"external\">Exploiting Buffer</a></p>\n<h4 id=\"prof-process\"><a href=\"#prof-process\" class=\"headerlink\" title=\"--prof-process\"></a><code>--prof-process</code></h4><p>&#x4F7F;&#x7528; <code>--prof-process</code>&#x9009;&#x9879;&#xFF0C;Node.js&#x8FDB;&#x7A0B;&#x5C06;&#x8F93;&#x51FA;V8&#x5F15;&#x64CE;&#x7684;&#x6027;&#x80FD;&#x8BB0;&#x5F55;&#x4FE1;&#x606F;(profiler)</p>\n<p>&#x9996;&#x5148;&#xFF0C;&#x4F7F;&#x7528;<code>--prof</code>&#x9009;&#x9879;&#x6267;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">node --prof index.js</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x4E4B;&#x540E;&#xFF0C;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x4E2D;&#x5C06;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x6587;&#x4EF6;&#xFF0C;&#x524D;&#x7F00;&#x4E3A;<code>isolate-</code>&#x3002;</p>\n<p>&#x7136;&#x540E;&#xFF0C;&#x4F7F;&#x7528;<code>--prof-process</code>&#x9009;&#x9879;&#x6267;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">node --prof-process isolate-0x102001600-v8.log &gt; output.txt</div></pre></td></tr></table></figure>\n<p><strong>output.txt</strong>&#x6587;&#x4EF6;&#x4E2D;&#x6709;V8&#x5F15;&#x64CE;&#x7684;&#x6027;&#x80FD;&#x8BB0;&#x5F55;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;: C++&#x4EE3;&#x7801;&#x82B1;&#x4E86;&#x591A;&#x5C11;&#x65F6;&#x95F4;&#xFF0C;JavaScript&#x4EE3;&#x7801;&#x82B1;&#x4E86;&#x591A;&#x5C11;&#x65F6;&#x95F4;&#xFF0C;&#x90A3;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x82B1;&#x4E86;&#x6700;&#x591A;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">[C++]:</div><div class=\"line\">   ticks  total  nonlib   name</div><div class=\"line\">     16   18.4%   18.4%  node::ContextifyScript::New(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</div><div class=\"line\">      4    4.6%    4.6%  ___mkdir_extended</div><div class=\"line\">      2    2.3%    2.3%  void v8::internal::String::WriteToFlat&lt;unsigned short&gt;(v8::internal::String*, unsigned short*, int, int)</div><div class=\"line\">      2    2.3%    2.3%  void v8::internal::ScavengingVisitor&lt;(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0&gt;::ObjectEvacuationStrategy&lt;(v8::internal::ScavengingVisitor&lt;(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0&gt;::ObjectContents)1&gt;::VisitSpecialized&lt;24&gt;(v8::internal::Map*, v8::internal::HeapObject**, v8::internal::HeapObject*)</div><div class=\"line\"></div><div class=\"line\">[Summary]:</div><div class=\"line\">   ticks  total  nonlib   name</div><div class=\"line\">      1    1.1%    1.1%  JavaScript</div><div class=\"line\">     70   80.5%   80.5%  C++</div><div class=\"line\">      5    5.7%    5.7%  GC</div><div class=\"line\">      0    0.0%          Shared libraries</div><div class=\"line\">     16   18.4%          Unaccounted</div></pre></td></tr></table></figure>\n<p>&#x8BBF;&#x95EE;<a href=\"https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_command_line_options\" target=\"_blank\" rel=\"external\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;&#x3002;</p>\n<hr>\n<h3 id=\"V8&#x5F15;&#x64CE;&#x9009;&#x9879;\"><a href=\"#V8&#x5F15;&#x64CE;&#x9009;&#x9879;\" class=\"headerlink\" title=\"V8&#x5F15;&#x64CE;&#x9009;&#x9879;\"></a>V8&#x5F15;&#x64CE;&#x9009;&#x9879;</h3><p>&#x4F7F;&#x7528;<code>--v8-options</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x6240;&#x6709;&#x7684;V8&#x5F15;&#x64CE;&#x9009;&#x9879;&#x3002;</p>\n<blockquote>\n<p>&#x76EE;&#x524D;&#xFF0C;V8&#x5F15;&#x64CE;&#x63D0;&#x4F9B;&#x4E86;&#x4E0A;&#x767E;&#x4E2A;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x53EA;&#x662F;&#x4ECB;&#x7ECD;&#x4E86;&#x5176;&#x4E2D;&#x51E0;&#x4E2A;&#x3002;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x5730;&#x6539;&#x53D8;V8&#x5F15;&#x64CE;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x614E;&#x91CD;&#x4F7F;&#x7528;&#x3002;</p>\n</blockquote>\n<h4 id=\"harmony\"><a href=\"#harmony\" class=\"headerlink\" title=\"--harmony\"></a><code>--harmony</code></h4><p>&#x4F7F;&#x7528;<code>--harmony</code>&#x9009;&#x9879;&#xFF0C;&#x5219;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6240;&#x6709;harmony&#x7279;&#x6027;(&#x5373;&#x6B63;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x4F4E;&#x7248;&#x672C;&#x7684;Node&#x4E2D;&#x4F7F;&#x7528;ES6&#x7279;&#x6027;)&#x3002;</p>\n<h4 id=\"max-old-space-size\"><a href=\"#max-old-space-size\" class=\"headerlink\" title=\"--max_old_space_size\"></a><code>--max_old_space_size</code></h4><p>&#x4F7F;&#x7528;<code>--max_old_space_size</code>&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x6574;&#x8001;&#x751F;&#x4EE3;&#x5185;&#x5B58;&#x7A7A;&#x95F4;(old space&#xFF0C;&#x7528;&#x4E8E;&#x50A8;&#x5B58;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#x8F83;&#x957F;&#x6216;&#x5E38;&#x9A7B;&#x5185;&#x5B58;&#x7684;&#x5BF9;&#x8C61;)&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C06;&#x76F4;&#x63A5;&#x5F71;&#x54CD;Node.js&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x3002;&#x5728;&#x5185;&#x5B58;&#x8F83;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5C06;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9650;&#x5236;Node.js&#x8FDB;&#x7A0B;&#x5BF9;&#x5185;&#x5B58;&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h4 id=\"optimize-for-size\"><a href=\"#optimize-for-size\" class=\"headerlink\" title=\"--optimize_for_size\"></a><code>--optimize_for_size</code></h4><p>&#x4F7F;&#x7528;<code>--optimize_for_size</code>&#x9009;&#x9879;&#xFF0C;V8&#x5F15;&#x64CE;&#x4F1A;&#x4F18;&#x5316;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x964D;&#x4F4E;&#x5E94;&#x7528;&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x3002;&#x540C;&#x6837;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x8F83;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5C06;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;</p>\n<h3 id=\"&#x73AF;&#x5883;&#x53D8;&#x91CF;\"><a href=\"#&#x73AF;&#x5883;&#x53D8;&#x91CF;\" class=\"headerlink\" title=\"&#x73AF;&#x5883;&#x53D8;&#x91CF;\"></a>&#x73AF;&#x5883;&#x53D8;&#x91CF;</h3><h4 id=\"NODE-DEBUG-module-&#x2026;\"><a href=\"#NODE-DEBUG-module-&#x2026;\" class=\"headerlink\" title=\"NODE_DEBUG=module[,&#x2026;]\"></a><code>NODE_DEBUG=module[,&#x2026;]</code></h4><p>&#x8BBE;&#x7F6E;<strong>NODE_DEBUG</strong>&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x6253;&#x5370;Node.js&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<strong>module</strong>&#x6A21;&#x5757;&#x7684;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;(&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5176;&#x5B83;&#x6A21;&#x5757;&#xFF0C;&#x4F8B;&#x5982;http, fs&#x7B49;):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ NODE_DEBUG=module node index.js</div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;(&#x53EF;&#x77E5;&#xFF0C;module&#x6A21;&#x5757;&#x8D1F;&#x8D23;&#x52A0;&#x8F7D;&#x4EE3;&#x7801;&#x8C03;&#x7528;&#x7684;&#x5404;&#x4E2A;&#x6A21;&#x5757;):</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">MODULE</span> <span class=\"number\">7595</span>: looking <span class=\"keyword\">for</span> <span class=\"string\">&quot;/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js&quot;</span> <span class=\"keyword\">in</span> [<span class=\"string\">&quot;/Users/gergelyke/.node_modules&quot;</span>,<span class=\"string\">&quot;/Users/gergelyke/.node_libraries&quot;</span>,<span class=\"string\">&quot;/Users/gergelyke/.nvm/versions/node/v6.10.0/lib/node&quot;</span>]  </div><div class=\"line\"><span class=\"keyword\">MODULE</span> <span class=\"number\">7595</span>: load <span class=\"string\">&quot;/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js&quot;</span> <span class=\"keyword\">for</span> <span class=\"keyword\">module</span> <span class=\"string\">&quot;.&quot;</span></div></pre></td></tr></table></figure>\n<h4 id=\"NODE-PATH-path\"><a href=\"#NODE-PATH-path\" class=\"headerlink\" title=\"NODE_PATH=path\"></a><code>NODE_PATH=path</code></h4><p>&#x4F7F;&#x7528;<strong>NODE_PATH</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;Node.js&#x8FDB;&#x7A0B;&#x641C;&#x7D22;&#x6A21;&#x5757;&#x7684;&#x989D;&#x5916;&#x76EE;&#x5F55;&#x3002;</p>\n<h4 id=\"OPENSSL-CONF-file\"><a href=\"#OPENSSL-CONF-file\" class=\"headerlink\" title=\"OPENSSL_CONF=file\"></a><code>OPENSSL_CONF=file</code></h4><p>&#x4F7F;&#x7528;<strong>OPENSSL_CONF</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;OpenSSL&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x8BBF;&#x95EE;<a href=\"https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_environment_variables\" target=\"_blank\" rel=\"external\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;&#x3002;</p>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\" target=\"_blank\" rel=\"external\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 177654062</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/25/node-command-option/nodejs-qq-group.jpeg\"><br></div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","excerpt":"<p><strong>&#x8BD1;&#x8005;&#x6309;:</strong> &#x4F5C;&#x4E3A;Node.js&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x6709;&#x5FC5;&#x8981;&#x5168;&#x9762;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x5173;&#x952E;&#x65F6;&#x523B;&#x624D;&#x80FD;&#x5F97;&#x5FC3;&#x5E94;&#x624B;&#x3002;</p>","more":"<ul>\n<li>&#x539F;&#x6587;: <a href=\"https://blog.risingstack.com/mastering-the-node-js-cli-command-line-options/\">Mastering the Node.js CLI &amp; Command Line Options</a></li>\n<li>&#x8BD1;&#x8005;: <a href=\"https://fundebug.com/\">Fundebug</a></li>\n</ul>\n<p><strong>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;&#x610F;&#x8BD1;&#x800C;&#x975E;&#x76F4;&#x8BD1;&#x3002;</strong></p>\n<p>Node&#x547D;&#x4EE4;&#x6709;&#x5F88;&#x591A;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x5168;&#x9762;&#x4ECB;&#x7ECD;&#x4E86;Node&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5927;&#x5BB6;&#x7684;&#x5DE5;&#x4F5C;&#x6548;&#x7387;&#x3002;</p>\n<h3 id=\"&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;\"><a href=\"#&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;\" class=\"headerlink\" title=\"&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;\"></a>&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x9009;&#x9879;</h3><p>&#x4F7F;&#x7528;<strong>man</strong>&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ man node</div><div class=\"line\"></div><div class=\"line\">Usage: node [options] [ <span class=\"_\">-e</span> script | script.js ] [arguments]  </div><div class=\"line\">       node debug script.js [arguments] </div><div class=\"line\"></div><div class=\"line\">Options:  </div><div class=\"line\">  -v, --version         <span class=\"built_in\">print</span> Node.js version</div><div class=\"line\">  <span class=\"_\">-e</span>, --eval script     evaluate script</div><div class=\"line\">  -p, --print           evaluate script and <span class=\"built_in\">print</span> result</div><div class=\"line\">  -c, --check           syntax check script without executing</div><div class=\"line\">...</div></pre></td></tr></table></figure>\n<p>&#x6709;Usage&#x4FE1;&#x606F;&#x53EF;&#x77E5;&#xFF0C;&#x6240;&#x6709;&#x9009;&#x9879;&#x90FD;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x4E14;&#x9700;&#x8981;&#x653E;&#x5728;&#x811A;&#x672C;&#x4E4B;&#x524D;&#x3002;</p>\n<p><strong>index.js</strong>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">new</span> Buffer(<span class=\"number\">100</span>))</div></pre></td></tr></table></figure>\n<p><code>--zero-fill-buffers</code>&#x9009;&#x9879;&#x5C06;&#x6240;&#x6709;&#x65B0;&#x521B;&#x5EFA;Buffer&#x521D;&#x59CB;&#x5316;&#x4E3A;0:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">--zero-fill-buffers</div><div class=\"line\">              Automatically zero-fills all newly allocated Buffer and SlowBuffer instances.</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<code>--zero-fill-buffers</code>&#x9009;&#x9879;&#x7684;&#x547D;&#x4EE4;&#x5982;&#x4E0B;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node --zero-fill-buffers index.js</div></pre></td></tr></table></figure>\n<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x5168;&#x90E8;&#x4E3A;0&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x968F;&#x673A;&#x7684;&#x5E8F;&#x5217;:</p>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><div class=\"line\">&lt;Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ... &gt;</div></pre></td></tr></table></figure>\n<h3 id=\"Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;\"><a href=\"#Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;\" class=\"headerlink\" title=\"Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;\"></a>Node&#x547D;&#x4EE4;&#x5E38;&#x7528;&#x9009;&#x9879;</h3><h4 id=\"version-&#x6216;-v\"><a href=\"#version-&#x6216;-v\" class=\"headerlink\" title=\"--version &#x6216; -v\"></a><code>--version</code> &#x6216; <code>-v</code></h4><p>&#x6267;&#x884C; <code>node --version</code>&#x6216;&#x8005; <code>node -v</code>&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Node&#x7248;&#x672C;&#x4FE1;&#x606F;&#x3002;<code>-v</code>&#x4E3A;<code>--version</code>&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x5176;&#x4ED6;&#x9009;&#x9879;&#x4E5F;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x7F29;&#x5199;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node -v</div><div class=\"line\">v6.10.0</div></pre></td></tr></table></figure>\n<h4 id=\"eval-&#x6216;-e\"><a href=\"#eval-&#x6216;-e\" class=\"headerlink\" title=\"--eval &#x6216; -e\"></a><code>--eval</code> &#x6216; <code>-e</code></h4><p>&#x4F7F;&#x7528;<code>--eval</code> &#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x7EC8;&#x7AEF;&#x6267;&#x884C;Node.js&#x4EE3;&#x7801;&#x3002;REPL&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x4F8B;&#x5982;<code>http</code> &#x3001; <code>fs</code>&#x7B49;&#x90FD;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x9700;&#x8981;require&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node <span class=\"_\">-e</span> <span class=\"string\">&apos;console.log(3 + 2)&apos;</span></div><div class=\"line\">5</div></pre></td></tr></table></figure>\n<h4 id=\"print-&#x6216;-p\"><a href=\"#print-&#x6216;-p\" class=\"headerlink\" title=\"--print &#x6216; -p\"></a><code>--print</code> &#x6216; <code>-p</code></h4><p><code>--print</code>&#x9009;&#x9879;&#x4E0E;<code>--eval</code>&#x9009;&#x9879;&#x7684;&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;<code>--print</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7ED3;&#x679C;&#x3002;<code>--eval</code>&#x9009;&#x9879;&#x4F7F;&#x7528;<code>console.log</code>&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x76F8;&#x540C;&#x7684;&#x6548;&#x679C;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node -p <span class=\"string\">&apos;3 + 2&apos;</span></div><div class=\"line\">5</div></pre></td></tr></table></figure>\n<h4 id=\"check-&#x6216;-c\"><a href=\"#check-&#x6216;-c\" class=\"headerlink\" title=\"--check &#x6216;-c\"></a><code>--check</code> &#x6216;<code>-c</code></h4><p><strong>Node v4.2.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p>&#x4F7F;&#x7528;<code>--check</code>&#xFF0C;&#x5219;&#x4F1A;&#x68C0;&#x67E5;&#x4EE3;&#x7801;&#x7684;&#x8BED;&#x6CD5;(&#x5E76;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x4EE3;&#x7801;)&#x3002;</p>\n<p><strong>index.js</strong>&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">new</span> Buffer(<span class=\"number\">100</span>)</div></pre></td></tr></table></figure>\n<p>&#x53EF;&#x77E5;&#xFF0C;&#x4EE3;&#x7801;&#x4E2D;&#x7F3A;&#x5C11;&#x4E86;&#x4E00;&#x4E2A;<code>)</code>&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;<code>node index.js</code>&#x6267;&#x884C;&#x7684;&#x8BDD;&#x5219;&#x4F1A;&#x51FA;&#x9519;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1</div><div class=\"line\">(<span class=\"keyword\">function</span> (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)</div><div class=\"line\">                                                                                        ^</div><div class=\"line\">SyntaxError: missing ) after argument list  </div><div class=\"line\">    at Object.exports.runInThisContext (vm.js:76:16)</div><div class=\"line\">    at Module._compile (module.js:542:28)</div><div class=\"line\">    at Object.Module._extensions..js (module.js:579:10)</div><div class=\"line\">    at Module.load (module.js:487:32)</div><div class=\"line\">    at tryModuleLoad (module.js:446:12)</div><div class=\"line\">    at Function.Module._load (module.js:438:3)</div><div class=\"line\">    at Module.runMain (module.js:604:10)</div><div class=\"line\">    at run (bootstrap_node.js:394:7)</div></pre></td></tr></table></figure>\n<p>&#x4F7F;&#x7528;<code>node --check index.js</code>&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x68C0;&#x67E5;&#x5230;&#x540C;&#x6837;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x4E24;&#x8005;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;<strong>&#x4F7F;&#x7528;<code>--check</code>&#x9009;&#x9879;&#x65F6;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x6CA1;&#x6709;&#x9519;&#x8BEF;&#x6808;(stack trace)</strong>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js:1</div><div class=\"line\">(<span class=\"keyword\">function</span> (exports, require, module, __filename, __dirname) { console.log(new Buffer(100)</div><div class=\"line\">                                                                                        ^</div><div class=\"line\">SyntaxError: missing ) after argument list  </div><div class=\"line\">    at startup (bootstrap_node.js:144:11)</div><div class=\"line\">    at bootstrap_node.js:509:3</div></pre></td></tr></table></figure>\n<h4 id=\"inspect-host-port\"><a href=\"#inspect-host-port\" class=\"headerlink\" title=\"--inspect[=host:port]\"></a><code>--inspect[=host:port]</code></h4><p><strong>node v6.3.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p>&#x4F7F;&#x7528;<code>node --inspect</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5730;&#x5740;(host)&#x548C;&#x7AEF;&#x53E3;(port)&#x5F00;&#x542F;&#x76D1;&#x63A7;&#x5668;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;<code>127.0.0.1:9229</code>&#x3002;Chrome&#x8C03;&#x8BD5;&#x5DE5;&#x5177;(<a href=\"https://chromedevtools.github.io/debugger-protocol-viewer/\">Chrome Debugging Protocol</a>)&#x901A;&#x8FC7;&#x8BE5;&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;Node.js&#x8FDB;&#x7A0B;&#x3002;</p>\n<h4 id=\"inspect-brk-host-port\"><a href=\"#inspect-brk-host-port\" class=\"headerlink\" title=\"--inspect-brk[=host:port]\"></a><code>--inspect-brk[=host:port]</code></h4><p><strong>node v7.6.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p><code>--inspect-brk</code>&#x9009;&#x9879;&#x4E0E;<code>--inspect</code>&#x9009;&#x9879;&#x7684;&#x529F;&#x80FD;&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x662F;&#x5B83;&#x4F1A;&#x5728;&#x4EE3;&#x7801;&#x7B2C;&#x4E00;&#x884C;&#x5C31;&#x6682;&#x505C;&#x3002;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ node --inspect-brk index.js </div><div class=\"line\">Debugger listening on port 9229.  </div><div class=\"line\">Warning: This is an experimental feature and could change at any time.  </div><div class=\"line\">To start debugging, open the following URL <span class=\"keyword\">in</span> Chrome:  </div><div class=\"line\">    chrome-devtools://devtools/bundled/inspector.html?experiments=<span class=\"literal\">true</span>&amp;v8only=<span class=\"literal\">true</span>&amp;ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528;Chrome&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x8F93;&#x51FA;&#x4E2D;&#x63D0;&#x793A;&#x7684;URL&#x5730;&#x5740;<a href=\"chrome-devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813\">chrome-devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:9229/86dd44ef-c865-479e-be4d-806d622a4813</a>&#x5C31;&#x53EF;&#x4EE5;&#x8C03;&#x8BD5;Node.js&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>\n<h4 id=\"zero-fill-buffers\"><a href=\"#zero-fill-buffers\" class=\"headerlink\" title=\"--zero-fill-buffers\"></a><code>--zero-fill-buffers</code></h4><p><strong>node v6.0.0&#x4E4B;&#x540E;&#x624D;&#x6709;</strong></p>\n<p>&#x4F7F;&#x7528;<code>--zero-fill-buffers</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x4F7F;&#x6240;&#x6709;&#x65B0;&#x521B;&#x5EFA;&#x7684;Buffer&#x521D;&#x59CB;&#x5316;&#x4E3A;0&#x3002; &#x8FD9;&#x6837;&#x505A;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x6CC4;&#x9732;&#x3002;</p>\n<p>&#x6CE8;&#x610F;&#xFF0C;&#x4EC5;&#x5F53;&#x9700;&#x8981;&#x9632;&#x6B62;&#x5185;&#x5B58;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x6CC4;&#x9732;&#x65F6;&#x624D;&#x4F7F;&#x7528;&#x8BE5;&#x9009;&#x9879;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x4E25;&#x91CD;&#x5F71;&#x54CD;&#x4EE3;&#x7801;&#x6027;&#x80FD;&#x3002;</p>\n<blockquote>\n<p>&#x53E6;&#x5916;&#xFF0C;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;Buffer&#x6784;&#x9020;&#x5668;&#x5728;node v6.0.0&#x5DF2;&#x7ECF;&#x5F03;&#x7528;&#x4E86;&#x3002;</p>\n<p>Also note, that some Buffer constructors got deprecated in <code>v6.0.0</code>:</p>\n<ul>\n<li><code>new Buffer(array)</code></li>\n<li><code>new Buffer(arrayBuffer[, byteOffset [, length]])</code></li>\n<li><code>new Buffer(buffer)</code></li>\n<li><code>new Buffer(size)</code></li>\n<li><code>new Buffer(string[, encoding])</code></li>\n</ul>\n<p>&#x6240;&#x4EE5;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>Buffer.alloc(size[, fill[, encoding]])</code>, <code>Buffer.from(array)</code>, <code>Buffer.from(buffer)</code>, <code>Buffer.from(arrayBuffer[, byteOffset[, length]])</code> &#x548C; <code>Buffer.from(string[, encoding])</code>.</p>\n</blockquote>\n<p>&#x5173;&#x4E8E;Node.js&#x7684;&#x5185;&#x5B58;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x535A;&#x5BA2;<a href=\"https://snyk.io/blog/exploiting-buffer/\">Exploiting Buffer</a></p>\n<h4 id=\"prof-process\"><a href=\"#prof-process\" class=\"headerlink\" title=\"--prof-process\"></a><code>--prof-process</code></h4><p>&#x4F7F;&#x7528; <code>--prof-process</code>&#x9009;&#x9879;&#xFF0C;Node.js&#x8FDB;&#x7A0B;&#x5C06;&#x8F93;&#x51FA;V8&#x5F15;&#x64CE;&#x7684;&#x6027;&#x80FD;&#x8BB0;&#x5F55;&#x4FE1;&#x606F;(profiler)</p>\n<p>&#x9996;&#x5148;&#xFF0C;&#x4F7F;&#x7528;<code>--prof</code>&#x9009;&#x9879;&#x6267;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">node --prof index.js</div></pre></td></tr></table></figure>\n<p>&#x8FD0;&#x884C;&#x4E4B;&#x540E;&#xFF0C;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x4E2D;&#x5C06;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x6587;&#x4EF6;&#xFF0C;&#x524D;&#x7F00;&#x4E3A;<code>isolate-</code>&#x3002;</p>\n<p>&#x7136;&#x540E;&#xFF0C;&#x4F7F;&#x7528;<code>--prof-process</code>&#x9009;&#x9879;&#x6267;&#x884C;&#x4EE3;&#x7801;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">node --prof-process isolate-0x102001600-v8.log &gt; output.txt</div></pre></td></tr></table></figure>\n<p><strong>output.txt</strong>&#x6587;&#x4EF6;&#x4E2D;&#x6709;V8&#x5F15;&#x64CE;&#x7684;&#x6027;&#x80FD;&#x8BB0;&#x5F55;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;: C++&#x4EE3;&#x7801;&#x82B1;&#x4E86;&#x591A;&#x5C11;&#x65F6;&#x95F4;&#xFF0C;JavaScript&#x4EE3;&#x7801;&#x82B1;&#x4E86;&#x591A;&#x5C11;&#x65F6;&#x95F4;&#xFF0C;&#x90A3;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x82B1;&#x4E86;&#x6700;&#x591A;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x4E0B;:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">[C++]:</div><div class=\"line\">   ticks  total  nonlib   name</div><div class=\"line\">     16   18.4%   18.4%  node::ContextifyScript::New(v8::FunctionCallbackInfo&lt;v8::Value&gt; const&amp;)</div><div class=\"line\">      4    4.6%    4.6%  ___mkdir_extended</div><div class=\"line\">      2    2.3%    2.3%  void v8::internal::String::WriteToFlat&lt;unsigned short&gt;(v8::internal::String*, unsigned short*, int, int)</div><div class=\"line\">      2    2.3%    2.3%  void v8::internal::ScavengingVisitor&lt;(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0&gt;::ObjectEvacuationStrategy&lt;(v8::internal::ScavengingVisitor&lt;(v8::internal::MarksHandling)1, (v8::internal::LoggingAndProfiling)0&gt;::ObjectContents)1&gt;::VisitSpecialized&lt;24&gt;(v8::internal::Map*, v8::internal::HeapObject**, v8::internal::HeapObject*)</div><div class=\"line\"></div><div class=\"line\">[Summary]:</div><div class=\"line\">   ticks  total  nonlib   name</div><div class=\"line\">      1    1.1%    1.1%  JavaScript</div><div class=\"line\">     70   80.5%   80.5%  C++</div><div class=\"line\">      5    5.7%    5.7%  GC</div><div class=\"line\">      0    0.0%          Shared libraries</div><div class=\"line\">     16   18.4%          Unaccounted</div></pre></td></tr></table></figure>\n<p>&#x8BBF;&#x95EE;<a href=\"https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_command_line_options\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;&#x3002;</p>\n<hr>\n<h3 id=\"V8&#x5F15;&#x64CE;&#x9009;&#x9879;\"><a href=\"#V8&#x5F15;&#x64CE;&#x9009;&#x9879;\" class=\"headerlink\" title=\"V8&#x5F15;&#x64CE;&#x9009;&#x9879;\"></a>V8&#x5F15;&#x64CE;&#x9009;&#x9879;</h3><p>&#x4F7F;&#x7528;<code>--v8-options</code>&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x6240;&#x6709;&#x7684;V8&#x5F15;&#x64CE;&#x9009;&#x9879;&#x3002;</p>\n<blockquote>\n<p>&#x76EE;&#x524D;&#xFF0C;V8&#x5F15;&#x64CE;&#x63D0;&#x4F9B;&#x4E86;&#x4E0A;&#x767E;&#x4E2A;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x7BC7;&#x535A;&#x5BA2;&#x53EA;&#x662F;&#x4ECB;&#x7ECD;&#x4E86;&#x5176;&#x4E2D;&#x51E0;&#x4E2A;&#x3002;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x5730;&#x6539;&#x53D8;V8&#x5F15;&#x64CE;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x614E;&#x91CD;&#x4F7F;&#x7528;&#x3002;</p>\n</blockquote>\n<h4 id=\"harmony\"><a href=\"#harmony\" class=\"headerlink\" title=\"--harmony\"></a><code>--harmony</code></h4><p>&#x4F7F;&#x7528;<code>--harmony</code>&#x9009;&#x9879;&#xFF0C;&#x5219;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6240;&#x6709;harmony&#x7279;&#x6027;(&#x5373;&#x6B63;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x4F8B;&#x5982;&#x5728;&#x4F4E;&#x7248;&#x672C;&#x7684;Node&#x4E2D;&#x4F7F;&#x7528;ES6&#x7279;&#x6027;)&#x3002;</p>\n<h4 id=\"max-old-space-size\"><a href=\"#max-old-space-size\" class=\"headerlink\" title=\"--max_old_space_size\"></a><code>--max_old_space_size</code></h4><p>&#x4F7F;&#x7528;<code>--max_old_space_size</code>&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x6574;&#x8001;&#x751F;&#x4EE3;&#x5185;&#x5B58;&#x7A7A;&#x95F4;(old space&#xFF0C;&#x7528;&#x4E8E;&#x50A8;&#x5B58;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#x8F83;&#x957F;&#x6216;&#x5E38;&#x9A7B;&#x5185;&#x5B58;&#x7684;&#x5BF9;&#x8C61;)&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C06;&#x76F4;&#x63A5;&#x5F71;&#x54CD;Node.js&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x3002;&#x5728;&#x5185;&#x5B58;&#x8F83;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5C06;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9650;&#x5236;Node.js&#x8FDB;&#x7A0B;&#x5BF9;&#x5185;&#x5B58;&#x7684;&#x4F7F;&#x7528;&#x3002;</p>\n<h4 id=\"optimize-for-size\"><a href=\"#optimize-for-size\" class=\"headerlink\" title=\"--optimize_for_size\"></a><code>--optimize_for_size</code></h4><p>&#x4F7F;&#x7528;<code>--optimize_for_size</code>&#x9009;&#x9879;&#xFF0C;V8&#x5F15;&#x64CE;&#x4F1A;&#x4F18;&#x5316;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x964D;&#x4F4E;&#x5E94;&#x7528;&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x3002;&#x540C;&#x6837;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x8F83;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5C06;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;</p>\n<h3 id=\"&#x73AF;&#x5883;&#x53D8;&#x91CF;\"><a href=\"#&#x73AF;&#x5883;&#x53D8;&#x91CF;\" class=\"headerlink\" title=\"&#x73AF;&#x5883;&#x53D8;&#x91CF;\"></a>&#x73AF;&#x5883;&#x53D8;&#x91CF;</h3><h4 id=\"NODE-DEBUG-module-&#x2026;\"><a href=\"#NODE-DEBUG-module-&#x2026;\" class=\"headerlink\" title=\"NODE_DEBUG=module[,&#x2026;]\"></a><code>NODE_DEBUG=module[,&#x2026;]</code></h4><p>&#x8BBE;&#x7F6E;<strong>NODE_DEBUG</strong>&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x6253;&#x5370;Node.js&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<strong>module</strong>&#x6A21;&#x5757;&#x7684;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;(&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5176;&#x5B83;&#x6A21;&#x5757;&#xFF0C;&#x4F8B;&#x5982;http, fs&#x7B49;):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ NODE_DEBUG=module node index.js</div></pre></td></tr></table></figure>\n<p>&#x8F93;&#x51FA;&#x5982;&#x4E0B;(&#x53EF;&#x77E5;&#xFF0C;module&#x6A21;&#x5757;&#x8D1F;&#x8D23;&#x52A0;&#x8F7D;&#x4EE3;&#x7801;&#x8C03;&#x7528;&#x7684;&#x5404;&#x4E2A;&#x6A21;&#x5757;):</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">MODULE</span> <span class=\"number\">7595</span>: looking <span class=\"keyword\">for</span> <span class=\"string\">&quot;/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js&quot;</span> <span class=\"keyword\">in</span> [<span class=\"string\">&quot;/Users/gergelyke/.node_modules&quot;</span>,<span class=\"string\">&quot;/Users/gergelyke/.node_libraries&quot;</span>,<span class=\"string\">&quot;/Users/gergelyke/.nvm/versions/node/v6.10.0/lib/node&quot;</span>]  </div><div class=\"line\"><span class=\"keyword\">MODULE</span> <span class=\"number\">7595</span>: load <span class=\"string\">&quot;/Users/gergelyke/Development/risingstack/mastering-nodejs-cli/index.js&quot;</span> <span class=\"keyword\">for</span> <span class=\"keyword\">module</span> <span class=\"string\">&quot;.&quot;</span></div></pre></td></tr></table></figure>\n<h4 id=\"NODE-PATH-path\"><a href=\"#NODE-PATH-path\" class=\"headerlink\" title=\"NODE_PATH=path\"></a><code>NODE_PATH=path</code></h4><p>&#x4F7F;&#x7528;<strong>NODE_PATH</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;Node.js&#x8FDB;&#x7A0B;&#x641C;&#x7D22;&#x6A21;&#x5757;&#x7684;&#x989D;&#x5916;&#x76EE;&#x5F55;&#x3002;</p>\n<h4 id=\"OPENSSL-CONF-file\"><a href=\"#OPENSSL-CONF-file\" class=\"headerlink\" title=\"OPENSSL_CONF=file\"></a><code>OPENSSL_CONF=file</code></h4><p>&#x4F7F;&#x7528;<strong>OPENSSL_CONF</strong>&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;OpenSSL&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>\n<p>&#x8BBF;&#x95EE;<a href=\"https://nodejs.org/dist/latest-v7.x/docs/api/cli.html#cli_environment_variables\">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Node&#x547D;&#x4EE4;&#x7684;&#x6240;&#x6709;&#x9009;&#x9879;&#x3002;</p>\n<p>&#x6B22;&#x8FCE;&#x52A0;&#x5165;<a href=\"https://fundebug.com/\">&#x6211;&#x4EEC;Fundebug</a>&#x7684;<strong>Node.js&#x6280;&#x672F;&#x4EA4;&#x6D41;&#x7FA4;: 177654062</strong>&#x3002;</p>\n<div style=\"text-align: center;\"><br><img style=\"width:20%;\" src=\"/2017/04/25/node-command-option/nodejs-qq-group.jpeg\"><br></div>"}],"PostAsset":[{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.png","slug":"kubernetes-multiple-docker.png","post":"cj1yywelo0004mkfyohflgdc8","modified":1,"renderable":0},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.png","slug":"vagrant-vm-cluster.png","post":"cj1yywemw000smkfywf6ujmll","modified":1,"renderable":0},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-detail.png","slug":"error-detail.png","post":"cj1yywen0000zmkfyo612xlab","modified":1,"renderable":0},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap1.png","slug":"chrome-sourcemap1.png","post":"cj1yywen70019mkfy6b09b6mx","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/05/understand-script-error/script-error-ok.png","slug":"script-error-ok.png","post":"cj1yywenk001nmkfyz6o8az96","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/05/understand-script-error/script-error.png","slug":"script-error.png","post":"cj1yywenk001nmkfyz6o8az96","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/06/test-script-error/2.png","slug":"2.png","post":"cj1yyweoa002zmkfyilej1u2s","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/06/test-script-error/script-error.png","slug":"script-error.png","post":"cj1yyweoa002zmkfyilej1u2s","modified":1,"renderable":0},{"_id":"source/_posts/2016/11/fundebug-is-online/with_fundebug.jpg","post":"cj1yywejf0000mkfyiwy1fvqs","slug":"with_fundebug.jpg","modified":1,"renderable":1},{"_id":"source/_posts/2016/11/fundebug-is-online/without_fundebug.jpg","post":"cj1yywejf0000mkfyiwy1fvqs","slug":"without_fundebug.jpg","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Mesos.png","slug":"Mesos.png","post":"cj1yywem2000amkfy1ygd2heg","modified":1,"renderable":0},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.graffle","slug":"mesos-marathon-platform.graffle","post":"cj1yywemi000fmkfyfxyxolth","modified":1,"renderable":0},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos-marathon-platform.png","slug":"mesos-marathon-platform.png","post":"cj1yywemi000fmkfyfxyxolth","modified":1,"renderable":0},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser.jpg","slug":"browser.jpg","post":"cj1yywemy000xmkfyrkybvlyf","modified":1,"renderable":0},{"_id":"source/_posts/2017/02/11/weixin-miniprogram-need-fundebug/fundebug-wxjs.jpg","post":"cj1yywen20012mkfyr9yljqqx","slug":"fundebug-wxjs.jpg","modified":1,"renderable":1},{"_id":"source/_posts/2017/02/18/weixinjsbridge-is-not-defined/weixinjsbridge_is_not_defined.png","post":"cj1yywen30014mkfy87fynfej","slug":"weixinjsbridge_is_not_defined.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/06/jquery-is-not-defined/fundebug-jquery-error.png","post":"cj1yywen50017mkfye2i4vuno","slug":"fundebug-jquery-error.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/17/fundebug-support-nodejs/fundebug-nodejs.png","post":"cj1yywena001bmkfy2jm8umh4","slug":"fundebug-nodejs.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.graffle","post":"cj1yyweln0003mkfyu12heh2y","slug":"image-architecture.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2015/06/08/150608-hadoop-cluster-docker/image-architecture.png","post":"cj1yyweln0003mkfyu12heh2y","slug":"image-architecture.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/11/28/151128-single-kubernetes-docker/kubernetes-multiple-docker.graffle","post":"cj1yywelo0004mkfyohflgdc8","slug":"kubernetes-multiple-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.graffle","post":"cj1yywelq0006mkfy0ewfxeq4","slug":"hadoop-cluster-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/12/160612-hadoop-cluster-docker-update/hadoop-cluster-docker.png","post":"cj1yywelq0006mkfy0ewfxeq4","slug":"hadoop-cluster-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.graffle","post":"cj1yywelr0007mkfyitkebrj0","slug":"hadoop-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/05/160605-compile-hadoop-docker/hadoop-docker.png","slug":"hadoop-docker.png","post":"cj1yywelr0007mkfyitkebrj0","modified":1,"renderable":0},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.graffle","post":"cj1yywelv0008mkfyp3cfeah2","slug":"vagrant-vm.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/19/160619-vagrant-virtual-machine/vagrant-vm.png","slug":"vagrant-vm.png","post":"cj1yywelv0008mkfyp3cfeah2","modified":1,"renderable":0},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.graffle","post":"cj1yyweme000dmkfyd6cr8gze","slug":"hadoop-cluster-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/06/26/hadoop-cluster-docker-update-english/hadoop-cluster-docker.png","post":"cj1yyweme000dmkfyd6cr8gze","slug":"hadoop-cluster-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.graffle","post":"cj1yywemm000imkfyo069b6jm","slug":"ubuntu-hadoop.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/05/29/160529-compile-hadoop-ubuntu/ubuntu-hadoop.png","post":"cj1yywemm000imkfyo069b6jm","slug":"ubuntu-hadoop.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.graffle","post":"cj1yywemp000kmkfyvwpjpiz2","slug":"service-discovery.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/04/what-is-service-discovery/service-discovery.png","post":"cj1yywemp000kmkfyvwpjpiz2","slug":"service-discovery.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.graffle","post":"cj1yywemt000nmkfyfhfzdno9","slug":"underscore-example.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/18/underscore-example/underscore-example.png","post":"cj1yywemt000nmkfyfhfzdno9","slug":"underscore-example.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.graffle","slug":"mongodb-inverted-index.graffle","post":"cj1yywemu000pmkfykvr594m3","modified":1,"renderable":0},{"_id":"source/_posts/2016/09/11/mongodb-inverted-index/mongodb-inverted-index.png","slug":"mongodb-inverted-index.png","post":"cj1yywemu000pmkfykvr594m3","modified":1,"renderable":0},{"_id":"source/_posts/2016/07/03/vagrant-vm-cluster/vagrant-vm-cluster.graffle","post":"cj1yywemw000smkfywf6ujmll","slug":"vagrant-vm-cluster.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/empty.png","post":"cj1yywemw000umkfyftllgbl9","slug":"empty.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/01/23/fundebug-support-wxjs/fundebug-wxjs.jpg","post":"cj1yywemw000umkfyftllgbl9","slug":"fundebug-wxjs.jpg","modified":1,"renderable":1},{"_id":"source/_posts/2017/01/16/fundebug-support-all-browsers/browser-share.png","post":"cj1yywemy000xmkfyrkybvlyf","slug":"browser-share.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/29/user-behavior-track/fundebug-track-behavior.png","post":"cj1yywenc001dmkfykmpmcbk6","slug":"fundebug-track-behavior.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/29/user-behavior-track/user-behavior-track.png","post":"cj1yywenc001dmkfykmpmcbk6","slug":"user-behavior-track.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/20/nodejs-unit-test/nodejs-qq-group.jpeg","post":"cj1yywend001emkfyibbqf925","slug":"nodejs-qq-group.jpeg","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/20/nodejs-unit-test/nodejs-unit-test.jpg","post":"cj1yywend001emkfyibbqf925","slug":"nodejs-unit-test.jpg","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/26/nodejs-docker/nodejs-docker.png","post":"cj1yywend001gmkfyqxxfzzyg","slug":"nodejs-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/26/nodejs-docker/nodejs-qq-group.jpeg","post":"cj1yywend001gmkfyqxxfzzyg","slug":"nodejs-qq-group.jpeg","modified":1,"renderable":1},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/email.png","post":"cj1yywen0000zmkfyo612xlab","slug":"email.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/12/07/fundebug-catch-the-bug/error-count.png","post":"cj1yywen0000zmkfyo612xlab","slug":"error-count.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/01/nodejs-async-await/debug-async-await.png","post":"cj1yywenf001imkfyfmgwz6uu","slug":"debug-async-await.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/01/nodejs-async-await/debug-promise.png","post":"cj1yywenf001imkfyfmgwz6uu","slug":"debug-promise.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/01/nodejs-async-await/nodejs-qq-group.jpeg","post":"cj1yywenf001imkfyfmgwz6uu","slug":"nodejs-qq-group.jpeg","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/07/solve-script-error/QRCode.png","post":"cj1yywenj001lmkfyqfk9vi5n","slug":"QRCode.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/07/solve-script-error/qiniu.png","slug":"qiniu.png","post":"cj1yywenj001lmkfyqfk9vi5n","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/07/solve-script-error/script-error.png","post":"cj1yywenj001lmkfyqfk9vi5n","slug":"script-error.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/05/understand-script-error/script-error-not-ok-chrome.png","post":"cj1yywenk001nmkfyz6o8az96","slug":"script-error-not-ok-chrome.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.graffle","post":"cj1yywem8000bmkfyj6268n5l","slug":"kubernetes-multiple-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-multiple-docker.png","post":"cj1yywem8000bmkfyj6268n5l","slug":"kubernetes-multiple-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.graffle","post":"cj1yywem8000bmkfyj6268n5l","slug":"kubernetes-single-docker.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2016/01/09/160109-multiple-processes--docker-container/kubernetes-single-docker.png","post":"cj1yywem8000bmkfyj6268n5l","slug":"kubernetes-single-docker.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/Marathon.png","post":"cj1yywem2000amkfy1ygd2heg","slug":"Marathon.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/hello.png","post":"cj1yywem2000amkfy1ygd2heg","slug":"hello.png","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.graffle","post":"cj1yywem2000amkfy1ygd2heg","slug":"single-mesos-marathon.graffle","modified":1,"renderable":1},{"_id":"source/_posts/2015/09/18/150918-single-mesos-docker/single-mesos-marathon.png","post":"cj1yywem2000amkfy1ygd2heg","slug":"single-mesos-marathon.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap2.png","post":"cj1yywen70019mkfy6b09b6mx","slug":"chrome-sourcemap2.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap3.png","post":"cj1yywen70019mkfy6b09b6mx","slug":"chrome-sourcemap3.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/chrome-sourcemap4.png","post":"cj1yywen70019mkfy6b09b6mx","slug":"chrome-sourcemap4.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/03/13/sourcemap-tutorial/fundebug-sourcemap.jpg","post":"cj1yywen70019mkfy6b09b6mx","slug":"fundebug-sourcemap.jpg","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/marathon.png","post":"cj1yywemi000fmkfyfxyxolth","slug":"marathon.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/mesos.png","post":"cj1yywemi000fmkfyfxyxolth","slug":"mesos.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/nginx.png","post":"cj1yywemi000fmkfyfxyxolth","slug":"nginx.png","modified":1,"renderable":1},{"_id":"source/_posts/2016/07/10/mesos-marathon-platform/zookeeper.png","post":"cj1yywemi000fmkfyfxyxolth","slug":"zookeeper.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/06/test-script-error/4.png","slug":"4.png","post":"cj1yyweoa002zmkfyilej1u2s","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/18/docker-system-explain/docker.JPG","post":"cj1yyweom0034mkfy1rtkkgmo","slug":"docker.JPG","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/25/node-command-option/nodejs-qq-group.jpeg","post":"cj1yywep40038mkfyqtkmo4o8","slug":"nodejs-qq-group.jpeg","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/10/nodejs-interview-2017/nodejs-qq-group.jpeg","post":"cj1yyweoc0032mkfy88st0vf2","slug":"nodejs-qq-group.jpeg","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/10/nodejs-interview-2017/test_pyramid.png","post":"cj1yyweoc0032mkfy88st0vf2","slug":"test_pyramid.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/24/ssh-port-forwarding/socket_proxy.png","post":"cj1yyweov0036mkfybxbt8toj","slug":"socket_proxy.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/24/ssh-port-forwarding/ssh_tunnel.jpeg","post":"cj1yyweov0036mkfybxbt8toj","slug":"ssh_tunnel.jpeg","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/17/about-docker-sock/01.png","post":"cj1yyweob0030mkfyc4f1r68p","slug":"01.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/17/about-docker-sock/02.png","post":"cj1yyweob0030mkfyc4f1r68p","slug":"02.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/17/about-docker-sock/docker.JPG","post":"cj1yyweob0030mkfyc4f1r68p","slug":"docker.JPG","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/06/test-script-error/01.png","post":"cj1yyweoa002zmkfyilej1u2s","slug":"01.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/06/test-script-error/012.png","slug":"012.png","post":"cj1yyweoa002zmkfyilej1u2s","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/06/test-script-error/1.png","slug":"1.png","post":"cj1yyweoa002zmkfyilej1u2s","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/06/test-script-error/1chrome.png","post":"cj1yyweoa002zmkfyilej1u2s","slug":"1chrome.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/06/test-script-error/2firefox.png","post":"cj1yyweoa002zmkfyilej1u2s","slug":"2firefox.png","modified":1,"renderable":1},{"_id":"source/_posts/2017/04/06/test-script-error/5.png","slug":"5.png","post":"cj1yyweoa002zmkfyilej1u2s","modified":1,"renderable":0},{"_id":"source/_posts/2017/04/06/test-script-error/chrome_error.png","post":"cj1yyweoa002zmkfyilej1u2s","slug":"chrome_error.png","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"cj1yywejf0000mkfyiwy1fvqs","tag_id":"cj1yywejo0001mkfynyzc0mxz","_id":"cj1yywejz0002mkfybydofkj7"},{"post_id":"cj1yyweln0003mkfyu12heh2y","tag_id":"cj1yywelq0005mkfy6704dx5b","_id":"cj1yywemf000emkfyn9p2ym5t"},{"post_id":"cj1yyweln0003mkfyu12heh2y","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywemj000gmkfy80bucxu5"},{"post_id":"cj1yyweme000dmkfyd6cr8gze","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywemn000jmkfyzgxq8cw4"},{"post_id":"cj1yyweme000dmkfyd6cr8gze","tag_id":"cj1yywelq0005mkfy6704dx5b","_id":"cj1yywemp000lmkfybxwl47hi"},{"post_id":"cj1yywemm000imkfyo069b6jm","tag_id":"cj1yywelq0005mkfy6704dx5b","_id":"cj1yywemu000omkfy6gq1jm1r"},{"post_id":"cj1yywelo0004mkfyohflgdc8","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywemv000qmkfy0w01wh2u"},{"post_id":"cj1yywelo0004mkfyohflgdc8","tag_id":"cj1yywemj000hmkfywnct8673","_id":"cj1yywemw000tmkfy7w5dzurx"},{"post_id":"cj1yywemp000kmkfyvwpjpiz2","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywemx000vmkfyup96q8xl"},{"post_id":"cj1yywelq0006mkfy0ewfxeq4","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywemz000ymkfy6gko879p"},{"post_id":"cj1yywelq0006mkfy0ewfxeq4","tag_id":"cj1yywelq0005mkfy6704dx5b","_id":"cj1yywen20010mkfygfcv8ehq"},{"post_id":"cj1yywelr0007mkfyitkebrj0","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywen30013mkfye72tsxr4"},{"post_id":"cj1yywelr0007mkfyitkebrj0","tag_id":"cj1yywelq0005mkfy6704dx5b","_id":"cj1yywen40015mkfyog375hy3"},{"post_id":"cj1yywen0000zmkfyo612xlab","tag_id":"cj1yywejo0001mkfynyzc0mxz","_id":"cj1yywen70018mkfyhh6obaop"},{"post_id":"cj1yywelv0008mkfyp3cfeah2","tag_id":"cj1yywen20011mkfyv6zybnpg","_id":"cj1yywen9001amkfyfhv8721v"},{"post_id":"cj1yywem2000amkfy1ygd2heg","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywenf001hmkfym4oo1b35"},{"post_id":"cj1yywem2000amkfy1ygd2heg","tag_id":"cj1yywen50016mkfyslze70ft","_id":"cj1yywenh001jmkfydppazsr3"},{"post_id":"cj1yywem2000amkfy1ygd2heg","tag_id":"cj1yywenb001cmkfyzdaurzqm","_id":"cj1yywenk001mmkfybo5vqren"},{"post_id":"cj1yywem8000bmkfyj6268n5l","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywenl001omkfyzefoa3mg"},{"post_id":"cj1yywem8000bmkfyj6268n5l","tag_id":"cj1yywemj000hmkfywnct8673","_id":"cj1yywenl001qmkfy6d2gvcsq"},{"post_id":"cj1yywemi000fmkfyfxyxolth","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywenm001smkfy7wh8729i"},{"post_id":"cj1yywemi000fmkfyfxyxolth","tag_id":"cj1yywen50016mkfyslze70ft","_id":"cj1yywenn001tmkfyt07dp352"},{"post_id":"cj1yywemi000fmkfyfxyxolth","tag_id":"cj1yywenb001cmkfyzdaurzqm","_id":"cj1yyweno001vmkfydavu2y49"},{"post_id":"cj1yywemt000nmkfyfhfzdno9","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yyweno001wmkfyksl1h50i"},{"post_id":"cj1yywemu000pmkfykvr594m3","tag_id":"cj1yyweno001umkfybg21o4jr","_id":"cj1yywenp001ymkfy4s760igf"},{"post_id":"cj1yywemw000smkfywf6ujmll","tag_id":"cj1yywen20011mkfyv6zybnpg","_id":"cj1yywenq0020mkfy2cexu1a6"},{"post_id":"cj1yywemw000umkfyftllgbl9","tag_id":"cj1yywejo0001mkfynyzc0mxz","_id":"cj1yywenr0022mkfydyqq6e52"},{"post_id":"cj1yywemw000umkfyftllgbl9","tag_id":"cj1yywenp001zmkfyhygf7me3","_id":"cj1yywenr0023mkfyi22tl5rn"},{"post_id":"cj1yywemy000xmkfyrkybvlyf","tag_id":"cj1yywejo0001mkfynyzc0mxz","_id":"cj1yywens0025mkfymvbfwxp2"},{"post_id":"cj1yywemy000xmkfyrkybvlyf","tag_id":"cj1yywenq0021mkfy2ci7wlb3","_id":"cj1yywens0026mkfyq2ife7ds"},{"post_id":"cj1yywen20012mkfyr9yljqqx","tag_id":"cj1yywejo0001mkfynyzc0mxz","_id":"cj1yywens0028mkfyj0a8rjc5"},{"post_id":"cj1yywen20012mkfyr9yljqqx","tag_id":"cj1yywenp001zmkfyhygf7me3","_id":"cj1yywens0029mkfys275zcah"},{"post_id":"cj1yywen70019mkfy6b09b6mx","tag_id":"cj1yywens0027mkfy96cpp1w0","_id":"cj1yywent002cmkfylj3ml6dd"},{"post_id":"cj1yywen70019mkfy6b09b6mx","tag_id":"cj1yywenq0021mkfy2ci7wlb3","_id":"cj1yywent002dmkfyssnh7c62"},{"post_id":"cj1yywena001bmkfy2jm8umh4","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yywent002fmkfy1ywsk8me"},{"post_id":"cj1yywenc001dmkfykmpmcbk6","tag_id":"cj1yywejo0001mkfynyzc0mxz","_id":"cj1yywenu002hmkfyu8209raa"},{"post_id":"cj1yywenc001dmkfykmpmcbk6","tag_id":"cj1yywenq0021mkfy2ci7wlb3","_id":"cj1yywenu002imkfy0sexqkr5"},{"post_id":"cj1yywend001emkfyibbqf925","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yywenu002kmkfyy0q6a3vh"},{"post_id":"cj1yywend001gmkfyqxxfzzyg","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yywenu002mmkfyiss0tjre"},{"post_id":"cj1yywend001gmkfyqxxfzzyg","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yywenv002nmkfyzoop8agy"},{"post_id":"cj1yywenf001imkfyfmgwz6uu","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yywenv002qmkfyh5ari62a"},{"post_id":"cj1yywenf001imkfyfmgwz6uu","tag_id":"cj1yywenv002omkfyx367yp0y","_id":"cj1yywenv002rmkfy021piw6j"},{"post_id":"cj1yywenj001lmkfyqfk9vi5n","tag_id":"cj1yywenq0021mkfy2ci7wlb3","_id":"cj1yywenw002umkfyp3psv10a"},{"post_id":"cj1yywenj001lmkfyqfk9vi5n","tag_id":"cj1yywenv002smkfyhuo4dngm","_id":"cj1yywenw002vmkfyg4vio6mv"},{"post_id":"cj1yywenk001nmkfyz6o8az96","tag_id":"cj1yywenq0021mkfy2ci7wlb3","_id":"cj1yywenx002xmkfy67x6lppi"},{"post_id":"cj1yywenk001nmkfyz6o8az96","tag_id":"cj1yywenv002smkfyhuo4dngm","_id":"cj1yywenx002ymkfydomzaiqx"},{"post_id":"cj1yyweoa002zmkfyilej1u2s","tag_id":"cj1yywenq0021mkfy2ci7wlb3","_id":"cj1yyweoc0031mkfydtz4v2qi"},{"post_id":"cj1yyweoa002zmkfyilej1u2s","tag_id":"cj1yywenv002smkfyhuo4dngm","_id":"cj1yyweol0033mkfygw90yuxi"},{"post_id":"cj1yyweob0030mkfyc4f1r68p","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yyweov0035mkfy0pdxnmtq"},{"post_id":"cj1yyweob0030mkfyc4f1r68p","tag_id":"cj1yywenv002omkfyx367yp0y","_id":"cj1yywep40037mkfy47wqctwa"},{"post_id":"cj1yyweoc0032mkfy88st0vf2","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yywepc003amkfy26ggnb0e"},{"post_id":"cj1yyweoc0032mkfy88st0vf2","tag_id":"cj1yywenv002omkfyx367yp0y","_id":"cj1yywepm003bmkfyxha1zq6z"},{"post_id":"cj1yyweom0034mkfy1rtkkgmo","tag_id":"cj1yywely0009mkfytxq6kj56","_id":"cj1yyweps003cmkfyqfik8sph"},{"post_id":"cj1yyweom0034mkfy1rtkkgmo","tag_id":"cj1yywenv002omkfyx367yp0y","_id":"cj1yywepz003dmkfyworzpsf2"},{"post_id":"cj1yywep40038mkfyqtkmo4o8","tag_id":"cj1yywenm001rmkfy0fdr8teq","_id":"cj1yyweq0003emkfyay9jsrap"},{"post_id":"cj1yywep40038mkfyqtkmo4o8","tag_id":"cj1yywenv002omkfyx367yp0y","_id":"cj1yyweq0003fmkfy53xqdwpn"},{"post_id":"cj1yyweov0036mkfybxbt8toj","tag_id":"cj1yywepb0039mkfyuybv1mo3","_id":"cj1yyweq0003gmkfypqsh3rm3"}],"Tag":[{"name":"Fundebug","_id":"cj1yywejo0001mkfynyzc0mxz"},{"name":"Hadoop","_id":"cj1yywelq0005mkfy6704dx5b"},{"name":"Docker","_id":"cj1yywely0009mkfytxq6kj56"},{"name":"Kubernetes","_id":"cj1yywemj000hmkfywnct8673"},{"name":"Vagrant","_id":"cj1yywen20011mkfyv6zybnpg"},{"name":"Mesos","_id":"cj1yywen50016mkfyslze70ft"},{"name":"Marathon","_id":"cj1yywenb001cmkfyzdaurzqm"},{"name":"Node.js","_id":"cj1yywenm001rmkfy0fdr8teq"},{"name":"MongoDB","_id":"cj1yyweno001umkfybg21o4jr"},{"name":"小程序","_id":"cj1yywenp001zmkfyhygf7me3"},{"name":"JavaScript","_id":"cj1yywenq0021mkfy2ci7wlb3"},{"name":"Source Map","_id":"cj1yywens0027mkfy96cpp1w0"},{"name":"翻译","_id":"cj1yywenv002omkfyx367yp0y"},{"name":"BUG","_id":"cj1yywenv002smkfyhuo4dngm"},{"name":"Linux","_id":"cj1yywepb0039mkfyuybv1mo3"}]}}